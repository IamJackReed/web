const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./XBYvhvJL.js","./DkYj2Lzs.js","./BcIMCgxB.js","./BjDUoAIV.js","./RichText.22vVeUUE.css","./Bi2-DDUn.js","./useStoryblokSEO.ikJr8AFm.css","./index.69u8nNcL.css","./x8_-A2aJ.js","./DOrJcqhu.js","./contacts._c0bu_WH.css","./Bee8PZhJ.js","./SectionChart.BTjAMx6S.css","./1V0l9_kq.js","./SectionContacts.CJ5WWyYb.css","./BOnNTYUr.js","./SectionContactsHero.8Y5EOjfb.css","./CZXlaMy4.js","./SectionContactsLocation.CvIQGhO8.css","./DK3RlC3N.js","./SectionDimensions.C0Pg-RYG.css","./IHPBCuX1.js","./SectionFlask.B8SC1JjW.css","./i6dABkDf.js","./SectionHero.BFUly0SX.css","./BUcaIFkt.js","./SectionIntro.BYcVJoN3.css","./BZppgdm_.js","./SectionMechanism.lOIcb0lI.css","./D7mAJn5o.js","./SectionTesting.f0yFVVQ1.css","./BMjIbJFQ.js","./Three.HBi_klAO.css","./eWx4T_kX.js","./error-404.4oxyXxx0.css","./o3sPI79j.js","./error-500.CZqNkBuR.css"])))=>i.map(i=>d[i]);
var Hw=Object.defineProperty;var jw=(e,t,i)=>t in e?Hw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var kn=(e,t,i)=>jw(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();/**
* @vue/shared v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function makeMap(e){const t=Object.create(null);for(const i of e.split(","))t[i]=1;return i=>i in t}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,isOn=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),isModelListener=e=>e.startsWith("onUpdate:"),extend$2=Object.assign,remove=(e,t)=>{const i=e.indexOf(t);i>-1&&e.splice(i,1)},hasOwnProperty$1=Object.prototype.hasOwnProperty,hasOwn=(e,t)=>hasOwnProperty$1.call(e,t),isArray$1=Array.isArray,isMap=e=>toTypeString(e)==="[object Map]",isSet=e=>toTypeString(e)==="[object Set]",isRegExp=e=>toTypeString(e)==="[object RegExp]",isFunction=e=>typeof e=="function",isString=e=>typeof e=="string",isSymbol=e=>typeof e=="symbol",isObject$1=e=>e!==null&&typeof e=="object",isPromise=e=>(isObject$1(e)||isFunction(e))&&isFunction(e.then)&&isFunction(e.catch),objectToString=Object.prototype.toString,toTypeString=e=>objectToString.call(e),toRawType=e=>toTypeString(e).slice(8,-1),isPlainObject$2=e=>toTypeString(e)==="[object Object]",isIntegerKey=e=>isString(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=e=>{const t=Object.create(null);return i=>t[i]||(t[i]=e(i))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(e=>e.replace(camelizeRE,(t,i)=>i?i.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(e=>e.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(e=>e.charAt(0).toUpperCase()+e.slice(1)),toHandlerKey=cacheStringFunction(e=>e?`on${capitalize(e)}`:""),hasChanged=(e,t)=>!Object.is(e,t),invokeArrayFns=(e,...t)=>{for(let i=0;i<e.length;i++)e[i](...t)},def=(e,t,i,r=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:r,value:i})},looseToNumber=e=>{const t=parseFloat(e);return isNaN(t)?e:t},toNumber=e=>{const t=isString(e)?Number(e):NaN;return isNaN(t)?e:t};let _globalThis$2;const getGlobalThis=()=>_globalThis$2||(_globalThis$2=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function normalizeStyle(e){if(isArray$1(e)){const t={};for(let i=0;i<e.length;i++){const r=e[i],o=isString(r)?parseStringStyle(r):normalizeStyle(r);if(o)for(const l in o)t[l]=o[l]}return t}else if(isString(e)||isObject$1(e))return e}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(e){const t={};return e.replace(styleCommentRE,"").split(listDelimiterRE).forEach(i=>{if(i){const r=i.split(propertyDelimiterRE);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t}function normalizeClass(e){let t="";if(isString(e))t=e;else if(isArray$1(e))for(let i=0;i<e.length;i++){const r=normalizeClass(e[i]);r&&(t+=r+" ")}else if(isObject$1(e))for(const i in e)e[i]&&(t+=i+" ");return t.trim()}function normalizeProps$1(e){if(!e)return null;let{class:t,style:i}=e;return t&&!isString(t)&&(e.class=normalizeClass(t)),i&&(e.style=normalizeStyle(i)),e}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(e){return!!e||e===""}const isRef$1=e=>!!(e&&e.__v_isRef===!0),toDisplayString=e=>isString(e)?e:e==null?"":isArray$1(e)||isObject$1(e)&&(e.toString===objectToString||!isFunction(e.toString))?isRef$1(e)?toDisplayString(e.value):JSON.stringify(e,replacer,2):String(e),replacer=(e,t)=>isRef$1(t)?replacer(e,t.value):isMap(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((i,[r,o],l)=>(i[stringifySymbol(r,l)+" =>"]=o,i),{})}:isSet(t)?{[`Set(${t.size})`]:[...t.values()].map(i=>stringifySymbol(i))}:isSymbol(t)?stringifySymbol(t):isObject$1(t)&&!isArray$1(t)&&!isPlainObject$2(t)?String(t):t,stringifySymbol=(e,t="")=>{var i;return isSymbol(e)?`Symbol(${(i=e.description)!=null?i:t})`:e};/**
* @vue/reactivity v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let activeEffectScope;class EffectScope{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=activeEffectScope,!t&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,i;if(this.scopes)for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].pause();for(t=0,i=this.effects.length;t<i;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,i;if(this.scopes)for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].resume();for(t=0,i=this.effects.length;t<i;t++)this.effects[t].resume()}}run(t){if(this._active){const i=activeEffectScope;try{return activeEffectScope=this,t()}finally{activeEffectScope=i}}}on(){++this._on===1&&(this.prevScope=activeEffectScope,activeEffectScope=this)}off(){this._on>0&&--this._on===0&&(activeEffectScope=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let i,r;for(i=0,r=this.effects.length;i<r;i++)this.effects[i].stop();for(this.effects.length=0,i=0,r=this.cleanups.length;i<r;i++)this.cleanups[i]();if(this.cleanups.length=0,this.scopes){for(i=0,r=this.scopes.length;i<r;i++)this.scopes[i].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function effectScope(e){return new EffectScope(e)}function getCurrentScope(){return activeEffectScope}function onScopeDispose(e,t=!1){activeEffectScope&&activeEffectScope.cleanups.push(e)}let activeSub;const pausedQueueEffects=new WeakSet;class ReactiveEffect{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,activeEffectScope&&activeEffectScope.active&&activeEffectScope.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,pausedQueueEffects.has(this)&&(pausedQueueEffects.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||batch(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,cleanupEffect(this),prepareDeps(this);const t=activeSub,i=shouldTrack;activeSub=this,shouldTrack=!0;try{return this.fn()}finally{cleanupDeps(this),activeSub=t,shouldTrack=i,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)removeSub(t);this.deps=this.depsTail=void 0,cleanupEffect(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?pausedQueueEffects.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){isDirty(this)&&this.run()}get dirty(){return isDirty(this)}}let batchDepth=0,batchedSub,batchedComputed;function batch(e,t=!1){if(e.flags|=8,t){e.next=batchedComputed,batchedComputed=e;return}e.next=batchedSub,batchedSub=e}function startBatch(){batchDepth++}function endBatch(){if(--batchDepth>0)return;if(batchedComputed){let t=batchedComputed;for(batchedComputed=void 0;t;){const i=t.next;t.next=void 0,t.flags&=-9,t=i}}let e;for(;batchedSub;){let t=batchedSub;for(batchedSub=void 0;t;){const i=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(r){e||(e=r)}t=i}}if(e)throw e}function prepareDeps(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function cleanupDeps(e){let t,i=e.depsTail,r=i;for(;r;){const o=r.prevDep;r.version===-1?(r===i&&(i=o),removeSub(r),removeDep(r)):t=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=o}e.deps=t,e.depsTail=i}function isDirty(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(refreshComputed(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function refreshComputed(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===globalVersion)||(e.globalVersion=globalVersion,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!isDirty(e))))return;e.flags|=2;const t=e.dep,i=activeSub,r=shouldTrack;activeSub=e,shouldTrack=!0;try{prepareDeps(e);const o=e.fn(e._value);(t.version===0||hasChanged(o,e._value))&&(e.flags|=128,e._value=o,t.version++)}catch(o){throw t.version++,o}finally{activeSub=i,shouldTrack=r,cleanupDeps(e),e.flags&=-3}}function removeSub(e,t=!1){const{dep:i,prevSub:r,nextSub:o}=e;if(r&&(r.nextSub=o,e.prevSub=void 0),o&&(o.prevSub=r,e.nextSub=void 0),i.subs===e&&(i.subs=r,!r&&i.computed)){i.computed.flags&=-5;for(let l=i.computed.deps;l;l=l.nextDep)removeSub(l,!0)}!t&&!--i.sc&&i.map&&i.map.delete(i.key)}function removeDep(e){const{prevDep:t,nextDep:i}=e;t&&(t.nextDep=i,e.prevDep=void 0),i&&(i.prevDep=t,e.nextDep=void 0)}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const e=trackStack.pop();shouldTrack=e===void 0?!0:e}function cleanupEffect(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const i=activeSub;activeSub=void 0;try{t()}finally{activeSub=i}}}let globalVersion=0;class Link{constructor(t,i){this.sub=t,this.dep=i,this.version=i.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Dep{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!activeSub||!shouldTrack||activeSub===this.computed)return;let i=this.activeLink;if(i===void 0||i.sub!==activeSub)i=this.activeLink=new Link(activeSub,this),activeSub.deps?(i.prevDep=activeSub.depsTail,activeSub.depsTail.nextDep=i,activeSub.depsTail=i):activeSub.deps=activeSub.depsTail=i,addSub(i);else if(i.version===-1&&(i.version=this.version,i.nextDep)){const r=i.nextDep;r.prevDep=i.prevDep,i.prevDep&&(i.prevDep.nextDep=r),i.prevDep=activeSub.depsTail,i.nextDep=void 0,activeSub.depsTail.nextDep=i,activeSub.depsTail=i,activeSub.deps===i&&(activeSub.deps=r)}return i}trigger(t){this.version++,globalVersion++,this.notify(t)}notify(t){startBatch();try{for(let i=this.subs;i;i=i.prevSub)i.sub.notify()&&i.sub.dep.notify()}finally{endBatch()}}}function addSub(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let r=t.deps;r;r=r.nextDep)addSub(r)}const i=e.dep.subs;i!==e&&(e.prevSub=i,i&&(i.nextSub=e)),e.dep.subs=e}}const targetMap=new WeakMap,ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol(""),ARRAY_ITERATE_KEY=Symbol("");function track(e,t,i){if(shouldTrack&&activeSub){let r=targetMap.get(e);r||targetMap.set(e,r=new Map);let o=r.get(i);o||(r.set(i,o=new Dep),o.map=r,o.key=i),o.track()}}function trigger(e,t,i,r,o,l){const d=targetMap.get(e);if(!d){globalVersion++;return}const n=S=>{S&&S.trigger()};if(startBatch(),t==="clear")d.forEach(n);else{const S=isArray$1(e),C=S&&isIntegerKey(i);if(S&&i==="length"){const I=Number(r);d.forEach((z,$)=>{($==="length"||$===ARRAY_ITERATE_KEY||!isSymbol($)&&$>=I)&&n(z)})}else switch((i!==void 0||d.has(void 0))&&n(d.get(i)),C&&n(d.get(ARRAY_ITERATE_KEY)),t){case"add":S?C&&n(d.get("length")):(n(d.get(ITERATE_KEY)),isMap(e)&&n(d.get(MAP_KEY_ITERATE_KEY)));break;case"delete":S||(n(d.get(ITERATE_KEY)),isMap(e)&&n(d.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(e)&&n(d.get(ITERATE_KEY));break}}endBatch()}function getDepFromReactive(e,t){const i=targetMap.get(e);return i&&i.get(t)}function reactiveReadArray(e){const t=toRaw(e);return t===e?t:(track(t,"iterate",ARRAY_ITERATE_KEY),isShallow(e)?t:t.map(toReactive))}function shallowReadArray(e){return track(e=toRaw(e),"iterate",ARRAY_ITERATE_KEY),e}const arrayInstrumentations={__proto__:null,[Symbol.iterator](){return iterator(this,Symbol.iterator,toReactive)},concat(...e){return reactiveReadArray(this).concat(...e.map(t=>isArray$1(t)?reactiveReadArray(t):t))},entries(){return iterator(this,"entries",e=>(e[1]=toReactive(e[1]),e))},every(e,t){return apply(this,"every",e,t,void 0,arguments)},filter(e,t){return apply(this,"filter",e,t,i=>i.map(toReactive),arguments)},find(e,t){return apply(this,"find",e,t,toReactive,arguments)},findIndex(e,t){return apply(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return apply(this,"findLast",e,t,toReactive,arguments)},findLastIndex(e,t){return apply(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return apply(this,"forEach",e,t,void 0,arguments)},includes(...e){return searchProxy(this,"includes",e)},indexOf(...e){return searchProxy(this,"indexOf",e)},join(e){return reactiveReadArray(this).join(e)},lastIndexOf(...e){return searchProxy(this,"lastIndexOf",e)},map(e,t){return apply(this,"map",e,t,void 0,arguments)},pop(){return noTracking(this,"pop")},push(...e){return noTracking(this,"push",e)},reduce(e,...t){return reduce(this,"reduce",e,t)},reduceRight(e,...t){return reduce(this,"reduceRight",e,t)},shift(){return noTracking(this,"shift")},some(e,t){return apply(this,"some",e,t,void 0,arguments)},splice(...e){return noTracking(this,"splice",e)},toReversed(){return reactiveReadArray(this).toReversed()},toSorted(e){return reactiveReadArray(this).toSorted(e)},toSpliced(...e){return reactiveReadArray(this).toSpliced(...e)},unshift(...e){return noTracking(this,"unshift",e)},values(){return iterator(this,"values",toReactive)}};function iterator(e,t,i){const r=shallowReadArray(e),o=r[t]();return r!==e&&!isShallow(e)&&(o._next=o.next,o.next=()=>{const l=o._next();return l.value&&(l.value=i(l.value)),l}),o}const arrayProto=Array.prototype;function apply(e,t,i,r,o,l){const d=shallowReadArray(e),n=d!==e&&!isShallow(e),S=d[t];if(S!==arrayProto[t]){const z=S.apply(e,l);return n?toReactive(z):z}let C=i;d!==e&&(n?C=function(z,$){return i.call(this,toReactive(z),$,e)}:i.length>2&&(C=function(z,$){return i.call(this,z,$,e)}));const I=S.call(d,C,r);return n&&o?o(I):I}function reduce(e,t,i,r){const o=shallowReadArray(e);let l=i;return o!==e&&(isShallow(e)?i.length>3&&(l=function(d,n,S){return i.call(this,d,n,S,e)}):l=function(d,n,S){return i.call(this,d,toReactive(n),S,e)}),o[t](l,...r)}function searchProxy(e,t,i){const r=toRaw(e);track(r,"iterate",ARRAY_ITERATE_KEY);const o=r[t](...i);return(o===-1||o===!1)&&isProxy(i[0])?(i[0]=toRaw(i[0]),r[t](...i)):o}function noTracking(e,t,i=[]){pauseTracking(),startBatch();const r=toRaw(e)[t].apply(e,i);return endBatch(),resetTracking(),r}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(isSymbol));function hasOwnProperty(e){isSymbol(e)||(e=String(e));const t=toRaw(this);return track(t,"has",e),t.hasOwnProperty(e)}class BaseReactiveHandler{constructor(t=!1,i=!1){this._isReadonly=t,this._isShallow=i}get(t,i,r){if(i==="__v_skip")return t.__v_skip;const o=this._isReadonly,l=this._isShallow;if(i==="__v_isReactive")return!o;if(i==="__v_isReadonly")return o;if(i==="__v_isShallow")return l;if(i==="__v_raw")return r===(o?l?shallowReadonlyMap:readonlyMap:l?shallowReactiveMap:reactiveMap).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(r)?t:void 0;const d=isArray$1(t);if(!o){let S;if(d&&(S=arrayInstrumentations[i]))return S;if(i==="hasOwnProperty")return hasOwnProperty}const n=Reflect.get(t,i,isRef(t)?t:r);return(isSymbol(i)?builtInSymbols.has(i):isNonTrackableKeys(i))||(o||track(t,"get",i),l)?n:isRef(n)?d&&isIntegerKey(i)?n:n.value:isObject$1(n)?o?readonly(n):reactive(n):n}}class MutableReactiveHandler extends BaseReactiveHandler{constructor(t=!1){super(!1,t)}set(t,i,r,o){let l=t[i];if(!this._isShallow){const S=isReadonly(l);if(!isShallow(r)&&!isReadonly(r)&&(l=toRaw(l),r=toRaw(r)),!isArray$1(t)&&isRef(l)&&!isRef(r))return S?!1:(l.value=r,!0)}const d=isArray$1(t)&&isIntegerKey(i)?Number(i)<t.length:hasOwn(t,i),n=Reflect.set(t,i,r,isRef(t)?t:o);return t===toRaw(o)&&(d?hasChanged(r,l)&&trigger(t,"set",i,r):trigger(t,"add",i,r)),n}deleteProperty(t,i){const r=hasOwn(t,i);t[i];const o=Reflect.deleteProperty(t,i);return o&&r&&trigger(t,"delete",i,void 0),o}has(t,i){const r=Reflect.has(t,i);return(!isSymbol(i)||!builtInSymbols.has(i))&&track(t,"has",i),r}ownKeys(t){return track(t,"iterate",isArray$1(t)?"length":ITERATE_KEY),Reflect.ownKeys(t)}}class ReadonlyReactiveHandler extends BaseReactiveHandler{constructor(t=!1){super(!0,t)}set(t,i){return!0}deleteProperty(t,i){return!0}}const mutableHandlers=new MutableReactiveHandler,readonlyHandlers=new ReadonlyReactiveHandler,shallowReactiveHandlers=new MutableReactiveHandler(!0),shallowReadonlyHandlers=new ReadonlyReactiveHandler(!0),toShallow=e=>e,getProto=e=>Reflect.getPrototypeOf(e);function createIterableMethod(e,t,i){return function(...r){const o=this.__v_raw,l=toRaw(o),d=isMap(l),n=e==="entries"||e===Symbol.iterator&&d,S=e==="keys"&&d,C=o[e](...r),I=i?toShallow:t?toReadonly:toReactive;return!t&&track(l,"iterate",S?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:z,done:$}=C.next();return $?{value:z,done:$}:{value:n?[I(z[0]),I(z[1])]:I(z),done:$}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function createInstrumentations(e,t){const i={get(o){const l=this.__v_raw,d=toRaw(l),n=toRaw(o);e||(hasChanged(o,n)&&track(d,"get",o),track(d,"get",n));const{has:S}=getProto(d),C=t?toShallow:e?toReadonly:toReactive;if(S.call(d,o))return C(l.get(o));if(S.call(d,n))return C(l.get(n));l!==d&&l.get(o)},get size(){const o=this.__v_raw;return!e&&track(toRaw(o),"iterate",ITERATE_KEY),Reflect.get(o,"size",o)},has(o){const l=this.__v_raw,d=toRaw(l),n=toRaw(o);return e||(hasChanged(o,n)&&track(d,"has",o),track(d,"has",n)),o===n?l.has(o):l.has(o)||l.has(n)},forEach(o,l){const d=this,n=d.__v_raw,S=toRaw(n),C=t?toShallow:e?toReadonly:toReactive;return!e&&track(S,"iterate",ITERATE_KEY),n.forEach((I,z)=>o.call(l,C(I),C(z),d))}};return extend$2(i,e?{add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear")}:{add(o){!t&&!isShallow(o)&&!isReadonly(o)&&(o=toRaw(o));const l=toRaw(this);return getProto(l).has.call(l,o)||(l.add(o),trigger(l,"add",o,o)),this},set(o,l){!t&&!isShallow(l)&&!isReadonly(l)&&(l=toRaw(l));const d=toRaw(this),{has:n,get:S}=getProto(d);let C=n.call(d,o);C||(o=toRaw(o),C=n.call(d,o));const I=S.call(d,o);return d.set(o,l),C?hasChanged(l,I)&&trigger(d,"set",o,l):trigger(d,"add",o,l),this},delete(o){const l=toRaw(this),{has:d,get:n}=getProto(l);let S=d.call(l,o);S||(o=toRaw(o),S=d.call(l,o)),n&&n.call(l,o);const C=l.delete(o);return S&&trigger(l,"delete",o,void 0),C},clear(){const o=toRaw(this),l=o.size!==0,d=o.clear();return l&&trigger(o,"clear",void 0,void 0),d}}),["keys","values","entries",Symbol.iterator].forEach(o=>{i[o]=createIterableMethod(o,e,t)}),i}function createInstrumentationGetter(e,t){const i=createInstrumentations(e,t);return(r,o,l)=>o==="__v_isReactive"?!e:o==="__v_isReadonly"?e:o==="__v_raw"?r:Reflect.get(hasOwn(i,o)&&o in r?i:r,o,l)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(e){return e.__v_skip||!Object.isExtensible(e)?0:targetTypeMap(toRawType(e))}function reactive(e){return isReadonly(e)?e:createReactiveObject(e,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(e){return createReactiveObject(e,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(e){return createReactiveObject(e,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(e){return createReactiveObject(e,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(e,t,i,r,o){if(!isObject$1(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const l=getTargetType(e);if(l===0)return e;const d=o.get(e);if(d)return d;const n=new Proxy(e,l===2?r:i);return o.set(e,n),n}function isReactive(e){return isReadonly(e)?isReactive(e.__v_raw):!!(e&&e.__v_isReactive)}function isReadonly(e){return!!(e&&e.__v_isReadonly)}function isShallow(e){return!!(e&&e.__v_isShallow)}function isProxy(e){return e?!!e.__v_raw:!1}function toRaw(e){const t=e&&e.__v_raw;return t?toRaw(t):e}function markRaw(e){return!hasOwn(e,"__v_skip")&&Object.isExtensible(e)&&def(e,"__v_skip",!0),e}const toReactive=e=>isObject$1(e)?reactive(e):e,toReadonly=e=>isObject$1(e)?readonly(e):e;function isRef(e){return e?e.__v_isRef===!0:!1}function ref(e){return createRef(e,!1)}function shallowRef(e){return createRef(e,!0)}function createRef(e,t){return isRef(e)?e:new RefImpl(e,t)}class RefImpl{constructor(t,i){this.dep=new Dep,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=i?t:toRaw(t),this._value=i?t:toReactive(t),this.__v_isShallow=i}get value(){return this.dep.track(),this._value}set value(t){const i=this._rawValue,r=this.__v_isShallow||isShallow(t)||isReadonly(t);t=r?t:toRaw(t),hasChanged(t,i)&&(this._rawValue=t,this._value=r?t:toReactive(t),this.dep.trigger())}}function triggerRef(e){e.dep&&e.dep.trigger()}function unref(e){return isRef(e)?e.value:e}function toValue(e){return isFunction(e)?e():unref(e)}const shallowUnwrapHandlers={get:(e,t,i)=>t==="__v_raw"?e:unref(Reflect.get(e,t,i)),set:(e,t,i,r)=>{const o=e[t];return isRef(o)&&!isRef(i)?(o.value=i,!0):Reflect.set(e,t,i,r)}};function proxyRefs(e){return isReactive(e)?e:new Proxy(e,shallowUnwrapHandlers)}function toRefs(e){const t=isArray$1(e)?new Array(e.length):{};for(const i in e)t[i]=propertyToRef(e,i);return t}class ObjectRefImpl{constructor(t,i,r){this._object=t,this._key=i,this._defaultValue=r,this.__v_isRef=!0,this._value=void 0}get value(){const t=this._object[this._key];return this._value=t===void 0?this._defaultValue:t}set value(t){this._object[this._key]=t}get dep(){return getDepFromReactive(toRaw(this._object),this._key)}}class GetterRefImpl{constructor(t){this._getter=t,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function toRef(e,t,i){return isRef(e)?e:isFunction(e)?new GetterRefImpl(e):isObject$1(e)&&arguments.length>1?propertyToRef(e,t,i):ref(e)}function propertyToRef(e,t,i){const r=e[t];return isRef(r)?r:new ObjectRefImpl(e,t,i)}class ComputedRefImpl{constructor(t,i,r){this.fn=t,this.setter=i,this._value=void 0,this.dep=new Dep(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=globalVersion-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!i,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&activeSub!==this)return batch(this,!0),!0}get value(){const t=this.dep.track();return refreshComputed(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function computed$1(e,t,i=!1){let r,o;return isFunction(e)?r=e:(r=e.get,o=e.set),new ComputedRefImpl(r,o,i)}const INITIAL_WATCHER_VALUE={},cleanupMap=new WeakMap;let activeWatcher;function onWatcherCleanup(e,t=!1,i=activeWatcher){if(i){let r=cleanupMap.get(i);r||cleanupMap.set(i,r=[]),r.push(e)}}function watch$2(e,t,i=EMPTY_OBJ){const{immediate:r,deep:o,once:l,scheduler:d,augmentJob:n,call:S}=i,C=he=>o?he:isShallow(he)||o===!1||o===0?traverse(he,1):traverse(he);let I,z,$,k,Y=!1,ie=!1;if(isRef(e)?(z=()=>e.value,Y=isShallow(e)):isReactive(e)?(z=()=>C(e),Y=!0):isArray$1(e)?(ie=!0,Y=e.some(he=>isReactive(he)||isShallow(he)),z=()=>e.map(he=>{if(isRef(he))return he.value;if(isReactive(he))return C(he);if(isFunction(he))return S?S(he,2):he()})):isFunction(e)?t?z=S?()=>S(e,2):e:z=()=>{if($){pauseTracking();try{$()}finally{resetTracking()}}const he=activeWatcher;activeWatcher=I;try{return S?S(e,3,[k]):e(k)}finally{activeWatcher=he}}:z=NOOP,t&&o){const he=z,me=o===!0?1/0:o;z=()=>traverse(he(),me)}const ue=getCurrentScope(),ne=()=>{I.stop(),ue&&ue.active&&remove(ue.effects,I)};if(l&&t){const he=t;t=(...me)=>{he(...me),ne()}}let se=ie?new Array(e.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const le=he=>{if(!(!(I.flags&1)||!I.dirty&&!he))if(t){const me=I.run();if(o||Y||(ie?me.some((ge,xt)=>hasChanged(ge,se[xt])):hasChanged(me,se))){$&&$();const ge=activeWatcher;activeWatcher=I;try{const xt=[me,se===INITIAL_WATCHER_VALUE?void 0:ie&&se[0]===INITIAL_WATCHER_VALUE?[]:se,k];S?S(t,3,xt):t(...xt),se=me}finally{activeWatcher=ge}}}else I.run()};return n&&n(le),I=new ReactiveEffect(z),I.scheduler=d?()=>d(le,!1):le,k=he=>onWatcherCleanup(he,!1,I),$=I.onStop=()=>{const he=cleanupMap.get(I);if(he){if(S)S(he,4);else for(const me of he)me();cleanupMap.delete(I)}},t?r?le(!0):se=I.run():d?d(le.bind(null,!0),!0):I.run(),ne.pause=I.pause.bind(I),ne.resume=I.resume.bind(I),ne.stop=ne,ne}function traverse(e,t=1/0,i){if(t<=0||!isObject$1(e)||e.__v_skip||(i=i||new Set,i.has(e)))return e;if(i.add(e),t--,isRef(e))traverse(e.value,t,i);else if(isArray$1(e))for(let r=0;r<e.length;r++)traverse(e[r],t,i);else if(isSet(e)||isMap(e))e.forEach(r=>{traverse(r,t,i)});else if(isPlainObject$2(e)){for(const r in e)traverse(e[r],t,i);for(const r of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,r)&&traverse(e[r],t,i)}return e}/**
* @vue/runtime-core v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const stack=[];let isWarning=!1;function warn$1(e,...t){if(isWarning)return;isWarning=!0,pauseTracking();const i=stack.length?stack[stack.length-1].component:null,r=i&&i.appContext.config.warnHandler,o=getComponentTrace();if(r)callWithErrorHandling(r,i,11,[e+t.map(l=>{var d,n;return(n=(d=l.toString)==null?void 0:d.call(l))!=null?n:JSON.stringify(l)}).join(""),i&&i.proxy,o.map(({vnode:l})=>`at <${formatComponentName(i,l.type)}>`).join(`
`),o]);else{const l=[`[Vue warn]: ${e}`,...t];o.length&&l.push(`
`,...formatTrace(o)),console.warn(...l)}resetTracking(),isWarning=!1}function getComponentTrace(){let e=stack[stack.length-1];if(!e)return[];const t=[];for(;e;){const i=t[0];i&&i.vnode===e?i.recurseCount++:t.push({vnode:e,recurseCount:0});const r=e.component&&e.component.parent;e=r&&r.vnode}return t}function formatTrace(e){const t=[];return e.forEach((i,r)=>{t.push(...r===0?[]:[`
`],...formatTraceEntry(i))}),t}function formatTraceEntry({vnode:e,recurseCount:t}){const i=t>0?`... (${t} recursive calls)`:"",r=e.component?e.component.parent==null:!1,o=` at <${formatComponentName(e.component,e.type,r)}`,l=">"+i;return e.props?[o,...formatProps(e.props),l]:[o+l]}function formatProps(e){const t=[],i=Object.keys(e);return i.slice(0,3).forEach(r=>{t.push(...formatProp(r,e[r]))}),i.length>3&&t.push(" ..."),t}function formatProp(e,t,i){return isString(t)?(t=JSON.stringify(t),i?t:[`${e}=${t}`]):typeof t=="number"||typeof t=="boolean"||t==null?i?t:[`${e}=${t}`]:isRef(t)?(t=formatProp(e,toRaw(t.value),!0),i?t:[`${e}=Ref<`,t,">"]):isFunction(t)?[`${e}=fn${t.name?`<${t.name}>`:""}`]:(t=toRaw(t),i?t:[`${e}=`,t])}function callWithErrorHandling(e,t,i,r){try{return r?e(...r):e()}catch(o){handleError(o,t,i)}}function callWithAsyncErrorHandling(e,t,i,r){if(isFunction(e)){const o=callWithErrorHandling(e,t,i,r);return o&&isPromise(o)&&o.catch(l=>{handleError(l,t,i)}),o}if(isArray$1(e)){const o=[];for(let l=0;l<e.length;l++)o.push(callWithAsyncErrorHandling(e[l],t,i,r));return o}}function handleError(e,t,i,r=!0){const o=t?t.vnode:null,{errorHandler:l,throwUnhandledErrorInProduction:d}=t&&t.appContext.config||EMPTY_OBJ;if(t){let n=t.parent;const S=t.proxy,C=`https://vuejs.org/error-reference/#runtime-${i}`;for(;n;){const I=n.ec;if(I){for(let z=0;z<I.length;z++)if(I[z](e,S,C)===!1)return}n=n.parent}if(l){pauseTracking(),callWithErrorHandling(l,null,10,[e,S,C]),resetTracking();return}}logError(e,i,o,r,d)}function logError(e,t,i,r=!0,o=!1){if(o)throw e;console.error(e)}const queue=[];let flushIndex=-1;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(e){const t=currentFlushPromise||resolvedPromise;return e?t.then(this?e.bind(this):e):t}function findInsertionIndex$1(e){let t=flushIndex+1,i=queue.length;for(;t<i;){const r=t+i>>>1,o=queue[r],l=getId(o);l<e||l===e&&o.flags&2?t=r+1:i=r}return t}function queueJob(e){if(!(e.flags&1)){const t=getId(e),i=queue[queue.length-1];!i||!(e.flags&2)&&t>=getId(i)?queue.push(e):queue.splice(findInsertionIndex$1(t),0,e),e.flags|=1,queueFlush()}}function queueFlush(){currentFlushPromise||(currentFlushPromise=resolvedPromise.then(flushJobs))}function queuePostFlushCb(e){isArray$1(e)?pendingPostFlushCbs.push(...e):activePostFlushCbs&&e.id===-1?activePostFlushCbs.splice(postFlushIndex+1,0,e):e.flags&1||(pendingPostFlushCbs.push(e),e.flags|=1),queueFlush()}function flushPreFlushCbs(e,t,i=flushIndex+1){for(;i<queue.length;i++){const r=queue[i];if(r&&r.flags&2){if(e&&r.id!==e.uid)continue;queue.splice(i,1),i--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function flushPostFlushCbs(e){if(pendingPostFlushCbs.length){const t=[...new Set(pendingPostFlushCbs)].sort((i,r)=>getId(i)-getId(r));if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...t);return}for(activePostFlushCbs=t,postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++){const i=activePostFlushCbs[postFlushIndex];i.flags&4&&(i.flags&=-2),i.flags&8||i(),i.flags&=-2}activePostFlushCbs=null,postFlushIndex=0}}const getId=e=>e.id==null?e.flags&2?-1:1/0:e.id;function flushJobs(e){try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const t=queue[flushIndex];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),callWithErrorHandling(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;flushIndex<queue.length;flushIndex++){const t=queue[flushIndex];t&&(t.flags&=-2)}flushIndex=-1,queue.length=0,flushPostFlushCbs(),currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(e){const t=currentRenderingInstance;return currentRenderingInstance=e,currentScopeId=e&&e.type.__scopeId||null,t}function withCtx(e,t=currentRenderingInstance,i){if(!t||e._n)return e;const r=(...o)=>{r._d&&setBlockTracking(-1);const l=setCurrentRenderingInstance(t);let d;try{d=e(...o)}finally{setCurrentRenderingInstance(l),r._d&&setBlockTracking(1)}return d};return r._n=!0,r._c=!0,r._d=!0,r}function withDirectives(e,t){if(currentRenderingInstance===null)return e;const i=getComponentPublicInstance(currentRenderingInstance),r=e.dirs||(e.dirs=[]);for(let o=0;o<t.length;o++){let[l,d,n,S=EMPTY_OBJ]=t[o];l&&(isFunction(l)&&(l={mounted:l,updated:l}),l.deep&&traverse(d),r.push({dir:l,instance:i,value:d,oldValue:void 0,arg:n,modifiers:S}))}return e}function invokeDirectiveHook(e,t,i,r){const o=e.dirs,l=t&&t.dirs;for(let d=0;d<o.length;d++){const n=o[d];l&&(n.oldValue=l[d].value);let S=n.dir[r];S&&(pauseTracking(),callWithAsyncErrorHandling(S,i,8,[e.el,n,e,t]),resetTracking())}}const TeleportEndKey=Symbol("_vte"),isTeleport=e=>e.__isTeleport,leaveCbKey=Symbol("_leaveCb"),enterCbKey=Symbol("_enterCb");function useTransitionState(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{e.isMounted=!0}),onBeforeUnmount(()=>{e.isUnmounting=!0}),e}const TransitionHookValidator=[Function,Array],BaseTransitionPropsValidators={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},recursiveGetSubtree=e=>{const t=e.subTree;return t.component?recursiveGetSubtree(t.component):t},BaseTransitionImpl={name:"BaseTransition",props:BaseTransitionPropsValidators,setup(e,{slots:t}){const i=getCurrentInstance(),r=useTransitionState();return()=>{const o=t.default&&getTransitionRawChildren(t.default(),!0);if(!o||!o.length)return;const l=findNonCommentChild(o),d=toRaw(e),{mode:n}=d;if(r.isLeaving)return emptyPlaceholder(l);const S=getInnerChild$1(l);if(!S)return emptyPlaceholder(l);let C=resolveTransitionHooks(S,d,r,i,z=>C=z);S.type!==Comment&&setTransitionHooks(S,C);let I=i.subTree&&getInnerChild$1(i.subTree);if(I&&I.type!==Comment&&!isSameVNodeType(S,I)&&recursiveGetSubtree(i).type!==Comment){let z=resolveTransitionHooks(I,d,r,i);if(setTransitionHooks(I,z),n==="out-in"&&S.type!==Comment)return r.isLeaving=!0,z.afterLeave=()=>{r.isLeaving=!1,i.job.flags&8||i.update(),delete z.afterLeave,I=void 0},emptyPlaceholder(l);n==="in-out"&&S.type!==Comment?z.delayLeave=($,k,Y)=>{const ie=getLeavingNodesForType(r,I);ie[String(I.key)]=I,$[leaveCbKey]=()=>{k(),$[leaveCbKey]=void 0,delete C.delayedLeave,I=void 0},C.delayedLeave=()=>{Y(),delete C.delayedLeave,I=void 0}}:I=void 0}else I&&(I=void 0);return l}}};function findNonCommentChild(e){let t=e[0];if(e.length>1){for(const i of e)if(i.type!==Comment){t=i;break}}return t}const BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(e,t){const{leavingVNodes:i}=e;let r=i.get(t.type);return r||(r=Object.create(null),i.set(t.type,r)),r}function resolveTransitionHooks(e,t,i,r,o){const{appear:l,mode:d,persisted:n=!1,onBeforeEnter:S,onEnter:C,onAfterEnter:I,onEnterCancelled:z,onBeforeLeave:$,onLeave:k,onAfterLeave:Y,onLeaveCancelled:ie,onBeforeAppear:ue,onAppear:ne,onAfterAppear:se,onAppearCancelled:le}=t,he=String(e.key),me=getLeavingNodesForType(i,e),ge=(Lt,Zt)=>{Lt&&callWithAsyncErrorHandling(Lt,r,9,Zt)},xt=(Lt,Zt)=>{const Ht=Zt[1];ge(Lt,Zt),isArray$1(Lt)?Lt.every(It=>It.length<=1)&&Ht():Lt.length<=1&&Ht()},Et={mode:d,persisted:n,beforeEnter(Lt){let Zt=S;if(!i.isMounted)if(l)Zt=ue||S;else return;Lt[leaveCbKey]&&Lt[leaveCbKey](!0);const Ht=me[he];Ht&&isSameVNodeType(e,Ht)&&Ht.el[leaveCbKey]&&Ht.el[leaveCbKey](),ge(Zt,[Lt])},enter(Lt){let Zt=C,Ht=I,It=z;if(!i.isMounted)if(l)Zt=ne||C,Ht=se||I,It=le||z;else return;let Yt=!1;const ri=Lt[enterCbKey]=ei=>{Yt||(Yt=!0,ei?ge(It,[Lt]):ge(Ht,[Lt]),Et.delayedLeave&&Et.delayedLeave(),Lt[enterCbKey]=void 0)};Zt?xt(Zt,[Lt,ri]):ri()},leave(Lt,Zt){const Ht=String(e.key);if(Lt[enterCbKey]&&Lt[enterCbKey](!0),i.isUnmounting)return Zt();ge($,[Lt]);let It=!1;const Yt=Lt[leaveCbKey]=ri=>{It||(It=!0,Zt(),ri?ge(ie,[Lt]):ge(Y,[Lt]),Lt[leaveCbKey]=void 0,me[Ht]===e&&delete me[Ht])};me[Ht]=e,k?xt(k,[Lt,Yt]):Yt()},clone(Lt){const Zt=resolveTransitionHooks(Lt,t,i,r,o);return o&&o(Zt),Zt}};return Et}function emptyPlaceholder(e){if(isKeepAlive(e))return e=cloneVNode(e),e.children=null,e}function getInnerChild$1(e){if(!isKeepAlive(e))return isTeleport(e.type)&&e.children?findNonCommentChild(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:i}=e;if(i){if(t&16)return i[0];if(t&32&&isFunction(i.default))return i.default()}}function setTransitionHooks(e,t){e.shapeFlag&6&&e.component?(e.transition=t,setTransitionHooks(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function getTransitionRawChildren(e,t=!1,i){let r=[],o=0;for(let l=0;l<e.length;l++){let d=e[l];const n=i==null?d.key:String(i)+String(d.key!=null?d.key:l);d.type===Fragment?(d.patchFlag&128&&o++,r=r.concat(getTransitionRawChildren(d.children,t,n))):(t||d.type!==Comment)&&r.push(n!=null?cloneVNode(d,{key:n}):d)}if(o>1)for(let l=0;l<r.length;l++)r[l].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function defineComponent(e,t){return isFunction(e)?extend$2({name:e.name},t,{setup:e}):e}function useId(){const e=getCurrentInstance();return e?(e.appContext.config.idPrefix||"v")+"-"+e.ids[0]+e.ids[1]++:""}function markAsyncBoundary(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function useTemplateRef(e){const t=getCurrentInstance(),i=shallowRef(null);if(t){const o=t.refs===EMPTY_OBJ?t.refs={}:t.refs;Object.defineProperty(o,e,{enumerable:!0,get:()=>i.value,set:l=>i.value=l})}return i}function setRef(e,t,i,r,o=!1){if(isArray$1(e)){e.forEach((Y,ie)=>setRef(Y,t&&(isArray$1(t)?t[ie]:t),i,r,o));return}if(isAsyncWrapper(r)&&!o){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&setRef(e,t,i,r.component.subTree);return}const l=r.shapeFlag&4?getComponentPublicInstance(r.component):r.el,d=o?null:l,{i:n,r:S}=e,C=t&&t.r,I=n.refs===EMPTY_OBJ?n.refs={}:n.refs,z=n.setupState,$=toRaw(z),k=z===EMPTY_OBJ?()=>!1:Y=>hasOwn($,Y);if(C!=null&&C!==S&&(isString(C)?(I[C]=null,k(C)&&(z[C]=null)):isRef(C)&&(C.value=null)),isFunction(S))callWithErrorHandling(S,n,12,[d,I]);else{const Y=isString(S),ie=isRef(S);if(Y||ie){const ue=()=>{if(e.f){const ne=Y?k(S)?z[S]:I[S]:S.value;o?isArray$1(ne)&&remove(ne,l):isArray$1(ne)?ne.includes(l)||ne.push(l):Y?(I[S]=[l],k(S)&&(z[S]=I[S])):(S.value=[l],e.k&&(I[e.k]=S.value))}else Y?(I[S]=d,k(S)&&(z[S]=d)):ie&&(S.value=d,e.k&&(I[e.k]=d))};d?(ue.id=-1,queuePostRenderEffect(ue,i)):ue()}}}let hasLoggedMismatchError=!1;const logMismatchError=()=>{hasLoggedMismatchError||(console.error("Hydration completed but contains mismatches."),hasLoggedMismatchError=!0)},isSVGContainer=e=>e.namespaceURI.includes("svg")&&e.tagName!=="foreignObject",isMathMLContainer=e=>e.namespaceURI.includes("MathML"),getContainerType=e=>{if(e.nodeType===1){if(isSVGContainer(e))return"svg";if(isMathMLContainer(e))return"mathml"}},isComment=e=>e.nodeType===8;function createHydrationFunctions(e){const{mt:t,p:i,o:{patchProp:r,createText:o,nextSibling:l,parentNode:d,remove:n,insert:S,createComment:C}}=e,I=(le,he)=>{if(!he.hasChildNodes()){i(null,le,he),flushPostFlushCbs(),he._vnode=le;return}z(he.firstChild,le,null,null,null),flushPostFlushCbs(),he._vnode=le},z=(le,he,me,ge,xt,Et=!1)=>{Et=Et||!!he.dynamicChildren;const Lt=isComment(le)&&le.data==="[",Zt=()=>ie(le,he,me,ge,xt,Lt),{type:Ht,ref:It,shapeFlag:Yt,patchFlag:ri}=he;let ei=le.nodeType;he.el=le,ri===-2&&(Et=!1,he.dynamicChildren=null);let Ct=null;switch(Ht){case Text:ei!==3?he.children===""?(S(he.el=o(""),d(le),le),Ct=le):Ct=Zt():(le.data!==he.children&&(logMismatchError(),le.data=he.children),Ct=l(le));break;case Comment:se(le)?(Ct=l(le),ne(he.el=le.content.firstChild,le,me)):ei!==8||Lt?Ct=Zt():Ct=l(le);break;case Static:if(Lt&&(le=l(le),ei=le.nodeType),ei===1||ei===3){Ct=le;const Ut=!he.children.length;for(let Mt=0;Mt<he.staticCount;Mt++)Ut&&(he.children+=Ct.nodeType===1?Ct.outerHTML:Ct.data),Mt===he.staticCount-1&&(he.anchor=Ct),Ct=l(Ct);return Lt?l(Ct):Ct}else Zt();break;case Fragment:Lt?Ct=Y(le,he,me,ge,xt,Et):Ct=Zt();break;default:if(Yt&1)(ei!==1||he.type.toLowerCase()!==le.tagName.toLowerCase())&&!se(le)?Ct=Zt():Ct=$(le,he,me,ge,xt,Et);else if(Yt&6){he.slotScopeIds=xt;const Ut=d(le);if(Lt?Ct=ue(le):isComment(le)&&le.data==="teleport start"?Ct=ue(le,le.data,"teleport end"):Ct=l(le),t(he,Ut,null,me,ge,getContainerType(Ut),Et),isAsyncWrapper(he)&&!he.type.__asyncResolved){let Mt;Lt?(Mt=createVNode(Fragment),Mt.anchor=Ct?Ct.previousSibling:Ut.lastChild):Mt=le.nodeType===3?createTextVNode(""):createVNode("div"),Mt.el=le,he.component.subTree=Mt}}else Yt&64?ei!==8?Ct=Zt():Ct=he.type.hydrate(le,he,me,ge,xt,Et,e,k):Yt&128&&(Ct=he.type.hydrate(le,he,me,ge,getContainerType(d(le)),xt,Et,e,z))}return It!=null&&setRef(It,null,ge,he),Ct},$=(le,he,me,ge,xt,Et)=>{Et=Et||!!he.dynamicChildren;const{type:Lt,props:Zt,patchFlag:Ht,shapeFlag:It,dirs:Yt,transition:ri}=he,ei=Lt==="input"||Lt==="option";if(ei||Ht!==-1){Yt&&invokeDirectiveHook(he,null,me,"created");let Ct=!1;if(se(le)){Ct=needTransition(null,ri)&&me&&me.vnode.props&&me.vnode.props.appear;const Mt=le.content.firstChild;Ct&&ri.beforeEnter(Mt),ne(Mt,le,me),he.el=le=Mt}if(It&16&&!(Zt&&(Zt.innerHTML||Zt.textContent))){let Mt=k(le.firstChild,he,le,me,ge,xt,Et);for(;Mt;){isMismatchAllowed(le,1)||logMismatchError();const $t=Mt;Mt=Mt.nextSibling,n($t)}}else if(It&8){let Mt=he.children;Mt[0]===`
`&&(le.tagName==="PRE"||le.tagName==="TEXTAREA")&&(Mt=Mt.slice(1)),le.textContent!==Mt&&(isMismatchAllowed(le,0)||logMismatchError(),le.textContent=he.children)}if(Zt){if(ei||!Et||Ht&48){const Mt=le.tagName.includes("-");for(const $t in Zt)(ei&&($t.endsWith("value")||$t==="indeterminate")||isOn($t)&&!isReservedProp($t)||$t[0]==="."||Mt)&&r(le,$t,null,Zt[$t],void 0,me)}else if(Zt.onClick)r(le,"onClick",null,Zt.onClick,void 0,me);else if(Ht&4&&isReactive(Zt.style))for(const Mt in Zt.style)Zt.style[Mt]}let Ut;(Ut=Zt&&Zt.onVnodeBeforeMount)&&invokeVNodeHook(Ut,me,he),Yt&&invokeDirectiveHook(he,null,me,"beforeMount"),((Ut=Zt&&Zt.onVnodeMounted)||Yt||Ct)&&queueEffectWithSuspense(()=>{Ut&&invokeVNodeHook(Ut,me,he),Ct&&ri.enter(le),Yt&&invokeDirectiveHook(he,null,me,"mounted")},ge)}return le.nextSibling},k=(le,he,me,ge,xt,Et,Lt)=>{Lt=Lt||!!he.dynamicChildren;const Zt=he.children,Ht=Zt.length;for(let It=0;It<Ht;It++){const Yt=Lt?Zt[It]:Zt[It]=normalizeVNode(Zt[It]),ri=Yt.type===Text;le?(ri&&!Lt&&It+1<Ht&&normalizeVNode(Zt[It+1]).type===Text&&(S(o(le.data.slice(Yt.children.length)),me,l(le)),le.data=Yt.children),le=z(le,Yt,ge,xt,Et,Lt)):ri&&!Yt.children?S(Yt.el=o(""),me):(isMismatchAllowed(me,1)||logMismatchError(),i(null,Yt,me,null,ge,xt,getContainerType(me),Et))}return le},Y=(le,he,me,ge,xt,Et)=>{const{slotScopeIds:Lt}=he;Lt&&(xt=xt?xt.concat(Lt):Lt);const Zt=d(le),Ht=k(l(le),he,Zt,me,ge,xt,Et);return Ht&&isComment(Ht)&&Ht.data==="]"?l(he.anchor=Ht):(logMismatchError(),S(he.anchor=C("]"),Zt,Ht),Ht)},ie=(le,he,me,ge,xt,Et)=>{if(isMismatchAllowed(le.parentElement,1)||logMismatchError(),he.el=null,Et){const Ht=ue(le);for(;;){const It=l(le);if(It&&It!==Ht)n(It);else break}}const Lt=l(le),Zt=d(le);return n(le),i(null,he,Zt,Lt,me,ge,getContainerType(Zt),xt),me&&(me.vnode.el=he.el,updateHOCHostEl(me,he.el)),Lt},ue=(le,he="[",me="]")=>{let ge=0;for(;le;)if(le=l(le),le&&isComment(le)&&(le.data===he&&ge++,le.data===me)){if(ge===0)return l(le);ge--}return le},ne=(le,he,me)=>{const ge=he.parentNode;ge&&ge.replaceChild(le,he);let xt=me;for(;xt;)xt.vnode.el===he&&(xt.vnode.el=xt.subTree.el=le),xt=xt.parent},se=le=>le.nodeType===1&&le.tagName==="TEMPLATE";return[I,z]}const allowMismatchAttr="data-allow-mismatch",MismatchTypeString={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function isMismatchAllowed(e,t){if(t===0||t===1)for(;e&&!e.hasAttribute(allowMismatchAttr);)e=e.parentElement;const i=e&&e.getAttribute(allowMismatchAttr);if(i==null)return!1;if(i==="")return!0;{const r=i.split(",");return t===0&&r.includes("children")?!0:i.split(",").includes(MismatchTypeString[t])}}getGlobalThis().requestIdleCallback;getGlobalThis().cancelIdleCallback;function forEachElement(e,t){if(isComment(e)&&e.data==="["){let i=1,r=e.nextSibling;for(;r;){if(r.nodeType===1){if(t(r)===!1)break}else if(isComment(r))if(r.data==="]"){if(--i===0)break}else r.data==="["&&i++;r=r.nextSibling}}else t(e)}const isAsyncWrapper=e=>!!e.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function defineAsyncComponent(e){isFunction(e)&&(e={loader:e});const{loader:t,loadingComponent:i,errorComponent:r,delay:o=200,hydrate:l,timeout:d,suspensible:n=!0,onError:S}=e;let C=null,I,z=0;const $=()=>(z++,C=null,k()),k=()=>{let Y;return C||(Y=C=t().catch(ie=>{if(ie=ie instanceof Error?ie:new Error(String(ie)),S)return new Promise((ue,ne)=>{S(ie,()=>ue($()),()=>ne(ie),z+1)});throw ie}).then(ie=>Y!==C&&C?C:(ie&&(ie.__esModule||ie[Symbol.toStringTag]==="Module")&&(ie=ie.default),I=ie,ie)))};return defineComponent({name:"AsyncComponentWrapper",__asyncLoader:k,__asyncHydrate(Y,ie,ue){const ne=l?()=>{const se=l(ue,le=>forEachElement(Y,le));se&&(ie.bum||(ie.bum=[])).push(se)}:ue;I?ne():k().then(()=>!ie.isUnmounted&&ne())},get __asyncResolved(){return I},setup(){const Y=currentInstance;if(markAsyncBoundary(Y),I)return()=>createInnerComp(I,Y);const ie=le=>{C=null,handleError(le,Y,13,!r)};if(n&&Y.suspense||isInSSRComponentSetup)return k().then(le=>()=>createInnerComp(le,Y)).catch(le=>(ie(le),()=>r?createVNode(r,{error:le}):null));const ue=ref(!1),ne=ref(),se=ref(!!o);return o&&setTimeout(()=>{se.value=!1},o),d!=null&&setTimeout(()=>{if(!ue.value&&!ne.value){const le=new Error(`Async component timed out after ${d}ms.`);ie(le),ne.value=le}},d),k().then(()=>{ue.value=!0,Y.parent&&isKeepAlive(Y.parent.vnode)&&Y.parent.update()}).catch(le=>{ie(le),ne.value=le}),()=>{if(ue.value&&I)return createInnerComp(I,Y);if(ne.value&&r)return createVNode(r,{error:ne.value});if(i&&!se.value)return createVNode(i)}}})}function createInnerComp(e,t){const{ref:i,props:r,children:o,ce:l}=t.vnode,d=createVNode(e,r,o);return d.ref=i,d.ce=l,delete t.vnode.ce,d}const isKeepAlive=e=>e.type.__isKeepAlive,KeepAliveImpl={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:t}){const i=getCurrentInstance(),r=i.ctx;if(!r.renderer)return()=>{const se=t.default&&t.default();return se&&se.length===1?se[0]:se};const o=new Map,l=new Set;let d=null;const n=i.suspense,{renderer:{p:S,m:C,um:I,o:{createElement:z}}}=r,$=z("div");r.activate=(se,le,he,me,ge)=>{const xt=se.component;C(se,le,he,0,n),S(xt.vnode,se,le,he,xt,n,me,se.slotScopeIds,ge),queuePostRenderEffect(()=>{xt.isDeactivated=!1,xt.a&&invokeArrayFns(xt.a);const Et=se.props&&se.props.onVnodeMounted;Et&&invokeVNodeHook(Et,xt.parent,se)},n)},r.deactivate=se=>{const le=se.component;invalidateMount(le.m),invalidateMount(le.a),C(se,$,null,1,n),queuePostRenderEffect(()=>{le.da&&invokeArrayFns(le.da);const he=se.props&&se.props.onVnodeUnmounted;he&&invokeVNodeHook(he,le.parent,se),le.isDeactivated=!0},n)};function k(se){resetShapeFlag(se),I(se,i,n,!0)}function Y(se){o.forEach((le,he)=>{const me=getComponentName(le.type);me&&!se(me)&&ie(he)})}function ie(se){const le=o.get(se);le&&(!d||!isSameVNodeType(le,d))?k(le):d&&resetShapeFlag(d),o.delete(se),l.delete(se)}watch$1(()=>[e.include,e.exclude],([se,le])=>{se&&Y(he=>matches$1(se,he)),le&&Y(he=>!matches$1(le,he))},{flush:"post",deep:!0});let ue=null;const ne=()=>{ue!=null&&(isSuspense(i.subTree.type)?queuePostRenderEffect(()=>{o.set(ue,getInnerChild(i.subTree))},i.subTree.suspense):o.set(ue,getInnerChild(i.subTree)))};return onMounted(ne),onUpdated(ne),onBeforeUnmount(()=>{o.forEach(se=>{const{subTree:le,suspense:he}=i,me=getInnerChild(le);if(se.type===me.type&&se.key===me.key){resetShapeFlag(me);const ge=me.component.da;ge&&queuePostRenderEffect(ge,he);return}k(se)})}),()=>{if(ue=null,!t.default)return d=null;const se=t.default(),le=se[0];if(se.length>1)return d=null,se;if(!isVNode(le)||!(le.shapeFlag&4)&&!(le.shapeFlag&128))return d=null,le;let he=getInnerChild(le);if(he.type===Comment)return d=null,he;const me=he.type,ge=getComponentName(isAsyncWrapper(he)?he.type.__asyncResolved||{}:me),{include:xt,exclude:Et,max:Lt}=e;if(xt&&(!ge||!matches$1(xt,ge))||Et&&ge&&matches$1(Et,ge))return he.shapeFlag&=-257,d=he,le;const Zt=he.key==null?me:he.key,Ht=o.get(Zt);return he.el&&(he=cloneVNode(he),le.shapeFlag&128&&(le.ssContent=he)),ue=Zt,Ht?(he.el=Ht.el,he.component=Ht.component,he.transition&&setTransitionHooks(he,he.transition),he.shapeFlag|=512,l.delete(Zt),l.add(Zt)):(l.add(Zt),Lt&&l.size>parseInt(Lt,10)&&ie(l.values().next().value)),he.shapeFlag|=256,d=he,isSuspense(le.type)?le:he}}},KeepAlive=KeepAliveImpl;function matches$1(e,t){return isArray$1(e)?e.some(i=>matches$1(i,t)):isString(e)?e.split(",").includes(t):isRegExp(e)?(e.lastIndex=0,e.test(t)):!1}function onActivated(e,t){registerKeepAliveHook(e,"a",t)}function onDeactivated(e,t){registerKeepAliveHook(e,"da",t)}function registerKeepAliveHook(e,t,i=currentInstance){const r=e.__wdc||(e.__wdc=()=>{let o=i;for(;o;){if(o.isDeactivated)return;o=o.parent}return e()});if(injectHook(t,r,i),i){let o=i.parent;for(;o&&o.parent;)isKeepAlive(o.parent.vnode)&&injectToKeepAliveRoot(r,t,i,o),o=o.parent}}function injectToKeepAliveRoot(e,t,i,r){const o=injectHook(t,e,r,!0);onUnmounted(()=>{remove(r[t],o)},i)}function resetShapeFlag(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function getInnerChild(e){return e.shapeFlag&128?e.ssContent:e}function injectHook(e,t,i=currentInstance,r=!1){if(i){const o=i[e]||(i[e]=[]),l=t.__weh||(t.__weh=(...d)=>{pauseTracking();const n=setCurrentInstance(i),S=callWithAsyncErrorHandling(t,i,e,d);return n(),resetTracking(),S});return r?o.unshift(l):o.push(l),l}}const createHook=e=>(t,i=currentInstance)=>{(!isInSSRComponentSetup||e==="sp")&&injectHook(e,(...r)=>t(...r),i)},onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(e,t=currentInstance){injectHook("ec",e,t)}const COMPONENTS="components";function resolveComponent(e,t){return resolveAsset(COMPONENTS,e,!0,t)||e}const NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveDynamicComponent(e){return isString(e)?resolveAsset(COMPONENTS,e,!1)||e:e||NULL_DYNAMIC_COMPONENT}function resolveAsset(e,t,i=!0,r=!1){const o=currentRenderingInstance||currentInstance;if(o){const l=o.type;{const n=getComponentName(l,!1);if(n&&(n===t||n===camelize(t)||n===capitalize(camelize(t))))return l}const d=resolve(o[e]||l[e],t)||resolve(o.appContext[e],t);return!d&&r?l:d}}function resolve(e,t){return e&&(e[t]||e[camelize(t)]||e[capitalize(camelize(t))])}function renderList(e,t,i,r){let o;const l=i,d=isArray$1(e);if(d||isString(e)){const n=d&&isReactive(e);let S=!1,C=!1;n&&(S=!isShallow(e),C=isReadonly(e),e=shallowReadArray(e)),o=new Array(e.length);for(let I=0,z=e.length;I<z;I++)o[I]=t(S?C?toReadonly(toReactive(e[I])):toReactive(e[I]):e[I],I,void 0,l)}else if(typeof e=="number"){o=new Array(e);for(let n=0;n<e;n++)o[n]=t(n+1,n,void 0,l)}else if(isObject$1(e))if(e[Symbol.iterator])o=Array.from(e,(n,S)=>t(n,S,void 0,l));else{const n=Object.keys(e);o=new Array(n.length);for(let S=0,C=n.length;S<C;S++){const I=n[S];o[S]=t(e[I],I,S,l)}}else o=[];return o}function renderSlot(e,t,i={},r,o){if(currentRenderingInstance.ce||currentRenderingInstance.parent&&isAsyncWrapper(currentRenderingInstance.parent)&&currentRenderingInstance.parent.ce)return openBlock(),createBlock(Fragment,null,[createVNode("slot",i,r)],64);let l=e[t];l&&l._c&&(l._d=!1),openBlock();const d=l&&ensureValidVNode(l(i)),n=i.key||d&&d.key,S=createBlock(Fragment,{key:(n&&!isSymbol(n)?n:`_${t}`)+""},d||[],d&&e._===1?64:-2);return S.scopeId&&(S.slotScopeIds=[S.scopeId+"-s"]),l&&l._c&&(l._d=!0),S}function ensureValidVNode(e){return e.some(t=>isVNode(t)?!(t.type===Comment||t.type===Fragment&&!ensureValidVNode(t.children)):!0)?e:null}const getPublicInstance=e=>e?isStatefulComponent(e)?getComponentPublicInstance(e):getPublicInstance(e.parent):null,publicPropertiesMap=extend$2(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>getPublicInstance(e.parent),$root:e=>getPublicInstance(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>resolveMergedOptions(e),$forceUpdate:e=>e.f||(e.f=()=>{queueJob(e.update)}),$nextTick:e=>e.n||(e.n=nextTick.bind(e.proxy)),$watch:e=>instanceWatch.bind(e)}),hasSetupBinding=(e,t)=>e!==EMPTY_OBJ&&!e.__isScriptSetup&&hasOwn(e,t),PublicInstanceProxyHandlers={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:i,setupState:r,data:o,props:l,accessCache:d,type:n,appContext:S}=e;let C;if(t[0]!=="$"){const k=d[t];if(k!==void 0)switch(k){case 1:return r[t];case 2:return o[t];case 4:return i[t];case 3:return l[t]}else{if(hasSetupBinding(r,t))return d[t]=1,r[t];if(o!==EMPTY_OBJ&&hasOwn(o,t))return d[t]=2,o[t];if((C=e.propsOptions[0])&&hasOwn(C,t))return d[t]=3,l[t];if(i!==EMPTY_OBJ&&hasOwn(i,t))return d[t]=4,i[t];shouldCacheAccess&&(d[t]=0)}}const I=publicPropertiesMap[t];let z,$;if(I)return t==="$attrs"&&track(e.attrs,"get",""),I(e);if((z=n.__cssModules)&&(z=z[t]))return z;if(i!==EMPTY_OBJ&&hasOwn(i,t))return d[t]=4,i[t];if($=S.config.globalProperties,hasOwn($,t))return $[t]},set({_:e},t,i){const{data:r,setupState:o,ctx:l}=e;return hasSetupBinding(o,t)?(o[t]=i,!0):r!==EMPTY_OBJ&&hasOwn(r,t)?(r[t]=i,!0):hasOwn(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(l[t]=i,!0)},has({_:{data:e,setupState:t,accessCache:i,ctx:r,appContext:o,propsOptions:l}},d){let n;return!!i[d]||e!==EMPTY_OBJ&&hasOwn(e,d)||hasSetupBinding(t,d)||(n=l[0])&&hasOwn(n,d)||hasOwn(r,d)||hasOwn(publicPropertiesMap,d)||hasOwn(o.config.globalProperties,d)},defineProperty(e,t,i){return i.get!=null?e._.accessCache[t]=0:hasOwn(i,"value")&&this.set(e,t,i.value,null),Reflect.defineProperty(e,t,i)}};function useAttrs(){return getContext$2().attrs}function getContext$2(){const e=getCurrentInstance();return e.setupContext||(e.setupContext=createSetupContext(e))}function normalizePropsOrEmits(e){return isArray$1(e)?e.reduce((t,i)=>(t[i]=null,t),{}):e}function withAsyncContext(e){const t=getCurrentInstance();let i=e();return unsetCurrentInstance(),isPromise(i)&&(i=i.catch(r=>{throw setCurrentInstance(t),r})),[i,()=>setCurrentInstance(t)]}let shouldCacheAccess=!0;function applyOptions(e){const t=resolveMergedOptions(e),i=e.proxy,r=e.ctx;shouldCacheAccess=!1,t.beforeCreate&&callHook$1(t.beforeCreate,e,"bc");const{data:o,computed:l,methods:d,watch:n,provide:S,inject:C,created:I,beforeMount:z,mounted:$,beforeUpdate:k,updated:Y,activated:ie,deactivated:ue,beforeDestroy:ne,beforeUnmount:se,destroyed:le,unmounted:he,render:me,renderTracked:ge,renderTriggered:xt,errorCaptured:Et,serverPrefetch:Lt,expose:Zt,inheritAttrs:Ht,components:It,directives:Yt,filters:ri}=t;if(C&&resolveInjections(C,r,null),d)for(const Ut in d){const Mt=d[Ut];isFunction(Mt)&&(r[Ut]=Mt.bind(i))}if(o){const Ut=o.call(i,i);isObject$1(Ut)&&(e.data=reactive(Ut))}if(shouldCacheAccess=!0,l)for(const Ut in l){const Mt=l[Ut],$t=isFunction(Mt)?Mt.bind(i,i):isFunction(Mt.get)?Mt.get.bind(i,i):NOOP,jt=!isFunction(Mt)&&isFunction(Mt.set)?Mt.set.bind(i):NOOP,mi=computed({get:$t,set:jt});Object.defineProperty(r,Ut,{enumerable:!0,configurable:!0,get:()=>mi.value,set:Xi=>mi.value=Xi})}if(n)for(const Ut in n)createWatcher(n[Ut],r,i,Ut);if(S){const Ut=isFunction(S)?S.call(i):S;Reflect.ownKeys(Ut).forEach(Mt=>{provide(Mt,Ut[Mt])})}I&&callHook$1(I,e,"c");function Ct(Ut,Mt){isArray$1(Mt)?Mt.forEach($t=>Ut($t.bind(i))):Mt&&Ut(Mt.bind(i))}if(Ct(onBeforeMount,z),Ct(onMounted,$),Ct(onBeforeUpdate,k),Ct(onUpdated,Y),Ct(onActivated,ie),Ct(onDeactivated,ue),Ct(onErrorCaptured,Et),Ct(onRenderTracked,ge),Ct(onRenderTriggered,xt),Ct(onBeforeUnmount,se),Ct(onUnmounted,he),Ct(onServerPrefetch,Lt),isArray$1(Zt))if(Zt.length){const Ut=e.exposed||(e.exposed={});Zt.forEach(Mt=>{Object.defineProperty(Ut,Mt,{get:()=>i[Mt],set:$t=>i[Mt]=$t})})}else e.exposed||(e.exposed={});me&&e.render===NOOP&&(e.render=me),Ht!=null&&(e.inheritAttrs=Ht),It&&(e.components=It),Yt&&(e.directives=Yt),Lt&&markAsyncBoundary(e)}function resolveInjections(e,t,i=NOOP){isArray$1(e)&&(e=normalizeInject(e));for(const r in e){const o=e[r];let l;isObject$1(o)?"default"in o?l=inject(o.from||r,o.default,!0):l=inject(o.from||r):l=inject(o),isRef(l)?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>l.value,set:d=>l.value=d}):t[r]=l}}function callHook$1(e,t,i){callWithAsyncErrorHandling(isArray$1(e)?e.map(r=>r.bind(t.proxy)):e.bind(t.proxy),t,i)}function createWatcher(e,t,i,r){let o=r.includes(".")?createPathGetter(i,r):()=>i[r];if(isString(e)){const l=t[e];isFunction(l)&&watch$1(o,l)}else if(isFunction(e))watch$1(o,e.bind(i));else if(isObject$1(e))if(isArray$1(e))e.forEach(l=>createWatcher(l,t,i,r));else{const l=isFunction(e.handler)?e.handler.bind(i):t[e.handler];isFunction(l)&&watch$1(o,l,e)}}function resolveMergedOptions(e){const t=e.type,{mixins:i,extends:r}=t,{mixins:o,optionsCache:l,config:{optionMergeStrategies:d}}=e.appContext,n=l.get(t);let S;return n?S=n:!o.length&&!i&&!r?S=t:(S={},o.length&&o.forEach(C=>mergeOptions$1(S,C,d,!0)),mergeOptions$1(S,t,d)),isObject$1(t)&&l.set(t,S),S}function mergeOptions$1(e,t,i,r=!1){const{mixins:o,extends:l}=t;l&&mergeOptions$1(e,l,i,!0),o&&o.forEach(d=>mergeOptions$1(e,d,i,!0));for(const d in t)if(!(r&&d==="expose")){const n=internalOptionMergeStrats[d]||i&&i[d];e[d]=n?n(e[d],t[d]):t[d]}return e}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(e,t){return t?e?function(){return extend$2(isFunction(e)?e.call(this,this):e,isFunction(t)?t.call(this,this):t)}:t:e}function mergeInject(e,t){return mergeObjectOptions(normalizeInject(e),normalizeInject(t))}function normalizeInject(e){if(isArray$1(e)){const t={};for(let i=0;i<e.length;i++)t[e[i]]=e[i];return t}return e}function mergeAsArray(e,t){return e?[...new Set([].concat(e,t))]:t}function mergeObjectOptions(e,t){return e?extend$2(Object.create(null),e,t):t}function mergeEmitsOrPropsOptions(e,t){return e?isArray$1(e)&&isArray$1(t)?[...new Set([...e,...t])]:extend$2(Object.create(null),normalizePropsOrEmits(e),normalizePropsOrEmits(t??{})):t}function mergeWatchOptions(e,t){if(!e)return t;if(!t)return e;const i=extend$2(Object.create(null),e);for(const r in t)i[r]=mergeAsArray(e[r],t[r]);return i}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(e,t){return function(r,o=null){isFunction(r)||(r=extend$2({},r)),o!=null&&!isObject$1(o)&&(o=null);const l=createAppContext(),d=new WeakSet,n=[];let S=!1;const C=l.app={_uid:uid$1++,_component:r,_props:o,_container:null,_context:l,_instance:null,version:version$1,get config(){return l.config},set config(I){},use(I,...z){return d.has(I)||(I&&isFunction(I.install)?(d.add(I),I.install(C,...z)):isFunction(I)&&(d.add(I),I(C,...z))),C},mixin(I){return l.mixins.includes(I)||l.mixins.push(I),C},component(I,z){return z?(l.components[I]=z,C):l.components[I]},directive(I,z){return z?(l.directives[I]=z,C):l.directives[I]},mount(I,z,$){if(!S){const k=C._ceVNode||createVNode(r,o);return k.appContext=l,$===!0?$="svg":$===!1&&($=void 0),z&&t?t(k,I):e(k,I,$),S=!0,C._container=I,I.__vue_app__=C,getComponentPublicInstance(k.component)}},onUnmount(I){n.push(I)},unmount(){S&&(callWithAsyncErrorHandling(n,C._instance,16),e(null,C._container),delete C._container.__vue_app__)},provide(I,z){return l.provides[I]=z,C},runWithContext(I){const z=currentApp;currentApp=C;try{return I()}finally{currentApp=z}}};return C}}let currentApp=null;function provide(e,t){if(currentInstance){let i=currentInstance.provides;const r=currentInstance.parent&&currentInstance.parent.provides;r===i&&(i=currentInstance.provides=Object.create(r)),i[e]=t}}function inject(e,t,i=!1){const r=currentInstance||currentRenderingInstance;if(r||currentApp){const o=currentApp?currentApp._context.provides:r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return i&&isFunction(t)?t.call(r&&r.proxy):t}}function hasInjectionContext(){return!!(currentInstance||currentRenderingInstance||currentApp)}const internalObjectProto={},createInternalObject=()=>Object.create(internalObjectProto),isInternalObject=e=>Object.getPrototypeOf(e)===internalObjectProto;function initProps(e,t,i,r=!1){const o={},l=createInternalObject();e.propsDefaults=Object.create(null),setFullProps(e,t,o,l);for(const d in e.propsOptions[0])d in o||(o[d]=void 0);i?e.props=r?o:shallowReactive(o):e.type.props?e.props=o:e.props=l,e.attrs=l}function updateProps(e,t,i,r){const{props:o,attrs:l,vnode:{patchFlag:d}}=e,n=toRaw(o),[S]=e.propsOptions;let C=!1;if((r||d>0)&&!(d&16)){if(d&8){const I=e.vnode.dynamicProps;for(let z=0;z<I.length;z++){let $=I[z];if(isEmitListener(e.emitsOptions,$))continue;const k=t[$];if(S)if(hasOwn(l,$))k!==l[$]&&(l[$]=k,C=!0);else{const Y=camelize($);o[Y]=resolvePropValue(S,n,Y,k,e,!1)}else k!==l[$]&&(l[$]=k,C=!0)}}}else{setFullProps(e,t,o,l)&&(C=!0);let I;for(const z in n)(!t||!hasOwn(t,z)&&((I=hyphenate(z))===z||!hasOwn(t,I)))&&(S?i&&(i[z]!==void 0||i[I]!==void 0)&&(o[z]=resolvePropValue(S,n,z,void 0,e,!0)):delete o[z]);if(l!==n)for(const z in l)(!t||!hasOwn(t,z))&&(delete l[z],C=!0)}C&&trigger(e.attrs,"set","")}function setFullProps(e,t,i,r){const[o,l]=e.propsOptions;let d=!1,n;if(t)for(let S in t){if(isReservedProp(S))continue;const C=t[S];let I;o&&hasOwn(o,I=camelize(S))?!l||!l.includes(I)?i[I]=C:(n||(n={}))[I]=C:isEmitListener(e.emitsOptions,S)||(!(S in r)||C!==r[S])&&(r[S]=C,d=!0)}if(l){const S=toRaw(i),C=n||EMPTY_OBJ;for(let I=0;I<l.length;I++){const z=l[I];i[z]=resolvePropValue(o,S,z,C[z],e,!hasOwn(C,z))}}return d}function resolvePropValue(e,t,i,r,o,l){const d=e[i];if(d!=null){const n=hasOwn(d,"default");if(n&&r===void 0){const S=d.default;if(d.type!==Function&&!d.skipFactory&&isFunction(S)){const{propsDefaults:C}=o;if(i in C)r=C[i];else{const I=setCurrentInstance(o);r=C[i]=S.call(null,t),I()}}else r=S;o.ce&&o.ce._setProp(i,r)}d[0]&&(l&&!n?r=!1:d[1]&&(r===""||r===hyphenate(i))&&(r=!0))}return r}const mixinPropsCache=new WeakMap;function normalizePropsOptions(e,t,i=!1){const r=i?mixinPropsCache:t.propsCache,o=r.get(e);if(o)return o;const l=e.props,d={},n=[];let S=!1;if(!isFunction(e)){const I=z=>{S=!0;const[$,k]=normalizePropsOptions(z,t,!0);extend$2(d,$),k&&n.push(...k)};!i&&t.mixins.length&&t.mixins.forEach(I),e.extends&&I(e.extends),e.mixins&&e.mixins.forEach(I)}if(!l&&!S)return isObject$1(e)&&r.set(e,EMPTY_ARR),EMPTY_ARR;if(isArray$1(l))for(let I=0;I<l.length;I++){const z=camelize(l[I]);validatePropName(z)&&(d[z]=EMPTY_OBJ)}else if(l)for(const I in l){const z=camelize(I);if(validatePropName(z)){const $=l[I],k=d[z]=isArray$1($)||isFunction($)?{type:$}:extend$2({},$),Y=k.type;let ie=!1,ue=!0;if(isArray$1(Y))for(let ne=0;ne<Y.length;++ne){const se=Y[ne],le=isFunction(se)&&se.name;if(le==="Boolean"){ie=!0;break}else le==="String"&&(ue=!1)}else ie=isFunction(Y)&&Y.name==="Boolean";k[0]=ie,k[1]=ue,(ie||hasOwn(k,"default"))&&n.push(z)}}const C=[d,n];return isObject$1(e)&&r.set(e,C),C}function validatePropName(e){return e[0]!=="$"&&!isReservedProp(e)}const isInternalKey=e=>e[0]==="_"||e==="$stable",normalizeSlotValue=e=>isArray$1(e)?e.map(normalizeVNode):[normalizeVNode(e)],normalizeSlot$2=(e,t,i)=>{if(t._n)return t;const r=withCtx((...o)=>normalizeSlotValue(t(...o)),i);return r._c=!1,r},normalizeObjectSlots=(e,t,i)=>{const r=e._ctx;for(const o in e){if(isInternalKey(o))continue;const l=e[o];if(isFunction(l))t[o]=normalizeSlot$2(o,l,r);else if(l!=null){const d=normalizeSlotValue(l);t[o]=()=>d}}},normalizeVNodeSlots=(e,t)=>{const i=normalizeSlotValue(t);e.slots.default=()=>i},assignSlots=(e,t,i)=>{for(const r in t)(i||!isInternalKey(r))&&(e[r]=t[r])},initSlots=(e,t,i)=>{const r=e.slots=createInternalObject();if(e.vnode.shapeFlag&32){const o=t._;o?(assignSlots(r,t,i),i&&def(r,"_",o,!0)):normalizeObjectSlots(t,r)}else t&&normalizeVNodeSlots(e,t)},updateSlots=(e,t,i)=>{const{vnode:r,slots:o}=e;let l=!0,d=EMPTY_OBJ;if(r.shapeFlag&32){const n=t._;n?i&&n===1?l=!1:assignSlots(o,t,i):(l=!t.$stable,normalizeObjectSlots(t,o)),d=t}else t&&(normalizeVNodeSlots(e,t),d={default:1});if(l)for(const n in o)!isInternalKey(n)&&d[n]==null&&delete o[n]},queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(e){return baseCreateRenderer(e)}function createHydrationRenderer(e){return baseCreateRenderer(e,createHydrationFunctions)}function baseCreateRenderer(e,t){const i=getGlobalThis();i.__VUE__=!0;const{insert:r,remove:o,patchProp:l,createElement:d,createText:n,createComment:S,setText:C,setElementText:I,parentNode:z,nextSibling:$,setScopeId:k=NOOP,insertStaticContent:Y}=e,ie=(kt,Nt,gi,Ri=null,Rt=null,Xt=null,Hi=void 0,Ni=null,xi=!!Nt.dynamicChildren)=>{if(kt===Nt)return;kt&&!isSameVNodeType(kt,Nt)&&(Ri=Gt(kt),Xi(kt,Rt,Xt,!0),kt=null),Nt.patchFlag===-2&&(xi=!1,Nt.dynamicChildren=null);const{type:$i,ref:fr,shapeFlag:ir}=Nt;switch($i){case Text:ue(kt,Nt,gi,Ri);break;case Comment:ne(kt,Nt,gi,Ri);break;case Static:kt==null&&se(Nt,gi,Ri,Hi);break;case Fragment:It(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi);break;default:ir&1?me(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi):ir&6?Yt(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi):(ir&64||ir&128)&&$i.process(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi,Si)}fr!=null&&Rt&&setRef(fr,kt&&kt.ref,Xt,Nt||kt,!Nt)},ue=(kt,Nt,gi,Ri)=>{if(kt==null)r(Nt.el=n(Nt.children),gi,Ri);else{const Rt=Nt.el=kt.el;Nt.children!==kt.children&&C(Rt,Nt.children)}},ne=(kt,Nt,gi,Ri)=>{kt==null?r(Nt.el=S(Nt.children||""),gi,Ri):Nt.el=kt.el},se=(kt,Nt,gi,Ri)=>{[kt.el,kt.anchor]=Y(kt.children,Nt,gi,Ri,kt.el,kt.anchor)},le=({el:kt,anchor:Nt},gi,Ri)=>{let Rt;for(;kt&&kt!==Nt;)Rt=$(kt),r(kt,gi,Ri),kt=Rt;r(Nt,gi,Ri)},he=({el:kt,anchor:Nt})=>{let gi;for(;kt&&kt!==Nt;)gi=$(kt),o(kt),kt=gi;o(Nt)},me=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi)=>{Nt.type==="svg"?Hi="svg":Nt.type==="math"&&(Hi="mathml"),kt==null?ge(Nt,gi,Ri,Rt,Xt,Hi,Ni,xi):Lt(kt,Nt,Rt,Xt,Hi,Ni,xi)},ge=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni)=>{let xi,$i;const{props:fr,shapeFlag:ir,transition:lr,dirs:Tr}=kt;if(xi=kt.el=d(kt.type,Xt,fr&&fr.is,fr),ir&8?I(xi,kt.children):ir&16&&Et(kt.children,xi,null,Ri,Rt,resolveChildrenNamespace(kt,Xt),Hi,Ni),Tr&&invokeDirectiveHook(kt,null,Ri,"created"),xt(xi,kt,kt.scopeId,Hi,Ri),fr){for(const Jr in fr)Jr!=="value"&&!isReservedProp(Jr)&&l(xi,Jr,null,fr[Jr],Xt,Ri);"value"in fr&&l(xi,"value",null,fr.value,Xt),($i=fr.onVnodeBeforeMount)&&invokeVNodeHook($i,Ri,kt)}Tr&&invokeDirectiveHook(kt,null,Ri,"beforeMount");const Rr=needTransition(Rt,lr);Rr&&lr.beforeEnter(xi),r(xi,Nt,gi),(($i=fr&&fr.onVnodeMounted)||Rr||Tr)&&queuePostRenderEffect(()=>{$i&&invokeVNodeHook($i,Ri,kt),Rr&&lr.enter(xi),Tr&&invokeDirectiveHook(kt,null,Ri,"mounted")},Rt)},xt=(kt,Nt,gi,Ri,Rt)=>{if(gi&&k(kt,gi),Ri)for(let Xt=0;Xt<Ri.length;Xt++)k(kt,Ri[Xt]);if(Rt){let Xt=Rt.subTree;if(Nt===Xt||isSuspense(Xt.type)&&(Xt.ssContent===Nt||Xt.ssFallback===Nt)){const Hi=Rt.vnode;xt(kt,Hi,Hi.scopeId,Hi.slotScopeIds,Rt.parent)}}},Et=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi=0)=>{for(let $i=xi;$i<kt.length;$i++){const fr=kt[$i]=Ni?cloneIfMounted(kt[$i]):normalizeVNode(kt[$i]);ie(null,fr,Nt,gi,Ri,Rt,Xt,Hi,Ni)}},Lt=(kt,Nt,gi,Ri,Rt,Xt,Hi)=>{const Ni=Nt.el=kt.el;let{patchFlag:xi,dynamicChildren:$i,dirs:fr}=Nt;xi|=kt.patchFlag&16;const ir=kt.props||EMPTY_OBJ,lr=Nt.props||EMPTY_OBJ;let Tr;if(gi&&toggleRecurse(gi,!1),(Tr=lr.onVnodeBeforeUpdate)&&invokeVNodeHook(Tr,gi,Nt,kt),fr&&invokeDirectiveHook(Nt,kt,gi,"beforeUpdate"),gi&&toggleRecurse(gi,!0),(ir.innerHTML&&lr.innerHTML==null||ir.textContent&&lr.textContent==null)&&I(Ni,""),$i?Zt(kt.dynamicChildren,$i,Ni,gi,Ri,resolveChildrenNamespace(Nt,Rt),Xt):Hi||Mt(kt,Nt,Ni,null,gi,Ri,resolveChildrenNamespace(Nt,Rt),Xt,!1),xi>0){if(xi&16)Ht(Ni,ir,lr,gi,Rt);else if(xi&2&&ir.class!==lr.class&&l(Ni,"class",null,lr.class,Rt),xi&4&&l(Ni,"style",ir.style,lr.style,Rt),xi&8){const Rr=Nt.dynamicProps;for(let Jr=0;Jr<Rr.length;Jr++){const _r=Rr[Jr],mr=ir[_r],wr=lr[_r];(wr!==mr||_r==="value")&&l(Ni,_r,mr,wr,Rt,gi)}}xi&1&&kt.children!==Nt.children&&I(Ni,Nt.children)}else!Hi&&$i==null&&Ht(Ni,ir,lr,gi,Rt);((Tr=lr.onVnodeUpdated)||fr)&&queuePostRenderEffect(()=>{Tr&&invokeVNodeHook(Tr,gi,Nt,kt),fr&&invokeDirectiveHook(Nt,kt,gi,"updated")},Ri)},Zt=(kt,Nt,gi,Ri,Rt,Xt,Hi)=>{for(let Ni=0;Ni<Nt.length;Ni++){const xi=kt[Ni],$i=Nt[Ni],fr=xi.el&&(xi.type===Fragment||!isSameVNodeType(xi,$i)||xi.shapeFlag&70)?z(xi.el):gi;ie(xi,$i,fr,null,Ri,Rt,Xt,Hi,!0)}},Ht=(kt,Nt,gi,Ri,Rt)=>{if(Nt!==gi){if(Nt!==EMPTY_OBJ)for(const Xt in Nt)!isReservedProp(Xt)&&!(Xt in gi)&&l(kt,Xt,Nt[Xt],null,Rt,Ri);for(const Xt in gi){if(isReservedProp(Xt))continue;const Hi=gi[Xt],Ni=Nt[Xt];Hi!==Ni&&Xt!=="value"&&l(kt,Xt,Ni,Hi,Rt,Ri)}"value"in gi&&l(kt,"value",Nt.value,gi.value,Rt)}},It=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi)=>{const $i=Nt.el=kt?kt.el:n(""),fr=Nt.anchor=kt?kt.anchor:n("");let{patchFlag:ir,dynamicChildren:lr,slotScopeIds:Tr}=Nt;Tr&&(Ni=Ni?Ni.concat(Tr):Tr),kt==null?(r($i,gi,Ri),r(fr,gi,Ri),Et(Nt.children||[],gi,fr,Rt,Xt,Hi,Ni,xi)):ir>0&&ir&64&&lr&&kt.dynamicChildren?(Zt(kt.dynamicChildren,lr,gi,Rt,Xt,Hi,Ni),(Nt.key!=null||Rt&&Nt===Rt.subTree)&&traverseStaticChildren(kt,Nt,!0)):Mt(kt,Nt,gi,fr,Rt,Xt,Hi,Ni,xi)},Yt=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi)=>{Nt.slotScopeIds=Ni,kt==null?Nt.shapeFlag&512?Rt.ctx.activate(Nt,gi,Ri,Hi,xi):ri(Nt,gi,Ri,Rt,Xt,Hi,xi):ei(kt,Nt,xi)},ri=(kt,Nt,gi,Ri,Rt,Xt,Hi)=>{const Ni=kt.component=createComponentInstance(kt,Ri,Rt);if(isKeepAlive(kt)&&(Ni.ctx.renderer=Si),setupComponent(Ni,!1,Hi),Ni.asyncDep){if(Rt&&Rt.registerDep(Ni,Ct,Hi),!kt.el){const xi=Ni.subTree=createVNode(Comment);ne(null,xi,Nt,gi)}}else Ct(Ni,kt,Nt,gi,Rt,Xt,Hi)},ei=(kt,Nt,gi)=>{const Ri=Nt.component=kt.component;if(shouldUpdateComponent(kt,Nt,gi))if(Ri.asyncDep&&!Ri.asyncResolved){Ut(Ri,Nt,gi);return}else Ri.next=Nt,Ri.update();else Nt.el=kt.el,Ri.vnode=Nt},Ct=(kt,Nt,gi,Ri,Rt,Xt,Hi)=>{const Ni=()=>{if(kt.isMounted){let{next:ir,bu:lr,u:Tr,parent:Rr,vnode:Jr}=kt;{const wn=locateNonHydratedAsyncRoot(kt);if(wn){ir&&(ir.el=Jr.el,Ut(kt,ir,Hi)),wn.asyncDep.then(()=>{kt.isUnmounted||Ni()});return}}let _r=ir,mr;toggleRecurse(kt,!1),ir?(ir.el=Jr.el,Ut(kt,ir,Hi)):ir=Jr,lr&&invokeArrayFns(lr),(mr=ir.props&&ir.props.onVnodeBeforeUpdate)&&invokeVNodeHook(mr,Rr,ir,Jr),toggleRecurse(kt,!0);const wr=renderComponentRoot(kt),Vr=kt.subTree;kt.subTree=wr,ie(Vr,wr,z(Vr.el),Gt(Vr),kt,Rt,Xt),ir.el=wr.el,_r===null&&updateHOCHostEl(kt,wr.el),Tr&&queuePostRenderEffect(Tr,Rt),(mr=ir.props&&ir.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(mr,Rr,ir,Jr),Rt)}else{let ir;const{el:lr,props:Tr}=Nt,{bm:Rr,m:Jr,parent:_r,root:mr,type:wr}=kt,Vr=isAsyncWrapper(Nt);if(toggleRecurse(kt,!1),Rr&&invokeArrayFns(Rr),!Vr&&(ir=Tr&&Tr.onVnodeBeforeMount)&&invokeVNodeHook(ir,_r,Nt),toggleRecurse(kt,!0),lr&&Mi){const wn=()=>{kt.subTree=renderComponentRoot(kt),Mi(lr,kt.subTree,kt,Rt,null)};Vr&&wr.__asyncHydrate?wr.__asyncHydrate(lr,kt,wn):wn()}else{mr.ce&&mr.ce._injectChildStyle(wr);const wn=kt.subTree=renderComponentRoot(kt);ie(null,wn,gi,Ri,kt,Rt,Xt),Nt.el=wn.el}if(Jr&&queuePostRenderEffect(Jr,Rt),!Vr&&(ir=Tr&&Tr.onVnodeMounted)){const wn=Nt;queuePostRenderEffect(()=>invokeVNodeHook(ir,_r,wn),Rt)}(Nt.shapeFlag&256||_r&&isAsyncWrapper(_r.vnode)&&_r.vnode.shapeFlag&256)&&kt.a&&queuePostRenderEffect(kt.a,Rt),kt.isMounted=!0,Nt=gi=Ri=null}};kt.scope.on();const xi=kt.effect=new ReactiveEffect(Ni);kt.scope.off();const $i=kt.update=xi.run.bind(xi),fr=kt.job=xi.runIfDirty.bind(xi);fr.i=kt,fr.id=kt.uid,xi.scheduler=()=>queueJob(fr),toggleRecurse(kt,!0),$i()},Ut=(kt,Nt,gi)=>{Nt.component=kt;const Ri=kt.vnode.props;kt.vnode=Nt,kt.next=null,updateProps(kt,Nt.props,Ri,gi),updateSlots(kt,Nt.children,gi),pauseTracking(),flushPreFlushCbs(kt),resetTracking()},Mt=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi=!1)=>{const $i=kt&&kt.children,fr=kt?kt.shapeFlag:0,ir=Nt.children,{patchFlag:lr,shapeFlag:Tr}=Nt;if(lr>0){if(lr&128){jt($i,ir,gi,Ri,Rt,Xt,Hi,Ni,xi);return}else if(lr&256){$t($i,ir,gi,Ri,Rt,Xt,Hi,Ni,xi);return}}Tr&8?(fr&16&&si($i,Rt,Xt),ir!==$i&&I(gi,ir)):fr&16?Tr&16?jt($i,ir,gi,Ri,Rt,Xt,Hi,Ni,xi):si($i,Rt,Xt,!0):(fr&8&&I(gi,""),Tr&16&&Et(ir,gi,Ri,Rt,Xt,Hi,Ni,xi))},$t=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi)=>{kt=kt||EMPTY_ARR,Nt=Nt||EMPTY_ARR;const $i=kt.length,fr=Nt.length,ir=Math.min($i,fr);let lr;for(lr=0;lr<ir;lr++){const Tr=Nt[lr]=xi?cloneIfMounted(Nt[lr]):normalizeVNode(Nt[lr]);ie(kt[lr],Tr,gi,null,Rt,Xt,Hi,Ni,xi)}$i>fr?si(kt,Rt,Xt,!0,!1,ir):Et(Nt,gi,Ri,Rt,Xt,Hi,Ni,xi,ir)},jt=(kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi)=>{let $i=0;const fr=Nt.length;let ir=kt.length-1,lr=fr-1;for(;$i<=ir&&$i<=lr;){const Tr=kt[$i],Rr=Nt[$i]=xi?cloneIfMounted(Nt[$i]):normalizeVNode(Nt[$i]);if(isSameVNodeType(Tr,Rr))ie(Tr,Rr,gi,null,Rt,Xt,Hi,Ni,xi);else break;$i++}for(;$i<=ir&&$i<=lr;){const Tr=kt[ir],Rr=Nt[lr]=xi?cloneIfMounted(Nt[lr]):normalizeVNode(Nt[lr]);if(isSameVNodeType(Tr,Rr))ie(Tr,Rr,gi,null,Rt,Xt,Hi,Ni,xi);else break;ir--,lr--}if($i>ir){if($i<=lr){const Tr=lr+1,Rr=Tr<fr?Nt[Tr].el:Ri;for(;$i<=lr;)ie(null,Nt[$i]=xi?cloneIfMounted(Nt[$i]):normalizeVNode(Nt[$i]),gi,Rr,Rt,Xt,Hi,Ni,xi),$i++}}else if($i>lr)for(;$i<=ir;)Xi(kt[$i],Rt,Xt,!0),$i++;else{const Tr=$i,Rr=$i,Jr=new Map;for($i=Rr;$i<=lr;$i++){const es=Nt[$i]=xi?cloneIfMounted(Nt[$i]):normalizeVNode(Nt[$i]);es.key!=null&&Jr.set(es.key,$i)}let _r,mr=0;const wr=lr-Rr+1;let Vr=!1,wn=0;const Nn=new Array(wr);for($i=0;$i<wr;$i++)Nn[$i]=0;for($i=Tr;$i<=ir;$i++){const es=kt[$i];if(mr>=wr){Xi(es,Rt,Xt,!0);continue}let As;if(es.key!=null)As=Jr.get(es.key);else for(_r=Rr;_r<=lr;_r++)if(Nn[_r-Rr]===0&&isSameVNodeType(es,Nt[_r])){As=_r;break}As===void 0?Xi(es,Rt,Xt,!0):(Nn[As-Rr]=$i+1,As>=wn?wn=As:Vr=!0,ie(es,Nt[As],gi,null,Rt,Xt,Hi,Ni,xi),mr++)}const zs=Vr?getSequence(Nn):EMPTY_ARR;for(_r=zs.length-1,$i=wr-1;$i>=0;$i--){const es=Rr+$i,As=Nt[es],Dn=es+1<fr?Nt[es+1].el:Ri;Nn[$i]===0?ie(null,As,gi,Dn,Rt,Xt,Hi,Ni,xi):Vr&&(_r<0||$i!==zs[_r]?mi(As,gi,Dn,2):_r--)}}},mi=(kt,Nt,gi,Ri,Rt=null)=>{const{el:Xt,type:Hi,transition:Ni,children:xi,shapeFlag:$i}=kt;if($i&6){mi(kt.component.subTree,Nt,gi,Ri);return}if($i&128){kt.suspense.move(Nt,gi,Ri);return}if($i&64){Hi.move(kt,Nt,gi,Si);return}if(Hi===Fragment){r(Xt,Nt,gi);for(let ir=0;ir<xi.length;ir++)mi(xi[ir],Nt,gi,Ri);r(kt.anchor,Nt,gi);return}if(Hi===Static){le(kt,Nt,gi);return}if(Ri!==2&&$i&1&&Ni)if(Ri===0)Ni.beforeEnter(Xt),r(Xt,Nt,gi),queuePostRenderEffect(()=>Ni.enter(Xt),Rt);else{const{leave:ir,delayLeave:lr,afterLeave:Tr}=Ni,Rr=()=>{kt.ctx.isUnmounted?o(Xt):r(Xt,Nt,gi)},Jr=()=>{ir(Xt,()=>{Rr(),Tr&&Tr()})};lr?lr(Xt,Rr,Jr):Jr()}else r(Xt,Nt,gi)},Xi=(kt,Nt,gi,Ri=!1,Rt=!1)=>{const{type:Xt,props:Hi,ref:Ni,children:xi,dynamicChildren:$i,shapeFlag:fr,patchFlag:ir,dirs:lr,cacheIndex:Tr}=kt;if(ir===-2&&(Rt=!1),Ni!=null&&(pauseTracking(),setRef(Ni,null,gi,kt,!0),resetTracking()),Tr!=null&&(Nt.renderCache[Tr]=void 0),fr&256){Nt.ctx.deactivate(kt);return}const Rr=fr&1&&lr,Jr=!isAsyncWrapper(kt);let _r;if(Jr&&(_r=Hi&&Hi.onVnodeBeforeUnmount)&&invokeVNodeHook(_r,Nt,kt),fr&6)nr(kt.component,gi,Ri);else{if(fr&128){kt.suspense.unmount(gi,Ri);return}Rr&&invokeDirectiveHook(kt,null,Nt,"beforeUnmount"),fr&64?kt.type.remove(kt,Nt,gi,Si,Ri):$i&&!$i.hasOnce&&(Xt!==Fragment||ir>0&&ir&64)?si($i,Nt,gi,!1,!0):(Xt===Fragment&&ir&384||!Rt&&fr&16)&&si(xi,Nt,gi),Ri&&Er(kt)}(Jr&&(_r=Hi&&Hi.onVnodeUnmounted)||Rr)&&queuePostRenderEffect(()=>{_r&&invokeVNodeHook(_r,Nt,kt),Rr&&invokeDirectiveHook(kt,null,Nt,"unmounted")},gi)},Er=kt=>{const{type:Nt,el:gi,anchor:Ri,transition:Rt}=kt;if(Nt===Fragment){Ir(gi,Ri);return}if(Nt===Static){he(kt);return}const Xt=()=>{o(gi),Rt&&!Rt.persisted&&Rt.afterLeave&&Rt.afterLeave()};if(kt.shapeFlag&1&&Rt&&!Rt.persisted){const{leave:Hi,delayLeave:Ni}=Rt,xi=()=>Hi(gi,Xt);Ni?Ni(kt.el,Xt,xi):xi()}else Xt()},Ir=(kt,Nt)=>{let gi;for(;kt!==Nt;)gi=$(kt),o(kt),kt=gi;o(Nt)},nr=(kt,Nt,gi)=>{const{bum:Ri,scope:Rt,job:Xt,subTree:Hi,um:Ni,m:xi,a:$i,parent:fr,slots:{__:ir}}=kt;invalidateMount(xi),invalidateMount($i),Ri&&invokeArrayFns(Ri),fr&&isArray$1(ir)&&ir.forEach(lr=>{fr.renderCache[lr]=void 0}),Rt.stop(),Xt&&(Xt.flags|=8,Xi(Hi,kt,Nt,gi)),Ni&&queuePostRenderEffect(Ni,Nt),queuePostRenderEffect(()=>{kt.isUnmounted=!0},Nt),Nt&&Nt.pendingBranch&&!Nt.isUnmounted&&kt.asyncDep&&!kt.asyncResolved&&kt.suspenseId===Nt.pendingId&&(Nt.deps--,Nt.deps===0&&Nt.resolve())},si=(kt,Nt,gi,Ri=!1,Rt=!1,Xt=0)=>{for(let Hi=Xt;Hi<kt.length;Hi++)Xi(kt[Hi],Nt,gi,Ri,Rt)},Gt=kt=>{if(kt.shapeFlag&6)return Gt(kt.component.subTree);if(kt.shapeFlag&128)return kt.suspense.next();const Nt=$(kt.anchor||kt.el),gi=Nt&&Nt[TeleportEndKey];return gi?$(gi):Nt};let ui=!1;const oi=(kt,Nt,gi)=>{kt==null?Nt._vnode&&Xi(Nt._vnode,null,null,!0):ie(Nt._vnode||null,kt,Nt,null,null,null,gi),Nt._vnode=kt,ui||(ui=!0,flushPreFlushCbs(),flushPostFlushCbs(),ui=!1)},Si={p:ie,um:Xi,m:mi,r:Er,mt:ri,mc:Et,pc:Mt,pbc:Zt,n:Gt,o:e};let Li,Mi;return t&&([Li,Mi]=t(Si)),{render:oi,hydrate:Li,createApp:createAppAPI(oi,Li)}}function resolveChildrenNamespace({type:e,props:t},i){return i==="svg"&&e==="foreignObject"||i==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:i}function toggleRecurse({effect:e,job:t},i){i?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function needTransition(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function traverseStaticChildren(e,t,i=!1){const r=e.children,o=t.children;if(isArray$1(r)&&isArray$1(o))for(let l=0;l<r.length;l++){const d=r[l];let n=o[l];n.shapeFlag&1&&!n.dynamicChildren&&((n.patchFlag<=0||n.patchFlag===32)&&(n=o[l]=cloneIfMounted(o[l]),n.el=d.el),!i&&n.patchFlag!==-2&&traverseStaticChildren(d,n)),n.type===Text&&(n.el=d.el),n.type===Comment&&!n.el&&(n.el=d.el)}}function getSequence(e){const t=e.slice(),i=[0];let r,o,l,d,n;const S=e.length;for(r=0;r<S;r++){const C=e[r];if(C!==0){if(o=i[i.length-1],e[o]<C){t[r]=o,i.push(r);continue}for(l=0,d=i.length-1;l<d;)n=l+d>>1,e[i[n]]<C?l=n+1:d=n;C<e[i[l]]&&(l>0&&(t[r]=i[l-1]),i[l]=r)}}for(l=i.length,d=i[l-1];l-- >0;)i[l]=d,d=t[d];return i}function locateNonHydratedAsyncRoot(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:locateNonHydratedAsyncRoot(t)}function invalidateMount(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject(ssrContextKey);function watchEffect(e,t){return doWatch(e,null,t)}function watch$1(e,t,i){return doWatch(e,t,i)}function doWatch(e,t,i=EMPTY_OBJ){const{immediate:r,deep:o,flush:l,once:d}=i,n=extend$2({},i),S=t&&r||!t&&l!=="post";let C;if(isInSSRComponentSetup){if(l==="sync"){const k=useSSRContext();C=k.__watcherHandles||(k.__watcherHandles=[])}else if(!S){const k=()=>{};return k.stop=NOOP,k.resume=NOOP,k.pause=NOOP,k}}const I=currentInstance;n.call=(k,Y,ie)=>callWithAsyncErrorHandling(k,I,Y,ie);let z=!1;l==="post"?n.scheduler=k=>{queuePostRenderEffect(k,I&&I.suspense)}:l!=="sync"&&(z=!0,n.scheduler=(k,Y)=>{Y?k():queueJob(k)}),n.augmentJob=k=>{t&&(k.flags|=4),z&&(k.flags|=2,I&&(k.id=I.uid,k.i=I))};const $=watch$2(e,t,n);return isInSSRComponentSetup&&(C?C.push($):S&&$()),$}function instanceWatch(e,t,i){const r=this.proxy,o=isString(e)?e.includes(".")?createPathGetter(r,e):()=>r[e]:e.bind(r,r);let l;isFunction(t)?l=t:(l=t.handler,i=t);const d=setCurrentInstance(this),n=doWatch(o,l.bind(r),i);return d(),n}function createPathGetter(e,t){const i=t.split(".");return()=>{let r=e;for(let o=0;o<i.length&&r;o++)r=r[i[o]];return r}}const getModelModifiers=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${camelize(t)}Modifiers`]||e[`${hyphenate(t)}Modifiers`];function emit$1(e,t,...i){if(e.isUnmounted)return;const r=e.vnode.props||EMPTY_OBJ;let o=i;const l=t.startsWith("update:"),d=l&&getModelModifiers(r,t.slice(7));d&&(d.trim&&(o=i.map(I=>isString(I)?I.trim():I)),d.number&&(o=i.map(looseToNumber)));let n,S=r[n=toHandlerKey(t)]||r[n=toHandlerKey(camelize(t))];!S&&l&&(S=r[n=toHandlerKey(hyphenate(t))]),S&&callWithAsyncErrorHandling(S,e,6,o);const C=r[n+"Once"];if(C){if(!e.emitted)e.emitted={};else if(e.emitted[n])return;e.emitted[n]=!0,callWithAsyncErrorHandling(C,e,6,o)}}function normalizeEmitsOptions(e,t,i=!1){const r=t.emitsCache,o=r.get(e);if(o!==void 0)return o;const l=e.emits;let d={},n=!1;if(!isFunction(e)){const S=C=>{const I=normalizeEmitsOptions(C,t,!0);I&&(n=!0,extend$2(d,I))};!i&&t.mixins.length&&t.mixins.forEach(S),e.extends&&S(e.extends),e.mixins&&e.mixins.forEach(S)}return!l&&!n?(isObject$1(e)&&r.set(e,null),null):(isArray$1(l)?l.forEach(S=>d[S]=null):extend$2(d,l),isObject$1(e)&&r.set(e,d),d)}function isEmitListener(e,t){return!e||!isOn(t)?!1:(t=t.slice(2).replace(/Once$/,""),hasOwn(e,t[0].toLowerCase()+t.slice(1))||hasOwn(e,hyphenate(t))||hasOwn(e,t))}function markAttrsAccessed(){}function renderComponentRoot(e){const{type:t,vnode:i,proxy:r,withProxy:o,propsOptions:[l],slots:d,attrs:n,emit:S,render:C,renderCache:I,props:z,data:$,setupState:k,ctx:Y,inheritAttrs:ie}=e,ue=setCurrentRenderingInstance(e);let ne,se;try{if(i.shapeFlag&4){const he=o||r,me=he;ne=normalizeVNode(C.call(me,he,I,z,k,$,Y)),se=n}else{const he=t;ne=normalizeVNode(he.length>1?he(z,{attrs:n,slots:d,emit:S}):he(z,null)),se=t.props?n:getFunctionalFallthrough(n)}}catch(he){blockStack.length=0,handleError(he,e,1),ne=createVNode(Comment)}let le=ne;if(se&&ie!==!1){const he=Object.keys(se),{shapeFlag:me}=le;he.length&&me&7&&(l&&he.some(isModelListener)&&(se=filterModelListeners(se,l)),le=cloneVNode(le,se,!1,!0))}return i.dirs&&(le=cloneVNode(le,null,!1,!0),le.dirs=le.dirs?le.dirs.concat(i.dirs):i.dirs),i.transition&&setTransitionHooks(le,i.transition),ne=le,setCurrentRenderingInstance(ue),ne}function filterSingleRoot(e,t=!0){let i;for(let r=0;r<e.length;r++){const o=e[r];if(isVNode(o)){if(o.type!==Comment||o.children==="v-if"){if(i)return;i=o}}else return}return i}const getFunctionalFallthrough=e=>{let t;for(const i in e)(i==="class"||i==="style"||isOn(i))&&((t||(t={}))[i]=e[i]);return t},filterModelListeners=(e,t)=>{const i={};for(const r in e)(!isModelListener(r)||!(r.slice(9)in t))&&(i[r]=e[r]);return i};function shouldUpdateComponent(e,t,i){const{props:r,children:o,component:l}=e,{props:d,children:n,patchFlag:S}=t,C=l.emitsOptions;if(t.dirs||t.transition)return!0;if(i&&S>=0){if(S&1024)return!0;if(S&16)return r?hasPropsChanged(r,d,C):!!d;if(S&8){const I=t.dynamicProps;for(let z=0;z<I.length;z++){const $=I[z];if(d[$]!==r[$]&&!isEmitListener(C,$))return!0}}}else return(o||n)&&(!n||!n.$stable)?!0:r===d?!1:r?d?hasPropsChanged(r,d,C):!0:!!d;return!1}function hasPropsChanged(e,t,i){const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!0;for(let o=0;o<r.length;o++){const l=r[o];if(t[l]!==e[l]&&!isEmitListener(i,l))return!0}return!1}function updateHOCHostEl({vnode:e,parent:t},i){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r===e)(e=t.vnode).el=i,t=t.parent;else break}}const isSuspense=e=>e.__isSuspense;let suspenseId=0;const SuspenseImpl={name:"Suspense",__isSuspense:!0,process(e,t,i,r,o,l,d,n,S,C){if(e==null)mountSuspense(t,i,r,o,l,d,n,S,C);else{if(l&&l.deps>0&&!e.suspense.isInFallback){t.suspense=e.suspense,t.suspense.vnode=t,t.el=e.el;return}patchSuspense(e,t,i,r,o,d,n,S,C)}},hydrate:hydrateSuspense,normalize:normalizeSuspenseChildren},Suspense=SuspenseImpl;function triggerEvent(e,t){const i=e.props&&e.props[t];isFunction(i)&&i()}function mountSuspense(e,t,i,r,o,l,d,n,S){const{p:C,o:{createElement:I}}=S,z=I("div"),$=e.suspense=createSuspenseBoundary(e,o,r,t,z,i,l,d,n,S);C(null,$.pendingBranch=e.ssContent,z,null,r,$,l,d),$.deps>0?(triggerEvent(e,"onPending"),triggerEvent(e,"onFallback"),C(null,e.ssFallback,t,i,r,null,l,d),setActiveBranch($,e.ssFallback)):$.resolve(!1,!0)}function patchSuspense(e,t,i,r,o,l,d,n,{p:S,um:C,o:{createElement:I}}){const z=t.suspense=e.suspense;z.vnode=t,t.el=e.el;const $=t.ssContent,k=t.ssFallback,{activeBranch:Y,pendingBranch:ie,isInFallback:ue,isHydrating:ne}=z;if(ie)z.pendingBranch=$,isSameVNodeType($,ie)?(S(ie,$,z.hiddenContainer,null,o,z,l,d,n),z.deps<=0?z.resolve():ue&&(ne||(S(Y,k,i,r,o,null,l,d,n),setActiveBranch(z,k)))):(z.pendingId=suspenseId++,ne?(z.isHydrating=!1,z.activeBranch=ie):C(ie,o,z),z.deps=0,z.effects.length=0,z.hiddenContainer=I("div"),ue?(S(null,$,z.hiddenContainer,null,o,z,l,d,n),z.deps<=0?z.resolve():(S(Y,k,i,r,o,null,l,d,n),setActiveBranch(z,k))):Y&&isSameVNodeType($,Y)?(S(Y,$,i,r,o,z,l,d,n),z.resolve(!0)):(S(null,$,z.hiddenContainer,null,o,z,l,d,n),z.deps<=0&&z.resolve()));else if(Y&&isSameVNodeType($,Y))S(Y,$,i,r,o,z,l,d,n),setActiveBranch(z,$);else if(triggerEvent(t,"onPending"),z.pendingBranch=$,$.shapeFlag&512?z.pendingId=$.component.suspenseId:z.pendingId=suspenseId++,S(null,$,z.hiddenContainer,null,o,z,l,d,n),z.deps<=0)z.resolve();else{const{timeout:se,pendingId:le}=z;se>0?setTimeout(()=>{z.pendingId===le&&z.fallback(k)},se):se===0&&z.fallback(k)}}function createSuspenseBoundary(e,t,i,r,o,l,d,n,S,C,I=!1){const{p:z,m:$,um:k,n:Y,o:{parentNode:ie,remove:ue}}=C;let ne;const se=isVNodeSuspensible(e);se&&t&&t.pendingBranch&&(ne=t.pendingId,t.deps++);const le=e.props?toNumber(e.props.timeout):void 0,he=l,me={vnode:e,parent:t,parentComponent:i,namespace:d,container:r,hiddenContainer:o,deps:0,pendingId:suspenseId++,timeout:typeof le=="number"?le:-1,activeBranch:null,pendingBranch:null,isInFallback:!I,isHydrating:I,isUnmounted:!1,effects:[],resolve(ge=!1,xt=!1){const{vnode:Et,activeBranch:Lt,pendingBranch:Zt,pendingId:Ht,effects:It,parentComponent:Yt,container:ri}=me;let ei=!1;me.isHydrating?me.isHydrating=!1:ge||(ei=Lt&&Zt.transition&&Zt.transition.mode==="out-in",ei&&(Lt.transition.afterLeave=()=>{Ht===me.pendingId&&($(Zt,ri,l===he?Y(Lt):l,0),queuePostFlushCb(It))}),Lt&&(ie(Lt.el)===ri&&(l=Y(Lt)),k(Lt,Yt,me,!0)),ei||$(Zt,ri,l,0)),setActiveBranch(me,Zt),me.pendingBranch=null,me.isInFallback=!1;let Ct=me.parent,Ut=!1;for(;Ct;){if(Ct.pendingBranch){Ct.effects.push(...It),Ut=!0;break}Ct=Ct.parent}!Ut&&!ei&&queuePostFlushCb(It),me.effects=[],se&&t&&t.pendingBranch&&ne===t.pendingId&&(t.deps--,t.deps===0&&!xt&&t.resolve()),triggerEvent(Et,"onResolve")},fallback(ge){if(!me.pendingBranch)return;const{vnode:xt,activeBranch:Et,parentComponent:Lt,container:Zt,namespace:Ht}=me;triggerEvent(xt,"onFallback");const It=Y(Et),Yt=()=>{me.isInFallback&&(z(null,ge,Zt,It,Lt,null,Ht,n,S),setActiveBranch(me,ge))},ri=ge.transition&&ge.transition.mode==="out-in";ri&&(Et.transition.afterLeave=Yt),me.isInFallback=!0,k(Et,Lt,null,!0),ri||Yt()},move(ge,xt,Et){me.activeBranch&&$(me.activeBranch,ge,xt,Et),me.container=ge},next(){return me.activeBranch&&Y(me.activeBranch)},registerDep(ge,xt,Et){const Lt=!!me.pendingBranch;Lt&&me.deps++;const Zt=ge.vnode.el;ge.asyncDep.catch(Ht=>{handleError(Ht,ge,0)}).then(Ht=>{if(ge.isUnmounted||me.isUnmounted||me.pendingId!==ge.suspenseId)return;ge.asyncResolved=!0;const{vnode:It}=ge;handleSetupResult(ge,Ht),Zt&&(It.el=Zt);const Yt=!Zt&&ge.subTree.el;xt(ge,It,ie(Zt||ge.subTree.el),Zt?null:Y(ge.subTree),me,d,Et),Yt&&ue(Yt),updateHOCHostEl(ge,It.el),Lt&&--me.deps===0&&me.resolve()})},unmount(ge,xt){me.isUnmounted=!0,me.activeBranch&&k(me.activeBranch,i,ge,xt),me.pendingBranch&&k(me.pendingBranch,i,ge,xt)}};return me}function hydrateSuspense(e,t,i,r,o,l,d,n,S){const C=t.suspense=createSuspenseBoundary(t,r,i,e.parentNode,document.createElement("div"),null,o,l,d,n,!0),I=S(e,C.pendingBranch=t.ssContent,i,C,l,d);return C.deps===0&&C.resolve(!1,!0),I}function normalizeSuspenseChildren(e){const{shapeFlag:t,children:i}=e,r=t&32;e.ssContent=normalizeSuspenseSlot(r?i.default:i),e.ssFallback=r?normalizeSuspenseSlot(i.fallback):createVNode(Comment)}function normalizeSuspenseSlot(e){let t;if(isFunction(e)){const i=isBlockTreeEnabled&&e._c;i&&(e._d=!1,openBlock()),e=e(),i&&(e._d=!0,t=currentBlock,closeBlock())}return isArray$1(e)&&(e=filterSingleRoot(e)),e=normalizeVNode(e),t&&!e.dynamicChildren&&(e.dynamicChildren=t.filter(i=>i!==e)),e}function queueEffectWithSuspense(e,t){t&&t.pendingBranch?isArray$1(e)?t.effects.push(...e):t.effects.push(e):queuePostFlushCb(e)}function setActiveBranch(e,t){e.activeBranch=t;const{vnode:i,parentComponent:r}=e;let o=t.el;for(;!o&&t.component;)t=t.component.subTree,o=t.el;i.el=o,r&&r.subTree===i&&(r.vnode.el=o,updateHOCHostEl(r,o))}function isVNodeSuspensible(e){const t=e.props&&e.props.suspensible;return t!=null&&t!==!1}const Fragment=Symbol.for("v-fgt"),Text=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock(e=!1){blockStack.push(currentBlock=e?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(e,t=!1){isBlockTreeEnabled+=e,e<0&&currentBlock&&t&&(currentBlock.hasOnce=!0)}function setupBlock(e){return e.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(e),e}function createElementBlock(e,t,i,r,o,l){return setupBlock(createBaseVNode(e,t,i,r,o,l,!0))}function createBlock(e,t,i,r,o){return setupBlock(createVNode(e,t,i,r,o,!0))}function isVNode(e){return e?e.__v_isVNode===!0:!1}function isSameVNodeType(e,t){return e.type===t.type&&e.key===t.key}const normalizeKey=({key:e})=>e??null,normalizeRef=({ref:e,ref_key:t,ref_for:i})=>(typeof e=="number"&&(e=""+e),e!=null?isString(e)||isRef(e)||isFunction(e)?{i:currentRenderingInstance,r:e,k:t,f:!!i}:e:null);function createBaseVNode(e,t=null,i=null,r=0,o=null,l=e===Fragment?0:1,d=!1,n=!1){const S={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&normalizeKey(t),ref:t&&normalizeRef(t),scopeId:currentScopeId,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:l,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return n?(normalizeChildren(S,i),l&128&&e.normalize(S)):i&&(S.shapeFlag|=isString(i)?8:16),isBlockTreeEnabled>0&&!d&&currentBlock&&(S.patchFlag>0||l&6)&&S.patchFlag!==32&&currentBlock.push(S),S}const createVNode=_createVNode;function _createVNode(e,t=null,i=null,r=0,o=null,l=!1){if((!e||e===NULL_DYNAMIC_COMPONENT)&&(e=Comment),isVNode(e)){const n=cloneVNode(e,t,!0);return i&&normalizeChildren(n,i),isBlockTreeEnabled>0&&!l&&currentBlock&&(n.shapeFlag&6?currentBlock[currentBlock.indexOf(e)]=n:currentBlock.push(n)),n.patchFlag=-2,n}if(isClassComponent(e)&&(e=e.__vccOpts),t){t=guardReactiveProps(t);let{class:n,style:S}=t;n&&!isString(n)&&(t.class=normalizeClass(n)),isObject$1(S)&&(isProxy(S)&&!isArray$1(S)&&(S=extend$2({},S)),t.style=normalizeStyle(S))}const d=isString(e)?1:isSuspense(e)?128:isTeleport(e)?64:isObject$1(e)?4:isFunction(e)?2:0;return createBaseVNode(e,t,i,r,o,d,l,!0)}function guardReactiveProps(e){return e?isProxy(e)||isInternalObject(e)?extend$2({},e):e:null}function cloneVNode(e,t,i=!1,r=!1){const{props:o,ref:l,patchFlag:d,children:n,transition:S}=e,C=t?mergeProps$1(o||{},t):o,I={__v_isVNode:!0,__v_skip:!0,type:e.type,props:C,key:C&&normalizeKey(C),ref:t&&t.ref?i&&l?isArray$1(l)?l.concat(normalizeRef(t)):[l,normalizeRef(t)]:normalizeRef(t):l,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:n,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Fragment?d===-1?16:d|16:d,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:S,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&cloneVNode(e.ssContent),ssFallback:e.ssFallback&&cloneVNode(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return S&&r&&setTransitionHooks(I,S.clone(I)),I}function createTextVNode(e=" ",t=0){return createVNode(Text,null,e,t)}function createStaticVNode(e,t){const i=createVNode(Static,null,e);return i.staticCount=t,i}function createCommentVNode(e="",t=!1){return t?(openBlock(),createBlock(Comment,null,e)):createVNode(Comment,null,e)}function normalizeVNode(e){return e==null||typeof e=="boolean"?createVNode(Comment):isArray$1(e)?createVNode(Fragment,null,e.slice()):isVNode(e)?cloneIfMounted(e):createVNode(Text,null,String(e))}function cloneIfMounted(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:cloneVNode(e)}function normalizeChildren(e,t){let i=0;const{shapeFlag:r}=e;if(t==null)t=null;else if(isArray$1(t))i=16;else if(typeof t=="object")if(r&65){const o=t.default;o&&(o._c&&(o._d=!1),normalizeChildren(e,o()),o._c&&(o._d=!0));return}else{i=32;const o=t._;!o&&!isInternalObject(t)?t._ctx=currentRenderingInstance:o===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else isFunction(t)?(t={default:t,_ctx:currentRenderingInstance},i=32):(t=String(t),r&64?(i=16,t=[createTextVNode(t)]):i=8);e.children=t,e.shapeFlag|=i}function mergeProps$1(...e){const t={};for(let i=0;i<e.length;i++){const r=e[i];for(const o in r)if(o==="class")t.class!==r.class&&(t.class=normalizeClass([t.class,r.class]));else if(o==="style")t.style=normalizeStyle([t.style,r.style]);else if(isOn(o)){const l=t[o],d=r[o];d&&l!==d&&!(isArray$1(l)&&l.includes(d))&&(t[o]=l?[].concat(l,d):d)}else o!==""&&(t[o]=r[o])}return t}function invokeVNodeHook(e,t,i,r=null){callWithAsyncErrorHandling(e,t,7,[i,r])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(e,t,i){const r=e.type,o=(t?t.appContext:e.appContext)||emptyAppContext,l={uid:uid++,vnode:e,type:r,parent:t,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(o.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(r,o),emitsOptions:normalizeEmitsOptions(r,o),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:r.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return l.ctx={_:l},l.root=t?t.root:l,l.emit=emit$1.bind(null,l),e.ce&&e.ce(l),l}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance;let internalSetCurrentInstance,setInSSRSetupState;{const e=getGlobalThis(),t=(i,r)=>{let o;return(o=e[i])||(o=e[i]=[]),o.push(r),l=>{o.length>1?o.forEach(d=>d(l)):o[0](l)}};internalSetCurrentInstance=t("__VUE_INSTANCE_SETTERS__",i=>currentInstance=i),setInSSRSetupState=t("__VUE_SSR_SETTERS__",i=>isInSSRComponentSetup=i)}const setCurrentInstance=e=>{const t=currentInstance;return internalSetCurrentInstance(e),e.scope.on(),()=>{e.scope.off(),internalSetCurrentInstance(t)}},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(e){return e.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(e,t=!1,i=!1){t&&setInSSRSetupState(t);const{props:r,children:o}=e.vnode,l=isStatefulComponent(e);initProps(e,r,l,t),initSlots(e,o,i||t);const d=l?setupStatefulComponent(e,t):void 0;return t&&setInSSRSetupState(!1),d}function setupStatefulComponent(e,t){const i=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,PublicInstanceProxyHandlers);const{setup:r}=i;if(r){pauseTracking();const o=e.setupContext=r.length>1?createSetupContext(e):null,l=setCurrentInstance(e),d=callWithErrorHandling(r,e,0,[e.props,o]),n=isPromise(d);if(resetTracking(),l(),(n||e.sp)&&!isAsyncWrapper(e)&&markAsyncBoundary(e),n){if(d.then(unsetCurrentInstance,unsetCurrentInstance),t)return d.then(S=>{handleSetupResult(e,S)}).catch(S=>{handleError(S,e,0)});e.asyncDep=d}else handleSetupResult(e,d)}else finishComponentSetup(e)}function handleSetupResult(e,t,i){isFunction(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:isObject$1(t)&&(e.setupState=proxyRefs(t)),finishComponentSetup(e)}function finishComponentSetup(e,t,i){const r=e.type;e.render||(e.render=r.render||NOOP);{const o=setCurrentInstance(e);pauseTracking();try{applyOptions(e)}finally{resetTracking(),o()}}}const attrsProxyHandlers={get(e,t){return track(e,"get",""),e[t]}};function createSetupContext(e){const t=i=>{e.exposed=i||{}};return{attrs:new Proxy(e.attrs,attrsProxyHandlers),slots:e.slots,emit:e.emit,expose:t}}function getComponentPublicInstance(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(proxyRefs(markRaw(e.exposed)),{get(t,i){if(i in t)return t[i];if(i in publicPropertiesMap)return publicPropertiesMap[i](e)},has(t,i){return i in t||i in publicPropertiesMap}})):e.proxy}const classifyRE=/(?:^|[-_])(\w)/g,classify=e=>e.replace(classifyRE,t=>t.toUpperCase()).replace(/[-_]/g,"");function getComponentName(e,t=!0){return isFunction(e)?e.displayName||e.name:e.name||t&&e.__name}function formatComponentName(e,t,i=!1){let r=getComponentName(t);if(!r&&t.__file){const o=t.__file.match(/([^/\\]+)\.\w+$/);o&&(r=o[1])}if(!r&&e&&e.parent){const o=l=>{for(const d in l)if(l[d]===t)return d};r=o(e.components||e.parent.type.components)||o(e.appContext.components)}return r?classify(r):i?"App":"Anonymous"}function isClassComponent(e){return isFunction(e)&&"__vccOpts"in e}const computed=(e,t)=>computed$1(e,t,isInSSRComponentSetup);function h(e,t,i){const r=arguments.length;return r===2?isObject$1(t)&&!isArray$1(t)?isVNode(t)?createVNode(e,null,[t]):createVNode(e,t):createVNode(e,null,t):(r>3?i=Array.prototype.slice.call(arguments,2):r===3&&isVNode(i)&&(i=[i]),createVNode(e,t,i))}const version$1="3.5.14";/**
* @vue/runtime-dom v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let policy;const tt$1=typeof window<"u"&&window.trustedTypes;if(tt$1)try{policy=tt$1.createPolicy("vue",{createHTML:e=>e})}catch{}const unsafeToTrustedHTML=policy?e=>policy.createHTML(e):e=>e,svgNS="http://www.w3.org/2000/svg",mathmlNS="http://www.w3.org/1998/Math/MathML",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(e,t,i)=>{t.insertBefore(e,i||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,i,r)=>{const o=t==="svg"?doc.createElementNS(svgNS,e):t==="mathml"?doc.createElementNS(mathmlNS,e):i?doc.createElement(e,{is:i}):doc.createElement(e);return e==="select"&&r&&r.multiple!=null&&o.setAttribute("multiple",r.multiple),o},createText:e=>doc.createTextNode(e),createComment:e=>doc.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>doc.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,i,r,o,l){const d=i?i.previousSibling:t.lastChild;if(o&&(o===l||o.nextSibling))for(;t.insertBefore(o.cloneNode(!0),i),!(o===l||!(o=o.nextSibling)););else{templateContainer.innerHTML=unsafeToTrustedHTML(r==="svg"?`<svg>${e}</svg>`:r==="mathml"?`<math>${e}</math>`:e);const n=templateContainer.content;if(r==="svg"||r==="mathml"){const S=n.firstChild;for(;S.firstChild;)n.appendChild(S.firstChild);n.removeChild(S)}t.insertBefore(n,i)}return[d?d.nextSibling:t.firstChild,i?i.previousSibling:t.lastChild]}},TRANSITION="transition",ANIMATION="animation",vtcKey=Symbol("_vtc"),DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},TransitionPropsValidators=extend$2({},BaseTransitionPropsValidators,DOMTransitionPropsValidators),decorate$1=e=>(e.displayName="Transition",e.props=TransitionPropsValidators,e),Transition=decorate$1((e,{slots:t})=>h(BaseTransition,resolveTransitionProps(e),t)),callHook=(e,t=[])=>{isArray$1(e)?e.forEach(i=>i(...t)):e&&e(...t)},hasExplicitCallback=e=>e?isArray$1(e)?e.some(t=>t.length>1):e.length>1:!1;function resolveTransitionProps(e){const t={};for(const It in e)It in DOMTransitionPropsValidators||(t[It]=e[It]);if(e.css===!1)return t;const{name:i="v",type:r,duration:o,enterFromClass:l=`${i}-enter-from`,enterActiveClass:d=`${i}-enter-active`,enterToClass:n=`${i}-enter-to`,appearFromClass:S=l,appearActiveClass:C=d,appearToClass:I=n,leaveFromClass:z=`${i}-leave-from`,leaveActiveClass:$=`${i}-leave-active`,leaveToClass:k=`${i}-leave-to`}=e,Y=normalizeDuration(o),ie=Y&&Y[0],ue=Y&&Y[1],{onBeforeEnter:ne,onEnter:se,onEnterCancelled:le,onLeave:he,onLeaveCancelled:me,onBeforeAppear:ge=ne,onAppear:xt=se,onAppearCancelled:Et=le}=t,Lt=(It,Yt,ri,ei)=>{It._enterCancelled=ei,removeTransitionClass(It,Yt?I:n),removeTransitionClass(It,Yt?C:d),ri&&ri()},Zt=(It,Yt)=>{It._isLeaving=!1,removeTransitionClass(It,z),removeTransitionClass(It,k),removeTransitionClass(It,$),Yt&&Yt()},Ht=It=>(Yt,ri)=>{const ei=It?xt:se,Ct=()=>Lt(Yt,It,ri);callHook(ei,[Yt,Ct]),nextFrame(()=>{removeTransitionClass(Yt,It?S:l),addTransitionClass(Yt,It?I:n),hasExplicitCallback(ei)||whenTransitionEnds(Yt,r,ie,Ct)})};return extend$2(t,{onBeforeEnter(It){callHook(ne,[It]),addTransitionClass(It,l),addTransitionClass(It,d)},onBeforeAppear(It){callHook(ge,[It]),addTransitionClass(It,S),addTransitionClass(It,C)},onEnter:Ht(!1),onAppear:Ht(!0),onLeave(It,Yt){It._isLeaving=!0;const ri=()=>Zt(It,Yt);addTransitionClass(It,z),It._enterCancelled?(addTransitionClass(It,$),forceReflow()):(forceReflow(),addTransitionClass(It,$)),nextFrame(()=>{It._isLeaving&&(removeTransitionClass(It,z),addTransitionClass(It,k),hasExplicitCallback(he)||whenTransitionEnds(It,r,ue,ri))}),callHook(he,[It,ri])},onEnterCancelled(It){Lt(It,!1,void 0,!0),callHook(le,[It])},onAppearCancelled(It){Lt(It,!0,void 0,!0),callHook(Et,[It])},onLeaveCancelled(It){Zt(It),callHook(me,[It])}})}function normalizeDuration(e){if(e==null)return null;if(isObject$1(e))return[NumberOf(e.enter),NumberOf(e.leave)];{const t=NumberOf(e);return[t,t]}}function NumberOf(e){return toNumber(e)}function addTransitionClass(e,t){t.split(/\s+/).forEach(i=>i&&e.classList.add(i)),(e[vtcKey]||(e[vtcKey]=new Set)).add(t)}function removeTransitionClass(e,t){t.split(/\s+/).forEach(r=>r&&e.classList.remove(r));const i=e[vtcKey];i&&(i.delete(t),i.size||(e[vtcKey]=void 0))}function nextFrame(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let endId=0;function whenTransitionEnds(e,t,i,r){const o=e._endId=++endId,l=()=>{o===e._endId&&r()};if(i!=null)return setTimeout(l,i);const{type:d,timeout:n,propCount:S}=getTransitionInfo(e,t);if(!d)return r();const C=d+"end";let I=0;const z=()=>{e.removeEventListener(C,$),l()},$=k=>{k.target===e&&++I>=S&&z()};setTimeout(()=>{I<S&&z()},n+1),e.addEventListener(C,$)}function getTransitionInfo(e,t){const i=window.getComputedStyle(e),r=Y=>(i[Y]||"").split(", "),o=r(`${TRANSITION}Delay`),l=r(`${TRANSITION}Duration`),d=getTimeout(o,l),n=r(`${ANIMATION}Delay`),S=r(`${ANIMATION}Duration`),C=getTimeout(n,S);let I=null,z=0,$=0;t===TRANSITION?d>0&&(I=TRANSITION,z=d,$=l.length):t===ANIMATION?C>0&&(I=ANIMATION,z=C,$=S.length):(z=Math.max(d,C),I=z>0?d>C?TRANSITION:ANIMATION:null,$=I?I===TRANSITION?l.length:S.length:0);const k=I===TRANSITION&&/\b(transform|all)(,|$)/.test(r(`${TRANSITION}Property`).toString());return{type:I,timeout:z,propCount:$,hasTransform:k}}function getTimeout(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((i,r)=>toMs(i)+toMs(e[r])))}function toMs(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function forceReflow(){return document.body.offsetHeight}function patchClass(e,t,i){const r=e[vtcKey];r&&(t=(t?[t,...r]:[...r]).join(" ")),t==null?e.removeAttribute("class"):i?e.setAttribute("class",t):e.className=t}const vShowOriginalDisplay=Symbol("_vod"),vShowHidden=Symbol("_vsh"),vShow={beforeMount(e,{value:t},{transition:i}){e[vShowOriginalDisplay]=e.style.display==="none"?"":e.style.display,i&&t?i.beforeEnter(e):setDisplay(e,t)},mounted(e,{value:t},{transition:i}){i&&t&&i.enter(e)},updated(e,{value:t,oldValue:i},{transition:r}){!t!=!i&&(r?t?(r.beforeEnter(e),setDisplay(e,!0),r.enter(e)):r.leave(e,()=>{setDisplay(e,!1)}):setDisplay(e,t))},beforeUnmount(e,{value:t}){setDisplay(e,t)}};function setDisplay(e,t){e.style.display=t?e[vShowOriginalDisplay]:"none",e[vShowHidden]=!t}const CSS_VAR_TEXT=Symbol(""),displayRE=/(^|;)\s*display\s*:/;function patchStyle(e,t,i){const r=e.style,o=isString(i);let l=!1;if(i&&!o){if(t)if(isString(t))for(const d of t.split(";")){const n=d.slice(0,d.indexOf(":")).trim();i[n]==null&&setStyle(r,n,"")}else for(const d in t)i[d]==null&&setStyle(r,d,"");for(const d in i)d==="display"&&(l=!0),setStyle(r,d,i[d])}else if(o){if(t!==i){const d=r[CSS_VAR_TEXT];d&&(i+=";"+d),r.cssText=i,l=displayRE.test(i)}}else t&&e.removeAttribute("style");vShowOriginalDisplay in e&&(e[vShowOriginalDisplay]=l?r.display:"",e[vShowHidden]&&(r.display="none"))}const importantRE=/\s*!important$/;function setStyle(e,t,i){if(isArray$1(i))i.forEach(r=>setStyle(e,t,r));else if(i==null&&(i=""),t.startsWith("--"))e.setProperty(t,i);else{const r=autoPrefix(e,t);importantRE.test(i)?e.setProperty(hyphenate(r),i.replace(importantRE,""),"important"):e[r]=i}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(e,t){const i=prefixCache[t];if(i)return i;let r=camelize(t);if(r!=="filter"&&r in e)return prefixCache[t]=r;r=capitalize(r);for(let o=0;o<prefixes.length;o++){const l=prefixes[o]+r;if(l in e)return prefixCache[t]=l}return t}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(e,t,i,r,o,l=isSpecialBooleanAttr(t)){r&&t.startsWith("xlink:")?i==null?e.removeAttributeNS(xlinkNS,t.slice(6,t.length)):e.setAttributeNS(xlinkNS,t,i):i==null||l&&!includeBooleanAttr(i)?e.removeAttribute(t):e.setAttribute(t,l?"":isSymbol(i)?String(i):i)}function patchDOMProp(e,t,i,r,o){if(t==="innerHTML"||t==="textContent"){i!=null&&(e[t]=t==="innerHTML"?unsafeToTrustedHTML(i):i);return}const l=e.tagName;if(t==="value"&&l!=="PROGRESS"&&!l.includes("-")){const n=l==="OPTION"?e.getAttribute("value")||"":e.value,S=i==null?e.type==="checkbox"?"on":"":String(i);(n!==S||!("_value"in e))&&(e.value=S),i==null&&e.removeAttribute(t),e._value=i;return}let d=!1;if(i===""||i==null){const n=typeof e[t];n==="boolean"?i=includeBooleanAttr(i):i==null&&n==="string"?(i="",d=!0):n==="number"&&(i=0,d=!0)}try{e[t]=i}catch{}d&&e.removeAttribute(o||t)}function addEventListener(e,t,i,r){e.addEventListener(t,i,r)}function removeEventListener(e,t,i,r){e.removeEventListener(t,i,r)}const veiKey=Symbol("_vei");function patchEvent(e,t,i,r,o=null){const l=e[veiKey]||(e[veiKey]={}),d=l[t];if(r&&d)d.value=r;else{const[n,S]=parseName(t);if(r){const C=l[t]=createInvoker(r,o);addEventListener(e,n,C,S)}else d&&(removeEventListener(e,n,d,S),l[t]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(e){let t;if(optionsModifierRE.test(e)){t={};let r;for(;r=e.match(optionsModifierRE);)e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):hyphenate(e.slice(2)),t]}let cachedNow=0;const p=Promise.resolve(),getNow=()=>cachedNow||(p.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(e,t){const i=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=i.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(r,i.value),t,5,[r])};return i.value=e,i.attached=getNow(),i}function patchStopImmediatePropagation(e,t){if(isArray$1(t)){const i=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{i.call(e),e._stopped=!0},t.map(r=>o=>!o._stopped&&r&&r(o))}else return t}const isNativeOn=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,patchProp=(e,t,i,r,o,l)=>{const d=o==="svg";t==="class"?patchClass(e,r,d):t==="style"?patchStyle(e,i,r):isOn(t)?isModelListener(t)||patchEvent(e,t,i,r,l):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):shouldSetAsProp(e,t,r,d))?(patchDOMProp(e,t,r),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&patchAttr(e,t,r,d,l,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!isString(r))?patchDOMProp(e,camelize(t),r,l,t):(t==="true-value"?e._trueValue=r:t==="false-value"&&(e._falseValue=r),patchAttr(e,t,r,d))};function shouldSetAsProp(e,t,i,r){if(r)return!!(t==="innerHTML"||t==="textContent"||t in e&&isNativeOn(t)&&isFunction(i));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const o=e.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return isNativeOn(t)&&isString(i)?!1:t in e}const rendererOptions=extend$2({patchProp},nodeOps);let renderer,enabledHydration=!1;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}function ensureHydrationRenderer(){return renderer=enabledHydration?renderer:createHydrationRenderer(rendererOptions),enabledHydration=!0,renderer}const createApp=(...e)=>{const t=ensureRenderer().createApp(...e),{mount:i}=t;return t.mount=r=>{const o=normalizeContainer(r);if(!o)return;const l=t._component;!isFunction(l)&&!l.render&&!l.template&&(l.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const d=i(o,!1,resolveRootNamespace(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),d},t},createSSRApp=(...e)=>{const t=ensureHydrationRenderer().createApp(...e),{mount:i}=t;return t.mount=r=>{const o=normalizeContainer(r);if(o)return i(o,!0,resolveRootNamespace(o))},t};function resolveRootNamespace(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function normalizeContainer(e){return isString(e)?document.querySelector(e):e}const suspectProtoRx=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,suspectConstructorRx=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,JsonSigRx=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function jsonParseTransform(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){warnKeyDropped(e);return}return t}function warnKeyDropped(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function destr(e,t={}){if(typeof e!="string")return e;if(e[0]==='"'&&e[e.length-1]==='"'&&e.indexOf("\\")===-1)return e.slice(1,-1);const i=e.trim();if(i.length<=9)switch(i.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!JsonSigRx.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(suspectProtoRx.test(e)||suspectConstructorRx.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,jsonParseTransform)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}const HASH_RE$1=/#/g,AMPERSAND_RE$1=/&/g,SLASH_RE$1=/\//g,EQUAL_RE$1=/=/g,PLUS_RE$1=/\+/g,ENC_CARET_RE$1=/%5e/gi,ENC_BACKTICK_RE$1=/%60/gi,ENC_PIPE_RE$1=/%7c/gi,ENC_SPACE_RE$1=/%20/gi;function encode(e){return encodeURI(""+e).replace(ENC_PIPE_RE$1,"|")}function encodeQueryValue$1(e){return encode(typeof e=="string"?e:JSON.stringify(e)).replace(PLUS_RE$1,"%2B").replace(ENC_SPACE_RE$1,"+").replace(HASH_RE$1,"%23").replace(AMPERSAND_RE$1,"%26").replace(ENC_BACKTICK_RE$1,"`").replace(ENC_CARET_RE$1,"^").replace(SLASH_RE$1,"%2F")}function encodeQueryKey$1(e){return encodeQueryValue$1(e).replace(EQUAL_RE$1,"%3D")}function decode$1(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function decodeQueryKey(e){return decode$1(e.replace(PLUS_RE$1," "))}function decodeQueryValue(e){return decode$1(e.replace(PLUS_RE$1," "))}function parseQuery$1(e=""){const t=Object.create(null);e[0]==="?"&&(e=e.slice(1));for(const i of e.split("&")){const r=i.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const o=decodeQueryKey(r[1]);if(o==="__proto__"||o==="constructor")continue;const l=decodeQueryValue(r[2]||"");t[o]===void 0?t[o]=l:Array.isArray(t[o])?t[o].push(l):t[o]=[t[o],l]}return t}function encodeQueryItem(e,t){return(typeof t=="number"||typeof t=="boolean")&&(t=String(t)),t?Array.isArray(t)?t.map(i=>`${encodeQueryKey$1(e)}=${encodeQueryValue$1(i)}`).join("&"):`${encodeQueryKey$1(e)}=${encodeQueryValue$1(t)}`:encodeQueryKey$1(e)}function stringifyQuery$1(e){return Object.keys(e).filter(t=>e[t]!==void 0).map(t=>encodeQueryItem(t,e[t])).filter(Boolean).join("&")}const PROTOCOL_STRICT_REGEX=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,PROTOCOL_REGEX=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,PROTOCOL_RELATIVE_REGEX=/^([/\\]\s*){2,}[^/\\]/,PROTOCOL_SCRIPT_RE=/^[\s\0]*(blob|data|javascript|vbscript):$/i,TRAILING_SLASH_RE$1=/\/$|\/\?|\/#/,JOIN_LEADING_SLASH_RE=/^\.?\//;function hasProtocol(e,t={}){return typeof t=="boolean"&&(t={acceptRelative:t}),t.strict?PROTOCOL_STRICT_REGEX.test(e):PROTOCOL_REGEX.test(e)||(t.acceptRelative?PROTOCOL_RELATIVE_REGEX.test(e):!1)}function isScriptProtocol(e){return!!e&&PROTOCOL_SCRIPT_RE.test(e)}function hasTrailingSlash(e="",t){return t?TRAILING_SLASH_RE$1.test(e):e.endsWith("/")}function withoutTrailingSlash(e="",t){if(!t)return(hasTrailingSlash(e)?e.slice(0,-1):e)||"/";if(!hasTrailingSlash(e,!0))return e||"/";let i=e,r="";const o=e.indexOf("#");o!==-1&&(i=e.slice(0,o),r=e.slice(o));const[l,...d]=i.split("?");return((l.endsWith("/")?l.slice(0,-1):l)||"/")+(d.length>0?`?${d.join("?")}`:"")+r}function withTrailingSlash(e="",t){if(!t)return e.endsWith("/")?e:e+"/";if(hasTrailingSlash(e,!0))return e||"/";let i=e,r="";const o=e.indexOf("#");if(o!==-1&&(i=e.slice(0,o),r=e.slice(o),!i))return r;const[l,...d]=i.split("?");return l+"/"+(d.length>0?`?${d.join("?")}`:"")+r}function hasLeadingSlash(e=""){return e.startsWith("/")}function withLeadingSlash(e=""){return hasLeadingSlash(e)?e:"/"+e}function withBase(e,t){if(isEmptyURL(t)||hasProtocol(e))return e;const i=withoutTrailingSlash(t);return e.startsWith(i)?e:joinURL(i,e)}function withoutBase(e,t){if(isEmptyURL(t))return e;const i=withoutTrailingSlash(t);if(!e.startsWith(i))return e;const r=e.slice(i.length);return r[0]==="/"?r:"/"+r}function withQuery(e,t){const i=parseURL$1(e),r={...parseQuery$1(i.search),...t};return i.search=stringifyQuery$1(r),stringifyParsedURL(i)}function isEmptyURL(e){return!e||e==="/"}function isNonEmptyURL(e){return e&&e!=="/"}function joinURL(e,...t){let i=e||"";for(const r of t.filter(o=>isNonEmptyURL(o)))if(i){const o=r.replace(JOIN_LEADING_SLASH_RE,"");i=withTrailingSlash(i)+o}else i=r;return i}function joinRelativeURL(...e){var d,n,S,C;const t=/\/(?!\/)/,i=e.filter(Boolean),r=[];let o=0;for(const I of i)if(!(!I||I==="/")){for(const[z,$]of I.split(t).entries())if(!(!$||$===".")){if($===".."){if(r.length===1&&hasProtocol(r[0]))continue;r.pop(),o--;continue}if(z===1&&((d=r[r.length-1])!=null&&d.endsWith(":/"))){r[r.length-1]+="/"+$;continue}r.push($),o++}}let l=r.join("/");return o>=0?(n=i[0])!=null&&n.startsWith("/")&&!l.startsWith("/")?l="/"+l:(S=i[0])!=null&&S.startsWith("./")&&!l.startsWith("./")&&(l="./"+l):l="../".repeat(-1*o)+l,(C=i[i.length-1])!=null&&C.endsWith("/")&&!l.endsWith("/")&&(l+="/"),l}function isSamePath(e,t){return decode$1(withoutTrailingSlash(e))===decode$1(withoutTrailingSlash(t))}const protocolRelative=Symbol.for("ufo:protocolRelative");function parseURL$1(e="",t){const i=e.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(i){const[,z,$=""]=i;return{protocol:z.toLowerCase(),pathname:$,href:z+$,auth:"",host:"",search:"",hash:""}}if(!hasProtocol(e,{acceptRelative:!0}))return parsePath(e);const[,r="",o,l=""]=e.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,d="",n=""]=l.match(/([^#/?]*)(.*)?/)||[];r==="file:"&&(n=n.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:S,search:C,hash:I}=parsePath(n);return{protocol:r.toLowerCase(),auth:o?o.slice(0,Math.max(0,o.length-1)):"",host:d,pathname:S,search:C,hash:I,[protocolRelative]:!r}}function parsePath(e=""){const[t="",i="",r=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:t,search:i,hash:r}}function stringifyParsedURL(e){const t=e.pathname||"",i=e.search?(e.search.startsWith("?")?"":"?")+e.search:"",r=e.hash||"",o=e.auth?e.auth+"@":"",l=e.host||"";return(e.protocol||e[protocolRelative]?(e.protocol||"")+"//":"")+o+l+t+i+r}class FetchError extends Error{constructor(t,i){super(t,i),this.name="FetchError",i!=null&&i.cause&&!this.cause&&(this.cause=i.cause)}}function createFetchError(e){var S,C,I,z,$;const t=((S=e.error)==null?void 0:S.message)||((C=e.error)==null?void 0:C.toString())||"",i=((I=e.request)==null?void 0:I.method)||((z=e.options)==null?void 0:z.method)||"GET",r=(($=e.request)==null?void 0:$.url)||String(e.request)||"/",o=`[${i}] ${JSON.stringify(r)}`,l=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",d=`${o}: ${l}${t?` ${t}`:""}`,n=new FetchError(d,e.error?{cause:e.error}:void 0);for(const k of["request","options","response"])Object.defineProperty(n,k,{get(){return e[k]}});for(const[k,Y]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(n,k,{get(){return e.response&&e.response[Y]}});return n}const payloadMethods=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function isPayloadMethod(e="GET"){return payloadMethods.has(e.toUpperCase())}function isJSONSerializable(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const textTypes=new Set(["image/svg","application/xml","application/xhtml","application/html"]),JSON_RE=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function detectResponseType(e=""){if(!e)return"json";const t=e.split(";").shift()||"";return JSON_RE.test(t)?"json":textTypes.has(t)||t.startsWith("text/")?"text":"blob"}function resolveFetchOptions(e,t,i,r){const o=mergeHeaders((t==null?void 0:t.headers)??(e==null?void 0:e.headers),i==null?void 0:i.headers,r);let l;return(i!=null&&i.query||i!=null&&i.params||t!=null&&t.params||t!=null&&t.query)&&(l={...i==null?void 0:i.params,...i==null?void 0:i.query,...t==null?void 0:t.params,...t==null?void 0:t.query}),{...i,...t,query:l,params:l,headers:o}}function mergeHeaders(e,t,i){if(!t)return new i(e);const r=new i(t);if(e)for(const[o,l]of Symbol.iterator in e||Array.isArray(e)?e:new i(e))r.set(o,l);return r}async function callHooks(e,t){if(t)if(Array.isArray(t))for(const i of t)await i(e);else await t(e)}const retryStatusCodes=new Set([408,409,425,429,500,502,503,504]),nullBodyResponses=new Set([101,204,205,304]);function createFetch(e={}){const{fetch:t=globalThis.fetch,Headers:i=globalThis.Headers,AbortController:r=globalThis.AbortController}=e;async function o(n){const S=n.error&&n.error.name==="AbortError"&&!n.options.timeout||!1;if(n.options.retry!==!1&&!S){let I;typeof n.options.retry=="number"?I=n.options.retry:I=isPayloadMethod(n.options.method)?0:1;const z=n.response&&n.response.status||500;if(I>0&&(Array.isArray(n.options.retryStatusCodes)?n.options.retryStatusCodes.includes(z):retryStatusCodes.has(z))){const $=typeof n.options.retryDelay=="function"?n.options.retryDelay(n):n.options.retryDelay||0;return $>0&&await new Promise(k=>setTimeout(k,$)),l(n.request,{...n.options,retry:I-1})}}const C=createFetchError(n);throw Error.captureStackTrace&&Error.captureStackTrace(C,l),C}const l=async function(S,C={}){const I={request:S,options:resolveFetchOptions(S,C,e.defaults,i),response:void 0,error:void 0};I.options.method&&(I.options.method=I.options.method.toUpperCase()),I.options.onRequest&&await callHooks(I,I.options.onRequest),typeof I.request=="string"&&(I.options.baseURL&&(I.request=withBase(I.request,I.options.baseURL)),I.options.query&&(I.request=withQuery(I.request,I.options.query),delete I.options.query),"query"in I.options&&delete I.options.query,"params"in I.options&&delete I.options.params),I.options.body&&isPayloadMethod(I.options.method)&&(isJSONSerializable(I.options.body)?(I.options.body=typeof I.options.body=="string"?I.options.body:JSON.stringify(I.options.body),I.options.headers=new i(I.options.headers||{}),I.options.headers.has("content-type")||I.options.headers.set("content-type","application/json"),I.options.headers.has("accept")||I.options.headers.set("accept","application/json")):("pipeTo"in I.options.body&&typeof I.options.body.pipeTo=="function"||typeof I.options.body.pipe=="function")&&("duplex"in I.options||(I.options.duplex="half")));let z;if(!I.options.signal&&I.options.timeout){const k=new r;z=setTimeout(()=>{const Y=new Error("[TimeoutError]: The operation was aborted due to timeout");Y.name="TimeoutError",Y.code=23,k.abort(Y)},I.options.timeout),I.options.signal=k.signal}try{I.response=await t(I.request,I.options)}catch(k){return I.error=k,I.options.onRequestError&&await callHooks(I,I.options.onRequestError),await o(I)}finally{z&&clearTimeout(z)}if((I.response.body||I.response._bodyInit)&&!nullBodyResponses.has(I.response.status)&&I.options.method!=="HEAD"){const k=(I.options.parseResponse?"json":I.options.responseType)||detectResponseType(I.response.headers.get("content-type")||"");switch(k){case"json":{const Y=await I.response.text(),ie=I.options.parseResponse||destr;I.response._data=ie(Y);break}case"stream":{I.response._data=I.response.body||I.response._bodyInit;break}default:I.response._data=await I.response[k]()}}return I.options.onResponse&&await callHooks(I,I.options.onResponse),!I.options.ignoreResponseError&&I.response.status>=400&&I.response.status<600?(I.options.onResponseError&&await callHooks(I,I.options.onResponseError),await o(I)):I.response},d=async function(S,C){return(await l(S,C))._data};return d.raw=l,d.native=(...n)=>t(...n),d.create=(n={},S={})=>createFetch({...e,...S,defaults:{...e.defaults,...S.defaults,...n}}),d}const _globalThis$1=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),fetch$1=_globalThis$1.fetch?(...e)=>_globalThis$1.fetch(...e):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),Headers$1=_globalThis$1.Headers,AbortController$1=_globalThis$1.AbortController,ofetch=createFetch({fetch:fetch$1,Headers:Headers$1,AbortController:AbortController$1}),$fetch$1=ofetch,useRuntimeConfig$1=()=>{var e;return((e=window==null?void 0:window.__NUXT__)==null?void 0:e.config)||{}},appConfig=useRuntimeConfig$1().app,baseURL=()=>appConfig.baseURL,buildAssetsDir=()=>appConfig.buildAssetsDir,buildAssetsURL=(...e)=>joinRelativeURL(publicAssetsURL(),buildAssetsDir(),...e),publicAssetsURL=(...e)=>{const t=appConfig.cdnURL||appConfig.baseURL;return e.length?joinRelativeURL(t,...e):t};globalThis.__buildAssetsURL=buildAssetsURL,globalThis.__publicAssetsURL=publicAssetsURL;globalThis.$fetch||(globalThis.$fetch=$fetch$1.create({baseURL:baseURL()}));"global"in globalThis||(globalThis.global=globalThis);function flatHooks(e,t={},i){for(const r in e){const o=e[r],l=i?`${i}:${r}`:r;typeof o=="object"&&o!==null?flatHooks(o,t,l):typeof o=="function"&&(t[l]=o)}return t}const defaultTask={run:e=>e()},_createTask=()=>defaultTask,createTask=typeof console.createTask<"u"?console.createTask:_createTask;function serialTaskCaller(e,t){const i=t.shift(),r=createTask(i);return e.reduce((o,l)=>o.then(()=>r.run(()=>l(...t))),Promise.resolve())}function parallelTaskCaller(e,t){const i=t.shift(),r=createTask(i);return Promise.all(e.map(o=>r.run(()=>o(...t))))}function callEachWith(e,t){for(const i of[...e])i(t)}class Hookable{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(t,i,r={}){if(!t||typeof i!="function")return()=>{};const o=t;let l;for(;this._deprecatedHooks[t];)l=this._deprecatedHooks[t],t=l.to;if(l&&!r.allowDeprecated){let d=l.message;d||(d=`${o} hook has been deprecated`+(l.to?`, please use ${l.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(d)||(console.warn(d),this._deprecatedMessages.add(d))}if(!i.name)try{Object.defineProperty(i,"name",{get:()=>"_"+t.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[t]=this._hooks[t]||[],this._hooks[t].push(i),()=>{i&&(this.removeHook(t,i),i=void 0)}}hookOnce(t,i){let r,o=(...l)=>(typeof r=="function"&&r(),r=void 0,o=void 0,i(...l));return r=this.hook(t,o),r}removeHook(t,i){if(this._hooks[t]){const r=this._hooks[t].indexOf(i);r!==-1&&this._hooks[t].splice(r,1),this._hooks[t].length===0&&delete this._hooks[t]}}deprecateHook(t,i){this._deprecatedHooks[t]=typeof i=="string"?{to:i}:i;const r=this._hooks[t]||[];delete this._hooks[t];for(const o of r)this.hook(t,o)}deprecateHooks(t){Object.assign(this._deprecatedHooks,t);for(const i in t)this.deprecateHook(i,t[i])}addHooks(t){const i=flatHooks(t),r=Object.keys(i).map(o=>this.hook(o,i[o]));return()=>{for(const o of r.splice(0,r.length))o()}}removeHooks(t){const i=flatHooks(t);for(const r in i)this.removeHook(r,i[r])}removeAllHooks(){for(const t in this._hooks)delete this._hooks[t]}callHook(t,...i){return i.unshift(t),this.callHookWith(serialTaskCaller,t,...i)}callHookParallel(t,...i){return i.unshift(t),this.callHookWith(parallelTaskCaller,t,...i)}callHookWith(t,i,...r){const o=this._before||this._after?{name:i,args:r,context:{}}:void 0;this._before&&callEachWith(this._before,o);const l=t(i in this._hooks?[...this._hooks[i]]:[],r);return l instanceof Promise?l.finally(()=>{this._after&&o&&callEachWith(this._after,o)}):(this._after&&o&&callEachWith(this._after,o),l)}beforeEach(t){return this._before=this._before||[],this._before.push(t),()=>{if(this._before!==void 0){const i=this._before.indexOf(t);i!==-1&&this._before.splice(i,1)}}}afterEach(t){return this._after=this._after||[],this._after.push(t),()=>{if(this._after!==void 0){const i=this._after.indexOf(t);i!==-1&&this._after.splice(i,1)}}}}function createHooks$1(){return new Hookable}function createContext$1(e={}){let t,i=!1;const r=d=>{if(t&&t!==d)throw new Error("Context conflict")};let o;if(e.asyncContext){const d=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;d?o=new d:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const l=()=>{if(o){const d=o.getStore();if(d!==void 0)return d}return t};return{use:()=>{const d=l();if(d===void 0)throw new Error("Context is not available");return d},tryUse:()=>l(),set:(d,n)=>{n||r(d),t=d,i=!0},unset:()=>{t=void 0,i=!1},call:(d,n)=>{r(d),t=d;try{return o?o.run(d,n):n()}finally{i||(t=void 0)}},async callAsync(d,n){t=d;const S=()=>{t=d},C=()=>t===d?S:void 0;asyncHandlers.add(C);try{const I=o?o.run(d,n):n();return i||(t=void 0),await I}finally{asyncHandlers.delete(C)}}}}function createNamespace(e={}){const t={};return{get(i,r={}){return t[i]||(t[i]=createContext$1({...e,...r})),t[i]}}}const _globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},globalKey="__unctx__",defaultNamespace=_globalThis[globalKey]||(_globalThis[globalKey]=createNamespace()),getContext$1=(e,t={})=>defaultNamespace.get(e,t),asyncHandlersKey="__unctx_async_handlers__",asyncHandlers=_globalThis[asyncHandlersKey]||(_globalThis[asyncHandlersKey]=new Set);function executeAsync(e){const t=[];for(const o of asyncHandlers){const l=o();l&&t.push(l)}const i=()=>{for(const o of t)o()};let r=e();return r&&typeof r=="object"&&"catch"in r&&(r=r.catch(o=>{throw i(),o})),[r,i]}const appLayoutTransition=!1,appPageTransition=!1,appKeepalive=!1,nuxtLinkDefaults={componentName:"NuxtLink",prefetch:!0,prefetchOn:{visibility:!0}},nuxtDefaultErrorValue=null,vueAppRootContainer="#__nuxt",appId="nuxt-app",outdatedBuildInterval=36e5,chunkErrorEvent="vite:preloadError";function getNuxtAppCtx(e=appId){return getContext$1(e,{asyncContext:!1})}const NuxtPluginIndicator="__nuxt_plugin";function createNuxtApp(e){var o;let t=0;const i={_id:e.id||appId||"nuxt-app",_scope:effectScope(),provide:void 0,globalName:"nuxt",versions:{get nuxt(){return"3.17.4"},get vue(){return i.vueApp.version}},payload:shallowReactive({...((o=e.ssrContext)==null?void 0:o.payload)||{},data:shallowReactive({}),state:reactive({}),once:new Set,_errors:shallowReactive({})}),static:{data:{}},runWithContext(l){return i._scope.active&&!getCurrentScope()?i._scope.run(()=>callWithNuxt(i,l)):callWithNuxt(i,l)},isHydrating:!0,deferHydration(){if(!i.isHydrating)return()=>{};t++;let l=!1;return()=>{if(!l&&(l=!0,t--,t===0))return i.isHydrating=!1,i.callHook("app:suspense:resolve")}},_asyncDataPromises:{},_asyncData:shallowReactive({}),_payloadRevivers:{},...e};{const l=window.__NUXT__;if(l)for(const d in l)switch(d){case"data":case"state":case"_errors":Object.assign(i.payload[d],l[d]);break;default:i.payload[d]=l[d]}}i.hooks=createHooks$1(),i.hook=i.hooks.hook,i.callHook=i.hooks.callHook,i.provide=(l,d)=>{const n="$"+l;defineGetter(i,n,d),defineGetter(i.vueApp.config.globalProperties,n,d)},defineGetter(i.vueApp,"$nuxt",i),defineGetter(i.vueApp.config.globalProperties,"$nuxt",i);{window.addEventListener(chunkErrorEvent,d=>{i.callHook("app:chunkError",{error:d.payload}),d.payload.message.includes("Unable to preload CSS")&&d.preventDefault()}),window.useNuxtApp||(window.useNuxtApp=useNuxtApp);const l=i.hook("app:error",(...d)=>{console.error("[nuxt] error caught during app initialization",...d)});i.hook("app:mounted",l)}const r=i.payload.config;return i.provide("config",r),i}function registerPluginHooks(e,t){t.hooks&&e.hooks.addHooks(t.hooks)}async function applyPlugin(e,t){if(typeof t=="function"){const{provide:i}=await e.runWithContext(()=>t(e))||{};if(i&&typeof i=="object")for(const r in i)e.provide(r,i[r])}}async function applyPlugins(e,t){const i=new Set,r=[],o=[],l=[];let d=0;async function n(S){var I;const C=((I=S.dependsOn)==null?void 0:I.filter(z=>t.some($=>$._name===z)&&!i.has(z)))??[];if(C.length>0)r.push([new Set(C),S]);else{const z=applyPlugin(e,S).then(async()=>{S._name&&(i.add(S._name),await Promise.all(r.map(async([$,k])=>{$.has(S._name)&&($.delete(S._name),$.size===0&&(d++,await n(k)))})))});S.parallel?o.push(z.catch($=>l.push($))):await z}}for(const S of t)registerPluginHooks(e,S);for(const S of t)await n(S);if(await Promise.all(o),d)for(let S=0;S<d;S++)await Promise.all(o);if(l.length)throw l[0]}function defineNuxtPlugin(e){if(typeof e=="function")return e;const t=e._name||e.name;return delete e.name,Object.assign(e.setup||(()=>{}),e,{[NuxtPluginIndicator]:!0,_name:t})}const definePayloadPlugin=defineNuxtPlugin;function callWithNuxt(e,t,i){const r=()=>t();return getNuxtAppCtx(e._id).set(e),e.vueApp.runWithContext(r)}function tryUseNuxtApp(e){var i;let t;return hasInjectionContext()&&(t=(i=getCurrentInstance())==null?void 0:i.appContext.app.$nuxt),t||(t=getNuxtAppCtx(e).tryUse()),t||null}function useNuxtApp(e){const t=tryUseNuxtApp(e);if(!t)throw new Error("[nuxt] instance unavailable");return t}function useRuntimeConfig(e){return useNuxtApp().$config}function defineGetter(e,t,i){Object.defineProperty(e,t,{get:()=>i})}function _createMatcher(e,t){return{ctx:{table:e},matchAll:i=>_matchRoutes(i,e)}}function _createTableFromExport(e){const t={};for(const i in e)t[i]=i==="dynamic"?new Map(Object.entries(e[i]).map(([r,o])=>[r,_createTableFromExport(o)])):new Map(Object.entries(e[i]));return t}function createMatcherFromExport(e){return _createMatcher(_createTableFromExport(e))}function _matchRoutes(e,t,i){e.endsWith("/")&&(e=e.slice(0,-1)||"/");const r=[];for(const[l,d]of _sortRoutesMap(t.wildcard))(e===l||e.startsWith(l+"/"))&&r.push(d);for(const[l,d]of _sortRoutesMap(t.dynamic))if(e.startsWith(l+"/")){const n="/"+e.slice(l.length).split("/").splice(2).join("/");r.push(..._matchRoutes(n,d))}const o=t.static.get(e);return o&&r.push(o),r.filter(Boolean)}function _sortRoutesMap(e){return[...e.entries()].sort((t,i)=>t[0].length-i[0].length)}function isPlainObject$1(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function _defu(e,t,i=".",r){if(!isPlainObject$1(t))return _defu(e,{},i,r);const o=Object.assign({},t);for(const l in e){if(l==="__proto__"||l==="constructor")continue;const d=e[l];d!=null&&(r&&r(o,l,d,i)||(Array.isArray(d)&&Array.isArray(o[l])?o[l]=[...d,...o[l]]:isPlainObject$1(d)&&isPlainObject$1(o[l])?o[l]=_defu(d,o[l],(i?`${i}.`:"")+l.toString(),r):o[l]=d))}return o}function createDefu(e){return(...t)=>t.reduce((i,r)=>_defu(i,r,"",e),{})}const defu=createDefu(),defuFn=createDefu((e,t,i)=>{if(e[t]!==void 0&&typeof i=="function")return e[t]=i(e[t]),!0});function hasProp(e,t){try{return t in e}catch{return!1}}class H3Error extends Error{constructor(i,r={}){super(i,r);kn(this,"statusCode",500);kn(this,"fatal",!1);kn(this,"unhandled",!1);kn(this,"statusMessage");kn(this,"data");kn(this,"cause");r.cause&&!this.cause&&(this.cause=r.cause)}toJSON(){const i={message:this.message,statusCode:sanitizeStatusCode(this.statusCode,500)};return this.statusMessage&&(i.statusMessage=sanitizeStatusMessage(this.statusMessage)),this.data!==void 0&&(i.data=this.data),i}}kn(H3Error,"__h3_error__",!0);function createError$1(e){if(typeof e=="string")return new H3Error(e);if(isError(e))return e;const t=new H3Error(e.message??e.statusMessage??"",{cause:e.cause||e});if(hasProp(e,"stack"))try{Object.defineProperty(t,"stack",{get(){return e.stack}})}catch{try{t.stack=e.stack}catch{}}if(e.data&&(t.data=e.data),e.statusCode?t.statusCode=sanitizeStatusCode(e.statusCode,t.statusCode):e.status&&(t.statusCode=sanitizeStatusCode(e.status,t.statusCode)),e.statusMessage?t.statusMessage=e.statusMessage:e.statusText&&(t.statusMessage=e.statusText),t.statusMessage){const i=t.statusMessage;sanitizeStatusMessage(t.statusMessage)!==i&&console.warn("[h3] Please prefer using `message` for longer error messages instead of `statusMessage`. In the future, `statusMessage` will be sanitized by default.")}return e.fatal!==void 0&&(t.fatal=e.fatal),e.unhandled!==void 0&&(t.unhandled=e.unhandled),t}function isError(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.__h3_error__)===!0}const DISALLOWED_STATUS_CHARS=/[^\u0009\u0020-\u007E]/g;function sanitizeStatusMessage(e=""){return e.replace(DISALLOWED_STATUS_CHARS,"")}function sanitizeStatusCode(e,t=200){return!e||(typeof e=="string"&&(e=Number.parseInt(e,10)),e<100||e>999)?t:e}typeof setImmediate>"u"||setImmediate;const LayoutMetaSymbol=Symbol("layout-meta"),PageRouteSymbol=Symbol("route"),useRouter=()=>{var e;return(e=useNuxtApp())==null?void 0:e.$router},useRoute$1=()=>hasInjectionContext()?inject(PageRouteSymbol,useNuxtApp()._route):useNuxtApp()._route;function defineNuxtRouteMiddleware(e){return e}const isProcessingMiddleware=()=>{try{if(useNuxtApp()._processingMiddleware)return!0}catch{return!1}return!1},navigateTo=(e,t)=>{e||(e="/");const i=typeof e=="string"?e:"path"in e?resolveRouteObject(e):useRouter().resolve(e).href;if(t!=null&&t.open){const{target:S="_blank",windowFeatures:C={}}=t.open,I=Object.entries(C).filter(([z,$])=>$!==void 0).map(([z,$])=>`${z.toLowerCase()}=${$}`).join(", ");return open(i,S,I),Promise.resolve()}const r=hasProtocol(i,{acceptRelative:!0}),o=(t==null?void 0:t.external)||r;if(o){if(!(t!=null&&t.external))throw new Error("Navigating to an external URL is not allowed by default. Use `navigateTo(url, { external: true })`.");const{protocol:S}=new URL(i,window.location.href);if(S&&isScriptProtocol(S))throw new Error(`Cannot navigate to a URL with '${S}' protocol.`)}const l=isProcessingMiddleware();if(!o&&l){if(t!=null&&t.replace){if(typeof e=="string"){const{pathname:S,search:C,hash:I}=parseURL$1(e);return{path:S,...C&&{query:parseQuery$1(C)},...I&&{hash:I},replace:!0}}return{...e,replace:!0}}return e}const d=useRouter(),n=useNuxtApp();return o?(n._scope.stop(),t!=null&&t.replace?location.replace(i):location.href=i,l?n.isHydrating?new Promise(()=>{}):!1:Promise.resolve()):t!=null&&t.replace?d.replace(e):d.push(e)};function resolveRouteObject(e){return withQuery(e.path||"",e.query||{})+(e.hash||"")}const NUXT_ERROR_SIGNATURE="__nuxt_error",useError=()=>toRef(useNuxtApp().payload,"error"),showError=e=>{const t=createError(e);try{const i=useNuxtApp(),r=useError();i.hooks.callHook("app:error",t),r.value||(r.value=t)}catch{throw t}return t},clearError=async(e={})=>{const t=useNuxtApp(),i=useError();t.callHook("app:error:cleared",e),e.redirect&&await useRouter().replace(e.redirect),i.value=nuxtDefaultErrorValue},isNuxtError=e=>!!e&&typeof e=="object"&&NUXT_ERROR_SIGNATURE in e,createError=e=>{const t=createError$1(e);return Object.defineProperty(t,NUXT_ERROR_SIGNATURE,{value:!0,configurable:!1,writable:!1}),t};/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let activePinia;const setActivePinia=e=>activePinia=e,piniaSymbol=Symbol();function isPlainObject(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var MutationType;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(MutationType||(MutationType={}));function createPinia(){const e=effectScope(!0),t=e.run(()=>ref({}));let i=[],r=[];const o=markRaw({install(l){setActivePinia(o),o._a=l,l.provide(piniaSymbol,o),l.config.globalProperties.$pinia=o,r.forEach(d=>i.push(d)),r=[]},use(l){return this._a?i.push(l):r.push(l),this},_p:i,_a:null,_e:e,_s:new Map,state:t});return o}const noop$1=()=>{};function addSubscription(e,t,i,r=noop$1){e.push(t);const o=()=>{const l=e.indexOf(t);l>-1&&(e.splice(l,1),r())};return!i&&getCurrentScope()&&onScopeDispose(o),o}function triggerSubscriptions(e,...t){e.slice().forEach(i=>{i(...t)})}const fallbackRunWithContext=e=>e(),ACTION_MARKER=Symbol(),ACTION_NAME=Symbol();function mergeReactiveObjects(e,t){e instanceof Map&&t instanceof Map?t.forEach((i,r)=>e.set(r,i)):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const i in t){if(!t.hasOwnProperty(i))continue;const r=t[i],o=e[i];isPlainObject(o)&&isPlainObject(r)&&e.hasOwnProperty(i)&&!isRef(r)&&!isReactive(r)?e[i]=mergeReactiveObjects(o,r):e[i]=r}return e}const skipHydrateSymbol=Symbol();function shouldHydrate(e){return!isPlainObject(e)||!e.hasOwnProperty(skipHydrateSymbol)}const{assign:assign$1}=Object;function isComputed(e){return!!(isRef(e)&&e.effect)}function createOptionsStore(e,t,i,r){const{state:o,actions:l,getters:d}=t,n=i.state.value[e];let S;function C(){n||(i.state.value[e]=o?o():{});const I=toRefs(i.state.value[e]);return assign$1(I,l,Object.keys(d||{}).reduce((z,$)=>(z[$]=markRaw(computed(()=>{setActivePinia(i);const k=i._s.get(e);return d[$].call(k,k)})),z),{}))}return S=createSetupStore(e,C,t,i,r,!0),S}function createSetupStore(e,t,i={},r,o,l){let d;const n=assign$1({actions:{}},i),S={deep:!0};let C,I,z=[],$=[],k;const Y=r.state.value[e];!l&&!Y&&(r.state.value[e]={}),ref({});let ie;function ue(Et){let Lt;C=I=!1,typeof Et=="function"?(Et(r.state.value[e]),Lt={type:MutationType.patchFunction,storeId:e,events:k}):(mergeReactiveObjects(r.state.value[e],Et),Lt={type:MutationType.patchObject,payload:Et,storeId:e,events:k});const Zt=ie=Symbol();nextTick().then(()=>{ie===Zt&&(C=!0)}),I=!0,triggerSubscriptions(z,Lt,r.state.value[e])}const ne=l?function(){const{state:Lt}=i,Zt=Lt?Lt():{};this.$patch(Ht=>{assign$1(Ht,Zt)})}:noop$1;function se(){d.stop(),z=[],$=[],r._s.delete(e)}const le=(Et,Lt="")=>{if(ACTION_MARKER in Et)return Et[ACTION_NAME]=Lt,Et;const Zt=function(){setActivePinia(r);const Ht=Array.from(arguments),It=[],Yt=[];function ri(Ut){It.push(Ut)}function ei(Ut){Yt.push(Ut)}triggerSubscriptions($,{args:Ht,name:Zt[ACTION_NAME],store:me,after:ri,onError:ei});let Ct;try{Ct=Et.apply(this&&this.$id===e?this:me,Ht)}catch(Ut){throw triggerSubscriptions(Yt,Ut),Ut}return Ct instanceof Promise?Ct.then(Ut=>(triggerSubscriptions(It,Ut),Ut)).catch(Ut=>(triggerSubscriptions(Yt,Ut),Promise.reject(Ut))):(triggerSubscriptions(It,Ct),Ct)};return Zt[ACTION_MARKER]=!0,Zt[ACTION_NAME]=Lt,Zt},he={_p:r,$id:e,$onAction:addSubscription.bind(null,$),$patch:ue,$reset:ne,$subscribe(Et,Lt={}){const Zt=addSubscription(z,Et,Lt.detached,()=>Ht()),Ht=d.run(()=>watch$1(()=>r.state.value[e],It=>{(Lt.flush==="sync"?I:C)&&Et({storeId:e,type:MutationType.direct,events:k},It)},assign$1({},S,Lt)));return Zt},$dispose:se},me=reactive(he);r._s.set(e,me);const xt=(r._a&&r._a.runWithContext||fallbackRunWithContext)(()=>r._e.run(()=>(d=effectScope()).run(()=>t({action:le}))));for(const Et in xt){const Lt=xt[Et];if(isRef(Lt)&&!isComputed(Lt)||isReactive(Lt))l||(Y&&shouldHydrate(Lt)&&(isRef(Lt)?Lt.value=Y[Et]:mergeReactiveObjects(Lt,Y[Et])),r.state.value[e][Et]=Lt);else if(typeof Lt=="function"){const Zt=le(Lt,Et);xt[Et]=Zt,n.actions[Et]=Lt}}return assign$1(me,xt),assign$1(toRaw(me),xt),Object.defineProperty(me,"$state",{get:()=>r.state.value[e],set:Et=>{ue(Lt=>{assign$1(Lt,Et)})}}),r._p.forEach(Et=>{assign$1(me,d.run(()=>Et({store:me,app:r._a,pinia:r,options:n})))}),Y&&l&&i.hydrate&&i.hydrate(me.$state,Y),C=!0,I=!0,me}/*! #__NO_SIDE_EFFECTS__ */function defineStore(e,t,i){let r,o;const l=typeof t=="function";r=e,o=l?i:t;function d(n,S){const C=hasInjectionContext();return n=n||(C?inject(piniaSymbol,null):null),n&&setActivePinia(n),n=activePinia,n._s.has(r)||(l?createSetupStore(r,t,o,n):createOptionsStore(r,o,n)),n._s.get(r)}return d.$id=r,d}function decode64(e){const t=asciiToBinary(e),i=new ArrayBuffer(t.length),r=new DataView(i);for(let o=0;o<i.byteLength;o++)r.setUint8(o,t.charCodeAt(o));return i}const KEY_STRING="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function asciiToBinary(e){e.length%4===0&&(e=e.replace(/==?$/,""));let t="",i=0,r=0;for(let o=0;o<e.length;o++)i<<=6,i|=KEY_STRING.indexOf(e[o]),r+=6,r===24&&(t+=String.fromCharCode((i&16711680)>>16),t+=String.fromCharCode((i&65280)>>8),t+=String.fromCharCode(i&255),i=r=0);return r===12?(i>>=4,t+=String.fromCharCode(i)):r===18&&(i>>=2,t+=String.fromCharCode((i&65280)>>8),t+=String.fromCharCode(i&255)),t}const UNDEFINED=-1,HOLE=-2,NAN=-3,POSITIVE_INFINITY=-4,NEGATIVE_INFINITY=-5,NEGATIVE_ZERO=-6;function parse(e,t){return unflatten(JSON.parse(e),t)}function unflatten(e,t){if(typeof e=="number")return o(e,!0);if(!Array.isArray(e)||e.length===0)throw new Error("Invalid input");const i=e,r=Array(i.length);function o(l,d=!1){if(l===UNDEFINED)return;if(l===NAN)return NaN;if(l===POSITIVE_INFINITY)return 1/0;if(l===NEGATIVE_INFINITY)return-1/0;if(l===NEGATIVE_ZERO)return-0;if(d)throw new Error("Invalid input");if(l in r)return r[l];const n=i[l];if(!n||typeof n!="object")r[l]=n;else if(Array.isArray(n))if(typeof n[0]=="string"){const S=n[0],C=t==null?void 0:t[S];if(C)return r[l]=C(o(n[1]));switch(S){case"Date":r[l]=new Date(n[1]);break;case"Set":const I=new Set;r[l]=I;for(let k=1;k<n.length;k+=1)I.add(o(n[k]));break;case"Map":const z=new Map;r[l]=z;for(let k=1;k<n.length;k+=2)z.set(o(n[k]),o(n[k+1]));break;case"RegExp":r[l]=new RegExp(n[1],n[2]);break;case"Object":r[l]=Object(n[1]);break;case"BigInt":r[l]=BigInt(n[1]);break;case"null":const $=Object.create(null);r[l]=$;for(let k=1;k<n.length;k+=2)$[n[k]]=o(n[k+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const k=globalThis[S],Y=n[1],ie=decode64(Y),ue=new k(ie);r[l]=ue;break}case"ArrayBuffer":{const k=n[1],Y=decode64(k);r[l]=Y;break}default:throw new Error(`Unknown type ${S}`)}}else{const S=new Array(n.length);r[l]=S;for(let C=0;C<n.length;C+=1){const I=n[C];I!==HOLE&&(S[C]=o(I))}}else{const S={};r[l]=S;for(const C in n){const I=n[C];S[C]=o(I)}}return r[l]}return o(0)}const DupeableTags=new Set(["link","style","script","noscript"]),TagsWithInnerContent=new Set(["title","titleTemplate","script","style","noscript"]),HasElementTags=new Set(["base","meta","link","style","script","noscript"]),ValidHeadTags=new Set(["title","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"]),UniqueTags=new Set(["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"]),TagConfigKeys=new Set(["key","tagPosition","tagPriority","tagDuplicateStrategy","innerHTML","textContent","processTemplateParams"]),UsesMergeStrategy=new Set(["templateParams","htmlAttrs","bodyAttrs"]),MetaTagsArrayable=new Set(["theme-color","google-site-verification","og","article","book","profile","twitter","author"]);function defineHeadPlugin(e){return e}const allowedMetaProperties=["name","property","http-equiv"];function isMetaArrayDupeKey(e){const t=e.split(":");return t.length?MetaTagsArrayable.has(t[1]):!1}function dedupeKey(e){const{props:t,tag:i}=e;if(UniqueTags.has(i))return i;if(i==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";if(e.tag==="meta"){for(const r of allowedMetaProperties)if(t[r]!==void 0)return`${i}:${t[r]}`}if(e.key)return`${i}:key:${e.key}`;if(t.id)return`${i}:id:${t.id}`;if(TagsWithInnerContent.has(i)){const r=e.textContent||e.innerHTML;if(r)return`${i}:content:${r}`}}function hashTag(e){const t=e._h||e._d;if(t)return t;const i=e.textContent||e.innerHTML;return i||`${e.tag}:${Object.entries(e.props).map(([r,o])=>`${r}:${String(o)}`).join(",")}`}function walkResolver(e,t,i){typeof e==="function"&&(!i||i!=="titleTemplate"&&!(i[0]==="o"&&i[1]==="n"))&&(e=e());let o;if(t&&(o=t(i,e)),Array.isArray(o))return o.map(l=>walkResolver(l,t));if((o==null?void 0:o.constructor)===Object){const l={};for(const d of Object.keys(o))l[d]=walkResolver(o[d],t,d);return l}return o}function normalizeStyleClassProps(e,t){const i=e==="style"?new Map:new Set;function r(o){const l=o.trim();if(l)if(e==="style"){const[d,...n]=l.split(":").map(S=>S.trim());d&&n.length&&i.set(d,n.join(":"))}else l.split(" ").filter(Boolean).forEach(d=>i.add(d))}return typeof t=="string"?e==="style"?t.split(";").forEach(r):r(t):Array.isArray(t)?t.forEach(o=>r(o)):t&&typeof t=="object"&&Object.entries(t).forEach(([o,l])=>{l&&l!=="false"&&(e==="style"?i.set(o.trim(),l):r(o))}),i}function normalizeProps(e,t){return e.props=e.props||{},t&&Object.entries(t).forEach(([i,r])=>{if(r===null){e.props[i]=null;return}if(i==="class"||i==="style"){e.props[i]=normalizeStyleClassProps(i,r);return}if(TagConfigKeys.has(i)){if(["textContent","innerHTML"].includes(i)&&typeof r=="object"){let d=t.type;if(t.type||(d="application/json"),!(d!=null&&d.endsWith("json"))&&d!=="speculationrules")return;t.type=d,e.props.type=d,e[i]=JSON.stringify(r)}else e[i]=r;return}const o=String(r),l=i.startsWith("data-");o==="true"||o===""?e.props[i]=l?o:!0:!r&&l&&o==="false"?e.props[i]="false":r!==void 0&&(e.props[i]=r)}),e}function normalizeTag(e,t){const i=typeof t=="object"&&typeof t!="function"?t:{[e==="script"||e==="noscript"||e==="style"?"innerHTML":"textContent"]:t},r=normalizeProps({tag:e,props:{}},i);return r.key&&DupeableTags.has(r.tag)&&(r.props["data-hid"]=r._h=r.key),r.tag==="script"&&typeof r.innerHTML=="object"&&(r.innerHTML=JSON.stringify(r.innerHTML),r.props.type=r.props.type||"application/json"),Array.isArray(r.props.content)?r.props.content.map(o=>({...r,props:{...r.props,content:o}})):r}function normalizeEntryToTags(e,t){if(!e)return[];typeof e=="function"&&(e=e());const i=(o,l)=>{for(let d=0;d<t.length;d++)l=t[d](o,l);return l};e=i(void 0,e);const r=[];return e=walkResolver(e,i),Object.entries(e||{}).forEach(([o,l])=>{if(l!==void 0)for(const d of Array.isArray(l)?l:[l])r.push(normalizeTag(o,d))}),r.flat()}const sortTags=(e,t)=>e._w===t._w?e._p-t._p:e._w-t._w,TAG_WEIGHTS={base:-10,title:10},TAG_ALIASES={critical:-8,high:-1,low:2},WEIGHT_MAP={meta:{"content-security-policy":-30,charset:-20,viewport:-15},link:{preconnect:20,stylesheet:60,preload:70,modulepreload:70,prefetch:90,"dns-prefetch":90,prerender:90},script:{async:30,defer:80,sync:50},style:{imported:40,sync:60}},ImportStyleRe=/@import/,isTruthy=e=>e===""||e===!0;function tagWeight(e,t){var l;if(typeof t.tagPriority=="number")return t.tagPriority;let i=100;const r=TAG_ALIASES[t.tagPriority]||0,o=e.resolvedOptions.disableCapoSorting?{link:{},script:{},style:{}}:WEIGHT_MAP;if(t.tag in TAG_WEIGHTS)i=TAG_WEIGHTS[t.tag];else if(t.tag==="meta"){const d=t.props["http-equiv"]==="content-security-policy"?"content-security-policy":t.props.charset?"charset":t.props.name==="viewport"?"viewport":null;d&&(i=WEIGHT_MAP.meta[d])}else t.tag==="link"&&t.props.rel?i=o.link[t.props.rel]:t.tag==="script"?isTruthy(t.props.async)?i=o.script.async:t.props.src&&!isTruthy(t.props.defer)&&!isTruthy(t.props.async)&&t.props.type!=="module"&&!((l=t.props.type)!=null&&l.endsWith("json"))?i=o.script.sync:isTruthy(t.props.defer)&&t.props.src&&!isTruthy(t.props.async)&&(i=o.script.defer):t.tag==="style"&&(i=t.innerHTML&&ImportStyleRe.test(t.innerHTML)?o.style.imported:o.style.sync);return(i||100)+r}function registerPlugin(e,t){const i=typeof t=="function"?t(e):t,r=i.key||String(e.plugins.size+1);e.plugins.get(r)||(e.plugins.set(r,i),e.hooks.addHooks(i.hooks||{}))}function createUnhead(e={}){var n;const t=createHooks$1();t.addHooks(e.hooks||{});const i=!e.document,r=new Map,o=new Map,l=[],d={_entryCount:1,plugins:o,dirty:!1,resolvedOptions:e,hooks:t,ssr:i,entries:r,headEntries(){return[...r.values()]},use:S=>registerPlugin(d,S),push(S,C){const I={...C||{}};delete I.head;const z=I._index??d._entryCount++,$={_i:z,input:S,options:I},k={_poll(Y=!1){d.dirty=!0,!Y&&l.push(z),t.callHook("entries:updated",d)},dispose(){r.delete(z)&&k._poll(!0)},patch(Y){(!I.mode||I.mode==="server"&&i||I.mode==="client"&&!i)&&($.input=Y,r.set(z,$),k._poll())}};return k.patch(S),k},async resolveTags(){var k;const S={tagMap:new Map,tags:[],entries:[...d.entries.values()]};for(await t.callHook("entries:resolve",S);l.length;){const Y=l.shift(),ie=r.get(Y);if(ie){const ue={tags:normalizeEntryToTags(ie.input,e.propResolvers||[]).map(ne=>Object.assign(ne,ie.options)),entry:ie};await t.callHook("entries:normalize",ue),ie._tags=ue.tags.map((ne,se)=>(ne._w=tagWeight(d,ne),ne._p=(ie._i<<10)+se,ne._d=dedupeKey(ne),ne))}}let C=!1;S.entries.flatMap(Y=>(Y._tags||[]).map(ie=>({...ie,props:{...ie.props}}))).sort(sortTags).reduce((Y,ie)=>{const ue=String(ie._d||ie._p);if(!Y.has(ue))return Y.set(ue,ie);const ne=Y.get(ue);if(((ie==null?void 0:ie.tagDuplicateStrategy)||(UsesMergeStrategy.has(ie.tag)?"merge":null)||(ie.key&&ie.key===ne.key?"merge":null))==="merge"){const le={...ne.props};Object.entries(ie.props).forEach(([he,me])=>le[he]=he==="style"?new Map([...ne.props.style||new Map,...me]):he==="class"?new Set([...ne.props.class||new Set,...me]):me),Y.set(ue,{...ie,props:le})}else ie._p>>10===ne._p>>10&&ie.tag==="meta"&&isMetaArrayDupeKey(ue)?(Y.set(ue,Object.assign([...Array.isArray(ne)?ne:[ne],ie],ie)),C=!0):(ie._w===ne._w?ie._p>ne._p:(ie==null?void 0:ie._w)<(ne==null?void 0:ne._w))&&Y.set(ue,ie);return Y},S.tagMap);const I=S.tagMap.get("title"),z=S.tagMap.get("titleTemplate");if(d._title=I==null?void 0:I.textContent,z){const Y=z==null?void 0:z.textContent;if(d._titleTemplate=Y,Y){let ie=typeof Y=="function"?Y(I==null?void 0:I.textContent):Y;typeof ie=="string"&&!d.plugins.has("template-params")&&(ie=ie.replace("%s",(I==null?void 0:I.textContent)||"")),I?ie===null?S.tagMap.delete("title"):S.tagMap.set("title",{...I,textContent:ie}):(z.tag="title",z.textContent=ie)}}S.tags=Array.from(S.tagMap.values()),C&&(S.tags=S.tags.flat().sort(sortTags)),await t.callHook("tags:beforeResolve",S),await t.callHook("tags:resolve",S),await t.callHook("tags:afterResolve",S);const $=[];for(const Y of S.tags){const{innerHTML:ie,tag:ue,props:ne}=Y;if(ValidHeadTags.has(ue)&&!(Object.keys(ne).length===0&&!Y.innerHTML&&!Y.textContent)&&!(ue==="meta"&&!ne.content&&!ne["http-equiv"]&&!ne.charset)){if(ue==="script"&&ie){if((k=ne.type)!=null&&k.endsWith("json")){const se=typeof ie=="string"?ie:JSON.stringify(ie);Y.innerHTML=se.replace(/</g,"\\u003C")}else typeof ie=="string"&&(Y.innerHTML=ie.replace(new RegExp(`</${ue}`,"g"),`<\\/${ue}`));Y._d=dedupeKey(Y)}$.push(Y)}}return $}};return((e==null?void 0:e.plugins)||[]).forEach(S=>registerPlugin(d,S)),d.hooks.callHook("init",d),(n=e.init)==null||n.forEach(S=>S&&d.push(S)),d}const SepSub="%separator",SepSubRE=new RegExp(`${SepSub}(?:\\s*${SepSub})*`,"g");function sub(e,t,i=!1){var o;let r;if(t==="s"||t==="pageTitle")r=e.pageTitle;else if(t.includes(".")){const l=t.indexOf(".");r=(o=e[t.substring(0,l)])==null?void 0:o[t.substring(l+1)]}else r=e[t];if(r!==void 0)return i?(r||"").replace(/\\/g,"\\\\").replace(/</g,"\\u003C").replace(/"/g,'\\"'):r||""}function processTemplateParams(e,t,i,r=!1){if(typeof e!="string"||!e.includes("%"))return e;let o=e;try{o=decodeURI(e)}catch{}const l=o.match(/%\w+(?:\.\w+)?/g);if(!l)return e;const d=e.includes(SepSub);return e=e.replace(/%\w+(?:\.\w+)?/g,n=>{if(n===SepSub||!l.includes(n))return n;const S=sub(t,n.slice(1),r);return S!==void 0?S:n}).trim(),d&&(e.endsWith(SepSub)&&(e=e.slice(0,-SepSub.length)),e.startsWith(SepSub)&&(e=e.slice(SepSub.length)),e=e.replace(SepSubRE,i||"").trim()),e}const formatKey=e=>e.includes(":key")?e:e.split(":").join(":key:"),AliasSortingPlugin={key:"aliasSorting",hooks:{"tags:resolve":e=>{let t=!1;for(const i of e.tags){const r=i.tagPriority;if(!r)continue;const o=String(r);if(o.startsWith("before:")){const l=formatKey(o.slice(7)),d=e.tagMap.get(l);d&&(typeof d.tagPriority=="number"&&(i.tagPriority=d.tagPriority),i._p=d._p-1,t=!0)}else if(o.startsWith("after:")){const l=formatKey(o.slice(6)),d=e.tagMap.get(l);d&&(typeof d.tagPriority=="number"&&(i.tagPriority=d.tagPriority),i._p=d._p+1,t=!0)}}t&&(e.tags=e.tags.sort(sortTags))}}},DeprecationsPlugin={key:"deprecations",hooks:{"entries:normalize":({tags:e})=>{for(const t of e)t.props.children&&(t.innerHTML=t.props.children,delete t.props.children),t.props.hid&&(t.key=t.props.hid,delete t.props.hid),t.props.vmid&&(t.key=t.props.vmid,delete t.props.vmid),t.props.body&&(t.tagPosition="bodyClose",delete t.props.body)}}};async function walkPromises(e){if(typeof e==="function")return e;if(e instanceof Promise)return await e;if(Array.isArray(e))return await Promise.all(e.map(i=>walkPromises(i)));if((e==null?void 0:e.constructor)===Object){const i={};for(const r of Object.keys(e))i[r]=await walkPromises(e[r]);return i}return e}const PromisesPlugin={key:"promises",hooks:{"entries:resolve":async e=>{const t=[];for(const i in e.entries)e.entries[i]._promisesProcessed||t.push(walkPromises(e.entries[i].input).then(r=>{e.entries[i].input=r,e.entries[i]._promisesProcessed=!0}));await Promise.all(t)}}},SupportedAttrs={meta:"content",link:"href",htmlAttrs:"lang"},contentAttrs=["innerHTML","textContent"],TemplateParamsPlugin=e=>({key:"template-params",hooks:{"entries:normalize":t=>{var r,o,l;const i=((o=(r=t.tags.filter(d=>d.tag==="templateParams"&&d.mode==="server"))==null?void 0:r[0])==null?void 0:o.props)||{};Object.keys(i).length&&(e._ssrPayload={templateParams:{...((l=e._ssrPayload)==null?void 0:l.templateParams)||{},...i}})},"tags:resolve":({tagMap:t,tags:i})=>{var l;const r=((l=t.get("templateParams"))==null?void 0:l.props)||{},o=r.separator||"|";delete r.separator,r.pageTitle=processTemplateParams(r.pageTitle||e._title||"",r,o);for(const d of i){if(d.processTemplateParams===!1)continue;const n=SupportedAttrs[d.tag];if(n&&typeof d.props[n]=="string")d.props[n]=processTemplateParams(d.props[n],r,o);else if(d.processTemplateParams||d.tag==="titleTemplate"||d.tag==="title")for(const S of contentAttrs)typeof d[S]=="string"&&(d[S]=processTemplateParams(d[S],r,o,d.tag==="script"&&d.props.type.endsWith("json")))}e._templateParams=r,e._separator=o},"tags:afterResolve":({tagMap:t})=>{const i=t.get("title");i!=null&&i.textContent&&i.processTemplateParams!==!1&&(i.textContent=processTemplateParams(i.textContent,e._templateParams,e._separator))}}}),VueResolver=(e,t)=>isRef(t)?toValue(t):t,headSymbol="usehead";function vueInstall(e){return{install(i){i.config.globalProperties.$unhead=e,i.config.globalProperties.$head=e,i.provide(headSymbol,e)}}.install}function injectHead$1(){if(hasInjectionContext()){const e=inject(headSymbol);if(!e)throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.");return e}throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.")}function useHead$1(e,t={}){const i=t.head||injectHead$1();return i.ssr?i.push(e||{},t):clientUseHead(i,e,t)}function clientUseHead(e,t,i={}){const r=ref(!1);let o;return watchEffect(()=>{const d=r.value?{}:walkResolver(t,VueResolver);o?o.patch(d):o=e.push(d,i)}),getCurrentInstance()&&(onBeforeUnmount(()=>{o.dispose()}),onDeactivated(()=>{r.value=!0}),onActivated(()=>{r.value=!1})),o}function injectHead(e){var i;const t=e||tryUseNuxtApp();return((i=t==null?void 0:t.ssrContext)==null?void 0:i.head)||(t==null?void 0:t.runWithContext(()=>{if(hasInjectionContext())return inject(headSymbol)}))}function useHead(e,t={}){const i=injectHead(t.nuxt);if(i)return useHead$1(e,{head:i,...t})}const scriptRel="modulepreload",assetsURL=function(e,t){return new URL(e,t).href},seen={},__vitePreload=function(t,i,r){let o=Promise.resolve();if(i&&i.length>0){let d=function(I){return Promise.all(I.map(z=>Promise.resolve(z).then($=>({status:"fulfilled",value:$}),$=>({status:"rejected",reason:$}))))};const n=document.getElementsByTagName("link"),S=document.querySelector("meta[property=csp-nonce]"),C=(S==null?void 0:S.nonce)||(S==null?void 0:S.getAttribute("nonce"));o=d(i.map(I=>{if(I=assetsURL(I,r),I in seen)return;seen[I]=!0;const z=I.endsWith(".css"),$=z?'[rel="stylesheet"]':"";if(!!r)for(let ie=n.length-1;ie>=0;ie--){const ue=n[ie];if(ue.href===I&&(!z||ue.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${I}"]${$}`))return;const Y=document.createElement("link");if(Y.rel=z?"stylesheet":scriptRel,z||(Y.as="script"),Y.crossOrigin="",Y.href=I,C&&Y.setAttribute("nonce",C),document.head.appendChild(Y),z)return new Promise((ie,ue)=>{Y.addEventListener("load",ie),Y.addEventListener("error",()=>ue(new Error(`Unable to preload CSS for ${I}`)))})}))}function l(d){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=d,window.dispatchEvent(n),!n.defaultPrevented)throw d}return o.then(d=>{for(const n of d||[])n.status==="rejected"&&l(n.reason);return t().catch(l)})};let manifest,matcher;function fetchManifest(){return manifest=$fetch(buildAssetsURL(`builds/meta/${useRuntimeConfig().app.buildId}.json`),{responseType:"json"}),manifest.then(e=>{matcher=createMatcherFromExport(e.matcher)}).catch(e=>{console.error("[nuxt] Error fetching app manifest.",e)}),manifest}function getAppManifest(){return manifest||fetchManifest()}async function getRouteRules(e){const t=typeof e=="string"?e:e.path;if(await getAppManifest(),!matcher)return console.error("[nuxt] Error creating app manifest matcher.",matcher),{};try{return defu({},...matcher.matchAll(t).reverse())}catch(i){return console.error("[nuxt] Error matching route rules.",i),{}}}async function loadPayload(e,t={}){if(!await isPrerendered(e))return null;const r=await _getPayloadURL(e,t);return await _importPayload(r)||null}const filename="_payload.json";async function _getPayloadURL(e,t={}){const i=new URL(e,"http://localhost");if(i.host!=="localhost"||hasProtocol(i.pathname,{acceptRelative:!0}))throw new Error("Payload URL must not include hostname: "+e);const r=useRuntimeConfig(),o=t.hash||(t.fresh?Date.now():r.app.buildId),l=r.app.cdnURL,d=l&&await isPrerendered(e)?l:r.app.baseURL;return joinURL(d,i.pathname,filename+(o?`?${o}`:""))}async function _importPayload(e){const t=fetch(e,{cache:"force-cache"}).then(i=>i.text().then(parsePayload));try{return await t}catch(i){console.warn("[nuxt] Cannot load payload ",e,i)}return null}async function isPrerendered(e=useRoute$1().path){const t=useNuxtApp();return e=withoutTrailingSlash(e),(await getAppManifest()).prerendered.includes(e)?!0:t.runWithContext(async()=>{const r=await getRouteRules({path:e});return!!r.prerender&&!r.redirect})}let payloadCache=null;async function getNuxtClientPayload(){var r;if(payloadCache)return payloadCache;const e=document.getElementById("__NUXT_DATA__");if(!e)return{};const t=await parsePayload(e.textContent||""),i=e.dataset.src?await _importPayload(e.dataset.src):void 0;return payloadCache={...t,...i,...window.__NUXT__},(r=payloadCache.config)!=null&&r.public&&(payloadCache.config.public=reactive(payloadCache.config.public)),payloadCache}async function parsePayload(e){return await parse(e,useNuxtApp()._payloadRevivers)}function definePayloadReviver(e,t){useNuxtApp()._payloadRevivers[e]=t}const payloadPlugin=definePayloadPlugin(()=>{definePayloadReviver("skipHydrate",e=>{})}),revivers=[["NuxtError",e=>createError(e)],["EmptyShallowRef",e=>shallowRef(e==="_"?void 0:e==="0n"?BigInt(0):destr(e))],["EmptyRef",e=>ref(e==="_"?void 0:e==="0n"?BigInt(0):destr(e))],["ShallowRef",e=>shallowRef(e)],["ShallowReactive",e=>shallowReactive(e)],["Ref",e=>ref(e)],["Reactive",e=>reactive(e)]],revive_payload_client_kG4vF4SWGlhgLJRKrmco1O_zuG41odAu7e9PNPCDOtY=defineNuxtPlugin({name:"nuxt:revive-payload:client",order:-30,async setup(e){let t,i;for(const[r,o]of revivers)definePayloadReviver(r,o);Object.assign(e.payload,([t,i]=executeAsync(()=>e.runWithContext(getNuxtClientPayload)),t=await t,i(),t)),window.__NUXT__=e.payload}});async function renderDOMHead(e,t={}){const i=t.document||e.resolvedOptions.document;if(!i||!e.dirty)return;const r={shouldRender:!0,tags:[]};if(await e.hooks.callHook("dom:beforeRender",r),!!r.shouldRender)return e._domUpdatePromise||(e._domUpdatePromise=new Promise(async o=>{var k;const l=new Map,d=new Promise(Y=>{e.resolveTags().then(ie=>{Y(ie.map(ue=>{const ne=l.get(ue._d)||0,se={tag:ue,id:(ne?`${ue._d}:${ne}`:ue._d)||hashTag(ue),shouldRender:!0};return ue._d&&isMetaArrayDupeKey(ue._d)&&l.set(ue._d,ne+1),se}))})});let n=e._dom;if(!n){n={title:i.title,elMap:new Map().set("htmlAttrs",i.documentElement).set("bodyAttrs",i.body)};for(const Y of["body","head"]){const ie=(k=i[Y])==null?void 0:k.children;for(const ue of ie){const ne=ue.tagName.toLowerCase();if(!HasElementTags.has(ne))continue;const se=normalizeProps({tag:ne,props:{}},{innerHTML:ue.innerHTML,...ue.getAttributeNames().reduce((le,he)=>(le[he]=ue.getAttribute(he),le),{})||{}});if(se.key=ue.getAttribute("data-hid")||void 0,se._d=dedupeKey(se)||hashTag(se),n.elMap.has(se._d)){let le=1,he=se._d;for(;n.elMap.has(he);)he=`${se._d}:${le++}`;n.elMap.set(he,ue)}else n.elMap.set(se._d,ue)}}}n.pendingSideEffects={...n.sideEffects},n.sideEffects={};function S(Y,ie,ue){const ne=`${Y}:${ie}`;n.sideEffects[ne]=ue,delete n.pendingSideEffects[ne]}function C({id:Y,$el:ie,tag:ue}){const ne=ue.tag.endsWith("Attrs");n.elMap.set(Y,ie),ne||(ue.textContent&&ue.textContent!==ie.textContent&&(ie.textContent=ue.textContent),ue.innerHTML&&ue.innerHTML!==ie.innerHTML&&(ie.innerHTML=ue.innerHTML),S(Y,"el",()=>{ie==null||ie.remove(),n.elMap.delete(Y)}));for(const se in ue.props){if(!Object.prototype.hasOwnProperty.call(ue.props,se))continue;const le=ue.props[se];if(se.startsWith("on")&&typeof le=="function"){const me=ie==null?void 0:ie.dataset;if(me&&me[`${se}fired`]){const ge=se.slice(0,-5);le.call(ie,new Event(ge.substring(2)))}ie.getAttribute(`data-${se}`)!==""&&((ue.tag==="bodyAttrs"?i.defaultView:ie).addEventListener(se.substring(2),le.bind(ie)),ie.setAttribute(`data-${se}`,""));continue}const he=`attr:${se}`;if(se==="class"){if(!le)continue;for(const me of le)ne&&S(Y,`${he}:${me}`,()=>ie.classList.remove(me)),!ie.classList.contains(me)&&ie.classList.add(me)}else if(se==="style"){if(!le)continue;for(const[me,ge]of le)S(Y,`${he}:${me}`,()=>{ie.style.removeProperty(me)}),ie.style.setProperty(me,ge)}else le!==!1&&le!==null&&(ie.getAttribute(se)!==le&&ie.setAttribute(se,le===!0?"":String(le)),ne&&S(Y,he,()=>ie.removeAttribute(se)))}}const I=[],z={bodyClose:void 0,bodyOpen:void 0,head:void 0},$=await d;for(const Y of $){const{tag:ie,shouldRender:ue,id:ne}=Y;if(ue){if(ie.tag==="title"){i.title=ie.textContent,S("title","",()=>i.title=n.title);continue}Y.$el=Y.$el||n.elMap.get(ne),Y.$el?C(Y):HasElementTags.has(ie.tag)&&I.push(Y)}}for(const Y of I){const ie=Y.tag.tagPosition||"head";Y.$el=i.createElement(Y.tag.tag),C(Y),z[ie]=z[ie]||i.createDocumentFragment(),z[ie].appendChild(Y.$el)}for(const Y of $)await e.hooks.callHook("dom:renderTag",Y,i,S);z.head&&i.head.appendChild(z.head),z.bodyOpen&&i.body.insertBefore(z.bodyOpen,i.body.firstChild),z.bodyClose&&i.body.appendChild(z.bodyClose);for(const Y in n.pendingSideEffects)n.pendingSideEffects[Y]();e._dom=n,await e.hooks.callHook("dom:rendered",{renders:$}),o()}).finally(()=>{e._domUpdatePromise=void 0,e.dirty=!1})),e._domUpdatePromise}function createHead$1(e={}){var r,o,l;const t=((r=e.domOptions)==null?void 0:r.render)||renderDOMHead;e.document=e.document||(typeof window<"u"?document:void 0);const i=((l=(o=e.document)==null?void 0:o.head.querySelector('script[id="unhead:payload"]'))==null?void 0:l.innerHTML)||!1;return createUnhead({...e,plugins:[...e.plugins||[],{key:"client",hooks:{"entries:updated":t}}],init:[i?JSON.parse(i):!1,...e.init||[]]})}function createDebouncedFn(e,t){let i=0;return()=>{const r=++i;t(()=>{i===r&&e()})}}function createHead(e={}){const t=createHead$1({domOptions:{render:createDebouncedFn(()=>renderDOMHead(t),i=>setTimeout(i,0))},...e});return t.install=vueInstall(t),t}const unheadOptions={disableDefaults:!0,disableCapoSorting:!1,plugins:[DeprecationsPlugin,PromisesPlugin,TemplateParamsPlugin,AliasSortingPlugin]},unhead_k2P3m_ZDyjlr2mMYnoDPwavjsDN8hBlk9cFai0bbopU=defineNuxtPlugin({name:"nuxt:head",enforce:"pre",setup(e){const t=createHead(unheadOptions);e.vueApp.use(t);{let i=!0;const r=async()=>{i=!1,await renderDOMHead(t)};t.hooks.hook("dom:beforeRender",o=>{o.shouldRender=!i}),e.hooks.hook("page:start",()=>{i=!0}),e.hooks.hook("page:finish",()=>{e.isHydrating||r()}),e.hooks.hook("app:error",r),e.hooks.hook("app:suspense:resolve",r)}}});/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser$2=typeof document<"u";function isRouteComponent(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function isESModule(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&isRouteComponent(e.default)}const assign=Object.assign;function applyToParams(e,t){const i={};for(const r in t){const o=t[r];i[r]=isArray(o)?o.map(e):e(o)}return i}const noop=()=>{},isArray=Array.isArray,HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(e){return encodeURI(""+e).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(e){return commonEncode(e).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(e){return commonEncode(e).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(e){return encodeQueryValue(e).replace(EQUAL_RE,"%3D")}function encodePath(e){return commonEncode(e).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(e){return e==null?"":encodePath(e).replace(SLASH_RE,"%2F")}function decode(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=e=>e.replace(TRAILING_SLASH_RE,"");function parseURL(e,t,i="/"){let r,o={},l="",d="";const n=t.indexOf("#");let S=t.indexOf("?");return n<S&&n>=0&&(S=-1),S>-1&&(r=t.slice(0,S),l=t.slice(S+1,n>-1?n:t.length),o=e(l)),n>-1&&(r=r||t.slice(0,n),d=t.slice(n,t.length)),r=resolveRelativePath(r??t,i),{fullPath:r+(l&&"?")+l+d,path:r,query:o,hash:decode(d)}}function stringifyURL(e,t){const i=t.query?e(t.query):"";return t.path+(i&&"?")+i+(t.hash||"")}function stripBase(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function isSameRouteLocation(e,t,i){const r=t.matched.length-1,o=i.matched.length-1;return r>-1&&r===o&&isSameRouteRecord(t.matched[r],i.matched[o])&&isSameRouteLocationParams(t.params,i.params)&&e(t.query)===e(i.query)&&t.hash===i.hash}function isSameRouteRecord(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function isSameRouteLocationParams(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!isSameRouteLocationParamsValue(e[i],t[i]))return!1;return!0}function isSameRouteLocationParamsValue(e,t){return isArray(e)?isEquivalentArray(e,t):isArray(t)?isEquivalentArray(t,e):e===t}function isEquivalentArray(e,t){return isArray(t)?e.length===t.length&&e.every((i,r)=>i===t[r]):e.length===1&&e[0]===t}function resolveRelativePath(e,t){if(e.startsWith("/"))return e;if(!e)return t;const i=t.split("/"),r=e.split("/"),o=r[r.length-1];(o===".."||o===".")&&r.push("");let l=i.length-1,d,n;for(d=0;d<r.length;d++)if(n=r[d],n!==".")if(n==="..")l>1&&l--;else break;return i.slice(0,l).join("/")+"/"+r.slice(d).join("/")}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var NavigationType;(function(e){e.pop="pop",e.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(e){e.back="back",e.forward="forward",e.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(e){if(!e)if(isBrowser$2){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),removeTrailingSlash(e)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(e,t){return e.replace(BEFORE_HASH_RE,"#")+t}function getElementPosition(e,t){const i=document.documentElement.getBoundingClientRect(),r=e.getBoundingClientRect();return{behavior:t.behavior,left:r.left-i.left-(t.left||0),top:r.top-i.top-(t.top||0)}}const computeScrollPosition=()=>({left:window.scrollX,top:window.scrollY});function scrollToPosition(e){let t;if("el"in e){const i=e.el,r=typeof i=="string"&&i.startsWith("#"),o=typeof i=="string"?r?document.getElementById(i.slice(1)):document.querySelector(i):i;if(!o)return;t=getElementPosition(o,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function getScrollKey(e,t){return(history.state?history.state.position-t:-1)+e}const scrollPositions=new Map;function saveScrollPosition(e,t){scrollPositions.set(e,t)}function getSavedScrollPosition(e){const t=scrollPositions.get(e);return scrollPositions.delete(e),t}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation$1(e,t){const{pathname:i,search:r,hash:o}=t,l=e.indexOf("#");if(l>-1){let n=o.includes(e.slice(l))?e.slice(l).length:1,S=o.slice(n);return S[0]!=="/"&&(S="/"+S),stripBase(S,"")}return stripBase(i,e)+r+o}function useHistoryListeners(e,t,i,r){let o=[],l=[],d=null;const n=({state:$})=>{const k=createCurrentLocation$1(e,location),Y=i.value,ie=t.value;let ue=0;if($){if(i.value=k,t.value=$,d&&d===Y){d=null;return}ue=ie?$.position-ie.position:0}else r(k);o.forEach(ne=>{ne(i.value,Y,{delta:ue,type:NavigationType.pop,direction:ue?ue>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function S(){d=i.value}function C($){o.push($);const k=()=>{const Y=o.indexOf($);Y>-1&&o.splice(Y,1)};return l.push(k),k}function I(){const{history:$}=window;$.state&&$.replaceState(assign({},$.state,{scroll:computeScrollPosition()}),"")}function z(){for(const $ of l)$();l=[],window.removeEventListener("popstate",n),window.removeEventListener("beforeunload",I)}return window.addEventListener("popstate",n),window.addEventListener("beforeunload",I,{passive:!0}),{pauseListeners:S,listen:C,destroy:z}}function buildState(e,t,i,r=!1,o=!1){return{back:e,current:t,forward:i,replaced:r,position:window.history.length,scroll:o?computeScrollPosition():null}}function useHistoryStateNavigation(e){const{history:t,location:i}=window,r={value:createCurrentLocation$1(e,i)},o={value:t.state};o.value||l(r.value,{back:null,current:r.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function l(S,C,I){const z=e.indexOf("#"),$=z>-1?(i.host&&document.querySelector("base")?e:e.slice(z))+S:createBaseLocation()+e+S;try{t[I?"replaceState":"pushState"](C,"",$),o.value=C}catch(k){console.error(k),i[I?"replace":"assign"]($)}}function d(S,C){const I=assign({},t.state,buildState(o.value.back,S,o.value.forward,!0),C,{position:o.value.position});l(S,I,!0),r.value=S}function n(S,C){const I=assign({},o.value,t.state,{forward:S,scroll:computeScrollPosition()});l(I.current,I,!0);const z=assign({},buildState(r.value,S,null),{position:I.position+1},C);l(S,z,!1),r.value=S}return{location:r,state:o,push:n,replace:d}}function createWebHistory(e){e=normalizeBase(e);const t=useHistoryStateNavigation(e),i=useHistoryListeners(e,t.state,t.location,t.replace);function r(l,d=!0){d||i.pauseListeners(),history.go(l)}const o=assign({location:"",base:e,go:r,createHref:createHref.bind(null,e)},t,i);return Object.defineProperty(o,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(o,"state",{enumerable:!0,get:()=>t.state.value}),o}function isRouteLocation(e){return typeof e=="string"||e&&typeof e=="object"}function isRouteName(e){return typeof e=="string"||typeof e=="symbol"}const NavigationFailureSymbol=Symbol("");var NavigationFailureType;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(e,t){return assign(new Error,{type:e,[NavigationFailureSymbol]:!0},t)}function isNavigationFailure(e,t){return e instanceof Error&&NavigationFailureSymbol in e&&(t==null||!!(e.type&t))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(e,t){const i=assign({},BASE_PATH_PARSER_OPTIONS,t),r=[];let o=i.start?"^":"";const l=[];for(const C of e){const I=C.length?[]:[90];i.strict&&!C.length&&(o+="/");for(let z=0;z<C.length;z++){const $=C[z];let k=40+(i.sensitive?.25:0);if($.type===0)z||(o+="/"),o+=$.value.replace(REGEX_CHARS_RE,"\\$&"),k+=40;else if($.type===1){const{value:Y,repeatable:ie,optional:ue,regexp:ne}=$;l.push({name:Y,repeatable:ie,optional:ue});const se=ne||BASE_PARAM_PATTERN;if(se!==BASE_PARAM_PATTERN){k+=10;try{new RegExp(`(${se})`)}catch(he){throw new Error(`Invalid custom RegExp for param "${Y}" (${se}): `+he.message)}}let le=ie?`((?:${se})(?:/(?:${se}))*)`:`(${se})`;z||(le=ue&&C.length<2?`(?:/${le})`:"/"+le),ue&&(le+="?"),o+=le,k+=20,ue&&(k+=-8),ie&&(k+=-20),se===".*"&&(k+=-50)}I.push(k)}r.push(I)}if(i.strict&&i.end){const C=r.length-1;r[C][r[C].length-1]+=.7000000000000001}i.strict||(o+="/?"),i.end?o+="$":i.strict&&!o.endsWith("/")&&(o+="(?:/|$)");const d=new RegExp(o,i.sensitive?"":"i");function n(C){const I=C.match(d),z={};if(!I)return null;for(let $=1;$<I.length;$++){const k=I[$]||"",Y=l[$-1];z[Y.name]=k&&Y.repeatable?k.split("/"):k}return z}function S(C){let I="",z=!1;for(const $ of e){(!z||!I.endsWith("/"))&&(I+="/"),z=!1;for(const k of $)if(k.type===0)I+=k.value;else if(k.type===1){const{value:Y,repeatable:ie,optional:ue}=k,ne=Y in C?C[Y]:"";if(isArray(ne)&&!ie)throw new Error(`Provided param "${Y}" is an array but it is not repeatable (* or + modifiers)`);const se=isArray(ne)?ne.join("/"):ne;if(!se)if(ue)$.length<2&&(I.endsWith("/")?I=I.slice(0,-1):z=!0);else throw new Error(`Missing required param "${Y}"`);I+=se}}return I||"/"}return{re:d,score:r,keys:l,parse:n,stringify:S}}function compareScoreArray(e,t){let i=0;for(;i<e.length&&i<t.length;){const r=t[i]-e[i];if(r)return r;i++}return e.length<t.length?e.length===1&&e[0]===80?-1:1:e.length>t.length?t.length===1&&t[0]===80?1:-1:0}function comparePathParserScore(e,t){let i=0;const r=e.score,o=t.score;for(;i<r.length&&i<o.length;){const l=compareScoreArray(r[i],o[i]);if(l)return l;i++}if(Math.abs(o.length-r.length)===1){if(isLastScoreNegative(r))return 1;if(isLastScoreNegative(o))return-1}return o.length-r.length}function isLastScoreNegative(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(e){if(!e)return[[]];if(e==="/")return[[ROOT_TOKEN]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(k){throw new Error(`ERR (${i})/"${C}": ${k}`)}let i=0,r=i;const o=[];let l;function d(){l&&o.push(l),l=[]}let n=0,S,C="",I="";function z(){C&&(i===0?l.push({type:0,value:C}):i===1||i===2||i===3?(l.length>1&&(S==="*"||S==="+")&&t(`A repeatable param (${C}) must be alone in its segment. eg: '/:ids+.`),l.push({type:1,value:C,regexp:I,repeatable:S==="*"||S==="+",optional:S==="*"||S==="?"})):t("Invalid state to consume buffer"),C="")}function $(){C+=S}for(;n<e.length;){if(S=e[n++],S==="\\"&&i!==2){r=i,i=4;continue}switch(i){case 0:S==="/"?(C&&z(),d()):S===":"?(z(),i=1):$();break;case 4:$(),i=r;break;case 1:S==="("?i=2:VALID_PARAM_RE.test(S)?$():(z(),i=0,S!=="*"&&S!=="?"&&S!=="+"&&n--);break;case 2:S===")"?I[I.length-1]=="\\"?I=I.slice(0,-1)+S:i=3:I+=S;break;case 3:z(),i=0,S!=="*"&&S!=="?"&&S!=="+"&&n--,I="";break;default:t("Unknown state");break}}return i===2&&t(`Unfinished custom RegExp for param "${C}"`),z(),d(),o}function createRouteRecordMatcher(e,t,i){const r=tokensToParser(tokenizePath(e.path),i),o=assign(r,{record:e,parent:t,children:[],alias:[]});return t&&!o.record.aliasOf==!t.record.aliasOf&&t.children.push(o),o}function createRouterMatcher(e,t){const i=[],r=new Map;t=mergeOptions({strict:!1,end:!0,sensitive:!1},t);function o(z){return r.get(z)}function l(z,$,k){const Y=!k,ie=normalizeRouteRecord(z);ie.aliasOf=k&&k.record;const ue=mergeOptions(t,z),ne=[ie];if("alias"in z){const he=typeof z.alias=="string"?[z.alias]:z.alias;for(const me of he)ne.push(normalizeRouteRecord(assign({},ie,{components:k?k.record.components:ie.components,path:me,aliasOf:k?k.record:ie})))}let se,le;for(const he of ne){const{path:me}=he;if($&&me[0]!=="/"){const ge=$.record.path,xt=ge[ge.length-1]==="/"?"":"/";he.path=$.record.path+(me&&xt+me)}if(se=createRouteRecordMatcher(he,$,ue),k?k.alias.push(se):(le=le||se,le!==se&&le.alias.push(se),Y&&z.name&&!isAliasRecord(se)&&d(z.name)),isMatchable(se)&&S(se),ie.children){const ge=ie.children;for(let xt=0;xt<ge.length;xt++)l(ge[xt],se,k&&k.children[xt])}k=k||se}return le?()=>{d(le)}:noop}function d(z){if(isRouteName(z)){const $=r.get(z);$&&(r.delete(z),i.splice(i.indexOf($),1),$.children.forEach(d),$.alias.forEach(d))}else{const $=i.indexOf(z);$>-1&&(i.splice($,1),z.record.name&&r.delete(z.record.name),z.children.forEach(d),z.alias.forEach(d))}}function n(){return i}function S(z){const $=findInsertionIndex(z,i);i.splice($,0,z),z.record.name&&!isAliasRecord(z)&&r.set(z.record.name,z)}function C(z,$){let k,Y={},ie,ue;if("name"in z&&z.name){if(k=r.get(z.name),!k)throw createRouterError(1,{location:z});ue=k.record.name,Y=assign(paramsFromLocation($.params,k.keys.filter(le=>!le.optional).concat(k.parent?k.parent.keys.filter(le=>le.optional):[]).map(le=>le.name)),z.params&&paramsFromLocation(z.params,k.keys.map(le=>le.name))),ie=k.stringify(Y)}else if(z.path!=null)ie=z.path,k=i.find(le=>le.re.test(ie)),k&&(Y=k.parse(ie),ue=k.record.name);else{if(k=$.name?r.get($.name):i.find(le=>le.re.test($.path)),!k)throw createRouterError(1,{location:z,currentLocation:$});ue=k.record.name,Y=assign({},$.params,z.params),ie=k.stringify(Y)}const ne=[];let se=k;for(;se;)ne.unshift(se.record),se=se.parent;return{name:ue,path:ie,params:Y,matched:ne,meta:mergeMetaFields(ne)}}e.forEach(z=>l(z));function I(){i.length=0,r.clear()}return{addRoute:l,resolve:C,removeRoute:d,clearRoutes:I,getRoutes:n,getRecordMatcher:o}}function paramsFromLocation(e,t){const i={};for(const r of t)r in e&&(i[r]=e[r]);return i}function normalizeRouteRecord(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:normalizeRecordProps(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function normalizeRecordProps(e){const t={},i=e.props||!1;if("component"in e)t.default=i;else for(const r in e.components)t[r]=typeof i=="object"?i[r]:i;return t}function isAliasRecord(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function mergeMetaFields(e){return e.reduce((t,i)=>assign(t,i.meta),{})}function mergeOptions(e,t){const i={};for(const r in e)i[r]=r in t?t[r]:e[r];return i}function findInsertionIndex(e,t){let i=0,r=t.length;for(;i!==r;){const l=i+r>>1;comparePathParserScore(e,t[l])<0?r=l:i=l+1}const o=getInsertionAncestor(e);return o&&(r=t.lastIndexOf(o,r-1)),r}function getInsertionAncestor(e){let t=e;for(;t=t.parent;)if(isMatchable(t)&&comparePathParserScore(e,t)===0)return t}function isMatchable({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function parseQuery(e){const t={};if(e===""||e==="?")return t;const r=(e[0]==="?"?e.slice(1):e).split("&");for(let o=0;o<r.length;++o){const l=r[o].replace(PLUS_RE," "),d=l.indexOf("="),n=decode(d<0?l:l.slice(0,d)),S=d<0?null:decode(l.slice(d+1));if(n in t){let C=t[n];isArray(C)||(C=t[n]=[C]),C.push(S)}else t[n]=S}return t}function stringifyQuery(e){let t="";for(let i in e){const r=e[i];if(i=encodeQueryKey(i),r==null){r!==void 0&&(t+=(t.length?"&":"")+i);continue}(isArray(r)?r.map(l=>l&&encodeQueryValue(l)):[r&&encodeQueryValue(r)]).forEach(l=>{l!==void 0&&(t+=(t.length?"&":"")+i,l!=null&&(t+="="+l))})}return t}function normalizeQuery(e){const t={};for(const i in e){const r=e[i];r!==void 0&&(t[i]=isArray(r)?r.map(o=>o==null?null:""+o):r==null?r:""+r)}return t}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let e=[];function t(r){return e.push(r),()=>{const o=e.indexOf(r);o>-1&&e.splice(o,1)}}function i(){e=[]}return{add:t,list:()=>e.slice(),reset:i}}function guardToPromiseFn(e,t,i,r,o,l=d=>d()){const d=r&&(r.enterCallbacks[o]=r.enterCallbacks[o]||[]);return()=>new Promise((n,S)=>{const C=$=>{$===!1?S(createRouterError(4,{from:i,to:t})):$ instanceof Error?S($):isRouteLocation($)?S(createRouterError(2,{from:t,to:$})):(d&&r.enterCallbacks[o]===d&&typeof $=="function"&&d.push($),n())},I=l(()=>e.call(r&&r.instances[o],t,i,C));let z=Promise.resolve(I);e.length<3&&(z=z.then(C)),z.catch($=>S($))})}function extractComponentsGuards(e,t,i,r,o=l=>l()){const l=[];for(const d of e)for(const n in d.components){let S=d.components[n];if(!(t!=="beforeRouteEnter"&&!d.instances[n]))if(isRouteComponent(S)){const I=(S.__vccOpts||S)[t];I&&l.push(guardToPromiseFn(I,i,r,d,n,o))}else{let C=S();l.push(()=>C.then(I=>{if(!I)throw new Error(`Couldn't resolve component "${n}" at "${d.path}"`);const z=isESModule(I)?I.default:I;d.mods[n]=I,d.components[n]=z;const k=(z.__vccOpts||z)[t];return k&&guardToPromiseFn(k,i,r,d,n,o)()}))}}return l}function useLink(e){const t=inject(routerKey),i=inject(routeLocationKey),r=computed(()=>{const S=unref(e.to);return t.resolve(S)}),o=computed(()=>{const{matched:S}=r.value,{length:C}=S,I=S[C-1],z=i.matched;if(!I||!z.length)return-1;const $=z.findIndex(isSameRouteRecord.bind(null,I));if($>-1)return $;const k=getOriginalPath(S[C-2]);return C>1&&getOriginalPath(I)===k&&z[z.length-1].path!==k?z.findIndex(isSameRouteRecord.bind(null,S[C-2])):$}),l=computed(()=>o.value>-1&&includesParams(i.params,r.value.params)),d=computed(()=>o.value>-1&&o.value===i.matched.length-1&&isSameRouteLocationParams(i.params,r.value.params));function n(S={}){if(guardEvent(S)){const C=t[unref(e.replace)?"replace":"push"](unref(e.to)).catch(noop);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>C),C}return Promise.resolve()}return{route:r,href:computed(()=>r.value.href),isActive:l,isExactActive:d,navigate:n}}function preferSingleVNode(e){return e.length===1?e[0]:e}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink,setup(e,{slots:t}){const i=reactive(useLink(e)),{options:r}=inject(routerKey),o=computed(()=>({[getLinkClass(e.activeClass,r.linkActiveClass,"router-link-active")]:i.isActive,[getLinkClass(e.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive}));return()=>{const l=t.default&&preferSingleVNode(t.default(i));return e.custom?l:h("a",{"aria-current":i.isExactActive?e.ariaCurrentValue:null,href:i.href,onClick:i.navigate,class:o.value},l)}}}),RouterLink=RouterLinkImpl;function guardEvent(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function includesParams(e,t){for(const i in t){const r=t[i],o=e[i];if(typeof r=="string"){if(r!==o)return!1}else if(!isArray(o)||o.length!==r.length||r.some((l,d)=>l!==o[d]))return!1}return!0}function getOriginalPath(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const getLinkClass=(e,t,i)=>e??t??i,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:i}){const r=inject(routerViewLocationKey),o=computed(()=>e.route||r.value),l=inject(viewDepthKey,0),d=computed(()=>{let C=unref(l);const{matched:I}=o.value;let z;for(;(z=I[C])&&!z.components;)C++;return C}),n=computed(()=>o.value.matched[d.value]);provide(viewDepthKey,computed(()=>d.value+1)),provide(matchedRouteKey,n),provide(routerViewLocationKey,o);const S=ref();return watch$1(()=>[S.value,n.value,e.name],([C,I,z],[$,k,Y])=>{I&&(I.instances[z]=C,k&&k!==I&&C&&C===$&&(I.leaveGuards.size||(I.leaveGuards=k.leaveGuards),I.updateGuards.size||(I.updateGuards=k.updateGuards))),C&&I&&(!k||!isSameRouteRecord(I,k)||!$)&&(I.enterCallbacks[z]||[]).forEach(ie=>ie(C))},{flush:"post"}),()=>{const C=o.value,I=e.name,z=n.value,$=z&&z.components[I];if(!$)return normalizeSlot$1(i.default,{Component:$,route:C});const k=z.props[I],Y=k?k===!0?C.params:typeof k=="function"?k(C):k:null,ue=h($,assign({},Y,t,{onVnodeUnmounted:ne=>{ne.component.isUnmounted&&(z.instances[I]=null)},ref:S}));return normalizeSlot$1(i.default,{Component:ue,route:C})||ue}}});function normalizeSlot$1(e,t){if(!e)return null;const i=e(t);return i.length===1?i[0]:i}const RouterView=RouterViewImpl;function createRouter(e){const t=createRouterMatcher(e.routes,e),i=e.parseQuery||parseQuery,r=e.stringifyQuery||stringifyQuery,o=e.history,l=useCallbacks(),d=useCallbacks(),n=useCallbacks(),S=shallowRef(START_LOCATION_NORMALIZED);let C=START_LOCATION_NORMALIZED;isBrowser$2&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const I=applyToParams.bind(null,Gt=>""+Gt),z=applyToParams.bind(null,encodeParam),$=applyToParams.bind(null,decode);function k(Gt,ui){let oi,Si;return isRouteName(Gt)?(oi=t.getRecordMatcher(Gt),Si=ui):Si=Gt,t.addRoute(Si,oi)}function Y(Gt){const ui=t.getRecordMatcher(Gt);ui&&t.removeRoute(ui)}function ie(){return t.getRoutes().map(Gt=>Gt.record)}function ue(Gt){return!!t.getRecordMatcher(Gt)}function ne(Gt,ui){if(ui=assign({},ui||S.value),typeof Gt=="string"){const Nt=parseURL(i,Gt,ui.path),gi=t.resolve({path:Nt.path},ui),Ri=o.createHref(Nt.fullPath);return assign(Nt,gi,{params:$(gi.params),hash:decode(Nt.hash),redirectedFrom:void 0,href:Ri})}let oi;if(Gt.path!=null)oi=assign({},Gt,{path:parseURL(i,Gt.path,ui.path).path});else{const Nt=assign({},Gt.params);for(const gi in Nt)Nt[gi]==null&&delete Nt[gi];oi=assign({},Gt,{params:z(Nt)}),ui.params=z(ui.params)}const Si=t.resolve(oi,ui),Li=Gt.hash||"";Si.params=I($(Si.params));const Mi=stringifyURL(r,assign({},Gt,{hash:encodeHash(Li),path:Si.path})),kt=o.createHref(Mi);return assign({fullPath:Mi,hash:Li,query:r===stringifyQuery?normalizeQuery(Gt.query):Gt.query||{}},Si,{redirectedFrom:void 0,href:kt})}function se(Gt){return typeof Gt=="string"?parseURL(i,Gt,S.value.path):assign({},Gt)}function le(Gt,ui){if(C!==Gt)return createRouterError(8,{from:ui,to:Gt})}function he(Gt){return xt(Gt)}function me(Gt){return he(assign(se(Gt),{replace:!0}))}function ge(Gt){const ui=Gt.matched[Gt.matched.length-1];if(ui&&ui.redirect){const{redirect:oi}=ui;let Si=typeof oi=="function"?oi(Gt):oi;return typeof Si=="string"&&(Si=Si.includes("?")||Si.includes("#")?Si=se(Si):{path:Si},Si.params={}),assign({query:Gt.query,hash:Gt.hash,params:Si.path!=null?{}:Gt.params},Si)}}function xt(Gt,ui){const oi=C=ne(Gt),Si=S.value,Li=Gt.state,Mi=Gt.force,kt=Gt.replace===!0,Nt=ge(oi);if(Nt)return xt(assign(se(Nt),{state:typeof Nt=="object"?assign({},Li,Nt.state):Li,force:Mi,replace:kt}),ui||oi);const gi=oi;gi.redirectedFrom=ui;let Ri;return!Mi&&isSameRouteLocation(r,Si,oi)&&(Ri=createRouterError(16,{to:gi,from:Si}),mi(Si,Si,!0,!1)),(Ri?Promise.resolve(Ri):Zt(gi,Si)).catch(Rt=>isNavigationFailure(Rt)?isNavigationFailure(Rt,2)?Rt:jt(Rt):Mt(Rt,gi,Si)).then(Rt=>{if(Rt){if(isNavigationFailure(Rt,2))return xt(assign({replace:kt},se(Rt.to),{state:typeof Rt.to=="object"?assign({},Li,Rt.to.state):Li,force:Mi}),ui||gi)}else Rt=It(gi,Si,!0,kt,Li);return Ht(gi,Si,Rt),Rt})}function Et(Gt,ui){const oi=le(Gt,ui);return oi?Promise.reject(oi):Promise.resolve()}function Lt(Gt){const ui=Ir.values().next().value;return ui&&typeof ui.runWithContext=="function"?ui.runWithContext(Gt):Gt()}function Zt(Gt,ui){let oi;const[Si,Li,Mi]=extractChangingRecords(Gt,ui);oi=extractComponentsGuards(Si.reverse(),"beforeRouteLeave",Gt,ui);for(const Nt of Si)Nt.leaveGuards.forEach(gi=>{oi.push(guardToPromiseFn(gi,Gt,ui))});const kt=Et.bind(null,Gt,ui);return oi.push(kt),si(oi).then(()=>{oi=[];for(const Nt of l.list())oi.push(guardToPromiseFn(Nt,Gt,ui));return oi.push(kt),si(oi)}).then(()=>{oi=extractComponentsGuards(Li,"beforeRouteUpdate",Gt,ui);for(const Nt of Li)Nt.updateGuards.forEach(gi=>{oi.push(guardToPromiseFn(gi,Gt,ui))});return oi.push(kt),si(oi)}).then(()=>{oi=[];for(const Nt of Mi)if(Nt.beforeEnter)if(isArray(Nt.beforeEnter))for(const gi of Nt.beforeEnter)oi.push(guardToPromiseFn(gi,Gt,ui));else oi.push(guardToPromiseFn(Nt.beforeEnter,Gt,ui));return oi.push(kt),si(oi)}).then(()=>(Gt.matched.forEach(Nt=>Nt.enterCallbacks={}),oi=extractComponentsGuards(Mi,"beforeRouteEnter",Gt,ui,Lt),oi.push(kt),si(oi))).then(()=>{oi=[];for(const Nt of d.list())oi.push(guardToPromiseFn(Nt,Gt,ui));return oi.push(kt),si(oi)}).catch(Nt=>isNavigationFailure(Nt,8)?Nt:Promise.reject(Nt))}function Ht(Gt,ui,oi){n.list().forEach(Si=>Lt(()=>Si(Gt,ui,oi)))}function It(Gt,ui,oi,Si,Li){const Mi=le(Gt,ui);if(Mi)return Mi;const kt=ui===START_LOCATION_NORMALIZED,Nt=isBrowser$2?history.state:{};oi&&(Si||kt?o.replace(Gt.fullPath,assign({scroll:kt&&Nt&&Nt.scroll},Li)):o.push(Gt.fullPath,Li)),S.value=Gt,mi(Gt,ui,oi,kt),jt()}let Yt;function ri(){Yt||(Yt=o.listen((Gt,ui,oi)=>{if(!nr.listening)return;const Si=ne(Gt),Li=ge(Si);if(Li){xt(assign(Li,{replace:!0,force:!0}),Si).catch(noop);return}C=Si;const Mi=S.value;isBrowser$2&&saveScrollPosition(getScrollKey(Mi.fullPath,oi.delta),computeScrollPosition()),Zt(Si,Mi).catch(kt=>isNavigationFailure(kt,12)?kt:isNavigationFailure(kt,2)?(xt(assign(se(kt.to),{force:!0}),Si).then(Nt=>{isNavigationFailure(Nt,20)&&!oi.delta&&oi.type===NavigationType.pop&&o.go(-1,!1)}).catch(noop),Promise.reject()):(oi.delta&&o.go(-oi.delta,!1),Mt(kt,Si,Mi))).then(kt=>{kt=kt||It(Si,Mi,!1),kt&&(oi.delta&&!isNavigationFailure(kt,8)?o.go(-oi.delta,!1):oi.type===NavigationType.pop&&isNavigationFailure(kt,20)&&o.go(-1,!1)),Ht(Si,Mi,kt)}).catch(noop)}))}let ei=useCallbacks(),Ct=useCallbacks(),Ut;function Mt(Gt,ui,oi){jt(Gt);const Si=Ct.list();return Si.length?Si.forEach(Li=>Li(Gt,ui,oi)):console.error(Gt),Promise.reject(Gt)}function $t(){return Ut&&S.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((Gt,ui)=>{ei.add([Gt,ui])})}function jt(Gt){return Ut||(Ut=!Gt,ri(),ei.list().forEach(([ui,oi])=>Gt?oi(Gt):ui()),ei.reset()),Gt}function mi(Gt,ui,oi,Si){const{scrollBehavior:Li}=e;if(!isBrowser$2||!Li)return Promise.resolve();const Mi=!oi&&getSavedScrollPosition(getScrollKey(Gt.fullPath,0))||(Si||!oi)&&history.state&&history.state.scroll||null;return nextTick().then(()=>Li(Gt,ui,Mi)).then(kt=>kt&&scrollToPosition(kt)).catch(kt=>Mt(kt,Gt,ui))}const Xi=Gt=>o.go(Gt);let Er;const Ir=new Set,nr={currentRoute:S,listening:!0,addRoute:k,removeRoute:Y,clearRoutes:t.clearRoutes,hasRoute:ue,getRoutes:ie,resolve:ne,options:e,push:he,replace:me,go:Xi,back:()=>Xi(-1),forward:()=>Xi(1),beforeEach:l.add,beforeResolve:d.add,afterEach:n.add,onError:Ct.add,isReady:$t,install(Gt){const ui=this;Gt.component("RouterLink",RouterLink),Gt.component("RouterView",RouterView),Gt.config.globalProperties.$router=ui,Object.defineProperty(Gt.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(S)}),isBrowser$2&&!Er&&S.value===START_LOCATION_NORMALIZED&&(Er=!0,he(o.location).catch(Li=>{}));const oi={};for(const Li in START_LOCATION_NORMALIZED)Object.defineProperty(oi,Li,{get:()=>S.value[Li],enumerable:!0});Gt.provide(routerKey,ui),Gt.provide(routeLocationKey,shallowReactive(oi)),Gt.provide(routerViewLocationKey,S);const Si=Gt.unmount;Ir.add(Gt),Gt.unmount=function(){Ir.delete(Gt),Ir.size<1&&(C=START_LOCATION_NORMALIZED,Yt&&Yt(),Yt=null,S.value=START_LOCATION_NORMALIZED,Er=!1,Ut=!1),Si()}}};function si(Gt){return Gt.reduce((ui,oi)=>ui.then(()=>Lt(oi)),Promise.resolve())}return nr}function extractChangingRecords(e,t){const i=[],r=[],o=[],l=Math.max(t.matched.length,e.matched.length);for(let d=0;d<l;d++){const n=t.matched[d];n&&(e.matched.find(C=>isSameRouteRecord(C,n))?r.push(n):i.push(n));const S=e.matched[d];S&&(t.matched.find(C=>isSameRouteRecord(C,S))||o.push(S))}return[i,r,o]}function useRoute(e){return inject(routeLocationKey)}const ROUTE_KEY_PARENTHESES_RE$1=/(:\w+)\([^)]+\)/g,ROUTE_KEY_SYMBOLS_RE$1=/(:\w+)[?+*]/g,ROUTE_KEY_NORMAL_RE$1=/:\w+/g,interpolatePath=(e,t)=>t.path.replace(ROUTE_KEY_PARENTHESES_RE$1,"$1").replace(ROUTE_KEY_SYMBOLS_RE$1,"$1").replace(ROUTE_KEY_NORMAL_RE$1,i=>{var r;return((r=e.params[i.slice(1)])==null?void 0:r.toString())||""}),generateRouteKey$1=(e,t)=>{const i=e.route.matched.find(o=>{var l;return((l=o.components)==null?void 0:l.default)===e.Component.type}),r=t??(i==null?void 0:i.meta.key)??(i&&interpolatePath(e.route,i));return typeof r=="function"?r(e.route):r},wrapInKeepAlive=(e,t)=>({default:()=>e?h(KeepAlive,e===!0?{}:e,t):t});function toArray$1(e){return Array.isArray(e)?e:[e]}const __nuxt_page_meta$1={scrollToTop:!1},__nuxt_page_meta={scrollToTop:!1},_routes=[{name:"index",path:"/",meta:__nuxt_page_meta$1||{},component:()=>__vitePreload(()=>import("./XBYvhvJL.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)},{name:"contacts",path:"/contacts",meta:__nuxt_page_meta||{},component:()=>__vitePreload(()=>import("./x8_-A2aJ.js"),__vite__mapDeps([8,1,2,3,4,5,6,9,10]),import.meta.url)}],_wrapInTransition=(e,t)=>({default:()=>{var i;return e?h(Transition,e===!0?{}:e,t):(i=t.default)==null?void 0:i.call(t)}}),ROUTE_KEY_PARENTHESES_RE=/(:\w+)\([^)]+\)/g,ROUTE_KEY_SYMBOLS_RE=/(:\w+)[?+*]/g,ROUTE_KEY_NORMAL_RE=/:\w+/g;function generateRouteKey(e){const t=(e==null?void 0:e.meta.key)??e.path.replace(ROUTE_KEY_PARENTHESES_RE,"$1").replace(ROUTE_KEY_SYMBOLS_RE,"$1").replace(ROUTE_KEY_NORMAL_RE,i=>{var r;return((r=e.params[i.slice(1)])==null?void 0:r.toString())||""});return typeof t=="function"?t(e):t}function isChangingPage(e,t){return e===t||t===START_LOCATION_NORMALIZED?!1:generateRouteKey(e)!==generateRouteKey(t)?!0:!e.matched.every((r,o)=>{var l,d;return r.components&&r.components.default===((d=(l=t.matched[o])==null?void 0:l.components)==null?void 0:d.default)})}const routerOptions0={scrollBehavior(e,t,i){var S;const r=useNuxtApp(),o=((S=useRouter().options)==null?void 0:S.scrollBehaviorType)??"auto";if(e.path===t.path)return t.hash&&!e.hash?{left:0,top:0}:e.hash?{el:e.hash,top:_getHashElementScrollMarginTop(e.hash),behavior:o}:!1;if((typeof e.meta.scrollToTop=="function"?e.meta.scrollToTop(e,t):e.meta.scrollToTop)===!1)return!1;let d=i||void 0;!d&&isChangingPage(e,t)&&(d={left:0,top:0});const n=r._runningTransition?"page:transition:finish":"page:loading:end";return new Promise(C=>{if(t===START_LOCATION_NORMALIZED){C(_calculatePosition(e,"instant",d));return}r.hooks.hookOnce(n,()=>{requestAnimationFrame(()=>C(_calculatePosition(e,"instant",d)))})})}};function _getHashElementScrollMarginTop(e){try{const t=document.querySelector(e);if(t)return(Number.parseFloat(getComputedStyle(t).scrollMarginTop)||0)+(Number.parseFloat(getComputedStyle(document.documentElement).scrollPaddingTop)||0)}catch{}return 0}function _calculatePosition(e,t,i){return i||(e.hash?{el:e.hash,top:_getHashElementScrollMarginTop(e.hash),behavior:t}:{left:0,top:0,behavior:t})}const configRouterOptions={hashMode:!1,scrollBehaviorType:"auto"},routerOptions={...configRouterOptions,...routerOptions0},validate$1=async(e,t)=>{var d;let i,r;if(!((d=e.meta)!=null&&d.validate))return;const o=([i,r]=executeAsync(()=>Promise.resolve(e.meta.validate(e))),i=await i,r(),i);if(o===!0)return;const l=createError({fatal:!0,statusCode:o&&o.statusCode||404,statusMessage:o&&o.statusMessage||`Page Not Found: ${e.fullPath}`,data:{path:e.fullPath}});return typeof window<"u"&&window.history.pushState({},"",t.fullPath),l},manifest_45route_45rule=async e=>{let t,i;const r=([t,i]=executeAsync(()=>getRouteRules({path:e.path})),t=await t,i(),t);if(r.redirect)return hasProtocol(r.redirect,{acceptRelative:!0})?(window.location.href=r.redirect,!1):r.redirect},globalMiddleware=[validate$1,manifest_45route_45rule],namedMiddleware={};function createCurrentLocation(e,t,i){const{pathname:r,search:o,hash:l}=t,d=e.indexOf("#");if(d>-1){const C=l.includes(e.slice(d))?e.slice(d).length:1;let I=l.slice(C);return I[0]!=="/"&&(I="/"+I),withoutBase(I,"")}const n=withoutBase(r,e),S=!i||isSamePath(n,i)?n:i;return S+(S.includes("?")?"":o)+l}const plugin$2=defineNuxtPlugin({name:"nuxt:router",enforce:"pre",async setup(e){var ue;let t,i,r=useRuntimeConfig().app.baseURL;const o=((ue=routerOptions.history)==null?void 0:ue.call(routerOptions,r))??createWebHistory(r),l=routerOptions.routes?([t,i]=executeAsync(()=>routerOptions.routes(_routes)),t=await t,i(),t??_routes):_routes;let d;const n=createRouter({...routerOptions,scrollBehavior:(ne,se,le)=>{if(se===START_LOCATION_NORMALIZED){d=le;return}if(routerOptions.scrollBehavior){if(n.options.scrollBehavior=routerOptions.scrollBehavior,"scrollRestoration"in window.history){const he=n.beforeEach(()=>{he(),window.history.scrollRestoration="manual"})}return routerOptions.scrollBehavior(ne,START_LOCATION_NORMALIZED,d||le)}},history:o,routes:l});"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto"),e.vueApp.use(n);const S=shallowRef(n.currentRoute.value);n.afterEach((ne,se)=>{S.value=se}),Object.defineProperty(e.vueApp.config.globalProperties,"previousRoute",{get:()=>S.value});const C=createCurrentLocation(r,window.location,e.payload.path),I=shallowRef(n.currentRoute.value),z=()=>{I.value=n.currentRoute.value};e.hook("page:finish",z),n.afterEach((ne,se)=>{var le,he,me,ge;((he=(le=ne.matched[0])==null?void 0:le.components)==null?void 0:he.default)===((ge=(me=se.matched[0])==null?void 0:me.components)==null?void 0:ge.default)&&z()});const $={};for(const ne in I.value)Object.defineProperty($,ne,{get:()=>I.value[ne],enumerable:!0});e._route=shallowReactive($),e._middleware||(e._middleware={global:[],named:{}});const k=useError();n.afterEach(async(ne,se,le)=>{delete e._processingMiddleware,!e.isHydrating&&k.value&&await e.runWithContext(clearError),le&&await e.callHook("page:loading:end")});try{[t,i]=executeAsync(()=>n.isReady()),await t,i()}catch(ne){[t,i]=executeAsync(()=>e.runWithContext(()=>showError(ne))),await t,i()}const Y=C!==n.currentRoute.value.fullPath?n.resolve(C):n.currentRoute.value;z();const ie=e.payload.state._layout;return n.beforeEach(async(ne,se)=>{var le;await e.callHook("page:loading:start"),ne.meta=reactive(ne.meta),e.isHydrating&&ie&&!isReadonly(ne.meta.layout)&&(ne.meta.layout=ie),e._processingMiddleware=!0;{const he=new Set([...globalMiddleware,...e._middleware.global]);for(const me of ne.matched){const ge=me.meta.middleware;if(ge)for(const xt of toArray$1(ge))he.add(xt)}{const me=await e.runWithContext(()=>getRouteRules({path:ne.path}));if(me.appMiddleware)for(const ge in me.appMiddleware)me.appMiddleware[ge]?he.add(ge):he.delete(ge)}for(const me of he){const ge=typeof me=="string"?e._middleware.named[me]||await((le=namedMiddleware[me])==null?void 0:le.call(namedMiddleware).then(xt=>xt.default||xt)):me;if(!ge)throw new Error(`Unknown route middleware: '${me}'.`);try{const xt=await e.runWithContext(()=>ge(ne,se));if(!e.payload.serverRendered&&e.isHydrating&&(xt===!1||xt instanceof Error)){const Et=xt||createError({statusCode:404,statusMessage:`Page Not Found: ${C}`});return await e.runWithContext(()=>showError(Et)),!1}if(xt===!0)continue;if(xt===!1)return xt;if(xt)return isNuxtError(xt)&&xt.fatal&&await e.runWithContext(()=>showError(xt)),xt}catch(xt){const Et=createError(xt);return Et.fatal&&await e.runWithContext(()=>showError(Et)),Et}}}}),n.onError(async()=>{delete e._processingMiddleware,await e.callHook("page:loading:end")}),n.afterEach(async(ne,se)=>{ne.matched.length===0&&await e.runWithContext(()=>showError(createError({statusCode:404,fatal:!1,statusMessage:`Page not found: ${ne.fullPath}`,data:{path:ne.fullPath}})))}),e.hooks.hookOnce("app:created",async()=>{try{"name"in Y&&(Y.name=void 0),await n.replace({...Y,force:!0}),n.options.scrollBehavior=routerOptions.scrollBehavior}catch(ne){await e.runWithContext(()=>showError(ne))}}),{provide:{router:n}}}}),requestIdleCallback$1=globalThis.requestIdleCallback||(e=>{const t=Date.now(),i={didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))};return setTimeout(()=>{e(i)},1)}),cancelIdleCallback=globalThis.cancelIdleCallback||(e=>{clearTimeout(e)}),onNuxtReady=e=>{const t=useNuxtApp();t.isHydrating?t.hooks.hookOnce("app:suspense:resolve",()=>{requestIdleCallback$1(()=>e())}):requestIdleCallback$1(()=>e())},payload_client_kSYcIMYUswSDcSGoGWqM0MO2T4MjOZsQFA1GU6fqohM=defineNuxtPlugin({name:"nuxt:payload",setup(e){const t=new Set;useRouter().beforeResolve(async(i,r)=>{if(i.path===r.path)return;const o=await loadPayload(i.path);if(o){for(const l of t)delete e.static.data[l];for(const l in o.data)l in e.static.data||t.add(l),e.static.data[l]=o.data[l]}}),onNuxtReady(()=>{var i;e.hooks.hook("link:prefetch",async r=>{const{hostname:o}=new URL(r,window.location.href);o===window.location.hostname&&await loadPayload(r).catch(()=>{console.warn("[nuxt] Error preloading payload for",r)})}),((i=navigator.connection)==null?void 0:i.effectiveType)!=="slow-2g"&&setTimeout(getAppManifest,1e3)})}}),navigation_repaint_client_iZ4sbIDUOBlI58WRS1dxkRZJOsKNs1c7SCqRszdxr6Y=defineNuxtPlugin(()=>{const e=useRouter();onNuxtReady(()=>{e.beforeResolve(async()=>{await new Promise(t=>{setTimeout(t,100),requestAnimationFrame(()=>{setTimeout(t,0)})})})})}),check_outdated_build_client__GMdmUuNCTKDee9GyDhHz84CJEYUp5_FenYjvgAxtj8=defineNuxtPlugin(e=>{let t;async function i(){const r=await getAppManifest();t&&clearTimeout(t),t=setTimeout(i,outdatedBuildInterval);try{const o=await $fetch(buildAssetsURL("builds/latest.json")+`?${Date.now()}`);o.id!==r.id&&e.hooks.callHook("app:manifest:update",o)}catch{}}onNuxtReady(()=>{t=setTimeout(i,outdatedBuildInterval)})});function reloadNuxtApp(e={}){const t=e.path||window.location.pathname;let i={};try{i=destr(sessionStorage.getItem("nuxt:reload")||"{}")}catch{}if(e.force||(i==null?void 0:i.path)!==t||(i==null?void 0:i.expires)<Date.now()){try{sessionStorage.setItem("nuxt:reload",JSON.stringify({path:t,expires:Date.now()+(e.ttl??1e4)}))}catch{}if(e.persistState)try{sessionStorage.setItem("nuxt:reload:state",JSON.stringify({state:useNuxtApp().payload.state}))}catch{}window.location.pathname!==t?window.location.href=t:window.location.reload()}}const chunk_reload_client_90gdG_aWZaDfO85SQYWzwaOywz7zi0wBnFUoX0cT54U=defineNuxtPlugin({name:"nuxt:chunk-reload",setup(e){const t=useRouter(),i=useRuntimeConfig(),r=new Set;t.beforeEach(()=>{r.clear()}),e.hook("app:chunkError",({error:l})=>{r.add(l)});function o(l){const n="href"in l&&l.href[0]==="#"?i.app.baseURL+l.href:joinURL(i.app.baseURL,l.fullPath);reloadNuxtApp({path:n,persistState:!0})}e.hook("app:manifest:update",()=>{t.beforeResolve(o)}),t.onError((l,d)=>{r.has(l)&&o(d)})}}),clientOnlySymbol=Symbol.for("nuxt:client-only"),__nuxt_component_2$1=defineComponent({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(e,{slots:t,attrs:i}){const r=shallowRef(!1);onMounted(()=>{r.value=!0});const o=getCurrentInstance();return o&&(o._nuxtClientOnly=!0),provide(clientOnlySymbol,!0),()=>{var S;if(r.value){const C=(S=t.default)==null?void 0:S.call(t);return C&&C.length===1?[cloneVNode(C[0],i)]:C}const l=t.fallback||t.placeholder;if(l)return l();const d=e.fallback||e.placeholder||"",n=e.fallbackTag||e.placeholderTag||"span";return createElementBlock(n,i,d)}}}),useStateKeyPrefix="$s";function useState(...e){const t=typeof e[e.length-1]=="string"?e.pop():void 0;typeof e[0]!="string"&&e.unshift(t);const[i,r]=e;if(!i||typeof i!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+i);if(r!==void 0&&typeof r!="function")throw new Error("[nuxt] [useState] init must be a function: "+r);const o=useStateKeyPrefix+i,l=useNuxtApp(),d=toRef(l.payload.state,o);if(d.value===void 0&&r){const n=r();if(isRef(n))return l.payload.state[o]=n,n;d.value=n}return d}function _loadAsyncComponent(e){if(e!=null&&e.__asyncLoader&&!e.__asyncResolved)return e.__asyncLoader()}async function preloadRouteComponents(e,t=useRouter()){const{path:i,matched:r}=t.resolve(e);if(!r.length||(t._routePreloaded||(t._routePreloaded=new Set),t._routePreloaded.has(i)))return;const o=t._preloadPromises||(t._preloadPromises=[]);if(o.length>4)return Promise.all(o).then(()=>preloadRouteComponents(e,t));t._routePreloaded.add(i);const l=r.map(d=>{var n;return(n=d.components)==null?void 0:n.default}).filter(d=>typeof d=="function");for(const d of l){const n=Promise.resolve(d()).catch(()=>{}).finally(()=>o.splice(o.indexOf(n)));o.push(n)}await Promise.all(o)}const firstNonUndefined=(...e)=>e.find(t=>t!==void 0);function defineNuxtLink(e){const t=e.componentName||"NuxtLink";function i(l){return typeof l=="string"&&l.startsWith("#")}function r(l,d,n){const S=n??e.trailingSlash;if(!l||S!=="append"&&S!=="remove")return l;if(typeof l=="string")return applyTrailingSlashBehavior(l,S);const C="path"in l&&l.path!==void 0?l.path:d(l).path;return{...l,name:void 0,path:applyTrailingSlashBehavior(C,S)}}function o(l){const d=useRouter(),n=useRuntimeConfig(),S=computed(()=>!!l.target&&l.target!=="_self"),C=computed(()=>{const ue=l.to||l.href||"";return typeof ue=="string"&&hasProtocol(ue,{acceptRelative:!0})}),I=resolveComponent("RouterLink"),z=I&&typeof I!="string"?I.useLink:void 0,$=computed(()=>{if(l.external)return!0;const ue=l.to||l.href||"";return typeof ue=="object"?!1:ue===""||C.value}),k=computed(()=>{const ue=l.to||l.href||"";return $.value?ue:r(ue,d.resolve,l.trailingSlash)}),Y=$.value||z==null?void 0:z({...l,to:k}),ie=computed(()=>{var ne;const ue=l.trailingSlash??e.trailingSlash;if(!k.value||C.value||i(k.value))return k.value;if($.value){const se=typeof k.value=="object"&&"path"in k.value?resolveRouteObject(k.value):k.value,le=typeof se=="object"?d.resolve(se).href:se;return applyTrailingSlashBehavior(le,ue)}return typeof k.value=="object"?((ne=d.resolve(k.value))==null?void 0:ne.href)??null:applyTrailingSlashBehavior(joinURL(n.app.baseURL,k.value),ue)});return{to:k,hasTarget:S,isAbsoluteUrl:C,isExternal:$,href:ie,isActive:(Y==null?void 0:Y.isActive)??computed(()=>k.value===d.currentRoute.value.path),isExactActive:(Y==null?void 0:Y.isExactActive)??computed(()=>k.value===d.currentRoute.value.path),route:(Y==null?void 0:Y.route)??computed(()=>d.resolve(k.value)),async navigate(ue){await navigateTo(ie.value,{replace:l.replace,external:$.value||S.value})}}}return defineComponent({name:t,props:{to:{type:[String,Object],default:void 0,required:!1},href:{type:[String,Object],default:void 0,required:!1},target:{type:String,default:void 0,required:!1},rel:{type:String,default:void 0,required:!1},noRel:{type:Boolean,default:void 0,required:!1},prefetch:{type:Boolean,default:void 0,required:!1},prefetchOn:{type:[String,Object],default:void 0,required:!1},noPrefetch:{type:Boolean,default:void 0,required:!1},activeClass:{type:String,default:void 0,required:!1},exactActiveClass:{type:String,default:void 0,required:!1},prefetchedClass:{type:String,default:void 0,required:!1},replace:{type:Boolean,default:void 0,required:!1},ariaCurrentValue:{type:String,default:void 0,required:!1},external:{type:Boolean,default:void 0,required:!1},custom:{type:Boolean,default:void 0,required:!1},trailingSlash:{type:String,default:void 0,required:!1}},useLink:o,setup(l,{slots:d}){const n=useRouter(),{to:S,href:C,navigate:I,isExternal:z,hasTarget:$,isAbsoluteUrl:k}=o(l),Y=shallowRef(!1),ie=ref(null),ue=le=>{var he;ie.value=l.custom?(he=le==null?void 0:le.$el)==null?void 0:he.nextElementSibling:le==null?void 0:le.$el};function ne(le){var he,me;return!Y.value&&(typeof l.prefetchOn=="string"?l.prefetchOn===le:((he=l.prefetchOn)==null?void 0:he[le])??((me=e.prefetchOn)==null?void 0:me[le]))&&(l.prefetch??e.prefetch)!==!1&&l.noPrefetch!==!0&&l.target!=="_blank"&&!isSlowConnection()}async function se(le=useNuxtApp()){if(Y.value)return;Y.value=!0;const he=typeof S.value=="string"?S.value:z.value?resolveRouteObject(S.value):n.resolve(S.value).fullPath,me=z.value?new URL(he,window.location.href).href:he;await Promise.all([le.hooks.callHook("link:prefetch",me).catch(()=>{}),!z.value&&!$.value&&preloadRouteComponents(S.value,n).catch(()=>{})])}if(ne("visibility")){const le=useNuxtApp();let he,me=null;onMounted(()=>{const ge=useObserver();onNuxtReady(()=>{he=requestIdleCallback$1(()=>{var xt;(xt=ie==null?void 0:ie.value)!=null&&xt.tagName&&(me=ge.observe(ie.value,async()=>{me==null||me(),me=null,await se(le)}))})})}),onBeforeUnmount(()=>{he&&cancelIdleCallback(he),me==null||me(),me=null})}return()=>{var me;if(!z.value&&!$.value&&!i(S.value)){const ge={ref:ue,to:S.value,activeClass:l.activeClass||e.activeClass,exactActiveClass:l.exactActiveClass||e.exactActiveClass,replace:l.replace,ariaCurrentValue:l.ariaCurrentValue,custom:l.custom};return l.custom||(ne("interaction")&&(ge.onPointerenter=se.bind(null,void 0),ge.onFocus=se.bind(null,void 0)),Y.value&&(ge.class=l.prefetchedClass||e.prefetchedClass),ge.rel=l.rel||void 0),h(resolveComponent("RouterLink"),ge,d.default)}const le=l.target||null,he=firstNonUndefined(l.noRel?"":l.rel,e.externalRelAttribute,k.value||$.value?"noopener noreferrer":"")||null;return l.custom?d.default?d.default({href:C.value,navigate:I,prefetch:se,get route(){if(!C.value)return;const ge=new URL(C.value,window.location.href);return{path:ge.pathname,fullPath:ge.pathname,get query(){return parseQuery$1(ge.search)},hash:ge.hash,params:{},name:void 0,matched:[],redirectedFrom:void 0,meta:{},href:C.value}},rel:he,target:le,isExternal:z.value||$.value,isActive:!1,isExactActive:!1}):null:h("a",{ref:ie,href:C.value||null,rel:he,target:le},(me=d.default)==null?void 0:me.call(d))}}})}const __nuxt_component_0$3=defineNuxtLink(nuxtLinkDefaults);function applyTrailingSlashBehavior(e,t){const i=t==="append"?withTrailingSlash:withoutTrailingSlash;return hasProtocol(e)&&!e.startsWith("http")?e:i(e,!0)}function useObserver(){const e=useNuxtApp();if(e._observer)return e._observer;let t=null;const i=new Map,r=(l,d)=>(t||(t=new IntersectionObserver(n=>{for(const S of n){const C=i.get(S.target);(S.isIntersecting||S.intersectionRatio>0)&&C&&C()}})),i.set(l,d),t.observe(l),()=>{i.delete(l),t==null||t.unobserve(l),i.size===0&&(t==null||t.disconnect(),t=null)});return e._observer={observe:r}}const IS_2G_RE=/2g/;function isSlowConnection(){const e=navigator.connection;return!!(e&&(e.saveData||IS_2G_RE.test(e.effectiveType)))}const inlineConfig={nuxt:{},icon:{provider:"server",class:"",aliases:{},iconifyApiEndpoint:"https://api.iconify.design",localApiEndpoint:"/api/_nuxt_icon",fallbackToApi:!0,cssSelectorPrefix:"i-",cssWherePseudo:!0,mode:"svg",attrs:{"aria-hidden":!0},collections:["academicons","akar-icons","ant-design","arcticons","basil","bi","bitcoin-icons","bpmn","brandico","bx","bxl","bxs","bytesize","carbon","catppuccin","cbi","charm","ci","cib","cif","cil","circle-flags","circum","clarity","codicon","covid","cryptocurrency","cryptocurrency-color","dashicons","devicon","devicon-plain","ei","el","emojione","emojione-monotone","emojione-v1","entypo","entypo-social","eos-icons","ep","et","eva","f7","fa","fa-brands","fa-regular","fa-solid","fa6-brands","fa6-regular","fa6-solid","fad","fe","feather","file-icons","flag","flagpack","flat-color-icons","flat-ui","flowbite","fluent","fluent-emoji","fluent-emoji-flat","fluent-emoji-high-contrast","fluent-mdl2","fontelico","fontisto","formkit","foundation","fxemoji","gala","game-icons","geo","gg","gis","gravity-ui","gridicons","grommet-icons","guidance","healthicons","heroicons","heroicons-outline","heroicons-solid","hugeicons","humbleicons","ic","icomoon-free","icon-park","icon-park-outline","icon-park-solid","icon-park-twotone","iconamoon","iconoir","icons8","il","ion","iwwa","jam","la","lets-icons","line-md","logos","ls","lucide","lucide-lab","mage","majesticons","maki","map","marketeq","material-symbols","material-symbols-light","mdi","mdi-light","medical-icon","memory","meteocons","mi","mingcute","mono-icons","mynaui","nimbus","nonicons","noto","noto-v1","octicon","oi","ooui","openmoji","oui","pajamas","pepicons","pepicons-pencil","pepicons-pop","pepicons-print","ph","pixelarticons","prime","ps","quill","radix-icons","raphael","ri","rivet-icons","si-glyph","simple-icons","simple-line-icons","skill-icons","solar","streamline","streamline-emojis","subway","svg-spinners","system-uicons","tabler","tdesign","teenyicons","token","token-branded","topcoat","twemoji","typcn","uil","uim","uis","uit","uiw","unjs","vaadin","vs","vscode-icons","websymbol","weui","whh","wi","wpf","zmdi","zondicons","custom"],fetchTimeout:1500,customCollections:["custom"]}},__appConfig=defuFn(inlineConfig);function useAppConfig(){const e=useNuxtApp();return e._appConfig||(e._appConfig=reactive(__appConfig)),e._appConfig}const plugin$1=defineNuxtPlugin({name:"pinia",setup(e){const t=createPinia();return e.vueApp.use(t),setActivePinia(t),e.payload&&e.payload.pinia&&(t.state.value=e.payload.pinia),{provide:{pinia:t}}}}),LazySectionChart=defineAsyncComponent(()=>__vitePreload(()=>import("./Bee8PZhJ.js"),__vite__mapDeps([11,5,2,9,12]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionContacts=defineAsyncComponent(()=>__vitePreload(()=>import("./1V0l9_kq.js"),__vite__mapDeps([13,5,14]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionContactsHero=defineAsyncComponent(()=>__vitePreload(()=>import("./BOnNTYUr.js"),__vite__mapDeps([15,5,16]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionContactsLocation=defineAsyncComponent(()=>__vitePreload(()=>import("./CZXlaMy4.js"),__vite__mapDeps([17,5,18]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionDimensions=defineAsyncComponent(()=>__vitePreload(()=>import("./DK3RlC3N.js"),__vite__mapDeps([19,5,20]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionFlask=defineAsyncComponent(()=>__vitePreload(()=>import("./IHPBCuX1.js"),__vite__mapDeps([21,3,4,9,5,22]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionHero=defineAsyncComponent(()=>__vitePreload(()=>import("./i6dABkDf.js"),__vite__mapDeps([23,3,4,5,24]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionIntro=defineAsyncComponent(()=>__vitePreload(()=>import("./BUcaIFkt.js"),__vite__mapDeps([25,3,4,5,26]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionMechanism=defineAsyncComponent(()=>__vitePreload(()=>import("./BZppgdm_.js"),__vite__mapDeps([27,3,4,9,5,28]),import.meta.url).then(e=>e.default||e.default||e)),LazySectionTesting=defineAsyncComponent(()=>__vitePreload(()=>import("./D7mAJn5o.js"),__vite__mapDeps([29,3,4,2,30]),import.meta.url).then(e=>e.default||e.default||e)),LazyIcon=defineAsyncComponent(()=>__vitePreload(()=>Promise.resolve().then(()=>index),void 0,import.meta.url).then(e=>e.default||e.default||e)),lazyGlobalComponents=[["SectionChart",LazySectionChart],["SectionContacts",LazySectionContacts],["SectionContactsHero",LazySectionContactsHero],["SectionContactsLocation",LazySectionContactsLocation],["SectionDimensions",LazySectionDimensions],["SectionFlask",LazySectionFlask],["SectionHero",LazySectionHero],["SectionIntro",LazySectionIntro],["SectionMechanism",LazySectionMechanism],["SectionTesting",LazySectionTesting],["Icon",LazyIcon]],components_plugin_z4hgvsiddfKkfXTP6M8M4zG5Cb7sGnDhcryKVM45Di4=defineNuxtPlugin({name:"nuxt:global-components",setup(e){for(const[t,i]of lazyGlobalComponents)e.vueApp.component(t,i),e.vueApp.component("Lazy"+t,i)}}),layouts={default:defineAsyncComponent(()=>__vitePreload(()=>import("./B-7pZHGl.js"),[],import.meta.url).then(e=>e.default||e))},prefetch_client_plc8Lsxh1X10IEwNhW7mxf0MabjBz64b9ODLi87nY5E=defineNuxtPlugin({name:"nuxt:prefetch",setup(e){const t=useRouter();e.hooks.hook("app:mounted",()=>{t.beforeEach(async i=>{var o;const r=(o=i==null?void 0:i.meta)==null?void 0:o.layout;r&&typeof layouts[r]=="function"&&await layouts[r]()})}),e.hooks.hook("link:prefetch",i=>{if(hasProtocol(i))return;const r=t.resolve(i);if(!r)return;const o=r.meta.layout;let l=toArray$1(r.meta.middleware);l=l.filter(d=>typeof d=="string");for(const d of l)typeof namedMiddleware[d]=="function"&&namedMiddleware[d]();typeof o=="string"&&o in layouts&&_loadAsyncComponent(layouts[o])})}});function useCsrf(){const e=useRuntimeConfig().public.csurf.headerName??"",t=window.document.querySelector('meta[name="csrf-token"]');return{csrf:t==null?void 0:t.getAttribute("content"),headerName:e}}const plugin_xdQC2I5FZA9BN_8d8MWCXWAuqLDNRFNSkZczMVXWDIs=defineNuxtPlugin(()=>({provide:{csrfFetch:$fetch$1.create({onRequest({options:t}){const{csrf:i,headerName:r}=useCsrf();t.headers=new Headers(t.headers||{}),t.headers.append(r,i)}})}}));var explicitKeys=["__key","__init","__shim","__original","__index","__prevKey"];function token(){return Math.random().toString(36).substring(2,15)}function dedupe(e,t){return[...e instanceof Set?e:new Set(e)]}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eq(e,t,i=!0,r=["__key"]){if(e===t)return!0;if(typeof t=="object"&&typeof e=="object"){if(e instanceof Map||e instanceof Set)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return eqRegExp(e,t);if(e===null||t===null||Object.keys(e).length!==Object.keys(t).length)return!1;for(const o of r)if((o in e||o in t)&&e[o]!==t[o])return!1;for(const o in e)if(!(o in t)||e[o]!==t[o]&&!i||i&&!eq(e[o],t[o],i,r))return!1;return!0}return!1}function eqRegExp(e,t){return e.source===t.source&&e.flags.split("").sort().join("")===t.flags.split("").sort().join("")}function empty(e){const t=typeof e;if(t==="number")return!1;if(e===void 0)return!0;if(t==="string")return e==="";if(t==="object"){if(e===null)return!0;for(const i in e)return!1;return!(e instanceof RegExp||e instanceof Date)}return!1}function escapeExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function regexForFormat(e){const t=`^${escapeExp(e)}$`,i={MM:"(0[1-9]|1[012])",M:"([1-9]|1[012])",DD:"([012][0-9]|3[01])",D:"([012]?[0-9]|3[01])",YYYY:"\\d{4}",YY:"\\d{2}"},r=Object.keys(i);return new RegExp(r.reduce((o,l)=>o.replace(l,i[l]),t))}function isRecord(e){return Object.prototype.toString.call(e)==="[object Object]"}function isObject(e){return isRecord(e)||Array.isArray(e)}function isPojo(e){if(isRecord(e)===!1||e.__FKNode__||e.__POJO__===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(isRecord(i)===!1||i.hasOwnProperty("isPrototypeOf")===!1)}var extend$1=(e,t,i=!1,r=!1)=>{if(t===null)return null;const o={};if(typeof t=="string")return t;for(const l in e)if(has(t,l)&&(t[l]!==void 0||!r)){if(i&&Array.isArray(e[l])&&Array.isArray(t[l])){o[l]=e[l].concat(t[l]);continue}if(t[l]===void 0)continue;isPojo(e[l])&&isPojo(t[l])?o[l]=extend$1(e[l],t[l],i,r):o[l]=t[l]}else o[l]=e[l];for(const l in t)!has(o,l)&&t[l]!==void 0&&(o[l]=t[l]);return o};function isQuotedString(e){if(e[0]!=='"'&&e[0]!=="'"||e[0]!==e[e.length-1])return!1;const t=e[0];for(let i=1;i<e.length;i++)if(e[i]===t&&(i===1||e[i-1]!=="\\")&&i!==e.length-1)return!1;return!0}function rmEscapes(e){if(!e.length)return"";let t="",i="";for(let r=0;r<e.length;r++){const o=e.charAt(r);(o!=="\\"||i==="\\")&&(t+=o),i=o}return t}function nodeProps(...e){return e.reduce((t,i)=>{const{value:r,name:o,modelValue:l,config:d,plugins:n,...S}=i;return Object.assign(t,S)},{})}function parseArgs(e){const t=[];let i="",r=0,o="",l="";for(let d=0;d<e.length;d++){const n=e.charAt(d);n===o&&l!=="\\"?o="":(n==="'"||n==='"')&&!o&&l!=="\\"?o=n:n==="("&&!o?r++:n===")"&&!o&&r--,n===","&&!o&&r===0?(t.push(i),i=""):(n!==" "||o)&&(i+=n),l=n}return i&&t.push(i),t}function except(e,t){const i={},r=t.filter(l=>l instanceof RegExp),o=new Set(t);for(const l in e)!o.has(l)&&!r.some(d=>d.test(l))&&(i[l]=e[l]);return i}function only(e,t){const i={},r=t.filter(o=>o instanceof RegExp);return t.forEach(o=>{o instanceof RegExp||(i[o]=e[o])}),Object.keys(e).forEach(o=>{r.some(l=>l.test(o))&&(i[o]=e[o])}),i}function camel(e){return e.replace(/-([a-z0-9])/gi,(t,i)=>i.toUpperCase())}function kebab(e){return e.replace(/([a-z0-9])([A-Z])/g,(t,i,r)=>i+"-"+r.toLowerCase()).replace(" ","-").toLowerCase()}function shallowClone(e,t=explicitKeys){if(e!==null&&typeof e=="object"){let i;if(Array.isArray(e)?i=[...e]:isPojo(e)&&(i={...e}),i)return applyExplicit(e,i,t),i}return e}function clone(e,t=explicitKeys){if(e===null||e instanceof RegExp||e instanceof Date||e instanceof Map||e instanceof Set||typeof File=="function"&&e instanceof File)return e;let i;Array.isArray(e)?i=e.map(r=>typeof r=="object"?clone(r,t):r):i=Object.keys(e).reduce((r,o)=>(r[o]=typeof e[o]=="object"?clone(e[o],t):e[o],r),{});for(const r of t)r in e&&Object.defineProperty(i,r,{enumerable:!1,value:e[r]});return i}function cloneAny(e){return typeof e=="object"?clone(e):e}function getAt(e,t){if(!e||typeof e!="object")return null;const i=t.split(".");let r=e;for(const o in i){const l=i[o];if(has(r,l)&&(r=r[l]),+o===i.length-1)return r;if(!r||typeof r!="object")return null}return null}function undefine(e){return e!==void 0&&e!=="false"&&e!==!1?!0:void 0}function init(e){return Object.isFrozen(e)?e:Object.defineProperty(e,"__init",{enumerable:!1,value:!0})}function slugify(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g," ").trim().replace(/\s+/g,"-")}function applyExplicit(e,t,i){for(const r of i)r in e&&Object.defineProperty(t,r,{enumerable:!1,value:e[r]});return t}function oncePerTick(e){let t=!1;return(...i)=>{if(!t)return t=!0,queueMicrotask(()=>t=!1),e(...i)}}function boolGetter(e){if(!(e==="false"||e===!1))return!0}function createDispatcher(){const e=[];let t=0;const i=o=>e.push(o),r=o=>{const l=e[t];return typeof l=="function"?l(o,d=>(t++,r(d))):(t=0,o)};return i.dispatch=r,i.unshift=o=>e.unshift(o),i.remove=o=>{const l=e.indexOf(o);l>-1&&e.splice(l,1)},i}function createEmitter(){const e=new Map,t=new Map;let i;const r=(o,l)=>{if(i){i.set(l.name,[o,l]);return}e.has(l.name)&&e.get(l.name).forEach(d=>{(l.origin===o||d.modifiers.includes("deep"))&&d.listener(l)}),l.bubble&&o.bubble(l)};return r.flush=()=>{e.clear(),t.clear(),i==null||i.clear()},r.on=(o,l,d="push")=>{const[n,...S]=o.split("."),C=l.receipt||token(),I={modifiers:S,event:n,listener:l,receipt:C};return e.has(n)?e.get(n)[d](I):e.set(n,[I]),t.has(C)?t.get(C)[d](n):t.set(C,[n]),C},r.off=o=>{var l;t.has(o)&&((l=t.get(o))==null||l.forEach(d=>{const n=e.get(d);Array.isArray(n)&&e.set(d,n.filter(S=>S.receipt!==o))}),t.delete(o))},r.pause=o=>{i||(i=new Map),o&&o.walk(l=>l._e.pause())},r.play=o=>{if(!i)return;const l=i;i=void 0,l.forEach(([d,n])=>r(d,n)),o&&o.walk(d=>d._e.play())},r}function emit(e,t,i,r,o=!0,l){return t._e(e,{payload:r,name:i,bubble:o,origin:e,meta:l}),e}function bubble(e,t,i){return isNode(e.parent)&&e.parent._e(e.parent,i),e}function on(e,t,i,r,o){return t._e.on(i,r,o)}function off(e,t,i){return t._e.off(i),e}var errorHandler=createDispatcher();errorHandler((e,t)=>(e.message||(e.message=`E${e.code}`),t(e)));var warningHandler=createDispatcher();warningHandler((e,t)=>{e.message||(e.message=`W${e.code}`);const i=t(e);return console&&typeof console.warn=="function"&&console.warn(i.message),i});function warn(e,t={}){warningHandler.dispatch({code:e,data:t})}function error(e,t={}){throw Error(errorHandler.dispatch({code:e,data:t}).message)}function createMessage(e,t){return{blocking:!1,key:token(),meta:{},type:"state",visible:!0,...e}}var storeTraps={apply:applyMessages,set:setMessage,remove:removeMessage$1,filter:filterMessages,reduce:reduceMessages,release:releaseBuffer,touch:touchMessages};function createStore(e=!1){const t={};let i,r=e,o=[];const l=new Map;let d;const n=new Proxy(t,{get(...S){const[C,I]=S;return I==="buffer"?r:I==="_b"?o:I==="_m"?l:I==="_r"?d:has(storeTraps,I)?storeTraps[I].bind(null,t,n,i):Reflect.get(...S)},set(S,C,I){return C==="_n"?(i=I,d==="__n"&&releaseMissed(i,n),!0):C==="_b"?(o=I,!0):C==="buffer"?(r=I,!0):C==="_r"?(d=I,!0):(error(101,i),!1)}});return n}function setMessage(e,t,i,r){if(t.buffer)return t._b.push([[r]]),t;if(e[r.key]!==r){if(typeof r.value=="string"&&r.meta.localize!==!1){const l=r.value;r.value=i.t(r),r.value!==l&&(r.meta.locale=i.props.locale)}const o=`message-${has(e,r.key)?"updated":"added"}`;e[r.key]=Object.freeze(i.hook.message.dispatch(r)),i.emit(o,r)}return t}function touchMessages(e,t){for(const i in e){const r={...e[i]};t.set(r)}}function removeMessage$1(e,t,i,r){if(has(e,r)){const o=e[r];delete e[r],i.emit("message-removed",o)}return t.buffer===!0&&(t._b=t._b.filter(o=>(o[0]=o[0].filter(l=>l.key!==r),o[1]||o[0].length))),t}function filterMessages(e,t,i,r,o){for(const l in e){const d=e[l];(!o||d.type===o)&&!r(d)&&removeMessage$1(e,t,i,l)}}function reduceMessages(e,t,i,r,o){for(const l in e){const d=e[l];o=r(o,d)}return o}function applyMessages(e,t,i,r,o){if(Array.isArray(r)){if(t.buffer){t._b.push([r,o]);return}const l=new Set(r.map(d=>(t.set(d),d.key)));typeof o=="string"?t.filter(d=>d.type!==o||l.has(d.key)):typeof o=="function"&&t.filter(d=>!o(d)||l.has(d.key))}else for(const l in r){const d=i.at(l);d?d.store.apply(r[l],o):missed(i,t,l,r[l],o)}}function createMessages(e,...t){const i=`${e.name}-set`,r=o=>createMessage({key:slugify(o),type:"error",value:o,meta:{source:i,autoClear:!0}});return t.filter(o=>!!o).map(o=>{if(typeof o=="string"&&(o=[o]),Array.isArray(o))return o.map(l=>r(l));{const l={};for(const d in o)Array.isArray(o[d])?l[d]=o[d].map(n=>r(n)):l[d]=[r(o[d])];return l}})}function missed(e,t,i,r,o){var d;const l=t._m;l.has(i)||l.set(i,[]),t._r||(t._r=releaseMissed(e,t)),(d=l.get(i))==null||d.push([r,o])}function releaseMissed(e,t){return e.on("child.deep",({payload:i})=>{t._m.forEach((r,o)=>{e.at(o)===i&&(r.forEach(([l,d])=>{i.store.apply(l,d)}),t._m.delete(o))}),t._m.size===0&&t._r&&(e.off(t._r),t._r=void 0)})}function releaseBuffer(e,t){t.buffer=!1,t._b.forEach(([i,r])=>t.apply(i,r)),t._b=[]}function createLedger(){const e={};let t;return{count:(...i)=>createCounter(t,e,...i),init(i){t=i,i.on("message-added.deep",add(e,1)),i.on("message-removed.deep",add(e,-1))},merge:i=>merge(t,e,i),settled(i){return has(e,i)?e[i].promise:Promise.resolve()},unmerge:i=>merge(t,e,i,!0),value(i){return has(e,i)?e[i].count:0}}}function createCounter(e,t,i,r,o=0){if(r=parseCondition(r||i),!has(t,i)){const l={condition:r,count:0,name:i,node:e,promise:Promise.resolve(),resolve:()=>{}};t[i]=l,o=e.store.reduce((d,n)=>d+l.condition(n)*1,o),e.each(d=>{d.ledger.count(l.name,l.condition),o+=d.ledger.value(l.name)})}return count(t[i],o).promise}function parseCondition(e){return typeof e=="function"?e:t=>t.type===e}function count(e,t){const i=e.count,r=e.count+t;return e.count=r,i===0&&r!==0?(e.node.emit(`unsettled:${e.name}`,e.count,!1),e.promise=new Promise(o=>e.resolve=o)):i!==0&&r===0&&(e.node.emit(`settled:${e.name}`,e.count,!1),e.resolve()),e.node.emit(`count:${e.name}`,e.count,!1),e}function add(e,t){return i=>{for(const r in e){const o=e[r];o.condition(i.payload)&&count(o,t)}}}function merge(e,t,i,r=!1){const o=e;for(const l in t){const d=t[l].condition;r||i.ledger.count(l,d);const n=i.ledger.value(l)*(r?-1:1);if(e){do e.ledger.count(l,d,n),e=e.parent;while(e);e=o}}}var registry=new Map,reflected=new Map,emit2=createEmitter();function register$1(e){e.props.id&&(registry.set(e.props.id,e),reflected.set(e,e.props.id),emit2(e,{payload:e,name:e.props.id,bubble:!1,origin:e}))}function deregister(e){if(reflected.has(e)){const t=reflected.get(e);reflected.delete(e),registry.delete(t),emit2(e,{payload:null,name:t,bubble:!1,origin:e})}}function getNode(e){return registry.get(e)}function watchRegistry(e,t){return emit2.on(e,t)}function configChange(e,t,i){let r=!0;return t in e.config._t?r=!1:e.emit(`config:${t}`,i,!1),t in e.props||(e.emit("prop",{prop:t,value:i}),e.emit(`prop:${t}`,i)),r}function createConfig(e={}){const t=new Set,i={...e,_add:o=>t.add(o),_rm:o=>t.delete(o)};return new Proxy(i,{set(o,l,d,n){return typeof l=="string"&&t.forEach(S=>configChange(S,l,d)),Reflect.set(o,l,d,n)}})}function submitForm(e,t){const i=(t||document).getElementById(e);if(i instanceof HTMLFormElement){const r=new Event("submit",{cancelable:!0,bubbles:!0});i.dispatchEvent(r);return}warn(151,e)}function clearState(e){const t=i=>{for(const r in i.store){const o=i.store[r];o.type==="error"||o.type==="ui"&&r==="incomplete"?i.store.remove(r):o.type==="state"&&i.store.set({...o,value:!1})}};t(e),e.walk(t)}function reset(e,t){const i=typeof e=="string"?getNode(e):e;if(i){const r=d=>{const n=cloneAny(d.props.initial);return n!==void 0?n:d.type==="group"?{}:d.type==="list"?[]:void 0};i._e.pause(i);const o=cloneAny(t);return t&&!empty(t)&&(i.props.initial=isObject(o)?init(o):o,i.props._init=i.props.initial),i.input(r(i),!1),i.walk(d=>{d.type==="list"&&d.sync||d.input(r(d),!1)}),i.input(empty(o)&&o?o:r(i),!1),i.type!=="input"&&t&&!empty(t)&&isObject(t)&&i.walk(d=>{d.props.initial=isObject(d.value)?init(d.value):d.value,d.props._init=d.props.initial}),i._e.play(i),clearState(i),i.emit("reset",i),i}warn(152,e)}var defaultConfig$2={delimiter:".",delay:0,locale:"en",rootClasses:e=>({[`formkit-${kebab(e)}`]:!0})},useIndex=Symbol("index"),valueRemoved=Symbol("removed"),valueMoved=Symbol("moved"),valueInserted=Symbol("inserted");function isList(e){return e.type==="list"&&Array.isArray(e._value)}function isNode(e){return e&&typeof e=="object"&&e.__FKNode__===!0}var invalidSetter=(e,t,i)=>{error(102,[e,i])},traps={_c:trap(getContext,invalidSetter,!1),add:trap(addChild),addProps:trap(addProps),address:trap(getAddress,invalidSetter,!1),at:trap(getNode2),bubble:trap(bubble),clearErrors:trap(clearErrors),calm:trap(calm),config:trap(!1),define:trap(define),disturb:trap(disturb),destroy:trap(destroy),extend:trap(extend),hydrate:trap(hydrate),index:trap(getIndex,setIndex,!1),input:trap(input),each:trap(eachChild),emit:trap(emit),find:trap(find),on:trap(on),off:trap(off),parent:trap(!1,setParent),plugins:trap(!1),remove:trap(removeChild),root:trap(getRoot,invalidSetter,!1),reset:trap(resetValue),resetConfig:trap(resetConfig),setErrors:trap(setErrors),submit:trap(submit),t:trap(text$1),use:trap(use),name:trap(getName,!1,!1),walk:trap(walkTree)};function createTraps(){return new Map(Object.entries(traps))}function trap(e,t,i=!0){return{get:e?(r,o)=>i?(...l)=>e(r,o,...l):e(r,o):!1,set:t!==void 0?t:invalidSetter.bind(null)}}function createHooks(){const e=new Map;return new Proxy(e,{get(t,i){return e.has(i)||e.set(i,createDispatcher()),e.get(i)}})}var nameCount=0,idCount=0;function resetCount(){nameCount=0,idCount=0}function createName(e){var t,i;return((t=e.parent)==null?void 0:t.type)==="list"?useIndex:e.name||`${((i=e.props)==null?void 0:i.type)||"input"}_${++nameCount}`}function createValue(e){return e.type==="group"?init(e.value&&typeof e.value=="object"&&!Array.isArray(e.value)?e.value:{}):e.type==="list"?init(Array.isArray(e.value)?e.value:[]):e.value}function input(e,t,i,r=!0){return t._value=validateInput(e,e.hook.input.dispatch(i)),e.emit("input",t._value),e.isCreated&&e.type==="input"&&eq(t._value,t.value)&&!e.props.mergeStrategy?(e.emit("commitRaw",t.value),t.settled):(t.isSettled&&e.disturb(),r?(t._tmo&&clearTimeout(t._tmo),t._tmo=setTimeout(commit,e.props.delay,e,t)):commit(e,t),t.settled)}function validateInput(e,t){switch(e.type){case"input":break;case"group":(!t||typeof t!="object")&&error(107,[e,t]);break;case"list":Array.isArray(t)||error(108,[e,t]);break}return t}function commit(e,t,i=!0,r=!0){t._value=t.value=e.hook.commit.dispatch(t._value),e.type!=="input"&&r&&e.hydrate(),e.emit("commitRaw",t.value),e.emit("commit",t.value),i&&e.calm()}function partial(e,{name:t,value:i,from:r}){if(!Object.isFrozen(e._value)){if(isList(e)){const o=i===valueRemoved?[]:i===valueMoved&&typeof r=="number"?e._value.splice(r,1):[i];e._value.splice(t,i===valueMoved||r===valueInserted?0:1,...o);return}i!==valueRemoved?e._value[t]=i:delete e._value[t]}}function hydrate(e,t){const i=t._value;return e.type==="list"&&e.sync&&syncListNodes(e,t),t.children.forEach(r=>{if(typeof i=="object")if(r.name in i){const o=r.type!=="input"||i[r.name]&&typeof i[r.name]=="object"?init(i[r.name]):i[r.name];if(!r.isSettled||(!isObject(o)||r.props.mergeStrategy)&&eq(o,r._value))return;r.input(o,!1)}else(e.type!=="list"||typeof r.name=="number")&&partial(t,{name:r.name,value:r.value}),i.__init||(r.type==="group"?r.input({},!1):r.type==="list"?r.input([],!1):r.input(void 0,!1))}),e}function syncListNodes(e,t){const i=e._value;if(!Array.isArray(i))return;const r=[],o=new Set(t.children),l=new Map;i.forEach((n,S)=>{if(t.children[S]&&t.children[S]._value===n)r.push(t.children[S]),o.delete(t.children[S]);else{r.push(null);const C=l.get(n)||[];C.push(S),l.set(n,C)}}),o.size&&l.size&&o.forEach(n=>{if(l.has(n._value)){const S=l.get(n._value),C=S.shift();r[C]=n,o.delete(n),S.length||l.delete(n._value)}});const d=[];for(l.forEach(n=>{d.push(...n)});o.size&&d.length;){const n=o.values().next().value,S=d.shift();if(S===void 0)break;r[S]=n,o.delete(n)}d.forEach((n,S)=>{r[n]=createPlaceholder({value:S})}),o.size&&o.forEach(n=>{if(!("__FKP"in n)){const S=n._c.parent;if(!S||isPlaceholder(S))return;S.ledger.unmerge(n),n._c.parent=null,n.destroy()}}),t.children=r}function disturb(e,t){var i;return t._d<=0&&(t.isSettled=!1,e.emit("settled",!1,!1),t.settled=new Promise(r=>{t._resolve=r}),e.parent&&((i=e.parent)==null||i.disturb())),t._d++,e}function calm(e,t,i){var r;if(i!==void 0&&e.type!=="input"){partial(t,i);const o=!!(e.config.mergeStrategy&&e.config.mergeStrategy[i.name]);return commit(e,t,!0,o)}t._d>0&&t._d--,t._d===0&&(t.isSettled=!0,e.emit("settled",!0,!1),e.parent&&((r=e.parent)==null||r.calm({name:e.name,value:t.value})),t._resolve&&t._resolve(t.value))}function destroy(e,t){e.emit("destroying",e),e.store.filter(()=>!1),e.parent&&e.parent.remove(e),deregister(e),e.emit("destroyed",e),t._e.flush(),t._value=t.value=void 0;for(const i in t.context)delete t.context[i];t.plugins.clear(),t.context=null}function define(e,t,i){t.type=i.type;const r=clone(i);e.props.__propDefs=mergeProps(e.props.__propDefs??[],(r==null?void 0:r.props)||[]),r.props=e.props.__propDefs,t.props.definition=r,t.value=t._value=createValue({type:e.type,value:t.value}),i.forceTypeProp&&(e.props.type&&(e.props.originalType=e.props.type),t.props.type=i.forceTypeProp),i.family&&(t.props.family=i.family),i.features&&i.features.forEach(o=>o(e)),i.props&&e.addProps(i.props),e.emit("defined",i)}function addProps(e,t,i){const r=Array.isArray(i)?i:Object.keys(i),o=Array.isArray(i)?{}:r.reduce((d,n)=>("default"in i[n]&&(d[n]=i[n].default),d),{});if(e.props.attrs){const d={...e.props.attrs};e.props._emit=!1;for(const S in d){const C=camel(S);r.includes(C)&&(e.props[C]=d[S],delete d[S])}Array.isArray(i)||r.forEach(S=>{"default"in i[S]&&e.props[S]===void 0&&(e.props[S]=o[S])});const n=cloneAny(t._value);e.props.initial=e.type!=="input"?init(n):n,e.props._emit=!0,e.props.attrs=d}const l=mergeProps(e.props.__propDefs??[],i);return e.props.definition&&(e.props.definition.props=l),e.props.__propDefs=l,e.emit("added-props",i),e}function toPropsObj(e){return Array.isArray(e)?e.reduce((t,i)=>(t[i]={},t),{}):e}function mergeProps(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):extend$1(toPropsObj(e),toPropsObj(t))}function addChild(e,t,i,r){if(e.type==="input"&&error(100,e),i.parent&&i.parent!==e&&i.parent.remove(i),!t.children.includes(i)){if(r!==void 0&&e.type==="list"){const o=t.children[r];o&&"__FKP"in o?(i._c.uid=o.uid,t.children.splice(r,1,i)):t.children.splice(r,0,i),Array.isArray(e.value)&&e.value.length<t.children.length&&e.disturb().calm({name:r,value:i.value,from:valueInserted})}else t.children.push(i);i.isSettled||e.disturb()}if(i.parent!==e){if(i.parent=e,i.parent!==e)return e.remove(i),i.parent.add(i),e}else i.use(e.plugins);return commit(e,t,!1),e.ledger.merge(i),e.emit("child",i),e}function setParent(e,t,i,r){return isNode(r)?(e.parent&&e.parent!==r&&e.parent.remove(e),t.parent=r,e.resetConfig(),r.children.includes(e)?e.use(r.plugins):r.add(e),!0):r===null?(t.parent=null,!0):!1}function removeChild(e,t,i){const r=t.children.indexOf(i);if(r!==-1){i.isSettled&&e.disturb(),t.children.splice(r,1);let o=undefine(i.props.preserve),l=i.parent;for(;o===void 0&&l;)o=undefine(l.props.preserve),l=l.parent;o?e.calm():e.calm({name:e.type==="list"?r:i.name,value:valueRemoved}),i.parent=null,i.config._rmn=i}return e.ledger.unmerge(i),e.emit("childRemoved",i),e}function eachChild(e,t,i){t.children.forEach(r=>!("__FKP"in r)&&i(r))}function walkTree(e,t,i,r=!1,o=!1){t.children.some(l=>{if("__FKP"in l)return!1;const d=i(l);return r&&d===!1?!0:o&&d===!1?!1:l.walk(i,r,o)})}function resetConfig(e,t){const i=e.parent||void 0;t.config=createConfig2(e.config._t,i),e.walk(r=>r.resetConfig())}function use(e,t,i,r=!0,o=!0){return Array.isArray(i)||i instanceof Set?(i.forEach(l=>use(e,t,l)),e):(t.plugins.has(i)||(o&&typeof i.library=="function"&&i.library(e),r&&i(e)!==!1&&(t.plugins.add(i),e.children.forEach(l=>l.use(i)))),e)}function setIndex(e,t,i,r){if(isNode(e.parent)){const o=e.parent.children,l=r>=o.length?o.length-1:r<0?0:r,d=o.indexOf(e);return d===-1?!1:(o.splice(d,1),o.splice(l,0,e),e.parent.children=o,e.parent.type==="list"&&e.parent.disturb().calm({name:l,value:valueMoved,from:d}),!0)}return!1}function getIndex(e){if(e.parent){const t=[...e.parent.children].indexOf(e);return t===-1?e.parent.children.length:t}return-1}function getContext(e,t){return t}function getName(e,t){var i;return((i=e.parent)==null?void 0:i.type)==="list"?e.index:t.name!==useIndex?t.name:e.index}function getAddress(e,t){return t.parent?t.parent.address.concat([e.name]):[e.name]}function getNode2(e,t,i){const r=typeof i=="string"?i.split(e.config.delimiter):i;if(!r.length)return;const o=r[0];let l=e.parent;for(l||(String(r[0])===String(e.name)&&r.shift(),l=e),o==="$parent"&&r.shift();l&&r.length;){const d=r.shift();switch(d){case"$root":l=e.root;break;case"$parent":l=l.parent;break;case"$self":l=e;break;default:l=l.children.find(n=>!("__FKP"in n)&&String(n.name)===String(d))||select$1(l,d)}}return l||void 0}function select$1(e,t){const i=String(t).match(/^(find)\((.*)\)$/);if(i){const[,r,o]=i,l=o.split(",").map(d=>d.trim());switch(r){case"find":return e.find(l[0],l[1]);default:return}}}function find(e,t,i,r){return bfs(e,i,r)}function bfs(e,t,i="name"){const r=typeof i=="string"?l=>l[i]==t:i,o=[e];for(;o.length;){const l=o.shift();if(!("__FKP"in l)){if(r(l,t))return l;o.push(...l.children)}}}function getRoot(e){let t=e;for(;t.parent;)t=t.parent;return t}function createConfig2(e={},t){let i;return new Proxy(e,{get(...r){const o=r[1];if(o==="_t")return e;const l=Reflect.get(...r);if(l!==void 0)return l;if(t){const d=t.config[o];if(d!==void 0)return d}if(e.rootConfig&&typeof o=="string"){const d=e.rootConfig[o];if(d!==void 0)return d}return o==="delay"&&(i==null?void 0:i.type)==="input"?20:defaultConfig$2[o]},set(...r){const o=r[1],l=r[2];if(o==="_n")return i=l,e.rootConfig&&e.rootConfig._add(i),!0;if(o==="_rmn")return e.rootConfig&&e.rootConfig._rm(i),i=void 0,!0;if(!eq(e[o],l,!1)){const d=Reflect.set(...r);return i&&(i.emit(`config:${o}`,l,!1),configChange(i,o,l),i.walk(n=>configChange(n,o,l),!1,!0)),d}return!0}})}function text$1(e,t,i,r="ui"){const o=typeof i=="string"?{key:i,value:i,type:r}:i,l=e.hook.text.dispatch(o);return e.emit("text",l,!1),l.value}function submit(e){const t=e.name;do{if(e.props.isForm===!0)break;e.parent||error(106,t),e=e.parent}while(e);e.props.id&&submitForm(e.props.id,e.props.__root)}function resetValue(e,t,i){return reset(e,i)}function setErrors(e,t,i,r){const o=`${e.name}-set`,l=e.hook.setErrors.dispatch({localErrors:i,childErrors:r});return createMessages(e,l.localErrors,l.childErrors).forEach(d=>{e.store.apply(d,n=>n.meta.source===o)}),e}function clearErrors(e,t,i=!0,r){return e.store.filter(o=>!(r===void 0||o.meta.source===r),"error"),i&&(r=r||`${e.name}-set`,e.walk(o=>{o.store.filter(l=>!(l.type==="error"&&l.meta&&l.meta.source===r))})),e}function createProps(e){const t={initial:typeof e=="object"?cloneAny(e):e};let i,r=!0,o={};return new Proxy(t,{get(...l){var I,z,$,k;const[d,n]=l;let S;has(t,n)?(S=Reflect.get(...l),(I=o[n])!=null&&I.boolean&&(S=boolGetter(S))):i&&typeof n=="string"&&i.config[n]!==void 0?(S=i.config[n],n==="mergeStrategy"&&(i==null?void 0:i.type)==="input"&&isRecord(S)&&i.name in S&&(S=S[i.name])):S=(z=o[n])==null?void 0:z.default;const C=($=o[n])==null?void 0:$.getter;return(k=o[n])!=null&&k.boolean&&(S=!!S),C?C(S,i):S},set(l,d,n,S){var $;if(d==="_n")return i=n,!0;if(d==="_emit")return r=n,!0;let{prop:C,value:I}=i.hook.prop.dispatch({prop:d,value:n});const z=($=o[C])==null?void 0:$.setter;if(I=z?z(I,i):I,!eq(t[C],I,!1)||typeof I=="object"){const k=Reflect.set(l,C,I,S);return C==="__propDefs"&&(o=toPropsObj(I)),r&&(i.emit("prop",{prop:C,value:I}),typeof C=="string"&&i.emit(`prop:${C}`,I)),k}return!0}})}function extend(e,t,i,r){return t.traps.set(i,r),e}function findDefinition(e,t){if(e.props.definition)return e.define(e.props.definition);for(const i of t){if(e.props.definition)return;typeof i.library=="function"&&i.library(e)}}function createContext(e){const t=createValue(e),i=createConfig2(e.config||{},e.parent);return{_d:0,_e:createEmitter(),uid:Symbol(),_resolve:!1,_tmo:!1,_value:t,children:dedupe(e.children||[]),config:i,hook:createHooks(),isCreated:!1,isSettled:!0,ledger:createLedger(),name:createName(e),parent:e.parent||null,plugins:new Set,props:createProps(t),settled:Promise.resolve(t),store:createStore(!0),sync:e.sync||!1,traps:createTraps(),type:e.type||"input",value:t}}function nodeInit(e,t){var r,o;const i=(r=t.props)==null?void 0:r.id;if(i||(o=t.props)==null||delete o.id,e.ledger.init(e.store._n=e.props._n=e.config._n=e),e.props._emit=!1,Object.assign(e.props,i?{}:{id:`input_${idCount++}`},t.props??{}),e.props._emit=!0,findDefinition(e,new Set([...t.plugins||[],...e.parent?e.parent.plugins:[]])),t.plugins)for(const l of t.plugins)use(e,e._c,l,!0,!1);return e.each(l=>e.add(l)),e.parent&&e.parent.add(e,t.index),e.type==="input"&&e.children.length&&error(100,e),input(e,e._c,e._value,!1),e.store.release(),i&&register$1(e),e.emit("created",e),e.isCreated=!0,e}function createPlaceholder(e){return{__FKP:!0,uid:Symbol(),name:(e==null?void 0:e.name)??`p_${nameCount++}`,value:(e==null?void 0:e.value)??null,_value:(e==null?void 0:e.value)??null,type:(e==null?void 0:e.type)??"input",props:{},use:()=>{},input(t){return this._value=t,this.value=t,Promise.resolve()},isSettled:!0}}function isPlaceholder(e){return"__FKP"in e}function createNode(e){const t=e||{},i=createContext(t),r=new Proxy(i,{get(...o){const[,l]=o;if(l==="__FKNode__")return!0;const d=i.traps.get(l);return d&&d.get?d.get(r,i):Reflect.get(...o)},set(...o){const[,l,d]=o,n=i.traps.get(l);return n&&n.set?n.set(r,i,l,d):Reflect.set(...o)}});return nodeInit(r,t)}function isDOM(e){return typeof e!="string"&&has(e,"$el")}function isComponent(e){return typeof e!="string"&&has(e,"$cmp")}function isConditional(e){return!e||typeof e=="string"?!1:has(e,"if")&&has(e,"then")}function isSugar(e){return typeof e!="string"&&"$formkit"in e}function sugar(e){if(typeof e=="string")return{$el:"text",children:e};if(isSugar(e)){const{$formkit:t,for:i,if:r,children:o,bind:l,...d}=e;return Object.assign({$cmp:"FormKit",props:{...d,type:t}},r?{if:r}:{},i?{for:i}:{},o?{children:o}:{},l?{bind:l}:{})}return e}function compile(e){let t;const i=new Set,r=function(ue,ne){return typeof ue=="function"?ue(ne):ue},o=[{"&&":(ie,ue,ne)=>r(ie,ne)&&r(ue,ne),"||":(ie,ue,ne)=>r(ie,ne)||r(ue,ne)},{"===":(ie,ue,ne)=>r(ie,ne)===r(ue,ne),"!==":(ie,ue,ne)=>r(ie,ne)!==r(ue,ne),"==":(ie,ue,ne)=>r(ie,ne)==r(ue,ne),"!=":(ie,ue,ne)=>r(ie,ne)!=r(ue,ne),">=":(ie,ue,ne)=>r(ie,ne)>=r(ue,ne),"<=":(ie,ue,ne)=>r(ie,ne)<=r(ue,ne),">":(ie,ue,ne)=>r(ie,ne)>r(ue,ne),"<":(ie,ue,ne)=>r(ie,ne)<r(ue,ne)},{"+":(ie,ue,ne)=>r(ie,ne)+r(ue,ne),"-":(ie,ue,ne)=>r(ie,ne)-r(ue,ne)},{"*":(ie,ue,ne)=>r(ie,ne)*r(ue,ne),"/":(ie,ue,ne)=>r(ie,ne)/r(ue,ne),"%":(ie,ue,ne)=>r(ie,ne)%r(ue,ne)}],l=o.reduce((ie,ue)=>ie.concat(Object.keys(ue)),[]),d=new Set(l.map(ie=>ie.charAt(0)));function n(ie,ue,ne,se){const le=ie.filter(he=>he.startsWith(ue));return le.length?le.find(he=>se.length>=ne+he.length&&se.substring(ne,ne+he.length)===he?he:!1):!1}function S(ie,ue,ne=1){let se=ne?ue.substring(ie+1).trim():ue.substring(0,ie).trim();if(!se.length)return-1;if(!ne){const he=se.split("").reverse(),me=he.findIndex(ge=>d.has(ge));se=he.slice(me).join("")}const le=se[0];return o.findIndex(he=>{const me=Object.keys(he);return!!n(me,le,0,se)})}function C(ie,ue){let ne="";const se=ue.length;let le=0;for(let he=ie;he<se;he++){const me=ue.charAt(he);if(me==="(")le++;else if(me===")")le--;else if(le===0&&me===" ")continue;if(le===0&&n(l,me,he,ue))return[ne,he-1];ne+=me}return[ne,ue.length-1]}function I(ie,ue=0){const ne=o[ue],se=ie.length,le=Object.keys(ne);let he=0,me=!1,ge=null,xt="",Et=null,Lt,Zt="",Ht="",It="",Yt="",ri=0;const ei=(Ct,Ut)=>{Ct?It+=Ut:xt+=Ut};for(let Ct=0;Ct<se;Ct++)if(Zt=Ht,Ht=ie.charAt(Ct),(Ht==="'"||Ht==='"')&&Zt!=="\\"&&(he===0&&!me||he&&!Yt)){he?Yt=Ht:me=Ht,ei(he,Ht);continue}else if(me&&(Ht!==me||Zt==="\\")||Yt&&(Ht!==Yt||Zt==="\\")){ei(he,Ht);continue}else if(me===Ht){me=!1,ei(he,Ht);continue}else if(Yt===Ht){Yt=!1,ei(he,Ht);continue}else{if(Ht===" ")continue;if(Ht==="(")he===0?ri=Ct:It+=Ht,he++;else if(Ht===")")if(he--,he===0){const Ut=typeof xt=="string"&&xt.startsWith("$")?xt:void 0,Mt=Ut&&ie.charAt(Ct+1)===".";let $t="";Mt&&([$t,Ct]=C(Ct+2,ie));const jt=ge?ue:S(ri,ie,0),mi=S(Ct,ie);jt===-1&&mi===-1?(xt=z(It,-1,Ut,$t),typeof xt=="string"&&(xt=It)):ge&&(jt>=mi||mi===-1)&&ue===jt?(Et=ge.bind(null,z(It,-1,Ut,$t)),ge=null,xt=""):mi>jt&&ue===mi?xt=z(It,-1,Ut,$t):xt+=`(${It})${Mt?`.${$t}`:""}`,It=""}else It+=Ht;else if(he===0&&(Lt=n(le,Ht,Ct,ie))){Ct===0&&error(103,[Lt,ie]),Ct+=Lt.length-1,Ct===ie.length-1&&error(104,[Lt,ie]),ge?xt&&(Et=ge.bind(null,z(xt,ue)),ge=ne[Lt].bind(null,Et),xt=""):Et?(ge=ne[Lt].bind(null,z(Et,ue)),Et=null):(ge=ne[Lt].bind(null,z(xt,ue)),xt="");continue}else ei(he,Ht)}return xt&&ge&&(ge=ge.bind(null,z(xt,ue))),ge=!ge&&Et?Et:ge,!ge&&xt&&(ge=(Ct,Ut)=>typeof Ct=="function"?Ct(Ut):Ct,ge=ge.bind(null,z(xt,ue))),!ge&&!xt&&error(105,ie),ge}function z(ie,ue,ne,se){if(ne){const le=z(ne,o.length);let he,me=se?compile(`$${se}`):!1;if(typeof le=="function"){const ge=parseArgs(String(ie)).map(xt=>z(xt,-1));return xt=>{const Et=le(xt);return typeof Et!="function"?(warn(150,ne),Et):(he=Et(...ge.map(Lt=>typeof Lt=="function"?Lt(xt):Lt)),me&&(me=me.provide(Lt=>{const Zt=t(Lt);return Lt.reduce((It,Yt)=>{if(Yt===se||(se==null?void 0:se.startsWith(`${Yt}(`))){const ei=getAt(he,Yt);It[Yt]=()=>ei}else It[Yt]=Zt[Yt];return It},{})})),me?me():he)}}}else if(typeof ie=="string"){if(ie==="true")return!0;if(ie==="false")return!1;if(ie==="undefined")return;if(isQuotedString(ie))return rmEscapes(ie.substring(1,ie.length-1));if(!isNaN(+ie))return Number(ie);if(ue<o.length-1)return I(ie,ue+1);if(ie.startsWith("$")){const le=ie.substring(1);return i.add(le),function(me){return le in me?me[le]():void 0}}return ie}return ie}const $=I(e.startsWith("$:")?e.substring(2):e),k=Array.from(i);function Y(ie){return t=ie,Object.assign($.bind(null,ie(k)),{provide:Y})}return Object.assign($,{provide:Y})}function createClasses(e,t,i){return i?typeof i=="string"?i.split(" ").reduce((o,l)=>Object.assign(o,{[l]:!0}),{}):typeof i=="function"?createClasses(e,t,i(t,e)):i:{}}function generateClassList(e,t,...i){const r=i.reduce((o,l)=>{if(!l)return handleNegativeClasses(o);const{$reset:d,...n}=l;return handleNegativeClasses(d?n:Object.assign(o,n))},{});return Object.keys(e.hook.classes.dispatch({property:t,classes:r}).classes).filter(o=>r[o]).join(" ")||null}function handleNegativeClasses(e){const t="$remove:";let i=!1;const r=Object.keys(e).filter(o=>(e[o]&&o.startsWith(t)&&(i=!0),e[o]));return r.length>1&&i&&r.filter(l=>l.startsWith(t)).map(l=>{const d=l.substring(t.length);e[d]=!1,e[l]=!1}),e}function setErrors2(e,t,i){const r=getNode(e);r?r.setErrors(t,i):warn(651,e)}function clearErrors2(e,t=!0){const i=getNode(e);i?i.clearErrors(t):warn(652,e)}var FORMKIT_VERSION="1.6.9",revokedObservers=new WeakSet;function createObserver(e,t){const i=t||Object.assign(new Map,{active:!1}),r=new Map,o=function(I){var z;i.active&&(i.has(e)||i.set(e,new Set),(z=i.get(e))==null||z.add(I))},l=function(I){return new Proxy(I,{get(...z){return typeof z[1]=="string"&&o(`prop:${z[1]}`),Reflect.get(...z)}})},d=function(I){return new Proxy(I,{get(...z){return z[1]==="value"?$=>(o(`count:${$}`),I.value($)):Reflect.get(...z)}})},n=function(I,z){return isNode(I)?createObserver(I,i):(z==="value"&&o("commit"),z==="_value"&&o("input"),z==="props"?l(I):z==="ledger"?d(I):(z==="children"&&(o("child"),o("childRemoved")),I))},{proxy:S,revoke:C}=Proxy.revocable(e,{get(...I){switch(I[1]){case"_node":return e;case"deps":return i;case"watch":return($,k,Y)=>watch(S,$,k,Y);case"observe":return()=>{const $=new Map(i);return i.clear(),i.active=!0,$};case"stopObserve":return()=>{const $=new Map(i);return i.active=!1,$};case"receipts":return r;case"kill":return()=>{removeListeners(r),revokedObservers.add(I[2]),C()}}const z=Reflect.get(...I);return typeof z=="function"?(...$)=>{const k=z(...$);return n(k,I[1])}:n(z,I[1])}});return S}function applyListeners(e,[t,i],r,o){t.forEach((l,d)=>{l.forEach(n=>{e.receipts.has(d)||e.receipts.set(d,{});const S=e.receipts.get(d)??{};S[n]=S[n]??[],S[n].push(d.on(n,r,o)),e.receipts.set(d,S)})}),i.forEach((l,d)=>{l.forEach(n=>{if(e.receipts.has(d)){const S=e.receipts.get(d);S&&has(S,n)&&(S[n].map(d.off),delete S[n],e.receipts.set(d,S))}})})}function removeListeners(e){e.forEach((t,i)=>{for(const r in t)t[r].map(i.off)}),e.clear()}function watch(e,t,i,r){const o=n=>{const S=e.stopObserve();applyListeners(e,diffDeps(l,S),()=>watch(e,t,i,r),r),i&&i(n)},l=new Map(e.deps);e.observe();const d=t(e);d instanceof Promise?d.then(n=>o(n)):o(d)}function diffDeps(e,t){const i=new Map,r=new Map;return t.forEach((o,l)=>{if(!e.has(l))i.set(l,o);else{const d=new Set,n=e.get(l);o.forEach(S=>!(n!=null&&n.has(S))&&d.add(S)),i.set(l,d)}}),e.forEach((o,l)=>{if(!t.has(l))r.set(l,o);else{const d=new Set,n=t.get(l);o.forEach(S=>!(n!=null&&n.has(S))&&d.add(S)),r.set(l,d)}}),[i,r]}function isKilled(e){return revokedObservers.has(e)}var accepted=function({value:t}){return["yes","on","1",1,!0,"true"].includes(t)};accepted.skipEmpty=!1;var accepted_default=accepted,date_after=function({value:e},t=!1){const i=Date.parse(t||new Date),r=Date.parse(String(e));return isNaN(r)?!1:r>i},date_after_default=date_after,date_after_or_equal=function({value:e},t=!1){const i=Date.parse(t||new Date),r=Date.parse(String(e));return isNaN(r)?!1:r>i||r===i},date_after_or_equal_default=date_after_or_equal,date_after_node=function(e,t){var o;if(!t)return!1;const i=Date.parse(String(e.value)),r=Date.parse(String((o=e.at(t))==null?void 0:o.value));return isNaN(r)?!0:isNaN(i)?!1:i>r},date_after_node_default=date_after_node,alpha=function({value:e},t="default"){const i={default:new RegExp("^\\p{L}+$","u"),latin:/^[a-z]+$/i},r=has(i,t)?t:"default";return i[r].test(String(e))},alpha_default=alpha,alpha_spaces=function({value:e},t="default"){const i={default:/^[\p{L} ]+$/u,latin:/^[a-z ]+$/i},r=has(i,t)?t:"default";return i[r].test(String(e))},alpha_spaces_default=alpha_spaces,alphanumeric=function({value:e},t="default"){const i={default:/^[0-9\p{L}]+$/u,latin:/^[0-9a-z]+$/i},r=has(i,t)?t:"default";return i[r].test(String(e))},alphanumeric_default=alphanumeric,date_before=function({value:e},t=!1){const i=Date.parse(t||new Date),r=Date.parse(String(e));return isNaN(r)?!1:r<i},date_before_default=date_before,date_before_node=function(e,t){var o;if(!t)return!1;const i=Date.parse(String(e.value)),r=Date.parse(String((o=e.at(t))==null?void 0:o.value));return isNaN(r)?!0:isNaN(i)?!1:i<r},date_before_node_default=date_before_node,date_before_or_equal=function({value:e},t=!1){const i=Date.parse(t||new Date),r=Date.parse(String(e));return isNaN(r)?!1:r<i||r===i},date_before_or_equal_default=date_before_or_equal,between=function({value:t},i,r){if(!isNaN(t)&&!isNaN(i)&&!isNaN(r)){const o=1*t;i=Number(i),r=Number(r);const[l,d]=i<=r?[i,r]:[r,i];return o>=1*l&&o<=1*d}return!1},between_default=between,hasConfirm=/(_confirm(?:ed)?)$/,confirm=function(t,i,r="loose"){var l;i||(i=hasConfirm.test(t.name)?t.name.replace(hasConfirm,""):`${t.name}_confirm`);const o=(l=t.at(i))==null?void 0:l.value;return r==="strict"?t.value===o:t.value==o},confirm_default=confirm,contains_alpha=function({value:e},t="default"){const i={default:new RegExp("\\p{L}","u"),latin:/[a-z]/i},r=has(i,t)?t:"default";return i[r].test(String(e))},contains_alpha_default=contains_alpha,contains_alpha_spaces=function({value:e},t="default"){const i={default:/[\p{L} ]/u,latin:/[a-z ]/i},r=has(i,t)?t:"default";return i[r].test(String(e))},contains_alpha_spaces_default=contains_alpha_spaces,contains_alphanumeric=function({value:e},t="default"){const i={default:/[0-9\p{L}]/u,latin:/[0-9a-z]/i},r=has(i,t)?t:"default";return i[r].test(String(e))},contains_alphanumeric_default=contains_alphanumeric,contains_lowercase=function({value:e},t="default"){const i={default:new RegExp("\\p{Ll}","u"),latin:/[a-z]/},r=has(i,t)?t:"default";return i[r].test(String(e))},contains_lowercase_default=contains_lowercase,contains_numeric=function({value:t}){return/[0-9]/.test(String(t))},contains_numeric_default=contains_numeric,contains_symbol=function({value:e}){return/[!-/:-@[-`{-~]/.test(String(e))},contains_symbol_default=contains_symbol,contains_uppercase=function({value:e},t="default"){const i={default:new RegExp("\\p{Lu}","u"),latin:/[A-Z]/},r=has(i,t)?t:"default";return i[r].test(String(e))},contains_uppercase_default=contains_uppercase,date_between=function({value:t},i,r){i=i instanceof Date?i.getTime():Date.parse(i),r=r instanceof Date?r.getTime():Date.parse(r);const o=t instanceof Date?t.getTime():Date.parse(String(t));if(i&&!r)r=i,i=Date.now();else if(!i||!o)return!1;return o>=i&&o<=r},date_between_default=date_between,date_format=function({value:t},i){return i&&typeof i=="string"?regexForFormat(i).test(String(t)):!isNaN(Date.parse(String(t)))},date_format_default=date_format,email=function({value:t}){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(String(t))},email_default=email,ends_with=function({value:t},...i){return typeof t=="string"&&i.length?i.some(r=>t.endsWith(r)):typeof t=="string"&&i.length===0},ends_with_default=ends_with,is=function({value:t},...i){return i.some(r=>typeof r=="object"?eq(r,t):r==t)},is_default=is,length=function({value:t},i=0,r=1/0){i=parseInt(i),r=isNaN(parseInt(r))?1/0:parseInt(r);const o=i<=r?i:r,l=r>=i?r:i;if(typeof t=="string"||Array.isArray(t))return t.length>=o&&t.length<=l;if(t&&typeof t=="object"){const d=Object.keys(t).length;return d>=o&&d<=l}return!1},length_default=length,lowercase=function({value:e},t="default"){const i={default:new RegExp("^\\p{Ll}+$","u"),allow_non_alpha:/^[0-9\p{Ll}!-/:-@[-`{-~]+$/u,allow_numeric:/^[0-9\p{Ll}]+$/u,allow_numeric_dashes:/^[0-9\p{Ll}-]+$/u,latin:/^[a-z]+$/},r=has(i,t)?t:"default";return i[r].test(String(e))},lowercase_default=lowercase,matches=function({value:t},...i){return i.some(r=>(typeof r=="string"&&r.substr(0,1)==="/"&&r.substr(-1)==="/"&&(r=new RegExp(r.substr(1,r.length-2))),r instanceof RegExp?r.test(String(t)):r===t))},matches_default=matches,max=function({value:t},i=10){return Array.isArray(t)?t.length<=i:Number(t)<=Number(i)},max_default=max,min=function({value:t},i=1){return Array.isArray(t)?t.length>=i:Number(t)>=Number(i)},min_default=min,not=function({value:t},...i){return!i.some(r=>typeof r=="object"?eq(r,t):r===t)},not_default=not,number2=function({value:t}){return!isNaN(t)},number_default=number2,require_one=function(e,...t){return empty(e.value)?t.map(r=>{var o;return(o=e.at(r))==null?void 0:o.value}).some(r=>!empty(r)):!0};require_one.skipEmpty=!1;var require_one_default=require_one,required=function({value:t},i="default"){return i==="trim"&&typeof t=="string"?!empty(t.trim()):!empty(t)};required.skipEmpty=!1;var required_default=required,starts_with=function({value:t},...i){return typeof t=="string"&&i.length?i.some(r=>t.startsWith(r)):typeof t=="string"&&i.length===0},starts_with_default=starts_with,symbol=function({value:e}){return/^[!-/:-@[-`{-~]+$/.test(String(e))},symbol_default=symbol,uppercase=function({value:e},t="default"){const i={default:new RegExp("^\\p{Lu}+$","u"),latin:/^[A-Z]+$/},r=has(i,t)?t:"default";return i[r].test(String(e))},uppercase_default=uppercase,url=function({value:t},...i){try{const r=i.length?i:["http:","https:"],o=new URL(String(t));return r.includes(o.protocol)}catch{return!1}},url_default=url;const defaultRules=Object.freeze(Object.defineProperty({__proto__:null,accepted:accepted_default,alpha:alpha_default,alpha_spaces:alpha_spaces_default,alphanumeric:alphanumeric_default,between:between_default,confirm:confirm_default,contains_alpha:contains_alpha_default,contains_alpha_spaces:contains_alpha_spaces_default,contains_alphanumeric:contains_alphanumeric_default,contains_lowercase:contains_lowercase_default,contains_numeric:contains_numeric_default,contains_symbol:contains_symbol_default,contains_uppercase:contains_uppercase_default,date_after:date_after_default,date_after_node:date_after_node_default,date_after_or_equal:date_after_or_equal_default,date_before:date_before_default,date_before_node:date_before_node_default,date_before_or_equal:date_before_or_equal_default,date_between:date_between_default,date_format:date_format_default,email:email_default,ends_with:ends_with_default,is:is_default,length:length_default,lowercase:lowercase_default,matches:matches_default,max:max_default,min:min_default,not:not_default,number:number_default,require_one:require_one_default,required:required_default,starts_with:starts_with_default,symbol:symbol_default,uppercase:uppercase_default,url:url_default},Symbol.toStringTag,{value:"Module"}));var validatingMessage=createMessage({type:"state",blocking:!0,visible:!1,value:!0,key:"validating"});function createValidationPlugin(e={}){return function(i){let r=cloneAny(i.props.validationRules||{}),o={...e,...r};const l={input:token(),rerun:null,isPassing:!0};let d=cloneAny(i.props.validation);i.on("prop:validation",({payload:S})=>n(S,r)),i.on("prop:validationRules",({payload:S})=>n(d,S));function n(S,C){var I;eq(Object.keys(r||{}),Object.keys(C||{}))&&eq(d,S)||(r=cloneAny(C),d=cloneAny(S),o={...e,...r},(I=i.props.parsedRules)==null||I.forEach(z=>{removeMessage(z),removeListeners(z.observer.receipts),z.observer.kill()}),i.store.filter(()=>!1,"validation"),i.props.parsedRules=parseRules(S,o,i),l.isPassing=!0,validate(i,i.props.parsedRules,l))}i.props.parsedRules=parseRules(d,o,i),validate(i,i.props.parsedRules,l)}}function validate(e,t,i){isKilled(e)||(i.input=token(),e.store.set(createMessage({key:"failing",value:!i.isPassing,visible:!1})),i.isPassing=!0,e.store.filter(r=>!r.meta.removeImmediately,"validation"),t.forEach(r=>r.debounce&&clearTimeout(r.timer)),t.length&&(e.store.set(validatingMessage),run(0,t,i,!1,()=>{e.store.remove(validatingMessage.key),e.store.set(createMessage({key:"failing",value:!i.isPassing,visible:!1}))})))}function run(e,t,i,r,o){const l=t[e];if(!l)return o();const d=l.observer;if(isKilled(d))return;const n=i.input;l.state=null;function S(C,I){if(i.input!==n)return;i.isPassing=i.isPassing&&!!I,l.queued=!1;const z=d.stopObserve(),$=diffDeps(l.deps,z);if(applyListeners(d,$,function(){try{d.store.set(validatingMessage)}catch{}l.queued=!0,i.rerun&&clearTimeout(i.rerun),i.rerun=setTimeout(validate,0,d,t,i)},"unshift"),l.deps=z,l.state=I,I===!1?createFailedMessage(l,r||C):removeMessage(l),t.length>e+1){const k=t[e+1];(I||k.force||!k.skipEmpty)&&k.state===null&&(k.queued=!0),run(e+1,t,i,r||C,o)}else o()}(!empty(d.value)||!l.skipEmpty)&&(i.isPassing||l.force)?l.queued?runRule(l,d,C=>{C instanceof Promise?C.then(I=>S(!0,I)):S(!1,C)}):run(e+1,t,i,r,o):empty(d.value)&&l.skipEmpty&&i.isPassing?(d.observe(),d.value,S(!1,i.isPassing)):S(!1,null)}function runRule(e,t,i){e.debounce?e.timer=setTimeout(()=>{t.observe(),i(e.rule(t,...e.args))},e.debounce):(t.observe(),i(e.rule(t,...e.args)))}function removeMessage(e){const t=`rule_${e.name}`;e.messageObserver&&(e.messageObserver=e.messageObserver.kill()),has(e.observer.store,t)&&e.observer.store.remove(t)}function createFailedMessage(e,t){const i=e.observer;isKilled(i)||(e.messageObserver||(e.messageObserver=createObserver(i._node)),e.messageObserver.watch(r=>createI18nArgs(r,e),r=>{const o=createCustomMessage(i,e,r),l=createMessage({blocking:e.blocking,key:`rule_${e.name}`,meta:{messageKey:e.name,removeImmediately:t,localize:!o,i18nArgs:r},type:"validation",value:o||"This field is not valid."});i.store.set(l)}))}function createCustomMessage(e,t,i){const r=e.props.validationMessages&&has(e.props.validationMessages,t.name)?e.props.validationMessages[t.name]:void 0;return typeof r=="function"?r(...i):r}function createI18nArgs(e,t){return[{node:e,name:createMessageName(e),args:t.args}]}function createMessageName(e){return typeof e.props.validationLabel=="function"?e.props.validationLabel(e):e.props.validationLabel||e.props.label||e.props.name||String(e.name)}var hintPattern="(?:[\\*+?()0-9]+)",rulePattern="[a-zA-Z][a-zA-Z0-9_]+",ruleExtractor=new RegExp(`^(${hintPattern}?${rulePattern})(?:\\:(.*)+)?$`,"i"),hintExtractor=new RegExp(`^(${hintPattern})(${rulePattern})$`,"i"),debounceExtractor=/([\*+?]+)?(\(\d+\))([\*+?]+)?/,hasDebounce=/\(\d+\)/,defaultHints={blocking:!0,debounce:0,force:!1,skipEmpty:!0,name:""};function parseRules(e,t,i){return e?(typeof e=="string"?extractRules(e):clone(e)).reduce((o,l)=>{let d=l.shift();const n={};if(typeof d=="string"){const[S,C]=parseHints(d);has(t,S)&&(d=t[S],Object.assign(n,C))}return typeof d=="function"&&o.push({observer:createObserver(i),rule:d,args:l,timer:0,state:null,queued:!0,deps:new Map,...defaultHints,...fnHints(n,d)}),o},[]):[]}function extractRules(e){return e.split("|").reduce((t,i)=>{const r=parseRule(i);return r&&t.push(r),t},[])}function parseRule(e){const t=e.trim();if(t){const i=t.match(ruleExtractor);if(i&&typeof i[1]=="string"){const r=i[1].trim(),o=i[2]&&typeof i[2]=="string"?i[2].split(",").map(l=>l.trim()):[];return[r,...o]}}return!1}function parseHints(e){const t=e.match(hintExtractor);if(!t)return[e,{name:e}];const i={"*":{force:!0},"+":{skipEmpty:!1},"?":{blocking:!1}},[,r,o]=t,l=hasDebounce.test(r)?r.match(debounceExtractor)||[]:[,r];return[o,[l[1],l[2],l[3]].reduce((d,n)=>(n&&(hasDebounce.test(n)?d.debounce=parseInt(n.substr(1,n.length-1)):n.split("").forEach(S=>has(i,S)&&Object.assign(d,i[S]))),d),{name:o})]}function fnHints(e,t){return e.name||(e.name=t.ruleName||t.name),["skipEmpty","force","debounce","blocking"].reduce((i,r)=>(has(t,r)&&!has(i,r)&&Object.assign(i,{[r]:t[r]}),i),e)}function sentence(e){return e[0].toUpperCase()+e.substr(1)}function list$1(e,t="or"){return e.reduce((i,r,o)=>(i+=r,o<=e.length-2&&e.length>2&&(i+=", "),o===e.length-2&&(i+=`${e.length===2?" ":""}${t} `),i),"")}function date(e){const t=typeof e=="string"?new Date(Date.parse(e)):e;return t instanceof Date?new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeZone:"UTC"}).format(t):"(unknown)"}function order(e,t){return Number(e)>=Number(t)?[t,e]:[e,t]}var ui10={add:"Add",remove:"Remove",removeAll:"Remove all",incomplete:"Sorry, not all fields are filled out correctly.",submit:"Submit",noFiles:"No file chosen",moveUp:"Move up",moveDown:"Move down",isLoading:"Loading...",loadMore:"Load more",next:"Next",prev:"Previous",addAllValues:"Add all values",addSelectedValues:"Add selected values",removeAllValues:"Remove all values",removeSelectedValues:"Remove selected values",chooseDate:"Choose date",changeDate:"Change date",summaryHeader:"There were errors in your form.",close:"Close",open:"Open"},validation10={accepted({name:e}){return`Please accept the ${e}.`},date_after({name:e,args:t}){return Array.isArray(t)&&t.length?`${sentence(e)} must be after ${date(t[0])}.`:`${sentence(e)} must be in the future.`},alpha({name:e}){return`${sentence(e)} can only contain alphabetical characters.`},alphanumeric({name:e}){return`${sentence(e)} can only contain letters and numbers.`},alpha_spaces({name:e}){return`${sentence(e)} can only contain letters and spaces.`},contains_alpha({name:e}){return`${sentence(e)} must contain alphabetical characters.`},contains_alphanumeric({name:e}){return`${sentence(e)} must contain letters or numbers.`},contains_alpha_spaces({name:e}){return`${sentence(e)} must contain letters or spaces.`},contains_symbol({name:e}){return`${sentence(e)} must contain a symbol.`},contains_uppercase({name:e}){return`${sentence(e)} must contain an uppercase letter.`},contains_lowercase({name:e}){return`${sentence(e)} must contain a lowercase letter.`},contains_numeric({name:e}){return`${sentence(e)} must contain numbers.`},symbol({name:e}){return`${sentence(e)} must be a symbol.`},uppercase({name:e}){return`${sentence(e)} can only contain uppercase letters.`},lowercase({name:e,args:t}){let i="";return Array.isArray(t)&&t.length&&(t[0]==="allow_non_alpha"&&(i=", numbers and symbols"),t[0]==="allow_numeric"&&(i=" and numbers"),t[0]==="allow_numeric_dashes"&&(i=", numbers and dashes")),`${sentence(e)} can only contain lowercase letters${i}.`},date_before({name:e,args:t}){return Array.isArray(t)&&t.length?`${sentence(e)} must be before ${date(t[0])}.`:`${sentence(e)} must be in the past.`},between({name:e,args:t}){if(isNaN(t[0])||isNaN(t[1]))return"This field was configured incorrectly and cant be submitted.";const[i,r]=order(t[0],t[1]);return`${sentence(e)} must be between ${i} and ${r}.`},confirm({name:e}){return`${sentence(e)} does not match.`},date_format({name:e,args:t}){return Array.isArray(t)&&t.length?`${sentence(e)} is not a valid date, please use the format ${t[0]}`:"This field was configured incorrectly and cant be submitted"},date_between({name:e,args:t}){return`${sentence(e)} must be between ${date(t[0])} and ${date(t[1])}`},email:"Please enter a valid email address.",ends_with({name:e,args:t}){return`${sentence(e)} doesnt end with ${list$1(t)}.`},is({name:e}){return`${sentence(e)} is not an allowed value.`},length({name:e,args:[t=0,i=1/0]}){const r=Number(t)<=Number(i)?t:i,o=Number(i)>=Number(t)?i:t;return r==1&&o===1/0?`${sentence(e)} must be at least one character.`:r==0&&o?`${sentence(e)} must be less than or equal to ${o} characters.`:r===o?`${sentence(e)} should be ${o} characters long.`:r&&o===1/0?`${sentence(e)} must be greater than or equal to ${r} characters.`:`${sentence(e)} must be between ${r} and ${o} characters.`},matches({name:e}){return`${sentence(e)} is not an allowed value.`},max({name:e,node:{value:t},args:i}){return Array.isArray(t)?`Cannot have more than ${i[0]} ${e}.`:`${sentence(e)} must be no more than ${i[0]}.`},mime({name:e,args:t}){return t[0]?`${sentence(e)} must be of the type: ${t[0]}`:"No file formats allowed."},min({name:e,node:{value:t},args:i}){return Array.isArray(t)?`Cannot have fewer than ${i[0]} ${e}.`:`${sentence(e)} must be at least ${i[0]}.`},not({name:e,node:{value:t}}){return`${t} is not an allowed ${e}.`},number({name:e}){return`${sentence(e)} must be a number.`},require_one:({name:e,node:t,args:i})=>{const r=i.map(o=>{const l=t.at(o);return l?createMessageName(l):!1}).filter(o=>!!o);return r.unshift(e),`${r.join(" or ")} is required.`},required({name:e}){return`${sentence(e)} is required.`},starts_with({name:e,args:t}){return`${sentence(e)} doesnt start with ${list$1(t)}.`},url(){return"Please enter a valid URL."},invalidDate:"The selected date is invalid."},en={ui:ui10,validation:validation10},i18nNodes=new Set;function createI18nPlugin(e){return function(i){i18nNodes.add(i),i.on("destroying",()=>i18nNodes.delete(i));let r=parseLocale(i.config.locale,e),o=r?e[r]:{};i.on("prop:locale",({payload:l})=>{r=parseLocale(l,e),o=r?e[r]:{},i.store.touch()}),i.on("prop:label",()=>i.store.touch()),i.on("prop:validationLabel",()=>i.store.touch()),i.hook.text((l,d)=>{var S,C;const n=((S=l.meta)==null?void 0:S.messageKey)||l.key;if(has(o,l.type)&&has(o[l.type],n)){const I=o[l.type][n];typeof I=="function"?l.value=Array.isArray((C=l.meta)==null?void 0:C.i18nArgs)?I(...l.meta.i18nArgs):I(l):l.value=I}return d(l)})}}function parseLocale(e,t){if(has(t,e))return e;const[i]=e.split("-");if(has(t,i))return i;for(const r in t)return r;return!1}function createLibraryPlugin(...e){const t=e.reduce((r,o)=>extend$1(r,o),{}),i=()=>{};return i.library=function(r){const o=camel(r.props.type);has(t,o)&&r.define(t[o])},i}var runtimeProps=["classes","config","delay","errors","id","index","inputErrors","library","modelValue","onUpdate:modelValue","name","number","parent","plugins","sectionsSchema","type","validation","validationLabel","validationMessages","validationRules","onInput","onInputRaw","onUpdate:modelValue","onNode","onSubmit","onSubmitInvalid","onSubmitRaw"];function isGroupOption(e){return e&&typeof e=="object"&&"group"in e&&Array.isArray(e.options)}function normalizeOptions(e,t={count:1}){return Array.isArray(e)?e.map(i=>{if(typeof i=="string"||typeof i=="number")return{label:String(i),value:String(i)};if(typeof i=="object"){if("group"in i)return i.options=normalizeOptions(i.options||[],t),i;"value"in i&&typeof i.value!="string"&&Object.assign(i,{value:`__mask_${t.count++}`,__original:i.value})}return i}):Object.keys(e).map(i=>({label:e[i],value:i}))}function optionValue(e,t,i=!1){if(Array.isArray(e)){for(const r of e)if(!(typeof r!="object"&&r)){if(isGroupOption(r)){const o=optionValue(r.options,t,!0);if(o!==void 0)return o}else if(t==r.value)return"__original"in r?r.__original:r.value}}return i?void 0:t}function shouldSelect(e,t){return e===null&&t===void 0||e===void 0&&t===null?!1:e==t?!0:isPojo(e)&&isPojo(t)?eq(e,t):!1}function options(e){e.hook.prop((t,i)=>{var r;return t.prop==="options"&&(typeof t.value=="function"?(e.props.optionsLoader=t.value,t.value=[]):((r=e.props)._normalizeCounter??(r._normalizeCounter={count:1}),t.value=normalizeOptions(t.value,e.props._normalizeCounter))),i(t)})}function createSection(e,t,i=!1){return(...r)=>{const o=l=>{const d=!t||typeof t=="string"?{$el:t}:t();return(isDOM(d)||isComponent(d))&&(d.meta?d.meta.section=e:d.meta={section:e},r.length&&!d.children&&(d.children=[...r.map(n=>typeof n=="function"?n(l):n)]),isDOM(d)&&(d.attrs={class:`$classes.${e}`,...d.attrs||{}})),{if:`$slots.${e}`,then:`$slots.${e}`,else:e in l?extendSchema(d,l[e]):d}};return o._s=e,i?createRoot(o):o}}function createRoot(e){return t=>[e(t)]}function isSchemaObject(e){return!!(e&&typeof e=="object"&&("$el"in e||"$cmp"in e||"$formkit"in e))}function extendSchema(e,t={}){return typeof e=="string"?isSchemaObject(t)||typeof t=="string"?t:e:Array.isArray(e)?isSchemaObject(t)?t:e:extend$1(e,t)}var actions=createSection("actions",()=>({$el:"div",if:"$actions"})),box=createSection("input",()=>({$el:"input",bind:"$attrs",attrs:{type:"$type",name:"$node.props.altName || $node.name",disabled:"$option.attrs.disabled || $disabled",onInput:"$handlers.toggleChecked",checked:"$fns.eq($_value, $onValue)",onBlur:"$handlers.blur",value:"$: true",id:"$id","aria-describedby":{if:"$options.length",then:{if:"$option.help",then:'$: "help-" + $option.attrs.id',else:void 0},else:{if:"$help",then:'$: "help-" + $id',else:void 0}}}})),boxHelp=createSection("optionHelp",()=>({$el:"div",if:"$option.help",attrs:{id:'$: "help-" + $option.attrs.id'}})),boxInner=createSection("inner","span"),boxLabel=createSection("label","span"),boxOption=createSection("option",()=>({$el:"li",for:["option","$options"],attrs:{"data-disabled":"$option.attrs.disabled || $disabled || undefined"}})),boxOptions=createSection("options","ul"),boxWrapper=createSection("wrapper",()=>({$el:"label",attrs:{"data-disabled":{if:"$options.length",then:void 0,else:"$disabled || undefined"},"data-checked":{if:"$options == undefined",then:"$fns.eq($_value, $onValue) || undefined",else:"$fns.isChecked($option.value) || undefined"}}})),buttonInput=createSection("input",()=>({$el:"button",bind:"$attrs",attrs:{type:"$type",disabled:"$disabled",name:"$node.name",id:"$id"}})),buttonLabel=createSection("default",null),decorator=createSection("decorator",()=>({$el:"span",attrs:{"aria-hidden":"true"}})),fieldset=createSection("fieldset",()=>({$el:"fieldset",attrs:{id:"$id","aria-describedby":{if:"$help",then:'$: "help-" + $id',else:void 0}}})),fileInput=createSection("input",()=>({$el:"input",bind:"$attrs",attrs:{type:"file",disabled:"$disabled",name:"$node.name",onChange:"$handlers.files",onBlur:"$handlers.blur",id:"$id","aria-describedby":"$describedBy","aria-required":"$state.required || undefined"}})),fileItem=createSection("fileItem",()=>({$el:"li",for:["file","$value"]})),fileList=createSection("fileList",()=>({$el:"ul",if:"$value.length",attrs:{"data-has-multiple":"$_hasMultipleFiles"}})),fileName=createSection("fileName",()=>({$el:"span",attrs:{class:"$classes.fileName"}})),fileRemove=createSection("fileRemove",()=>({$el:"button",attrs:{type:"button",onClick:"$handlers.resetFiles"}})),formInput=createSection("form",()=>({$el:"form",bind:"$attrs",meta:{autoAnimate:!0},attrs:{id:"$id",name:"$node.name",onSubmit:"$handlers.submit","data-loading":"$state.loading || undefined"}})),fragment=createSection("wrapper",null,!0),help=createSection("help",()=>({$el:"div",if:"$help",attrs:{id:'$: "help-" + $id'}})),icon=(e,t)=>createSection(`${e}Icon`,()=>{const i=`_raw${e.charAt(0).toUpperCase()}${e.slice(1)}Icon`;return{if:`$${e}Icon && $${i}`,$el:`${t||"span"}`,attrs:{class:`$classes.${e}Icon + " " + $classes.icon`,innerHTML:`$${i}`,onClick:`$handlers.iconClick(${e})`,role:`$fns.iconRole(${e})`,tabindex:`$fns.iconRole(${e}) === "button" && "0" || undefined`,for:{if:`${t==="label"}`,then:"$id"}}}})(),inner=createSection("inner","div"),label=createSection("label",()=>({$el:"label",if:"$label",attrs:{for:"$id"}})),legend=createSection("legend",()=>({$el:"legend",if:"$label"})),message$1=createSection("message",()=>({$el:"li",for:["message","$messages"],attrs:{key:"$message.key",id:"$id + '-' + $message.key","data-message-type":"$message.type"}})),messages$1=createSection("messages",()=>({$el:"ul",if:"$defaultMessagePlacement && $fns.length($messages)"})),noFiles=createSection("noFiles",()=>({$el:"span",if:"$value == null || $value.length == 0"})),optGroup=createSection("optGroup",()=>({$el:"optgroup",bind:"$option.attrs",attrs:{label:"$option.group"}})),option=createSection("option",()=>({$el:"option",bind:"$option.attrs",attrs:{class:"$classes.option",value:"$option.value",selected:"$fns.isSelected($option)"}})),optionSlot=createSection("options",()=>({$el:null,if:"$options.length",for:["option","$option.options || $options"]})),outer=createSection("outer",()=>({$el:"div",meta:{autoAnimate:!0},attrs:{key:"$id","data-family":"$family || undefined","data-type":"$type","data-multiple":'$attrs.multiple || ($type != "select" && $options != undefined) || undefined',"data-has-multiple":"$_hasMultipleFiles","data-disabled":'$: ($disabled !== "false" && $disabled) || undefined',"data-empty":"$state.empty || undefined","data-complete":"$state.complete || undefined","data-invalid":"$state.invalid || undefined","data-errors":"$state.errors || undefined","data-submitted":"$state.submitted || undefined","data-prefix-icon":"$_rawPrefixIcon !== undefined || undefined","data-suffix-icon":"$_rawSuffixIcon !== undefined || undefined","data-prefix-icon-click":"$onPrefixIconClick !== undefined || undefined","data-suffix-icon-click":"$onSuffixIconClick !== undefined || undefined"}})),prefix=createSection("prefix",null),selectInput=createSection("input",()=>({$el:"select",bind:"$attrs",attrs:{id:"$id","data-placeholder":"$fns.showPlaceholder($_value, $placeholder)",disabled:"$disabled",class:"$classes.input",name:"$node.name",onChange:"$handlers.onChange",onInput:"$handlers.selectInput",onBlur:"$handlers.blur","aria-describedby":"$describedBy","aria-required":"$state.required || undefined"}})),submitInput=createSection("submit",()=>({$cmp:"FormKit",bind:"$submitAttrs",props:{type:"submit",label:"$submitLabel"}})),suffix=createSection("suffix",null),textInput=createSection("input",()=>({$el:"input",bind:"$attrs",attrs:{type:"$type",disabled:"$disabled",name:"$node.name",onInput:"$handlers.DOMInput",onBlur:"$handlers.blur",value:"$_value",id:"$id","aria-describedby":"$describedBy","aria-required":"$state.required || undefined"}})),textareaInput=createSection("input",()=>({$el:"textarea",bind:"$attrs",attrs:{disabled:"$disabled",name:"$node.name",onInput:"$handlers.DOMInput",onBlur:"$handlers.blur",value:"$_value",id:"$id","aria-describedby":"$describedBy","aria-required":"$state.required || undefined"},children:"$initialValue"})),wrapper=createSection("wrapper","div"),radioInstance=0;function renamesRadios(e){(e.type==="group"||e.type==="list")&&e.plugins.add(renamesRadiosPlugin)}function renamesRadiosPlugin(e){e.props.type==="radio"&&(e.addProps(["altName"]),e.props.altName=`${e.name}_${radioInstance++}`)}function normalizeBoxes(e){return function(t,i){return t.prop==="options"&&Array.isArray(t.value)&&(t.value=t.value.map(r=>{var o;return(o=r.attrs)!=null&&o.id?r:extend$1(r,{attrs:{id:`${e.props.id}-option-${slugify(String(r.value))}`}})}),e.props.type==="checkbox"&&!Array.isArray(e.value)&&(e.isCreated?e.input([],!1):e.on("created",()=>{Array.isArray(e.value)||e.input([],!1)}))),i(t)}}function toggleChecked(e,t){const i=t.target;if(i instanceof HTMLInputElement){const r=Array.isArray(e.props.options)?optionValue(e.props.options,i.value):i.value;Array.isArray(e.props.options)&&e.props.options.length?Array.isArray(e._value)?e._value.some(o=>shouldSelect(r,o))?e.input(e._value.filter(o=>!shouldSelect(r,o))):e.input([...e._value,r]):e.input([r]):i.checked?e.input(e.props.onValue):e.input(e.props.offValue)}}function isChecked(e,t){var i,r;return(i=e.context)==null||i.value,(r=e.context)==null||r._value,Array.isArray(e._value)?e._value.some(o=>shouldSelect(optionValue(e.props.options,t),o)):!1}function checkboxes(e){e.on("created",()=>{var t,i;(t=e.context)!=null&&t.handlers&&(e.context.handlers.toggleChecked=toggleChecked.bind(null,e)),(i=e.context)!=null&&i.fns&&(e.context.fns.isChecked=isChecked.bind(null,e)),has(e.props,"onValue")||(e.props.onValue=!0),has(e.props,"offValue")||(e.props.offValue=!1)}),e.hook.prop(normalizeBoxes(e))}function defaultIcon(e,t){return i=>{i.props[`${e}Icon`]===void 0&&(i.props[`${e}Icon`]=t.startsWith("<svg")?t:`default:${t}`)}}function disables(e){e.on("created",()=>{"disabled"in e.props&&(e.props.disabled=undefine(e.props.disabled),e.config.disabled=undefine(e.props.disabled))}),e.hook.prop(({prop:t,value:i},r)=>(i=t==="disabled"?undefine(i):i,r({prop:t,value:i}))),e.on("prop:disabled",({payload:t})=>{e.config.disabled=undefine(t)})}function localize(e,t){return i=>{i.store.set(createMessage({key:e,type:"ui",value:t||e,meta:{localize:!0,i18nArgs:[i]}}))}}var isBrowser$1=typeof window<"u";function removeHover(e){e.target instanceof HTMLElement&&e.target.hasAttribute("data-file-hover")&&e.target.removeAttribute("data-file-hover")}function preventStrayDrop(e,t){t.target instanceof HTMLInputElement?e==="dragover"&&t.target.setAttribute("data-file-hover","true"):t.preventDefault(),e==="drop"&&removeHover(t)}function files(e){localize("noFiles","Select file")(e),localize("removeAll","Remove all")(e),localize("remove")(e),e.addProps(["_hasMultipleFiles"]),isBrowser$1&&(window._FormKit_File_Drop||(window.addEventListener("dragover",preventStrayDrop.bind(null,"dragover")),window.addEventListener("drop",preventStrayDrop.bind(null,"drop")),window.addEventListener("dragleave",removeHover),window._FormKit_File_Drop=!0)),e.hook.input((t,i)=>i(Array.isArray(t)?t:[])),e.on("input",({payload:t})=>{e.props._hasMultipleFiles=Array.isArray(t)&&t.length>1?!0:void 0}),e.on("reset",()=>{if(e.props.id&&isBrowser$1){const t=document.getElementById(e.props.id);t&&(t.value="")}}),e.on("created",()=>{Array.isArray(e.value)||e.input([],!1),e.context&&(e.context.handlers.resetFiles=t=>{if(t.preventDefault(),e.input([]),e.props.id&&isBrowser$1){const i=document.getElementById(e.props.id);i&&(i.value=""),i==null||i.focus()}},e.context.handlers.files=t=>{var r,o;const i=[];if(t.target instanceof HTMLInputElement&&t.target.files){for(let l=0;l<t.target.files.length;l++){let d;(d=t.target.files.item(l))&&i.push({name:d.name,file:d})}e.input(i)}e.context&&(e.context.files=i),typeof((r=e.props.attrs)==null?void 0:r.onChange)=="function"&&((o=e.props.attrs)==null||o.onChange(t))})})}var loading$1=createMessage({key:"loading",value:!0,visible:!1});async function handleSubmit(e,t){const i=Math.random();if(e.props._submitNonce=i,t.preventDefault(),await e.settled,e.ledger.value("validating")&&(e.store.set(loading$1),await e.ledger.settled("validating"),e.store.remove("loading"),e.props._submitNonce!==i))return;const r=o=>o.store.set(createMessage({key:"submitted",value:!0,visible:!1}));if(e.walk(r),r(e),e.emit("submit-raw"),typeof e.props.onSubmitRaw=="function"&&e.props.onSubmitRaw(t,e),e.ledger.value("blocking"))typeof e.props.onSubmitInvalid=="function"&&e.props.onSubmitInvalid(e),e.props.incompleteMessage!==!1&&setIncompleteMessage(e);else if(typeof e.props.onSubmit=="function"){const o=e.props.onSubmit(e.hook.submit.dispatch(clone(e.value)),e);if(o instanceof Promise){const l=e.props.disabled===void 0&&e.props.submitBehavior!=="live";l&&(e.props.disabled=!0),e.store.set(loading$1),await o,l&&(e.props.disabled=!1),e.store.remove("loading")}}else t.target instanceof HTMLFormElement&&t.target.submit()}function setIncompleteMessage(e){e.store.set(createMessage({blocking:!1,key:"incomplete",meta:{localize:e.props.incompleteMessage===void 0,i18nArgs:[{node:e}],showAsMessage:!0},type:"ui",value:e.props.incompleteMessage||"Form incomplete."}))}function form(e){var t;e.props.isForm=!0,e.ledger.count("validating",i=>i.key==="validating"),(t=e.props).submitAttrs??(t.submitAttrs={disabled:e.props.disabled}),e.on("prop:disabled",({payload:i})=>{e.props.submitAttrs={...e.props.submitAttrs,disabled:i}}),e.on("created",()=>{var i;(i=e.context)!=null&&i.handlers&&(e.context.handlers.submit=handleSubmit.bind(null,e)),has(e.props,"actions")||(e.props.actions=!0)}),e.on("prop:incompleteMessage",()=>{e.store.incomplete&&setIncompleteMessage(e)}),e.on("settled:blocking",()=>e.store.remove("incomplete"))}function ignore(e){e.props.ignore===void 0&&(e.props.ignore=!0,e.parent=null)}function initialValue(e){e.on("created",()=>{e.context&&(e.context.initialValue=e.value||"")})}function casts(e){if(typeof e.props.number>"u")return;const t=["number","range","hidden"].includes(e.props.type);e.hook.input((i,r)=>{if(i==="")return r(void 0);const o=e.props.number==="integer"?parseInt(i):parseFloat(i);return Number.isFinite(o)?r(o):r(t?void 0:i)})}function toggleChecked2(e,t){t.target instanceof HTMLInputElement&&e.input(optionValue(e.props.options,t.target.value))}function isChecked2(e,t){var i,r;return(i=e.context)==null||i.value,(r=e.context)==null||r._value,shouldSelect(optionValue(e.props.options,t),e._value)}function radios(e){e.on("created",()=>{var t,i;Array.isArray(e.props.options)||warn(350,{node:e,inputType:"radio"}),(t=e.context)!=null&&t.handlers&&(e.context.handlers.toggleChecked=toggleChecked2.bind(null,e)),(i=e.context)!=null&&i.fns&&(e.context.fns.isChecked=isChecked2.bind(null,e))}),e.hook.prop(normalizeBoxes(e))}function isSelected(e,t){if(isGroupOption(t))return!1;e.context&&e.context.value;const i="__original"in t?t.__original:t.value;return Array.isArray(e._value)?e._value.some(r=>shouldSelect(r,i)):(e._value===void 0||e._value===null&&!containsValue(e.props.options,null))&&t.attrs&&t.attrs["data-is-placeholder"]?!0:shouldSelect(i,e._value)}function containsValue(e,t){return e.some(i=>isGroupOption(i)?containsValue(i.options,t):("__original"in i?i.__original:i.value)===t)}async function deferChange(e,t){var i;typeof((i=e.props.attrs)==null?void 0:i.onChange)=="function"&&(await new Promise(r=>setTimeout(r,0)),await e.settled,e.props.attrs.onChange(t))}function selectInput2(e,t){const i=t.target,r=i.hasAttribute("multiple")?Array.from(i.selectedOptions).map(o=>optionValue(e.props.options,o.value)):optionValue(e.props.options,i.value);e.input(r)}function applyPlaceholder(e,t){return e.some(i=>i.attrs&&i.attrs["data-is-placeholder"])?e:[{label:t,value:"",attrs:{hidden:!0,disabled:!0,"data-is-placeholder":"true"}},...e]}function firstValue(e){const t=e.length>0?e[0]:void 0;if(t)return isGroupOption(t)?firstValue(t.options):"__original"in t?t.__original:t.value}function select(e){e.on("created",()=>{var i,r,o;const t=undefine((i=e.props.attrs)==null?void 0:i.multiple);!t&&e.props.placeholder&&Array.isArray(e.props.options)&&(e.hook.prop(({prop:l,value:d},n)=>(l==="options"&&(d=applyPlaceholder(d,e.props.placeholder)),n({prop:l,value:d}))),e.props.options=applyPlaceholder(e.props.options,e.props.placeholder)),t?e.value===void 0&&e.input([],!1):e.context&&!e.context.options&&(e.props.attrs=Object.assign({},e.props.attrs,{value:e._value}),e.on("input",({payload:l})=>{e.props.attrs=Object.assign({},e.props.attrs,{value:l})})),(r=e.context)!=null&&r.handlers&&(e.context.handlers.selectInput=selectInput2.bind(null,e),e.context.handlers.onChange=deferChange.bind(null,e)),(o=e.context)!=null&&o.fns&&(e.context.fns.isSelected=isSelected.bind(null,e),e.context.fns.showPlaceholder=(l,d)=>{if(!Array.isArray(e.props.options))return!1;const n=e.props.options.some(S=>{if(S.attrs&&"data-is-placeholder"in S.attrs)return!1;const C="__original"in S?S.__original:S.value;return eq(l,C)});return d&&!n?!0:void 0})}),e.hook.input((t,i)=>{var r,o,l;return!e.props.placeholder&&t===void 0&&Array.isArray((r=e.props)==null?void 0:r.options)&&e.props.options.length&&!undefine((l=(o=e.props)==null?void 0:o.attrs)==null?void 0:l.multiple)&&(t=firstValue(e.props.options)),i(t)})}function isSlotCondition(e){return!!(isConditional(e)&&e.if&&e.if.startsWith("$slots.")&&typeof e.then=="string"&&e.then.startsWith("$slots.")&&"else"in e)}function $if(e,t,i){const r=o=>{const l=t(o);if(i||isSchemaObject(l)&&"if"in l||isSlotCondition(l)){const d={if:e,then:l};return i&&(d.else=i(o)),d}else isSlotCondition(l)?Object.assign(l.else,{if:e}):isSchemaObject(l)&&Object.assign(l,{if:e});return l};return r._s=token(),r}function $extend(e,t){const i=r=>{const o=e({});return isSlotCondition(o)?(Array.isArray(o.else)||(o.else=extendSchema(extendSchema(o.else,t),e._s?r[e._s]:{})),o):extendSchema(extendSchema(o,t),e._s?r[e._s]:{})};return i._s=e._s,i}var button={schema:outer(messages$1(message$1("$message.value")),wrapper(buttonInput(icon("prefix"),prefix(),buttonLabel("$label || $ui.submit.value"),suffix(),icon("suffix"))),help("$help")),type:"input",family:"button",props:[],features:[localize("submit"),ignore],schemaMemoKey:"h6st4epl3j8"},checkbox={schema:outer($if("$options == undefined",boxWrapper(boxInner(prefix(),box(),decorator(icon("decorator")),suffix()),$extend(boxLabel("$label"),{if:"$label"})),fieldset(legend("$label"),help("$help"),boxOptions(boxOption(boxWrapper(boxInner(prefix(),$extend(box(),{bind:"$option.attrs",attrs:{id:"$option.attrs.id",value:"$option.value",checked:"$fns.isChecked($option.value)"}}),decorator(icon("decorator")),suffix()),$extend(boxLabel("$option.label"),{if:"$option.label"})),boxHelp("$option.help"))))),$if("$options == undefined && $help",help("$help")),messages$1(message$1("$message.value"))),type:"input",family:"box",props:["options","onValue","offValue","optionsLoader"],features:[options,checkboxes,defaultIcon("decorator","checkboxDecorator")],schemaMemoKey:"qje02tb3gu8"},file={schema:outer(wrapper(label("$label"),inner(icon("prefix","label"),prefix(),fileInput(),fileList(fileItem(icon("fileItem"),fileName("$file.name"),$if("$value.length === 1",fileRemove(icon("fileRemove"),'$ui.remove.value + " " + $file.name')))),$if("$value.length > 1",fileRemove("$ui.removeAll.value")),noFiles(icon("noFiles"),"$ui.noFiles.value"),suffix(),icon("suffix"))),help("$help"),messages$1(message$1("$message.value"))),type:"input",family:"text",props:[],features:[files,defaultIcon("fileItem","fileItem"),defaultIcon("fileRemove","fileRemove"),defaultIcon("noFiles","noFiles")],schemaMemoKey:"9kqc4852fv8"},form2={schema:formInput("$slots.default",messages$1(message$1("$message.value")),actions(submitInput())),type:"group",props:["actions","submit","submitLabel","submitAttrs","submitBehavior","incompleteMessage"],features:[form,disables],schemaMemoKey:"5bg016redjo"},group={schema:fragment("$slots.default"),type:"group",props:[],features:[disables,renamesRadios]},hidden={schema:textInput(),type:"input",props:[],features:[casts]},list={schema:fragment("$slots.default"),type:"list",props:["sync","dynamic"],features:[disables,renamesRadios]},meta={schema:fragment(),type:"input",props:[],features:[]},radio={schema:outer($if("$options == undefined",boxWrapper(boxInner(prefix(),box(),decorator(icon("decorator")),suffix()),$extend(boxLabel("$label"),{if:"$label"})),fieldset(legend("$label"),help("$help"),boxOptions(boxOption(boxWrapper(boxInner(prefix(),$extend(box(),{bind:"$option.attrs",attrs:{id:"$option.attrs.id",value:"$option.value",checked:"$fns.isChecked($option.value)"}}),decorator(icon("decorator")),suffix()),$extend(boxLabel("$option.label"),{if:"$option.label"})),boxHelp("$option.help"))))),$if("$options == undefined && $help",help("$help")),messages$1(message$1("$message.value"))),type:"input",family:"box",props:["options","onValue","offValue","optionsLoader"],features:[options,radios,defaultIcon("decorator","radioDecorator")],schemaMemoKey:"qje02tb3gu8"},select2={schema:outer(wrapper(label("$label"),inner(icon("prefix"),prefix(),selectInput($if("$slots.default",()=>"$slots.default",optionSlot($if("$option.group",optGroup(optionSlot(option("$option.label"))),option("$option.label"))))),$if("$attrs.multiple !== undefined",()=>"",icon("select")),suffix(),icon("suffix"))),help("$help"),messages$1(message$1("$message.value"))),type:"input",props:["options","placeholder","optionsLoader"],features:[options,select,defaultIcon("select","select")],schemaMemoKey:"cb119h43krg"},textarea={schema:outer(wrapper(label("$label"),inner(icon("prefix","label"),prefix(),textareaInput(),suffix(),icon("suffix"))),help("$help"),messages$1(message$1("$message.value"))),type:"input",props:[],features:[initialValue],schemaMemoKey:"b1n0td79m9g"},text={schema:outer(wrapper(label("$label"),inner(icon("prefix","label"),prefix(),textInput(),suffix(),icon("suffix"))),help("$help"),messages$1(message$1("$message.value"))),type:"input",family:"text",props:[],features:[casts],schemaMemoKey:"c3cc4kflsg"},inputs={button,submit:button,checkbox,file,form:form2,group,hidden,list,meta,radio,select:select2,textarea,text,color:text,date:text,datetimeLocal:text,email:text,month:text,number:text,password:text,search:text,tel:text,time:text,url:text,week:text,range:text},documentStyles=void 0,documentThemeLinkTag=null,themeDidLoad,themeHasLoaded=!1,themeWasRequested=!1,themeLoaded=new Promise(e=>{themeDidLoad=()=>{themeHasLoaded=!0,e()}}),isClient=typeof window<"u"&&typeof fetch<"u";documentStyles=isClient?getComputedStyle(document.documentElement):void 0;var iconRegistry={},iconRequests={};function createThemePlugin(e,t,i,r){t&&Object.assign(iconRegistry,t),isClient&&!themeWasRequested&&(documentStyles!=null&&documentStyles.getPropertyValue("--formkit-theme"))?(themeDidLoad(),themeWasRequested=!0):e&&!themeWasRequested&&isClient?loadTheme(e):!themeWasRequested&&isClient&&themeDidLoad();const o=function(d){var n,S;d.addProps(["iconLoader","iconLoaderUrl"]),d.props.iconHandler=createIconHandler((n=d.props)!=null&&n.iconLoader?d.props.iconLoader:r,(S=d.props)!=null&&S.iconLoaderUrl?d.props.iconLoaderUrl:i),loadIconPropIcons(d,d.props.iconHandler),d.on("created",()=>{var C,I;(C=d==null?void 0:d.context)!=null&&C.handlers&&(d.context.handlers.iconClick=z=>{const $=`on${z.charAt(0).toUpperCase()}${z.slice(1)}IconClick`,k=d.props[$];if(k&&typeof k=="function")return Y=>k(d,Y)}),(I=d==null?void 0:d.context)!=null&&I.fns&&(d.context.fns.iconRole=z=>{const $=`on${z.charAt(0).toUpperCase()}${z.slice(1)}IconClick`;return typeof d.props[$]=="function"?"button":null})})};return o.iconHandler=createIconHandler(r,i),o}function loadTheme(e){if(!(!e||!isClient||typeof getComputedStyle!="function")&&(themeWasRequested=!0,documentThemeLinkTag=document.getElementById("formkit-theme"),e&&isClient&&(!(documentStyles!=null&&documentStyles.getPropertyValue("--formkit-theme"))&&!documentThemeLinkTag||documentThemeLinkTag!=null&&documentThemeLinkTag.getAttribute("data-theme")&&(documentThemeLinkTag==null?void 0:documentThemeLinkTag.getAttribute("data-theme"))!==e))){const i=`https://cdn.jsdelivr.net/npm/@formkit/themes@${FORMKIT_VERSION.startsWith("__")?"latest":FORMKIT_VERSION}/dist/${e}/theme.css`,r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.id="formkit-theme",r.setAttribute("data-theme",e),r.onload=()=>{documentStyles=getComputedStyle(document.documentElement),themeDidLoad()},document.head.appendChild(r),r.href=i,documentThemeLinkTag&&documentThemeLinkTag.remove()}}function createIconHandler(e,t){return i=>{if(typeof i!="string")return;if(i.startsWith("<svg"))return i;const r=i.startsWith("default:");i=r?i.split(":")[1]:i;const o=i in iconRegistry;let l;if(o)return iconRegistry[i];if(!iconRequests[i]){if(l=getIconFromStylesheet(i),l=isClient&&typeof l>"u"?Promise.resolve(l):l,l instanceof Promise)iconRequests[i]=l.then(d=>!d&&typeof i=="string"&&!r?l=typeof e=="function"?e(i):getRemoteIcon(i,t):d).then(d=>(typeof i=="string"&&(iconRegistry[r?`default:${i}`:i]=d),d));else if(typeof l=="string")return iconRegistry[r?`default:${i}`:i]=l,l}return iconRequests[i]}}function getIconFromStylesheet(e){if(isClient)return themeHasLoaded?loadStylesheetIcon(e):themeLoaded.then(()=>loadStylesheetIcon(e))}function loadStylesheetIcon(e){const t=documentStyles==null?void 0:documentStyles.getPropertyValue(`--fk-icon-${e}`);if(t){const i=atob(t);if(i.startsWith("<svg"))return iconRegistry[e]=i,i}}function getRemoteIcon(e,t){const i=FORMKIT_VERSION.startsWith("__")?"latest":FORMKIT_VERSION,r=typeof t=="function"?t(e):`https://cdn.jsdelivr.net/npm/@formkit/icons@${i}/dist/icons/${e}.svg`;if(isClient)return fetch(`${r}`).then(async o=>{const l=await o.text();if(l.startsWith("<svg"))return l}).catch(o=>{console.error(o)})}function loadIconPropIcons(e,t){const i=/^[a-zA-Z-]+(?:-icon|Icon)$/;Object.keys(e.props).filter(o=>i.test(o)).forEach(o=>loadPropIcon(e,t,o))}function loadPropIcon(e,t,i){const r=e.props[i],o=t(r),l=`_raw${i.charAt(0).toUpperCase()}${i.slice(1)}`,d=`on${i.charAt(0).toUpperCase()}${i.slice(1)}Click`;if(e.addProps([l,d]),e.on(`prop:${i}`,reloadIcon),o instanceof Promise)return o.then(n=>{e.props[l]=n});e.props[l]=o}function reloadIcon(e){var d;const t=e.origin,i=e.payload,r=(d=t==null?void 0:t.props)==null?void 0:d.iconHandler,o=e.name.split(":")[1],l=`_raw${o.charAt(0).toUpperCase()}${o.slice(1)}`;if(r&&typeof r=="function"){const n=r(i);if(n instanceof Promise)return n.then(S=>{t.props[l]=S});t.props[l]=n}}var errors={100:({data:e})=>`Only groups, lists, and forms can have children (${e.name}).`,101:({data:e})=>`You cannot directly modify the store (${e.name}). See: https://formkit.com/advanced/core#message-store`,102:({data:[e,t]})=>`You cannot directly assign node.${t} (${e.name})`,103:({data:[e]})=>`Schema expressions cannot start with an operator (${e})`,104:({data:[e,t]})=>`Schema expressions cannot end with an operator (${e} in "${t}")`,105:({data:e})=>`Invalid schema expression: ${e}`,106:({data:e})=>`Cannot submit because (${e}) is not in a form.`,107:({data:[e,t]})=>`Cannot set ${e.name} to non object value: ${t}`,108:({data:[e,t]})=>`Cannot set ${e.name} to non array value: ${t}`,300:({data:[e]})=>`Cannot set behavior prop to overscroll (on ${e.name} input) when options prop is a function.`,600:({data:e})=>`Unknown input type${typeof e.props.type=="string"?' "'+e.props.type+'"':""} ("${e.name}")`,601:({data:e})=>`Input definition${typeof e.props.type=="string"?' "'+e.props.type+'"':""} is missing a schema or component property (${e.name}).`},warnings={150:({data:e})=>`Schema function "${e}()" is not a valid function.`,151:({data:e})=>`No form element with id: ${e}`,152:({data:e})=>`No input element with id: ${e}`,350:({data:{node:e,inputType:t}})=>`Invalid options prop for ${e.name} input (${t}). See https://formkit.com/inputs/${t}`,650:'Schema "$get()" must use the id of an input to access.',651:({data:e})=>`Cannot setErrors() on "${e}" because no such id exists.`,652:({data:e})=>`Cannot clearErrors() on "${e}" because no such id exists.`,800:({data:e})=>`${e} is deprecated.`},decodeErrors=(e,t)=>{if(e.code in errors){const i=errors[e.code];e.message=typeof i=="function"?i(e):i}return t(e)},registered=!1;function register(){registered||(errorHandler(decodeErrors),warningHandler(decodeWarnings),registered=!0)}var decodeWarnings=(e,t)=>{if(e.code in warnings){const i=warnings[e.code];e.message=typeof i=="function"?i(e):i}return t(e)},__defProp=Object.defineProperty,__getOwnPropNames=Object.getOwnPropertyNames,__esm=(e,t)=>function(){return e&&(t=(0,e[__getOwnPropNames(e)[0]])(e=0)),t},__export=(e,t)=>{for(var i in t)__defProp(e,i,{get:t[i],enumerable:!0})},vueBindings,bindings_default,init_bindings=__esm({"packages/vue/src/bindings.ts"(){vueBindings=function(t){t.ledger.count("blocking",It=>It.blocking);const i=ref(!t.ledger.value("blocking"));t.ledger.count("errors",It=>It.type==="error");const r=ref(!!t.ledger.value("errors"));let o=!1;nextTick(()=>{o=!0});const l=reactive(t.store.reduce((It,Yt)=>(Yt.visible&&(It[Yt.key]=Yt),It),{})),d=ref(t.props.validationVisibility||(t.props.type==="checkbox"?"dirty":"blur"));t.on("prop:validationVisibility",({payload:It})=>{d.value=It});const n=ref(d.value==="live"),S=ref(!1),C=It=>{S.value=(It??[]).some(Yt=>Yt.name==="required")};C(t.props.parsedRules),t.on("prop:parsedRules",({payload:It})=>C(It));const I=ref(t.children.map(It=>It.uid)),z=computed(()=>{if(!xt.state)return!1;if(xt.state.submitted)return!0;if(!n.value&&!xt.state.settled)return!1;switch(d.value){case"live":return!0;case"blur":return xt.state.blurred;case"dirty":return xt.state.dirty;default:return!1}}),$=computed(()=>xt.state.failing&&z.value),k=computed(()=>xt&&Y.value?i.value&&!r.value:xt.state.dirty&&!empty(xt.value)),Y=ref(Array.isArray(t.props.parsedRules)&&t.props.parsedRules.length>0);t.on("prop:parsedRules",({payload:It})=>{Y.value=Array.isArray(It)&&It.length>0});const ie=computed(()=>{const It={};for(const Yt in l){const ri=l[Yt];(ri.type!=="validation"||z.value)&&(It[Yt]=ri)}return It}),ue=reactive(t.store.reduce((It,Yt)=>(Yt.type==="ui"&&Yt.visible&&(It[Yt.key]=Yt),It),{})),ne=computed(()=>!xt.state.failing),se=reactive({}),le=new Proxy(se,{get(...It){if(!t)return"";const[Yt,ri]=It;let ei=Reflect.get(...It);return!ei&&typeof ri=="string"&&!has(Yt,ri)&&!ri.startsWith("__v")&&createObserver(t).watch(Ut=>{const Mt=typeof Ut.config.rootClasses=="function"?Ut.config.rootClasses(ri,Ut):{},$t=Ut.config.classes?createClasses(ri,Ut,Ut.config.classes[ri]):{},jt=createClasses(ri,Ut,Ut.props[`_${ri}Class`]),mi=createClasses(ri,Ut,Ut.props[`${ri}Class`]);ei=generateClassList(Ut,ri,Mt,$t,jt,mi),Yt[ri]=ei??""}),ei}});t.on("prop:rootClasses",()=>{const It=Object.keys(se);for(const Yt of It)delete se[Yt]});const he=computed(()=>{if(!t)return;const It=[];xt.help&&It.push(`help-${t.props.id}`);for(const Yt in ie.value)It.push(`${t.props.id}-${Yt}`);return It.length?It.join(" "):void 0}),me=ref(t.value),ge=ref(t.value),xt=reactive({_value:ge,attrs:t.props.attrs,disabled:t.props.disabled,describedBy:he,fns:{length:It=>Object.keys(It).length,number:It=>Number(It),string:It=>String(It),json:It=>JSON.stringify(It),eq},handlers:{blur:It=>{t&&(t.store.set(createMessage({key:"blurred",visible:!1,value:!0})),typeof t.props.attrs.onBlur=="function"&&t.props.attrs.onBlur(It))},touch:()=>{var ri;const It=xt.dirtyBehavior==="compare";if((ri=t.store.dirty)!=null&&ri.value&&!It)return;const Yt=!eq(t.props._init,t._value);!Yt&&!It||t.store.set(createMessage({key:"dirty",visible:!1,value:Yt}))},DOMInput:It=>{t.input(It.target.value),t.emit("dom-input-event",It)}},help:t.props.help,id:t.props.id,items:I,label:t.props.label,messages:ie,didMount:!1,node:markRaw(t),options:t.props.options,defaultMessagePlacement:!0,slots:t.props.__slots,state:{blurred:!1,complete:k,dirty:!1,empty:empty(me),submitted:!1,settled:t.isSettled,valid:i,invalid:$,errors:r,rules:Y,validationVisible:z,required:S,failing:!1,passing:ne},type:t.props.type,family:t.props.family,ui:ue,value:me,classes:le});t.on("created",()=>{eq(xt.value,t.value)||(ge.value=t.value,me.value=t.value,triggerRef(me),triggerRef(ge)),(async()=>(await t.settled,t&&(t.props._init=cloneAny(t.value))))()}),t.on("mounted",()=>{xt.didMount=!0}),t.on("settled",({payload:It})=>{xt.state.settled=It});function Et(It){(Array.isArray(It)?It:Object.keys(It)).forEach(ri=>{ri=camel(ri),has(xt,ri)||(xt[ri]=t.props[ri]),t.on(`prop:${ri}`,({payload:ei})=>{xt[ri]=ei})})}Et((()=>{const It=["__root","help","label","disabled","options","type","attrs","preserve","preserveErrors","id","dirtyBehavior"],Yt=/^[a-zA-Z-]+(?:-icon|Icon)$/,ri=Object.keys(t.props).filter(ei=>Yt.test(ei));return It.concat(ri)})());function Zt(It){It.props&&Et(It.props)}t.props.definition&&Zt(t.props.definition),t.on("added-props",({payload:It})=>Et(It)),t.on("input",({payload:It})=>{t.type!=="input"&&!isRef(It)&&!isReactive(It)?ge.value=shallowClone(It):(ge.value=It,triggerRef(ge))}),t.on("commitRaw",({payload:It})=>{t.type!=="input"&&!isRef(It)&&!isReactive(It)?me.value=ge.value=shallowClone(It):(me.value=ge.value=It,triggerRef(me)),t.emit("modelUpdated")}),t.on("commit",({payload:It})=>{var Yt;if((!xt.state.dirty||xt.dirtyBehavior==="compare")&&t.isCreated&&o)if(!((Yt=t.store.validating)!=null&&Yt.value))xt.handlers.touch();else{const ri=t.on("message-removed",({payload:ei})=>{ei.key==="validating"&&(xt.handlers.touch(),t.off(ri))})}k&&t.type==="input"&&r.value&&!undefine(t.props.preserveErrors)&&t.store.filter(ri=>{var ei;return!(ri.type==="error"&&((ei=ri.meta)==null?void 0:ei.autoClear)===!0)}),t.type==="list"&&t.sync&&(I.value=t.children.map(ri=>ri.uid)),xt.state.empty=empty(It)});const Ht=async It=>{It.type==="ui"&&It.visible&&!It.meta.showAsMessage?ue[It.key]=It:It.visible?l[It.key]=It:It.type==="state"&&(xt.state[It.key]=!!It.value)};t.on("message-added",It=>Ht(It.payload)),t.on("message-updated",It=>Ht(It.payload)),t.on("message-removed",({payload:It})=>{delete ue[It.key],delete l[It.key],delete xt.state[It.key]}),t.on("settled:blocking",()=>{i.value=!0}),t.on("unsettled:blocking",()=>{i.value=!1}),t.on("settled:errors",()=>{r.value=!1}),t.on("unsettled:errors",()=>{r.value=!0}),watch$1(z,It=>{It&&(n.value=!0)}),t.context=xt,t.emit("context",t,!1),t.on("destroyed",()=>{t.context=void 0,t=null})},bindings_default=vueBindings}}),defaultConfig_exports={};__export(defaultConfig_exports,{defaultConfig:()=>defaultConfig$1});var defaultConfig$1,init_defaultConfig=__esm({"packages/vue/src/defaultConfig.ts"(){init_bindings(),defaultConfig$1=(e={})=>{register();const{rules:t={},locales:i={},inputs:r={},messages:o={},locale:l=void 0,theme:d=void 0,iconLoaderUrl:n=void 0,iconLoader:S=void 0,icons:C={},...I}=e,z=createValidationPlugin({...defaultRules,...t||{}}),$=createI18nPlugin(extend$1({en,...i||{}},o)),k=createLibraryPlugin(inputs,r),Y=createThemePlugin(d,C,n,S);return extend$1({plugins:[k,Y,bindings_default,$,z],...l?{config:{locale:l}}:{}},I||{},!0)}}}),isServer=typeof window>"u",ssrCompleteRegistry=new Map;function ssrComplete(e){if(!isServer)return;const t=ssrCompleteRegistry.get(e);if(t){for(const i of t)i();t.clear(),ssrCompleteRegistry.delete(e)}}function onSSRComplete(e,t){var i;!isServer||!e||(ssrCompleteRegistry.has(e)||ssrCompleteRegistry.set(e,new Set),(i=ssrCompleteRegistry.get(e))==null||i.add(t))}var isServer2=typeof window>"u",memo={},memoKeys={},instanceKey,instanceScopes=new WeakMap,raw="__raw__",isClassProp=/[a-zA-Z0-9\-][cC]lass$/;function getRef(e,t){const i=ref(null);if(e==="get"){const o={};return i.value=get.bind(null,o),i}const r=e.split(".");return watchEffect(()=>{i.value=getValue(isRef(t)?t.value:t,r)}),i}function getValue(e,t){if(Array.isArray(e)){for(const o of e){const l=o!==!1&&getValue(o,t);if(l!==void 0)return l}return}let i,r=e;for(const o in t){const l=t[o];if(typeof r!="object"||r===null){i=void 0;break}const d=r[l];if(Number(o)===t.length-1&&d!==void 0){i=typeof d=="function"?d.bind(r):d;break}r=d}return i}function get(e,t){if(typeof t!="string")return warn(650);if(t in e||(e[t]=ref(void 0)),e[t].value===void 0){e[t].value=null;const i=getNode(t);i&&(e[t].value=i.context),watchRegistry(t,({payload:r})=>{e[t].value=isNode(r)?r.context:r})}return e[t].value}function parseSchema(e,t,i){function r(k,Y){const ie=z(compile(Y.if),{if:!0}),ue=C(k,Y.then),ne=Y.else?C(k,Y.else):null;return[ie,ue,ne]}function o(k,Y){var se,le;const ie=z(compile(k.if));let ue=()=>Y,ne=()=>Y;return typeof k.then=="object"?ne=l(k.then,void 0):typeof k.then=="string"&&((se=k.then)!=null&&se.startsWith("$"))?ne=z(compile(k.then)):ne=()=>k.then,has(k,"else")&&(typeof k.else=="object"?ue=l(k.else):typeof k.else=="string"&&((le=k.else)!=null&&le.startsWith("$"))?ue=z(compile(k.else)):ue=()=>k.else),()=>ie()?ne():ue()}function l(k,Y,ie={}){const ue=new Set(Object.keys(k||{})),ne=Y?z(compile(Y)):()=>({}),se=[le=>{const he=ne();for(const me in he)ue.has(me)||(le[me]=he[me])}];if(k){if(isConditional(k))return o(k,ie);for(let le in k){const he=k[le];let me;const ge=typeof he=="string";le.startsWith(raw)?(le=le.substring(7),me=()=>he):ge&&he.startsWith("$")&&he.length>1&&!(he.startsWith("$reset")&&isClassProp.test(le))?me=z(compile(he)):typeof he=="object"&&isConditional(he)?me=o(he,void 0):typeof he=="object"&&isPojo(he)?me=l(he):me=()=>he,se.push(xt=>{xt[le]=me()})}}return()=>{const le=Array.isArray(k)?[]:{};return se.forEach(he=>he(le)),le}}function d(k,Y){let ie=null,ue=()=>null,ne=!1,se=null,le=null,he=null,me=!1;const ge=sugar(Y);if(isDOM(ge)?(ie=ge.$el,ue=ge.$el!=="text"?l(ge.attrs,ge.bind):()=>null):isComponent(ge)?(typeof ge.$cmp=="string"?has(k,ge.$cmp)?ie=k[ge.$cmp]:(ie=ge.$cmp,me=!0):ie=ge.$cmp,ue=l(ge.props,ge.bind)):isConditional(ge)&&([ne,se,le]=r(k,ge)),!isConditional(ge)&&"if"in ge?ne=z(compile(ge.if)):!isConditional(ge)&&ie===null&&(ne=()=>!0),"children"in ge&&ge.children)if(typeof ge.children=="string")if(ge.children.startsWith("$slots."))ie=ie==="text"?"slot":ie,se=z(compile(ge.children));else if(ge.children.startsWith("$")&&ge.children.length>1){const xt=z(compile(ge.children));se=()=>String(xt())}else se=()=>String(ge.children);else if(Array.isArray(ge.children))se=C(k,ge.children);else{const[xt,Et,Lt]=r(k,ge.children);se=Zt=>xt&&xt()?Et&&Et(Zt):Lt&&Lt(Zt)}if(isComponent(ge))if(se){const xt=se;se=Et=>({default(Lt,Zt){var Yt,ri,ei,Ct;const Ht=instanceKey;Zt&&(instanceKey=Zt),Lt&&((Yt=instanceScopes.get(instanceKey))==null||Yt.unshift(Lt)),Et&&((ri=instanceScopes.get(instanceKey))==null||ri.unshift(Et));const It=xt(Et);return Lt&&((ei=instanceScopes.get(instanceKey))==null||ei.shift()),Et&&((Ct=instanceScopes.get(instanceKey))==null||Ct.shift()),instanceKey=Ht,It}}),se.slot=!0}else se=()=>({});if("for"in ge&&ge.for){const xt=ge.for.length===3?ge.for[2]:ge.for[1];he=[typeof xt=="string"&&xt.startsWith("$")?z(compile(xt)):()=>xt,ge.for[0],ge.for.length===3?String(ge.for[1]):null]}return[ne,ie,ue,se,le,he,me]}function n(k,Y){const ie=k(Y),ue=instanceKey;return Object.keys(ie).reduce((ne,se)=>{const le=ie&&ie[se];return ne[se]=he=>le&&le(he,ue)||null,ne},{})}function S(k,Y){const[ie,ue,ne,se,le,he,me]=d(k,Y);let ge=xt=>{if(ie&&ue===null&&se)return ie()?se(xt):le&&le(xt);if(ue&&(!ie||ie())){if(ue==="text"&&se)return createTextVNode(String(se()));if(ue==="slot"&&se)return se(xt);const Et=me?resolveComponent(ue):ue,Lt=se!=null&&se.slot?n(se,xt):null;return h(Et,ne(),Lt||(se?se(xt):[]))}return typeof le=="function"?le(xt):le};if(he){const xt=ge,[Et,Lt,Zt]=he;ge=()=>{const Ht=Et(),It=Number.isFinite(Ht)?Array(Number(Ht)).fill(0).map((Ct,Ut)=>Ut):Ht,Yt=[];if(typeof It!="object")return null;const ri=instanceScopes.get(instanceKey)||[],ei=Array.isArray(It);for(const Ct in It){if(ei&&Ct in Array.prototype)continue;const Ut=Object.defineProperty({...ri.reduce((Mt,$t)=>Mt.__idata?{...Mt,...$t}:$t,{}),[Lt]:It[Ct],...Zt!==null?{[Zt]:ei?Number(Ct):Ct}:{}},"__idata",{enumerable:!1,value:!0});ri.unshift(Ut),Yt.push(xt.bind(null,Ut)()),ri.shift()}return Yt}}return ge}function C(k,Y){if(Array.isArray(Y)){const ue=Y.map(S.bind(null,k));return ne=>ue.map(se=>se(ne))}const ie=S(k,Y);return ue=>ie(ue)}const I=[];function z(k,Y={}){const ie=new WeakMap;return I.push((ue,ne)=>{ie.set(ne,k.provide(se=>ue(se,Y)))}),()=>ie.get(instanceKey)()}function $(k,Y){i??(i=toMemoKey(t));const[ie,ue]=has(memo,i)?memo[i]:[C(e,t),I];return isServer2||(memoKeys[i]??(memoKeys[i]=0),memoKeys[i]++,memo[i]=[ie,ue]),ue.forEach(ne=>{ne(k,Y)}),()=>(instanceKey=Y,ie())}return $}function useScope(e,t){const i=instanceScopes.get(instanceKey)||[];let r;return i.length&&(r=getValue(i,e.split("."))),r===void 0?t:r}function slotData(e,t){return new Proxy(e,{get(...i){let r;const o=i[1];if(typeof o=="string"){const l=instanceKey;instanceKey=t,r=useScope(o,void 0),instanceKey=l}return r!==void 0?r:Reflect.get(...i)}})}function createRenderFn(e,t,i){return e((r,o={})=>r.reduce((l,d)=>{if(d.startsWith("slots.")){const n=d.substring(6),S=()=>t.slots&&has(t.slots,n)&&typeof t.slots[n]=="function";if(o.if)l[d]=S;else if(t.slots){const C=slotData(t,i);l[d]=()=>S()?t.slots[n](C):null}}else{const n=getRef(d,t);l[d]=()=>useScope(d,n.value)}return l},{}),i)}function clean(e,t,i){if(t??(t=toMemoKey(e)),memoKeys[t]--,memoKeys[t]===0){delete memoKeys[t];const[,r]=memo[t];delete memo[t],r.length=0}instanceScopes.delete(i)}function toMemoKey(e){return JSON.stringify(e,(t,i)=>typeof i=="function"?i.toString():i)}var FormKitSchema=defineComponent({name:"FormKitSchema",props:{schema:{type:[Array,Object],required:!0},data:{type:Object,default:()=>({})},library:{type:Object,default:()=>({})},memoKey:{type:String,required:!1}},emits:["mounted"],setup(e,t){var C;const i=getCurrentInstance();let r={};instanceScopes.set(r,[]);const o={FormKit:markRaw(FormKit_default),...e.library};let l=parseSchema(o,e.schema,e.memoKey),d,n;isServer2||watch$1(()=>e.schema,(I,z)=>{var k;const $=r;r={},instanceScopes.set(r,[]),l=parseSchema(o,e.schema,e.memoKey),d=createRenderFn(l,n,r),I===z&&((k=i==null?void 0:i.proxy)==null?void 0:k.$forceUpdate).call(k),clean(e.schema,e.memoKey,$)},{deep:!0}),watchEffect(()=>{n=Object.assign(reactive(e.data??{}),{slots:t.slots}),t.slots,d=createRenderFn(l,n,r)});function S(){clean(e.schema,e.memoKey,r),n&&(n.node&&n.node.destroy(),n.slots=null,n=null),d=null}return onMounted(()=>t.emit("mounted")),onUnmounted(S),onSSRComplete((C=getCurrentInstance())==null?void 0:C.appContext.app,S),()=>d?d():null}}),FormKitSchema_default=FormKitSchema,isServer3=typeof window>"u",parentSymbol=Symbol("FormKitParent"),componentSymbol=Symbol("FormKitComponentCallback");function FormKit(e,t){const i=useInput(e,t);if(i.props.definition||error(600,i),i.props.definition.component)return()=>{var C;return h((C=i.props.definition)==null?void 0:C.component,{context:i.context},{...t.slots})};const r=ref([]);let o=i.props.definition.schemaMemoKey;const l=()=>{var I,z;const C=(z=(I=i.props)==null?void 0:I.definition)==null?void 0:z.schema;C||error(601,i),typeof C=="function"?(r.value=C({...e.sectionsSchema||{}}),(o&&e.sectionsSchema||"memoKey"in C&&typeof C.memoKey=="string")&&(o=(o??(C==null?void 0:C.memoKey))+JSON.stringify(e.sectionsSchema))):r.value=C};l(),isServer3||i.on("schema",()=>{o+="",l()}),t.emit("node",i);const d=i.props.definition.library,n={FormKit:markRaw(formkitComponent),...d,...e.library??{}};function S(){i.emit("mounted")}return t.expose({node:i}),()=>h(FormKitSchema,{schema:r.value,data:i.context,onMounted:S,library:n,memoKey:o},{...t.slots})}var formkitComponent=defineComponent(FormKit,{props:runtimeProps,inheritAttrs:!1}),FormKit_default=formkitComponent,rootSymbol=Symbol();function createPlugin(e,t){return e.component(t.alias||"FormKit",FormKit_default).component(t.schemaAlias||"FormKitSchema",FormKitSchema_default),{get:getNode,setLocale:i=>{var r;(r=t.config)!=null&&r.rootConfig&&(t.config.rootConfig.locale=i)},clearErrors:clearErrors2,setErrors:setErrors2,submit:submitForm,reset}}var optionsSymbol=Symbol.for("FormKitOptions"),configSymbol=Symbol.for("FormKitConfig"),plugin={install(e,t){const i=Object.assign({alias:"FormKit",schemaAlias:"FormKitSchema"},typeof t=="function"?t():t),r=createConfig(i.config||{});i.config={rootConfig:r},e.config.globalProperties.$formkit=createPlugin(e,i),e.provide(optionsSymbol,i),e.provide(configSymbol,r),typeof window<"u"&&(globalThis.__FORMKIT_CONFIGS__=(globalThis.__FORMKIT_CONFIGS__||[]).concat([r]))}},isBrowser=typeof window<"u",pseudoProps=["ignore","disabled","preserve","help","label",/^preserve(-e|E)rrors/,/^[a-z]+(?:-visibility|Visibility|-behavior|Behavior)$/,/^[a-zA-Z-]+(?:-class|Class)$/,"prefixIcon","suffixIcon",/^[a-zA-Z-]+(?:-icon|Icon)$/],boolProps=["disabled","ignore","preserve"];function classesToNodeProps(e,t){t.classes&&Object.keys(t.classes).forEach(i=>{typeof i=="string"&&(e.props[`_${i}Class`]=t.classes[i],isObject(t.classes[i])&&i==="inner"&&Object.values(t.classes[i]))})}function onlyListeners(e){return e?["Submit","SubmitRaw","SubmitInvalid"].reduce((i,r)=>{const o=`on${r}`;return o in e&&typeof e[o]=="function"&&(i[o]=e[o]),i},{}):{}}function useInput(e,t,i={}){const r=Object.assign({},inject(optionsSymbol)||{},i),o=inject(rootSymbol,ref(isBrowser?document:void 0)),l=inject(componentSymbol,()=>{}),d=getCurrentInstance(),n=onlyListeners(d==null?void 0:d.vnode.props),S=["modelValue","model-value"].some(ge=>ge in((d==null?void 0:d.vnode.props)??{}));let C=!1;onMounted(()=>{C=!0});const I=e.modelValue!==void 0?e.modelValue:cloneAny(t.attrs.value);function z(){const ge={...nodeProps(e),...n,type:e.type??"text",__root:o.value,__slots:t.slots},xt=except(nodeProps(t.attrs),pseudoProps);xt.key||(xt.key=token()),ge.attrs=xt;const Et=only(nodeProps(t.attrs),pseudoProps);for(const Zt in Et)boolProps.includes(Zt)&&Et[Zt]===""&&(Et[Zt]=!0),ge[camel(Zt)]=Et[Zt];const Lt={props:{}};return classesToNodeProps(Lt,e),Object.assign(ge,Lt.props),typeof ge.type!="string"&&(ge.definition=ge.type,delete ge.type),ge}const $=z(),k=$.ignore?null:e.parent||inject(parentSymbol,null),Y=createNode(extend$1(r||{},{name:e.name||void 0,value:I,parent:k,plugins:(r.plugins||[]).concat(e.plugins??[]),config:e.config||{},props:$,index:e.index,sync:!!undefine(t.attrs.sync||t.attrs.dynamic)},!1,!0));l(Y),Y.props.definition||error(600,Y);const ie=ref(new Set(Array.isArray(Y.props.__propDefs)?Y.props.__propDefs:Object.keys(Y.props.__propDefs??{})));Y.on("added-props",({payload:ge})=>{(Array.isArray(ge)?ge:Object.keys(ge??{})).forEach(Et=>ie.value.add(Et))});const ue=computed(()=>pseudoProps.concat([...ie.value]).reduce((ge,xt)=>(typeof xt=="string"?(ge.push(camel(xt)),ge.push(kebab(xt))):ge.push(xt),ge),[]));watchEffect(()=>classesToNodeProps(Y,e));const ne=nodeProps(e);for(const ge in ne)watch$1(()=>e[ge],()=>{e[ge]!==void 0&&(Y.props[ge]=e[ge])});watchEffect(()=>{Y.props.__root=o.value});const se=new Set,le=nodeProps(t.attrs);watchEffect(()=>{he(only(le,ue.value))});function he(ge){se.forEach(xt=>{xt(),se.delete(xt)});for(const xt in ge){const Et=camel(xt);se.add(watch$1(()=>t.attrs[xt],()=>{Y.props[Et]=t.attrs[xt]}))}}if(watchEffect(()=>{const ge=except(nodeProps(t.attrs),ue.value);"multiple"in ge&&(ge.multiple=undefine(ge.multiple)),typeof ge.onBlur=="function"&&(ge.onBlur=oncePerTick(ge.onBlur)),Y.props.attrs=Object.assign({},Y.props.attrs||{},ge)}),watchEffect(()=>{const ge=(e.errors??[]).map(xt=>createMessage({key:slugify(xt),type:"error",value:xt,meta:{source:"prop"}}));Y.store.apply(ge,xt=>xt.type==="error"&&xt.meta.source==="prop")}),Y.type!=="input"){const ge=`${Y.name}-prop`;watchEffect(()=>{const xt=e.inputErrors??{},Et=Object.keys(xt);Et.length||Y.clearErrors(!0,ge);const Lt=Et.reduce((Zt,Ht)=>{let It=xt[Ht];return typeof It=="string"&&(It=[It]),Array.isArray(It)&&(Zt[Ht]=It.map(Yt=>createMessage({key:Yt,type:"error",value:Yt,meta:{source:ge}}))),Zt},{});Y.store.apply(Lt,Zt=>Zt.type==="error"&&Zt.meta.source===ge)})}watchEffect(()=>Object.assign(Y.config,e.config)),Y.type!=="input"&&provide(parentSymbol,Y);let me;return Y.on("modelUpdated",()=>{var ge,xt;t.emit("inputRaw",(ge=Y.context)==null?void 0:ge.value,Y),C&&t.emit("input",(xt=Y.context)==null?void 0:xt.value,Y),S&&Y.context&&(me=cloneAny(Y.value),t.emit("update:modelValue",shallowClone(Y.value)))}),S&&(watch$1(toRef(e,"modelValue"),ge=>{eq(me,ge)||Y.input(ge,!1)},{deep:!0}),Y.value!==I&&Y.emit("modelUpdated")),onBeforeUnmount(()=>Y.destroy()),Y}var messages=createSection("messages",()=>({$el:"ul",if:"$fns.length($messages)"})),message=createSection("message",()=>({$el:"li",for:["message","$messages"],attrs:{key:"$message.key",id:"$id + '-' + $message.key","data-message-type":"$message.type"}}));messages(message("$message.value"));var summary=createSection("summary",()=>({$el:"div",attrs:{"aria-live":"polite"}})),summaryInner=createSection("summaryInner",()=>({$el:"div",if:"$summaries.length && $showSummaries"})),messages2=createSection("messages",()=>({$el:"ul",if:"$summaries.length && $showSummaries"})),message2=createSection("message",()=>({$el:"li",for:["summary","$summaries"],attrs:{key:"$summary.key","data-message-type":"$summary.type"}})),summaryHeader=createSection("summaryHeader",()=>({$el:"h2",attrs:{id:"$id"}})),messageLink=createSection("messageLink",()=>({$el:"a",attrs:{id:"$summary.key",href:'$: "#" + $summary.id',onClick:"$jumpLink"}}));summary(summaryInner(summaryHeader("$summaryHeader"),messages2(message2(messageLink("$summary.message")))));init_defaultConfig();init_bindings();const formkitPlugin_Kw9Zxpc32ie3g9uaRfiavVL004WiVJNxPefwwMCJMnU=defineNuxtPlugin(e=>{const t=defaultConfig$1;e.hook("app:rendered",i=>{resetCount(),ssrComplete(e.vueApp)}),e.vueApp.use(plugin,t)}),matchIconName=/^[a-z0-9]+(-[a-z0-9]+)*$/,stringToIcon=(e,t,i,r="")=>{const o=e.split(":");if(e.slice(0,1)==="@"){if(o.length<2||o.length>3)return null;r=o.shift().slice(1)}if(o.length>3||!o.length)return null;if(o.length>1){const n=o.pop(),S=o.pop(),C={provider:o.length>0?o[0]:r,prefix:S,name:n};return t&&!validateIconName(C)?null:C}const l=o[0],d=l.split("-");if(d.length>1){const n={provider:r,prefix:d.shift(),name:d.join("-")};return t&&!validateIconName(n)?null:n}if(i&&r===""){const n={provider:r,prefix:"",name:l};return t&&!validateIconName(n,i)?null:n}return null},validateIconName=(e,t)=>e?!!((t&&e.prefix===""||e.prefix)&&e.name):!1,defaultIconDimensions$1=Object.freeze({left:0,top:0,width:16,height:16}),defaultIconTransformations$1=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),defaultIconProps$1=Object.freeze({...defaultIconDimensions$1,...defaultIconTransformations$1}),defaultExtendedIconProps=Object.freeze({...defaultIconProps$1,body:"",hidden:!1});function mergeIconTransformations(e,t){const i={};!e.hFlip!=!t.hFlip&&(i.hFlip=!0),!e.vFlip!=!t.vFlip&&(i.vFlip=!0);const r=((e.rotate||0)+(t.rotate||0))%4;return r&&(i.rotate=r),i}function mergeIconData(e,t){const i=mergeIconTransformations(e,t);for(const r in defaultExtendedIconProps)r in defaultIconTransformations$1?r in e&&!(r in i)&&(i[r]=defaultIconTransformations$1[r]):r in t?i[r]=t[r]:r in e&&(i[r]=e[r]);return i}function getIconsTree(e,t){const i=e.icons,r=e.aliases||Object.create(null),o=Object.create(null);function l(d){if(i[d])return o[d]=[];if(!(d in o)){o[d]=null;const n=r[d]&&r[d].parent,S=n&&l(n);S&&(o[d]=[n].concat(S))}return o[d]}return Object.keys(i).concat(Object.keys(r)).forEach(l),o}function internalGetIconData(e,t,i){const r=e.icons,o=e.aliases||Object.create(null);let l={};function d(n){l=mergeIconData(r[n]||o[n],l)}return d(t),i.forEach(d),mergeIconData(e,l)}function parseIconSet(e,t){const i=[];if(typeof e!="object"||typeof e.icons!="object")return i;e.not_found instanceof Array&&e.not_found.forEach(o=>{t(o,null),i.push(o)});const r=getIconsTree(e);for(const o in r){const l=r[o];l&&(t(o,internalGetIconData(e,o,l)),i.push(o))}return i}const optionalPropertyDefaults={provider:"",aliases:{},not_found:{},...defaultIconDimensions$1};function checkOptionalProps(e,t){for(const i in t)if(i in e&&typeof e[i]!=typeof t[i])return!1;return!0}function quicklyValidateIconSet(e){if(typeof e!="object"||e===null)return null;const t=e;if(typeof t.prefix!="string"||!e.icons||typeof e.icons!="object"||!checkOptionalProps(e,optionalPropertyDefaults))return null;const i=t.icons;for(const o in i){const l=i[o];if(!o||typeof l.body!="string"||!checkOptionalProps(l,defaultExtendedIconProps))return null}const r=t.aliases||Object.create(null);for(const o in r){const l=r[o],d=l.parent;if(!o||typeof d!="string"||!i[d]&&!r[d]||!checkOptionalProps(l,defaultExtendedIconProps))return null}return t}const dataStorage=Object.create(null);function newStorage(e,t){return{provider:e,prefix:t,icons:Object.create(null),missing:new Set}}function getStorage(e,t){const i=dataStorage[e]||(dataStorage[e]=Object.create(null));return i[t]||(i[t]=newStorage(e,t))}function addIconSet(e,t){return quicklyValidateIconSet(t)?parseIconSet(t,(i,r)=>{r?e.icons[i]=r:e.missing.add(i)}):[]}function addIconToStorage(e,t,i){try{if(typeof i.body=="string")return e.icons[t]={...i},!0}catch{}return!1}let simpleNames=!1;function allowSimpleNames(e){return typeof e=="boolean"&&(simpleNames=e),simpleNames}function getIconData(e){const t=typeof e=="string"?stringToIcon(e,!0,simpleNames):e;if(t){const i=getStorage(t.provider,t.prefix),r=t.name;return i.icons[r]||(i.missing.has(r)?null:void 0)}}function addIcon(e,t){const i=stringToIcon(e,!0,simpleNames);if(!i)return!1;const r=getStorage(i.provider,i.prefix);return t?addIconToStorage(r,i.name,t):(r.missing.add(i.name),!0)}function addCollection(e,t){if(typeof e!="object")return!1;if(typeof t!="string"&&(t=e.provider||""),simpleNames&&!t&&!e.prefix){let o=!1;return quicklyValidateIconSet(e)&&(e.prefix="",parseIconSet(e,(l,d)=>{addIcon(l,d)&&(o=!0)})),o}const i=e.prefix;if(!validateIconName({prefix:i,name:"a"}))return!1;const r=getStorage(t,i);return!!addIconSet(r,e)}function getIcon(e){const t=getIconData(e);return t&&{...defaultIconProps$1,...t}}const defaultIconSizeCustomisations$1=Object.freeze({width:null,height:null}),defaultIconCustomisations$1=Object.freeze({...defaultIconSizeCustomisations$1,...defaultIconTransformations$1}),unitsSplit$1=/(-?[0-9.]*[0-9]+[0-9.]*)/g,unitsTest$1=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function calculateSize$1(e,t,i){if(t===1)return e;if(i=i||100,typeof e=="number")return Math.ceil(e*t*i)/i;if(typeof e!="string")return e;const r=e.split(unitsSplit$1);if(r===null||!r.length)return e;const o=[];let l=r.shift(),d=unitsTest$1.test(l);for(;;){if(d){const n=parseFloat(l);isNaN(n)?o.push(l):o.push(Math.ceil(n*t*i)/i)}else o.push(l);if(l=r.shift(),l===void 0)return o.join("");d=!d}}function splitSVGDefs$1(e,t="defs"){let i="";const r=e.indexOf("<"+t);for(;r>=0;){const o=e.indexOf(">",r),l=e.indexOf("</"+t);if(o===-1||l===-1)break;const d=e.indexOf(">",l);if(d===-1)break;i+=e.slice(o+1,l).trim(),e=e.slice(0,r).trim()+e.slice(d+1)}return{defs:i,content:e}}function mergeDefsAndContent$1(e,t){return e?"<defs>"+e+"</defs>"+t:t}function wrapSVGContent$1(e,t,i){const r=splitSVGDefs$1(e);return mergeDefsAndContent$1(r.defs,t+r.content+i)}const isUnsetKeyword$1=e=>e==="unset"||e==="undefined"||e==="none";function iconToSVG$1(e,t){const i={...defaultIconProps$1,...e},r={...defaultIconCustomisations$1,...t},o={left:i.left,top:i.top,width:i.width,height:i.height};let l=i.body;[i,r].forEach(ie=>{const ue=[],ne=ie.hFlip,se=ie.vFlip;let le=ie.rotate;ne?se?le+=2:(ue.push("translate("+(o.width+o.left).toString()+" "+(0-o.top).toString()+")"),ue.push("scale(-1 1)"),o.top=o.left=0):se&&(ue.push("translate("+(0-o.left).toString()+" "+(o.height+o.top).toString()+")"),ue.push("scale(1 -1)"),o.top=o.left=0);let he;switch(le<0&&(le-=Math.floor(le/4)*4),le=le%4,le){case 1:he=o.height/2+o.top,ue.unshift("rotate(90 "+he.toString()+" "+he.toString()+")");break;case 2:ue.unshift("rotate(180 "+(o.width/2+o.left).toString()+" "+(o.height/2+o.top).toString()+")");break;case 3:he=o.width/2+o.left,ue.unshift("rotate(-90 "+he.toString()+" "+he.toString()+")");break}le%2===1&&(o.left!==o.top&&(he=o.left,o.left=o.top,o.top=he),o.width!==o.height&&(he=o.width,o.width=o.height,o.height=he)),ue.length&&(l=wrapSVGContent$1(l,'<g transform="'+ue.join(" ")+'">',"</g>"))});const d=r.width,n=r.height,S=o.width,C=o.height;let I,z;d===null?(z=n===null?"1em":n==="auto"?C:n,I=calculateSize$1(z,S/C)):(I=d==="auto"?S:d,z=n===null?calculateSize$1(I,C/S):n==="auto"?C:n);const $={},k=(ie,ue)=>{isUnsetKeyword$1(ue)||($[ie]=ue.toString())};k("width",I),k("height",z);const Y=[o.left,o.top,S,C];return $.viewBox=Y.join(" "),{attributes:$,viewBox:Y,body:l}}const regex=/\sid="(\S+)"/g,randomPrefix="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let counter=0;function replaceIDs(e,t=randomPrefix){const i=[];let r;for(;r=regex.exec(e);)i.push(r[1]);if(!i.length)return e;const o="suffix"+(Math.random()*16777216|Date.now()).toString(16);return i.forEach(l=>{const d=typeof t=="function"?t(l):t+(counter++).toString(),n=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp('([#;"])('+n+')([")]|\\.[a-z])',"g"),"$1"+d+o+"$3")}),e=e.replace(new RegExp(o,"g"),""),e}const storage=Object.create(null);function setAPIModule(e,t){storage[e]=t}function getAPIModule(e){return storage[e]||storage[""]}function createAPIConfig(e){let t;if(typeof e.resources=="string")t=[e.resources];else if(t=e.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:e.path||"/",maxURL:e.maxURL||500,rotate:e.rotate||750,timeout:e.timeout||5e3,random:e.random===!0,index:e.index||0,dataAfterTimeout:e.dataAfterTimeout!==!1}}const configStorage=Object.create(null),fallBackAPISources=["https://api.simplesvg.com","https://api.unisvg.com"],fallBackAPI=[];for(;fallBackAPISources.length>0;)fallBackAPISources.length===1||Math.random()>.5?fallBackAPI.push(fallBackAPISources.shift()):fallBackAPI.push(fallBackAPISources.pop());configStorage[""]=createAPIConfig({resources:["https://api.iconify.design"].concat(fallBackAPI)});function addAPIProvider(e,t){const i=createAPIConfig(t);return i===null?!1:(configStorage[e]=i,!0)}function getAPIConfig(e){return configStorage[e]}function listAPIProviders(){return Object.keys(configStorage)}const detectFetch=()=>{let e;try{if(e=fetch,typeof e=="function")return e}catch{}};let fetchModule=detectFetch();function setFetch(e){fetchModule=e}function getFetch(){return fetchModule}function calculateMaxLength(e,t){const i=getAPIConfig(e);if(!i)return 0;let r;if(!i.maxURL)r=0;else{let o=0;i.resources.forEach(d=>{o=Math.max(o,d.length)});const l=t+".json?icons=";r=i.maxURL-o-i.path.length-l.length}return r}function shouldAbort(e){return e===404}const prepare=(e,t,i)=>{const r=[],o=calculateMaxLength(e,t),l="icons";let d={type:l,provider:e,prefix:t,icons:[]},n=0;return i.forEach((S,C)=>{n+=S.length+1,n>=o&&C>0&&(r.push(d),d={type:l,provider:e,prefix:t,icons:[]},n=S.length),d.icons.push(S)}),r.push(d),r};function getPath(e){if(typeof e=="string"){const t=getAPIConfig(e);if(t)return t.path}return"/"}const send=(e,t,i)=>{if(!fetchModule){i("abort",424);return}let r=getPath(t.provider);switch(t.type){case"icons":{const l=t.prefix,n=t.icons.join(","),S=new URLSearchParams({icons:n});r+=l+".json?"+S.toString();break}case"custom":{const l=t.uri;r+=l.slice(0,1)==="/"?l.slice(1):l;break}default:i("abort",400);return}let o=503;fetchModule(e+r).then(l=>{const d=l.status;if(d!==200){setTimeout(()=>{i(shouldAbort(d)?"abort":"next",d)});return}return o=501,l.json()}).then(l=>{if(typeof l!="object"||l===null){setTimeout(()=>{l===404?i("abort",l):i("next",o)});return}setTimeout(()=>{i("success",l)})}).catch(()=>{i("next",o)})},fetchAPIModule={prepare,send};function sortIcons(e){const t={loaded:[],missing:[],pending:[]},i=Object.create(null);e.sort((o,l)=>o.provider!==l.provider?o.provider.localeCompare(l.provider):o.prefix!==l.prefix?o.prefix.localeCompare(l.prefix):o.name.localeCompare(l.name));let r={provider:"",prefix:"",name:""};return e.forEach(o=>{if(r.name===o.name&&r.prefix===o.prefix&&r.provider===o.provider)return;r=o;const l=o.provider,d=o.prefix,n=o.name,S=i[l]||(i[l]=Object.create(null)),C=S[d]||(S[d]=getStorage(l,d));let I;n in C.icons?I=t.loaded:d===""||C.missing.has(n)?I=t.missing:I=t.pending;const z={provider:l,prefix:d,name:n};I.push(z)}),t}function removeCallback(e,t){e.forEach(i=>{const r=i.loaderCallbacks;r&&(i.loaderCallbacks=r.filter(o=>o.id!==t))})}function updateCallbacks(e){e.pendingCallbacksFlag||(e.pendingCallbacksFlag=!0,setTimeout(()=>{e.pendingCallbacksFlag=!1;const t=e.loaderCallbacks?e.loaderCallbacks.slice(0):[];if(!t.length)return;let i=!1;const r=e.provider,o=e.prefix;t.forEach(l=>{const d=l.icons,n=d.pending.length;d.pending=d.pending.filter(S=>{if(S.prefix!==o)return!0;const C=S.name;if(e.icons[C])d.loaded.push({provider:r,prefix:o,name:C});else if(e.missing.has(C))d.missing.push({provider:r,prefix:o,name:C});else return i=!0,!0;return!1}),d.pending.length!==n&&(i||removeCallback([e],l.id),l.callback(d.loaded.slice(0),d.missing.slice(0),d.pending.slice(0),l.abort))})}))}let idCounter=0;function storeCallback(e,t,i){const r=idCounter++,o=removeCallback.bind(null,i,r);if(!t.pending.length)return o;const l={id:r,icons:t,callback:e,abort:o};return i.forEach(d=>{(d.loaderCallbacks||(d.loaderCallbacks=[])).push(l)}),o}function listToIcons(e,t=!0,i=!1){const r=[];return e.forEach(o=>{const l=typeof o=="string"?stringToIcon(o,t,i):o;l&&r.push(l)}),r}var defaultConfig={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function sendQuery(e,t,i,r){const o=e.resources.length,l=e.random?Math.floor(Math.random()*o):e.index;let d;if(e.random){let ge=e.resources.slice(0);for(d=[];ge.length>1;){const xt=Math.floor(Math.random()*ge.length);d.push(ge[xt]),ge=ge.slice(0,xt).concat(ge.slice(xt+1))}d=d.concat(ge)}else d=e.resources.slice(l).concat(e.resources.slice(0,l));const n=Date.now();let S="pending",C=0,I,z=null,$=[],k=[];typeof r=="function"&&k.push(r);function Y(){z&&(clearTimeout(z),z=null)}function ie(){S==="pending"&&(S="aborted"),Y(),$.forEach(ge=>{ge.status==="pending"&&(ge.status="aborted")}),$=[]}function ue(ge,xt){xt&&(k=[]),typeof ge=="function"&&k.push(ge)}function ne(){return{startTime:n,payload:t,status:S,queriesSent:C,queriesPending:$.length,subscribe:ue,abort:ie}}function se(){S="failed",k.forEach(ge=>{ge(void 0,I)})}function le(){$.forEach(ge=>{ge.status==="pending"&&(ge.status="aborted")}),$=[]}function he(ge,xt,Et){const Lt=xt!=="success";switch($=$.filter(Zt=>Zt!==ge),S){case"pending":break;case"failed":if(Lt||!e.dataAfterTimeout)return;break;default:return}if(xt==="abort"){I=Et,se();return}if(Lt){I=Et,$.length||(d.length?me():se());return}if(Y(),le(),!e.random){const Zt=e.resources.indexOf(ge.resource);Zt!==-1&&Zt!==e.index&&(e.index=Zt)}S="completed",k.forEach(Zt=>{Zt(Et)})}function me(){if(S!=="pending")return;Y();const ge=d.shift();if(ge===void 0){if($.length){z=setTimeout(()=>{Y(),S==="pending"&&(le(),se())},e.timeout);return}se();return}const xt={status:"pending",resource:ge,callback:(Et,Lt)=>{he(xt,Et,Lt)}};$.push(xt),C++,z=setTimeout(me,e.rotate),i(ge,t,xt.callback)}return setTimeout(me),ne}function initRedundancy(e){const t={...defaultConfig,...e};let i=[];function r(){i=i.filter(n=>n().status==="pending")}function o(n,S,C){const I=sendQuery(t,n,S,(z,$)=>{r(),C&&C(z,$)});return i.push(I),I}function l(n){return i.find(S=>n(S))||null}return{query:o,find:l,setIndex:n=>{t.index=n},getIndex:()=>t.index,cleanup:r}}function emptyCallback$1(){}const redundancyCache=Object.create(null);function getRedundancyCache(e){if(!redundancyCache[e]){const t=getAPIConfig(e);if(!t)return;const i=initRedundancy(t),r={config:t,redundancy:i};redundancyCache[e]=r}return redundancyCache[e]}function sendAPIQuery(e,t,i){let r,o;if(typeof e=="string"){const l=getAPIModule(e);if(!l)return i(void 0,424),emptyCallback$1;o=l.send;const d=getRedundancyCache(e);d&&(r=d.redundancy)}else{const l=createAPIConfig(e);if(l){r=initRedundancy(l);const d=e.resources?e.resources[0]:"",n=getAPIModule(d);n&&(o=n.send)}}return!r||!o?(i(void 0,424),emptyCallback$1):r.query(t,o,i)().abort}function emptyCallback(){}function loadedNewIcons(e){e.iconsLoaderFlag||(e.iconsLoaderFlag=!0,setTimeout(()=>{e.iconsLoaderFlag=!1,updateCallbacks(e)}))}function checkIconNamesForAPI(e){const t=[],i=[];return e.forEach(r=>{(r.match(matchIconName)?t:i).push(r)}),{valid:t,invalid:i}}function parseLoaderResponse(e,t,i){function r(){const o=e.pendingIcons;t.forEach(l=>{o&&o.delete(l),e.icons[l]||e.missing.add(l)})}if(i&&typeof i=="object")try{if(!addIconSet(e,i).length){r();return}}catch(o){console.error(o)}r(),loadedNewIcons(e)}function parsePossiblyAsyncResponse(e,t){e instanceof Promise?e.then(i=>{t(i)}).catch(()=>{t(null)}):t(e)}function loadNewIcons(e,t){e.iconsToLoad?e.iconsToLoad=e.iconsToLoad.concat(t).sort():e.iconsToLoad=t,e.iconsQueueFlag||(e.iconsQueueFlag=!0,setTimeout(()=>{e.iconsQueueFlag=!1;const{provider:i,prefix:r}=e,o=e.iconsToLoad;if(delete e.iconsToLoad,!o||!o.length)return;const l=e.loadIcon;if(e.loadIcons&&(o.length>1||!l)){parsePossiblyAsyncResponse(e.loadIcons(o,r,i),I=>{parseLoaderResponse(e,o,I)});return}if(l){o.forEach(I=>{const z=l(I,r,i);parsePossiblyAsyncResponse(z,$=>{const k=$?{prefix:r,icons:{[I]:$}}:null;parseLoaderResponse(e,[I],k)})});return}const{valid:d,invalid:n}=checkIconNamesForAPI(o);if(n.length&&parseLoaderResponse(e,n,null),!d.length)return;const S=r.match(matchIconName)?getAPIModule(i):null;if(!S){parseLoaderResponse(e,d,null);return}S.prepare(i,r,d).forEach(I=>{sendAPIQuery(i,I,z=>{parseLoaderResponse(e,I.icons,z)})})}))}const loadIcons=(e,t)=>{const i=listToIcons(e,!0,allowSimpleNames()),r=sortIcons(i);if(!r.pending.length){let S=!0;return t&&setTimeout(()=>{S&&t(r.loaded,r.missing,r.pending,emptyCallback)}),()=>{S=!1}}const o=Object.create(null),l=[];let d,n;return r.pending.forEach(S=>{const{provider:C,prefix:I}=S;if(I===n&&C===d)return;d=C,n=I,l.push(getStorage(C,I));const z=o[C]||(o[C]=Object.create(null));z[I]||(z[I]=[])}),r.pending.forEach(S=>{const{provider:C,prefix:I,name:z}=S,$=getStorage(C,I),k=$.pendingIcons||($.pendingIcons=new Set);k.has(z)||(k.add(z),o[C][I].push(z))}),l.forEach(S=>{const C=o[S.provider][S.prefix];C.length&&loadNewIcons(S,C)}),t?storeCallback(t,r,l):emptyCallback},loadIcon$1=e=>new Promise((t,i)=>{const r=typeof e=="string"?stringToIcon(e,!0):e;if(!r){i(e);return}loadIcons([r||e],o=>{if(o.length&&r){const l=getIconData(r);if(l){t({...defaultIconProps$1,...l});return}}i(e)})});function setCustomIconsLoader(e,t,i){getStorage("",t).loadIcons=e}function mergeCustomisations(e,t){const i={...e};for(const r in t){const o=t[r],l=typeof o;r in defaultIconSizeCustomisations$1?(o===null||o&&(l==="string"||l==="number"))&&(i[r]=o):l===typeof i[r]&&(i[r]=r==="rotate"?o%4:o)}return i}const separator=/[\s,]+/;function flipFromString(e,t){t.split(separator).forEach(i=>{switch(i.trim()){case"horizontal":e.hFlip=!0;break;case"vertical":e.vFlip=!0;break}})}function rotateFromString(e,t=0){const i=e.replace(/^-?[0-9.]*/,"");function r(o){for(;o<0;)o+=4;return o%4}if(i===""){const o=parseInt(e);return isNaN(o)?0:r(o)}else if(i!==e){let o=0;switch(i){case"%":o=25;break;case"deg":o=90}if(o){let l=parseFloat(e.slice(0,e.length-i.length));return isNaN(l)?0:(l=l/o,l%1===0?r(l):0)}}return t}function iconToHTML$1(e,t){let i=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const r in t)i+=" "+r+'="'+t[r]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+i+">"+e+"</svg>"}function encodeSVGforURL$1(e){return e.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function svgToData$1(e){return"data:image/svg+xml,"+encodeSVGforURL$1(e)}function svgToURL$1(e){return'url("'+svgToData$1(e)+'")'}const defaultExtendedIconCustomisations={...defaultIconCustomisations$1,inline:!1},svgDefaults={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},commonProps={display:"inline-block"},monotoneProps={backgroundColor:"currentColor"},coloredProps={backgroundColor:"transparent"},propsToAdd={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},propsToAddTo={webkitMask:monotoneProps,mask:monotoneProps,background:coloredProps};for(const e in propsToAddTo){const t=propsToAddTo[e];for(const i in propsToAdd)t[e+i]=propsToAdd[i]}const customisationAliases={};["horizontal","vertical"].forEach(e=>{const t=e.slice(0,1)+"Flip";customisationAliases[e+"-flip"]=t,customisationAliases[e.slice(0,1)+"-flip"]=t,customisationAliases[e+"Flip"]=t});function fixSize(e){return e+(e.match(/^[-0-9.]+$/)?"px":"")}const render=(e,t)=>{const i=mergeCustomisations(defaultExtendedIconCustomisations,t),r={...svgDefaults},o=t.mode||"svg",l={},d=t.style,n=typeof d=="object"&&!(d instanceof Array)?d:{};for(let ie in t){const ue=t[ie];if(ue!==void 0)switch(ie){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":i[ie]=ue===!0||ue==="true"||ue===1;break;case"flip":typeof ue=="string"&&flipFromString(i,ue);break;case"color":l.color=ue;break;case"rotate":typeof ue=="string"?i[ie]=rotateFromString(ue):typeof ue=="number"&&(i[ie]=ue);break;case"ariaHidden":case"aria-hidden":ue!==!0&&ue!=="true"&&delete r["aria-hidden"];break;default:{const ne=customisationAliases[ie];ne?(ue===!0||ue==="true"||ue===1)&&(i[ne]=!0):defaultExtendedIconCustomisations[ie]===void 0&&(r[ie]=ue)}}}const S=iconToSVG$1(e,i),C=S.attributes;if(i.inline&&(l.verticalAlign="-0.125em"),o==="svg"){r.style={...l,...n},Object.assign(r,C);let ie=0,ue=t.id;return typeof ue=="string"&&(ue=ue.replace(/-/g,"_")),r.innerHTML=replaceIDs(S.body,ue?()=>ue+"ID"+ie++:"iconifyVue"),h("svg",r)}const{body:I,width:z,height:$}=e,k=o==="mask"||(o==="bg"?!1:I.indexOf("currentColor")!==-1),Y=iconToHTML$1(I,{...C,width:z+"",height:$+""});return r.style={...l,"--svg":svgToURL$1(Y),width:fixSize(C.width),height:fixSize(C.height),...commonProps,...k?monotoneProps:coloredProps,...n},h("span",r)};allowSimpleNames(!0);setAPIModule("",fetchAPIModule);if(typeof document<"u"&&typeof window<"u"){const e=window;if(e.IconifyPreload!==void 0){const t=e.IconifyPreload,i="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(r=>{try{(typeof r!="object"||r===null||r instanceof Array||typeof r.icons!="object"||typeof r.prefix!="string"||!addCollection(r))&&console.error(i)}catch{console.error(i)}})}if(e.IconifyProviders!==void 0){const t=e.IconifyProviders;if(typeof t=="object"&&t!==null)for(let i in t){const r="IconifyProviders["+i+"] is invalid.";try{const o=t[i];if(typeof o!="object"||!o||o.resources===void 0)continue;addAPIProvider(i,o)||console.error(r)}catch{console.error(r)}}}}const emptyIcon={...defaultIconProps$1,body:""},Icon=defineComponent((e,{emit:t})=>{const i=ref(null);function r(){var C,I;i.value&&((I=(C=i.value).abort)==null||I.call(C),i.value=null)}const o=ref(!!e.ssr),l=ref(""),d=shallowRef(null);function n(){const C=e.icon;if(typeof C=="object"&&C!==null&&typeof C.body=="string")return l.value="",{data:C};let I;if(typeof C!="string"||(I=stringToIcon(C,!1,!0))===null)return null;let z=getIconData(I);if(!z){const Y=i.value;return(!Y||Y.name!==C)&&(z===null?i.value={name:C}:i.value={name:C,abort:loadIcons([I],S)}),null}r(),l.value!==C&&(l.value=C,nextTick(()=>{t("load",C)}));const $=e.customise;if($){z=Object.assign({},z);const Y=$(z.body,I.name,I.prefix,I.provider);typeof Y=="string"&&(z.body=Y)}const k=["iconify"];return I.prefix!==""&&k.push("iconify--"+I.prefix),I.provider!==""&&k.push("iconify--"+I.provider),{data:z,classes:k}}function S(){var I;const C=n();C?C.data!==((I=d.value)==null?void 0:I.data)&&(d.value=C):d.value=null}return o.value?S():onMounted(()=>{o.value=!0,S()}),watch$1(()=>e.icon,S),onUnmounted(r),()=>{const C=d.value;if(!C)return render(emptyIcon,e);let I=e;return C.classes&&(I={...e,class:C.classes.join(" ")}),render({...defaultIconProps$1,...C.data},I)}},{props:["icon","mode","ssr","width","height","style","color","inline","rotate","hFlip","horizontalFlip","vFlip","verticalFlip","flip","id","ariaHidden","customise","title"],emits:["load"]}),_api={getAPIConfig,setAPIModule,sendAPIQuery,setFetch,getFetch,listAPIProviders},plugin_MeUvTuoKUi51yb_kBguab6hdcExVXeTtZtTg9TZZBB8=defineNuxtPlugin({name:"@nuxt/icon",setup(){var o,l;const e=useRuntimeConfig(),t=useAppConfig().icon;_api.setFetch($fetch.native);const i=[];if(t.provider==="server"){const d=((l=(o=e.app)==null?void 0:o.baseURL)==null?void 0:l.replace(/\/$/,""))??"";i.push(d+(t.localApiEndpoint||"/api/_nuxt_icon")),(t.fallbackToApi===!0||t.fallbackToApi==="client-only")&&i.push(t.iconifyApiEndpoint)}else t.provider==="none"?_api.setFetch(()=>Promise.resolve(new Response)):i.push(t.iconifyApiEndpoint);async function r(d,n){try{const S=await $fetch(i[0]+"/"+n+".json",{query:{icons:d.join(",")}});if(!S||S.prefix!==n||!S.icons)throw new Error("Invalid data"+JSON.stringify(S));return S}catch(S){return console.error("Failed to load custom icons",S),null}}addAPIProvider("",{resources:i});for(const d of t.customCollections||[])d&&setCustomIconsLoader(r,d)}});let F=!1;const q=[],be=e=>new Promise((t,i)=>{if(typeof window>"u"||(window.storyblokRegisterEvent=o=>{if(window.location===window.parent.location){console.warn("You are not in Draft Mode or in the Visual Editor.");return}F?o():q.push(o)},document.getElementById("storyblok-javascript-bridge")))return;const r=document.createElement("script");r.async=!0,r.src=e,r.id="storyblok-javascript-bridge",r.onerror=o=>i(o),r.onload=o=>{q.forEach(l=>l()),F=!0,t(o)},document.getElementsByTagName("head")[0].appendChild(r)});var ke=Object.defineProperty,ve=(e,t,i)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,m=(e,t,i)=>ve(e,typeof t!="symbol"?t+"":t,i);class $e extends Error{constructor(t){super(t),this.name="AbortError"}}function Te(e,t,i){if(!Number.isFinite(t))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(i))throw new TypeError("Expected `interval` to be a finite number");const r=[];let o=[],l=0,d=!1;const n=async()=>{l++;const C=r.shift();if(C)try{const z=await e(...C.args);C.resolve(z)}catch(z){C.reject(z)}const I=setTimeout(()=>{l--,r.length>0&&n(),o=o.filter(z=>z!==I)},i);o.includes(I)||o.push(I)},S=(...C)=>d?Promise.reject(new Error("Throttled function is already aborted and not accepting new promises")):new Promise((I,z)=>{r.push({resolve:I,reject:z,args:C}),l<t&&n()});return S.abort=()=>{d=!0,o.forEach(clearTimeout),o=[],r.forEach(C=>C.reject(()=>new $e("Throttle function aborted"))),r.length=0},S}class N{constructor(){m(this,"isCDNUrl",(t="")=>t.includes("/cdn/")),m(this,"getOptionsPage",(t,i=25,r=1)=>({...t,per_page:i,page:r})),m(this,"delay",t=>new Promise(i=>setTimeout(i,t))),m(this,"arrayFrom",(t=0,i)=>Array.from({length:t},i)),m(this,"range",(t=0,i=t)=>{const r=Math.abs(i-t)||0,o=t<i?1:-1;return this.arrayFrom(r,(l,d)=>d*o+t)}),m(this,"asyncMap",async(t,i)=>Promise.all(t.map(i))),m(this,"flatMap",(t=[],i)=>t.map(i).reduce((r,o)=>[...r,...o],[])),m(this,"escapeHTML",function(t){const i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},r=/[&<>"']/g,o=new RegExp(r.source);return t&&o.test(t)?t.replace(r,l=>i[l]):t})}stringify(t,i,r){const o=[];for(const l in t){if(!Object.prototype.hasOwnProperty.call(t,l))continue;const d=t[l];if(d==null)continue;const n=r?"":encodeURIComponent(l);let S;typeof d=="object"?S=this.stringify(d,i?i+encodeURIComponent(`[${n}]`):n,Array.isArray(d)):S=`${i?i+encodeURIComponent(`[${n}]`):n}=${encodeURIComponent(d)}`,o.push(S)}return o.join("&")}getRegionURL(t){const i="api.storyblok.com",r="api-us.storyblok.com",o="app.storyblokchina.cn",l="api-ap.storyblok.com",d="api-ca.storyblok.com";switch(t){case"us":return r;case"cn":return o;case"ap":return l;case"ca":return d;default:return i}}}const we=function(e,t){const i={};for(const r in e){const o=e[r];t.includes(r)&&o!==null&&(i[r]=o)}return i},Re=e=>e==="email",_e=()=>({singleTag:"hr"}),Se=()=>({tag:"blockquote"}),Ee=()=>({tag:"ul"}),xe=e=>({tag:["pre",{tag:"code",attrs:e.attrs}]}),je=()=>({singleTag:"br"}),Ae=e=>({tag:`h${e.attrs.level}`}),Ie=e=>({singleTag:[{tag:"img",attrs:we(e.attrs,["src","alt","title"])}]}),Ce=()=>({tag:"li"}),Le=()=>({tag:"ol"}),Oe=()=>({tag:"p"}),Pe=e=>({tag:[{tag:"span",attrs:{"data-type":"emoji","data-name":e.attrs.name,emoji:e.attrs.emoji}}]}),Ne=()=>({tag:"b"}),Me=()=>({tag:"s"}),He=()=>({tag:"u"}),De=()=>({tag:"strong"}),Ue=()=>({tag:"code"}),Be=()=>({tag:"i"}),ze=e=>{if(!e.attrs)return{tag:""};const t=new N().escapeHTML,i={...e.attrs},{linktype:r="url"}=e.attrs;if(delete i.linktype,i.href&&(i.href=t(e.attrs.href||"")),Re(r)&&(i.href=`mailto:${i.href}`),i.anchor&&(i.href=`${i.href}#${i.anchor}`,delete i.anchor),i.custom){for(const o in i.custom)i[o]=i.custom[o];delete i.custom}return{tag:[{tag:"a",attrs:i}]}},Fe=e=>({tag:[{tag:"span",attrs:e.attrs}]}),qe=()=>({tag:"sub"}),Ve=()=>({tag:"sup"}),Ge=e=>({tag:[{tag:"span",attrs:e.attrs}]}),Ke=e=>{var t;return(t=e.attrs)!=null&&t.color?{tag:[{tag:"span",attrs:{style:`background-color:${e.attrs.color};`}}]}:{tag:""}},Je=e=>{var t;return(t=e.attrs)!=null&&t.color?{tag:[{tag:"span",attrs:{style:`color:${e.attrs.color}`}}]}:{tag:""}},Ye={nodes:{horizontal_rule:_e,blockquote:Se,bullet_list:Ee,code_block:xe,hard_break:je,heading:Ae,image:Ie,list_item:Ce,ordered_list:Le,paragraph:Oe,emoji:Pe},marks:{bold:Ne,strike:Me,underline:He,strong:De,code:Ue,italic:Be,link:ze,styled:Fe,subscript:qe,superscript:Ve,anchor:Ge,highlight:Ke,textStyle:Je}},We=function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},i=/[&<>"']/g,r=new RegExp(i.source);return e&&r.test(e)?e.replace(i,o=>t[o]):e};let V=!1;class M{constructor(t){m(this,"marks"),m(this,"nodes"),t||(t=Ye),this.marks=t.marks||[],this.nodes=t.nodes||[]}addNode(t,i){this.nodes[t]=i}addMark(t,i){this.marks[t]=i}render(t,i={optimizeImages:!1},r=!0){if(!V&&r&&(console.warn("Warning : The RichTextResolver class is deprecated and will be removed in the next major release. Please use the `@storyblok/richtext` package instead. https://github.com/storyblok/richtext/"),V=!0),t&&t.content&&Array.isArray(t.content)){let o="";return t.content.forEach(l=>{o+=this.renderNode(l)}),i.optimizeImages?this.optimizeImages(o,i.optimizeImages):o}return console.warn(`The render method must receive an Object with a "content" field.
      The "content" field must be an array of nodes as the type ISbRichtext.
      ISbRichtext:
        content?: ISbRichtext[]
        marks?: ISbRichtext[]
        attrs?: any
        text?: string
        type: string
        
        Example:
        {
          content: [
            {
              content: [
                {
                  text: 'Hello World',
                  type: 'text'
                }
              ],
              type: 'paragraph'
            }
          ],
          type: 'doc'
        }`),""}optimizeImages(t,i){let r=0,o=0,l="",d="";typeof i!="boolean"&&(typeof i.width=="number"&&i.width>0&&(l+=`width="${i.width}" `,r=i.width),typeof i.height=="number"&&i.height>0&&(l+=`height="${i.height}" `,o=i.height),(i.loading==="lazy"||i.loading==="eager")&&(l+=`loading="${i.loading}" `),typeof i.class=="string"&&i.class.length>0&&(l+=`class="${i.class}" `),i.filters&&(typeof i.filters.blur=="number"&&i.filters.blur>=0&&i.filters.blur<=100&&(d+=`:blur(${i.filters.blur})`),typeof i.filters.brightness=="number"&&i.filters.brightness>=-100&&i.filters.brightness<=100&&(d+=`:brightness(${i.filters.brightness})`),i.filters.fill&&(i.filters.fill.match(/[0-9A-F]{6}/gi)||i.filters.fill==="transparent")&&(d+=`:fill(${i.filters.fill})`),i.filters.format&&["webp","png","jpeg"].includes(i.filters.format)&&(d+=`:format(${i.filters.format})`),typeof i.filters.grayscale=="boolean"&&i.filters.grayscale&&(d+=":grayscale()"),typeof i.filters.quality=="number"&&i.filters.quality>=0&&i.filters.quality<=100&&(d+=`:quality(${i.filters.quality})`),i.filters.rotate&&[90,180,270].includes(i.filters.rotate)&&(d+=`:rotate(${i.filters.rotate})`),d.length>0&&(d=`/filters${d}`))),l.length>0&&(t=t.replace(/<img/g,`<img ${l.trim()}`));const n=r>0||o>0||d.length>0?`${r}x${o}${d}`:"";return t=t.replace(/a.storyblok.com\/f\/(\d+)\/([^.]+)\.(gif|jpg|jpeg|png|tif|bmp)/g,`a.storyblok.com/f/$1/$2.$3/m/${n}`),typeof i!="boolean"&&(i.sizes||i.srcset)&&(t=t.replace(/<img.*?src=["|'](.*?)["|']/g,S=>{var C,I;const z=S.match(/a.storyblok.com\/f\/(\d+)\/([^.]+)\.(gif|jpg|jpeg|png|tif|bmp)/g);if(z&&z.length>0){const $={srcset:(C=i.srcset)==null?void 0:C.map(Y=>{if(typeof Y=="number")return`//${z}/m/${Y}x0${d} ${Y}w`;if(typeof Y=="object"&&Y.length===2){let ie=0,ue=0;return typeof Y[0]=="number"&&(ie=Y[0]),typeof Y[1]=="number"&&(ue=Y[1]),`//${z}/m/${ie}x${ue}${d} ${ie}w`}return""}).join(", "),sizes:(I=i.sizes)==null?void 0:I.map(Y=>Y).join(", ")};let k="";return $.srcset&&(k+=`srcset="${$.srcset}" `),$.sizes&&(k+=`sizes="${$.sizes}" `),S.replace(/<img/g,`<img ${k.trim()}`)}return S})),t}renderNode(t){const i=[];t.marks&&t.marks.forEach(o=>{const l=this.getMatchingMark(o);l&&l.tag!==""&&i.push(this.renderOpeningTag(l.tag))});const r=this.getMatchingNode(t);return r&&r.tag&&i.push(this.renderOpeningTag(r.tag)),t.content?t.content.forEach(o=>{i.push(this.renderNode(o))}):t.text?i.push(We(t.text)):r&&r.singleTag?i.push(this.renderTag(r.singleTag," /")):r&&r.html?i.push(r.html):t.type==="emoji"&&i.push(this.renderEmoji(t)),r&&r.tag&&i.push(this.renderClosingTag(r.tag)),t.marks&&t.marks.slice(0).reverse().forEach(o=>{const l=this.getMatchingMark(o);l&&l.tag!==""&&i.push(this.renderClosingTag(l.tag))}),i.join("")}renderTag(t,i){return t.constructor===String?`<${t}${i}>`:t.map(r=>{if(r.constructor===String)return`<${r}${i}>`;{let o=`<${r.tag}`;if(r.attrs){for(const l in r.attrs)if(Object.prototype.hasOwnProperty.call(r.attrs,l)){const d=r.attrs[l];d!==null&&(o+=` ${l}="${d}"`)}}return`${o}${i}>`}}).join("")}renderOpeningTag(t){return this.renderTag(t,"")}renderClosingTag(t){return t.constructor===String?`</${t}>`:t.slice(0).reverse().map(i=>i.constructor===String?`</${i}>`:`</${i.tag}>`).join("")}getMatchingNode(t){const i=this.nodes[t.type];if(typeof i=="function")return i(t)}getMatchingMark(t){const i=this.marks[t.type];if(typeof i=="function")return i(t)}renderEmoji(t){if(t.attrs.emoji)return t.attrs.emoji;const i=[{tag:"img",attrs:{src:t.attrs.fallbackImage,draggable:"false",loading:"lazy",align:"absmiddle"}}];return this.renderTag(i," /")}}class Xe{constructor(t){m(this,"baseURL"),m(this,"timeout"),m(this,"headers"),m(this,"responseInterceptor"),m(this,"fetch"),m(this,"ejectInterceptor"),m(this,"url"),m(this,"parameters"),m(this,"fetchOptions"),this.baseURL=t.baseURL,this.headers=t.headers||new Headers,this.timeout=t!=null&&t.timeout?t.timeout*1e3:0,this.responseInterceptor=t.responseInterceptor,this.fetch=(...i)=>t.fetch?t.fetch(...i):fetch(...i),this.ejectInterceptor=!1,this.url="",this.parameters={},this.fetchOptions={}}get(t,i){return this.url=t,this.parameters=i,this._methodHandler("get")}post(t,i){return this.url=t,this.parameters=i,this._methodHandler("post")}put(t,i){return this.url=t,this.parameters=i,this._methodHandler("put")}delete(t,i){return this.url=t,this.parameters=i??{},this._methodHandler("delete")}async _responseHandler(t){const i=[],r={data:{},headers:{},status:0,statusText:""};t.status!==204&&await t.json().then(o=>{r.data=o});for(const o of t.headers.entries())i[o[0]]=o[1];return r.headers={...i},r.status=t.status,r.statusText=t.statusText,r}async _methodHandler(t){let i=`${this.baseURL}${this.url}`,r=null;if(t==="get"){const S=new N;i=`${this.baseURL}${this.url}?${S.stringify(this.parameters)}`}else r=JSON.stringify(this.parameters);const o=new URL(i),l=new AbortController,{signal:d}=l;let n;this.timeout&&(n=setTimeout(()=>l.abort(),this.timeout));try{const S=await this.fetch(`${o}`,{method:t,headers:this.headers,body:r,signal:d,...this.fetchOptions});this.timeout&&clearTimeout(n);const C=await this._responseHandler(S);return this.responseInterceptor&&!this.ejectInterceptor?this._statusHandler(this.responseInterceptor(C)):this._statusHandler(C)}catch(S){return{message:S}}}setFetchOptions(t={}){Object.keys(t).length>0&&"method"in t&&delete t.method,this.fetchOptions={...t}}eject(){this.ejectInterceptor=!0}_statusHandler(t){const i=/20[0-6]/g;return new Promise((r,o)=>{if(i.test(`${t.status}`))return r(t);const l={message:t.statusText,status:t.status,response:Array.isArray(t.data)?t.data[0]:t.data.error||t.data.slug};o(l)})}}const G="SB-Agent",U={defaultAgentName:"SB-JS-CLIENT",defaultAgentVersion:"SB-Agent-Version",packageVersion:"6.0.0"};let L={};const x={};class Qe{constructor(t,i){m(this,"client"),m(this,"maxRetries"),m(this,"retriesDelay"),m(this,"throttle"),m(this,"accessToken"),m(this,"cache"),m(this,"helpers"),m(this,"resolveCounter"),m(this,"relations"),m(this,"links"),m(this,"richTextResolver"),m(this,"resolveNestedRelations"),m(this,"stringifiedStoriesCache");let r=t.endpoint||i;if(!r){const d=new N().getRegionURL,n=t.https===!1?"http":"https";t.oauthToken?r=`${n}://${d(t.region)}/v1`:r=`${n}://${d(t.region)}/v2`}const o=new Headers;o.set("Content-Type","application/json"),o.set("Accept","application/json"),t.headers&&(t.headers.constructor.name==="Headers"?t.headers.entries().toArray():Object.entries(t.headers)).forEach(([d,n])=>{o.set(d,n)}),o.has(G)||(o.set(G,U.defaultAgentName),o.set(U.defaultAgentVersion,U.packageVersion));let l=5;t.oauthToken&&(o.set("Authorization",t.oauthToken),l=3),t.rateLimit&&(l=t.rateLimit),t.richTextSchema?this.richTextResolver=new M(t.richTextSchema):this.richTextResolver=new M,t.componentResolver&&this.setComponentResolver(t.componentResolver),this.maxRetries=t.maxRetries||10,this.retriesDelay=300,this.throttle=Te(this.throttledRequest.bind(this),l,1e3),this.accessToken=t.accessToken||"",this.relations={},this.links={},this.cache=t.cache||{clear:"manual"},this.helpers=new N,this.resolveCounter=0,this.resolveNestedRelations=t.resolveNestedRelations||!0,this.stringifiedStoriesCache={},this.client=new Xe({baseURL:r,timeout:t.timeout||0,headers:o,responseInterceptor:t.responseInterceptor,fetch:t.fetch})}setComponentResolver(t){this.richTextResolver.addNode("blok",i=>{let r="";return i.attrs.body&&i.attrs.body.forEach(o=>{r+=t(o.component,o)}),{html:r}})}parseParams(t){return t.token||(t.token=this.getToken()),t.cv||(t.cv=x[t.token]),Array.isArray(t.resolve_relations)&&(t.resolve_relations=t.resolve_relations.join(",")),typeof t.resolve_relations<"u"&&(t.resolve_level=2),t}factoryParamOptions(t,i){return this.helpers.isCDNUrl(t)?this.parseParams(i):i}makeRequest(t,i,r,o,l){const d=this.factoryParamOptions(t,this.helpers.getOptionsPage(i,r,o));return this.cacheResponse(t,d,void 0,l)}get(t,i,r){i||(i={});const o=`/${t}`,l=this.factoryParamOptions(o,i);return this.cacheResponse(o,l,void 0,r)}async getAll(t,i,r,o){const l=(i==null?void 0:i.per_page)||25,d=`/${t}`.replace(/\/$/,""),n=r??d.substring(d.lastIndexOf("/")+1),S=1,C=await this.makeRequest(d,i,l,S,o),I=C.total?Math.ceil(C.total/l):1,z=await this.helpers.asyncMap(this.helpers.range(S,I),$=>this.makeRequest(d,i,l,$+1,o));return this.helpers.flatMap([C,...z],$=>Object.values($.data[n]))}post(t,i,r){const o=`/${t}`;return Promise.resolve(this.throttle("post",o,i,r))}put(t,i,r){const o=`/${t}`;return Promise.resolve(this.throttle("put",o,i,r))}delete(t,i,r){i||(i={});const o=`/${t}`;return Promise.resolve(this.throttle("delete",o,i,r))}getStories(t,i){return this._addResolveLevel(t),this.get("cdn/stories",t,i)}getStory(t,i,r){return this._addResolveLevel(i),this.get(`cdn/stories/${t}`,i,r)}getToken(){return this.accessToken}ejectInterceptor(){this.client.eject()}_addResolveLevel(t){typeof t.resolve_relations<"u"&&(t.resolve_level=2)}_cleanCopy(t){return JSON.parse(JSON.stringify(t))}_insertLinks(t,i,r){const o=t[i];o&&o.fieldtype==="multilink"&&o.linktype==="story"&&typeof o.id=="string"&&this.links[r][o.id]?o.story=this._cleanCopy(this.links[r][o.id]):o&&o.linktype==="story"&&typeof o.uuid=="string"&&this.links[r][o.uuid]&&(o.story=this._cleanCopy(this.links[r][o.uuid]))}getStoryReference(t,i){return this.relations[t][i]?JSON.parse(this.stringifiedStoriesCache[i]||JSON.stringify(this.relations[t][i])):i}_resolveField(t,i,r){const o=t[i];typeof o=="string"?t[i]=this.getStoryReference(r,o):Array.isArray(o)&&(t[i]=o.map(l=>this.getStoryReference(r,l)).filter(Boolean))}_insertRelations(t,i,r,o){if(Array.isArray(r)?r.find(d=>d.endsWith(`.${i}`)):r.endsWith(`.${i}`)){this._resolveField(t,i,o);return}const l=t.component?`${t.component}.${i}`:i;(Array.isArray(r)?r.includes(l):r===l)&&this._resolveField(t,i,o)}iterateTree(t,i,r){const o=(l,d="")=>{if(!(!l||l._stopResolving)){if(Array.isArray(l))l.forEach((n,S)=>o(n,`${d}[${S}]`));else if(typeof l=="object")for(const n in l){const S=d?`${d}.${n}`:n;(l.component&&l._uid||l.type==="link")&&(this._insertRelations(l,n,i,r),this._insertLinks(l,n,r)),o(l[n],S)}}};o(t.content)}async resolveLinks(t,i,r){let o=[];if(t.link_uuids){const l=t.link_uuids.length,d=[],n=50;for(let S=0;S<l;S+=n){const C=Math.min(l,S+n);d.push(t.link_uuids.slice(S,C))}for(let S=0;S<d.length;S++)(await this.getStories({per_page:n,language:i.language,version:i.version,starts_with:i.starts_with,by_uuids:d[S].join(",")})).data.stories.forEach(C=>{o.push(C)})}else o=t.links;o.forEach(l=>{this.links[r][l.uuid]={...l,_stopResolving:!0}})}async resolveRelations(t,i,r){let o=[];if(t.rel_uuids){const l=t.rel_uuids.length,d=[],n=50;for(let S=0;S<l;S+=n){const C=Math.min(l,S+n);d.push(t.rel_uuids.slice(S,C))}for(let S=0;S<d.length;S++)(await this.getStories({per_page:n,language:i.language,version:i.version,starts_with:i.starts_with,by_uuids:d[S].join(","),excluding_fields:i.excluding_fields})).data.stories.forEach(C=>{o.push(C)});o.length>0&&(t.rels=o,delete t.rel_uuids)}else o=t.rels;o&&o.length>0&&o.forEach(l=>{this.relations[r][l.uuid]={...l,_stopResolving:!0}})}async resolveStories(t,i,r){var o,l;let d=[];if(this.links[r]={},this.relations[r]={},typeof i.resolve_relations<"u"&&i.resolve_relations.length>0&&(typeof i.resolve_relations=="string"&&(d=i.resolve_relations.split(",")),await this.resolveRelations(t,i,r)),i.resolve_links&&["1","story","url","link"].includes(i.resolve_links)&&((o=t.links)!=null&&o.length||(l=t.link_uuids)!=null&&l.length)&&await this.resolveLinks(t,i,r),this.resolveNestedRelations)for(const n in this.relations[r])this.iterateTree(this.relations[r][n],d,r);t.story?this.iterateTree(t.story,d,r):t.stories.forEach(n=>{this.iterateTree(n,d,r)}),this.stringifiedStoriesCache={},delete this.links[r],delete this.relations[r]}async cacheResponse(t,i,r,o){const l=this.helpers.stringify({url:t,params:i}),d=this.cacheProvider();if(i.version==="published"&&t!=="/cdn/spaces/me"){const n=await d.get(l);if(n)return Promise.resolve(n)}return new Promise(async(n,S)=>{var C;try{const I=await this.throttle("get",t,i,o);if(I.status!==200)return S(I);let z={data:I.data,headers:I.headers};if((C=I.headers)!=null&&C["per-page"]&&(z=Object.assign({},z,{perPage:I.headers["per-page"]?Number.parseInt(I.headers["per-page"]):0,total:I.headers["per-page"]?Number.parseInt(I.headers.total):0})),z.data.story||z.data.stories){const k=this.resolveCounter=++this.resolveCounter%1e3;await this.resolveStories(z.data,i,`${k}`)}i.version==="published"&&t!=="/cdn/spaces/me"&&await d.set(l,z);const $=this.cache.clear==="onpreview"&&i.version==="draft"||this.cache.clear==="auto";return i.token&&z.data.cv&&($&&x[i.token]&&x[i.token]!==z.data.cv&&await this.flushCache(),x[i.token]=z.data.cv),n(z)}catch(I){if(I.response&&I.status===429&&(r=typeof r>"u"?0:r+1,r<this.maxRetries))return console.log(`Hit rate limit. Retrying in ${this.retriesDelay/1e3} seconds.`),await this.helpers.delay(this.retriesDelay),this.cacheResponse(t,i,r).then(n).catch(S);S(I)}})}throttledRequest(t,i,r,o){return this.client.setFetchOptions(o),this.client[t](i,r)}cacheVersions(){return x}cacheVersion(){return x[this.accessToken]}setCacheVersion(t){this.accessToken&&(x[this.accessToken]=t)}clearCacheVersion(){this.accessToken&&(x[this.accessToken]=0)}cacheProvider(){switch(this.cache.type){case"memory":return{get(t){return Promise.resolve(L[t])},getAll(){return Promise.resolve(L)},set(t,i){return L[t]=i,Promise.resolve(void 0)},flush(){return L={},Promise.resolve(void 0)}};case"custom":if(this.cache.custom)return this.cache.custom;default:return{get(){return Promise.resolve()},getAll(){return Promise.resolve(void 0)},set(){return Promise.resolve(void 0)},flush(){return Promise.resolve(void 0)}}}}async flushCache(){return await this.cacheProvider().flush(),this.clearCacheVersion(),this}}const gt=(e={})=>{const{apiOptions:t}=e;if(!t||!t.accessToken){console.error("You need to provide an access token to interact with Storyblok API. Read https://www.storyblok.com/docs/api/content-delivery#topics/authentication");return}return{storyblokApi:new Qe(t)}},Ze=e=>{if(typeof e!="object"||typeof e._editable>"u")return{};try{const t=JSON.parse(e._editable.replace(/^<!--#storyblok#/,"").replace(/-->$/,""));return t?{"data-blok-c":JSON.stringify(t),"data-blok-uid":`${t.id}-${t.uid}`}:{}}catch{return{}}};function et(e,t){if(!t)return{src:e,attrs:{}};let i=0,r=0;const o={},l=[];function d(S,C,I,z,$){typeof S!="number"||S<=C||S>=I?console.warn(`[StoryblokRichText] - ${z.charAt(0).toUpperCase()+z.slice(1)} value must be a number between ${C} and ${I} (inclusive)`):$.push(`${z}(${S})`)}if(typeof t=="object"){if(typeof t.width=="number"&&t.width>0?(o.width=t.width,i=t.width):console.warn("[StoryblokRichText] - Width value must be a number greater than 0"),t.height&&typeof t.height=="number"&&t.height>0?(o.height=t.height,r=t.height):console.warn("[StoryblokRichText] - Height value must be a number greater than 0"),t.loading&&["lazy","eager"].includes(t.loading)&&(o.loading=t.loading),t.class&&(o.class=t.class),t.filters){const{filters:S}=t||{},{blur:C,brightness:I,fill:z,format:$,grayscale:k,quality:Y,rotate:ie}=S||{};C&&d(C,0,100,"blur",l),Y&&d(Y,0,100,"quality",l),I&&d(I,0,100,"brightness",l),z&&l.push(`fill(${z})`),k&&l.push("grayscale()"),ie&&[0,90,180,270].includes(t.filters.rotate||0)&&l.push(`rotate(${ie})`),$&&["webp","png","jpeg"].includes($)&&l.push(`format(${$})`)}t.srcset&&(o.srcset=t.srcset.map(S=>{if(typeof S=="number")return`${e}/m/${S}x0/${l.length>0?`filters:${l.join(":")}`:""} ${S}w`;if(Array.isArray(S)&&S.length===2){const[C,I]=S;return`${e}/m/${C}x${I}/${l.length>0?`filters:${l.join(":")}`:""} ${C}w`}else{console.warn("[StoryblokRichText] - srcset entry must be a number or a tuple of two numbers");return}}).join(", ")),t.sizes&&(o.sizes=t.sizes.join(", "))}let n=`${e}/m/`;return i>0&&r>0&&(n=`${n}${i}x${r}/`),l.length>0&&(n=`${n}filters:${l.join(":")}`),{src:n,attrs:o}}var v=(e=>(e.DOCUMENT="doc",e.HEADING="heading",e.PARAGRAPH="paragraph",e.QUOTE="blockquote",e.OL_LIST="ordered_list",e.UL_LIST="bullet_list",e.LIST_ITEM="list_item",e.CODE_BLOCK="code_block",e.HR="horizontal_rule",e.BR="hard_break",e.IMAGE="image",e.EMOJI="emoji",e.COMPONENT="blok",e.TABLE="table",e.TABLE_ROW="tableRow",e.TABLE_CELL="tableCell",e.TABLE_HEADER="tableHeader",e))(v||{}),_=(e=>(e.BOLD="bold",e.STRONG="strong",e.STRIKE="strike",e.UNDERLINE="underline",e.ITALIC="italic",e.CODE="code",e.LINK="link",e.ANCHOR="anchor",e.STYLED="styled",e.SUPERSCRIPT="superscript",e.SUBSCRIPT="subscript",e.TEXT_STYLE="textStyle",e.HIGHLIGHT="highlight",e))(_||{}),Z=(e=>(e.TEXT="text",e))(Z||{}),j=(e=>(e.URL="url",e.STORY="story",e.ASSET="asset",e.EMAIL="email",e))(j||{});const tt=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],rt=(e={})=>Object.keys(e).map(t=>`${t}="${e[t]}"`).join(" "),st=(e={})=>Object.keys(e).map(t=>`${t}: ${e[t]}`).join("; ");function ot(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const O=e=>Object.fromEntries(Object.entries(e).filter(([t,i])=>i!==void 0));function K(e,t={},i){const r=rt(t),o=r?`${e} ${r}`:e,l=Array.isArray(i)?i.join(""):i||"";if(e){if(tt.includes(e))return`<${o}>`}else return l;return`<${o}>${l}</${e}>`}function nt(e={}){const t=new Map,{renderFn:i=K,textFn:r=ot,resolvers:o={},optimizeImages:l=!1,keyedResolvers:d=!1}=e,n=i!==K,S=()=>({render:(Zt,Ht={},It)=>{if(d&&Zt){const Yt=t.get(Zt)||0;t.set(Zt,Yt+1),Ht.key=`${Zt}-${Yt}`}return i(Zt,Ht,It)}}),C=Zt=>(Ht,It)=>{const Yt=Ht.attrs||{};return It.render(Zt,Yt,Ht.children||null)},I=(Zt,Ht)=>{const{src:It,alt:Yt,title:ri,srcset:ei,sizes:Ct}=Zt.attrs||{};let Ut=It,Mt={};if(l){const{src:jt,attrs:mi}=et(It,l);Ut=jt,Mt=mi}const $t={src:Ut,alt:Yt,title:ri,srcset:ei,sizes:Ct,...Mt};return Ht.render("img",O($t))},z=(Zt,Ht)=>{const{level:It,...Yt}=Zt.attrs||{};return Ht.render(`h${It}`,Yt,Zt.children)},$=(Zt,Ht)=>{var It,Yt,ri,ei;const Ct=Ht.render("img",{src:(It=Zt.attrs)==null?void 0:It.fallbackImage,alt:(Yt=Zt.attrs)==null?void 0:Yt.alt,style:"width: 1.25em; height: 1.25em; vertical-align: text-top",draggable:"false",loading:"lazy"});return Ht.render("span",{"data-type":"emoji","data-name":(ri=Zt.attrs)==null?void 0:ri.name,"data-emoji":(ei=Zt.attrs)==null?void 0:ei.emoji},Ct)},k=(Zt,Ht)=>Ht.render("pre",Zt.attrs||{},Ht.render("code",{},Zt.children||"")),Y=(Zt,Ht=!1)=>({text:It,attrs:Yt},ri)=>{const{class:ei,id:Ct,...Ut}=Yt||{},Mt=Ht?{class:ei,id:Ct,style:st(Ut)||void 0}:Yt||{};return ri.render(Zt,O(Mt),It)},ie=Zt=>Lt(Zt),ue=Zt=>{const{marks:Ht,...It}=Zt;if("text"in Zt){if(Ht)return Ht.reduce((ri,ei)=>ie({...ei,text:ri}),ie({...It,children:It.children}));const Yt=Zt.attrs||{};if(d){const ri=t.get("txt")||0;t.set("txt",ri+1),Yt.key=`txt-${ri}`}return r(It.text,Yt)}return""},ne=(Zt,Ht)=>{const{linktype:It,href:Yt,anchor:ri,...ei}=Zt.attrs||{};let Ct="";switch(It){case j.ASSET:case j.URL:Ct=Yt;break;case j.EMAIL:Ct=`mailto:${Yt}`;break;case j.STORY:Ct=Yt,ri&&(Ct=`${Ct}#${ri}`);break;default:Ct=Yt;break}const Ut={...ei};return Ct&&(Ut.href=Ct),Ht.render("a",Ut,Zt.text)},se=(Zt,Ht)=>{var It,Yt;return console.warn("[StoryblokRichtText] - BLOK resolver is not available for vanilla usage"),Ht.render("span",{blok:(It=Zt==null?void 0:Zt.attrs)==null?void 0:It.body[0],id:(Yt=Zt.attrs)==null?void 0:Yt.id,style:"display: none"})},le=(Zt,Ht)=>{const It={},Yt=Ht.render("tbody",{},Zt.children);return Ht.render("table",It,Yt)},he=(Zt,Ht)=>{const It={};return Ht.render("tr",It,Zt.children)},me=(Zt,Ht)=>{const{colspan:It,rowspan:Yt,colwidth:ri,backgroundColor:ei,...Ct}=Zt.attrs||{},Ut={...Ct};It>1&&(Ut.colspan=It),Yt>1&&(Ut.rowspan=Yt);const Mt=[];return ri&&Mt.push(`width: ${ri}px;`),ei&&Mt.push(`background-color: ${ei};`),Mt.length>0&&(Ut.style=Mt.join(" ")),Ht.render("td",O(Ut),Zt.children)},ge=(Zt,Ht)=>{const{colspan:It,rowspan:Yt,colwidth:ri,backgroundColor:ei,...Ct}=Zt.attrs||{},Ut={...Ct};It>1&&(Ut.colspan=It),Yt>1&&(Ut.rowspan=Yt);const Mt=[];return ri&&Mt.push(`width: ${ri}px;`),ei&&Mt.push(`background-color: ${ei};`),Mt.length>0&&(Ut.style=Mt.join(" ")),Ht.render("th",O(Ut),Zt.children)},xt=new Map([[v.DOCUMENT,C("")],[v.HEADING,z],[v.PARAGRAPH,C("p")],[v.UL_LIST,C("ul")],[v.OL_LIST,C("ol")],[v.LIST_ITEM,C("li")],[v.IMAGE,I],[v.EMOJI,$],[v.CODE_BLOCK,k],[v.HR,C("hr")],[v.BR,C("br")],[v.QUOTE,C("blockquote")],[v.COMPONENT,se],[Z.TEXT,ue],[_.LINK,ne],[_.ANCHOR,ne],[_.STYLED,Y("span",!0)],[_.BOLD,Y("strong")],[_.TEXT_STYLE,Y("span",!0)],[_.ITALIC,Y("em")],[_.UNDERLINE,Y("u")],[_.STRIKE,Y("s")],[_.CODE,Y("code")],[_.SUPERSCRIPT,Y("sup")],[_.SUBSCRIPT,Y("sub")],[_.HIGHLIGHT,Y("mark")],[v.TABLE,le],[v.TABLE_ROW,he],[v.TABLE_CELL,me],[v.TABLE_HEADER,ge],...Object.entries(o).map(([Zt,Ht])=>[Zt,Ht])]);function Et(Zt){const Ht=xt.get(Zt.type);if(!Ht)return console.error("<Storyblok>",`No resolver found for node type ${Zt.type}`),"";const It=S();if(Zt.type==="text")return Ht(Zt,It);const Yt=Zt.content?Zt.content.map(Lt):void 0;return Ht({...Zt,children:Yt},It)}function Lt(Zt){return Zt.type==="doc"?n?Zt.content.map(Et):Zt.content.map(Et).join(""):Array.isArray(Zt)?Zt.map(Et):Et(Zt)}return{render:Lt}}let B,J="https://app.storyblok.com/f/storyblok-v2-latest.js";const at=(e,t,i={})=>{var r;const o=!(typeof window>"u")&&typeof window.storyblokRegisterEvent<"u",l=new URL((r=window.location)==null?void 0:r.href).searchParams.get("_storyblok"),d=l!==null&&+l===e;if(!(!o||!d)){if(!e){console.warn("Story ID is not defined. Please provide a valid ID.");return}window.storyblokRegisterEvent(()=>{new window.StoryblokBridge(i).on(["input","published","change"],n=>{var S;n&&(n.action==="input"&&((S=n.story)==null?void 0:S.id)===e?t(n.story):(n.action==="change"||n.action==="published")&&n.storyId===e&&window.location.reload())})})}},ee=(e,t)=>{e.addNode("blok",i=>{let r="";return i.attrs.body.forEach(o=>{r+=t(o.component,o)}),{html:r}})},it=(e={})=>{var t,i;const{bridge:r,accessToken:o,use:l=[],apiOptions:d={},richText:n={},bridgeUrl:S}=e;d.accessToken=d.accessToken||o;const C={bridge:r,apiOptions:d};let I={};l.forEach($=>{I={...I,...$(C)}}),S&&(J=S);const z=!(typeof window>"u")&&((i=(t=window.location)==null?void 0:t.search)==null?void 0:i.includes("_storyblok_tk"));return r!==!1&&z&&be(J),B=new M(n.schema),n.resolver&&ee(B,n.resolver),I},lt=e=>{var t;return!e||!((t=e==null?void 0:e.content)!=null&&t.some(i=>i.content||i.type==="blok"||i.type==="horizontal_rule"))},ft=(e,t,i)=>{let r=B;if(!r){console.error("Please initialize the Storyblok SDK before calling the renderRichText function");return}return lt(e)?"":r.render(e,{},!1)},te=defineComponent({__name:"StoryblokComponent",props:{blok:{}},setup(e,{expose:t}){const i=e,r=ref();t({value:r});const o=typeof resolveDynamicComponent(i.blok.component)!="string",l=inject("VueSDKOptions"),d=ref(i.blok.component);return!o&&l&&(l.enableFallbackComponent?(d.value=l.customFallbackComponent??"FallbackComponent",typeof resolveDynamicComponent(d.value)=="string"&&console.error(`Is the Fallback component "${d.value}" registered properly?`)):console.error(`Component could not be found for blok "${i.blok.component}"! Is it defined in main.ts as "app.component("${i.blok.component}", ${i.blok.component});"?`)),(n,S)=>(openBlock(),createBlock(resolveDynamicComponent(d.value),mergeProps$1({ref_key:"blokRef",ref:r},{...n.$props,...n.$attrs}),null,16))}}),ct=e=>{var t,i;return h(te,{blok:(t=e==null?void 0:e.attrs)==null?void 0:t.body[0],id:(i=e.attrs)==null?void 0:i.id},e.children)};function ht(e){const t={renderFn:h,textFn:createTextVNode,keyedResolvers:!0,resolvers:{[v.COMPONENT]:ct,...e.resolvers}};return nt(t)}const ut=defineComponent({__name:"StoryblokRichText",props:{doc:{},resolvers:{}},setup(e){const t=e,i=ref(),r=()=>i.value;return watch$1([()=>t.doc,()=>t.resolvers],([o,l])=>{const{render:d}=ht({resolvers:l??{}});i.value=d(o)},{immediate:!0,deep:!0}),(o,l)=>(openBlock(),createBlock(r))}}),dt={beforeMount(e,t){if(t.value){const i=Ze(t.value);Object.keys(i).length>0&&(e.setAttribute("data-blok-c",i["data-blok-c"]),e.setAttribute("data-blok-uid",i["data-blok-uid"]),e.classList.add("storyblok__outline"))}}},re=e=>{console.error(`You can't use ${e} if you're not loading apiPlugin. Please provide it on StoryblokVue initialization.
    `)};let A=null;const mt=()=>(A||re("useStoryblokApi"),A),bt={install(e,t={}){e.directive("editable",dt),e.component("StoryblokComponent",te),e.component("StoryblokRichText",ut),t.enableFallbackComponent&&!t.customFallbackComponent&&e.component("FallbackComponent",defineAsyncComponent(()=>__vitePreload(()=>import("./DnM4SRpg.js"),[],import.meta.url)));const{storyblokApi:i}=it(t);A=i||null,e.provide("VueSDKOptions",t)}},plugin_YOxzu2Rgn246XMgfphZEXZjtzJTMGWdPuDf_KLI_O_0=defineNuxtPlugin(({vueApp:e})=>{let{storyblok:t}=useRuntimeConfig().public;t=JSON.parse(JSON.stringify(t)),e.use(bt,{...t,use:[gt]})});function setListener(e){document.addEventListener("click",t=>{const i=t.target.closest("a");if(!i)return;const r=i.hash;if(!r||!r.startsWith("#"))return;if(t.preventDefault(),r==="#"){console.warn("Section name is not specified");return}const l=document.querySelector(r).getBoundingClientRect().top+window.scrollY;e.$lenis.value.scrollTo(l,{lerp:.1,offset:-100,force:!0})})}const anchorLink_client_PnNjYGGSONZ4ix3GhG52AVxoLIunpcMpAkwxAQrVbYc=defineNuxtPlugin(e=>{e.hook("app:suspense:resolve",()=>{setTimeout(()=>setListener(e),350)})});function _assertThisInitialized$1(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose$1(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults$1={duration:.5,overwrite:!1,delay:0},_suppressOverwrites$1,_reverting$2,_context$6,_bigNum$2=1e8,_tinyNum=1/_bigNum$2,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt$1=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString$2=function(t){return typeof t=="string"},_isFunction$3=function(t){return typeof t=="function"},_isNumber$1=function(t){return typeof t=="number"},_isUndefined$2=function(t){return typeof t>"u"},_isObject$3=function(t){return typeof t=="object"},_isNotFalse=function(t){return t!==!1},_windowExists$5=function(){return typeof window<"u"},_isFuncOrString=function(t){return _isFunction$3(t)||_isString$2(t)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray$1=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp$1=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline$1,_win$7,_coreInitted$6,_doc$6,_globals={},_installScope={},_coreReady,_install=function(t){return(_installScope=_merge$1(t,_globals))&&gsap$6},_missingPlugin=function(t,i){return console.warn("Invalid property",t,"set to",i,"Missing plugin? gsap.registerPlugin()")},_warn$1=function(t,i){return!i&&console.warn(t)},_addGlobal=function(t,i){return t&&(_globals[t]=i)&&_installScope&&(_installScope[t]=i)||_globals},_emptyFunc$1=function(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function(t){var i=t[0],r,o;if(_isObject$3(i)||_isFunction$3(i)||(t=[t]),!(r=(i._gsap||{}).harness)){for(o=_harnessPlugins.length;o--&&!_harnessPlugins[o].targetTest(i););r=_harnessPlugins[o]}for(o=t.length;o--;)t[o]&&(t[o]._gsap||(t[o]._gsap=new GSCache(t[o],r)))||t.splice(o,1);return t},_getCache=function(t){return t._gsap||_harness(toArray(t))[0]._gsap},_getProperty=function(t,i,r){return(r=t[i])&&_isFunction$3(r)?t[i]():_isUndefined$2(r)&&t.getAttribute&&t.getAttribute(i)||r},_forEachName=function(t,i){return(t=t.split(",")).forEach(i)||t},_round$3=function(t){return Math.round(t*1e5)/1e5||0},_roundPrecise=function(t){return Math.round(t*1e7)/1e7||0},_parseRelative=function(t,i){var r=i.charAt(0),o=parseFloat(i.substr(2));return t=parseFloat(t),r==="+"?t+o:r==="-"?t-o:r==="*"?t*o:t/o},_arrayContainsAny=function(t,i){for(var r=i.length,o=0;t.indexOf(i[o])<0&&++o<r;);return o<r},_lazyRender=function(){var t=_lazyTweens.length,i=_lazyTweens.slice(0),r,o;for(_lazyLookup={},_lazyTweens.length=0,r=0;r<t;r++)o=i[r],o&&o._lazy&&(o.render(o._lazy[0],o._lazy[1],!0)._lazy=0)},_isRevertWorthy=function(t){return!!(t._initted||t._startAt||t.add)},_lazySafeRender=function(t,i,r,o){_lazyTweens.length&&!_reverting$2&&_lazyRender(),t.render(i,r,!!(_reverting$2&&i<0&&_isRevertWorthy(t))),_lazyTweens.length&&!_reverting$2&&_lazyRender()},_numericIfPossible=function(t){var i=parseFloat(t);return(i||i===0)&&(t+"").match(_delimitedValueExp).length<2?i:_isString$2(t)?t.trim():t},_passThrough$1=function(t){return t},_setDefaults$2=function(t,i){for(var r in i)r in t||(t[r]=i[r]);return t},_setKeyframeDefaults=function(t){return function(i,r){for(var o in r)o in i||o==="duration"&&t||o==="ease"||(i[o]=r[o])}},_merge$1=function(t,i){for(var r in i)t[r]=i[r];return t},_mergeDeep=function e(t,i){for(var r in i)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(t[r]=_isObject$3(i[r])?e(t[r]||(t[r]={}),i[r]):i[r]);return t},_copyExcluding=function(t,i){var r={},o;for(o in t)o in i||(r[o]=t[o]);return r},_inheritDefaults=function(t){var i=t.parent||_globalTimeline$1,r=t.keyframes?_setKeyframeDefaults(_isArray$1(t.keyframes)):_setDefaults$2;if(_isNotFalse(t.inherit))for(;i;)r(t,i.vars.defaults),i=i.parent||i._dp;return t},_arraysMatch=function(t,i){for(var r=t.length,o=r===i.length;o&&r--&&t[r]===i[r];);return r<0},_addLinkedListItem=function(t,i,r,o,l){var d=t[o],n;if(l)for(n=i[l];d&&d[l]>n;)d=d._prev;return d?(i._next=d._next,d._next=i):(i._next=t[r],t[r]=i),i._next?i._next._prev=i:t[o]=i,i._prev=d,i.parent=i._dp=t,i},_removeLinkedListItem=function(t,i,r,o){r===void 0&&(r="_first"),o===void 0&&(o="_last");var l=i._prev,d=i._next;l?l._next=d:t[r]===i&&(t[r]=d),d?d._prev=l:t[o]===i&&(t[o]=l),i._next=i._prev=i.parent=null},_removeFromParent=function(t,i){t.parent&&(!i||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},_uncache=function(t,i){if(t&&(!i||i._end>t._dur||i._start<0))for(var r=t;r;)r._dirty=1,r=r.parent;return t},_recacheAncestors=function(t){for(var i=t.parent;i&&i.parent;)i._dirty=1,i.totalDuration(),i=i.parent;return t},_rewindStartAt=function(t,i,r,o){return t._startAt&&(_reverting$2?t._startAt.revert(_revertConfigNoKill):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(i,!0,o))},_hasNoPausedAncestors=function e(t){return!t||t._ts&&e(t.parent)},_elapsedCycleDuration=function(t){return t._repeat?_animationCycle(t._tTime,t=t.duration()+t._rDelay)*t:0},_animationCycle=function(t,i){var r=Math.floor(t=_roundPrecise(t/i));return t&&r===t?r-1:r},_parentToChildTotalTime=function(t,i){return(t-i._start)*i._ts+(i._ts>=0?0:i._dirty?i.totalDuration():i._tDur)},_setEnd=function(t){return t._end=_roundPrecise(t._start+(t._tDur/Math.abs(t._ts||t._rts||_tinyNum)||0))},_alignPlayhead=function(t,i){var r=t._dp;return r&&r.smoothChildTiming&&t._ts&&(t._start=_roundPrecise(r._time-(t._ts>0?i/t._ts:((t._dirty?t.totalDuration():t._tDur)-i)/-t._ts)),_setEnd(t),r._dirty||_uncache(r,t)),t},_postAddChecks=function(t,i){var r;if((i._time||!i._dur&&i._initted||i._start<t._time&&(i._dur||!i.add))&&(r=_parentToChildTotalTime(t.rawTime(),i),(!i._dur||_clamp$1(0,i.totalDuration(),r)-i._tTime>_tinyNum)&&i.render(r,!0)),_uncache(t,i)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(r=t;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;t._zTime=-1e-8}},_addToTimeline=function(t,i,r,o){return i.parent&&_removeFromParent(i),i._start=_roundPrecise((_isNumber$1(r)?r:r||t!==_globalTimeline$1?_parsePosition$1(t,r,i):t._time)+i._delay),i._end=_roundPrecise(i._start+(i.totalDuration()/Math.abs(i.timeScale())||0)),_addLinkedListItem(t,i,"_first","_last",t._sort?"_start":0),_isFromOrFromStart(i)||(t._recent=i),o||_postAddChecks(t,i),t._ts<0&&_alignPlayhead(t,t._tTime),t},_scrollTrigger=function(t,i){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",i))&&_globals.ScrollTrigger.create(i,t)},_attemptInitTween=function(t,i,r,o,l){if(_initTween(t,i,l),!t._initted)return 1;if(!r&&t._pt&&!_reverting$2&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(t),t._lazy=[l,o],1},_parentPlayheadIsBeforeStart=function e(t){var i=t.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||e(i))},_isFromOrFromStart=function(t){var i=t.data;return i==="isFromStart"||i==="isStart"},_renderZeroDurationTween=function(t,i,r,o){var l=t.ratio,d=i<0||!i&&(!t._start&&_parentPlayheadIsBeforeStart(t)&&!(!t._initted&&_isFromOrFromStart(t))||(t._ts<0||t._dp._ts<0)&&!_isFromOrFromStart(t))?0:1,n=t._rDelay,S=0,C,I,z;if(n&&t._repeat&&(S=_clamp$1(0,t._tDur,i),I=_animationCycle(S,n),t._yoyo&&I&1&&(d=1-d),I!==_animationCycle(t._tTime,n)&&(l=1-d,t.vars.repeatRefresh&&t._initted&&t.invalidate())),d!==l||_reverting$2||o||t._zTime===_tinyNum||!i&&t._zTime){if(!t._initted&&_attemptInitTween(t,i,o,r,S))return;for(z=t._zTime,t._zTime=i||(r?_tinyNum:0),r||(r=i&&!z),t.ratio=d,t._from&&(d=1-d),t._time=0,t._tTime=S,C=t._pt;C;)C.r(d,C.d),C=C._next;i<0&&_rewindStartAt(t,i,r,!0),t._onUpdate&&!r&&_callback$1(t,"onUpdate"),S&&t._repeat&&!r&&t.parent&&_callback$1(t,"onRepeat"),(i>=t._tDur||i<0)&&t.ratio===d&&(d&&_removeFromParent(t,1),!r&&!_reverting$2&&(_callback$1(t,d?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=i)},_findNextPauseTween=function(t,i,r){var o;if(r>i)for(o=t._first;o&&o._start<=r;){if(o.data==="isPause"&&o._start>i)return o;o=o._next}else for(o=t._last;o&&o._start>=r;){if(o.data==="isPause"&&o._start<i)return o;o=o._prev}},_setDuration=function(t,i,r,o){var l=t._repeat,d=_roundPrecise(i)||0,n=t._tTime/t._tDur;return n&&!o&&(t._time*=d/t._dur),t._dur=d,t._tDur=l?l<0?1e10:_roundPrecise(d*(l+1)+t._rDelay*l):d,n>0&&!o&&_alignPlayhead(t,t._tTime=t._tDur*n),t.parent&&_setEnd(t),r||_uncache(t.parent,t),t},_onUpdateTotalDuration=function(t){return t instanceof Timeline?_uncache(t):_setDuration(t,t._dur)},_zeroPosition={_start:0,endTime:_emptyFunc$1,totalDuration:_emptyFunc$1},_parsePosition$1=function e(t,i,r){var o=t.labels,l=t._recent||_zeroPosition,d=t.duration()>=_bigNum$2?l.endTime(!1):t._dur,n,S,C;return _isString$2(i)&&(isNaN(i)||i in o)?(S=i.charAt(0),C=i.substr(-1)==="%",n=i.indexOf("="),S==="<"||S===">"?(n>=0&&(i=i.replace(/=/,"")),(S==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(i.substr(1))||0)*(C?(n<0?l:r).totalDuration()/100:1)):n<0?(i in o||(o[i]=d),o[i]):(S=parseFloat(i.charAt(n-1)+i.substr(n+1)),C&&r&&(S=S/100*(_isArray$1(r)?r[0]:r).totalDuration()),n>1?e(t,i.substr(0,n-1),r)+S:d+S)):i==null?d:+i},_createTweenType=function(t,i,r){var o=_isNumber$1(i[1]),l=(o?2:1)+(t<2?0:1),d=i[l],n,S;if(o&&(d.duration=i[1]),d.parent=r,t){for(n=d,S=r;S&&!("immediateRender"in n);)n=S.vars.defaults||{},S=_isNotFalse(S.vars.inherit)&&S.parent;d.immediateRender=_isNotFalse(n.immediateRender),t<2?d.runBackwards=1:d.startAt=i[l-1]}return new Tween(i[0],d,i[l+1])},_conditionalReturn=function(t,i){return t||t===0?i(t):i},_clamp$1=function(t,i,r){return r<t?t:r>i?i:r},getUnit=function(t,i){return!_isString$2(t)||!(i=_unitExp.exec(t))?"":i[1]},clamp$1=function(t,i,r){return _conditionalReturn(r,function(o){return _clamp$1(t,i,o)})},_slice=[].slice,_isArrayLike=function(t,i){return t&&_isObject$3(t)&&"length"in t&&(!i&&!t.length||t.length-1 in t&&_isObject$3(t[0]))&&!t.nodeType&&t!==_win$7},_flatten=function(t,i,r){return r===void 0&&(r=[]),t.forEach(function(o){var l;return _isString$2(o)&&!i||_isArrayLike(o,1)?(l=r).push.apply(l,toArray(o)):r.push(o)})||r},toArray=function(t,i,r){return _context$6&&!i&&_context$6.selector?_context$6.selector(t):_isString$2(t)&&!r&&(_coreInitted$6||!_wake())?_slice.call((i||_doc$6).querySelectorAll(t),0):_isArray$1(t)?_flatten(t,r):_isArrayLike(t)?_slice.call(t,0):t?[t]:[]},selector=function(t){return t=toArray(t)[0]||_warn$1("Invalid scope")||{},function(i){var r=t.current||t.nativeElement||t;return toArray(i,r.querySelectorAll?r:r===t?_warn$1("Invalid scope")||_doc$6.createElement("div"):t)}},shuffle=function(t){return t.sort(function(){return .5-Math.random()})},distribute=function(t){if(_isFunction$3(t))return t;var i=_isObject$3(t)?t:{each:t},r=_parseEase(i.ease),o=i.from||0,l=parseFloat(i.base)||0,d={},n=o>0&&o<1,S=isNaN(o)||n,C=i.axis,I=o,z=o;return _isString$2(o)?I=z={center:.5,edges:.5,end:1}[o]||0:!n&&S&&(I=o[0],z=o[1]),function($,k,Y){var ie=(Y||i).length,ue=d[ie],ne,se,le,he,me,ge,xt,Et,Lt;if(!ue){if(Lt=i.grid==="auto"?0:(i.grid||[1,_bigNum$2])[1],!Lt){for(xt=-1e8;xt<(xt=Y[Lt++].getBoundingClientRect().left)&&Lt<ie;);Lt<ie&&Lt--}for(ue=d[ie]=[],ne=S?Math.min(Lt,ie)*I-.5:o%Lt,se=Lt===_bigNum$2?0:S?ie*z/Lt-.5:o/Lt|0,xt=0,Et=_bigNum$2,ge=0;ge<ie;ge++)le=ge%Lt-ne,he=se-(ge/Lt|0),ue[ge]=me=C?Math.abs(C==="y"?he:le):_sqrt$1(le*le+he*he),me>xt&&(xt=me),me<Et&&(Et=me);o==="random"&&shuffle(ue),ue.max=xt-Et,ue.min=Et,ue.v=ie=(parseFloat(i.amount)||parseFloat(i.each)*(Lt>ie?ie-1:C?C==="y"?ie/Lt:Lt:Math.max(Lt,ie/Lt))||0)*(o==="edges"?-1:1),ue.b=ie<0?l-ie:l,ue.u=getUnit(i.amount||i.each)||0,r=r&&ie<0?_invertEase(r):r}return ie=(ue[$]-ue.min)/ue.max||0,_roundPrecise(ue.b+(r?r(ie):ie)*ue.v)+ue.u}},_roundModifier=function(t){var i=Math.pow(10,((t+"").split(".")[1]||"").length);return function(r){var o=_roundPrecise(Math.round(parseFloat(r)/t)*t*i);return(o-o%1)/i+(_isNumber$1(r)?0:getUnit(r))}},snap=function(t,i){var r=_isArray$1(t),o,l;return!r&&_isObject$3(t)&&(o=r=t.radius||_bigNum$2,t.values?(t=toArray(t.values),(l=!_isNumber$1(t[0]))&&(o*=o)):t=_roundModifier(t.increment)),_conditionalReturn(i,r?_isFunction$3(t)?function(d){return l=t(d),Math.abs(l-d)<=o?l:d}:function(d){for(var n=parseFloat(l?d.x:d),S=parseFloat(l?d.y:0),C=_bigNum$2,I=0,z=t.length,$,k;z--;)l?($=t[z].x-n,k=t[z].y-S,$=$*$+k*k):$=Math.abs(t[z]-n),$<C&&(C=$,I=z);return I=!o||C<=o?t[I]:d,l||I===d||_isNumber$1(d)?I:I+getUnit(d)}:_roundModifier(t))},random=function(t,i,r,o){return _conditionalReturn(_isArray$1(t)?!i:r===!0?!!(r=0):!o,function(){return _isArray$1(t)?t[~~(Math.random()*t.length)]:(r=r||1e-5)&&(o=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((t-r/2+Math.random()*(i-t+r*.99))/r)*r*o)/o})},pipe=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return function(o){return i.reduce(function(l,d){return d(l)},o)}},unitize=function(t,i){return function(r){return t(parseFloat(r))+(i||getUnit(r))}},normalize=function(t,i,r){return mapRange(t,i,0,1,r)},_wrapArray=function(t,i,r){return _conditionalReturn(r,function(o){return t[~~i(o)]})},wrap=function e(t,i,r){var o=i-t;return _isArray$1(t)?_wrapArray(t,e(0,t.length),i):_conditionalReturn(r,function(l){return(o+(l-t)%o)%o+t})},wrapYoyo=function e(t,i,r){var o=i-t,l=o*2;return _isArray$1(t)?_wrapArray(t,e(0,t.length-1),i):_conditionalReturn(r,function(d){return d=(l+(d-t)%l)%l||0,t+(d>o?l-d:d)})},_replaceRandom=function(t){for(var i=0,r="",o,l,d,n;~(o=t.indexOf("random(",i));)d=t.indexOf(")",o),n=t.charAt(o+7)==="[",l=t.substr(o+7,d-o-7).match(n?_delimitedValueExp:_strictNumExp),r+=t.substr(i,o-i)+random(n?l:+l[0],n?0:+l[1],+l[2]||1e-5),i=d+1;return r+t.substr(i,t.length-i)},mapRange=function(t,i,r,o,l){var d=i-t,n=o-r;return _conditionalReturn(l,function(S){return r+((S-t)/d*n||0)})},interpolate=function e(t,i,r,o){var l=isNaN(t+i)?0:function(k){return(1-k)*t+k*i};if(!l){var d=_isString$2(t),n={},S,C,I,z,$;if(r===!0&&(o=1)&&(r=null),d)t={p:t},i={p:i};else if(_isArray$1(t)&&!_isArray$1(i)){for(I=[],z=t.length,$=z-2,C=1;C<z;C++)I.push(e(t[C-1],t[C]));z--,l=function(Y){Y*=z;var ie=Math.min($,~~Y);return I[ie](Y-ie)},r=i}else o||(t=_merge$1(_isArray$1(t)?[]:{},t));if(!I){for(S in i)_addPropTween.call(n,t,S,"get",i[S]);l=function(Y){return _renderPropTweens(Y,n)||(d?t.p:t)}}}return _conditionalReturn(r,l)},_getLabelInDirection=function(t,i,r){var o=t.labels,l=_bigNum$2,d,n,S;for(d in o)n=o[d]-i,n<0==!!r&&n&&l>(n=Math.abs(n))&&(S=d,l=n);return S},_callback$1=function(t,i,r){var o=t.vars,l=o[i],d=_context$6,n=t._ctx,S,C,I;if(l)return S=o[i+"Params"],C=o.callbackScope||t,r&&_lazyTweens.length&&_lazyRender(),n&&(_context$6=n),I=S?l.apply(C,S):l.call(C),_context$6=d,I},_interrupt=function(t){return _removeFromParent(t),t.scrollTrigger&&t.scrollTrigger.kill(!!_reverting$2),t.progress()<1&&_callback$1(t,"onInterrupt"),t},_quickTween,_registerPluginQueue=[],_createPlugin=function(t){if(t)if(t=!t.name&&t.default||t,_windowExists$5()||t.headless){var i=t.name,r=_isFunction$3(t),o=i&&!r&&t.init?function(){this._props=[]}:t,l={init:_emptyFunc$1,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},d={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),t!==o){if(_plugins[i])return;_setDefaults$2(o,_setDefaults$2(_copyExcluding(t,l),d)),_merge$1(o.prototype,_merge$1(l,_copyExcluding(t,d))),_plugins[o.prop=i]=o,t.targetTest&&(_harnessPlugins.push(o),_reservedProps[i]=1),i=(i==="css"?"CSS":i.charAt(0).toUpperCase()+i.substr(1))+"Plugin"}_addGlobal(i,o),t.register&&t.register(gsap$6,o,PropTween)}else _registerPluginQueue.push(t)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function(t,i,r){return t+=t<0?1:t>1?-1:0,(t*6<1?i+(r-i)*t*6:t<.5?r:t*3<2?i+(r-i)*(2/3-t)*6:i)*_255+.5|0},splitColor=function(t,i,r){var o=t?_isNumber$1(t)?[t>>16,t>>8&_255,t&_255]:0:_colorLookup.black,l,d,n,S,C,I,z,$,k,Y;if(!o){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),_colorLookup[t])o=_colorLookup[t];else if(t.charAt(0)==="#"){if(t.length<6&&(l=t.charAt(1),d=t.charAt(2),n=t.charAt(3),t="#"+l+l+d+d+n+n+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return o=parseInt(t.substr(1,6),16),[o>>16,o>>8&_255,o&_255,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),o=[t>>16,t>>8&_255,t&_255]}else if(t.substr(0,3)==="hsl"){if(o=Y=t.match(_strictNumExp),!i)S=+o[0]%360/360,C=+o[1]/100,I=+o[2]/100,d=I<=.5?I*(C+1):I+C-I*C,l=I*2-d,o.length>3&&(o[3]*=1),o[0]=_hue(S+1/3,l,d),o[1]=_hue(S,l,d),o[2]=_hue(S-1/3,l,d);else if(~t.indexOf("="))return o=t.match(_numExp$1),r&&o.length<4&&(o[3]=1),o}else o=t.match(_strictNumExp)||_colorLookup.transparent;o=o.map(Number)}return i&&!Y&&(l=o[0]/_255,d=o[1]/_255,n=o[2]/_255,z=Math.max(l,d,n),$=Math.min(l,d,n),I=(z+$)/2,z===$?S=C=0:(k=z-$,C=I>.5?k/(2-z-$):k/(z+$),S=z===l?(d-n)/k+(d<n?6:0):z===d?(n-l)/k+2:(l-d)/k+4,S*=60),o[0]=~~(S+.5),o[1]=~~(C*100+.5),o[2]=~~(I*100+.5)),r&&o.length<4&&(o[3]=1),o},_colorOrderData=function(t){var i=[],r=[],o=-1;return t.split(_colorExp).forEach(function(l){var d=l.match(_numWithUnitExp)||[];i.push.apply(i,d),r.push(o+=d.length+1)}),i.c=r,i},_formatColors=function(t,i,r){var o="",l=(t+o).match(_colorExp),d=i?"hsla(":"rgba(",n=0,S,C,I,z;if(!l)return t;if(l=l.map(function($){return($=splitColor($,i,1))&&d+(i?$[0]+","+$[1]+"%,"+$[2]+"%,"+$[3]:$.join(","))+")"}),r&&(I=_colorOrderData(t),S=r.c,S.join(o)!==I.c.join(o)))for(C=t.replace(_colorExp,"1").split(_numWithUnitExp),z=C.length-1;n<z;n++)o+=C[n]+(~S.indexOf(n)?l.shift()||d+"0,0,0,0)":(I.length?I:l.length?l:r).shift());if(!C)for(C=t.split(_colorExp),z=C.length-1;n<z;n++)o+=C[n]+l[n];return o+C[z]},_colorExp=function(){var e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in _colorLookup)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function(t){var i=t.join(" "),r;if(_colorExp.lastIndex=0,_colorExp.test(i))return r=_hslExp.test(i),t[1]=_formatColors(t[1],r),t[0]=_formatColors(t[0],r,_colorOrderData(t[1])),!0},_tickerActive,_ticker=function(){var e=Date.now,t=500,i=33,r=e(),o=r,l=1e3/240,d=l,n=[],S,C,I,z,$,k,Y=function ie(ue){var ne=e()-o,se=ue===!0,le,he,me,ge;if((ne>t||ne<0)&&(r+=ne-i),o+=ne,me=o-r,le=me-d,(le>0||se)&&(ge=++z.frame,$=me-z.time*1e3,z.time=me=me/1e3,d+=le+(le>=l?4:l-le),he=1),se||(S=C(ie)),he)for(k=0;k<n.length;k++)n[k](me,$,ge,ue)};return z={time:0,frame:0,tick:function(){Y(!0)},deltaRatio:function(ue){return $/(1e3/(ue||60))},wake:function(){_coreReady&&(!_coreInitted$6&&_windowExists$5()&&(_win$7=_coreInitted$6=window,_doc$6=_win$7.document||{},_globals.gsap=gsap$6,(_win$7.gsapVersions||(_win$7.gsapVersions=[])).push(gsap$6.version),_install(_installScope||_win$7.GreenSockGlobals||!_win$7.gsap&&_win$7||{}),_registerPluginQueue.forEach(_createPlugin)),I=typeof requestAnimationFrame<"u"&&requestAnimationFrame,S&&z.sleep(),C=I||function(ue){return setTimeout(ue,d-z.time*1e3+1|0)},_tickerActive=1,Y(2))},sleep:function(){(I?cancelAnimationFrame:clearTimeout)(S),_tickerActive=0,C=_emptyFunc$1},lagSmoothing:function(ue,ne){t=ue||1/0,i=Math.min(ne||33,t)},fps:function(ue){l=1e3/(ue||240),d=z.time*1e3+l},add:function(ue,ne,se){var le=ne?function(he,me,ge,xt){ue(he,me,ge,xt),z.remove(le)}:ue;return z.remove(ue),n[se?"unshift":"push"](le),_wake(),le},remove:function(ue,ne){~(ne=n.indexOf(ue))&&n.splice(ne,1)&&k>=ne&&k--},_listeners:n},z}(),_wake=function(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function(t){for(var i={},r=t.substr(1,t.length-3).split(":"),o=r[0],l=1,d=r.length,n,S,C;l<d;l++)S=r[l],n=l!==d-1?S.lastIndexOf(","):S.length,C=S.substr(0,n),i[o]=isNaN(C)?C.replace(_quotesExp,"").trim():+C,o=S.substr(n+1).trim();return i},_valueInParentheses=function(t){var i=t.indexOf("(")+1,r=t.indexOf(")"),o=t.indexOf("(",i);return t.substring(i,~o&&o<r?t.indexOf(")",r+1):r)},_configEaseFromString=function(t){var i=(t+"").split("("),r=_easeMap[i[0]];return r&&i.length>1&&r.config?r.config.apply(null,~t.indexOf("{")?[_parseObjectInString(i[1])]:_valueInParentheses(t).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(t)?_easeMap._CE("",t):r},_invertEase=function(t){return function(i){return 1-t(1-i)}},_propagateYoyoEase=function e(t,i){for(var r=t._first,o;r;)r instanceof Timeline?e(r,i):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==i&&(r.timeline?e(r.timeline,i):(o=r._ease,r._ease=r._yEase,r._yEase=o,r._yoyo=i)),r=r._next},_parseEase=function(t,i){return t&&(_isFunction$3(t)?t:_easeMap[t]||_configEaseFromString(t))||i},_insertEase=function(t,i,r,o){r===void 0&&(r=function(S){return 1-i(1-S)}),o===void 0&&(o=function(S){return S<.5?i(S*2)/2:1-i((1-S)*2)/2});var l={easeIn:i,easeOut:r,easeInOut:o},d;return _forEachName(t,function(n){_easeMap[n]=_globals[n]=l,_easeMap[d=n.toLowerCase()]=r;for(var S in l)_easeMap[d+(S==="easeIn"?".in":S==="easeOut"?".out":".inOut")]=_easeMap[n+"."+S]=l[S]}),l},_easeInOutFromOut=function(t){return function(i){return i<.5?(1-t(1-i*2))/2:.5+t((i-.5)*2)/2}},_configElastic=function e(t,i,r){var o=i>=1?i:1,l=(r||(t?.3:.45))/(i<1?i:1),d=l/_2PI*(Math.asin(1/o)||0),n=function(I){return I===1?1:o*Math.pow(2,-10*I)*_sin((I-d)*l)+1},S=t==="out"?n:t==="in"?function(C){return 1-n(1-C)}:_easeInOutFromOut(n);return l=_2PI/l,S.config=function(C,I){return e(t,C,I)},S},_configBack=function e(t,i){i===void 0&&(i=1.70158);var r=function(d){return d?--d*d*((i+1)*d+i)+1:0},o=t==="out"?r:t==="in"?function(l){return 1-r(1-l)}:_easeInOutFromOut(r);return o.config=function(l){return e(t,l)},o};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function(e,t){var i=t<5?t+1:t;_insertEase(e+",Power"+(i-1),t?function(r){return Math.pow(r,i)}:function(r){return r},function(r){return 1-Math.pow(1-r,i)},function(r){return r<.5?Math.pow(r*2,i)/2:1-Math.pow((1-r)*2,i)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function(e,t){var i=1/t,r=2*i,o=2.5*i,l=function(n){return n<i?e*n*n:n<r?e*Math.pow(n-1.5/t,2)+.75:n<o?e*(n-=2.25/t)*n+.9375:e*Math.pow(n-2.625/t,2)+.984375};_insertEase("Bounce",function(d){return 1-l(1-d)},l)})(7.5625,2.75);_insertEase("Expo",function(e){return Math.pow(2,10*(e-1))*e+e*e*e*e*e*e*(1-e)});_insertEase("Circ",function(e){return-(_sqrt$1(1-e*e)-1)});_insertEase("Sine",function(e){return e===1?1:-_cos(e*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function(t,i){t===void 0&&(t=1);var r=1/t,o=t+(i?0:1),l=i?1:0,d=1-_tinyNum;return function(n){return((o*_clamp$1(0,d,n)|0)+l)*r}}};_defaults$1.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(e){return _callbackNames+=e+","+e+"Params,"});var GSCache=function(t,i){this.id=_gsID++,t._gsap=this,this.target=t,this.harness=i,this.get=i?i.get:_getProperty,this.set=i?i.getSetter:_getSetter},Animation$1=function(){function e(i){this.vars=i,this._delay=+i.delay||0,(this._repeat=i.repeat===1/0?-2:i.repeat||0)&&(this._rDelay=i.repeatDelay||0,this._yoyo=!!i.yoyo||!!i.yoyoEase),this._ts=1,_setDuration(this,+i.duration,1,1),this.data=i.data,_context$6&&(this._ctx=_context$6,_context$6.data.push(this)),_tickerActive||_ticker.wake()}var t=e.prototype;return t.delay=function(r){return r||r===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+r-this._delay),this._delay=r,this):this._delay},t.duration=function(r){return arguments.length?this.totalDuration(this._repeat>0?r+(r+this._rDelay)*this._repeat:r):this.totalDuration()&&this._dur},t.totalDuration=function(r){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?r:(r-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(r,o){if(_wake(),!arguments.length)return this._tTime;var l=this._dp;if(l&&l.smoothChildTiming&&this._ts){for(_alignPlayhead(this,r),!l._dp||l.parent||_postAddChecks(l,this);l&&l.parent;)l.parent._time!==l._start+(l._ts>=0?l._tTime/l._ts:(l.totalDuration()-l._tTime)/-l._ts)&&l.totalTime(l._tTime,!0),l=l.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&r<this._tDur||this._ts<0&&r>0||!this._tDur&&!r)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==r||!this._dur&&!o||this._initted&&Math.abs(this._zTime)===_tinyNum||!r&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=r),_lazySafeRender(this,r,o)),this},t.time=function(r,o){return arguments.length?this.totalTime(Math.min(this.totalDuration(),r+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(r?this._dur:0),o):this._time},t.totalProgress=function(r,o){return arguments.length?this.totalTime(this.totalDuration()*r,o):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(r,o){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-r:r)+_elapsedCycleDuration(this),o):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(r,o){var l=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(r-1)*l,o):this._repeat?_animationCycle(this._tTime,l)+1:1},t.timeScale=function(r,o){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===r)return this;var l=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+r||0,this._ts=this._ps||r===-1e-8?0:this._rts,this.totalTime(_clamp$1(-Math.abs(this._delay),this.totalDuration(),l),o!==!1),_setEnd(this),_recacheAncestors(this)},t.paused=function(r){return arguments.length?(this._ps!==r&&(this._ps=r,r?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},t.startTime=function(r){if(arguments.length){this._start=r;var o=this.parent||this._dp;return o&&(o._sort||!this.parent)&&_addToTimeline(o,this,r-this._delay),this}return this._start},t.endTime=function(r){return this._start+(_isNotFalse(r)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(r){var o=this.parent||this._dp;return o?r&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(o.rawTime(r),this):this._tTime:this._tTime},t.revert=function(r){r===void 0&&(r=_revertConfig);var o=_reverting$2;return _reverting$2=r,_isRevertWorthy(this)&&(this.timeline&&this.timeline.revert(r),this.totalTime(-.01,r.suppressEvents)),this.data!=="nested"&&r.kill!==!1&&this.kill(),_reverting$2=o,this},t.globalTime=function(r){for(var o=this,l=arguments.length?r:o.rawTime();o;)l=o._start+l/(Math.abs(o._ts)||1),o=o._dp;return!this.parent&&this._sat?this._sat.globalTime(r):l},t.repeat=function(r){return arguments.length?(this._repeat=r===1/0?-2:r,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(r){if(arguments.length){var o=this._time;return this._rDelay=r,_onUpdateTotalDuration(this),o?this.time(o):this}return this._rDelay},t.yoyo=function(r){return arguments.length?(this._yoyo=r,this):this._yoyo},t.seek=function(r,o){return this.totalTime(_parsePosition$1(this,r),_isNotFalse(o))},t.restart=function(r,o){return this.play().totalTime(r?-this._delay:0,_isNotFalse(o)),this._dur||(this._zTime=-1e-8),this},t.play=function(r,o){return r!=null&&this.seek(r,o),this.reversed(!1).paused(!1)},t.reverse=function(r,o){return r!=null&&this.seek(r||this.totalDuration(),o),this.reversed(!0).paused(!1)},t.pause=function(r,o){return r!=null&&this.seek(r,o),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(r){return arguments.length?(!!r!==this.reversed()&&this.timeScale(-this._rts||(r?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var r=this.parent||this._dp,o=this._start,l;return!!(!r||this._ts&&this._initted&&r.isActive()&&(l=r.rawTime(!0))>=o&&l<this.endTime(!0)-_tinyNum)},t.eventCallback=function(r,o,l){var d=this.vars;return arguments.length>1?(o?(d[r]=o,l&&(d[r+"Params"]=l),r==="onUpdate"&&(this._onUpdate=o)):delete d[r],this):d[r]},t.then=function(r){var o=this;return new Promise(function(l){var d=_isFunction$3(r)?r:_passThrough$1,n=function(){var C=o.then;o.then=null,_isFunction$3(d)&&(d=d(o))&&(d.then||d===o)&&(o.then=C),l(d),o.then=C};o._initted&&o.totalProgress()===1&&o._ts>=0||!o._tTime&&o._ts<0?n():o._prom=n})},t.kill=function(){_interrupt(this)},e}();_setDefaults$2(Animation$1.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Timeline=function(e){_inheritsLoose$1(t,e);function t(r,o){var l;return r===void 0&&(r={}),l=e.call(this,r)||this,l.labels={},l.smoothChildTiming=!!r.smoothChildTiming,l.autoRemoveChildren=!!r.autoRemoveChildren,l._sort=_isNotFalse(r.sortChildren),_globalTimeline$1&&_addToTimeline(r.parent||_globalTimeline$1,_assertThisInitialized$1(l),o),r.reversed&&l.reverse(),r.paused&&l.paused(!0),r.scrollTrigger&&_scrollTrigger(_assertThisInitialized$1(l),r.scrollTrigger),l}var i=t.prototype;return i.to=function(o,l,d){return _createTweenType(0,arguments,this),this},i.from=function(o,l,d){return _createTweenType(1,arguments,this),this},i.fromTo=function(o,l,d,n){return _createTweenType(2,arguments,this),this},i.set=function(o,l,d){return l.duration=0,l.parent=this,_inheritDefaults(l).repeatDelay||(l.repeat=0),l.immediateRender=!!l.immediateRender,new Tween(o,l,_parsePosition$1(this,d),1),this},i.call=function(o,l,d){return _addToTimeline(this,Tween.delayedCall(0,o,l),d)},i.staggerTo=function(o,l,d,n,S,C,I){return d.duration=l,d.stagger=d.stagger||n,d.onComplete=C,d.onCompleteParams=I,d.parent=this,new Tween(o,d,_parsePosition$1(this,S)),this},i.staggerFrom=function(o,l,d,n,S,C,I){return d.runBackwards=1,_inheritDefaults(d).immediateRender=_isNotFalse(d.immediateRender),this.staggerTo(o,l,d,n,S,C,I)},i.staggerFromTo=function(o,l,d,n,S,C,I,z){return n.startAt=d,_inheritDefaults(n).immediateRender=_isNotFalse(n.immediateRender),this.staggerTo(o,l,n,S,C,I,z)},i.render=function(o,l,d){var n=this._time,S=this._dirty?this.totalDuration():this._tDur,C=this._dur,I=o<=0?0:_roundPrecise(o),z=this._zTime<0!=o<0&&(this._initted||!C),$,k,Y,ie,ue,ne,se,le,he,me,ge,xt;if(this!==_globalTimeline$1&&I>S&&o>=0&&(I=S),I!==this._tTime||d||z){if(n!==this._time&&C&&(I+=this._time-n,o+=this._time-n),$=I,he=this._start,le=this._ts,ne=!le,z&&(C||(n=this._zTime),(o||!l)&&(this._zTime=o)),this._repeat){if(ge=this._yoyo,ue=C+this._rDelay,this._repeat<-1&&o<0)return this.totalTime(ue*100+o,l,d);if($=_roundPrecise(I%ue),I===S?(ie=this._repeat,$=C):(me=_roundPrecise(I/ue),ie=~~me,ie&&ie===me&&($=C,ie--),$>C&&($=C)),me=_animationCycle(this._tTime,ue),!n&&this._tTime&&me!==ie&&this._tTime-me*ue-this._dur<=0&&(me=ie),ge&&ie&1&&($=C-$,xt=1),ie!==me&&!this._lock){var Et=ge&&me&1,Lt=Et===(ge&&ie&1);if(ie<me&&(Et=!Et),n=Et?0:I%C?C:I,this._lock=1,this.render(n||(xt?0:_roundPrecise(ie*ue)),l,!C)._lock=0,this._tTime=I,!l&&this.parent&&_callback$1(this,"onRepeat"),this.vars.repeatRefresh&&!xt&&(this.invalidate()._lock=1),n&&n!==this._time||ne!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(C=this._dur,S=this._tDur,Lt&&(this._lock=2,n=Et?C:-1e-4,this.render(n,!0),this.vars.repeatRefresh&&!xt&&this.invalidate()),this._lock=0,!this._ts&&!ne)return this;_propagateYoyoEase(this,xt)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(se=_findNextPauseTween(this,_roundPrecise(n),_roundPrecise($)),se&&(I-=$-($=se._start))),this._tTime=I,this._time=$,this._act=!le,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=o,n=0),!n&&I&&!l&&!me&&(_callback$1(this,"onStart"),this._tTime!==I))return this;if($>=n&&o>=0)for(k=this._first;k;){if(Y=k._next,(k._act||$>=k._start)&&k._ts&&se!==k){if(k.parent!==this)return this.render(o,l,d);if(k.render(k._ts>0?($-k._start)*k._ts:(k._dirty?k.totalDuration():k._tDur)+($-k._start)*k._ts,l,d),$!==this._time||!this._ts&&!ne){se=0,Y&&(I+=this._zTime=-1e-8);break}}k=Y}else{k=this._last;for(var Zt=o<0?o:$;k;){if(Y=k._prev,(k._act||Zt<=k._end)&&k._ts&&se!==k){if(k.parent!==this)return this.render(o,l,d);if(k.render(k._ts>0?(Zt-k._start)*k._ts:(k._dirty?k.totalDuration():k._tDur)+(Zt-k._start)*k._ts,l,d||_reverting$2&&_isRevertWorthy(k)),$!==this._time||!this._ts&&!ne){se=0,Y&&(I+=this._zTime=Zt?-1e-8:_tinyNum);break}}k=Y}}if(se&&!l&&(this.pause(),se.render($>=n?0:-1e-8)._zTime=$>=n?1:-1,this._ts))return this._start=he,_setEnd(this),this.render(o,l,d);this._onUpdate&&!l&&_callback$1(this,"onUpdate",!0),(I===S&&this._tTime>=this.totalDuration()||!I&&n)&&(he===this._start||Math.abs(le)!==Math.abs(this._ts))&&(this._lock||((o||!C)&&(I===S&&this._ts>0||!I&&this._ts<0)&&_removeFromParent(this,1),!l&&!(o<0&&!n)&&(I||n||!S)&&(_callback$1(this,I===S&&o>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(I<S&&this.timeScale()>0)&&this._prom())))}return this},i.add=function(o,l){var d=this;if(_isNumber$1(l)||(l=_parsePosition$1(this,l,o)),!(o instanceof Animation$1)){if(_isArray$1(o))return o.forEach(function(n){return d.add(n,l)}),this;if(_isString$2(o))return this.addLabel(o,l);if(_isFunction$3(o))o=Tween.delayedCall(0,o);else return this}return this!==o?_addToTimeline(this,o,l):this},i.getChildren=function(o,l,d,n){o===void 0&&(o=!0),l===void 0&&(l=!0),d===void 0&&(d=!0),n===void 0&&(n=-1e8);for(var S=[],C=this._first;C;)C._start>=n&&(C instanceof Tween?l&&S.push(C):(d&&S.push(C),o&&S.push.apply(S,C.getChildren(!0,l,d)))),C=C._next;return S},i.getById=function(o){for(var l=this.getChildren(1,1,1),d=l.length;d--;)if(l[d].vars.id===o)return l[d]},i.remove=function(o){return _isString$2(o)?this.removeLabel(o):_isFunction$3(o)?this.killTweensOf(o):(o.parent===this&&_removeLinkedListItem(this,o),o===this._recent&&(this._recent=this._last),_uncache(this))},i.totalTime=function(o,l){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?o/this._ts:(this.totalDuration()-o)/-this._ts))),e.prototype.totalTime.call(this,o,l),this._forcing=0,this):this._tTime},i.addLabel=function(o,l){return this.labels[o]=_parsePosition$1(this,l),this},i.removeLabel=function(o){return delete this.labels[o],this},i.addPause=function(o,l,d){var n=Tween.delayedCall(0,l||_emptyFunc$1,d);return n.data="isPause",this._hasPause=1,_addToTimeline(this,n,_parsePosition$1(this,o))},i.removePause=function(o){var l=this._first;for(o=_parsePosition$1(this,o);l;)l._start===o&&l.data==="isPause"&&_removeFromParent(l),l=l._next},i.killTweensOf=function(o,l,d){for(var n=this.getTweensOf(o,d),S=n.length;S--;)_overwritingTween!==n[S]&&n[S].kill(o,l);return this},i.getTweensOf=function(o,l){for(var d=[],n=toArray(o),S=this._first,C=_isNumber$1(l),I;S;)S instanceof Tween?_arrayContainsAny(S._targets,n)&&(C?(!_overwritingTween||S._initted&&S._ts)&&S.globalTime(0)<=l&&S.globalTime(S.totalDuration())>l:!l||S.isActive())&&d.push(S):(I=S.getTweensOf(n,l)).length&&d.push.apply(d,I),S=S._next;return d},i.tweenTo=function(o,l){l=l||{};var d=this,n=_parsePosition$1(d,o),S=l,C=S.startAt,I=S.onStart,z=S.onStartParams,$=S.immediateRender,k,Y=Tween.to(d,_setDefaults$2({ease:l.ease||"none",lazy:!1,immediateRender:!1,time:n,overwrite:"auto",duration:l.duration||Math.abs((n-(C&&"time"in C?C.time:d._time))/d.timeScale())||_tinyNum,onStart:function(){if(d.pause(),!k){var ue=l.duration||Math.abs((n-(C&&"time"in C?C.time:d._time))/d.timeScale());Y._dur!==ue&&_setDuration(Y,ue,0,1).render(Y._time,!0,!0),k=1}I&&I.apply(Y,z||[])}},l));return $?Y.render(0):Y},i.tweenFromTo=function(o,l,d){return this.tweenTo(l,_setDefaults$2({startAt:{time:_parsePosition$1(this,o)}},d))},i.recent=function(){return this._recent},i.nextLabel=function(o){return o===void 0&&(o=this._time),_getLabelInDirection(this,_parsePosition$1(this,o))},i.previousLabel=function(o){return o===void 0&&(o=this._time),_getLabelInDirection(this,_parsePosition$1(this,o),1)},i.currentLabel=function(o){return arguments.length?this.seek(o,!0):this.previousLabel(this._time+_tinyNum)},i.shiftChildren=function(o,l,d){d===void 0&&(d=0);for(var n=this._first,S=this.labels,C;n;)n._start>=d&&(n._start+=o,n._end+=o),n=n._next;if(l)for(C in S)S[C]>=d&&(S[C]+=o);return _uncache(this)},i.invalidate=function(o){var l=this._first;for(this._lock=0;l;)l.invalidate(o),l=l._next;return e.prototype.invalidate.call(this,o)},i.clear=function(o){o===void 0&&(o=!0);for(var l=this._first,d;l;)d=l._next,this.remove(l),l=d;return this._dp&&(this._time=this._tTime=this._pTime=0),o&&(this.labels={}),_uncache(this)},i.totalDuration=function(o){var l=0,d=this,n=d._last,S=_bigNum$2,C,I,z;if(arguments.length)return d.timeScale((d._repeat<0?d.duration():d.totalDuration())/(d.reversed()?-o:o));if(d._dirty){for(z=d.parent;n;)C=n._prev,n._dirty&&n.totalDuration(),I=n._start,I>S&&d._sort&&n._ts&&!d._lock?(d._lock=1,_addToTimeline(d,n,I-n._delay,1)._lock=0):S=I,I<0&&n._ts&&(l-=I,(!z&&!d._dp||z&&z.smoothChildTiming)&&(d._start+=I/d._ts,d._time-=I,d._tTime-=I),d.shiftChildren(-I,!1,-1/0),S=0),n._end>l&&n._ts&&(l=n._end),n=C;_setDuration(d,d===_globalTimeline$1&&d._time>l?d._time:l,1,1),d._dirty=0}return d._tDur},t.updateRoot=function(o){if(_globalTimeline$1._ts&&(_lazySafeRender(_globalTimeline$1,_parentToChildTotalTime(o,_globalTimeline$1)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var l=_globalTimeline$1._first;if((!l||!l._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;l&&!l._ts;)l=l._next;l||_ticker.sleep()}}},t}(Animation$1);_setDefaults$2(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function(t,i,r,o,l,d,n){var S=new PropTween(this._pt,t,i,0,1,_renderComplexString,null,l),C=0,I=0,z,$,k,Y,ie,ue,ne,se;for(S.b=r,S.e=o,r+="",o+="",(ne=~o.indexOf("random("))&&(o=_replaceRandom(o)),d&&(se=[r,o],d(se,t,i),r=se[0],o=se[1]),$=r.match(_complexStringNumExp)||[];z=_complexStringNumExp.exec(o);)Y=z[0],ie=o.substring(C,z.index),k?k=(k+1)%5:ie.substr(-5)==="rgba("&&(k=1),Y!==$[I++]&&(ue=parseFloat($[I-1])||0,S._pt={_next:S._pt,p:ie||I===1?ie:",",s:ue,c:Y.charAt(1)==="="?_parseRelative(ue,Y)-ue:parseFloat(Y)-ue,m:k&&k<4?Math.round:0},C=_complexStringNumExp.lastIndex);return S.c=C<o.length?o.substring(C,o.length):"",S.fp=n,(_relExp.test(o)||ne)&&(S.e=0),this._pt=S,S},_addPropTween=function(t,i,r,o,l,d,n,S,C,I){_isFunction$3(o)&&(o=o(l||0,t,d));var z=t[i],$=r!=="get"?r:_isFunction$3(z)?C?t[i.indexOf("set")||!_isFunction$3(t["get"+i.substr(3)])?i:"get"+i.substr(3)](C):t[i]():z,k=_isFunction$3(z)?C?_setterFuncWithParam:_setterFunc:_setterPlain,Y;if(_isString$2(o)&&(~o.indexOf("random(")&&(o=_replaceRandom(o)),o.charAt(1)==="="&&(Y=_parseRelative($,o)+(getUnit($)||0),(Y||Y===0)&&(o=Y))),!I||$!==o||_forceAllPropTweens)return!isNaN($*o)&&o!==""?(Y=new PropTween(this._pt,t,i,+$||0,o-($||0),typeof z=="boolean"?_renderBoolean:_renderPlain,0,k),C&&(Y.fp=C),n&&Y.modifier(n,this,t),this._pt=Y):(!z&&!(i in t)&&_missingPlugin(i,o),_addComplexStringPropTween.call(this,t,i,$,o,k,S||_config.stringFilter,C))},_processVars=function(t,i,r,o,l){if(_isFunction$3(t)&&(t=_parseFuncOrString(t,l,i,r,o)),!_isObject$3(t)||t.style&&t.nodeType||_isArray$1(t)||_isTypedArray(t))return _isString$2(t)?_parseFuncOrString(t,l,i,r,o):t;var d={},n;for(n in t)d[n]=_parseFuncOrString(t[n],l,i,r,o);return d},_checkPlugin=function(t,i,r,o,l,d){var n,S,C,I;if(_plugins[t]&&(n=new _plugins[t]).init(l,n.rawVars?i[t]:_processVars(i[t],o,l,d,r),r,o,d)!==!1&&(r._pt=S=new PropTween(r._pt,l,t,0,1,n.render,n,0,n.priority),r!==_quickTween))for(C=r._ptLookup[r._targets.indexOf(l)],I=n._props.length;I--;)C[n._props[I]]=S;return n},_overwritingTween,_forceAllPropTweens,_initTween=function e(t,i,r){var o=t.vars,l=o.ease,d=o.startAt,n=o.immediateRender,S=o.lazy,C=o.onUpdate,I=o.runBackwards,z=o.yoyoEase,$=o.keyframes,k=o.autoRevert,Y=t._dur,ie=t._startAt,ue=t._targets,ne=t.parent,se=ne&&ne.data==="nested"?ne.vars.targets:ue,le=t._overwrite==="auto"&&!_suppressOverwrites$1,he=t.timeline,me,ge,xt,Et,Lt,Zt,Ht,It,Yt,ri,ei,Ct,Ut;if(he&&(!$||!l)&&(l="none"),t._ease=_parseEase(l,_defaults$1.ease),t._yEase=z?_invertEase(_parseEase(z===!0?l:z,_defaults$1.ease)):0,z&&t._yoyo&&!t._repeat&&(z=t._yEase,t._yEase=t._ease,t._ease=z),t._from=!he&&!!o.runBackwards,!he||$&&!o.stagger){if(It=ue[0]?_getCache(ue[0]).harness:0,Ct=It&&o[It.prop],me=_copyExcluding(o,_reservedProps),ie&&(ie._zTime<0&&ie.progress(1),i<0&&I&&n&&!k?ie.render(-1,!0):ie.revert(I&&Y?_revertConfigNoKill:_startAtRevertConfig),ie._lazy=0),d){if(_removeFromParent(t._startAt=Tween.set(ue,_setDefaults$2({data:"isStart",overwrite:!1,parent:ne,immediateRender:!0,lazy:!ie&&_isNotFalse(S),startAt:null,delay:0,onUpdate:C&&function(){return _callback$1(t,"onUpdate")},stagger:0},d))),t._startAt._dp=0,t._startAt._sat=t,i<0&&(_reverting$2||!n&&!k)&&t._startAt.revert(_revertConfigNoKill),n&&Y&&i<=0&&r<=0){i&&(t._zTime=i);return}}else if(I&&Y&&!ie){if(i&&(n=!1),xt=_setDefaults$2({overwrite:!1,data:"isFromStart",lazy:n&&!ie&&_isNotFalse(S),immediateRender:n,stagger:0,parent:ne},me),Ct&&(xt[It.prop]=Ct),_removeFromParent(t._startAt=Tween.set(ue,xt)),t._startAt._dp=0,t._startAt._sat=t,i<0&&(_reverting$2?t._startAt.revert(_revertConfigNoKill):t._startAt.render(-1,!0)),t._zTime=i,!n)e(t._startAt,_tinyNum,_tinyNum);else if(!i)return}for(t._pt=t._ptCache=0,S=Y&&_isNotFalse(S)||S&&!Y,ge=0;ge<ue.length;ge++){if(Lt=ue[ge],Ht=Lt._gsap||_harness(ue)[ge]._gsap,t._ptLookup[ge]=ri={},_lazyLookup[Ht.id]&&_lazyTweens.length&&_lazyRender(),ei=se===ue?ge:se.indexOf(Lt),It&&(Yt=new It).init(Lt,Ct||me,t,ei,se)!==!1&&(t._pt=Et=new PropTween(t._pt,Lt,Yt.name,0,1,Yt.render,Yt,0,Yt.priority),Yt._props.forEach(function(Mt){ri[Mt]=Et}),Yt.priority&&(Zt=1)),!It||Ct)for(xt in me)_plugins[xt]&&(Yt=_checkPlugin(xt,me,t,ei,Lt,se))?Yt.priority&&(Zt=1):ri[xt]=Et=_addPropTween.call(t,Lt,xt,"get",me[xt],ei,se,0,o.stringFilter);t._op&&t._op[ge]&&t.kill(Lt,t._op[ge]),le&&t._pt&&(_overwritingTween=t,_globalTimeline$1.killTweensOf(Lt,ri,t.globalTime(i)),Ut=!t.parent,_overwritingTween=0),t._pt&&S&&(_lazyLookup[Ht.id]=1)}Zt&&_sortPropTweensByPriority(t),t._onInit&&t._onInit(t)}t._onUpdate=C,t._initted=(!t._op||t._pt)&&!Ut,$&&i<=0&&he.render(_bigNum$2,!0,!0)},_updatePropTweens=function(t,i,r,o,l,d,n,S){var C=(t._pt&&t._ptCache||(t._ptCache={}))[i],I,z,$,k;if(!C)for(C=t._ptCache[i]=[],$=t._ptLookup,k=t._targets.length;k--;){if(I=$[k][i],I&&I.d&&I.d._pt)for(I=I.d._pt;I&&I.p!==i&&I.fp!==i;)I=I._next;if(!I)return _forceAllPropTweens=1,t.vars[i]="+=0",_initTween(t,n),_forceAllPropTweens=0,S?_warn$1(i+" not eligible for reset"):1;C.push(I)}for(k=C.length;k--;)z=C[k],I=z._pt||z,I.s=(o||o===0)&&!l?o:I.s+(o||0)+d*I.c,I.c=r-I.s,z.e&&(z.e=_round$3(r)+getUnit(z.e)),z.b&&(z.b=I.s+getUnit(z.b))},_addAliasesToVars=function(t,i){var r=t[0]?_getCache(t[0]).harness:0,o=r&&r.aliases,l,d,n,S;if(!o)return i;l=_merge$1({},i);for(d in o)if(d in l)for(S=o[d].split(","),n=S.length;n--;)l[S[n]]=l[d];return l},_parseKeyframe=function(t,i,r,o){var l=i.ease||o||"power1.inOut",d,n;if(_isArray$1(i))n=r[t]||(r[t]=[]),i.forEach(function(S,C){return n.push({t:C/(i.length-1)*100,v:S,e:l})});else for(d in i)n=r[d]||(r[d]=[]),d==="ease"||n.push({t:parseFloat(t),v:i[d],e:l})},_parseFuncOrString=function(t,i,r,o,l){return _isFunction$3(t)?t.call(i,r,o,l):_isString$2(t)&&~t.indexOf("random(")?_replaceRandom(t):t},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function(e){return _staggerPropsToSkip[e]=1});var Tween=function(e){_inheritsLoose$1(t,e);function t(r,o,l,d){var n;typeof o=="number"&&(l.duration=o,o=l,l=null),n=e.call(this,d?o:_inheritDefaults(o))||this;var S=n.vars,C=S.duration,I=S.delay,z=S.immediateRender,$=S.stagger,k=S.overwrite,Y=S.keyframes,ie=S.defaults,ue=S.scrollTrigger,ne=S.yoyoEase,se=o.parent||_globalTimeline$1,le=(_isArray$1(r)||_isTypedArray(r)?_isNumber$1(r[0]):"length"in o)?[r]:toArray(r),he,me,ge,xt,Et,Lt,Zt,Ht;if(n._targets=le.length?_harness(le):_warn$1("GSAP target "+r+" not found. https://gsap.com",!_config.nullTargetWarn)||[],n._ptLookup=[],n._overwrite=k,Y||$||_isFuncOrString(C)||_isFuncOrString(I)){if(o=n.vars,he=n.timeline=new Timeline({data:"nested",defaults:ie||{},targets:se&&se.data==="nested"?se.vars.targets:le}),he.kill(),he.parent=he._dp=_assertThisInitialized$1(n),he._start=0,$||_isFuncOrString(C)||_isFuncOrString(I)){if(xt=le.length,Zt=$&&distribute($),_isObject$3($))for(Et in $)~_staggerTweenProps.indexOf(Et)&&(Ht||(Ht={}),Ht[Et]=$[Et]);for(me=0;me<xt;me++)ge=_copyExcluding(o,_staggerPropsToSkip),ge.stagger=0,ne&&(ge.yoyoEase=ne),Ht&&_merge$1(ge,Ht),Lt=le[me],ge.duration=+_parseFuncOrString(C,_assertThisInitialized$1(n),me,Lt,le),ge.delay=(+_parseFuncOrString(I,_assertThisInitialized$1(n),me,Lt,le)||0)-n._delay,!$&&xt===1&&ge.delay&&(n._delay=I=ge.delay,n._start+=I,ge.delay=0),he.to(Lt,ge,Zt?Zt(me,Lt,le):0),he._ease=_easeMap.none;he.duration()?C=I=0:n.timeline=0}else if(Y){_inheritDefaults(_setDefaults$2(he.vars.defaults,{ease:"none"})),he._ease=_parseEase(Y.ease||o.ease||"none");var It=0,Yt,ri,ei;if(_isArray$1(Y))Y.forEach(function(Ct){return he.to(le,Ct,">")}),he.duration();else{ge={};for(Et in Y)Et==="ease"||Et==="easeEach"||_parseKeyframe(Et,Y[Et],ge,Y.easeEach);for(Et in ge)for(Yt=ge[Et].sort(function(Ct,Ut){return Ct.t-Ut.t}),It=0,me=0;me<Yt.length;me++)ri=Yt[me],ei={ease:ri.e,duration:(ri.t-(me?Yt[me-1].t:0))/100*C},ei[Et]=ri.v,he.to(le,ei,It),It+=ei.duration;he.duration()<C&&he.to({},{duration:C-he.duration()})}}C||n.duration(C=he.duration())}else n.timeline=0;return k===!0&&!_suppressOverwrites$1&&(_overwritingTween=_assertThisInitialized$1(n),_globalTimeline$1.killTweensOf(le),_overwritingTween=0),_addToTimeline(se,_assertThisInitialized$1(n),l),o.reversed&&n.reverse(),o.paused&&n.paused(!0),(z||!C&&!Y&&n._start===_roundPrecise(se._time)&&_isNotFalse(z)&&_hasNoPausedAncestors(_assertThisInitialized$1(n))&&se.data!=="nested")&&(n._tTime=-1e-8,n.render(Math.max(0,-I)||0)),ue&&_scrollTrigger(_assertThisInitialized$1(n),ue),n}var i=t.prototype;return i.render=function(o,l,d){var n=this._time,S=this._tDur,C=this._dur,I=o<0,z=o>S-_tinyNum&&!I?S:o<_tinyNum?0:o,$,k,Y,ie,ue,ne,se,le,he;if(!C)_renderZeroDurationTween(this,o,l,d);else if(z!==this._tTime||!o||d||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==I||this._lazy){if($=z,le=this.timeline,this._repeat){if(ie=C+this._rDelay,this._repeat<-1&&I)return this.totalTime(ie*100+o,l,d);if($=_roundPrecise(z%ie),z===S?(Y=this._repeat,$=C):(ue=_roundPrecise(z/ie),Y=~~ue,Y&&Y===ue?($=C,Y--):$>C&&($=C)),ne=this._yoyo&&Y&1,ne&&(he=this._yEase,$=C-$),ue=_animationCycle(this._tTime,ie),$===n&&!d&&this._initted&&Y===ue)return this._tTime=z,this;Y!==ue&&(le&&this._yEase&&_propagateYoyoEase(le,ne),this.vars.repeatRefresh&&!ne&&!this._lock&&$!==ie&&this._initted&&(this._lock=d=1,this.render(_roundPrecise(ie*Y),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,I?o:$,d,l,z))return this._tTime=0,this;if(n!==this._time&&!(d&&this.vars.repeatRefresh&&Y!==ue))return this;if(C!==this._dur)return this.render(o,l,d)}if(this._tTime=z,this._time=$,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=se=(he||this._ease)($/C),this._from&&(this.ratio=se=1-se),!n&&z&&!l&&!ue&&(_callback$1(this,"onStart"),this._tTime!==z))return this;for(k=this._pt;k;)k.r(se,k.d),k=k._next;le&&le.render(o<0?o:le._dur*le._ease($/this._dur),l,d)||this._startAt&&(this._zTime=o),this._onUpdate&&!l&&(I&&_rewindStartAt(this,o,l,d),_callback$1(this,"onUpdate")),this._repeat&&Y!==ue&&this.vars.onRepeat&&!l&&this.parent&&_callback$1(this,"onRepeat"),(z===this._tDur||!z)&&this._tTime===z&&(I&&!this._onUpdate&&_rewindStartAt(this,o,!0,!0),(o||!C)&&(z===this._tDur&&this._ts>0||!z&&this._ts<0)&&_removeFromParent(this,1),!l&&!(I&&!n)&&(z||n||ne)&&(_callback$1(this,z===S?"onComplete":"onReverseComplete",!0),this._prom&&!(z<S&&this.timeScale()>0)&&this._prom()))}return this},i.targets=function(){return this._targets},i.invalidate=function(o){return(!o||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(o),e.prototype.invalidate.call(this,o)},i.resetTo=function(o,l,d,n,S){_tickerActive||_ticker.wake(),this._ts||this.play();var C=Math.min(this._dur,(this._dp._time-this._start)*this._ts),I;return this._initted||_initTween(this,C),I=this._ease(C/this._dur),_updatePropTweens(this,o,l,d,n,I,C,S)?this.resetTo(o,l,d,n,1):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},i.kill=function(o,l){if(l===void 0&&(l="all"),!o&&(!l||l==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this.scrollTrigger&&this.scrollTrigger.kill(!!_reverting$2),this;if(this.timeline){var d=this.timeline.totalDuration();return this.timeline.killTweensOf(o,l,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&d!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/d,0,1),this}var n=this._targets,S=o?toArray(o):n,C=this._ptLookup,I=this._pt,z,$,k,Y,ie,ue,ne;if((!l||l==="all")&&_arraysMatch(n,S))return l==="all"&&(this._pt=0),_interrupt(this);for(z=this._op=this._op||[],l!=="all"&&(_isString$2(l)&&(ie={},_forEachName(l,function(se){return ie[se]=1}),l=ie),l=_addAliasesToVars(n,l)),ne=n.length;ne--;)if(~S.indexOf(n[ne])){$=C[ne],l==="all"?(z[ne]=l,Y=$,k={}):(k=z[ne]=z[ne]||{},Y=l);for(ie in Y)ue=$&&$[ie],ue&&((!("kill"in ue.d)||ue.d.kill(ie)===!0)&&_removeLinkedListItem(this,ue,"_pt"),delete $[ie]),k!=="all"&&(k[ie]=1)}return this._initted&&!this._pt&&I&&_interrupt(this),this},t.to=function(o,l){return new t(o,l,arguments[2])},t.from=function(o,l){return _createTweenType(1,arguments)},t.delayedCall=function(o,l,d,n){return new t(l,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:o,onComplete:l,onReverseComplete:l,onCompleteParams:d,onReverseCompleteParams:d,callbackScope:n})},t.fromTo=function(o,l,d){return _createTweenType(2,arguments)},t.set=function(o,l){return l.duration=0,l.repeatDelay||(l.repeat=0),new t(o,l)},t.killTweensOf=function(o,l,d){return _globalTimeline$1.killTweensOf(o,l,d)},t}(Animation$1);_setDefaults$2(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function(e){Tween[e]=function(){var t=new Timeline,i=_slice.call(arguments,0);return i.splice(e==="staggerFromTo"?5:4,0,0),t[e].apply(t,i)}});var _setterPlain=function(t,i,r){return t[i]=r},_setterFunc=function(t,i,r){return t[i](r)},_setterFuncWithParam=function(t,i,r,o){return t[i](o.fp,r)},_setterAttribute=function(t,i,r){return t.setAttribute(i,r)},_getSetter=function(t,i){return _isFunction$3(t[i])?_setterFunc:_isUndefined$2(t[i])&&t.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function(t,i){return i.set(i.t,i.p,Math.round((i.s+i.c*t)*1e6)/1e6,i)},_renderBoolean=function(t,i){return i.set(i.t,i.p,!!(i.s+i.c*t),i)},_renderComplexString=function(t,i){var r=i._pt,o="";if(!t&&i.b)o=i.b;else if(t===1&&i.e)o=i.e;else{for(;r;)o=r.p+(r.m?r.m(r.s+r.c*t):Math.round((r.s+r.c*t)*1e4)/1e4)+o,r=r._next;o+=i.c}i.set(i.t,i.p,o,i)},_renderPropTweens=function(t,i){for(var r=i._pt;r;)r.r(t,r.d),r=r._next},_addPluginModifier=function(t,i,r,o){for(var l=this._pt,d;l;)d=l._next,l.p===o&&l.modifier(t,i,r),l=d},_killPropTweensOf=function(t){for(var i=this._pt,r,o;i;)o=i._next,i.p===t&&!i.op||i.op===t?_removeLinkedListItem(this,i,"_pt"):i.dep||(r=1),i=o;return!r},_setterWithModifier=function(t,i,r,o){o.mSet(t,i,o.m.call(o.tween,r,o.mt),o)},_sortPropTweensByPriority=function(t){for(var i=t._pt,r,o,l,d;i;){for(r=i._next,o=l;o&&o.pr>i.pr;)o=o._next;(i._prev=o?o._prev:d)?i._prev._next=i:l=i,(i._next=o)?o._prev=i:d=i,i=r}t._pt=l},PropTween=function(){function e(i,r,o,l,d,n,S,C,I){this.t=r,this.s=l,this.c=d,this.p=o,this.r=n||_renderPlain,this.d=S||this,this.set=C||_setterPlain,this.pr=I||0,this._next=i,i&&(i._prev=this)}var t=e.prototype;return t.modifier=function(r,o,l){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=r,this.mt=l,this.tween=o},e}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(e){return _reservedProps[e]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline$1=new Timeline({sortChildren:!1,defaults:_defaults$1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners$1={},_emptyArray$2=[],_lastMediaTime=0,_contextID=0,_dispatch$1=function(t){return(_listeners$1[t]||_emptyArray$2).map(function(i){return i()})},_onMediaChange=function(){var t=Date.now(),i=[];t-_lastMediaTime>2&&(_dispatch$1("matchMediaInit"),_media.forEach(function(r){var o=r.queries,l=r.conditions,d,n,S,C;for(n in o)d=_win$7.matchMedia(o[n]).matches,d&&(S=1),d!==l[n]&&(l[n]=d,C=1);C&&(r.revert(),S&&i.push(r))}),_dispatch$1("matchMediaRevert"),i.forEach(function(r){return r.onMatch(r,function(o){return r.add(null,o)})}),_lastMediaTime=t,_dispatch$1("matchMedia"))},Context=function(){function e(i,r){this.selector=r&&selector(r),this.data=[],this._r=[],this.isReverted=!1,this.id=_contextID++,i&&this.add(i)}var t=e.prototype;return t.add=function(r,o,l){_isFunction$3(r)&&(l=o,o=r,r=_isFunction$3);var d=this,n=function(){var C=_context$6,I=d.selector,z;return C&&C!==d&&C.data.push(d),l&&(d.selector=selector(l)),_context$6=d,z=o.apply(d,arguments),_isFunction$3(z)&&d._r.push(z),_context$6=C,d.selector=I,d.isReverted=!1,z};return d.last=n,r===_isFunction$3?n(d,function(S){return d.add(null,S)}):r?d[r]=n:n},t.ignore=function(r){var o=_context$6;_context$6=null,r(this),_context$6=o},t.getTweens=function(){var r=[];return this.data.forEach(function(o){return o instanceof e?r.push.apply(r,o.getTweens()):o instanceof Tween&&!(o.parent&&o.parent.data==="nested")&&r.push(o)}),r},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(r,o){var l=this;if(r?function(){for(var n=l.getTweens(),S=l.data.length,C;S--;)C=l.data[S],C.data==="isFlip"&&(C.revert(),C.getChildren(!0,!0,!1).forEach(function(I){return n.splice(n.indexOf(I),1)}));for(n.map(function(I){return{g:I._dur||I._delay||I._sat&&!I._sat.vars.immediateRender?I.globalTime(0):-1/0,t:I}}).sort(function(I,z){return z.g-I.g||-1/0}).forEach(function(I){return I.t.revert(r)}),S=l.data.length;S--;)C=l.data[S],C instanceof Timeline?C.data!=="nested"&&(C.scrollTrigger&&C.scrollTrigger.revert(),C.kill()):!(C instanceof Tween)&&C.revert&&C.revert(r);l._r.forEach(function(I){return I(r,l)}),l.isReverted=!0}():this.data.forEach(function(n){return n.kill&&n.kill()}),this.clear(),o)for(var d=_media.length;d--;)_media[d].id===this.id&&_media.splice(d,1)},t.revert=function(r){this.kill(r||{})},e}(),MatchMedia=function(){function e(i){this.contexts=[],this.scope=i,_context$6&&_context$6.data.push(this)}var t=e.prototype;return t.add=function(r,o,l){_isObject$3(r)||(r={matches:r});var d=new Context(0,l||this.scope),n=d.conditions={},S,C,I;_context$6&&!d.selector&&(d.selector=_context$6.selector),this.contexts.push(d),o=d.add("onMatch",o),d.queries=r;for(C in r)C==="all"?I=1:(S=_win$7.matchMedia(r[C]),S&&(_media.indexOf(d)<0&&_media.push(d),(n[C]=S.matches)&&(I=1),S.addListener?S.addListener(_onMediaChange):S.addEventListener("change",_onMediaChange)));return I&&o(d,function(z){return d.add(null,z)}),this},t.revert=function(r){this.kill(r||{})},t.kill=function(r){this.contexts.forEach(function(o){return o.kill(r,!0)})},e}(),_gsap={registerPlugin:function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach(function(o){return _createPlugin(o)})},timeline:function(t){return new Timeline(t)},getTweensOf:function(t,i){return _globalTimeline$1.getTweensOf(t,i)},getProperty:function(t,i,r,o){_isString$2(t)&&(t=toArray(t)[0]);var l=_getCache(t||{}).get,d=r?_passThrough$1:_numericIfPossible;return r==="native"&&(r=""),t&&(i?d((_plugins[i]&&_plugins[i].get||l)(t,i,r,o)):function(n,S,C){return d((_plugins[n]&&_plugins[n].get||l)(t,n,S,C))})},quickSetter:function(t,i,r){if(t=toArray(t),t.length>1){var o=t.map(function(I){return gsap$6.quickSetter(I,i,r)}),l=o.length;return function(I){for(var z=l;z--;)o[z](I)}}t=t[0]||{};var d=_plugins[i],n=_getCache(t),S=n.harness&&(n.harness.aliases||{})[i]||i,C=d?function(I){var z=new d;_quickTween._pt=0,z.init(t,r?I+r:I,_quickTween,0,[t]),z.render(1,z),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:n.set(t,S);return d?C:function(I){return C(t,S,r?I+r:I,n,1)}},quickTo:function(t,i,r){var o,l=gsap$6.to(t,_setDefaults$2((o={},o[i]="+=0.1",o.paused=!0,o.stagger=0,o),r||{})),d=function(S,C,I){return l.resetTo(i,S,C,I)};return d.tween=l,d},isTweening:function(t){return _globalTimeline$1.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=_parseEase(t.ease,_defaults$1.ease)),_mergeDeep(_defaults$1,t||{})},config:function(t){return _mergeDeep(_config,t||{})},registerEffect:function(t){var i=t.name,r=t.effect,o=t.plugins,l=t.defaults,d=t.extendTimeline;(o||"").split(",").forEach(function(n){return n&&!_plugins[n]&&!_globals[n]&&_warn$1(i+" effect requires "+n+" plugin.")}),_effects[i]=function(n,S,C){return r(toArray(n),_setDefaults$2(S||{},l),C)},d&&(Timeline.prototype[i]=function(n,S,C){return this.add(_effects[i](n,_isObject$3(S)?S:(C=S)&&{},this),C)})},registerEase:function(t,i){_easeMap[t]=_parseEase(i)},parseEase:function(t,i){return arguments.length?_parseEase(t,i):_easeMap},getById:function(t){return _globalTimeline$1.getById(t)},exportRoot:function(t,i){t===void 0&&(t={});var r=new Timeline(t),o,l;for(r.smoothChildTiming=_isNotFalse(t.smoothChildTiming),_globalTimeline$1.remove(r),r._dp=0,r._time=r._tTime=_globalTimeline$1._time,o=_globalTimeline$1._first;o;)l=o._next,(i||!(!o._dur&&o instanceof Tween&&o.vars.onComplete===o._targets[0]))&&_addToTimeline(r,o,o._start-o._delay),o=l;return _addToTimeline(_globalTimeline$1,r,0),r},context:function(t,i){return t?new Context(t,i):_context$6},matchMedia:function(t){return new MatchMedia(t)},matchMediaRefresh:function(){return _media.forEach(function(t){var i=t.conditions,r,o;for(o in i)i[o]&&(i[o]=!1,r=1);r&&t.revert()})||_onMediaChange()},addEventListener:function(t,i){var r=_listeners$1[t]||(_listeners$1[t]=[]);~r.indexOf(i)||r.push(i)},removeEventListener:function(t,i){var r=_listeners$1[t],o=r&&r.indexOf(i);o>=0&&r.splice(o,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize,getUnit,clamp:clamp$1,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline$1,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation:Animation$1,getCache:_getCache,_removeLinkedListItem,reverting:function(){return _reverting$2},context:function(t){return t&&_context$6&&(_context$6.data.push(t),t._ctx=_context$6),_context$6},suppressOverwrites:function(t){return _suppressOverwrites$1=t}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function(e){return _gsap[e]=Tween[e]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function(t,i){for(var r=t._pt;r&&r.p!==i&&r.op!==i&&r.fp!==i;)r=r._next;return r},_addModifiers=function(t,i){var r=t._targets,o,l,d;for(o in i)for(l=r.length;l--;)d=t._ptLookup[l][o],d&&(d=d.d)&&(d._pt&&(d=_getPluginPropTween(d,o)),d&&d.modifier&&d.modifier(i[o],t,r[l],o))},_buildModifierPlugin=function(t,i){return{name:t,headless:1,rawVars:1,init:function(o,l,d){d._onInit=function(n){var S,C;if(_isString$2(l)&&(S={},_forEachName(l,function(I){return S[I]=1}),l=S),i){S={};for(C in l)S[C]=i(l[C]);l=S}_addModifiers(n,l)}}}},gsap$6=_gsap.registerPlugin({name:"attr",init:function(t,i,r,o,l){var d,n,S;this.tween=r;for(d in i)S=t.getAttribute(d)||"",n=this.add(t,"setAttribute",(S||0)+"",i[d],o,l,0,0,d),n.op=d,n.b=S,this._props.push(d)},render:function(t,i){for(var r=i._pt;r;)_reverting$2?r.set(r.t,r.p,r.b,r):r.r(t,r.d),r=r._next}},{name:"endArray",headless:1,init:function(t,i){for(var r=i.length;r--;)this.add(t,r,t[r]||0,i[r],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap$6.version="3.13.0";_coreReady=1;_windowExists$5()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var _win$6,_doc$5,_docElement$2,_pluginInitted,_tempDiv$1,_recentSetterPlugin,_reverting$1,_windowExists$4=function(){return typeof window<"u"},_transformProps={},_RAD2DEG$1=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum$1=1e8,_capsExp$1=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function(t,i){return i.set(i.t,i.p,Math.round((i.s+i.c*t)*1e4)/1e4+i.u,i)},_renderPropWithEnd=function(t,i){return i.set(i.t,i.p,t===1?i.e:Math.round((i.s+i.c*t)*1e4)/1e4+i.u,i)},_renderCSSPropWithBeginning=function(t,i){return i.set(i.t,i.p,t?Math.round((i.s+i.c*t)*1e4)/1e4+i.u:i.b,i)},_renderRoundedCSSProp=function(t,i){var r=i.s+i.c*t;i.set(i.t,i.p,~~(r+(r<0?-.5:.5))+i.u,i)},_renderNonTweeningValue=function(t,i){return i.set(i.t,i.p,t?i.e:i.b,i)},_renderNonTweeningValueOnlyAtEnd=function(t,i){return i.set(i.t,i.p,t!==1?i.b:i.e,i)},_setterCSSStyle=function(t,i,r){return t.style[i]=r},_setterCSSProp=function(t,i,r){return t.style.setProperty(i,r)},_setterTransform=function(t,i,r){return t._gsap[i]=r},_setterScale=function(t,i,r){return t._gsap.scaleX=t._gsap.scaleY=r},_setterScaleWithRender=function(t,i,r,o,l){var d=t._gsap;d.scaleX=d.scaleY=r,d.renderTransform(l,d)},_setterTransformWithRender=function(t,i,r,o,l){var d=t._gsap;d[i]=r,d.renderTransform(l,d)},_transformProp$3="transform",_transformOriginProp$2=_transformProp$3+"Origin",_saveStyle=function e(t,i){var r=this,o=this.target,l=o.style,d=o._gsap;if(t in _transformProps&&l){if(this.tfm=this.tfm||{},t!=="transform")t=_propertyAliases[t]||t,~t.indexOf(",")?t.split(",").forEach(function(n){return r.tfm[n]=_get(o,n)}):this.tfm[t]=d.x?d[t]:_get(o,t),t===_transformOriginProp$2&&(this.tfm.zOrigin=d.zOrigin);else return _propertyAliases.transform.split(",").forEach(function(n){return e.call(r,n,i)});if(this.props.indexOf(_transformProp$3)>=0)return;d.svg&&(this.svgo=o.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp$2,i,"")),t=_transformProp$3}(l||i)&&this.props.push(t,i,l[t])},_removeIndependentTransforms=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},_revertStyle=function(){var t=this.props,i=this.target,r=i.style,o=i._gsap,l,d;for(l=0;l<t.length;l+=3)t[l+1]?t[l+1]===2?i[t[l]](t[l+2]):i[t[l]]=t[l+2]:t[l+2]?r[t[l]]=t[l+2]:r.removeProperty(t[l].substr(0,2)==="--"?t[l]:t[l].replace(_capsExp$1,"-$1").toLowerCase());if(this.tfm){for(d in this.tfm)o[d]=this.tfm[d];o.svg&&(o.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),l=_reverting$1(),(!l||!l.isStart)&&!r[_transformProp$3]&&(_removeIndependentTransforms(r),o.zOrigin&&r[_transformOriginProp$2]&&(r[_transformOriginProp$2]+=" "+o.zOrigin+"px",o.zOrigin=0,o.renderTransform()),o.uncache=1)}},_getStyleSaver$2=function(t,i){var r={target:t,props:[],revert:_revertStyle,save:_saveStyle};return t._gsap||gsap$6.core.getCache(t),i&&t.style&&t.nodeType&&i.split(",").forEach(function(o){return r.save(o)}),r},_supports3D$1,_createElement$2=function(t,i){var r=_doc$5.createElementNS?_doc$5.createElementNS((i||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):_doc$5.createElement(t);return r&&r.style?r:_doc$5.createElement(t)},_getComputedProperty=function e(t,i,r){var o=getComputedStyle(t);return o[i]||o.getPropertyValue(i.replace(_capsExp$1,"-$1").toLowerCase())||o.getPropertyValue(i)||!r&&e(t,_checkPropPrefix(i)||i,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function(t,i,r){var o=i||_tempDiv$1,l=o.style,d=5;if(t in l&&!r)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);d--&&!(_prefixes[d]+t in l););return d<0?null:(d===3?"ms":d>=0?_prefixes[d]:"")+t},_initCore$4=function(){_windowExists$4()&&window.document&&(_win$6=window,_doc$5=_win$6.document,_docElement$2=_doc$5.documentElement,_tempDiv$1=_createElement$2("div")||{style:{}},_createElement$2("div"),_transformProp$3=_checkPropPrefix(_transformProp$3),_transformOriginProp$2=_transformProp$3+"Origin",_tempDiv$1.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D$1=!!_checkPropPrefix("perspective"),_reverting$1=gsap$6.core.reverting,_pluginInitted=1)},_getReparentedCloneBBox=function(t){var i=t.ownerSVGElement,r=_createElement$2("svg",i&&i.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),o=t.cloneNode(!0),l;o.style.display="block",r.appendChild(o),_docElement$2.appendChild(r);try{l=o.getBBox()}catch{}return r.removeChild(o),_docElement$2.removeChild(r),l},_getAttributeFallbacks=function(t,i){for(var r=i.length;r--;)if(t.hasAttribute(i[r]))return t.getAttribute(i[r])},_getBBox=function(t){var i,r;try{i=t.getBBox()}catch{i=_getReparentedCloneBBox(t),r=1}return i&&(i.width||i.height)||r||(i=_getReparentedCloneBBox(t)),i&&!i.width&&!i.x&&!i.y?{x:+_getAttributeFallbacks(t,["x","cx","x1"])||0,y:+_getAttributeFallbacks(t,["y","cy","y1"])||0,width:0,height:0}:i},_isSVG=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&_getBBox(t))},_removeProperty=function(t,i){if(i){var r=t.style,o;i in _transformProps&&i!==_transformOriginProp$2&&(i=_transformProp$3),r.removeProperty?(o=i.substr(0,2),(o==="ms"||i.substr(0,6)==="webkit")&&(i="-"+i),r.removeProperty(o==="--"?i:i.replace(_capsExp$1,"-$1").toLowerCase())):r.removeAttribute(i)}},_addNonTweeningPT=function(t,i,r,o,l,d){var n=new PropTween(t._pt,i,r,0,1,d?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return t._pt=n,n.b=o,n.e=l,t._props.push(r),n},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function e(t,i,r,o){var l=parseFloat(r)||0,d=(r+"").trim().substr((l+"").length)||"px",n=_tempDiv$1.style,S=_horizontalExp.test(i),C=t.tagName.toLowerCase()==="svg",I=(C?"client":"offset")+(S?"Width":"Height"),z=100,$=o==="px",k=o==="%",Y,ie,ue,ne;if(o===d||!l||_nonConvertibleUnits[o]||_nonConvertibleUnits[d])return l;if(d!=="px"&&!$&&(l=e(t,i,r,"px")),ne=t.getCTM&&_isSVG(t),(k||d==="%")&&(_transformProps[i]||~i.indexOf("adius")))return Y=ne?t.getBBox()[S?"width":"height"]:t[I],_round$3(k?l/Y*z:l/100*Y);if(n[S?"width":"height"]=z+($?d:o),ie=o!=="rem"&&~i.indexOf("adius")||o==="em"&&t.appendChild&&!C?t:t.parentNode,ne&&(ie=(t.ownerSVGElement||{}).parentNode),(!ie||ie===_doc$5||!ie.appendChild)&&(ie=_doc$5.body),ue=ie._gsap,ue&&k&&ue.width&&S&&ue.time===_ticker.time&&!ue.uncache)return _round$3(l/ue.width*z);if(k&&(i==="height"||i==="width")){var se=t.style[i];t.style[i]=z+o,Y=t[I],se?t.style[i]=se:_removeProperty(t,i)}else(k||d==="%")&&!_nonStandardLayouts[_getComputedProperty(ie,"display")]&&(n.position=_getComputedProperty(t,"position")),ie===t&&(n.position="static"),ie.appendChild(_tempDiv$1),Y=_tempDiv$1[I],ie.removeChild(_tempDiv$1),n.position="absolute";return S&&k&&(ue=_getCache(ie),ue.time=_ticker.time,ue.width=ie[I]),_round$3($?Y*l/z:Y&&l?z/Y*l:0)},_get=function(t,i,r,o){var l;return _pluginInitted||_initCore$4(),i in _propertyAliases&&i!=="transform"&&(i=_propertyAliases[i],~i.indexOf(",")&&(i=i.split(",")[0])),_transformProps[i]&&i!=="transform"?(l=_parseTransform(t,o),l=i!=="transformOrigin"?l[i]:l.svg?l.origin:_firstTwoOnly(_getComputedProperty(t,_transformOriginProp$2))+" "+l.zOrigin+"px"):(l=t.style[i],(!l||l==="auto"||o||~(l+"").indexOf("calc("))&&(l=_specialProps[i]&&_specialProps[i](t,i,r)||_getComputedProperty(t,i)||_getProperty(t,i)||(i==="opacity"?1:0))),r&&!~(l+"").trim().indexOf(" ")?_convertToUnit(t,i,l,r)+r:l},_tweenComplexCSSString=function(t,i,r,o){if(!r||r==="none"){var l=_checkPropPrefix(i,t,1),d=l&&_getComputedProperty(t,l,1);d&&d!==r?(i=l,r=d):i==="borderColor"&&(r=_getComputedProperty(t,"borderTopColor"))}var n=new PropTween(this._pt,t.style,i,0,1,_renderComplexString),S=0,C=0,I,z,$,k,Y,ie,ue,ne,se,le,he,me;if(n.b=r,n.e=o,r+="",o+="",o.substring(0,6)==="var(--"&&(o=_getComputedProperty(t,o.substring(4,o.indexOf(")")))),o==="auto"&&(ie=t.style[i],t.style[i]=o,o=_getComputedProperty(t,i)||o,ie?t.style[i]=ie:_removeProperty(t,i)),I=[r,o],_colorStringFilter(I),r=I[0],o=I[1],$=r.match(_numWithUnitExp)||[],me=o.match(_numWithUnitExp)||[],me.length){for(;z=_numWithUnitExp.exec(o);)ue=z[0],se=o.substring(S,z.index),Y?Y=(Y+1)%5:(se.substr(-5)==="rgba("||se.substr(-5)==="hsla(")&&(Y=1),ue!==(ie=$[C++]||"")&&(k=parseFloat(ie)||0,he=ie.substr((k+"").length),ue.charAt(1)==="="&&(ue=_parseRelative(k,ue)+he),ne=parseFloat(ue),le=ue.substr((ne+"").length),S=_numWithUnitExp.lastIndex-le.length,le||(le=le||_config.units[i]||he,S===o.length&&(o+=le,n.e+=le)),he!==le&&(k=_convertToUnit(t,i,ie,le)||0),n._pt={_next:n._pt,p:se||C===1?se:",",s:k,c:ne-k,m:Y&&Y<4||i==="zIndex"?Math.round:0});n.c=S<o.length?o.substring(S,o.length):""}else n.r=i==="display"&&o==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(o)&&(n.e=0),this._pt=n,n},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function(t){var i=t.split(" "),r=i[0],o=i[1]||"50%";return(r==="top"||r==="bottom"||o==="left"||o==="right")&&(t=r,r=o,o=t),i[0]=_keywordToPercent[r]||r,i[1]=_keywordToPercent[o]||o,i.join(" ")},_renderClearProps=function(t,i){if(i.tween&&i.tween._time===i.tween._dur){var r=i.t,o=r.style,l=i.u,d=r._gsap,n,S,C;if(l==="all"||l===!0)o.cssText="",S=1;else for(l=l.split(","),C=l.length;--C>-1;)n=l[C],_transformProps[n]&&(S=1,n=n==="transformOrigin"?_transformOriginProp$2:_transformProp$3),_removeProperty(r,n);S&&(_removeProperty(r,_transformProp$3),d&&(d.svg&&r.removeAttribute("transform"),o.scale=o.rotate=o.translate="none",_parseTransform(r,1),d.uncache=1,_removeIndependentTransforms(o)))}},_specialProps={clearProps:function(t,i,r,o,l){if(l.data!=="isFromStart"){var d=t._pt=new PropTween(t._pt,i,r,0,0,_renderClearProps);return d.u=o,d.pr=-10,d.tween=l,t._props.push(r),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},_getComputedTransformMatrixAsArray=function(t){var i=_getComputedProperty(t,_transformProp$3);return _isNullTransform(i)?_identity2DMatrix:i.substr(7).match(_numExp$1).map(_round$3)},_getMatrix=function(t,i){var r=t._gsap||_getCache(t),o=t.style,l=_getComputedTransformMatrixAsArray(t),d,n,S,C;return r.svg&&t.getAttribute("transform")?(S=t.transform.baseVal.consolidate().matrix,l=[S.a,S.b,S.c,S.d,S.e,S.f],l.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:l):(l===_identity2DMatrix&&!t.offsetParent&&t!==_docElement$2&&!r.svg&&(S=o.display,o.display="block",d=t.parentNode,(!d||!t.offsetParent&&!t.getBoundingClientRect().width)&&(C=1,n=t.nextElementSibling,_docElement$2.appendChild(t)),l=_getComputedTransformMatrixAsArray(t),S?o.display=S:_removeProperty(t,"display"),C&&(n?d.insertBefore(t,n):d?d.appendChild(t):_docElement$2.removeChild(t))),i&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},_applySVGOrigin=function(t,i,r,o,l,d){var n=t._gsap,S=l||_getMatrix(t,!0),C=n.xOrigin||0,I=n.yOrigin||0,z=n.xOffset||0,$=n.yOffset||0,k=S[0],Y=S[1],ie=S[2],ue=S[3],ne=S[4],se=S[5],le=i.split(" "),he=parseFloat(le[0])||0,me=parseFloat(le[1])||0,ge,xt,Et,Lt;r?S!==_identity2DMatrix&&(xt=k*ue-Y*ie)&&(Et=he*(ue/xt)+me*(-ie/xt)+(ie*se-ue*ne)/xt,Lt=he*(-Y/xt)+me*(k/xt)-(k*se-Y*ne)/xt,he=Et,me=Lt):(ge=_getBBox(t),he=ge.x+(~le[0].indexOf("%")?he/100*ge.width:he),me=ge.y+(~(le[1]||le[0]).indexOf("%")?me/100*ge.height:me)),o||o!==!1&&n.smooth?(ne=he-C,se=me-I,n.xOffset=z+(ne*k+se*ie)-ne,n.yOffset=$+(ne*Y+se*ue)-se):n.xOffset=n.yOffset=0,n.xOrigin=he,n.yOrigin=me,n.smooth=!!o,n.origin=i,n.originIsAbsolute=!!r,t.style[_transformOriginProp$2]="0px 0px",d&&(_addNonTweeningPT(d,n,"xOrigin",C,he),_addNonTweeningPT(d,n,"yOrigin",I,me),_addNonTweeningPT(d,n,"xOffset",z,n.xOffset),_addNonTweeningPT(d,n,"yOffset",$,n.yOffset)),t.setAttribute("data-svg-origin",he+" "+me)},_parseTransform=function(t,i){var r=t._gsap||new GSCache(t);if("x"in r&&!i&&!r.uncache)return r;var o=t.style,l=r.scaleX<0,d="px",n="deg",S=getComputedStyle(t),C=_getComputedProperty(t,_transformOriginProp$2)||"0",I,z,$,k,Y,ie,ue,ne,se,le,he,me,ge,xt,Et,Lt,Zt,Ht,It,Yt,ri,ei,Ct,Ut,Mt,$t,jt,mi,Xi,Er,Ir,nr;return I=z=$=ie=ue=ne=se=le=he=0,k=Y=1,r.svg=!!(t.getCTM&&_isSVG(t)),S.translate&&((S.translate!=="none"||S.scale!=="none"||S.rotate!=="none")&&(o[_transformProp$3]=(S.translate!=="none"?"translate3d("+(S.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(S.rotate!=="none"?"rotate("+S.rotate+") ":"")+(S.scale!=="none"?"scale("+S.scale.split(" ").join(",")+") ":"")+(S[_transformProp$3]!=="none"?S[_transformProp$3]:"")),o.scale=o.rotate=o.translate="none"),xt=_getMatrix(t,r.svg),r.svg&&(r.uncache?(Mt=t.getBBox(),C=r.xOrigin-Mt.x+"px "+(r.yOrigin-Mt.y)+"px",Ut=""):Ut=!i&&t.getAttribute("data-svg-origin"),_applySVGOrigin(t,Ut||C,!!Ut||r.originIsAbsolute,r.smooth!==!1,xt)),me=r.xOrigin||0,ge=r.yOrigin||0,xt!==_identity2DMatrix&&(Ht=xt[0],It=xt[1],Yt=xt[2],ri=xt[3],I=ei=xt[4],z=Ct=xt[5],xt.length===6?(k=Math.sqrt(Ht*Ht+It*It),Y=Math.sqrt(ri*ri+Yt*Yt),ie=Ht||It?_atan2(It,Ht)*_RAD2DEG$1:0,se=Yt||ri?_atan2(Yt,ri)*_RAD2DEG$1+ie:0,se&&(Y*=Math.abs(Math.cos(se*_DEG2RAD))),r.svg&&(I-=me-(me*Ht+ge*Yt),z-=ge-(me*It+ge*ri))):(nr=xt[6],Er=xt[7],jt=xt[8],mi=xt[9],Xi=xt[10],Ir=xt[11],I=xt[12],z=xt[13],$=xt[14],Et=_atan2(nr,Xi),ue=Et*_RAD2DEG$1,Et&&(Lt=Math.cos(-Et),Zt=Math.sin(-Et),Ut=ei*Lt+jt*Zt,Mt=Ct*Lt+mi*Zt,$t=nr*Lt+Xi*Zt,jt=ei*-Zt+jt*Lt,mi=Ct*-Zt+mi*Lt,Xi=nr*-Zt+Xi*Lt,Ir=Er*-Zt+Ir*Lt,ei=Ut,Ct=Mt,nr=$t),Et=_atan2(-Yt,Xi),ne=Et*_RAD2DEG$1,Et&&(Lt=Math.cos(-Et),Zt=Math.sin(-Et),Ut=Ht*Lt-jt*Zt,Mt=It*Lt-mi*Zt,$t=Yt*Lt-Xi*Zt,Ir=ri*Zt+Ir*Lt,Ht=Ut,It=Mt,Yt=$t),Et=_atan2(It,Ht),ie=Et*_RAD2DEG$1,Et&&(Lt=Math.cos(Et),Zt=Math.sin(Et),Ut=Ht*Lt+It*Zt,Mt=ei*Lt+Ct*Zt,It=It*Lt-Ht*Zt,Ct=Ct*Lt-ei*Zt,Ht=Ut,ei=Mt),ue&&Math.abs(ue)+Math.abs(ie)>359.9&&(ue=ie=0,ne=180-ne),k=_round$3(Math.sqrt(Ht*Ht+It*It+Yt*Yt)),Y=_round$3(Math.sqrt(Ct*Ct+nr*nr)),Et=_atan2(ei,Ct),se=Math.abs(Et)>2e-4?Et*_RAD2DEG$1:0,he=Ir?1/(Ir<0?-Ir:Ir):0),r.svg&&(Ut=t.getAttribute("transform"),r.forceCSS=t.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(t,_transformProp$3)),Ut&&t.setAttribute("transform",Ut))),Math.abs(se)>90&&Math.abs(se)<270&&(l?(k*=-1,se+=ie<=0?180:-180,ie+=ie<=0?180:-180):(Y*=-1,se+=se<=0?180:-180)),i=i||r.uncache,r.x=I-((r.xPercent=I&&(!i&&r.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-I)?-50:0)))?t.offsetWidth*r.xPercent/100:0)+d,r.y=z-((r.yPercent=z&&(!i&&r.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-z)?-50:0)))?t.offsetHeight*r.yPercent/100:0)+d,r.z=$+d,r.scaleX=_round$3(k),r.scaleY=_round$3(Y),r.rotation=_round$3(ie)+n,r.rotationX=_round$3(ue)+n,r.rotationY=_round$3(ne)+n,r.skewX=se+n,r.skewY=le+n,r.transformPerspective=he+d,(r.zOrigin=parseFloat(C.split(" ")[2])||!i&&r.zOrigin||0)&&(o[_transformOriginProp$2]=_firstTwoOnly(C)),r.xOffset=r.yOffset=0,r.force3D=_config.force3D,r.renderTransform=r.svg?_renderSVGTransforms:_supports3D$1?_renderCSSTransforms:_renderNon3DTransforms,r.uncache=0,r},_firstTwoOnly=function(t){return(t=t.split(" "))[0]+" "+t[1]},_addPxTranslate=function(t,i,r){var o=getUnit(i);return _round$3(parseFloat(i)+parseFloat(_convertToUnit(t,"x",r+"px",o)))+o},_renderNon3DTransforms=function(t,i){i.z="0px",i.rotationY=i.rotationX="0deg",i.force3D=0,_renderCSSTransforms(t,i)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function(t,i){var r=i||this,o=r.xPercent,l=r.yPercent,d=r.x,n=r.y,S=r.z,C=r.rotation,I=r.rotationY,z=r.rotationX,$=r.skewX,k=r.skewY,Y=r.scaleX,ie=r.scaleY,ue=r.transformPerspective,ne=r.force3D,se=r.target,le=r.zOrigin,he="",me=ne==="auto"&&t&&t!==1||ne===!0;if(le&&(z!==_zeroDeg||I!==_zeroDeg)){var ge=parseFloat(I)*_DEG2RAD,xt=Math.sin(ge),Et=Math.cos(ge),Lt;ge=parseFloat(z)*_DEG2RAD,Lt=Math.cos(ge),d=_addPxTranslate(se,d,xt*Lt*-le),n=_addPxTranslate(se,n,-Math.sin(ge)*-le),S=_addPxTranslate(se,S,Et*Lt*-le+le)}ue!==_zeroPx&&(he+="perspective("+ue+_endParenthesis),(o||l)&&(he+="translate("+o+"%, "+l+"%) "),(me||d!==_zeroPx||n!==_zeroPx||S!==_zeroPx)&&(he+=S!==_zeroPx||me?"translate3d("+d+", "+n+", "+S+") ":"translate("+d+", "+n+_endParenthesis),C!==_zeroDeg&&(he+="rotate("+C+_endParenthesis),I!==_zeroDeg&&(he+="rotateY("+I+_endParenthesis),z!==_zeroDeg&&(he+="rotateX("+z+_endParenthesis),($!==_zeroDeg||k!==_zeroDeg)&&(he+="skew("+$+", "+k+_endParenthesis),(Y!==1||ie!==1)&&(he+="scale("+Y+", "+ie+_endParenthesis),se.style[_transformProp$3]=he||"translate(0, 0)"},_renderSVGTransforms=function(t,i){var r=i||this,o=r.xPercent,l=r.yPercent,d=r.x,n=r.y,S=r.rotation,C=r.skewX,I=r.skewY,z=r.scaleX,$=r.scaleY,k=r.target,Y=r.xOrigin,ie=r.yOrigin,ue=r.xOffset,ne=r.yOffset,se=r.forceCSS,le=parseFloat(d),he=parseFloat(n),me,ge,xt,Et,Lt;S=parseFloat(S),C=parseFloat(C),I=parseFloat(I),I&&(I=parseFloat(I),C+=I,S+=I),S||C?(S*=_DEG2RAD,C*=_DEG2RAD,me=Math.cos(S)*z,ge=Math.sin(S)*z,xt=Math.sin(S-C)*-$,Et=Math.cos(S-C)*$,C&&(I*=_DEG2RAD,Lt=Math.tan(C-I),Lt=Math.sqrt(1+Lt*Lt),xt*=Lt,Et*=Lt,I&&(Lt=Math.tan(I),Lt=Math.sqrt(1+Lt*Lt),me*=Lt,ge*=Lt)),me=_round$3(me),ge=_round$3(ge),xt=_round$3(xt),Et=_round$3(Et)):(me=z,Et=$,ge=xt=0),(le&&!~(d+"").indexOf("px")||he&&!~(n+"").indexOf("px"))&&(le=_convertToUnit(k,"x",d,"px"),he=_convertToUnit(k,"y",n,"px")),(Y||ie||ue||ne)&&(le=_round$3(le+Y-(Y*me+ie*xt)+ue),he=_round$3(he+ie-(Y*ge+ie*Et)+ne)),(o||l)&&(Lt=k.getBBox(),le=_round$3(le+o/100*Lt.width),he=_round$3(he+l/100*Lt.height)),Lt="matrix("+me+","+ge+","+xt+","+Et+","+le+","+he+")",k.setAttribute("transform",Lt),se&&(k.style[_transformProp$3]=Lt)},_addRotationalPropTween=function(t,i,r,o,l){var d=360,n=_isString$2(l),S=parseFloat(l)*(n&&~l.indexOf("rad")?_RAD2DEG$1:1),C=S-o,I=o+C+"deg",z,$;return n&&(z=l.split("_")[1],z==="short"&&(C%=d,C!==C%(d/2)&&(C+=C<0?d:-360)),z==="cw"&&C<0?C=(C+d*_bigNum$1)%d-~~(C/d)*d:z==="ccw"&&C>0&&(C=(C-d*_bigNum$1)%d-~~(C/d)*d)),t._pt=$=new PropTween(t._pt,i,r,o,C,_renderPropWithEnd),$.e=I,$.u="deg",t._props.push(r),$},_assign=function(t,i){for(var r in i)t[r]=i[r];return t},_addRawTransformPTs=function(t,i,r){var o=_assign({},r._gsap),l="perspective,force3D,transformOrigin,svgOrigin",d=r.style,n,S,C,I,z,$,k,Y;o.svg?(C=r.getAttribute("transform"),r.setAttribute("transform",""),d[_transformProp$3]=i,n=_parseTransform(r,1),_removeProperty(r,_transformProp$3),r.setAttribute("transform",C)):(C=getComputedStyle(r)[_transformProp$3],d[_transformProp$3]=i,n=_parseTransform(r,1),d[_transformProp$3]=C);for(S in _transformProps)C=o[S],I=n[S],C!==I&&l.indexOf(S)<0&&(k=getUnit(C),Y=getUnit(I),z=k!==Y?_convertToUnit(r,S,C,Y):parseFloat(C),$=parseFloat(I),t._pt=new PropTween(t._pt,n,S,z,$-z,_renderCSSProp),t._pt.u=Y||0,t._props.push(S));_assign(n,o)};_forEachName("padding,margin,Width,Radius",function(e,t){var i="Top",r="Right",o="Bottom",l="Left",d=(t<3?[i,r,o,l]:[i+l,i+r,o+r,o+l]).map(function(n){return t<2?e+n:"border"+n+e});_specialProps[t>1?"border"+e:e]=function(n,S,C,I,z){var $,k;if(arguments.length<4)return $=d.map(function(Y){return _get(n,Y,C)}),k=$.join(" "),k.split($[0]).length===5?$[0]:k;$=(I+"").split(" "),k={},d.forEach(function(Y,ie){return k[Y]=$[ie]=$[ie]||$[(ie-1)/2|0]}),n.init(S,k,z)}});var CSSPlugin={name:"css",register:_initCore$4,targetTest:function(t){return t.style&&t.nodeType},init:function(t,i,r,o,l){var d=this._props,n=t.style,S=r.vars.startAt,C,I,z,$,k,Y,ie,ue,ne,se,le,he,me,ge,xt,Et;_pluginInitted||_initCore$4(),this.styles=this.styles||_getStyleSaver$2(t),Et=this.styles.props,this.tween=r;for(ie in i)if(ie!=="autoRound"&&(I=i[ie],!(_plugins[ie]&&_checkPlugin(ie,i,r,o,t,l)))){if(k=typeof I,Y=_specialProps[ie],k==="function"&&(I=I.call(r,o,t,l),k=typeof I),k==="string"&&~I.indexOf("random(")&&(I=_replaceRandom(I)),Y)Y(this,t,ie,I,r)&&(xt=1);else if(ie.substr(0,2)==="--")C=(getComputedStyle(t).getPropertyValue(ie)+"").trim(),I+="",_colorExp.lastIndex=0,_colorExp.test(C)||(ue=getUnit(C),ne=getUnit(I)),ne?ue!==ne&&(C=_convertToUnit(t,ie,C,ne)+ne):ue&&(I+=ue),this.add(n,"setProperty",C,I,o,l,0,0,ie),d.push(ie),Et.push(ie,0,n[ie]);else if(k!=="undefined"){if(S&&ie in S?(C=typeof S[ie]=="function"?S[ie].call(r,o,t,l):S[ie],_isString$2(C)&&~C.indexOf("random(")&&(C=_replaceRandom(C)),getUnit(C+"")||C==="auto"||(C+=_config.units[ie]||getUnit(_get(t,ie))||""),(C+"").charAt(1)==="="&&(C=_get(t,ie))):C=_get(t,ie),$=parseFloat(C),se=k==="string"&&I.charAt(1)==="="&&I.substr(0,2),se&&(I=I.substr(2)),z=parseFloat(I),ie in _propertyAliases&&(ie==="autoAlpha"&&($===1&&_get(t,"visibility")==="hidden"&&z&&($=0),Et.push("visibility",0,n.visibility),_addNonTweeningPT(this,n,"visibility",$?"inherit":"hidden",z?"inherit":"hidden",!z)),ie!=="scale"&&ie!=="transform"&&(ie=_propertyAliases[ie],~ie.indexOf(",")&&(ie=ie.split(",")[0]))),le=ie in _transformProps,le){if(this.styles.save(ie),k==="string"&&I.substring(0,6)==="var(--"&&(I=_getComputedProperty(t,I.substring(4,I.indexOf(")"))),z=parseFloat(I)),he||(me=t._gsap,me.renderTransform&&!i.parseTransform||_parseTransform(t,i.parseTransform),ge=i.smoothOrigin!==!1&&me.smooth,he=this._pt=new PropTween(this._pt,n,_transformProp$3,0,1,me.renderTransform,me,0,-1),he.dep=1),ie==="scale")this._pt=new PropTween(this._pt,me,"scaleY",me.scaleY,(se?_parseRelative(me.scaleY,se+z):z)-me.scaleY||0,_renderCSSProp),this._pt.u=0,d.push("scaleY",ie),ie+="X";else if(ie==="transformOrigin"){Et.push(_transformOriginProp$2,0,n[_transformOriginProp$2]),I=_convertKeywordsToPercentages(I),me.svg?_applySVGOrigin(t,I,0,ge,0,this):(ne=parseFloat(I.split(" ")[2])||0,ne!==me.zOrigin&&_addNonTweeningPT(this,me,"zOrigin",me.zOrigin,ne),_addNonTweeningPT(this,n,ie,_firstTwoOnly(C),_firstTwoOnly(I)));continue}else if(ie==="svgOrigin"){_applySVGOrigin(t,I,1,ge,0,this);continue}else if(ie in _rotationalProperties){_addRotationalPropTween(this,me,ie,$,se?_parseRelative($,se+I):I);continue}else if(ie==="smoothOrigin"){_addNonTweeningPT(this,me,"smooth",me.smooth,I);continue}else if(ie==="force3D"){me[ie]=I;continue}else if(ie==="transform"){_addRawTransformPTs(this,I,t);continue}}else ie in n||(ie=_checkPropPrefix(ie)||ie);if(le||(z||z===0)&&($||$===0)&&!_complexExp.test(I)&&ie in n)ue=(C+"").substr(($+"").length),z||(z=0),ne=getUnit(I)||(ie in _config.units?_config.units[ie]:ue),ue!==ne&&($=_convertToUnit(t,ie,C,ne)),this._pt=new PropTween(this._pt,le?me:n,ie,$,(se?_parseRelative($,se+z):z)-$,!le&&(ne==="px"||ie==="zIndex")&&i.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=ne||0,ue!==ne&&ne!=="%"&&(this._pt.b=C,this._pt.r=_renderCSSPropWithBeginning);else if(ie in n)_tweenComplexCSSString.call(this,t,ie,C,se?se+I:I);else if(ie in t)this.add(t,ie,C||t[ie],se?se+I:I,o,l);else if(ie!=="parseTransform"){_missingPlugin(ie,I);continue}le||(ie in n?Et.push(ie,0,n[ie]):typeof t[ie]=="function"?Et.push(ie,2,t[ie]()):Et.push(ie,1,C||t[ie])),d.push(ie)}}xt&&_sortPropTweensByPriority(this)},render:function(t,i){if(i.tween._time||!_reverting$1())for(var r=i._pt;r;)r.r(t,r.d),r=r._next;else i.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function(t,i,r){var o=_propertyAliases[i];return o&&o.indexOf(",")<0&&(i=o),i in _transformProps&&i!==_transformOriginProp$2&&(t._gsap.x||_get(t,"x"))?r&&_recentSetterPlugin===r?i==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=r||{})&&(i==="scale"?_setterScaleWithRender:_setterTransformWithRender):t.style&&!_isUndefined$2(t.style[i])?_setterCSSStyle:~i.indexOf("-")?_setterCSSProp:_getSetter(t,i)},core:{_removeProperty,_getMatrix}};gsap$6.utils.checkPrefix=_checkPropPrefix;gsap$6.core.getStyleSaver=_getStyleSaver$2;(function(e,t,i,r){var o=_forEachName(e+","+t+","+i,function(l){_transformProps[l]=1});_forEachName(t,function(l){_config.units[l]="deg",_rotationalProperties[l]=1}),_propertyAliases[o[13]]=e+","+t,_forEachName(r,function(l){var d=l.split(":");_propertyAliases[d[1]]=o[d[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(e){_config.units[e]="px"});gsap$6.registerPlugin(CSSPlugin);var gsapWithCSS=gsap$6.registerPlugin(CSSPlugin)||gsap$6;gsapWithCSS.core.Tween;let EventDispatcher$2=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const o=this._listeners[t];if(o!==void 0){const l=o.indexOf(i);l!==-1&&o.splice(l,1)}}dispatchEvent(t,i){const r=i?i.params:null,o=i?i.target:null;if(this._listeners===void 0)return;const d=this._listeners[t];if(d!==void 0){const n=d.slice(0);for(let S=0,C=n.length;S<C;S++)n[S]&&n[S].call(this,{event:t,params:r,target:o})}}};const TRANSITION_ENTER="transition_enter",TRANSITION_ENTER_DONE="transition_enter_done",TRANSITION_LEAVE="transition_leave",TRANSITION_LEAVE_DONE="transition_leave_done",PRELOADER_DONE="preloader_done";class DefaultEvents extends EventDispatcher$2{constructor(){super()}}const _Events=new DefaultEvents,Events=_Events,transitions=[];function addTextTransitions(e,t,i,r=.25){const o=new e(t,{type:"lines",linesClass:"text-appear__line"});gsapWithCSS.set(t,{alpha:0});const l=gsapWithCSS.timeline({scrollTrigger:{trigger:i}});l.set(t,{alpha:1}).from(o.lines,{y:"2rem",alpha:0,duration:.75,stagger:.1,ease:"power2.out"},r),transitions.push(l)}function addElementTransitions(e,t,i=.25){const r=gsapWithCSS.to(e,{y:0,alpha:1,duration:.75,stagger:o=>i+.1*o,ease:"power2.out",scrollTrigger:{trigger:t}});transitions.push(r)}function initElementAppears(){document.querySelectorAll("[data-appear-element]").forEach(t=>{addElementTransitions(t,t,Number(t.dataset.appearElement)||.25)})}function initTextAppears(e){document.querySelectorAll("[data-appear-text]").forEach(i=>{addTextTransitions(e,i,i,Number(i.dataset.appearText)||.25)})}const appear_client_QSSBpnX1nUESVH9z3IXtcZEY3BVqlibKSWIGbyPIRKg=defineNuxtPlugin(e=>{e.$router.beforeEach((t,i,r)=>{t.path===i.path&&transitions.length||(transitions.length&&transitions.forEach(o=>{o.scrollTrigger.kill(),o.kill()}),transitions.splice(0,transitions.length),r())}),e.$router.afterEach((t,i)=>{t.path===i.path&&transitions.length||(Events.addEventListener(TRANSITION_ENTER_DONE,initTextAppears.bind({},e.$splitText)),Events.addEventListener(TRANSITION_ENTER_DONE,initElementAppears))})});function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),e}/*!
 * Observer 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$5,_coreInitted$5,_win$5,_doc$4,_docEl$2,_body$3,_isTouch,_pointerType,ScrollTrigger$1,_root$1,_normalizer$1,_eventTypes,_context$5,_getGSAP$4=function(){return gsap$5||typeof window<"u"&&(gsap$5=window.gsap)&&gsap$5.registerPlugin&&gsap$5},_startup$1=1,_observers=[],_scrollers=[],_proxies=[],_getTime$2=Date.now,_bridge=function(t,i){return i},_integrate=function(){var t=ScrollTrigger$1.core,i=t.bridge||{},r=t._scrollers,o=t._proxies;r.push.apply(r,_scrollers),o.push.apply(o,_proxies),_scrollers=r,_proxies=o,_bridge=function(d,n){return i[d](n)}},_getProxyProp=function(t,i){return~_proxies.indexOf(t)&&_proxies[_proxies.indexOf(t)+1][i]},_isViewport$1=function(t){return!!~_root$1.indexOf(t)},_addListener$3=function(t,i,r,o,l){return t.addEventListener(i,r,{passive:o!==!1,capture:!!l})},_removeListener$3=function(t,i,r,o){return t.removeEventListener(i,r,!!o)},_scrollLeft="scrollLeft",_scrollTop="scrollTop",_onScroll$1=function(){return _normalizer$1&&_normalizer$1.isPressed||_scrollers.cache++},_scrollCacheFunc=function(t,i){var r=function o(l){if(l||l===0){_startup$1&&(_win$5.history.scrollRestoration="manual");var d=_normalizer$1&&_normalizer$1.isPressed;l=o.v=Math.round(l)||(_normalizer$1&&_normalizer$1.iOS?1:0),t(l),o.cacheID=_scrollers.cache,d&&_bridge("ss",l)}else(i||_scrollers.cache!==o.cacheID||_bridge("ref"))&&(o.cacheID=_scrollers.cache,o.v=t());return o.v+o.offset};return r.offset=0,t&&r},_horizontal={s:_scrollLeft,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:_scrollCacheFunc(function(e){return arguments.length?_win$5.scrollTo(e,_vertical.sc()):_win$5.pageXOffset||_doc$4[_scrollLeft]||_docEl$2[_scrollLeft]||_body$3[_scrollLeft]||0})},_vertical={s:_scrollTop,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_horizontal,sc:_scrollCacheFunc(function(e){return arguments.length?_win$5.scrollTo(_horizontal.sc(),e):_win$5.pageYOffset||_doc$4[_scrollTop]||_docEl$2[_scrollTop]||_body$3[_scrollTop]||0})},_getTarget=function(t,i){return(i&&i._ctx&&i._ctx.selector||gsap$5.utils.toArray)(t)[0]||(typeof t=="string"&&gsap$5.config().nullTargetWarn!==!1?console.warn("Element not found:",t):null)},_isWithin=function(t,i){for(var r=i.length;r--;)if(i[r]===t||i[r].contains(t))return!0;return!1},_getScrollFunc=function(t,i){var r=i.s,o=i.sc;_isViewport$1(t)&&(t=_doc$4.scrollingElement||_docEl$2);var l=_scrollers.indexOf(t),d=o===_vertical.sc?1:2;!~l&&(l=_scrollers.push(t)-1),_scrollers[l+d]||_addListener$3(t,"scroll",_onScroll$1);var n=_scrollers[l+d],S=n||(_scrollers[l+d]=_scrollCacheFunc(_getProxyProp(t,r),!0)||(_isViewport$1(t)?o:_scrollCacheFunc(function(C){return arguments.length?t[r]=C:t[r]})));return S.target=t,n||(S.smooth=gsap$5.getProperty(t,"scrollBehavior")==="smooth"),S},_getVelocityProp=function(t,i,r){var o=t,l=t,d=_getTime$2(),n=d,S=i||50,C=Math.max(500,S*3),I=function(Y,ie){var ue=_getTime$2();ie||ue-d>S?(l=o,o=Y,n=d,d=ue):r?o+=Y:o=l+(Y-l)/(ue-n)*(d-n)},z=function(){l=o=r?0:o,n=d=0},$=function(Y){var ie=n,ue=l,ne=_getTime$2();return(Y||Y===0)&&Y!==o&&I(Y),d===n||ne-n>C?0:(o+(r?ue:-ue))/((r?ne:d)-ie)*1e3};return{update:I,reset:z,getVelocity:$}},_getEvent=function(t,i){return i&&!t._gsapAllow&&t.preventDefault(),t.changedTouches?t.changedTouches[0]:t},_getAbsoluteMax=function(t){var i=Math.max.apply(Math,t),r=Math.min.apply(Math,t);return Math.abs(i)>=Math.abs(r)?i:r},_setScrollTrigger=function(){ScrollTrigger$1=gsap$5.core.globals().ScrollTrigger,ScrollTrigger$1&&ScrollTrigger$1.core&&_integrate()},_initCore$3=function(t){return gsap$5=t||_getGSAP$4(),!_coreInitted$5&&gsap$5&&typeof document<"u"&&document.body&&(_win$5=window,_doc$4=document,_docEl$2=_doc$4.documentElement,_body$3=_doc$4.body,_root$1=[_win$5,_doc$4,_docEl$2,_body$3],gsap$5.utils.clamp,_context$5=gsap$5.core.context||function(){},_pointerType="onpointerenter"in _body$3?"pointer":"mouse",_isTouch=Observer.isTouch=_win$5.matchMedia&&_win$5.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in _win$5||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_eventTypes=Observer.eventTypes=("ontouchstart"in _docEl$2?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in _docEl$2?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return _startup$1=0},500),_setScrollTrigger(),_coreInitted$5=1),_coreInitted$5};_horizontal.op=_vertical;_scrollers.cache=0;var Observer=function(){function e(i){this.init(i)}var t=e.prototype;return t.init=function(r){_coreInitted$5||_initCore$3(gsap$5)||console.warn("Please gsap.registerPlugin(Observer)"),ScrollTrigger$1||_setScrollTrigger();var o=r.tolerance,l=r.dragMinimum,d=r.type,n=r.target,S=r.lineHeight,C=r.debounce,I=r.preventDefault,z=r.onStop,$=r.onStopDelay,k=r.ignore,Y=r.wheelSpeed,ie=r.event,ue=r.onDragStart,ne=r.onDragEnd,se=r.onDrag,le=r.onPress,he=r.onRelease,me=r.onRight,ge=r.onLeft,xt=r.onUp,Et=r.onDown,Lt=r.onChangeX,Zt=r.onChangeY,Ht=r.onChange,It=r.onToggleX,Yt=r.onToggleY,ri=r.onHover,ei=r.onHoverEnd,Ct=r.onMove,Ut=r.ignoreCheck,Mt=r.isNormalizer,$t=r.onGestureStart,jt=r.onGestureEnd,mi=r.onWheel,Xi=r.onEnable,Er=r.onDisable,Ir=r.onClick,nr=r.scrollSpeed,si=r.capture,Gt=r.allowClicks,ui=r.lockAxis,oi=r.onLockAxis;this.target=n=_getTarget(n)||_docEl$2,this.vars=r,k&&(k=gsap$5.utils.toArray(k)),o=o||1e-9,l=l||0,Y=Y||1,nr=nr||1,d=d||"wheel,touch,pointer",C=C!==!1,S||(S=parseFloat(_win$5.getComputedStyle(_body$3).lineHeight)||22);var Si,Li,Mi,kt,Nt,gi,Ri,Rt=this,Xt=0,Hi=0,Ni=r.passive||!I&&r.passive!==!1,xi=_getScrollFunc(n,_horizontal),$i=_getScrollFunc(n,_vertical),fr=xi(),ir=$i(),lr=~d.indexOf("touch")&&!~d.indexOf("pointer")&&_eventTypes[0]==="pointerdown",Tr=_isViewport$1(n),Rr=n.ownerDocument||_doc$4,Jr=[0,0,0],_r=[0,0,0],mr=0,wr=function(){return mr=_getTime$2()},Vr=function(Ai,ii){return(Rt.event=Ai)&&k&&_isWithin(Ai.target,k)||ii&&lr&&Ai.pointerType!=="touch"||Ut&&Ut(Ai,ii)},wn=function(){Rt._vx.reset(),Rt._vy.reset(),Li.pause(),z&&z(Rt)},Nn=function(){var Ai=Rt.deltaX=_getAbsoluteMax(Jr),ii=Rt.deltaY=_getAbsoluteMax(_r),wt=Math.abs(Ai)>=o,Ft=Math.abs(ii)>=o;Ht&&(wt||Ft)&&Ht(Rt,Ai,ii,Jr,_r),wt&&(me&&Rt.deltaX>0&&me(Rt),ge&&Rt.deltaX<0&&ge(Rt),Lt&&Lt(Rt),It&&Rt.deltaX<0!=Xt<0&&It(Rt),Xt=Rt.deltaX,Jr[0]=Jr[1]=Jr[2]=0),Ft&&(Et&&Rt.deltaY>0&&Et(Rt),xt&&Rt.deltaY<0&&xt(Rt),Zt&&Zt(Rt),Yt&&Rt.deltaY<0!=Hi<0&&Yt(Rt),Hi=Rt.deltaY,_r[0]=_r[1]=_r[2]=0),(kt||Mi)&&(Ct&&Ct(Rt),Mi&&(ue&&Mi===1&&ue(Rt),se&&se(Rt),Mi=0),kt=!1),gi&&!(gi=!1)&&oi&&oi(Rt),Nt&&(mi(Rt),Nt=!1),Si=0},zs=function(Ai,ii,wt){Jr[wt]+=Ai,_r[wt]+=ii,Rt._vx.update(Ai),Rt._vy.update(ii),C?Si||(Si=requestAnimationFrame(Nn)):Nn()},es=function(Ai,ii){ui&&!Ri&&(Rt.axis=Ri=Math.abs(Ai)>Math.abs(ii)?"x":"y",gi=!0),Ri!=="y"&&(Jr[2]+=Ai,Rt._vx.update(Ai,!0)),Ri!=="x"&&(_r[2]+=ii,Rt._vy.update(ii,!0)),C?Si||(Si=requestAnimationFrame(Nn)):Nn()},As=function(Ai){if(!Vr(Ai,1)){Ai=_getEvent(Ai,I);var ii=Ai.clientX,wt=Ai.clientY,Ft=ii-Rt.x,Vt=wt-Rt.y,ni=Rt.isDragging;Rt.x=ii,Rt.y=wt,(ni||(Ft||Vt)&&(Math.abs(Rt.startX-ii)>=l||Math.abs(Rt.startY-wt)>=l))&&(Mi=ni?2:1,ni||(Rt.isDragging=!0),es(Ft,Vt))}},Dn=Rt.onPress=function(Ii){Vr(Ii,1)||Ii&&Ii.button||(Rt.axis=Ri=null,Li.pause(),Rt.isPressed=!0,Ii=_getEvent(Ii),Xt=Hi=0,Rt.startX=Rt.x=Ii.clientX,Rt.startY=Rt.y=Ii.clientY,Rt._vx.reset(),Rt._vy.reset(),_addListener$3(Mt?n:Rr,_eventTypes[1],As,Ni,!0),Rt.deltaX=Rt.deltaY=0,le&&le(Rt))},Sn=Rt.onRelease=function(Ii){if(!Vr(Ii,1)){_removeListener$3(Mt?n:Rr,_eventTypes[1],As,!0);var Ai=!isNaN(Rt.y-Rt.startY),ii=Rt.isDragging,wt=ii&&(Math.abs(Rt.x-Rt.startX)>3||Math.abs(Rt.y-Rt.startY)>3),Ft=_getEvent(Ii);!wt&&Ai&&(Rt._vx.reset(),Rt._vy.reset(),I&&Gt&&gsap$5.delayedCall(.08,function(){if(_getTime$2()-mr>300&&!Ii.defaultPrevented){if(Ii.target.click)Ii.target.click();else if(Rr.createEvent){var Vt=Rr.createEvent("MouseEvents");Vt.initMouseEvent("click",!0,!0,_win$5,1,Ft.screenX,Ft.screenY,Ft.clientX,Ft.clientY,!1,!1,!1,!1,0,null),Ii.target.dispatchEvent(Vt)}}})),Rt.isDragging=Rt.isGesturing=Rt.isPressed=!1,z&&ii&&!Mt&&Li.restart(!0),Mi&&Nn(),ne&&ii&&ne(Rt),he&&he(Rt,wt)}},Os=function(Ai){return Ai.touches&&Ai.touches.length>1&&(Rt.isGesturing=!0)&&$t(Ai,Rt.isDragging)},Un=function(){return(Rt.isGesturing=!1)||jt(Rt)},Ks=function(Ai){if(!Vr(Ai)){var ii=xi(),wt=$i();zs((ii-fr)*nr,(wt-ir)*nr,1),fr=ii,ir=wt,z&&Li.restart(!0)}},xs=function(Ai){if(!Vr(Ai)){Ai=_getEvent(Ai,I),mi&&(Nt=!0);var ii=(Ai.deltaMode===1?S:Ai.deltaMode===2?_win$5.innerHeight:1)*Y;zs(Ai.deltaX*ii,Ai.deltaY*ii,0),z&&!Mt&&Li.restart(!0)}},eo=function(Ai){if(!Vr(Ai)){var ii=Ai.clientX,wt=Ai.clientY,Ft=ii-Rt.x,Vt=wt-Rt.y;Rt.x=ii,Rt.y=wt,kt=!0,z&&Li.restart(!0),(Ft||Vt)&&es(Ft,Vt)}},rr=function(Ai){Rt.event=Ai,ri(Rt)},Ki=function(Ai){Rt.event=Ai,ei(Rt)},pi=function(Ai){return Vr(Ai)||_getEvent(Ai,I)&&Ir(Rt)};Li=Rt._dc=gsap$5.delayedCall($||.25,wn).pause(),Rt.deltaX=Rt.deltaY=0,Rt._vx=_getVelocityProp(0,50,!0),Rt._vy=_getVelocityProp(0,50,!0),Rt.scrollX=xi,Rt.scrollY=$i,Rt.isDragging=Rt.isGesturing=Rt.isPressed=!1,_context$5(this),Rt.enable=function(Ii){return Rt.isEnabled||(_addListener$3(Tr?Rr:n,"scroll",_onScroll$1),d.indexOf("scroll")>=0&&_addListener$3(Tr?Rr:n,"scroll",Ks,Ni,si),d.indexOf("wheel")>=0&&_addListener$3(n,"wheel",xs,Ni,si),(d.indexOf("touch")>=0&&_isTouch||d.indexOf("pointer")>=0)&&(_addListener$3(n,_eventTypes[0],Dn,Ni,si),_addListener$3(Rr,_eventTypes[2],Sn),_addListener$3(Rr,_eventTypes[3],Sn),Gt&&_addListener$3(n,"click",wr,!0,!0),Ir&&_addListener$3(n,"click",pi),$t&&_addListener$3(Rr,"gesturestart",Os),jt&&_addListener$3(Rr,"gestureend",Un),ri&&_addListener$3(n,_pointerType+"enter",rr),ei&&_addListener$3(n,_pointerType+"leave",Ki),Ct&&_addListener$3(n,_pointerType+"move",eo)),Rt.isEnabled=!0,Rt.isDragging=Rt.isGesturing=Rt.isPressed=kt=Mi=!1,Rt._vx.reset(),Rt._vy.reset(),fr=xi(),ir=$i(),Ii&&Ii.type&&Dn(Ii),Xi&&Xi(Rt)),Rt},Rt.disable=function(){Rt.isEnabled&&(_observers.filter(function(Ii){return Ii!==Rt&&_isViewport$1(Ii.target)}).length||_removeListener$3(Tr?Rr:n,"scroll",_onScroll$1),Rt.isPressed&&(Rt._vx.reset(),Rt._vy.reset(),_removeListener$3(Mt?n:Rr,_eventTypes[1],As,!0)),_removeListener$3(Tr?Rr:n,"scroll",Ks,si),_removeListener$3(n,"wheel",xs,si),_removeListener$3(n,_eventTypes[0],Dn,si),_removeListener$3(Rr,_eventTypes[2],Sn),_removeListener$3(Rr,_eventTypes[3],Sn),_removeListener$3(n,"click",wr,!0),_removeListener$3(n,"click",pi),_removeListener$3(Rr,"gesturestart",Os),_removeListener$3(Rr,"gestureend",Un),_removeListener$3(n,_pointerType+"enter",rr),_removeListener$3(n,_pointerType+"leave",Ki),_removeListener$3(n,_pointerType+"move",eo),Rt.isEnabled=Rt.isPressed=Rt.isDragging=!1,Er&&Er(Rt))},Rt.kill=Rt.revert=function(){Rt.disable();var Ii=_observers.indexOf(Rt);Ii>=0&&_observers.splice(Ii,1),_normalizer$1===Rt&&(_normalizer$1=0)},_observers.push(Rt),Mt&&_isViewport$1(n)&&(_normalizer$1=Rt),Rt.enable(ie)},_createClass(e,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),e}();Observer.version="3.13.0";Observer.create=function(e){return new Observer(e)};Observer.register=_initCore$3;Observer.getAll=function(){return _observers.slice()};Observer.getById=function(e){return _observers.filter(function(t){return t.vars.id===e})[0]};_getGSAP$4()&&gsap$5.registerPlugin(Observer);/*!
 * ScrollTrigger 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$4,_coreInitted$4,_win$4,_doc$3,_docEl$1,_body$2,_root,_resizeDelay,_toArray$3,_clamp,_time2,_syncInterval,_refreshing,_pointerIsDown,_transformProp$2,_i,_prevWidth,_prevHeight,_autoRefresh,_sort,_suppressOverwrites,_ignoreResize,_normalizer,_ignoreMobileResize,_baseScreenHeight,_baseScreenWidth,_fixIOSBug,_context$4,_scrollRestoration,_div100vh,_100vh,_isReverted,_clampingMax,_limitCallbacks,_startup=1,_getTime$1=Date.now,_time1=_getTime$1(),_lastScrollTime=0,_enabled=0,_parseClamp=function(t,i,r){var o=_isString$1(t)&&(t.substr(0,6)==="clamp("||t.indexOf("max")>-1);return r["_"+i+"Clamp"]=o,o?t.substr(6,t.length-7):t},_keepClamp=function(t,i){return i&&(!_isString$1(t)||t.substr(0,6)!=="clamp(")?"clamp("+t+")":t},_rafBugFix=function e(){return _enabled&&requestAnimationFrame(e)},_pointerDownHandler=function(){return _pointerIsDown=1},_pointerUpHandler=function(){return _pointerIsDown=0},_passThrough=function(t){return t},_round$2=function(t){return Math.round(t*1e5)/1e5||0},_windowExists$3=function(){return typeof window<"u"},_getGSAP$3=function(){return gsap$4||_windowExists$3()&&(gsap$4=window.gsap)&&gsap$4.registerPlugin&&gsap$4},_isViewport=function(t){return!!~_root.indexOf(t)},_getViewportDimension=function(t){return(t==="Height"?_100vh:_win$4["inner"+t])||_docEl$1["client"+t]||_body$2["client"+t]},_getBoundsFunc=function(t){return _getProxyProp(t,"getBoundingClientRect")||(_isViewport(t)?function(){return _winOffsets.width=_win$4.innerWidth,_winOffsets.height=_100vh,_winOffsets}:function(){return _getBounds$1(t)})},_getSizeFunc=function(t,i,r){var o=r.d,l=r.d2,d=r.a;return(d=_getProxyProp(t,"getBoundingClientRect"))?function(){return d()[o]}:function(){return(i?_getViewportDimension(l):t["client"+l])||0}},_getOffsetsFunc=function(t,i){return!i||~_proxies.indexOf(t)?_getBoundsFunc(t):function(){return _winOffsets}},_maxScroll=function(t,i){var r=i.s,o=i.d2,l=i.d,d=i.a;return Math.max(0,(r="scroll"+o)&&(d=_getProxyProp(t,r))?d()-_getBoundsFunc(t)()[l]:_isViewport(t)?(_docEl$1[r]||_body$2[r])-_getViewportDimension(o):t[r]-t["offset"+o])},_iterateAutoRefresh=function(t,i){for(var r=0;r<_autoRefresh.length;r+=3)(!i||~i.indexOf(_autoRefresh[r+1]))&&t(_autoRefresh[r],_autoRefresh[r+1],_autoRefresh[r+2])},_isString$1=function(t){return typeof t=="string"},_isFunction$2=function(t){return typeof t=="function"},_isNumber=function(t){return typeof t=="number"},_isObject$2=function(t){return typeof t=="object"},_endAnimation=function(t,i,r){return t&&t.progress(i?0:1)&&r&&t.pause()},_callback=function(t,i){if(t.enabled){var r=t._ctx?t._ctx.add(function(){return i(t)}):i(t);r&&r.totalTime&&(t.callbackAnimation=r)}},_abs=Math.abs,_left="left",_top="top",_right="right",_bottom="bottom",_width="width",_height="height",_Right="Right",_Left="Left",_Top="Top",_Bottom="Bottom",_padding="padding",_margin="margin",_Width="Width",_Height="Height",_px="px",_getComputedStyle$1=function(t){return _win$4.getComputedStyle(t)},_makePositionable=function(t){var i=_getComputedStyle$1(t).position;t.style.position=i==="absolute"||i==="fixed"?i:"relative"},_setDefaults$1=function(t,i){for(var r in i)r in t||(t[r]=i[r]);return t},_getBounds$1=function(t,i){var r=i&&_getComputedStyle$1(t)[_transformProp$2]!=="matrix(1, 0, 0, 1, 0, 0)"&&gsap$4.to(t,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),o=t.getBoundingClientRect();return r&&r.progress(0).kill(),o},_getSize=function(t,i){var r=i.d2;return t["offset"+r]||t["client"+r]||0},_getLabelRatioArray=function(t){var i=[],r=t.labels,o=t.duration(),l;for(l in r)i.push(r[l]/o);return i},_getClosestLabel=function(t){return function(i){return gsap$4.utils.snap(_getLabelRatioArray(t),i)}},_snapDirectional=function(t){var i=gsap$4.utils.snap(t),r=Array.isArray(t)&&t.slice(0).sort(function(o,l){return o-l});return r?function(o,l,d){d===void 0&&(d=.001);var n;if(!l)return i(o);if(l>0){for(o-=d,n=0;n<r.length;n++)if(r[n]>=o)return r[n];return r[n-1]}else for(n=r.length,o+=d;n--;)if(r[n]<=o)return r[n];return r[0]}:function(o,l,d){d===void 0&&(d=.001);var n=i(o);return!l||Math.abs(n-o)<d||n-o<0==l<0?n:i(l<0?o-t:o+t)}},_getLabelAtDirection=function(t){return function(i,r){return _snapDirectional(_getLabelRatioArray(t))(i,r.direction)}},_multiListener=function(t,i,r,o){return r.split(",").forEach(function(l){return t(i,l,o)})},_addListener$2=function(t,i,r,o,l){return t.addEventListener(i,r,{passive:!o,capture:!!l})},_removeListener$2=function(t,i,r,o){return t.removeEventListener(i,r,!!o)},_wheelListener=function(t,i,r){r=r&&r.wheelHandler,r&&(t(i,"wheel",r),t(i,"touchmove",r))},_markerDefaults={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},_defaults={toggleActions:"play",anticipatePin:0},_keywords={top:0,left:0,center:.5,bottom:1,right:1},_offsetToPx=function(t,i){if(_isString$1(t)){var r=t.indexOf("="),o=~r?+(t.charAt(r-1)+1)*parseFloat(t.substr(r+1)):0;~r&&(t.indexOf("%")>r&&(o*=i/100),t=t.substr(0,r-1)),t=o+(t in _keywords?_keywords[t]*i:~t.indexOf("%")?parseFloat(t)*i/100:parseFloat(t)||0)}return t},_createMarker=function(t,i,r,o,l,d,n,S){var C=l.startColor,I=l.endColor,z=l.fontSize,$=l.indent,k=l.fontWeight,Y=_doc$3.createElement("div"),ie=_isViewport(r)||_getProxyProp(r,"pinType")==="fixed",ue=t.indexOf("scroller")!==-1,ne=ie?_body$2:r,se=t.indexOf("start")!==-1,le=se?C:I,he="border-color:"+le+";font-size:"+z+";color:"+le+";font-weight:"+k+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return he+="position:"+((ue||S)&&ie?"fixed;":"absolute;"),(ue||S||!ie)&&(he+=(o===_vertical?_right:_bottom)+":"+(d+parseFloat($))+"px;"),n&&(he+="box-sizing:border-box;text-align:left;width:"+n.offsetWidth+"px;"),Y._isStart=se,Y.setAttribute("class","gsap-marker-"+t+(i?" marker-"+i:"")),Y.style.cssText=he,Y.innerText=i||i===0?t+"-"+i:t,ne.children[0]?ne.insertBefore(Y,ne.children[0]):ne.appendChild(Y),Y._offset=Y["offset"+o.op.d2],_positionMarker(Y,0,o,se),Y},_positionMarker=function(t,i,r,o){var l={display:"block"},d=r[o?"os2":"p2"],n=r[o?"p2":"os2"];t._isFlipped=o,l[r.a+"Percent"]=o?-100:0,l[r.a]=o?"1px":0,l["border"+d+_Width]=1,l["border"+n+_Width]=0,l[r.p]=i+"px",gsap$4.set(t,l)},_triggers=[],_ids={},_rafID,_sync=function(){return _getTime$1()-_lastScrollTime>34&&(_rafID||(_rafID=requestAnimationFrame(_updateAll)))},_onScroll=function(){(!_normalizer||!_normalizer.isPressed||_normalizer.startX>_body$2.clientWidth)&&(_scrollers.cache++,_normalizer?_rafID||(_rafID=requestAnimationFrame(_updateAll)):_updateAll(),_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime$1())},_setBaseDimensions=function(){_baseScreenWidth=_win$4.innerWidth,_baseScreenHeight=_win$4.innerHeight},_onResize=function(t){_scrollers.cache++,(t===!0||!_refreshing&&!_ignoreResize&&!_doc$3.fullscreenElement&&!_doc$3.webkitFullscreenElement&&(!_ignoreMobileResize||_baseScreenWidth!==_win$4.innerWidth||Math.abs(_win$4.innerHeight-_baseScreenHeight)>_win$4.innerHeight*.25))&&_resizeDelay.restart(!0)},_listeners={},_emptyArray$1=[],_softRefresh=function e(){return _removeListener$2(ScrollTrigger,"scrollEnd",e)||_refreshAll(!0)},_dispatch=function(t){return _listeners[t]&&_listeners[t].map(function(i){return i()})||_emptyArray$1},_savedStyles=[],_revertRecorded=function(t){for(var i=0;i<_savedStyles.length;i+=5)(!t||_savedStyles[i+4]&&_savedStyles[i+4].query===t)&&(_savedStyles[i].style.cssText=_savedStyles[i+1],_savedStyles[i].getBBox&&_savedStyles[i].setAttribute("transform",_savedStyles[i+2]||""),_savedStyles[i+3].uncache=1)},_revertAll=function(t,i){var r;for(_i=0;_i<_triggers.length;_i++)r=_triggers[_i],r&&(!i||r._ctx===i)&&(t?r.kill(1):r.revert(!0,!0));_isReverted=!0,i&&_revertRecorded(i),i||_dispatch("revert")},_clearScrollMemory=function(t,i){_scrollers.cache++,(i||!_refreshingAll)&&_scrollers.forEach(function(r){return _isFunction$2(r)&&r.cacheID++&&(r.rec=0)}),_isString$1(t)&&(_win$4.history.scrollRestoration=_scrollRestoration=t)},_refreshingAll,_refreshID=0,_queueRefreshID,_queueRefreshAll=function(){if(_queueRefreshID!==_refreshID){var t=_queueRefreshID=_refreshID;requestAnimationFrame(function(){return t===_refreshID&&_refreshAll(!0)})}},_refresh100vh=function(){_body$2.appendChild(_div100vh),_100vh=!_normalizer&&_div100vh.offsetHeight||_win$4.innerHeight,_body$2.removeChild(_div100vh)},_hideAllMarkers=function(t){return _toArray$3(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(i){return i.style.display=t?"none":"block"})},_refreshAll=function(t,i){if(_docEl$1=_doc$3.documentElement,_body$2=_doc$3.body,_root=[_win$4,_doc$3,_docEl$1,_body$2],_lastScrollTime&&!t&&!_isReverted){_addListener$2(ScrollTrigger,"scrollEnd",_softRefresh);return}_refresh100vh(),_refreshingAll=ScrollTrigger.isRefreshing=!0,_scrollers.forEach(function(o){return _isFunction$2(o)&&++o.cacheID&&(o.rec=o())});var r=_dispatch("refreshInit");_sort&&ScrollTrigger.sort(),i||_revertAll(),_scrollers.forEach(function(o){_isFunction$2(o)&&(o.smooth&&(o.target.style.scrollBehavior="auto"),o(0))}),_triggers.slice(0).forEach(function(o){return o.refresh()}),_isReverted=!1,_triggers.forEach(function(o){if(o._subPinOffset&&o.pin){var l=o.vars.horizontal?"offsetWidth":"offsetHeight",d=o.pin[l];o.revert(!0,1),o.adjustPinSpacing(o.pin[l]-d),o.refresh()}}),_clampingMax=1,_hideAllMarkers(!0),_triggers.forEach(function(o){var l=_maxScroll(o.scroller,o._dir),d=o.vars.end==="max"||o._endClamp&&o.end>l,n=o._startClamp&&o.start>=l;(d||n)&&o.setPositions(n?l-1:o.start,d?Math.max(n?l:o.start+1,l):o.end,!0)}),_hideAllMarkers(!1),_clampingMax=0,r.forEach(function(o){return o&&o.render&&o.render(-1)}),_scrollers.forEach(function(o){_isFunction$2(o)&&(o.smooth&&requestAnimationFrame(function(){return o.target.style.scrollBehavior="smooth"}),o.rec&&o(o.rec))}),_clearScrollMemory(_scrollRestoration,1),_resizeDelay.pause(),_refreshID++,_refreshingAll=2,_updateAll(2),_triggers.forEach(function(o){return _isFunction$2(o.vars.onRefresh)&&o.vars.onRefresh(o)}),_refreshingAll=ScrollTrigger.isRefreshing=!1,_dispatch("refresh")},_lastScroll=0,_direction=1,_primary,_updateAll=function(t){if(t===2||!_refreshingAll&&!_isReverted){ScrollTrigger.isUpdating=!0,_primary&&_primary.update(0);var i=_triggers.length,r=_getTime$1(),o=r-_time1>=50,l=i&&_triggers[0].scroll();if(_direction=_lastScroll>l?-1:1,_refreshingAll||(_lastScroll=l),o&&(_lastScrollTime&&!_pointerIsDown&&r-_lastScrollTime>200&&(_lastScrollTime=0,_dispatch("scrollEnd")),_time2=_time1,_time1=r),_direction<0){for(_i=i;_i-- >0;)_triggers[_i]&&_triggers[_i].update(0,o);_direction=1}else for(_i=0;_i<i;_i++)_triggers[_i]&&_triggers[_i].update(0,o);ScrollTrigger.isUpdating=!1}_rafID=0},_propNamesToCopy=[_left,_top,_bottom,_right,_margin+_Bottom,_margin+_Right,_margin+_Top,_margin+_Left,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],_stateProps=_propNamesToCopy.concat([_width,_height,"boxSizing","max"+_Width,"max"+_Height,"position",_margin,_padding,_padding+_Top,_padding+_Right,_padding+_Bottom,_padding+_Left]),_swapPinOut=function(t,i,r){_setState(r);var o=t._gsap;if(o.spacerIsNative)_setState(o.spacerState);else if(t._gsap.swappedIn){var l=i.parentNode;l&&(l.insertBefore(t,i),l.removeChild(i))}t._gsap.swappedIn=!1},_swapPinIn=function(t,i,r,o){if(!t._gsap.swappedIn){for(var l=_propNamesToCopy.length,d=i.style,n=t.style,S;l--;)S=_propNamesToCopy[l],d[S]=r[S];d.position=r.position==="absolute"?"absolute":"relative",r.display==="inline"&&(d.display="inline-block"),n[_bottom]=n[_right]="auto",d.flexBasis=r.flexBasis||"auto",d.overflow="visible",d.boxSizing="border-box",d[_width]=_getSize(t,_horizontal)+_px,d[_height]=_getSize(t,_vertical)+_px,d[_padding]=n[_margin]=n[_top]=n[_left]="0",_setState(o),n[_width]=n["max"+_Width]=r[_width],n[_height]=n["max"+_Height]=r[_height],n[_padding]=r[_padding],t.parentNode!==i&&(t.parentNode.insertBefore(i,t),i.appendChild(t)),t._gsap.swappedIn=!0}},_capsExp=/([A-Z])/g,_setState=function(t){if(t){var i=t.t.style,r=t.length,o=0,l,d;for((t.t._gsap||gsap$4.core.getCache(t.t)).uncache=1;o<r;o+=2)d=t[o+1],l=t[o],d?i[l]=d:i[l]&&i.removeProperty(l.replace(_capsExp,"-$1").toLowerCase())}},_getState=function(t){for(var i=_stateProps.length,r=t.style,o=[],l=0;l<i;l++)o.push(_stateProps[l],r[_stateProps[l]]);return o.t=t,o},_copyState=function(t,i,r){for(var o=[],l=t.length,d=r?8:0,n;d<l;d+=2)n=t[d],o.push(n,n in i?i[n]:t[d+1]);return o.t=t.t,o},_winOffsets={left:0,top:0},_parsePosition=function(t,i,r,o,l,d,n,S,C,I,z,$,k,Y){_isFunction$2(t)&&(t=t(S)),_isString$1(t)&&t.substr(0,3)==="max"&&(t=$+(t.charAt(4)==="="?_offsetToPx("0"+t.substr(3),r):0));var ie=k?k.time():0,ue,ne,se;if(k&&k.seek(0),isNaN(t)||(t=+t),_isNumber(t))k&&(t=gsap$4.utils.mapRange(k.scrollTrigger.start,k.scrollTrigger.end,0,$,t)),n&&_positionMarker(n,r,o,!0);else{_isFunction$2(i)&&(i=i(S));var le=(t||"0").split(" "),he,me,ge,xt;se=_getTarget(i,S)||_body$2,he=_getBounds$1(se)||{},(!he||!he.left&&!he.top)&&_getComputedStyle$1(se).display==="none"&&(xt=se.style.display,se.style.display="block",he=_getBounds$1(se),xt?se.style.display=xt:se.style.removeProperty("display")),me=_offsetToPx(le[0],he[o.d]),ge=_offsetToPx(le[1]||"0",r),t=he[o.p]-C[o.p]-I+me+l-ge,n&&_positionMarker(n,ge,o,r-ge<20||n._isStart&&ge>20),r-=r-ge}if(Y&&(S[Y]=t||-.001,t<0&&(t=0)),d){var Et=t+r,Lt=d._isStart;ue="scroll"+o.d2,_positionMarker(d,Et,o,Lt&&Et>20||!Lt&&(z?Math.max(_body$2[ue],_docEl$1[ue]):d.parentNode[ue])<=Et+1),z&&(C=_getBounds$1(n),z&&(d.style[o.op.p]=C[o.op.p]-o.op.m-d._offset+_px))}return k&&se&&(ue=_getBounds$1(se),k.seek($),ne=_getBounds$1(se),k._caScrollDist=ue[o.p]-ne[o.p],t=t/k._caScrollDist*$),k&&k.seek(ie),k?t:Math.round(t)},_prefixExp=/(webkit|moz|length|cssText|inset)/i,_reparent=function(t,i,r,o){if(t.parentNode!==i){var l=t.style,d,n;if(i===_body$2){t._stOrig=l.cssText,n=_getComputedStyle$1(t);for(d in n)!+d&&!_prefixExp.test(d)&&n[d]&&typeof l[d]=="string"&&d!=="0"&&(l[d]=n[d]);l.top=r,l.left=o}else l.cssText=t._stOrig;gsap$4.core.getCache(t).uncache=1,i.appendChild(t)}},_interruptionTracker=function(t,i,r){var o=i,l=o;return function(d){var n=Math.round(t());return n!==o&&n!==l&&Math.abs(n-o)>3&&Math.abs(n-l)>3&&(d=n,r&&r()),l=o,o=Math.round(d),o}},_shiftMarker=function(t,i,r){var o={};o[i.p]="+="+r,gsap$4.set(t,o)},_getTweenCreator=function(t,i){var r=_getScrollFunc(t,i),o="_scroll"+i.p2,l=function d(n,S,C,I,z){var $=d.tween,k=S.onComplete,Y={};C=C||r();var ie=_interruptionTracker(r,C,function(){$.kill(),d.tween=0});return z=I&&z||0,I=I||n-C,$&&$.kill(),S[o]=n,S.inherit=!1,S.modifiers=Y,Y[o]=function(){return ie(C+I*$.ratio+z*$.ratio*$.ratio)},S.onUpdate=function(){_scrollers.cache++,d.tween&&_updateAll()},S.onComplete=function(){d.tween=0,k&&k.call($)},$=d.tween=gsap$4.to(t,S),$};return t[o]=r,r.wheelHandler=function(){return l.tween&&l.tween.kill()&&(l.tween=0)},_addListener$2(t,"wheel",r.wheelHandler),ScrollTrigger.isTouch&&_addListener$2(t,"touchmove",r.wheelHandler),l},ScrollTrigger=function(){function e(i,r){_coreInitted$4||e.register(gsap$4)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),_context$4(this),this.init(i,r)}var t=e.prototype;return t.init=function(r,o){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!_enabled){this.update=this.refresh=this.kill=_passThrough;return}r=_setDefaults$1(_isString$1(r)||_isNumber(r)||r.nodeType?{trigger:r}:r,_defaults);var l=r,d=l.onUpdate,n=l.toggleClass,S=l.id,C=l.onToggle,I=l.onRefresh,z=l.scrub,$=l.trigger,k=l.pin,Y=l.pinSpacing,ie=l.invalidateOnRefresh,ue=l.anticipatePin,ne=l.onScrubComplete,se=l.onSnapComplete,le=l.once,he=l.snap,me=l.pinReparent,ge=l.pinSpacer,xt=l.containerAnimation,Et=l.fastScrollEnd,Lt=l.preventOverlaps,Zt=r.horizontal||r.containerAnimation&&r.horizontal!==!1?_horizontal:_vertical,Ht=!z&&z!==0,It=_getTarget(r.scroller||_win$4),Yt=gsap$4.core.getCache(It),ri=_isViewport(It),ei=("pinType"in r?r.pinType:_getProxyProp(It,"pinType")||ri&&"fixed")==="fixed",Ct=[r.onEnter,r.onLeave,r.onEnterBack,r.onLeaveBack],Ut=Ht&&r.toggleActions.split(" "),Mt="markers"in r?r.markers:_defaults.markers,$t=ri?0:parseFloat(_getComputedStyle$1(It)["border"+Zt.p2+_Width])||0,jt=this,mi=r.onRefreshInit&&function(){return r.onRefreshInit(jt)},Xi=_getSizeFunc(It,ri,Zt),Er=_getOffsetsFunc(It,ri),Ir=0,nr=0,si=0,Gt=_getScrollFunc(It,Zt),ui,oi,Si,Li,Mi,kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi,$i,fr,ir,lr,Tr,Rr,Jr,_r,mr,wr,Vr,wn,Nn,zs,es,As,Dn,Sn,Os,Un,Ks,xs,eo,rr,Ki;if(jt._startClamp=jt._endClamp=!1,jt._dir=Zt,ue*=45,jt.scroller=It,jt.scroll=xt?xt.time.bind(xt):Gt,Li=Gt(),jt.vars=r,o=o||r.animation,"refreshPriority"in r&&(_sort=1,r.refreshPriority===-9999&&(_primary=jt)),Yt.tweenScroll=Yt.tweenScroll||{top:_getTweenCreator(It,_vertical),left:_getTweenCreator(It,_horizontal)},jt.tweenTo=ui=Yt.tweenScroll[Zt.p],jt.scrubDuration=function(wt){Os=_isNumber(wt)&&wt,Os?Sn?Sn.duration(wt):Sn=gsap$4.to(o,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:Os,paused:!0,onComplete:function(){return ne&&ne(jt)}}):(Sn&&Sn.progress(1).kill(),Sn=0)},o&&(o.vars.lazy=!1,o._initted&&!jt.isReverted||o.vars.immediateRender!==!1&&r.immediateRender!==!1&&o.duration()&&o.render(0,!0,!0),jt.animation=o.pause(),o.scrollTrigger=jt,jt.scrubDuration(z),As=0,S||(S=o.vars.id)),he&&((!_isObject$2(he)||he.push)&&(he={snapTo:he}),"scrollBehavior"in _body$2.style&&gsap$4.set(ri?[_body$2,_docEl$1]:It,{scrollBehavior:"auto"}),_scrollers.forEach(function(wt){return _isFunction$2(wt)&&wt.target===(ri?_doc$3.scrollingElement||_docEl$1:It)&&(wt.smooth=!1)}),Si=_isFunction$2(he.snapTo)?he.snapTo:he.snapTo==="labels"?_getClosestLabel(o):he.snapTo==="labelsDirectional"?_getLabelAtDirection(o):he.directional!==!1?function(wt,Ft){return _snapDirectional(he.snapTo)(wt,_getTime$1()-nr<500?0:Ft.direction)}:gsap$4.utils.snap(he.snapTo),Un=he.duration||{min:.1,max:2},Un=_isObject$2(Un)?_clamp(Un.min,Un.max):_clamp(Un,Un),Ks=gsap$4.delayedCall(he.delay||Os/2||.1,function(){var wt=Gt(),Ft=_getTime$1()-nr<500,Vt=ui.tween;if((Ft||Math.abs(jt.getVelocity())<10)&&!Vt&&!_pointerIsDown&&Ir!==wt){var ni=(wt-kt)/xi,Jt=o&&!Ht?o.totalProgress():ni,yi=Ft?0:(Jt-Dn)/(_getTime$1()-_time2)*1e3||0,Fi=gsap$4.utils.clamp(-ni,1-ni,_abs(yi/2)*yi/.185),bi=ni+(he.inertia===!1?0:Fi),Oi,qi,Bi=he,dr=Bi.onStart,pr=Bi.onInterrupt,Nr=Bi.onComplete;if(Oi=Si(bi,jt),_isNumber(Oi)||(Oi=bi),qi=Math.max(0,Math.round(kt+Oi*xi)),wt<=Nt&&wt>=kt&&qi!==wt){if(Vt&&!Vt._initted&&Vt.data<=_abs(qi-wt))return;he.inertia===!1&&(Fi=Oi-ni),ui(qi,{duration:Un(_abs(Math.max(_abs(bi-Jt),_abs(Oi-Jt))*.185/yi/.05||0)),ease:he.ease||"power3",data:_abs(qi-wt),onInterrupt:function(){return Ks.restart(!0)&&pr&&pr(jt)},onComplete:function(){jt.update(),Ir=Gt(),o&&!Ht&&(Sn?Sn.resetTo("totalProgress",Oi,o._tTime/o._tDur):o.progress(Oi)),As=Dn=o&&!Ht?o.totalProgress():jt.progress,se&&se(jt),Nr&&Nr(jt)}},wt,Fi*xi,qi-wt-Fi*xi),dr&&dr(jt,ui.tween)}}else jt.isActive&&Ir!==wt&&Ks.restart(!0)}).pause()),S&&(_ids[S]=jt),$=jt.trigger=_getTarget($||k!==!0&&k),Ki=$&&$._gsap&&$._gsap.stRevert,Ki&&(Ki=Ki(jt)),k=k===!0?$:_getTarget(k),_isString$1(n)&&(n={targets:$,className:n}),k&&(Y===!1||Y===_margin||(Y=!Y&&k.parentNode&&k.parentNode.style&&_getComputedStyle$1(k.parentNode).display==="flex"?!1:_padding),jt.pin=k,oi=gsap$4.core.getCache(k),oi.spacer?$i=oi.pinState:(ge&&(ge=_getTarget(ge),ge&&!ge.nodeType&&(ge=ge.current||ge.nativeElement),oi.spacerIsNative=!!ge,ge&&(oi.spacerState=_getState(ge))),oi.spacer=lr=ge||_doc$3.createElement("div"),lr.classList.add("pin-spacer"),S&&lr.classList.add("pin-spacer-"+S),oi.pinState=$i=_getState(k)),r.force3D!==!1&&gsap$4.set(k,{force3D:!0}),jt.spacer=lr=oi.spacer,es=_getComputedStyle$1(k),wr=es[Y+Zt.os2],Rr=gsap$4.getProperty(k),Jr=gsap$4.quickSetter(k,Zt.a,_px),_swapPinIn(k,lr,es),ir=_getState(k)),Mt){Hi=_isObject$2(Mt)?_setDefaults$1(Mt,_markerDefaults):_markerDefaults,Rt=_createMarker("scroller-start",S,It,Zt,Hi,0),Xt=_createMarker("scroller-end",S,It,Zt,Hi,0,Rt),Tr=Rt["offset"+Zt.op.d2];var pi=_getTarget(_getProxyProp(It,"content")||It);gi=this.markerStart=_createMarker("start",S,pi,Zt,Hi,Tr,0,xt),Ri=this.markerEnd=_createMarker("end",S,pi,Zt,Hi,Tr,0,xt),xt&&(rr=gsap$4.quickSetter([gi,Ri],Zt.a,_px)),!ei&&!(_proxies.length&&_getProxyProp(It,"fixedMarkers")===!0)&&(_makePositionable(ri?_body$2:It),gsap$4.set([Rt,Xt],{force3D:!0}),wn=gsap$4.quickSetter(Rt,Zt.a,_px),zs=gsap$4.quickSetter(Xt,Zt.a,_px))}if(xt){var Ii=xt.vars.onUpdate,Ai=xt.vars.onUpdateParams;xt.eventCallback("onUpdate",function(){jt.update(0,0,1),Ii&&Ii.apply(xt,Ai||[])})}if(jt.previous=function(){return _triggers[_triggers.indexOf(jt)-1]},jt.next=function(){return _triggers[_triggers.indexOf(jt)+1]},jt.revert=function(wt,Ft){if(!Ft)return jt.kill(!0);var Vt=wt!==!1||!jt.enabled,ni=_refreshing;Vt!==jt.isReverted&&(Vt&&(xs=Math.max(Gt(),jt.scroll.rec||0),si=jt.progress,eo=o&&o.progress()),gi&&[gi,Ri,Rt,Xt].forEach(function(Jt){return Jt.style.display=Vt?"none":"block"}),Vt&&(_refreshing=jt,jt.update(Vt)),k&&(!me||!jt.isActive)&&(Vt?_swapPinOut(k,lr,$i):_swapPinIn(k,lr,_getComputedStyle$1(k),Vr)),Vt||jt.update(Vt),_refreshing=ni,jt.isReverted=Vt)},jt.refresh=function(wt,Ft,Vt,ni){if(!((_refreshing||!jt.enabled)&&!Ft)){if(k&&wt&&_lastScrollTime){_addListener$2(e,"scrollEnd",_softRefresh);return}!_refreshingAll&&mi&&mi(jt),_refreshing=jt,ui.tween&&!Vt&&(ui.tween.kill(),ui.tween=0),Sn&&Sn.pause(),ie&&o&&(o.revert({kill:!1}).invalidate(),o.getChildren&&o.getChildren(!0,!0,!1).forEach(function(Qs){return Qs.vars.immediateRender&&Qs.render(0,!0,!0)})),jt.isReverted||jt.revert(!0,!0),jt._subPinOffset=!1;var Jt=Xi(),yi=Er(),Fi=xt?xt.duration():_maxScroll(It,Zt),bi=xi<=.01||!xi,Oi=0,qi=ni||0,Bi=_isObject$2(Vt)?Vt.end:r.end,dr=r.endTrigger||$,pr=_isObject$2(Vt)?Vt.start:r.start||(r.start===0||!$?0:k?"0 0":"0 100%"),Nr=jt.pinnedContainer=r.pinnedContainer&&_getTarget(r.pinnedContainer,jt),Gr=$&&Math.max(0,_triggers.indexOf(jt))||0,rn=Gr,sn,hn,yn,ts,Hn,Vn,Gn,qn,Bs,bs,ls,Js,uo;for(Mt&&_isObject$2(Vt)&&(Js=gsap$4.getProperty(Rt,Zt.p),uo=gsap$4.getProperty(Xt,Zt.p));rn-- >0;)Vn=_triggers[rn],Vn.end||Vn.refresh(0,1)||(_refreshing=jt),Gn=Vn.pin,Gn&&(Gn===$||Gn===k||Gn===Nr)&&!Vn.isReverted&&(bs||(bs=[]),bs.unshift(Vn),Vn.revert(!0,!0)),Vn!==_triggers[rn]&&(Gr--,rn--);for(_isFunction$2(pr)&&(pr=pr(jt)),pr=_parseClamp(pr,"start",jt),kt=_parsePosition(pr,$,Jt,Zt,Gt(),gi,Rt,jt,yi,$t,ei,Fi,xt,jt._startClamp&&"_startClamp")||(k?-.001:0),_isFunction$2(Bi)&&(Bi=Bi(jt)),_isString$1(Bi)&&!Bi.indexOf("+=")&&(~Bi.indexOf(" ")?Bi=(_isString$1(pr)?pr.split(" ")[0]:"")+Bi:(Oi=_offsetToPx(Bi.substr(2),Jt),Bi=_isString$1(pr)?pr:(xt?gsap$4.utils.mapRange(0,xt.duration(),xt.scrollTrigger.start,xt.scrollTrigger.end,kt):kt)+Oi,dr=$)),Bi=_parseClamp(Bi,"end",jt),Nt=Math.max(kt,_parsePosition(Bi||(dr?"100% 0":Fi),dr,Jt,Zt,Gt()+Oi,Ri,Xt,jt,yi,$t,ei,Fi,xt,jt._endClamp&&"_endClamp"))||-.001,Oi=0,rn=Gr;rn--;)Vn=_triggers[rn],Gn=Vn.pin,Gn&&Vn.start-Vn._pinPush<=kt&&!xt&&Vn.end>0&&(sn=Vn.end-(jt._startClamp?Math.max(0,Vn.start):Vn.start),(Gn===$&&Vn.start-Vn._pinPush<kt||Gn===Nr)&&isNaN(pr)&&(Oi+=sn*(1-Vn.progress)),Gn===k&&(qi+=sn));if(kt+=Oi,Nt+=Oi,jt._startClamp&&(jt._startClamp+=Oi),jt._endClamp&&!_refreshingAll&&(jt._endClamp=Nt||-.001,Nt=Math.min(Nt,_maxScroll(It,Zt))),xi=Nt-kt||(kt-=.01)&&.001,bi&&(si=gsap$4.utils.clamp(0,1,gsap$4.utils.normalize(kt,Nt,xs))),jt._pinPush=qi,gi&&Oi&&(sn={},sn[Zt.a]="+="+Oi,Nr&&(sn[Zt.p]="-="+Gt()),gsap$4.set([gi,Ri],sn)),k&&!(_clampingMax&&jt.end>=_maxScroll(It,Zt)))sn=_getComputedStyle$1(k),ts=Zt===_vertical,yn=Gt(),_r=parseFloat(Rr(Zt.a))+qi,!Fi&&Nt>1&&(ls=(ri?_doc$3.scrollingElement||_docEl$1:It).style,ls={style:ls,value:ls["overflow"+Zt.a.toUpperCase()]},ri&&_getComputedStyle$1(_body$2)["overflow"+Zt.a.toUpperCase()]!=="scroll"&&(ls.style["overflow"+Zt.a.toUpperCase()]="scroll")),_swapPinIn(k,lr,sn),ir=_getState(k),hn=_getBounds$1(k,!0),qn=ei&&_getScrollFunc(It,ts?_horizontal:_vertical)(),Y?(Vr=[Y+Zt.os2,xi+qi+_px],Vr.t=lr,rn=Y===_padding?_getSize(k,Zt)+xi+qi:0,rn&&(Vr.push(Zt.d,rn+_px),lr.style.flexBasis!=="auto"&&(lr.style.flexBasis=rn+_px)),_setState(Vr),Nr&&_triggers.forEach(function(Qs){Qs.pin===Nr&&Qs.vars.pinSpacing!==!1&&(Qs._subPinOffset=!0)}),ei&&Gt(xs)):(rn=_getSize(k,Zt),rn&&lr.style.flexBasis!=="auto"&&(lr.style.flexBasis=rn+_px)),ei&&(Hn={top:hn.top+(ts?yn-kt:qn)+_px,left:hn.left+(ts?qn:yn-kt)+_px,boxSizing:"border-box",position:"fixed"},Hn[_width]=Hn["max"+_Width]=Math.ceil(hn.width)+_px,Hn[_height]=Hn["max"+_Height]=Math.ceil(hn.height)+_px,Hn[_margin]=Hn[_margin+_Top]=Hn[_margin+_Right]=Hn[_margin+_Bottom]=Hn[_margin+_Left]="0",Hn[_padding]=sn[_padding],Hn[_padding+_Top]=sn[_padding+_Top],Hn[_padding+_Right]=sn[_padding+_Right],Hn[_padding+_Bottom]=sn[_padding+_Bottom],Hn[_padding+_Left]=sn[_padding+_Left],fr=_copyState($i,Hn,me),_refreshingAll&&Gt(0)),o?(Bs=o._initted,_suppressOverwrites(1),o.render(o.duration(),!0,!0),mr=Rr(Zt.a)-_r+xi+qi,Nn=Math.abs(xi-mr)>1,ei&&Nn&&fr.splice(fr.length-2,2),o.render(0,!0,!0),Bs||o.invalidate(!0),o.parent||o.totalTime(o.totalTime()),_suppressOverwrites(0)):mr=xi,ls&&(ls.value?ls.style["overflow"+Zt.a.toUpperCase()]=ls.value:ls.style.removeProperty("overflow-"+Zt.a));else if($&&Gt()&&!xt)for(hn=$.parentNode;hn&&hn!==_body$2;)hn._pinOffset&&(kt-=hn._pinOffset,Nt-=hn._pinOffset),hn=hn.parentNode;bs&&bs.forEach(function(Qs){return Qs.revert(!1,!0)}),jt.start=kt,jt.end=Nt,Li=Mi=_refreshingAll?xs:Gt(),!xt&&!_refreshingAll&&(Li<xs&&Gt(xs),jt.scroll.rec=0),jt.revert(!1,!0),nr=_getTime$1(),Ks&&(Ir=-1,Ks.restart(!0)),_refreshing=0,o&&Ht&&(o._initted||eo)&&o.progress()!==eo&&o.progress(eo||0,!0).render(o.time(),!0,!0),(bi||si!==jt.progress||xt||ie||o&&!o._initted)&&(o&&!Ht&&(o._initted||si||o.vars.immediateRender!==!1)&&o.totalProgress(xt&&kt<-.001&&!si?gsap$4.utils.normalize(kt,Nt,0):si,!0),jt.progress=bi||(Li-kt)/xi===si?0:si),k&&Y&&(lr._pinOffset=Math.round(jt.progress*mr)),Sn&&Sn.invalidate(),isNaN(Js)||(Js-=gsap$4.getProperty(Rt,Zt.p),uo-=gsap$4.getProperty(Xt,Zt.p),_shiftMarker(Rt,Zt,Js),_shiftMarker(gi,Zt,Js-(ni||0)),_shiftMarker(Xt,Zt,uo),_shiftMarker(Ri,Zt,uo-(ni||0))),bi&&!_refreshingAll&&jt.update(),I&&!_refreshingAll&&!Ni&&(Ni=!0,I(jt),Ni=!1)}},jt.getVelocity=function(){return(Gt()-Mi)/(_getTime$1()-_time2)*1e3||0},jt.endAnimation=function(){_endAnimation(jt.callbackAnimation),o&&(Sn?Sn.progress(1):o.paused()?Ht||_endAnimation(o,jt.direction<0,1):_endAnimation(o,o.reversed()))},jt.labelToScroll=function(wt){return o&&o.labels&&(kt||jt.refresh()||kt)+o.labels[wt]/o.duration()*xi||0},jt.getTrailing=function(wt){var Ft=_triggers.indexOf(jt),Vt=jt.direction>0?_triggers.slice(0,Ft).reverse():_triggers.slice(Ft+1);return(_isString$1(wt)?Vt.filter(function(ni){return ni.vars.preventOverlaps===wt}):Vt).filter(function(ni){return jt.direction>0?ni.end<=kt:ni.start>=Nt})},jt.update=function(wt,Ft,Vt){if(!(xt&&!Vt&&!wt)){var ni=_refreshingAll===!0?xs:jt.scroll(),Jt=wt?0:(ni-kt)/xi,yi=Jt<0?0:Jt>1?1:Jt||0,Fi=jt.progress,bi,Oi,qi,Bi,dr,pr,Nr,Gr;if(Ft&&(Mi=Li,Li=xt?Gt():ni,he&&(Dn=As,As=o&&!Ht?o.totalProgress():yi)),ue&&k&&!_refreshing&&!_startup&&_lastScrollTime&&(!yi&&kt<ni+(ni-Mi)/(_getTime$1()-_time2)*ue?yi=1e-4:yi===1&&Nt>ni+(ni-Mi)/(_getTime$1()-_time2)*ue&&(yi=.9999)),yi!==Fi&&jt.enabled){if(bi=jt.isActive=!!yi&&yi<1,Oi=!!Fi&&Fi<1,pr=bi!==Oi,dr=pr||!!yi!=!!Fi,jt.direction=yi>Fi?1:-1,jt.progress=yi,dr&&!_refreshing&&(qi=yi&&!Fi?0:yi===1?1:Fi===1?2:3,Ht&&(Bi=!pr&&Ut[qi+1]!=="none"&&Ut[qi+1]||Ut[qi],Gr=o&&(Bi==="complete"||Bi==="reset"||Bi in o))),Lt&&(pr||Gr)&&(Gr||z||!o)&&(_isFunction$2(Lt)?Lt(jt):jt.getTrailing(Lt).forEach(function(yn){return yn.endAnimation()})),Ht||(Sn&&!_refreshing&&!_startup?(Sn._dp._time-Sn._start!==Sn._time&&Sn.render(Sn._dp._time-Sn._start),Sn.resetTo?Sn.resetTo("totalProgress",yi,o._tTime/o._tDur):(Sn.vars.totalProgress=yi,Sn.invalidate().restart())):o&&o.totalProgress(yi,!!(_refreshing&&(nr||wt)))),k){if(wt&&Y&&(lr.style[Y+Zt.os2]=wr),!ei)Jr(_round$2(_r+mr*yi));else if(dr){if(Nr=!wt&&yi>Fi&&Nt+1>ni&&ni+1>=_maxScroll(It,Zt),me)if(!wt&&(bi||Nr)){var rn=_getBounds$1(k,!0),sn=ni-kt;_reparent(k,_body$2,rn.top+(Zt===_vertical?sn:0)+_px,rn.left+(Zt===_vertical?0:sn)+_px)}else _reparent(k,lr);_setState(bi||Nr?fr:ir),Nn&&yi<1&&bi||Jr(_r+(yi===1&&!Nr?mr:0))}}he&&!ui.tween&&!_refreshing&&!_startup&&Ks.restart(!0),n&&(pr||le&&yi&&(yi<1||!_limitCallbacks))&&_toArray$3(n.targets).forEach(function(yn){return yn.classList[bi||le?"add":"remove"](n.className)}),d&&!Ht&&!wt&&d(jt),dr&&!_refreshing?(Ht&&(Gr&&(Bi==="complete"?o.pause().totalProgress(1):Bi==="reset"?o.restart(!0).pause():Bi==="restart"?o.restart(!0):o[Bi]()),d&&d(jt)),(pr||!_limitCallbacks)&&(C&&pr&&_callback(jt,C),Ct[qi]&&_callback(jt,Ct[qi]),le&&(yi===1?jt.kill(!1,1):Ct[qi]=0),pr||(qi=yi===1?1:3,Ct[qi]&&_callback(jt,Ct[qi]))),Et&&!bi&&Math.abs(jt.getVelocity())>(_isNumber(Et)?Et:2500)&&(_endAnimation(jt.callbackAnimation),Sn?Sn.progress(1):_endAnimation(o,Bi==="reverse"?1:!yi,1))):Ht&&d&&!_refreshing&&d(jt)}if(zs){var hn=xt?ni/xt.duration()*(xt._caScrollDist||0):ni;wn(hn+(Rt._isFlipped?1:0)),zs(hn)}rr&&rr(-ni/xt.duration()*(xt._caScrollDist||0))}},jt.enable=function(wt,Ft){jt.enabled||(jt.enabled=!0,_addListener$2(It,"resize",_onResize),ri||_addListener$2(It,"scroll",_onScroll),mi&&_addListener$2(e,"refreshInit",mi),wt!==!1&&(jt.progress=si=0,Li=Mi=Ir=Gt()),Ft!==!1&&jt.refresh())},jt.getTween=function(wt){return wt&&ui?ui.tween:Sn},jt.setPositions=function(wt,Ft,Vt,ni){if(xt){var Jt=xt.scrollTrigger,yi=xt.duration(),Fi=Jt.end-Jt.start;wt=Jt.start+Fi*wt/yi,Ft=Jt.start+Fi*Ft/yi}jt.refresh(!1,!1,{start:_keepClamp(wt,Vt&&!!jt._startClamp),end:_keepClamp(Ft,Vt&&!!jt._endClamp)},ni),jt.update()},jt.adjustPinSpacing=function(wt){if(Vr&&wt){var Ft=Vr.indexOf(Zt.d)+1;Vr[Ft]=parseFloat(Vr[Ft])+wt+_px,Vr[1]=parseFloat(Vr[1])+wt+_px,_setState(Vr)}},jt.disable=function(wt,Ft){if(jt.enabled&&(wt!==!1&&jt.revert(!0,!0),jt.enabled=jt.isActive=!1,Ft||Sn&&Sn.pause(),xs=0,oi&&(oi.uncache=1),mi&&_removeListener$2(e,"refreshInit",mi),Ks&&(Ks.pause(),ui.tween&&ui.tween.kill()&&(ui.tween=0)),!ri)){for(var Vt=_triggers.length;Vt--;)if(_triggers[Vt].scroller===It&&_triggers[Vt]!==jt)return;_removeListener$2(It,"resize",_onResize),ri||_removeListener$2(It,"scroll",_onScroll)}},jt.kill=function(wt,Ft){jt.disable(wt,Ft),Sn&&!Ft&&Sn.kill(),S&&delete _ids[S];var Vt=_triggers.indexOf(jt);Vt>=0&&_triggers.splice(Vt,1),Vt===_i&&_direction>0&&_i--,Vt=0,_triggers.forEach(function(ni){return ni.scroller===jt.scroller&&(Vt=1)}),Vt||_refreshingAll||(jt.scroll.rec=0),o&&(o.scrollTrigger=null,wt&&o.revert({kill:!1}),Ft||o.kill()),gi&&[gi,Ri,Rt,Xt].forEach(function(ni){return ni.parentNode&&ni.parentNode.removeChild(ni)}),_primary===jt&&(_primary=0),k&&(oi&&(oi.uncache=1),Vt=0,_triggers.forEach(function(ni){return ni.pin===k&&Vt++}),Vt||(oi.spacer=0)),r.onKill&&r.onKill(jt)},_triggers.push(jt),jt.enable(!1,!1),Ki&&Ki(jt),o&&o.add&&!xi){var ii=jt.update;jt.update=function(){jt.update=ii,_scrollers.cache++,kt||Nt||jt.refresh()},gsap$4.delayedCall(.01,jt.update),xi=.01,kt=Nt=0}else jt.refresh();k&&_queueRefreshAll()},e.register=function(r){return _coreInitted$4||(gsap$4=r||_getGSAP$3(),_windowExists$3()&&window.document&&e.enable(),_coreInitted$4=_enabled),_coreInitted$4},e.defaults=function(r){if(r)for(var o in r)_defaults[o]=r[o];return _defaults},e.disable=function(r,o){_enabled=0,_triggers.forEach(function(d){return d[o?"kill":"disable"](r)}),_removeListener$2(_win$4,"wheel",_onScroll),_removeListener$2(_doc$3,"scroll",_onScroll),clearInterval(_syncInterval),_removeListener$2(_doc$3,"touchcancel",_passThrough),_removeListener$2(_body$2,"touchstart",_passThrough),_multiListener(_removeListener$2,_doc$3,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_removeListener$2,_doc$3,"pointerup,touchend,mouseup",_pointerUpHandler),_resizeDelay.kill(),_iterateAutoRefresh(_removeListener$2);for(var l=0;l<_scrollers.length;l+=3)_wheelListener(_removeListener$2,_scrollers[l],_scrollers[l+1]),_wheelListener(_removeListener$2,_scrollers[l],_scrollers[l+2])},e.enable=function(){if(_win$4=window,_doc$3=document,_docEl$1=_doc$3.documentElement,_body$2=_doc$3.body,gsap$4&&(_toArray$3=gsap$4.utils.toArray,_clamp=gsap$4.utils.clamp,_context$4=gsap$4.core.context||_passThrough,_suppressOverwrites=gsap$4.core.suppressOverwrites||_passThrough,_scrollRestoration=_win$4.history.scrollRestoration||"auto",_lastScroll=_win$4.pageYOffset||0,gsap$4.core.globals("ScrollTrigger",e),_body$2)){_enabled=1,_div100vh=document.createElement("div"),_div100vh.style.height="100vh",_div100vh.style.position="absolute",_refresh100vh(),_rafBugFix(),Observer.register(gsap$4),e.isTouch=Observer.isTouch,_fixIOSBug=Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_ignoreMobileResize=Observer.isTouch===1,_addListener$2(_win$4,"wheel",_onScroll),_root=[_win$4,_doc$3,_docEl$1,_body$2],gsap$4.matchMedia?(e.matchMedia=function(C){var I=gsap$4.matchMedia(),z;for(z in C)I.add(z,C[z]);return I},gsap$4.addEventListener("matchMediaInit",function(){return _revertAll()}),gsap$4.addEventListener("matchMediaRevert",function(){return _revertRecorded()}),gsap$4.addEventListener("matchMedia",function(){_refreshAll(0,1),_dispatch("matchMedia")}),gsap$4.matchMedia().add("(orientation: portrait)",function(){return _setBaseDimensions(),_setBaseDimensions})):console.warn("Requires GSAP 3.11.0 or later"),_setBaseDimensions(),_addListener$2(_doc$3,"scroll",_onScroll);var r=_body$2.hasAttribute("style"),o=_body$2.style,l=o.borderTopStyle,d=gsap$4.core.Animation.prototype,n,S;for(d.revert||Object.defineProperty(d,"revert",{value:function(){return this.time(-.01,!0)}}),o.borderTopStyle="solid",n=_getBounds$1(_body$2),_vertical.m=Math.round(n.top+_vertical.sc())||0,_horizontal.m=Math.round(n.left+_horizontal.sc())||0,l?o.borderTopStyle=l:o.removeProperty("border-top-style"),r||(_body$2.setAttribute("style",""),_body$2.removeAttribute("style")),_syncInterval=setInterval(_sync,250),gsap$4.delayedCall(.5,function(){return _startup=0}),_addListener$2(_doc$3,"touchcancel",_passThrough),_addListener$2(_body$2,"touchstart",_passThrough),_multiListener(_addListener$2,_doc$3,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_addListener$2,_doc$3,"pointerup,touchend,mouseup",_pointerUpHandler),_transformProp$2=gsap$4.utils.checkPrefix("transform"),_stateProps.push(_transformProp$2),_coreInitted$4=_getTime$1(),_resizeDelay=gsap$4.delayedCall(.2,_refreshAll).pause(),_autoRefresh=[_doc$3,"visibilitychange",function(){var C=_win$4.innerWidth,I=_win$4.innerHeight;_doc$3.hidden?(_prevWidth=C,_prevHeight=I):(_prevWidth!==C||_prevHeight!==I)&&_onResize()},_doc$3,"DOMContentLoaded",_refreshAll,_win$4,"load",_refreshAll,_win$4,"resize",_onResize],_iterateAutoRefresh(_addListener$2),_triggers.forEach(function(C){return C.enable(0,1)}),S=0;S<_scrollers.length;S+=3)_wheelListener(_removeListener$2,_scrollers[S],_scrollers[S+1]),_wheelListener(_removeListener$2,_scrollers[S],_scrollers[S+2])}},e.config=function(r){"limitCallbacks"in r&&(_limitCallbacks=!!r.limitCallbacks);var o=r.syncInterval;o&&clearInterval(_syncInterval)||(_syncInterval=o)&&setInterval(_sync,o),"ignoreMobileResize"in r&&(_ignoreMobileResize=e.isTouch===1&&r.ignoreMobileResize),"autoRefreshEvents"in r&&(_iterateAutoRefresh(_removeListener$2)||_iterateAutoRefresh(_addListener$2,r.autoRefreshEvents||"none"),_ignoreResize=(r.autoRefreshEvents+"").indexOf("resize")===-1)},e.scrollerProxy=function(r,o){var l=_getTarget(r),d=_scrollers.indexOf(l),n=_isViewport(l);~d&&_scrollers.splice(d,n?6:2),o&&(n?_proxies.unshift(_win$4,o,_body$2,o,_docEl$1,o):_proxies.unshift(l,o))},e.clearMatchMedia=function(r){_triggers.forEach(function(o){return o._ctx&&o._ctx.query===r&&o._ctx.kill(!0,!0)})},e.isInViewport=function(r,o,l){var d=(_isString$1(r)?_getTarget(r):r).getBoundingClientRect(),n=d[l?_width:_height]*o||0;return l?d.right-n>0&&d.left+n<_win$4.innerWidth:d.bottom-n>0&&d.top+n<_win$4.innerHeight},e.positionInViewport=function(r,o,l){_isString$1(r)&&(r=_getTarget(r));var d=r.getBoundingClientRect(),n=d[l?_width:_height],S=o==null?n/2:o in _keywords?_keywords[o]*n:~o.indexOf("%")?parseFloat(o)*n/100:parseFloat(o)||0;return l?(d.left+S)/_win$4.innerWidth:(d.top+S)/_win$4.innerHeight},e.killAll=function(r){if(_triggers.slice(0).forEach(function(l){return l.vars.id!=="ScrollSmoother"&&l.kill()}),r!==!0){var o=_listeners.killAll||[];_listeners={},o.forEach(function(l){return l()})}},e}();ScrollTrigger.version="3.13.0";ScrollTrigger.saveStyles=function(e){return e?_toArray$3(e).forEach(function(t){if(t&&t.style){var i=_savedStyles.indexOf(t);i>=0&&_savedStyles.splice(i,5),_savedStyles.push(t,t.style.cssText,t.getBBox&&t.getAttribute("transform"),gsap$4.core.getCache(t),_context$4())}}):_savedStyles};ScrollTrigger.revert=function(e,t){return _revertAll(!e,t)};ScrollTrigger.create=function(e,t){return new ScrollTrigger(e,t)};ScrollTrigger.refresh=function(e){return e?_onResize(!0):(_coreInitted$4||ScrollTrigger.register())&&_refreshAll(!0)};ScrollTrigger.update=function(e){return++_scrollers.cache&&_updateAll(e===!0?2:0)};ScrollTrigger.clearScrollMemory=_clearScrollMemory;ScrollTrigger.maxScroll=function(e,t){return _maxScroll(e,t?_horizontal:_vertical)};ScrollTrigger.getScrollFunc=function(e,t){return _getScrollFunc(_getTarget(e),t?_horizontal:_vertical)};ScrollTrigger.getById=function(e){return _ids[e]};ScrollTrigger.getAll=function(){return _triggers.filter(function(e){return e.vars.id!=="ScrollSmoother"})};ScrollTrigger.isScrolling=function(){return!!_lastScrollTime};ScrollTrigger.snapDirectional=_snapDirectional;ScrollTrigger.addEventListener=function(e,t){var i=_listeners[e]||(_listeners[e]=[]);~i.indexOf(t)||i.push(t)};ScrollTrigger.removeEventListener=function(e,t){var i=_listeners[e],r=i&&i.indexOf(t);r>=0&&i.splice(r,1)};ScrollTrigger.batch=function(e,t){var i=[],r={},o=t.interval||.016,l=t.batchMax||1e9,d=function(C,I){var z=[],$=[],k=gsap$4.delayedCall(o,function(){I(z,$),z=[],$=[]}).pause();return function(Y){z.length||k.restart(!0),z.push(Y.trigger),$.push(Y),l<=z.length&&k.progress(1)}},n;for(n in t)r[n]=n.substr(0,2)==="on"&&_isFunction$2(t[n])&&n!=="onRefreshInit"?d(n,t[n]):t[n];return _isFunction$2(l)&&(l=l(),_addListener$2(ScrollTrigger,"refresh",function(){return l=t.batchMax()})),_toArray$3(e).forEach(function(S){var C={};for(n in r)C[n]=r[n];C.trigger=S,i.push(ScrollTrigger.create(C))}),i};var _clampScrollAndGetDurationMultiplier=function(t,i,r,o){return i>o?t(o):i<0&&t(0),r>o?(o-i)/(r-i):r<0?i/(i-r):1},_allowNativePanning=function e(t,i){i===!0?t.style.removeProperty("touch-action"):t.style.touchAction=i===!0?"auto":i?"pan-"+i+(Observer.isTouch?" pinch-zoom":""):"none",t===_docEl$1&&e(_body$2,i)},_overflow={auto:1,scroll:1},_nestedScroll=function(t){var i=t.event,r=t.target,o=t.axis,l=(i.changedTouches?i.changedTouches[0]:i).target,d=l._gsap||gsap$4.core.getCache(l),n=_getTime$1(),S;if(!d._isScrollT||n-d._isScrollT>2e3){for(;l&&l!==_body$2&&(l.scrollHeight<=l.clientHeight&&l.scrollWidth<=l.clientWidth||!(_overflow[(S=_getComputedStyle$1(l)).overflowY]||_overflow[S.overflowX]));)l=l.parentNode;d._isScroll=l&&l!==r&&!_isViewport(l)&&(_overflow[(S=_getComputedStyle$1(l)).overflowY]||_overflow[S.overflowX]),d._isScrollT=n}(d._isScroll||o==="x")&&(i.stopPropagation(),i._gsapAllow=!0)},_inputObserver=function(t,i,r,o){return Observer.create({target:t,capture:!0,debounce:!1,lockAxis:!0,type:i,onWheel:o=o&&_nestedScroll,onPress:o,onDrag:o,onScroll:o,onEnable:function(){return r&&_addListener$2(_doc$3,Observer.eventTypes[0],_captureInputs,!1,!0)},onDisable:function(){return _removeListener$2(_doc$3,Observer.eventTypes[0],_captureInputs,!0)}})},_inputExp=/(input|label|select|textarea)/i,_inputIsFocused,_captureInputs=function(t){var i=_inputExp.test(t.target.tagName);(i||_inputIsFocused)&&(t._gsapAllow=!0,_inputIsFocused=i)},_getScrollNormalizer=function(t){_isObject$2(t)||(t={}),t.preventDefault=t.isNormalizer=t.allowClicks=!0,t.type||(t.type="wheel,touch"),t.debounce=!!t.debounce,t.id=t.id||"normalizer";var i=t,r=i.normalizeScrollX,o=i.momentum,l=i.allowNestedScroll,d=i.onRelease,n,S,C=_getTarget(t.target)||_docEl$1,I=gsap$4.core.globals().ScrollSmoother,z=I&&I.get(),$=_fixIOSBug&&(t.content&&_getTarget(t.content)||z&&t.content!==!1&&!z.smooth()&&z.content()),k=_getScrollFunc(C,_vertical),Y=_getScrollFunc(C,_horizontal),ie=1,ue=(Observer.isTouch&&_win$4.visualViewport?_win$4.visualViewport.scale*_win$4.visualViewport.width:_win$4.outerWidth)/_win$4.innerWidth,ne=0,se=_isFunction$2(o)?function(){return o(n)}:function(){return o||2.8},le,he,me=_inputObserver(C,t.type,!0,l),ge=function(){return he=!1},xt=_passThrough,Et=_passThrough,Lt=function(){S=_maxScroll(C,_vertical),Et=_clamp(_fixIOSBug?1:0,S),r&&(xt=_clamp(0,_maxScroll(C,_horizontal))),le=_refreshID},Zt=function(){$._gsap.y=_round$2(parseFloat($._gsap.y)+k.offset)+"px",$.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat($._gsap.y)+", 0, 1)",k.offset=k.cacheID=0},Ht=function(){if(he){requestAnimationFrame(ge);var Mt=_round$2(n.deltaY/2),$t=Et(k.v-Mt);if($&&$t!==k.v+k.offset){k.offset=$t-k.v;var jt=_round$2((parseFloat($&&$._gsap.y)||0)-k.offset);$.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+jt+", 0, 1)",$._gsap.y=jt+"px",k.cacheID=_scrollers.cache,_updateAll()}return!0}k.offset&&Zt(),he=!0},It,Yt,ri,ei,Ct=function(){Lt(),It.isActive()&&It.vars.scrollY>S&&(k()>S?It.progress(1)&&k(S):It.resetTo("scrollY",S))};return $&&gsap$4.set($,{y:"+=0"}),t.ignoreCheck=function(Ut){return _fixIOSBug&&Ut.type==="touchmove"&&Ht()||ie>1.05&&Ut.type!=="touchstart"||n.isGesturing||Ut.touches&&Ut.touches.length>1},t.onPress=function(){he=!1;var Ut=ie;ie=_round$2((_win$4.visualViewport&&_win$4.visualViewport.scale||1)/ue),It.pause(),Ut!==ie&&_allowNativePanning(C,ie>1.01?!0:r?!1:"x"),Yt=Y(),ri=k(),Lt(),le=_refreshID},t.onRelease=t.onGestureStart=function(Ut,Mt){if(k.offset&&Zt(),!Mt)ei.restart(!0);else{_scrollers.cache++;var $t=se(),jt,mi;r&&(jt=Y(),mi=jt+$t*.05*-Ut.velocityX/.227,$t*=_clampScrollAndGetDurationMultiplier(Y,jt,mi,_maxScroll(C,_horizontal)),It.vars.scrollX=xt(mi)),jt=k(),mi=jt+$t*.05*-Ut.velocityY/.227,$t*=_clampScrollAndGetDurationMultiplier(k,jt,mi,_maxScroll(C,_vertical)),It.vars.scrollY=Et(mi),It.invalidate().duration($t).play(.01),(_fixIOSBug&&It.vars.scrollY>=S||jt>=S-1)&&gsap$4.to({},{onUpdate:Ct,duration:$t})}d&&d(Ut)},t.onWheel=function(){It._ts&&It.pause(),_getTime$1()-ne>1e3&&(le=0,ne=_getTime$1())},t.onChange=function(Ut,Mt,$t,jt,mi){if(_refreshID!==le&&Lt(),Mt&&r&&Y(xt(jt[2]===Mt?Yt+(Ut.startX-Ut.x):Y()+Mt-jt[1])),$t){k.offset&&Zt();var Xi=mi[2]===$t,Er=Xi?ri+Ut.startY-Ut.y:k()+$t-mi[1],Ir=Et(Er);Xi&&Er!==Ir&&(ri+=Ir-Er),k(Ir)}($t||Mt)&&_updateAll()},t.onEnable=function(){_allowNativePanning(C,r?!1:"x"),ScrollTrigger.addEventListener("refresh",Ct),_addListener$2(_win$4,"resize",Ct),k.smooth&&(k.target.style.scrollBehavior="auto",k.smooth=Y.smooth=!1),me.enable()},t.onDisable=function(){_allowNativePanning(C,!0),_removeListener$2(_win$4,"resize",Ct),ScrollTrigger.removeEventListener("refresh",Ct),me.kill()},t.lockAxis=t.lockAxis!==!1,n=new Observer(t),n.iOS=_fixIOSBug,_fixIOSBug&&!k()&&k(1),_fixIOSBug&&gsap$4.ticker.add(_passThrough),ei=n._dc,It=gsap$4.to(n,{ease:"power4",paused:!0,inherit:!1,scrollX:r?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:_interruptionTracker(k,k(),function(){return It.pause()})},onUpdate:_updateAll,onComplete:ei.vars.onComplete}),n};ScrollTrigger.sort=function(e){if(_isFunction$2(e))return _triggers.sort(e);var t=_win$4.pageYOffset||0;return ScrollTrigger.getAll().forEach(function(i){return i._sortY=i.trigger?t+i.trigger.getBoundingClientRect().top:i.start+_win$4.innerHeight}),_triggers.sort(e||function(i,r){return(i.vars.refreshPriority||0)*-1e6+(i.vars.containerAnimation?1e6:i._sortY)-((r.vars.containerAnimation?1e6:r._sortY)+(r.vars.refreshPriority||0)*-1e6)})};ScrollTrigger.observe=function(e){return new Observer(e)};ScrollTrigger.normalizeScroll=function(e){if(typeof e>"u")return _normalizer;if(e===!0&&_normalizer)return _normalizer.enable();if(e===!1){_normalizer&&_normalizer.kill(),_normalizer=e;return}var t=e instanceof Observer?e:_getScrollNormalizer(e);return _normalizer&&_normalizer.target===t.target&&_normalizer.kill(),_isViewport(t.target)&&(_normalizer=t),t};ScrollTrigger.core={_getVelocityProp,_inputObserver,_scrollers,_proxies,bridge:{ss:function(){_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime$1()},ref:function(){return _refreshing}}};_getGSAP$3()&&gsap$4.registerPlugin(ScrollTrigger);/*!
 * DrawSVGPlugin 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$3,_toArray$2,_win$3,_isEdge,_coreInitted$3,_warned,_getStyleSaver$1,_reverting,_windowExists$2=function(){return typeof window<"u"},_getGSAP$2=function(){return gsap$3||_windowExists$2()&&(gsap$3=window.gsap)&&gsap$3.registerPlugin&&gsap$3},_numExp=/[-+=\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/gi,_types={rect:["width","height"],circle:["r","r"],ellipse:["rx","ry"],line:["x2","y2"]},_round$1=function(t){return Math.round(t*1e4)/1e4},_parseNum=function(t){return parseFloat(t)||0},_parseSingleVal=function(t,i){var r=_parseNum(t);return~t.indexOf("%")?r/100*i:r},_getAttributeAsNumber=function(t,i){return _parseNum(t.getAttribute(i))},_sqrt=Math.sqrt,_getDistance=function(t,i,r,o,l,d){return _sqrt(Math.pow((_parseNum(r)-_parseNum(t))*l,2)+Math.pow((_parseNum(o)-_parseNum(i))*d,2))},_warn=function(t){return console.warn(t)},_hasNonScalingStroke=function(t){return t.getAttribute("vector-effect")==="non-scaling-stroke"},_bonusValidated=1,_parse=function(t,i,r){var o=t.indexOf(" "),l,d;return o<0?(l=r!==void 0?r+"":t,d=t):(l=t.substr(0,o),d=t.substr(o+1)),l=_parseSingleVal(l,i),d=_parseSingleVal(d,i),l>d?[d,l]:[l,d]},_getLength=function(t){if(t=_toArray$2(t)[0],!t)return 0;var i=t.tagName.toLowerCase(),r=t.style,o=1,l=1,d,n,S,C,I,z,$;_hasNonScalingStroke(t)&&(l=t.getScreenCTM(),o=_sqrt(l.a*l.a+l.b*l.b),l=_sqrt(l.d*l.d+l.c*l.c));try{n=t.getBBox()}catch{_warn("Some browsers won't measure invisible elements (like display:none or masks inside defs).")}var k=n||{x:0,y:0,width:0,height:0},Y=k.x,ie=k.y,ue=k.width,ne=k.height;if((!n||!ue&&!ne)&&_types[i]&&(ue=_getAttributeAsNumber(t,_types[i][0]),ne=_getAttributeAsNumber(t,_types[i][1]),i!=="rect"&&i!=="line"&&(ue*=2,ne*=2),i==="line"&&(Y=_getAttributeAsNumber(t,"x1"),ie=_getAttributeAsNumber(t,"y1"),ue=Math.abs(ue-Y),ne=Math.abs(ne-ie))),i==="path")C=r.strokeDasharray,r.strokeDasharray="none",d=t.getTotalLength()||0,_round$1(o)!==_round$1(l)&&!_warned&&(_warned=1)&&_warn("Warning: <path> length cannot be measured when vector-effect is non-scaling-stroke and the element isn't proportionally scaled."),d*=(o+l)/2,r.strokeDasharray=C;else if(i==="rect")d=ue*2*o+ne*2*l;else if(i==="line")d=_getDistance(Y,ie,Y+ue,ie+ne,o,l);else if(i==="polyline"||i==="polygon")for(S=t.getAttribute("points").match(_numExp)||[],i==="polygon"&&S.push(S[0],S[1]),d=0,I=2;I<S.length;I+=2)d+=_getDistance(S[I-2],S[I-1],S[I],S[I+1],o,l)||0;else(i==="circle"||i==="ellipse")&&(z=ue/2*o,$=ne/2*l,d=Math.PI*(3*(z+$)-_sqrt((3*z+$)*(z+3*$))));return d||0},_getPosition=function(t,i){if(t=_toArray$2(t)[0],!t)return[0,0];i||(i=_getLength(t)+1);var r=_win$3.getComputedStyle(t),o=r.strokeDasharray||"",l=_parseNum(r.strokeDashoffset),d=o.indexOf(",");return d<0&&(d=o.indexOf(" ")),o=d<0?i:_parseNum(o.substr(0,d)),o>i&&(o=i),[-l||0,o-l||0]},_initCore$2=function(){_windowExists$2()&&(_win$3=window,_coreInitted$3=gsap$3=_getGSAP$2(),_toArray$2=gsap$3.utils.toArray,_getStyleSaver$1=gsap$3.core.getStyleSaver,_reverting=gsap$3.core.reverting||function(){},_isEdge=((_win$3.navigator||{}).userAgent||"").indexOf("Edge")!==-1)},DrawSVGPlugin={version:"3.13.0",name:"drawSVG",register:function(t){gsap$3=t,_initCore$2()},init:function(t,i,r,o,l){if(!t.getBBox)return!1;_coreInitted$3||_initCore$2();var d=_getLength(t),n,S,C;return this.styles=_getStyleSaver$1&&_getStyleSaver$1(t,"strokeDashoffset,strokeDasharray,strokeMiterlimit"),this.tween=r,this._style=t.style,this._target=t,i+""=="true"?i="0 100%":i?(i+"").indexOf(" ")===-1&&(i="0 "+i):i="0 0",n=_getPosition(t,d),S=_parse(i,d,n[0]),this._length=_round$1(d),this._dash=_round$1(n[1]-n[0]),this._offset=_round$1(-n[0]),this._dashPT=this.add(this,"_dash",this._dash,_round$1(S[1]-S[0]),0,0,0,0,0,1),this._offsetPT=this.add(this,"_offset",this._offset,_round$1(-S[0]),0,0,0,0,0,1),_isEdge&&(C=_win$3.getComputedStyle(t),C.strokeLinecap!==C.strokeLinejoin&&(S=_parseNum(C.strokeMiterlimit),this.add(t.style,"strokeMiterlimit",S,S+.01))),this._live=_hasNonScalingStroke(t)||~(i+"").indexOf("live"),this._nowrap=~(i+"").indexOf("nowrap"),this._props.push("drawSVG"),_bonusValidated},render:function(t,i){if(i.tween._time||!_reverting()){var r=i._pt,o=i._style,l,d,n,S;if(r){for(i._live&&(l=_getLength(i._target),l!==i._length&&(d=l/i._length,i._length=l,i._offsetPT&&(i._offsetPT.s*=d,i._offsetPT.c*=d),i._dashPT?(i._dashPT.s*=d,i._dashPT.c*=d):i._dash*=d));r;)r.r(t,r.d),r=r._next;n=i._dash||t&&t!==1&&1e-4||0,l=i._length-n+.1,S=i._offset,n&&S&&n+Math.abs(S%i._length)>i._length-.05&&(S+=S<0?.005:-.005)&&(l+=.005),o.strokeDashoffset=n?S:S+.001,o.strokeDasharray=l<.1?"none":n?n+"px,"+(i._nowrap?999999:l)+"px":"0px, 999999px"}}else i.styles.revert()},getLength:_getLength,getPosition:_getPosition};_getGSAP$2()&&gsap$3.registerPlugin(DrawSVGPlugin);/*!
 * SplitText 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2025, GreenSock. All rights reserved. Subject to the terms at https://gsap.com/standard-license.
 * @author: Jack Doyle
 */let gsap$2,_fonts,_coreInitted$2,_initIfNecessary=()=>_coreInitted$2||SplitText.register(window.gsap),_charSegmenter=typeof Intl<"u"?new Intl.Segmenter:0,_toArray$1=e=>typeof e=="string"?_toArray$1(document.querySelectorAll(e)):"length"in e?Array.from(e):[e],_elements=e=>_toArray$1(e).filter(t=>t instanceof HTMLElement),_emptyArray=[],_context$3=function(){},_spacesRegEx=/\s+/g,_emojiSafeRegEx=new RegExp("\\p{RI}\\p{RI}|\\p{Emoji}(\\p{EMod}|\\u{FE0F}\\u{20E3}?|[\\u{E0020}-\\u{E007E}]+\\u{E007F})?(\\u{200D}\\p{Emoji}(\\p{EMod}|\\u{FE0F}\\u{20E3}?|[\\u{E0020}-\\u{E007E}]+\\u{E007F})?)*|.","gu"),_emptyBounds={left:0,top:0,width:0,height:0},_stretchToFitSpecialChars=(e,t)=>{if(t){let i=new Set(e.join("").match(t)||_emptyArray),r=e.length,o,l,d,n;if(i.size)for(;--r>-1;){l=e[r];for(d of i)if(d.startsWith(l)&&d.length>l.length){for(o=0,n=l;d.startsWith(n+=e[r+ ++o])&&n.length<d.length;);if(o&&n.length===d.length){e[r]=d,e.splice(r+1,o);break}}}}return e},_disallowInline=e=>window.getComputedStyle(e).display==="inline"&&(e.style.display="inline-block"),_insertNodeBefore=(e,t,i)=>t.insertBefore(typeof e=="string"?document.createTextNode(e):e,i),_getWrapper=(e,t,i)=>{let r=t[e+"sClass"]||"",{tag:o="div",aria:l="auto",propIndex:d=!1}=t,n=e==="line"?"block":"inline-block",S=r.indexOf("++")>-1,C=I=>{let z=document.createElement(o),$=i.length+1;return r&&(z.className=r+(S?" "+r+$:"")),d&&z.style.setProperty("--"+e,$+""),l!=="none"&&z.setAttribute("aria-hidden","true"),o!=="span"&&(z.style.position="relative",z.style.display=n),z.textContent=I,i.push(z),z};return S&&(r=r.replace("++","")),C.collection=i,C},_getLineWrapper=(e,t,i,r)=>{let o=_getWrapper("line",i,r),l=window.getComputedStyle(e).textAlign||"left";return(d,n)=>{let S=o("");for(S.style.textAlign=l,e.insertBefore(S,t[d]);d<n;d++)S.appendChild(t[d]);S.normalize()}},_splitWordsAndCharsRecursively=(e,t,i,r,o,l,d,n,S,C)=>{var I;let z=Array.from(e.childNodes),$=0,{wordDelimiter:k,reduceWhiteSpace:Y=!0,prepareText:ie}=t,ue=e.getBoundingClientRect(),ne=ue,se=!Y&&window.getComputedStyle(e).whiteSpace.substring(0,3)==="pre",le=0,he=i.collection,me,ge,xt,Et,Lt,Zt,Ht,It,Yt,ri,ei,Ct,Ut,Mt,$t,jt,mi,Xi;for(typeof k=="object"?(xt=k.delimiter||k,ge=k.replaceWith||""):ge=k===""?"":k||" ",me=ge!==" ";$<z.length;$++)if(Et=z[$],Et.nodeType===3){for($t=Et.textContent||"",Y?$t=$t.replace(_spacesRegEx," "):se&&($t=$t.replace(/\n/g,ge+`
`)),ie&&($t=ie($t,e)),Et.textContent=$t,Lt=ge||xt?$t.split(xt||ge):$t.match(n)||_emptyArray,mi=Lt[Lt.length-1],It=me?mi.slice(-1)===" ":!mi,mi||Lt.pop(),ne=ue,Ht=me?Lt[0].charAt(0)===" ":!Lt[0],Ht&&_insertNodeBefore(" ",e,Et),Lt[0]||Lt.shift(),_stretchToFitSpecialChars(Lt,S),l&&C||(Et.textContent=""),Yt=1;Yt<=Lt.length;Yt++)if(jt=Lt[Yt-1],!Y&&se&&jt.charAt(0)===`
`&&((I=Et.previousSibling)==null||I.remove(),_insertNodeBefore(document.createElement("br"),e,Et),jt=jt.slice(1)),!Y&&jt==="")_insertNodeBefore(ge,e,Et);else if(jt===" ")e.insertBefore(document.createTextNode(" "),Et);else{if(me&&jt.charAt(0)===" "&&_insertNodeBefore(" ",e,Et),le&&Yt===1&&!Ht&&he.indexOf(le.parentNode)>-1?(Zt=he[he.length-1],Zt.appendChild(document.createTextNode(r?"":jt))):(Zt=i(r?"":jt),_insertNodeBefore(Zt,e,Et),le&&Yt===1&&!Ht&&Zt.insertBefore(le,Zt.firstChild)),r)for(ei=_charSegmenter?_stretchToFitSpecialChars([..._charSegmenter.segment(jt)].map(Er=>Er.segment),S):jt.match(n)||_emptyArray,Xi=0;Xi<ei.length;Xi++)Zt.appendChild(ei[Xi]===" "?document.createTextNode(" "):r(ei[Xi]));if(l&&C){if($t=Et.textContent=$t.substring(jt.length+1,$t.length),ri=Zt.getBoundingClientRect(),ri.top>ne.top&&ri.left<=ne.left){for(Ct=e.cloneNode(),Ut=e.childNodes[0];Ut&&Ut!==Zt;)Mt=Ut,Ut=Ut.nextSibling,Ct.appendChild(Mt);e.parentNode.insertBefore(Ct,e),o&&_disallowInline(Ct)}ne=ri}(Yt<Lt.length||It)&&_insertNodeBefore(Yt>=Lt.length?" ":me&&jt.slice(-1)===" "?" "+ge:ge,e,Et)}e.removeChild(Et),le=0}else Et.nodeType===1&&(d&&d.indexOf(Et)>-1?(he.indexOf(Et.previousSibling)>-1&&he[he.length-1].appendChild(Et),le=Et):(_splitWordsAndCharsRecursively(Et,t,i,r,o,l,d,n,S,!0),le=0),o&&_disallowInline(Et))};const _SplitText=class Ex{constructor(t,i){this.isSplit=!1,_initIfNecessary(),this.elements=_elements(t),this.chars=[],this.words=[],this.lines=[],this.masks=[],this.vars=i,this._split=()=>this.isSplit&&this.split(this.vars);let r=[],o,l=()=>{let d=r.length,n;for(;d--;){n=r[d];let S=n.element.offsetWidth;if(S!==n.width){n.width=S,this._split();return}}};this._data={orig:r,obs:typeof ResizeObserver<"u"&&new ResizeObserver(()=>{clearTimeout(o),o=setTimeout(l,200)})},_context$3(this),this.split(i)}split(t){this.isSplit&&this.revert(),this.vars=t=t||this.vars||{};let{type:i="chars,words,lines",aria:r="auto",deepSlice:o=!0,smartWrap:l,onSplit:d,autoSplit:n=!1,specialChars:S,mask:C}=this.vars,I=i.indexOf("lines")>-1,z=i.indexOf("chars")>-1,$=i.indexOf("words")>-1,k=z&&!$&&!I,Y=S&&("push"in S?new RegExp("(?:"+S.join("|")+")","gu"):S),ie=Y?new RegExp(Y.source+"|"+_emojiSafeRegEx.source,"gu"):_emojiSafeRegEx,ue=!!t.ignore&&_elements(t.ignore),{orig:ne,animTime:se,obs:le}=this._data,he;return(z||$||I)&&(this.elements.forEach((me,ge)=>{ne[ge]={element:me,html:me.innerHTML,ariaL:me.getAttribute("aria-label"),ariaH:me.getAttribute("aria-hidden")},r==="auto"?me.setAttribute("aria-label",(me.textContent||"").trim()):r==="hidden"&&me.setAttribute("aria-hidden","true");let xt=[],Et=[],Lt=[],Zt=z?_getWrapper("char",t,xt):null,Ht=_getWrapper("word",t,Et),It,Yt,ri,ei;if(_splitWordsAndCharsRecursively(me,t,Ht,Zt,k,o&&(I||k),ue,ie,Y,!1),I){let Ct=_toArray$1(me.childNodes),Ut=_getLineWrapper(me,Ct,t,Lt),Mt,$t=[],jt=0,mi=Ct.map(Er=>Er.nodeType===1?Er.getBoundingClientRect():_emptyBounds),Xi=_emptyBounds;for(It=0;It<Ct.length;It++)Mt=Ct[It],Mt.nodeType===1&&(Mt.nodeName==="BR"?($t.push(Mt),Ut(jt,It+1),jt=It+1,Xi=mi[jt]):(It&&mi[It].top>Xi.top&&mi[It].left<=Xi.left&&(Ut(jt,It),jt=It),Xi=mi[It]));jt<It&&Ut(jt,It),$t.forEach(Er=>{var Ir;return(Ir=Er.parentNode)==null?void 0:Ir.removeChild(Er)})}if(!$){for(It=0;It<Et.length;It++)if(Yt=Et[It],z||!Yt.nextSibling||Yt.nextSibling.nodeType!==3)if(l&&!I){for(ri=document.createElement("span"),ri.style.whiteSpace="nowrap";Yt.firstChild;)ri.appendChild(Yt.firstChild);Yt.replaceWith(ri)}else Yt.replaceWith(...Yt.childNodes);else ei=Yt.nextSibling,ei&&ei.nodeType===3&&(ei.textContent=(Yt.textContent||"")+(ei.textContent||""),Yt.remove());Et.length=0,me.normalize()}this.lines.push(...Lt),this.words.push(...Et),this.chars.push(...xt)}),C&&this[C]&&this.masks.push(...this[C].map(me=>{let ge=me.cloneNode();return me.replaceWith(ge),ge.appendChild(me),me.className&&(ge.className=me.className.replace(/(\b\w+\b)/g,"$1-mask")),ge.style.overflow="clip",ge}))),this.isSplit=!0,_fonts&&(n?_fonts.addEventListener("loadingdone",this._split):_fonts.status==="loading"&&console.warn("SplitText called before fonts loaded")),(he=d&&d(this))&&he.totalTime&&(this._data.anim=se?he.totalTime(se):he),I&&n&&this.elements.forEach((me,ge)=>{ne[ge].width=me.offsetWidth,le&&le.observe(me)}),this}revert(){var t,i;let{orig:r,anim:o,obs:l}=this._data;return l&&l.disconnect(),r.forEach(({element:d,html:n,ariaL:S,ariaH:C})=>{d.innerHTML=n,S?d.setAttribute("aria-label",S):d.removeAttribute("aria-label"),C?d.setAttribute("aria-hidden",C):d.removeAttribute("aria-hidden")}),this.chars.length=this.words.length=this.lines.length=r.length=this.masks.length=0,this.isSplit=!1,_fonts==null||_fonts.removeEventListener("loadingdone",this._split),o&&(this._data.animTime=o.totalTime(),o.revert()),(i=(t=this.vars).onRevert)==null||i.call(t,this),this}static create(t,i){return new Ex(t,i)}static register(t){gsap$2=gsap$2||t||window.gsap,gsap$2&&(_toArray$1=gsap$2.utils.toArray,_context$3=gsap$2.core.context||_context$3),!_coreInitted$2&&window.innerWidth>0&&(_fonts=document.fonts,_coreInitted$2=!0)}};_SplitText.version="3.13.0";let SplitText=_SplitText;/*!
 * matrix 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var _doc$2,_win$2,_docElement$1,_body$1,_divContainer,_svgContainer,_identityMatrix$2,_gEl,_transformProp$1="transform",_transformOriginProp$1=_transformProp$1+"Origin",_hasOffsetBug,_setDoc=function(t){var i=t.ownerDocument||t;for(!(_transformProp$1 in t.style)&&("msTransform"in t.style)&&(_transformProp$1="msTransform",_transformOriginProp$1=_transformProp$1+"Origin");i.parentNode&&(i=i.parentNode););if(_win$2=window,_identityMatrix$2=new Matrix2D,i){_doc$2=i,_docElement$1=i.documentElement,_body$1=i.body,_gEl=_doc$2.createElementNS("http://www.w3.org/2000/svg","g"),_gEl.style.transform="none";var r=i.createElement("div"),o=i.createElement("div"),l=i&&(i.body||i.firstElementChild);l&&l.appendChild&&(l.appendChild(r),r.appendChild(o),r.setAttribute("style","position:static;transform:translate3d(0,0,1px)"),_hasOffsetBug=o.offsetParent!==r,l.removeChild(r))}return i},_forceNonZeroScale=function(t){for(var i,r;t&&t!==_body$1;)r=t._gsap,r&&r.uncache&&r.get(t,"x"),r&&!r.scaleX&&!r.scaleY&&r.renderTransform&&(r.scaleX=r.scaleY=1e-4,r.renderTransform(1,r),i?i.push(r):i=[r]),t=t.parentNode;return i},_svgTemps=[],_divTemps=[],_getDocScrollTop$1=function(){return _win$2.pageYOffset||_doc$2.scrollTop||_docElement$1.scrollTop||_body$1.scrollTop||0},_getDocScrollLeft$1=function(){return _win$2.pageXOffset||_doc$2.scrollLeft||_docElement$1.scrollLeft||_body$1.scrollLeft||0},_svgOwner=function(t){return t.ownerSVGElement||((t.tagName+"").toLowerCase()==="svg"?t:null)},_isFixed$1=function e(t){if(_win$2.getComputedStyle(t).position==="fixed")return!0;if(t=t.parentNode,t&&t.nodeType===1)return e(t)},_createSibling=function e(t,i){if(t.parentNode&&(_doc$2||_setDoc(t))){var r=_svgOwner(t),o=r?r.getAttribute("xmlns")||"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",l=r?i?"rect":"g":"div",d=i!==2?0:100,n=i===3?100:0,S="position:absolute;display:block;pointer-events:none;margin:0;padding:0;",C=_doc$2.createElementNS?_doc$2.createElementNS(o.replace(/^https/,"http"),l):_doc$2.createElement(l);return i&&(r?(_svgContainer||(_svgContainer=e(t)),C.setAttribute("width",.01),C.setAttribute("height",.01),C.setAttribute("transform","translate("+d+","+n+")"),_svgContainer.appendChild(C)):(_divContainer||(_divContainer=e(t),_divContainer.style.cssText=S),C.style.cssText=S+"width:0.1px;height:0.1px;top:"+n+"px;left:"+d+"px",_divContainer.appendChild(C))),C}throw"Need document and parent."},_consolidate=function(t){for(var i=new Matrix2D,r=0;r<t.numberOfItems;r++)i.multiply(t.getItem(r).matrix);return i},_getCTM=function(t){var i=t.getCTM(),r;return i||(r=t.style[_transformProp$1],t.style[_transformProp$1]="none",t.appendChild(_gEl),i=_gEl.getCTM(),t.removeChild(_gEl),r?t.style[_transformProp$1]=r:t.style.removeProperty(_transformProp$1.replace(/([A-Z])/g,"-$1").toLowerCase())),i||_identityMatrix$2.clone()},_placeSiblings=function(t,i){var r=_svgOwner(t),o=t===r,l=r?_svgTemps:_divTemps,d=t.parentNode,n=d&&!r&&d.shadowRoot&&d.shadowRoot.appendChild?d.shadowRoot:d,S,C,I,z,$,k;if(t===_win$2)return t;if(l.length||l.push(_createSibling(t,1),_createSibling(t,2),_createSibling(t,3)),S=r?_svgContainer:_divContainer,r)o?(I=_getCTM(t),z=-I.e/I.a,$=-I.f/I.d,C=_identityMatrix$2):t.getBBox?(I=t.getBBox(),C=t.transform?t.transform.baseVal:{},C=C.numberOfItems?C.numberOfItems>1?_consolidate(C):C.getItem(0).matrix:_identityMatrix$2,z=C.a*I.x+C.c*I.y,$=C.b*I.x+C.d*I.y):(C=new Matrix2D,z=$=0),(o?r:d).appendChild(S),S.setAttribute("transform","matrix("+C.a+","+C.b+","+C.c+","+C.d+","+(C.e+z)+","+(C.f+$)+")");else{if(z=$=0,_hasOffsetBug)for(C=t.offsetParent,I=t;I&&(I=I.parentNode)&&I!==C&&I.parentNode;)(_win$2.getComputedStyle(I)[_transformProp$1]+"").length>4&&(z=I.offsetLeft,$=I.offsetTop,I=0);if(k=_win$2.getComputedStyle(t),k.position!=="absolute"&&k.position!=="fixed")for(C=t.offsetParent;d&&d!==C;)z+=d.scrollLeft||0,$+=d.scrollTop||0,d=d.parentNode;I=S.style,I.top=t.offsetTop-$+"px",I.left=t.offsetLeft-z+"px",I[_transformProp$1]=k[_transformProp$1],I[_transformOriginProp$1]=k[_transformOriginProp$1],I.position=k.position==="fixed"?"fixed":"absolute",n.appendChild(S)}return S},_setMatrix=function(t,i,r,o,l,d,n){return t.a=i,t.b=r,t.c=o,t.d=l,t.e=d,t.f=n,t},Matrix2D=function(){function e(i,r,o,l,d,n){i===void 0&&(i=1),r===void 0&&(r=0),o===void 0&&(o=0),l===void 0&&(l=1),d===void 0&&(d=0),n===void 0&&(n=0),_setMatrix(this,i,r,o,l,d,n)}var t=e.prototype;return t.inverse=function(){var r=this.a,o=this.b,l=this.c,d=this.d,n=this.e,S=this.f,C=r*d-o*l||1e-10;return _setMatrix(this,d/C,-o/C,-l/C,r/C,(l*S-d*n)/C,-(r*S-o*n)/C)},t.multiply=function(r){var o=this.a,l=this.b,d=this.c,n=this.d,S=this.e,C=this.f,I=r.a,z=r.c,$=r.b,k=r.d,Y=r.e,ie=r.f;return _setMatrix(this,I*o+$*d,I*l+$*n,z*o+k*d,z*l+k*n,S+Y*o+ie*d,C+Y*l+ie*n)},t.clone=function(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)},t.equals=function(r){var o=this.a,l=this.b,d=this.c,n=this.d,S=this.e,C=this.f;return o===r.a&&l===r.b&&d===r.c&&n===r.d&&S===r.e&&C===r.f},t.apply=function(r,o){o===void 0&&(o={});var l=r.x,d=r.y,n=this.a,S=this.b,C=this.c,I=this.d,z=this.e,$=this.f;return o.x=l*n+d*C+z||0,o.y=l*S+d*I+$||0,o},e}();function getGlobalMatrix(e,t,i,r){if(!e||!e.parentNode||(_doc$2||_setDoc(e)).documentElement===e)return new Matrix2D;var o=_forceNonZeroScale(e),l=_svgOwner(e),d=l?_svgTemps:_divTemps,n=_placeSiblings(e),S=d[0].getBoundingClientRect(),C=d[1].getBoundingClientRect(),I=d[2].getBoundingClientRect(),z=n.parentNode,$=_isFixed$1(e),k=new Matrix2D((C.left-S.left)/100,(C.top-S.top)/100,(I.left-S.left)/100,(I.top-S.top)/100,S.left+($?0:_getDocScrollLeft$1()),S.top+($?0:_getDocScrollTop$1()));if(z.removeChild(n),o)for(S=o.length;S--;)C=o[S],C.scaleX=C.scaleY=0,C.renderTransform(1,C);return t?k.inverse():k}function _assertThisInitialized(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var gsap$1,_win$1,_doc$1,_docElement,_body,_tempDiv,_placeholderDiv,_coreInitted$1,_checkPrefix,_toArray,_supportsPassive,_isTouchDevice,_touchEventLookup,_isMultiTouching,_isAndroid,InertiaPlugin,_defaultCursor,_supportsPointer,_context$2,_getStyleSaver,_dragCount=0,_windowExists$1=function(){return typeof window<"u"},_getGSAP$1=function(){return gsap$1||_windowExists$1()&&(gsap$1=window.gsap)&&gsap$1.registerPlugin&&gsap$1},_isFunction$1=function(t){return typeof t=="function"},_isObject$1=function(t){return typeof t=="object"},_isUndefined$1=function(t){return typeof t>"u"},_emptyFunc=function(){return!1},_transformProp="transform",_transformOriginProp="transformOrigin",_round=function(t){return Math.round(t*1e4)/1e4},_isArray=Array.isArray,_createElement$1=function(t,i){var r=_doc$1.createElementNS?_doc$1.createElementNS("http://www.w3.org/1999/xhtml".replace(/^https/,"http"),t):_doc$1.createElement(t);return r.style?r:_doc$1.createElement(t)},_RAD2DEG=180/Math.PI,_bigNum=1e20,_identityMatrix$1=new Matrix2D,_getTime=Date.now||function(){return new Date().getTime()},_renderQueue=[],_lookup$1={},_lookupCount=0,_clickableTagExp=/^(?:a|input|textarea|button|select)$/i,_lastDragTime=0,_temp1={},_windowProxy={},_copy=function(t,i){var r={},o;for(o in t)r[o]=i?t[o]*i:t[o];return r},_extend=function(t,i){for(var r in i)r in t||(t[r]=i[r]);return t},_setTouchActionForAllDescendants=function e(t,i){for(var r=t.length,o;r--;)i?t[r].style.touchAction=i:t[r].style.removeProperty("touch-action"),o=t[r].children,o&&o.length&&e(o,i)},_renderQueueTick=function(){return _renderQueue.forEach(function(t){return t()})},_addToRenderQueue=function(t){_renderQueue.push(t),_renderQueue.length===1&&gsap$1.ticker.add(_renderQueueTick)},_renderQueueTimeout=function(){return!_renderQueue.length&&gsap$1.ticker.remove(_renderQueueTick)},_removeFromRenderQueue=function(t){for(var i=_renderQueue.length;i--;)_renderQueue[i]===t&&_renderQueue.splice(i,1);gsap$1.to(_renderQueueTimeout,{overwrite:!0,delay:15,duration:0,onComplete:_renderQueueTimeout,data:"_draggable"})},_setDefaults=function(t,i){for(var r in i)r in t||(t[r]=i[r]);return t},_addListener$1=function(t,i,r,o){if(t.addEventListener){var l=_touchEventLookup[i];o=o||(_supportsPassive?{passive:!1}:null),t.addEventListener(l||i,r,o),l&&i!==l&&t.addEventListener(i,r,o)}},_removeListener$1=function(t,i,r,o){if(t.removeEventListener){var l=_touchEventLookup[i];t.removeEventListener(l||i,r,o),l&&i!==l&&t.removeEventListener(i,r,o)}},_preventDefault=function(t){t.preventDefault&&t.preventDefault(),t.preventManipulation&&t.preventManipulation()},_hasTouchID=function(t,i){for(var r=t.length;r--;)if(t[r].identifier===i)return!0},_onMultiTouchDocumentEnd=function e(t){_isMultiTouching=t.touches&&_dragCount<t.touches.length,_removeListener$1(t.target,"touchend",e)},_onMultiTouchDocument=function(t){_isMultiTouching=t.touches&&_dragCount<t.touches.length,_addListener$1(t.target,"touchend",_onMultiTouchDocumentEnd)},_getDocScrollTop=function(t){return _win$1.pageYOffset||t.scrollTop||t.documentElement.scrollTop||t.body.scrollTop||0},_getDocScrollLeft=function(t){return _win$1.pageXOffset||t.scrollLeft||t.documentElement.scrollLeft||t.body.scrollLeft||0},_addScrollListener=function e(t,i){_addListener$1(t,"scroll",i),_isRoot(t.parentNode)||e(t.parentNode,i)},_removeScrollListener=function e(t,i){_removeListener$1(t,"scroll",i),_isRoot(t.parentNode)||e(t.parentNode,i)},_isRoot=function(t){return!t||t===_docElement||t.nodeType===9||t===_doc$1.body||t===_win$1||!t.nodeType||!t.parentNode},_getMaxScroll=function(t,i){var r=i==="x"?"Width":"Height",o="scroll"+r,l="client"+r;return Math.max(0,_isRoot(t)?Math.max(_docElement[o],_body[o])-(_win$1["inner"+r]||_docElement[l]||_body[l]):t[o]-t[l])},_recordMaxScrolls=function e(t,i){var r=_getMaxScroll(t,"x"),o=_getMaxScroll(t,"y");_isRoot(t)?t=_windowProxy:e(t.parentNode,i),t._gsMaxScrollX=r,t._gsMaxScrollY=o,i||(t._gsScrollX=t.scrollLeft||0,t._gsScrollY=t.scrollTop||0)},_setStyle=function(t,i,r){var o=t.style;o&&(_isUndefined$1(o[i])&&(i=_checkPrefix(i,t)||i),r==null?o.removeProperty&&o.removeProperty(i.replace(/([A-Z])/g,"-$1").toLowerCase()):o[i]=r)},_getComputedStyle=function(t){return _win$1.getComputedStyle(t instanceof Element?t:t.host||(t.parentNode||{}).host||t)},_tempRect={},_parseRect=function(t){if(t===_win$1)return _tempRect.left=_tempRect.top=0,_tempRect.width=_tempRect.right=_docElement.clientWidth||t.innerWidth||_body.clientWidth||0,_tempRect.height=_tempRect.bottom=(t.innerHeight||0)-20<_docElement.clientHeight?_docElement.clientHeight:t.innerHeight||_body.clientHeight||0,_tempRect;var i=t.ownerDocument||_doc$1,r=_isUndefined$1(t.pageX)?!t.nodeType&&!_isUndefined$1(t.left)&&!_isUndefined$1(t.top)?t:_toArray(t)[0].getBoundingClientRect():{left:t.pageX-_getDocScrollLeft(i),top:t.pageY-_getDocScrollTop(i),right:t.pageX-_getDocScrollLeft(i)+1,bottom:t.pageY-_getDocScrollTop(i)+1};return _isUndefined$1(r.right)&&!_isUndefined$1(r.width)?(r.right=r.left+r.width,r.bottom=r.top+r.height):_isUndefined$1(r.width)&&(r={width:r.right-r.left,height:r.bottom-r.top,right:r.right,left:r.left,bottom:r.bottom,top:r.top}),r},_dispatchEvent=function(t,i,r){var o=t.vars,l=o[r],d=t._listeners[i],n;return _isFunction$1(l)&&(n=l.apply(o.callbackScope||t,o[r+"Params"]||[t.pointerEvent])),d&&t.dispatchEvent(i)===!1&&(n=!1),n},_getBounds=function(t,i){var r=_toArray(t)[0],o,l,d;return!r.nodeType&&r!==_win$1?_isUndefined$1(t.left)?(l=t.min||t.minX||t.minRotation||0,o=t.min||t.minY||0,{left:l,top:o,width:(t.max||t.maxX||t.maxRotation||0)-l,height:(t.max||t.maxY||0)-o}):(d={x:0,y:0},{left:t.left-d.x,top:t.top-d.y,width:t.width,height:t.height}):_getElementBounds(r,i)},_point1={},_getElementBounds=function(t,i){i=_toArray(i)[0];var r=t.getBBox&&t.ownerSVGElement,o=t.ownerDocument||_doc$1,l,d,n,S,C,I,z,$,k,Y,ie,ue,ne;if(t===_win$1)n=_getDocScrollTop(o),l=_getDocScrollLeft(o),d=l+(o.documentElement.clientWidth||t.innerWidth||o.body.clientWidth||0),S=n+((t.innerHeight||0)-20<o.documentElement.clientHeight?o.documentElement.clientHeight:t.innerHeight||o.body.clientHeight||0);else{if(i===_win$1||_isUndefined$1(i))return t.getBoundingClientRect();l=n=0,r?(Y=t.getBBox(),ie=Y.width,ue=Y.height):(t.viewBox&&(Y=t.viewBox.baseVal)&&(l=Y.x||0,n=Y.y||0,ie=Y.width,ue=Y.height),ie||(ne=_getComputedStyle(t),Y=ne.boxSizing==="border-box",ie=(parseFloat(ne.width)||t.clientWidth||0)+(Y?0:parseFloat(ne.borderLeftWidth)+parseFloat(ne.borderRightWidth)),ue=(parseFloat(ne.height)||t.clientHeight||0)+(Y?0:parseFloat(ne.borderTopWidth)+parseFloat(ne.borderBottomWidth)))),d=ie,S=ue}return t===i?{left:l,top:n,width:d-l,height:S-n}:(C=getGlobalMatrix(i,!0).multiply(getGlobalMatrix(t)),I=C.apply({x:l,y:n}),z=C.apply({x:d,y:n}),$=C.apply({x:d,y:S}),k=C.apply({x:l,y:S}),l=Math.min(I.x,z.x,$.x,k.x),n=Math.min(I.y,z.y,$.y,k.y),{left:l,top:n,width:Math.max(I.x,z.x,$.x,k.x)-l,height:Math.max(I.y,z.y,$.y,k.y)-n})},_parseInertia=function(t,i,r,o,l,d){var n={},S,C,I;if(i)if(l!==1&&i instanceof Array){if(n.end=S=[],I=i.length,_isObject$1(i[0]))for(C=0;C<I;C++)S[C]=_copy(i[C],l);else for(C=0;C<I;C++)S[C]=i[C]*l;r+=1.1,o-=1.1}else _isFunction$1(i)?n.end=function(z){var $=i.call(t,z),k,Y;if(l!==1)if(_isObject$1($)){k={};for(Y in $)k[Y]=$[Y]*l;$=k}else $*=l;return $}:n.end=i;return(r||r===0)&&(n.max=r),(o||o===0)&&(n.min=o),d&&(n.velocity=0),n},_isClickable=function e(t){var i;return!t||!t.getAttribute||t===_body?!1:(i=t.getAttribute("data-clickable"))==="true"||i!=="false"&&(_clickableTagExp.test(t.nodeName+"")||t.getAttribute("contentEditable")==="true")?!0:e(t.parentNode)},_setSelectable=function(t,i){for(var r=t.length,o;r--;)o=t[r],o.ondragstart=o.onselectstart=i?null:_emptyFunc,gsap$1.set(o,{lazy:!0,userSelect:i?"text":"none"})},_isFixed=function e(t){if(_getComputedStyle(t).position==="fixed")return!0;if(t=t.parentNode,t&&t.nodeType===1)return e(t)},_supports3D,_addPaddingBR,ScrollProxy=function(t,i){t=gsap$1.utils.toArray(t)[0],i=i||{};var r=document.createElement("div"),o=r.style,l=t.firstChild,d=0,n=0,S=t.scrollTop,C=t.scrollLeft,I=t.scrollWidth,z=t.scrollHeight,$=0,k=0,Y=0,ie,ue,ne,se,le,he;_supports3D&&i.force3D!==!1?(le="translate3d(",he="px,0px)"):_transformProp&&(le="translate(",he="px)"),this.scrollTop=function(me,ge){if(!arguments.length)return-this.top();this.top(-me,ge)},this.scrollLeft=function(me,ge){if(!arguments.length)return-this.left();this.left(-me,ge)},this.left=function(me,ge){if(!arguments.length)return-(t.scrollLeft+n);var xt=t.scrollLeft-C,Et=n;if((xt>2||xt<-2)&&!ge){C=t.scrollLeft,gsap$1.killTweensOf(this,{left:1,scrollLeft:1}),this.left(-C),i.onKill&&i.onKill();return}me=-me,me<0?(n=me-.5|0,me=0):me>k?(n=me-k|0,me=k):n=0,(n||Et)&&(this._skip||(o[_transformProp]=le+-n+"px,"+-d+he),n+$>=0&&(o.paddingRight=n+$+"px")),t.scrollLeft=me|0,C=t.scrollLeft},this.top=function(me,ge){if(!arguments.length)return-(t.scrollTop+d);var xt=t.scrollTop-S,Et=d;if((xt>2||xt<-2)&&!ge){S=t.scrollTop,gsap$1.killTweensOf(this,{top:1,scrollTop:1}),this.top(-S),i.onKill&&i.onKill();return}me=-me,me<0?(d=me-.5|0,me=0):me>Y?(d=me-Y|0,me=Y):d=0,(d||Et)&&(this._skip||(o[_transformProp]=le+-n+"px,"+-d+he)),t.scrollTop=me|0,S=t.scrollTop},this.maxScrollTop=function(){return Y},this.maxScrollLeft=function(){return k},this.disable=function(){for(l=r.firstChild;l;)se=l.nextSibling,t.appendChild(l),l=se;t===r.parentNode&&t.removeChild(r)},this.enable=function(){if(l=t.firstChild,l!==r){for(;l;)se=l.nextSibling,r.appendChild(l),l=se;t.appendChild(r),this.calibrate()}},this.calibrate=function(me){var ge=t.clientWidth===ie,xt,Et,Lt;S=t.scrollTop,C=t.scrollLeft,!(ge&&t.clientHeight===ue&&r.offsetHeight===ne&&I===t.scrollWidth&&z===t.scrollHeight&&!me)&&((d||n)&&(Et=this.left(),Lt=this.top(),this.left(-t.scrollLeft),this.top(-t.scrollTop)),xt=_getComputedStyle(t),(!ge||me)&&(o.display="block",o.width="auto",o.paddingRight="0px",$=Math.max(0,t.scrollWidth-t.clientWidth),$&&($+=parseFloat(xt.paddingLeft)+(_addPaddingBR?parseFloat(xt.paddingRight):0))),o.display="inline-block",o.position="relative",o.overflow="visible",o.verticalAlign="top",o.boxSizing="content-box",o.width="100%",o.paddingRight=$+"px",_addPaddingBR&&(o.paddingBottom=xt.paddingBottom),ie=t.clientWidth,ue=t.clientHeight,I=t.scrollWidth,z=t.scrollHeight,k=t.scrollWidth-ie,Y=t.scrollHeight-ue,ne=r.offsetHeight,o.display="block",(Et||Lt)&&(this.left(Et),this.top(Lt)))},this.content=r,this.element=t,this._skip=!1,this.enable()},_initCore$1=function(t){if(_windowExists$1()&&document.body){var i=window&&window.navigator;_win$1=window,_doc$1=document,_docElement=_doc$1.documentElement,_body=_doc$1.body,_tempDiv=_createElement$1("div"),_supportsPointer=!!window.PointerEvent,_placeholderDiv=_createElement$1("div"),_placeholderDiv.style.cssText="visibility:hidden;height:1px;top:-1px;pointer-events:none;position:relative;clear:both;cursor:grab",_defaultCursor=_placeholderDiv.style.cursor==="grab"?"grab":"move",_isAndroid=i&&i.userAgent.toLowerCase().indexOf("android")!==-1,_isTouchDevice="ontouchstart"in _docElement&&"orientation"in _win$1||i&&(i.MaxTouchPoints>0||i.msMaxTouchPoints>0),_addPaddingBR=function(){var r=_createElement$1("div"),o=_createElement$1("div"),l=o.style,d=_body,n;return l.display="inline-block",l.position="relative",r.style.cssText="width:90px;height:40px;padding:10px;overflow:auto;visibility:hidden",r.appendChild(o),d.appendChild(r),n=o.offsetHeight+18>r.scrollHeight,d.removeChild(r),n}(),_touchEventLookup=function(r){for(var o=r.split(","),l=("onpointerdown"in _tempDiv?"pointerdown,pointermove,pointerup,pointercancel":"onmspointerdown"in _tempDiv?"MSPointerDown,MSPointerMove,MSPointerUp,MSPointerCancel":r).split(","),d={},n=4;--n>-1;)d[o[n]]=l[n],d[l[n]]=o[n];try{_docElement.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){_supportsPassive=1}}))}catch{}return d}("touchstart,touchmove,touchend,touchcancel"),_addListener$1(_doc$1,"touchcancel",_emptyFunc),_addListener$1(_win$1,"touchmove",_emptyFunc),_body&&_body.addEventListener("touchstart",_emptyFunc),_addListener$1(_doc$1,"contextmenu",function(){for(var r in _lookup$1)_lookup$1[r].isPressed&&_lookup$1[r].endDrag()}),gsap$1=_coreInitted$1=_getGSAP$1()}gsap$1?(InertiaPlugin=gsap$1.plugins.inertia,_context$2=gsap$1.core.context||function(){},_checkPrefix=gsap$1.utils.checkPrefix,_transformProp=_checkPrefix(_transformProp),_transformOriginProp=_checkPrefix(_transformOriginProp),_toArray=gsap$1.utils.toArray,_getStyleSaver=gsap$1.core.getStyleSaver,_supports3D=!!_checkPrefix("perspective")):t&&console.warn("Please gsap.registerPlugin(Draggable)")},EventDispatcher$1=function(){function e(i){this._listeners={},this.target=i||this}var t=e.prototype;return t.addEventListener=function(r,o){var l=this._listeners[r]||(this._listeners[r]=[]);~l.indexOf(o)||l.push(o)},t.removeEventListener=function(r,o){var l=this._listeners[r],d=l&&l.indexOf(o);d>=0&&l.splice(d,1)},t.dispatchEvent=function(r){var o=this,l;return(this._listeners[r]||[]).forEach(function(d){return d.call(o,{type:r,target:o.target})===!1&&(l=!1)}),l},e}(),Draggable=function(e){_inheritsLoose(t,e);function t(i,r){var o;o=e.call(this)||this,_coreInitted$1||_initCore$1(1),i=_toArray(i)[0],o.styles=_getStyleSaver&&_getStyleSaver(i,"transform,left,top"),InertiaPlugin||(InertiaPlugin=gsap$1.plugins.inertia),o.vars=r=_copy(r||{}),o.target=i,o.x=o.y=o.rotation=0,o.dragResistance=parseFloat(r.dragResistance)||0,o.edgeResistance=isNaN(r.edgeResistance)?1:parseFloat(r.edgeResistance)||0,o.lockAxis=r.lockAxis,o.autoScroll=r.autoScroll||0,o.lockedAxis=null,o.allowEventDefault=!!r.allowEventDefault,gsap$1.getProperty(i,"x");var l=(r.type||"x,y").toLowerCase(),d=~l.indexOf("x")||~l.indexOf("y"),n=l.indexOf("rotation")!==-1,S=n?"rotation":d?"x":"left",C=d?"y":"top",I=!!(~l.indexOf("x")||~l.indexOf("left")||l==="scroll"),z=!!(~l.indexOf("y")||~l.indexOf("top")||l==="scroll"),$=r.minimumMovement||2,k=_assertThisInitialized(o),Y=_toArray(r.trigger||r.handle||i),ie={},ue=0,ne=!1,se=r.autoScrollMarginTop||40,le=r.autoScrollMarginRight||40,he=r.autoScrollMarginBottom||40,me=r.autoScrollMarginLeft||40,ge=r.clickableTest||_isClickable,xt=0,Et=i._gsap||gsap$1.core.getCache(i),Lt=_isFixed(i),Zt=function(Ki,pi){return parseFloat(Et.get(i,Ki,pi))},Ht=i.ownerDocument||_doc$1,It,Yt,ri,ei,Ct,Ut,Mt,$t,jt,mi,Xi,Er,Ir,nr,si,Gt,ui,oi,Si,Li,Mi,kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi,$i,fr,ir,lr=function(Ki){return _preventDefault(Ki),Ki.stopImmediatePropagation&&Ki.stopImmediatePropagation(),!1},Tr=function rr(Ki){if(k.autoScroll&&k.isDragging&&(ne||ui)){var pi=i,Ii=k.autoScroll*15,Ai,ii,wt,Ft,Vt,ni,Jt,yi;for(ne=!1,_windowProxy.scrollTop=_win$1.pageYOffset!=null?_win$1.pageYOffset:Ht.documentElement.scrollTop!=null?Ht.documentElement.scrollTop:Ht.body.scrollTop,_windowProxy.scrollLeft=_win$1.pageXOffset!=null?_win$1.pageXOffset:Ht.documentElement.scrollLeft!=null?Ht.documentElement.scrollLeft:Ht.body.scrollLeft,Ft=k.pointerX-_windowProxy.scrollLeft,Vt=k.pointerY-_windowProxy.scrollTop;pi&&!ii;)ii=_isRoot(pi.parentNode),Ai=ii?_windowProxy:pi.parentNode,wt=ii?{bottom:Math.max(_docElement.clientHeight,_win$1.innerHeight||0),right:Math.max(_docElement.clientWidth,_win$1.innerWidth||0),left:0,top:0}:Ai.getBoundingClientRect(),ni=Jt=0,z&&(yi=Ai._gsMaxScrollY-Ai.scrollTop,yi<0?Jt=yi:Vt>wt.bottom-he&&yi?(ne=!0,Jt=Math.min(yi,Ii*(1-Math.max(0,wt.bottom-Vt)/he)|0)):Vt<wt.top+se&&Ai.scrollTop&&(ne=!0,Jt=-Math.min(Ai.scrollTop,Ii*(1-Math.max(0,Vt-wt.top)/se)|0)),Jt&&(Ai.scrollTop+=Jt)),I&&(yi=Ai._gsMaxScrollX-Ai.scrollLeft,yi<0?ni=yi:Ft>wt.right-le&&yi?(ne=!0,ni=Math.min(yi,Ii*(1-Math.max(0,wt.right-Ft)/le)|0)):Ft<wt.left+me&&Ai.scrollLeft&&(ne=!0,ni=-Math.min(Ai.scrollLeft,Ii*(1-Math.max(0,Ft-wt.left)/me)|0)),ni&&(Ai.scrollLeft+=ni)),ii&&(ni||Jt)&&(_win$1.scrollTo(Ai.scrollLeft,Ai.scrollTop),Os(k.pointerX+ni,k.pointerY+Jt)),pi=Ai}if(ui){var Fi=k.x,bi=k.y;n?(k.deltaX=Fi-parseFloat(Et.rotation),k.rotation=Fi,Et.rotation=Fi+"deg",Et.renderTransform(1,Et)):Yt?(z&&(k.deltaY=bi-Yt.top(),Yt.top(bi)),I&&(k.deltaX=Fi-Yt.left(),Yt.left(Fi))):d?(z&&(k.deltaY=bi-parseFloat(Et.y),Et.y=bi+"px"),I&&(k.deltaX=Fi-parseFloat(Et.x),Et.x=Fi+"px"),Et.renderTransform(1,Et)):(z&&(k.deltaY=bi-parseFloat(i.style.top||0),i.style.top=bi+"px"),I&&(k.deltaX=Fi-parseFloat(i.style.left||0),i.style.left=Fi+"px")),$t&&!Ki&&!Hi&&(Hi=!0,_dispatchEvent(k,"drag","onDrag")===!1&&(I&&(k.x-=k.deltaX),z&&(k.y-=k.deltaY),rr(!0)),Hi=!1)}ui=!1},Rr=function(Ki,pi){var Ii=k.x,Ai=k.y,ii,wt;i._gsap||(Et=gsap$1.core.getCache(i)),Et.uncache&&gsap$1.getProperty(i,"x"),d?(k.x=parseFloat(Et.x),k.y=parseFloat(Et.y)):n?k.x=k.rotation=parseFloat(Et.rotation):Yt?(k.y=Yt.top(),k.x=Yt.left()):(k.y=parseFloat(i.style.top||(wt=_getComputedStyle(i))&&wt.top)||0,k.x=parseFloat(i.style.left||(wt||{}).left)||0),(Si||Li||Mi)&&!pi&&(k.isDragging||k.isThrowing)&&(Mi&&(_temp1.x=k.x,_temp1.y=k.y,ii=Mi(_temp1),ii.x!==k.x&&(k.x=ii.x,ui=!0),ii.y!==k.y&&(k.y=ii.y,ui=!0)),Si&&(ii=Si(k.x),ii!==k.x&&(k.x=ii,n&&(k.rotation=ii),ui=!0)),Li&&(ii=Li(k.y),ii!==k.y&&(k.y=ii),ui=!0)),ui&&Tr(!0),Ki||(k.deltaX=k.x-Ii,k.deltaY=k.y-Ai,_dispatchEvent(k,"throwupdate","onThrowUpdate"))},Jr=function(Ki,pi,Ii,Ai){return pi==null&&(pi=-1e20),Ii==null&&(Ii=_bigNum),_isFunction$1(Ki)?function(ii){var wt=k.isPressed?1-k.edgeResistance:1;return Ki.call(k,(ii>Ii?Ii+(ii-Ii)*wt:ii<pi?pi+(ii-pi)*wt:ii)*Ai)*Ai}:_isArray(Ki)?function(ii){for(var wt=Ki.length,Ft=0,Vt=_bigNum,ni,Jt;--wt>-1;)ni=Ki[wt],Jt=ni-ii,Jt<0&&(Jt=-Jt),Jt<Vt&&ni>=pi&&ni<=Ii&&(Ft=wt,Vt=Jt);return Ki[Ft]}:isNaN(Ki)?function(ii){return ii}:function(){return Ki*Ai}},_r=function(Ki,pi,Ii,Ai,ii,wt,Ft){return wt=wt&&wt<_bigNum?wt*wt:_bigNum,_isFunction$1(Ki)?function(Vt){var ni=k.isPressed?1-k.edgeResistance:1,Jt=Vt.x,yi=Vt.y,Fi,bi,Oi;return Vt.x=Jt=Jt>Ii?Ii+(Jt-Ii)*ni:Jt<pi?pi+(Jt-pi)*ni:Jt,Vt.y=yi=yi>ii?ii+(yi-ii)*ni:yi<Ai?Ai+(yi-Ai)*ni:yi,Fi=Ki.call(k,Vt),Fi!==Vt&&(Vt.x=Fi.x,Vt.y=Fi.y),Ft!==1&&(Vt.x*=Ft,Vt.y*=Ft),wt<_bigNum&&(bi=Vt.x-Jt,Oi=Vt.y-yi,bi*bi+Oi*Oi>wt&&(Vt.x=Jt,Vt.y=yi)),Vt}:_isArray(Ki)?function(Vt){for(var ni=Ki.length,Jt=0,yi=_bigNum,Fi,bi,Oi,qi;--ni>-1;)Oi=Ki[ni],Fi=Oi.x-Vt.x,bi=Oi.y-Vt.y,qi=Fi*Fi+bi*bi,qi<yi&&(Jt=ni,yi=qi);return yi<=wt?Ki[Jt]:Vt}:function(Vt){return Vt}},mr=function(){var Ki,pi,Ii,Ai;Mt=!1,Yt?(Yt.calibrate(),k.minX=Xi=-Yt.maxScrollLeft(),k.minY=Ir=-Yt.maxScrollTop(),k.maxX=mi=k.maxY=Er=0,Mt=!0):r.bounds&&(Ki=_getBounds(r.bounds,i.parentNode),n?(k.minX=Xi=Ki.left,k.maxX=mi=Ki.left+Ki.width,k.minY=Ir=k.maxY=Er=0):!_isUndefined$1(r.bounds.maxX)||!_isUndefined$1(r.bounds.maxY)?(Ki=r.bounds,k.minX=Xi=Ki.minX,k.minY=Ir=Ki.minY,k.maxX=mi=Ki.maxX,k.maxY=Er=Ki.maxY):(pi=_getBounds(i,i.parentNode),k.minX=Xi=Math.round(Zt(S,"px")+Ki.left-pi.left),k.minY=Ir=Math.round(Zt(C,"px")+Ki.top-pi.top),k.maxX=mi=Math.round(Xi+(Ki.width-pi.width)),k.maxY=Er=Math.round(Ir+(Ki.height-pi.height))),Xi>mi&&(k.minX=mi,k.maxX=mi=Xi,Xi=k.minX),Ir>Er&&(k.minY=Er,k.maxY=Er=Ir,Ir=k.minY),n&&(k.minRotation=Xi,k.maxRotation=mi),Mt=!0),r.liveSnap&&(Ii=r.liveSnap===!0?r.snap||{}:r.liveSnap,Ai=_isArray(Ii)||_isFunction$1(Ii),n?(Si=Jr(Ai?Ii:Ii.rotation,Xi,mi,1),Li=null):Ii.points?Mi=_r(Ai?Ii:Ii.points,Xi,mi,Ir,Er,Ii.radius,Yt?-1:1):(I&&(Si=Jr(Ai?Ii:Ii.x||Ii.left||Ii.scrollLeft,Xi,mi,Yt?-1:1)),z&&(Li=Jr(Ai?Ii:Ii.y||Ii.top||Ii.scrollTop,Ir,Er,Yt?-1:1))))},wr=function(){k.isThrowing=!1,_dispatchEvent(k,"throwcomplete","onThrowComplete")},Vr=function(){k.isThrowing=!1},wn=function(Ki,pi){var Ii,Ai,ii,wt;Ki&&InertiaPlugin?(Ki===!0&&(Ii=r.snap||r.liveSnap||{},Ai=_isArray(Ii)||_isFunction$1(Ii),Ki={resistance:(r.throwResistance||r.resistance||1e3)/(n?10:1)},n?Ki.rotation=_parseInertia(k,Ai?Ii:Ii.rotation,mi,Xi,1,pi):(I&&(Ki[S]=_parseInertia(k,Ai?Ii:Ii.points||Ii.x||Ii.left,mi,Xi,Yt?-1:1,pi||k.lockedAxis==="x")),z&&(Ki[C]=_parseInertia(k,Ai?Ii:Ii.points||Ii.y||Ii.top,Er,Ir,Yt?-1:1,pi||k.lockedAxis==="y")),(Ii.points||_isArray(Ii)&&_isObject$1(Ii[0]))&&(Ki.linkedProps=S+","+C,Ki.radius=Ii.radius))),k.isThrowing=!0,wt=isNaN(r.overshootTolerance)?r.edgeResistance===1?0:1-k.edgeResistance+.2:r.overshootTolerance,Ki.duration||(Ki.duration={max:Math.max(r.minDuration||0,"maxDuration"in r?r.maxDuration:2),min:isNaN(r.minDuration)?wt===0||_isObject$1(Ki)&&Ki.resistance>1e3?0:.5:r.minDuration,overshoot:wt}),k.tween=ii=gsap$1.to(Yt||i,{inertia:Ki,data:"_draggable",inherit:!1,onComplete:wr,onInterrupt:Vr,onUpdate:r.fastMode?_dispatchEvent:Rr,onUpdateParams:r.fastMode?[k,"onthrowupdate","onThrowUpdate"]:Ii&&Ii.radius?[!1,!0]:[]}),r.fastMode||(Yt&&(Yt._skip=!0),ii.render(1e9,!0,!0),Rr(!0,!0),k.endX=k.x,k.endY=k.y,n&&(k.endRotation=k.x),ii.play(0),Rr(!0,!0),Yt&&(Yt._skip=!1))):Mt&&k.applyBounds()},Nn=function(Ki){var pi=gi,Ii;gi=getGlobalMatrix(i.parentNode,!0),Ki&&k.isPressed&&!gi.equals(pi||new Matrix2D)&&(Ii=pi.inverse().apply({x:ri,y:ei}),gi.apply(Ii,Ii),ri=Ii.x,ei=Ii.y),gi.equals(_identityMatrix$1)&&(gi=null)},zs=function(){var Ki=1-k.edgeResistance,pi=Lt?_getDocScrollLeft(Ht):0,Ii=Lt?_getDocScrollTop(Ht):0,Ai,ii,wt;d&&(Et.x=Zt(S,"px")+"px",Et.y=Zt(C,"px")+"px",Et.renderTransform()),Nn(!1),_point1.x=k.pointerX-pi,_point1.y=k.pointerY-Ii,gi&&gi.apply(_point1,_point1),ri=_point1.x,ei=_point1.y,ui&&(Os(k.pointerX,k.pointerY),Tr(!0)),fr=getGlobalMatrix(i),Yt?(mr(),Ut=Yt.top(),Ct=Yt.left()):(es()?(Rr(!0,!0),mr()):k.applyBounds(),n?(Ai=i.ownerSVGElement?[Et.xOrigin-i.getBBox().x,Et.yOrigin-i.getBBox().y]:(_getComputedStyle(i)[_transformOriginProp]||"0 0").split(" "),Gt=k.rotationOrigin=getGlobalMatrix(i).apply({x:parseFloat(Ai[0])||0,y:parseFloat(Ai[1])||0}),Rr(!0,!0),ii=k.pointerX-Gt.x-pi,wt=Gt.y-k.pointerY+Ii,Ct=k.x,Ut=k.y=Math.atan2(wt,ii)*_RAD2DEG):(Ut=Zt(C,"px"),Ct=Zt(S,"px"))),Mt&&Ki&&(Ct>mi?Ct=mi+(Ct-mi)/Ki:Ct<Xi&&(Ct=Xi-(Xi-Ct)/Ki),n||(Ut>Er?Ut=Er+(Ut-Er)/Ki:Ut<Ir&&(Ut=Ir-(Ir-Ut)/Ki))),k.startX=Ct=_round(Ct),k.startY=Ut=_round(Ut)},es=function(){return k.tween&&k.tween.isActive()},As=function(){_placeholderDiv.parentNode&&!es()&&!k.isDragging&&_placeholderDiv.parentNode.removeChild(_placeholderDiv)},Dn=function(Ki,pi){var Ii;if(!It||k.isPressed||!Ki||(Ki.type==="mousedown"||Ki.type==="pointerdown")&&!pi&&_getTime()-xt<30&&_touchEventLookup[k.pointerEvent.type]){$i&&Ki&&It&&_preventDefault(Ki);return}if(Ri=es(),ir=!1,k.pointerEvent=Ki,_touchEventLookup[Ki.type]?(Nt=~Ki.type.indexOf("touch")?Ki.currentTarget||Ki.target:Ht,_addListener$1(Nt,"touchend",Un),_addListener$1(Nt,"touchmove",Sn),_addListener$1(Nt,"touchcancel",Un),_addListener$1(Ht,"touchstart",_onMultiTouchDocument)):(Nt=null,_addListener$1(Ht,"mousemove",Sn)),Xt=null,(!_supportsPointer||!Nt)&&(_addListener$1(Ht,"mouseup",Un),Ki&&Ki.target&&_addListener$1(Ki.target,"mouseup",Un)),kt=ge.call(k,Ki.target)&&r.dragClickables===!1&&!pi,kt){_addListener$1(Ki.target,"change",Un),_dispatchEvent(k,"pressInit","onPressInit"),_dispatchEvent(k,"press","onPress"),_setSelectable(Y,!0),$i=!1;return}if(Rt=!Nt||I===z||k.vars.allowNativeTouchScrolling===!1||k.vars.allowContextMenu&&Ki&&(Ki.ctrlKey||Ki.which>2)?!1:I?"y":"x",$i=!Rt&&!k.allowEventDefault,$i&&(_preventDefault(Ki),_addListener$1(_win$1,"touchforcechange",_preventDefault)),Ki.changedTouches?(Ki=nr=Ki.changedTouches[0],si=Ki.identifier):Ki.pointerId?si=Ki.pointerId:nr=si=null,_dragCount++,_addToRenderQueue(Tr),ei=k.pointerY=Ki.pageY,ri=k.pointerX=Ki.pageX,_dispatchEvent(k,"pressInit","onPressInit"),(Rt||k.autoScroll)&&_recordMaxScrolls(i.parentNode),i.parentNode&&k.autoScroll&&!Yt&&!n&&i.parentNode._gsMaxScrollX&&!_placeholderDiv.parentNode&&!i.getBBox&&(_placeholderDiv.style.width=i.parentNode.scrollWidth+"px",i.parentNode.appendChild(_placeholderDiv)),zs(),k.tween&&k.tween.kill(),k.isThrowing=!1,gsap$1.killTweensOf(Yt||i,ie,!0),Yt&&gsap$1.killTweensOf(i,{scrollTo:1},!0),k.tween=k.lockedAxis=null,(r.zIndexBoost||!n&&!Yt&&r.zIndexBoost!==!1)&&(i.style.zIndex=t.zIndex++),k.isPressed=!0,$t=!!(r.onDrag||k._listeners.drag),jt=!!(r.onMove||k._listeners.move),r.cursor!==!1||r.activeCursor)for(Ii=Y.length;--Ii>-1;)gsap$1.set(Y[Ii],{cursor:r.activeCursor||r.cursor||(_defaultCursor==="grab"?"grabbing":_defaultCursor)});_dispatchEvent(k,"press","onPress")},Sn=function(Ki){var pi=Ki,Ii,Ai,ii,wt,Ft,Vt;if(!It||_isMultiTouching||!k.isPressed||!Ki){$i&&Ki&&It&&_preventDefault(Ki);return}if(k.pointerEvent=Ki,Ii=Ki.changedTouches,Ii){if(Ki=Ii[0],Ki!==nr&&Ki.identifier!==si){for(wt=Ii.length;--wt>-1&&(Ki=Ii[wt]).identifier!==si&&Ki.target!==i;);if(wt<0)return}}else if(Ki.pointerId&&si&&Ki.pointerId!==si)return;if(Nt&&Rt&&!Xt&&(_point1.x=Ki.pageX-(Lt?_getDocScrollLeft(Ht):0),_point1.y=Ki.pageY-(Lt?_getDocScrollTop(Ht):0),gi&&gi.apply(_point1,_point1),Ai=_point1.x,ii=_point1.y,Ft=Math.abs(Ai-ri),Vt=Math.abs(ii-ei),(Ft!==Vt&&(Ft>$||Vt>$)||_isAndroid&&Rt===Xt)&&(Xt=Ft>Vt&&I?"x":"y",Rt&&Xt!==Rt&&_addListener$1(_win$1,"touchforcechange",_preventDefault),k.vars.lockAxisOnTouchScroll!==!1&&I&&z&&(k.lockedAxis=Xt==="x"?"y":"x",_isFunction$1(k.vars.onLockAxis)&&k.vars.onLockAxis.call(k,pi)),_isAndroid&&Rt===Xt))){Un(pi);return}!k.allowEventDefault&&(!Rt||Xt&&Rt!==Xt)&&pi.cancelable!==!1?(_preventDefault(pi),$i=!0):$i&&($i=!1),k.autoScroll&&(ne=!0),Os(Ki.pageX,Ki.pageY,jt)},Os=function(Ki,pi,Ii){var Ai=1-k.dragResistance,ii=1-k.edgeResistance,wt=k.pointerX,Ft=k.pointerY,Vt=Ut,ni=k.x,Jt=k.y,yi=k.endX,Fi=k.endY,bi=k.endRotation,Oi=ui,qi,Bi,dr,pr,Nr,Gr;k.pointerX=Ki,k.pointerY=pi,Lt&&(Ki-=_getDocScrollLeft(Ht),pi-=_getDocScrollTop(Ht)),n?(pr=Math.atan2(Gt.y-pi,Ki-Gt.x)*_RAD2DEG,Nr=k.y-pr,Nr>180?(Ut-=360,k.y=pr):Nr<-180&&(Ut+=360,k.y=pr),k.x!==Ct||Math.max(Math.abs(ri-Ki),Math.abs(ei-pi))>$?(k.y=pr,dr=Ct+(Ut-pr)*Ai):dr=Ct):(gi&&(Gr=Ki*gi.a+pi*gi.c+gi.e,pi=Ki*gi.b+pi*gi.d+gi.f,Ki=Gr),Bi=pi-ei,qi=Ki-ri,Bi<$&&Bi>-$&&(Bi=0),qi<$&&qi>-$&&(qi=0),(k.lockAxis||k.lockedAxis)&&(qi||Bi)&&(Gr=k.lockedAxis,Gr||(k.lockedAxis=Gr=I&&Math.abs(qi)>Math.abs(Bi)?"y":z?"x":null,Gr&&_isFunction$1(k.vars.onLockAxis)&&k.vars.onLockAxis.call(k,k.pointerEvent)),Gr==="y"?Bi=0:Gr==="x"&&(qi=0)),dr=_round(Ct+qi*Ai),pr=_round(Ut+Bi*Ai)),(Si||Li||Mi)&&(k.x!==dr||k.y!==pr&&!n)&&(Mi&&(_temp1.x=dr,_temp1.y=pr,Gr=Mi(_temp1),dr=_round(Gr.x),pr=_round(Gr.y)),Si&&(dr=_round(Si(dr))),Li&&(pr=_round(Li(pr)))),Mt&&(dr>mi?dr=mi+Math.round((dr-mi)*ii):dr<Xi&&(dr=Xi+Math.round((dr-Xi)*ii)),n||(pr>Er?pr=Math.round(Er+(pr-Er)*ii):pr<Ir&&(pr=Math.round(Ir+(pr-Ir)*ii)))),(k.x!==dr||k.y!==pr&&!n)&&(n?(k.endRotation=k.x=k.endX=dr,ui=!0):(z&&(k.y=k.endY=pr,ui=!0),I&&(k.x=k.endX=dr,ui=!0)),!Ii||_dispatchEvent(k,"move","onMove")!==!1?!k.isDragging&&k.isPressed&&(k.isDragging=ir=!0,_dispatchEvent(k,"dragstart","onDragStart")):(k.pointerX=wt,k.pointerY=Ft,Ut=Vt,k.x=ni,k.y=Jt,k.endX=yi,k.endY=Fi,k.endRotation=bi,ui=Oi))},Un=function rr(Ki,pi){if(!It||!k.isPressed||Ki&&si!=null&&!pi&&(Ki.pointerId&&Ki.pointerId!==si&&Ki.target!==i||Ki.changedTouches&&!_hasTouchID(Ki.changedTouches,si))){$i&&Ki&&It&&_preventDefault(Ki);return}k.isPressed=!1;var Ii=Ki,Ai=k.isDragging,ii=k.vars.allowContextMenu&&Ki&&(Ki.ctrlKey||Ki.which>2),wt=gsap$1.delayedCall(.001,As),Ft,Vt,ni,Jt,yi;if(Nt?(_removeListener$1(Nt,"touchend",rr),_removeListener$1(Nt,"touchmove",Sn),_removeListener$1(Nt,"touchcancel",rr),_removeListener$1(Ht,"touchstart",_onMultiTouchDocument)):_removeListener$1(Ht,"mousemove",Sn),_removeListener$1(_win$1,"touchforcechange",_preventDefault),(!_supportsPointer||!Nt)&&(_removeListener$1(Ht,"mouseup",rr),Ki&&Ki.target&&_removeListener$1(Ki.target,"mouseup",rr)),ui=!1,Ai&&(ue=_lastDragTime=_getTime(),k.isDragging=!1),_removeFromRenderQueue(Tr),kt&&!ii){Ki&&(_removeListener$1(Ki.target,"change",rr),k.pointerEvent=Ii),_setSelectable(Y,!1),_dispatchEvent(k,"release","onRelease"),_dispatchEvent(k,"click","onClick"),kt=!1;return}for(Vt=Y.length;--Vt>-1;)_setStyle(Y[Vt],"cursor",r.cursor||(r.cursor!==!1?_defaultCursor:null));if(_dragCount--,Ki){if(Ft=Ki.changedTouches,Ft&&(Ki=Ft[0],Ki!==nr&&Ki.identifier!==si)){for(Vt=Ft.length;--Vt>-1&&(Ki=Ft[Vt]).identifier!==si&&Ki.target!==i;);if(Vt<0&&!pi)return}k.pointerEvent=Ii,k.pointerX=Ki.pageX,k.pointerY=Ki.pageY}return ii&&Ii?(_preventDefault(Ii),$i=!0,_dispatchEvent(k,"release","onRelease")):Ii&&!Ai?($i=!1,Ri&&(r.snap||r.bounds)&&wn(r.inertia||r.throwProps),_dispatchEvent(k,"release","onRelease"),(!_isAndroid||Ii.type!=="touchmove")&&Ii.type.indexOf("cancel")===-1&&(_dispatchEvent(k,"click","onClick"),_getTime()-xt<300&&_dispatchEvent(k,"doubleclick","onDoubleClick"),Jt=Ii.target||i,xt=_getTime(),yi=function(){xt!==Ni&&k.enabled()&&!k.isPressed&&!Ii.defaultPrevented&&(Jt.click?Jt.click():Ht.createEvent&&(ni=Ht.createEvent("MouseEvents"),ni.initMouseEvent("click",!0,!0,_win$1,1,k.pointerEvent.screenX,k.pointerEvent.screenY,k.pointerX,k.pointerY,!1,!1,!1,!1,0,null),Jt.dispatchEvent(ni)))},!_isAndroid&&!Ii.defaultPrevented&&gsap$1.delayedCall(.05,yi))):(wn(r.inertia||r.throwProps),!k.allowEventDefault&&Ii&&(r.dragClickables!==!1||!ge.call(k,Ii.target))&&Ai&&(!Rt||Xt&&Rt===Xt)&&Ii.cancelable!==!1?($i=!0,_preventDefault(Ii)):$i=!1,_dispatchEvent(k,"release","onRelease")),es()&&wt.duration(k.tween.duration()),Ai&&_dispatchEvent(k,"dragend","onDragEnd"),!0},Ks=function(Ki){if(Ki&&k.isDragging&&!Yt){var pi=Ki.target||i.parentNode,Ii=pi.scrollLeft-pi._gsScrollX,Ai=pi.scrollTop-pi._gsScrollY;(Ii||Ai)&&(gi?(ri-=Ii*gi.a+Ai*gi.c,ei-=Ai*gi.d+Ii*gi.b):(ri-=Ii,ei-=Ai),pi._gsScrollX+=Ii,pi._gsScrollY+=Ai,Os(k.pointerX,k.pointerY))}},xs=function(Ki){var pi=_getTime(),Ii=pi-xt<100,Ai=pi-ue<50,ii=Ii&&Ni===xt,wt=k.pointerEvent&&k.pointerEvent.defaultPrevented,Ft=Ii&&xi===xt,Vt=Ki.isTrusted||Ki.isTrusted==null&&Ii&&ii;if((ii||Ai&&k.vars.suppressClickOnDrag!==!1)&&Ki.stopImmediatePropagation&&Ki.stopImmediatePropagation(),Ii&&!(k.pointerEvent&&k.pointerEvent.defaultPrevented)&&(!ii||Vt&&!Ft)){Vt&&ii&&(xi=xt),Ni=xt;return}(k.isPressed||Ai||Ii)&&(!Vt||!Ki.detail||!Ii||wt)&&_preventDefault(Ki),!Ii&&!Ai&&!ir&&(Ki&&Ki.target&&(k.pointerEvent=Ki),_dispatchEvent(k,"click","onClick"))},eo=function(Ki){return gi?{x:Ki.x*gi.a+Ki.y*gi.c+gi.e,y:Ki.x*gi.b+Ki.y*gi.d+gi.f}:{x:Ki.x,y:Ki.y}};return oi=t.get(i),oi&&oi.kill(),o.startDrag=function(rr,Ki){var pi,Ii,Ai,ii;Dn(rr||k.pointerEvent,!0),Ki&&!k.hitTest(rr||k.pointerEvent)&&(pi=_parseRect(rr||k.pointerEvent),Ii=_parseRect(i),Ai=eo({x:pi.left+pi.width/2,y:pi.top+pi.height/2}),ii=eo({x:Ii.left+Ii.width/2,y:Ii.top+Ii.height/2}),ri-=Ai.x-ii.x,ei-=Ai.y-ii.y),k.isDragging||(k.isDragging=ir=!0,_dispatchEvent(k,"dragstart","onDragStart"))},o.drag=Sn,o.endDrag=function(rr){return Un(rr||k.pointerEvent,!0)},o.timeSinceDrag=function(){return k.isDragging?0:(_getTime()-ue)/1e3},o.timeSinceClick=function(){return(_getTime()-xt)/1e3},o.hitTest=function(rr,Ki){return t.hitTest(k.target,rr,Ki)},o.getDirection=function(rr,Ki){var pi=rr==="velocity"&&InertiaPlugin?rr:_isObject$1(rr)&&!n?"element":"start",Ii,Ai,ii,wt,Ft,Vt;return pi==="element"&&(Ft=_parseRect(k.target),Vt=_parseRect(rr)),Ii=pi==="start"?k.x-Ct:pi==="velocity"?InertiaPlugin.getVelocity(i,S):Ft.left+Ft.width/2-(Vt.left+Vt.width/2),n?Ii<0?"counter-clockwise":"clockwise":(Ki=Ki||2,Ai=pi==="start"?k.y-Ut:pi==="velocity"?InertiaPlugin.getVelocity(i,C):Ft.top+Ft.height/2-(Vt.top+Vt.height/2),ii=Math.abs(Ii/Ai),wt=ii<1/Ki?"":Ii<0?"left":"right",ii<Ki&&(wt!==""&&(wt+="-"),wt+=Ai<0?"up":"down"),wt)},o.applyBounds=function(rr,Ki){var pi,Ii,Ai,ii,wt,Ft;if(rr&&r.bounds!==rr)return r.bounds=rr,k.update(!0,Ki);if(Rr(!0),mr(),Mt&&!es()){if(pi=k.x,Ii=k.y,pi>mi?pi=mi:pi<Xi&&(pi=Xi),Ii>Er?Ii=Er:Ii<Ir&&(Ii=Ir),(k.x!==pi||k.y!==Ii)&&(Ai=!0,k.x=k.endX=pi,n?k.endRotation=pi:k.y=k.endY=Ii,ui=!0,Tr(!0),k.autoScroll&&!k.isDragging))for(_recordMaxScrolls(i.parentNode),ii=i,_windowProxy.scrollTop=_win$1.pageYOffset!=null?_win$1.pageYOffset:Ht.documentElement.scrollTop!=null?Ht.documentElement.scrollTop:Ht.body.scrollTop,_windowProxy.scrollLeft=_win$1.pageXOffset!=null?_win$1.pageXOffset:Ht.documentElement.scrollLeft!=null?Ht.documentElement.scrollLeft:Ht.body.scrollLeft;ii&&!Ft;)Ft=_isRoot(ii.parentNode),wt=Ft?_windowProxy:ii.parentNode,z&&wt.scrollTop>wt._gsMaxScrollY&&(wt.scrollTop=wt._gsMaxScrollY),I&&wt.scrollLeft>wt._gsMaxScrollX&&(wt.scrollLeft=wt._gsMaxScrollX),ii=wt;k.isThrowing&&(Ai||k.endX>mi||k.endX<Xi||k.endY>Er||k.endY<Ir)&&wn(r.inertia||r.throwProps,Ai)}return k},o.update=function(rr,Ki,pi){if(Ki&&k.isPressed){var Ii=getGlobalMatrix(i),Ai=fr.apply({x:k.x-Ct,y:k.y-Ut}),ii=getGlobalMatrix(i.parentNode,!0);ii.apply({x:Ii.e-Ai.x,y:Ii.f-Ai.y},Ai),k.x-=Ai.x-ii.e,k.y-=Ai.y-ii.f,Tr(!0),zs()}var wt=k.x,Ft=k.y;return Nn(!Ki),rr?k.applyBounds():(ui&&pi&&Tr(!0),Rr(!0)),Ki&&(Os(k.pointerX,k.pointerY),ui&&Tr(!0)),k.isPressed&&!Ki&&(I&&Math.abs(wt-k.x)>.01||z&&Math.abs(Ft-k.y)>.01&&!n)&&zs(),k.autoScroll&&(_recordMaxScrolls(i.parentNode,k.isDragging),ne=k.isDragging,Tr(!0),_removeScrollListener(i,Ks),_addScrollListener(i,Ks)),k},o.enable=function(rr){var Ki={lazy:!0},pi,Ii,Ai;if(r.cursor!==!1&&(Ki.cursor=r.cursor||_defaultCursor),gsap$1.utils.checkPrefix("touchCallout")&&(Ki.touchCallout="none"),rr!=="soft"){for(_setTouchActionForAllDescendants(Y,I===z?"none":r.allowNativeTouchScrolling&&i.scrollHeight===i.clientHeight==(i.scrollWidth===i.clientHeight)||r.allowEventDefault?"manipulation":I?"pan-y":"pan-x"),Ii=Y.length;--Ii>-1;)Ai=Y[Ii],_supportsPointer||_addListener$1(Ai,"mousedown",Dn),_addListener$1(Ai,"touchstart",Dn),_addListener$1(Ai,"click",xs,!0),gsap$1.set(Ai,Ki),Ai.getBBox&&Ai.ownerSVGElement&&I!==z&&gsap$1.set(Ai.ownerSVGElement,{touchAction:r.allowNativeTouchScrolling||r.allowEventDefault?"manipulation":I?"pan-y":"pan-x"}),r.allowContextMenu||_addListener$1(Ai,"contextmenu",lr);_setSelectable(Y,!1)}return _addScrollListener(i,Ks),It=!0,InertiaPlugin&&rr!=="soft"&&InertiaPlugin.track(Yt||i,d?"x,y":n?"rotation":"top,left"),i._gsDragID=pi=i._gsDragID||"d"+_lookupCount++,_lookup$1[pi]=k,Yt&&(Yt.enable(),Yt.element._gsDragID=pi),(r.bounds||n)&&zs(),r.bounds&&k.applyBounds(),k},o.disable=function(rr){for(var Ki=k.isDragging,pi=Y.length,Ii;--pi>-1;)_setStyle(Y[pi],"cursor",null);if(rr!=="soft"){for(_setTouchActionForAllDescendants(Y,null),pi=Y.length;--pi>-1;)Ii=Y[pi],_setStyle(Ii,"touchCallout",null),_removeListener$1(Ii,"mousedown",Dn),_removeListener$1(Ii,"touchstart",Dn),_removeListener$1(Ii,"click",xs,!0),_removeListener$1(Ii,"contextmenu",lr);_setSelectable(Y,!0),Nt&&(_removeListener$1(Nt,"touchcancel",Un),_removeListener$1(Nt,"touchend",Un),_removeListener$1(Nt,"touchmove",Sn)),_removeListener$1(Ht,"mouseup",Un),_removeListener$1(Ht,"mousemove",Sn)}return _removeScrollListener(i,Ks),It=!1,InertiaPlugin&&rr!=="soft"&&(InertiaPlugin.untrack(Yt||i,d?"x,y":n?"rotation":"top,left"),k.tween&&k.tween.kill()),Yt&&Yt.disable(),_removeFromRenderQueue(Tr),k.isDragging=k.isPressed=kt=!1,Ki&&_dispatchEvent(k,"dragend","onDragEnd"),k},o.enabled=function(rr,Ki){return arguments.length?rr?k.enable(Ki):k.disable(Ki):It},o.kill=function(){return k.isThrowing=!1,k.tween&&k.tween.kill(),k.disable(),gsap$1.set(Y,{clearProps:"userSelect"}),delete _lookup$1[i._gsDragID],k},o.revert=function(){this.kill(),this.styles&&this.styles.revert()},~l.indexOf("scroll")&&(Yt=o.scrollProxy=new ScrollProxy(i,_extend({onKill:function(){k.isPressed&&Un(null)}},r)),i.style.overflowY=z&&!_isTouchDevice?"auto":"hidden",i.style.overflowX=I&&!_isTouchDevice?"auto":"hidden",i=Yt.content),n?ie.rotation=1:(I&&(ie[S]=1),z&&(ie[C]=1)),Et.force3D="force3D"in r?r.force3D:!0,_context$2(_assertThisInitialized(o)),o.enable(),o}return t.register=function(r){gsap$1=r,_initCore$1()},t.create=function(r,o){return _coreInitted$1||_initCore$1(!0),_toArray(r).map(function(l){return new t(l,o)})},t.get=function(r){return _lookup$1[(_toArray(r)[0]||{})._gsDragID]},t.timeSinceDrag=function(){return(_getTime()-_lastDragTime)/1e3},t.hitTest=function(r,o,l){if(r===o)return!1;var d=_parseRect(r),n=_parseRect(o),S=d.top,C=d.left,I=d.right,z=d.bottom,$=d.width,k=d.height,Y=n.left>I||n.right<C||n.top>z||n.bottom<S,ie,ue,ne;return Y||!l?!Y:(ne=(l+"").indexOf("%")!==-1,l=parseFloat(l)||0,ie={left:Math.max(C,n.left),top:Math.max(S,n.top)},ie.width=Math.min(I,n.right)-ie.left,ie.height=Math.min(z,n.bottom)-ie.top,ie.width<0||ie.height<0?!1:ne?(l*=.01,ue=ie.width*ie.height,ue>=$*k*l||ue>=n.width*n.height*l):ie.width>l&&ie.height>l)},t}(EventDispatcher$1);_setDefaults(Draggable.prototype,{pointerX:0,pointerY:0,startX:0,startY:0,deltaX:0,deltaY:0,isDragging:!1,isPressed:!1});Draggable.zIndex=1e3;Draggable.version="3.13.0";_getGSAP$1()&&gsap$1.registerPlugin(Draggable);/*!
 * GSDevTools 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var gsap,_coreInitted,_doc,_docEl,_win,_recordedRoot,Animation,_rootTween,_rootInstance,_keyboardInstance,_globalTimeline,_independentRoot,_delayedCall,_context$1,_startupPhase=!0,_globalStartTime=0,_windowExists=function(){return typeof window<"u"},_getGSAP=function(){return gsap||_windowExists()&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_isString=function(t){return typeof t=="string"},_isFunction=function(t){return typeof t=="function"},_isObject=function(t){return typeof t=="object"},_isUndefined=function(t){return typeof t>"u"},_svgNS="http://www.w3.org/2000/svg",_domNS="http://www.w3.org/1999/xhtml",_idSeed=0,_lookup={},_supportsStorage=function(){try{return sessionStorage.setItem("gsTest","1"),sessionStorage.removeItem("gsTest"),!0}catch{return!1}}(),_parseAnimation=function(t){return t instanceof Animation?t:t?gsap.getById(t):null},_createElement=function(t,i,r){var o=_doc.createElementNS?_doc.createElementNS(t==="svg"?_svgNS:_domNS,t):_doc.createElement(t);return i&&(_isString(i)&&(i=_doc.querySelector(i)),i.appendChild(o)),t==="svg"&&(o.setAttribute("xmlns",_svgNS),o.setAttribute("xmlns:xlink",_domNS)),o},_clearSelection=function(){_doc.selection?_doc.selection.empty():_win.getSelection&&_win.getSelection().removeAllRanges()},_getChildrenOf=function e(t,i){for(var r=[],o=0,l=gsap.core.Tween,d=t._first;d;)d instanceof l?d.vars.id&&(r[o++]=d):(d.vars.id&&(r[o++]=d),r=r.concat(e(d)),o=r.length),d=d._next;return r},_getClippedDuration=function(t,i){var r=0,o=Math.max(0,t._repeat),l=t._first;for(l||(r=t.duration());l;)r=Math.max(r,l.totalDuration()>999?l.endTime(!1):l._start+l._tDur/l._ts),l=l._next;return o?r*(o+1)+t._rDelay*o:r},_globalizeTime=function(t,i){for(var r=t,o=arguments.length>1?+i:r.rawTime();r;)o=r._start+o/(r._ts||1),r=r.parent;return o},_timeToProgress=function(t,i,r,o){var l,d,n;return _isString(t)&&(t.charAt(1)==="="?(l=parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)),l<0&&o===0&&(o=100),t=o/100*i.duration()+l):isNaN(t)&&i.labels&&i.labels[t]!==-1?t=i.labels[t]:i===_recordedRoot&&(d=t.indexOf("="),d>0?(l=parseInt(t.charAt(d-1)+"1",10)*parseFloat(t.substr(d+1)),t=t.substr(0,d-1)):l=0,n=gsap.getById(t),n&&(t=_globalizeTime(n,r/100*n.duration())+l))),t=isNaN(t)?r:parseFloat(t),Math.min(100,Math.max(0,t/i.duration()*100))},_addedCSS,_createRootElement=function(t,i,r){_addedCSS||(_createElement("style",_docEl).innerHTML=".gs-dev-tools{height:51px;bottom:0;left:0;right:0;display:block;position:fixed;overflow:visible;padding:0;font-size:15px;font-family:-apple-system,BlinkMacSystemFont,avenir next,sans-serif;color:#bbbaa6}.gs-dev-tools *{box-sizing:content-box;visibility:visible}.gs-dev-tools .gs-top{position:relative;z-index:499}.gs-dev-tools .gs-bottom{display:flex;align-items:center;justify-content:space-between;gap:1rem;background-color:#0e100f;height:42px;position:relative}.gs-dev-tools .timeline{position:relative;height:8px;margin-left:15px;margin-right:15px;overflow:visible}.gs-dev-tools .progress-bar,.gs-dev-tools .timeline-track{height:8px;position:absolute;top:0;left:-15px;right:-15px}.gs-dev-tools .timeline-track{background-color:#222}.gs-dev-tools .progress-bar{background:linear-gradient(114.41deg,#0ae448 20.74%,#abff84 65.5%);height:8px;top:0;width:0;pointer-events:none}.gs-dev-tools .seek-bar{width:100%;position:absolute;height:24px;top:-12px;left:0;background-color:transparent}.gs-dev-tools .in-point,.gs-dev-tools .out-point{width:15px;height:26px;position:absolute;top:-18px}.gs-dev-tools .in-point-shape{fill:#0ae448;transform:translateX(1px)}.gs-dev-tools .out-point-shape{fill:#ff8709}.gs-dev-tools .in-point{transform:translateX(-100%)}.gs-dev-tools .out-point{left:100%}.gs-dev-tools .playhead{position:absolute;top:-5px;transform:translate(-50%,0);left:0;border-radius:50%;width:16px;height:16px;background:linear-gradient(114.41deg,#0ae448 20.74%,#abff84 65.5%)}.gs-dev-tools .gs-btn-white{fill:#fffce1}.gs-dev-tools .pause{opacity:0}.gs-dev-tools .select-animation{vertical-align:middle;position:relative;padding:6px 10px}.gs-dev-tools .select-animation-container{flex-grow:4;width:40%}.gs-dev-tools .select-arrow{display:inline-block;width:12px;height:7px;margin:0 7px;transform:translate(0,-2px)}.gs-dev-tools .select-arrow-shape{stroke:currentcolor;stroke-width:2px;fill:none}.gs-dev-tools .rewind{height:14px}.gs-dev-tools .ease-border,.gs-dev-tools .rewind-path{fill:currentColor}.gs-dev-tools .play-pause{width:18px;height:18px}.gs-dev-tools .ease{width:20px;height:20px;min-width:30px;display:none}.gs-dev-tools .ease-path{fill:none;stroke:#abff84;stroke-width:2px}.gs-dev-tools .time-scale{text-align:center;min-width:30px}.gs-dev-tools .loop{width:15px}.gs-dev-tools label span{text-decoration:none}.gs-dev-tools button:focus,.gs-dev-tools select:focus{outline:0}.gs-dev-tools label{position:relative;cursor:pointer}.gs-dev-tools label.locked{text-decoration:none;cursor:auto}.gs-dev-tools label input,.gs-dev-tools label select{position:absolute;left:0;top:0;z-index:1;font:inherit;font-size:inherit;line-height:inherit;height:100%;width:100%;color:#000!important;opacity:0;background:0 0;border:none;padding:0;margin:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer}.gs-dev-tools label input+.display{position:relative;z-index:2}.gs-dev-tools .gs-bottom-right{vertical-align:middle;display:flex;align-items:center;flex-grow:4;width:40%;justify-content:flex-end}.gs-dev-tools .time-container{margin:0 5px}.gs-dev-tools .logo{width:32px;height:32px;position:relative;top:2px;margin:0 12px}.gs-dev-tools .gs-hit-area{background-color:transparent;width:100%;height:100%;top:0;position:absolute}.gs-dev-tools.minimal{height:auto;display:flex;align-items:stretch}.gs-dev-tools.minimal .gs-top{order:2;flex-grow:4;background-color:#000}.gs-dev-tools.minimal .gs-bottom{background-color:#0e100f;border-top:none}.gs-dev-tools.minimal .timeline{top:50%;transform:translate(0,-50%)}.gs-dev-tools.minimal .gs-bottom-right,.gs-dev-tools.minimal .in-point,.gs-dev-tools.minimal .out-point,.gs-dev-tools.minimal .rewind,.gs-dev-tools.minimal .select-animation-container{display:none}.gs-dev-tools.minimal .play-pause{width:20px;height:20px;padding:4px 6px;margin-left:14px}.gs-dev-tools.minimal .time-scale{min-width:26px}.gs-dev-tools.minimal .loop{width:18px;min-width:18px;display:none}@media only screen and (max-width:600px){.gs-dev-tools{height:auto;display:flex;align-items:stretch}.gs-dev-tools .gs-top{order:2;flex-grow:4;background-color:#000;height:42px}.gs-dev-tools .gs-bottom{background-color:#000;border-top:none}.gs-dev-tools .timeline{top:50%;transform:translate(0,-50%)}.gs-dev-tools .gs-bottom-right,.gs-dev-tools .in-point,.gs-dev-tools .out-point,.gs-dev-tools .rewind,.gs-dev-tools .select-animation-container{display:none}.gs-dev-tools .play-pause{width:18px;height:18px;padding:4px 6px;margin-left:14px}.gs-dev-tools .time-scale{min-width:26px}.gs-dev-tools .loop{width:18px;min-width:18px;display:none}.gs-dev-tools .progress-bar,.gs-dev-tools .timeline-track{right:0}}",_addedCSS=!0),_isString(t)&&(t=_doc.querySelector(t));var o=_createElement("div",t||_docEl.getElementsByTagName("body")[0]||_docEl);return o.setAttribute("class","gs-dev-tools"+(i?" minimal":"")),o.innerHTML='<div class=gs-hit-area></div><div class=gs-top><div class=timeline><div class=timeline-track></div><div class=progress-bar></div><div class=seek-bar></div><svg class=in-point viewBox="0 0 15 26" xmlns=http://www.w3.org/2000/svg><path class=in-point-shape d="M0.5,2.283c0,-0.985 0.798,-1.783 1.783,-1.783c2.679,0 7.717,0 10.41,0c0.48,-0 0.939,0.19 1.278,0.529c0.339,0.339 0.529,0.798 0.529,1.277c-0,4.821 -0,17.897 0,21.968c0,0.253 -0.135,0.488 -0.354,0.615c-0.22,0.128 -0.49,0.128 -0.711,0.003c-2.653,-1.517 -9.526,-5.444 -12.016,-6.867c-0.568,-0.325 -0.919,-0.929 -0.919,-1.583c-0,-2.835 -0,-10.627 -0,-14.159Z" style="fill:#00ff52;fill-rule:nonzero;"/></svg><svg class=out-point viewBox="0 0 15 26" xmlns=http://www.w3.org/2000/svg><path class=out-point-shape d="M0.5,2.251c0,-0.465 0.184,-0.91 0.513,-1.238c0.328,-0.329 0.773,-0.513 1.238,-0.513c2.669,0 7.733,0 10.439,0c0.48,-0 0.94,0.191 1.28,0.53c0.339,0.34 0.53,0.8 0.53,1.28l0,14.17c-0,0.631 -0.338,1.213 -0.886,1.526c-2.44,1.395 -9.262,5.293 -11.977,6.845c-0.236,0.134 -0.524,0.133 -0.759,-0.003c-0.234,-0.136 -0.378,-0.386 -0.378,-0.657c0,-4.178 0,-17.198 0,-21.94Z" style="fill-rule:nonzero;"/></svg><div class=playhead></div></div></div><div class=gs-bottom><div class=select-animation-container><label class=select-animation><select class=animation-list><option>Global Timeline<option>myTimeline</select><nobr><span class="display animation-label">Global Timeline</span><svg class=select-arrow viewBox="0 0 12.05 6.73" xmlns=http://www.w3.org/2000/svg><polyline class=select-arrow-shape points="0.35 0.35 6.03 6.03 11.7 0.35"/></svg></nobr></label></div><svg class=rewind viewBox="0 0 12 15.38" xmlns=http://www.w3.org/2000/svg><path d=M0,.38H2v15H0Zm2,7,10,7.36V0Z class="gs-btn-white rewind-path"/></svg><svg class=play-pause viewBox="0 0 20.97 25.67" xmlns=http://www.w3.org/2000/svg><g class=play><path d="M8,4.88 C8,10.18 8,15.48 8,20.79 5.33,22.41 2.66,24.04 0,25.67 0,17.11 0,8.55 0,0 2.66,1.62 5.33,3.25 8,4.88" class="gs-btn-white play-1" style=stroke:#fffce1;stroke-width:.6px /><path d="M14.485,8.855 C16.64,10.18 18.8,11.5 20.97,12.83 16.64,15.48 12.32,18.13 8,20.79 8,15.48 8,10.18 8,4.88 10.16,6.2 12.32,7.53 14.48,8.85" class="gs-btn-white play-2" style=stroke:#fffce1;stroke-width:.6px /></g></svg> <svg class=loop viewBox="0 0 29 25.38" xmlns=http://www.w3.org/2000/svg fill="currentcolor"><path d=M27.44,5.44,20.19,0V3.06H9.06A9.31,9.31,0,0,0,0,12.41,9.74,9.74,0,0,0,.69,16l3.06-2.23a6,6,0,0,1-.12-1.22,5.49,5.49,0,0,1,5.43-5.5H20.19v3.81Z class=loop-path /><path d=M25.25,11.54a5.18,5.18,0,0,1,.12,1.12,5.41,5.41,0,0,1-5.43,5.41H9.19V14.5L1.94,19.94l7.25,5.44V22.06H19.94A9.2,9.2,0,0,0,29,12.84a9.42,9.42,0,0,0-.68-3.53Z class=loop-path /></svg> <svg class=ease viewBox="0 0 25.67 25.67" xmlns=http://www.w3.org/2000/svg><path d=M.48,25.12c1.74-3.57,4.28-12.6,8.8-10.7s4.75,1.43,6.5-1.11S19.89,1.19,25.2.55 class=ease-path /><path d=M24.67,1V24.67H1V1H24.67m1-1H0V25.67H25.67V0Z class=ease-border /></svg><label class=time-scale><select><option value=10>10x<option value=5>5x<option value=2>2x<option value=1 selected>1x<option value=0.5>0.5x<option value=0.25>0.25x<option value=0.1>0.1x</select><span class="display time-scale-label">1x</span></label><div class=gs-bottom-right><div class=time-container><span class=time>0.00</span> / <span class=duration>0.00</span></div><a href="https://gsap.com/docs/v3/Plugins/GSDevTools?source=GSDevTools" target=_blank title=Docs><svg class="logo" viewBox="0 0 1080 1080" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M793 518.654C793 518.654 793 518.829 793 518.934L770.197 618.386C768.967 624.012 763.38 628.135 756.915 628.135H729.404C727.366 628.135 725.539 629.498 724.977 631.455C699.573 718.082 665.175 777.628 619.745 813.376C581.095 843.813 533.451 858 469.819 858C412.618 858 374.074 839.514 341.362 803.032C298.145 754.809 280.261 675.869 291.083 580.75C310.618 402.184 402.745 222.01 580.217 222.01C634.185 221.521 676.559 238.26 706.039 271.667C737.204 306.995 753.05 360.216 753.121 429.86C753.015 436.185 747.78 441.287 741.491 441.287H611.488C606.885 441.287 602.774 437.129 602.844 432.551C601.79 384.397 587.56 360.915 559.311 360.915C509.488 360.915 480.079 428.917 464.479 466.622C442.694 519.283 431.627 576.452 433.805 633.412C434.824 659.935 439.075 697.22 464.127 712.666C486.333 726.364 518.026 717.279 537.21 702.113C556.394 686.947 571.819 660.703 578.319 636.766C579.233 633.447 579.303 630.861 578.425 629.708C577.511 628.52 574.981 628.24 573.049 628.24H539.67C536.086 628.24 532.537 626.598 530.394 623.942C528.602 621.705 527.899 618.945 528.532 616.219L551.37 516.592C552.494 511.49 557.097 507.647 562.754 506.948V506.703H781.827C782.354 506.703 782.881 506.703 783.373 506.808C789.065 507.542 793.07 512.853 792.965 518.654H793Z" fill="#0AE448"/></svg></a></div></div>',t&&(o.style.position="absolute",o.style.top=i?"calc(100% - 42px)":"calc(100% - 51px)"),r&&(_isString(r)?o.style.cssText=r:_isObject(r)&&(r.data="root",gsap.set(o,r).kill()),o.style.top&&(o.style.bottom="auto"),o.style.width&&gsap.set(o,{xPercent:-50,left:"50%",right:"auto",data:"root"}).kill()),!i&&o.offsetWidth<600&&(o.setAttribute("class","gs-dev-tools minimal"),t&&(o.style.top="calc(100% - 42px)")),o},_clickedOnce=!0,_addListener=function(t,i,r,o){var l,d;if((i==="mousedown"||i==="mouseup")&&(t.style.cursor="pointer"),i==="mousedown"&&(d=_isUndefined(t.onpointerdown)?_isUndefined(t.ontouchstart)?null:"touchstart":"pointerdown",d)){l=function(S){S.target.nodeName.toLowerCase()!=="select"&&S.type===d?(S.stopPropagation(),_clickedOnce&&(S.preventDefault(),r.call(t,S))):S.type!==d&&r.call(t,S),_clickedOnce=!0},t.addEventListener(d,l,o),d!=="pointerdown"&&t.addEventListener(i,l,o);return}t.addEventListener(i,r,o)},_removeListener=function(t,i,r){t.removeEventListener(i,r),i=i!=="mousedown"?null:_isUndefined(t.onpointerdown)?_isUndefined(t.ontouchstart)?null:"touchstart":"pointerdown",i&&t.removeEventListener(i,r)},_selectValue=function(t,i,r,o){var l=t.options,d=l.length,n;for(i+="";--d>-1;)if(l[d].innerHTML===i||l[d].value===i)return t.selectedIndex=d,r.innerHTML=l[d].innerHTML,l[d];o&&(n=_createElement("option",t),n.setAttribute("value",i),n.innerHTML=r.innerHTML=_isString(o)?o:i,t.selectedIndex=l.length-1)},_shiftSelectedValue=function(t,i,r){var o=t.options,l=Math.min(o.length-1,Math.max(0,t.selectedIndex+i));return t.selectedIndex=l,r&&(r.innerHTML=o[l].innerHTML),o[l].value},_merge=function(){var t=_globalTimeline._first,i,r,o;if(_rootInstance){for(i=_recordedRoot._dur;t;)r=t._next,o=t._targets&&t._targets[0],!(_isFunction(o)&&o===t.vars.onComplete&&!t._dur)&&!(o&&o._gsIgnore)&&_recordedRoot.add(t,t._start-t._delay),t=r;return i!==_recordedRoot.duration()}},_buildPlayPauseMorph=function(t){var i=gsap.timeline({data:"root",parent:_independentRoot,onComplete:function(){return i.kill()}},_independentRoot._time);return i.to(t.querySelector(".play-1"),{duration:.4,attr:{d:"M5.75,3.13 C5.75,9.79 5.75,16.46 5.75,23.13 4.08,23.13 2.41,23.13 0.75,23.13 0.75,16.46 0.75,9.79 0.75,3.12 2.41,3.12 4.08,3.12 5.75,3.12"},ease:"power2.inOut",rotation:360,transformOrigin:"50% 50%"}).to(t.querySelector(".play-2"),{duration:.4,attr:{d:"M16.38,3.13 C16.38,9.79 16.38,16.46 16.38,23.13 14.71,23.13 13.04,23.13 11.38,23.13 11.38,16.46 11.38,9.79 11.38,3.12 13.04,3.12 14.71,3.12 16.38,3.12"},ease:"power2.inOut",rotation:360,transformOrigin:"50% 50%"},.05),i},_buildLoopAnimation=function(t){var i=gsap.timeline({data:"root",id:"loop",parent:_independentRoot,paused:!0,onComplete:function(){return i.kill()}},_independentRoot._time);return i.to(t,{duration:.5,rotation:360,ease:"power3.inOut",transformOrigin:"50% 50%"}).to(t.querySelectorAll(".loop-path"),{duration:.5,fill:"#91e600",ease:"none"},0),i},_getAnimationById=function(t){return gsap.getById(t)||_independentRoot.getById(t)||t===_recordedRoot.vars.id&&_recordedRoot},_initCore=function(t){gsap=t||_getGSAP(),_coreInitted||gsap&&_windowExists()&&(_doc=document,_docEl=_doc.documentElement,_win=window,_context$1=gsap.core.context||function(){},gsap.registerPlugin(Draggable),_globalTimeline=gsap.globalTimeline,_globalTimeline._sort=!0,_globalTimeline.autoRemoveChildren=!1,Animation=gsap.core.Animation,_independentRoot=gsap.timeline({data:"indy",autoRemoveChildren:!0,smoothChildTiming:!0}),_independentRoot.kill(),_independentRoot._dp=0,_independentRoot.to({},{duration:1e12}),_recordedRoot=gsap.timeline({data:"root",id:"Global Timeline",autoRemoveChildren:!1,smoothChildTiming:!0,parent:_independentRoot},0),_rootTween=gsap.to(_recordedRoot,{duration:1,time:1,ease:"none",data:"root",id:"_rootTween",paused:!0,immediateRender:!1,parent:_independentRoot},0),_globalTimeline.killTweensOf=function(i,r,o){_recordedRoot.killTweensOf(i,r,o),_recordedRoot.killTweensOf.call(_globalTimeline,i,r,o)},_independentRoot._start=gsap.ticker.time,gsap.ticker.add(function(i){return _independentRoot.render(i-_independentRoot._start)}),_globalTimeline._start+=_globalTimeline._time,_recordedRoot._start=_globalTimeline._time=_globalTimeline._tTime=0,_delayedCall=function(r,o,l,d){return gsap.to(o,{delay:r,duration:0,onComplete:o,onReverseComplete:o,onCompleteParams:l,onReverseCompleteParams:l,callbackScope:d,parent:_independentRoot},_independentRoot._time)},_delayedCall(.01,function(){return _rootInstance?_rootInstance.update():_merge()}),_delayedCall(2,function(){var i,r,o;if(!_rootInstance)for(_merge(),i=_recordedRoot._first,o=_recordedRoot._start;i;)r=i._next,i._tDur!==i._tTime||!i._dur&&i.progress()!==1?_globalTimeline.add(i,i._start-i._delay+o):i.kill(),i=r;GSDevTools.globalRecordingTime>2?_delayedCall(GSDevTools.globalRecordingTime-2,function(){_rootInstance&&_rootInstance.update(),_globalTimeline.autoRemoveChildren=!0}):_globalTimeline.autoRemoveChildren=!0,_startupPhase=!1}),_coreInitted=1)},_checkIndependence=function(t,i){!i.globalSync&&t.parent!==_globalTimeline&&_globalTimeline.add(t,_globalTimeline.time())},GSDevTools=function e(t){_coreInitted||(_initCore(),gsap||console.warn("Please gsap.registerPlugin(GSDevTools)")),this.vars=t=t||{},t.animation&&(e.getByAnimation(t.animation)||{kill:function(){return 0}}).kill(),t.id=t.id||(_isString(t.animation)?t.animation:_idSeed++),_lookup[t.id+""]=this,"globalSync"in t||(t.globalSync=!t.animation);var i=this,r=_createRootElement(t.container,t.minimal,t.css),o=function(mr){return r.querySelector(mr)},l=function(mr,wr){return t.persist!==!1&&_supportsStorage&&sessionStorage.setItem("gs-dev-"+mr+t.id,wr),wr},d=function(mr){var wr;if(t.persist!==!1&&_supportsStorage)return wr=sessionStorage.getItem("gs-dev-"+mr+t.id),mr==="animation"?wr:mr==="loop"?wr==="true":parseFloat(wr)},n=o(".playhead"),S=o(".timeline-track"),C=o(".progress-bar"),I=o(".time"),z=o(".duration"),$,k,Y,ie,ue=0,ne=o(".in-point"),se=o(".out-point"),le=0,he=100,me,ge=o(".animation-list"),xt=o(".animation-label"),Et,Lt,Zt,Ht,It,Yt,ri,ei=o(".play-pause"),Ct=_buildPlayPauseMorph(ei),Ut=!1,Mt=o(".loop"),$t=_buildLoopAnimation(Mt),jt,mi=o(".time-scale select"),Xi=o(".time-scale-label"),Er=function(mr,wr,Vr){return function(wn){var Nn=S.getBoundingClientRect(),zs=mr.getBoundingClientRect(),es=zs.width*wr,As=gsap.getProperty(mr,"x"),Dn=Nn.left-zs.left-es+As,Sn=Nn.right-zs.right+(zs.width-es)+As,Os=Dn,Un;mr!==ne&&(Un=ne.getBoundingClientRect(),Un.left&&(Dn+=Un.left+Un.width-Nn.left)),mr!==se&&(Un=se.getBoundingClientRect(),Un.left&&(Sn-=Nn.left+Nn.width-Un.left)),me=Ut,this.applyBounds({minX:Dn,maxX:Sn}),$=Lt.duration()/Nn.width,k=-Os*$,ie?Lt.pause():Lt.pause(k+$*this.x),this.target===n&&(this.activated&&(this.allowEventDefault=!1),this.activated=!0),Y=!0}},Ir=Draggable.create(n,{type:"x",cursor:"ew-resize",allowNativeTouchScrolling:!1,allowEventDefault:!0,onPress:Er(n,.5),onDrag:function(){var mr=k+$*this.x;mr<0?mr=0:mr>Lt._dur&&(mr=Lt._dur),ie||Lt.time(mr),C.style.width=Math.min(he-le,Math.max(0,mr/Lt._dur*100-le))+"%",I.innerHTML=mr.toFixed(2)},onRelease:function(){Ut||Lt.resume()}})[0],nr=function(){le=0,he=100,ne.style.left="0%",se.style.left="100%",l("in",le),l("out",he),ui(!0)},si=Draggable.create(ne,{type:"x",cursor:"ew-resize",zIndexBoost:!1,allowNativeTouchScrolling:!1,allowEventDefault:!0,onPress:Er(ne,1),onDoubleClick:nr,onDrag:function(){le=(k+$*this.x)/Lt.duration()*100,Lt.progress(le/100),ui(!0)},onRelease:function(){le<0&&(le=0),_clearSelection(),ne.style.left=le+"%",l("in",le),gsap.set(ne,{x:0,data:"root",display:"block"}),Ut||Lt.resume()}})[0],Gt=Draggable.create(se,{type:"x",cursor:"ew-resize",allowNativeTouchScrolling:!1,allowEventDefault:!0,zIndexBoost:!1,onPress:Er(se,0),onDoubleClick:nr,onDrag:function(){he=(k+$*this.x)/Lt.duration()*100,Lt.progress(he/100),ui(!0)},onRelease:function(){he>100&&(he=100),_clearSelection(),se.style.left=he+"%",l("out",he),gsap.set(se,{x:0,data:"root",display:"block"}),me||(Si(),Lt.resume())}})[0],ui=function(mr){if(!(Ir.isPressed&&mr!==!0)){var wr=!jt&&Et._repeat===-1?Et.totalTime()/Et.duration()*100:Lt.progress()*100||0,Vr=Et._repeat&&Et._rDelay&&Et.totalTime()%(Et.duration()+Et._rDelay)>Et.duration(),wn;wr>100&&(wr=100),wr>=he?jt&&!Lt.paused()&&!Ir.isDragging?Vr||(wr=le,wn=Lt._targets&&Lt._targets[0],wn===Et&&wn.seek(Ht+(It-Ht)*le/100),Et._repeat>0&&!le&&he===100?Et.totalProgress()===1&&Lt.totalProgress(0,!0).resume():Lt.progress(wr/100,!0).resume()):((wr!==he||Et._repeat===-1)&&(wr=he,Lt.progress(wr/100)),!Ut&&(he<100||Et.totalProgress()===1||Et._repeat===-1)&&Li()):wr<le&&(wr=le,Lt.progress(wr/100,!0)),(wr!==ue||mr===!0)&&(C.style.left=le+"%",C.style.width=Math.max(0,wr-le)+"%",n.style.left=wr+"%",I.innerHTML=Lt._time.toFixed(2),z.innerHTML=Lt._dur.toFixed(2),Y&&(n.style.transform="translate(-50%,0)",n._gsap.x="0px",n._gsap.xPercent=-50,Y=!1),ue=wr),Lt.paused()!==Ut&&Mi()}},oi=function(mr){if(!Ir.isPressed){var wr=mr.target.getBoundingClientRect(),Vr=(mr.changedTouches?mr.changedTouches[0]:mr).clientX,wn=(Vr-wr.left)/wr.width*100;if(wn<le){le=wn=Math.max(0,wn),ne.style.left=le+"%",si.startDrag(mr);return}else if(wn>he){he=wn=Math.min(100,wn),se.style.left=he+"%",Gt.startDrag(mr);return}Lt.progress(wn/100).pause(),ui(!0),Ir.startDrag(mr)}},Si=function(){if(Lt.progress()>=he/100){_checkIndependence(Lt,t);var mr=Lt._targets&&Lt._targets[0];mr===Et&&mr.seek(Ht+(It-Ht)*le/100),Lt._repeat&&!le?Lt.totalProgress(0,!0):Lt.reversed()||Lt.progress(le/100,!0)}Ct.play(),Lt.resume(),Ut&&i.update(),Ut=!1},Li=function(){Ct.reverse(),Lt&&Lt.pause(),Ut=!0},Mi=function(){Ut?Si():Li()},kt=function(mr){if(!Ir.isPressed){_checkIndependence(Lt,t);var wr=Lt._targets&&Lt._targets[0];wr===Et&&wr.seek(Ht+(It-Ht)*le/100),Lt.progress(le/100,!0),Ut||Lt.resume()}},Nt=function(mr){if(jt=mr,l("loop",jt),jt){if($t.play(),Lt.progress()>=he/100){var wr=Lt._targets&&Lt._targets[0];wr===Et&&wr.seek(Ht+(It-Ht)*le/100),Et._repeat&&!le&&he===100?Lt.totalProgress(0,!0):Lt.progress(le/100,!0),Si()}}else $t.reverse()},gi=function(){return Nt(!jt)},Ri=function(){var mr=_getChildrenOf(Zt&&!t.globalSync?Zt:_recordedRoot),wr=ge.children,Vr=0,wn,Nn;for(Zt&&!t.globalSync?mr.unshift(Zt):t.hideGlobalTimeline||mr.unshift(_recordedRoot),Nn=0;Nn<mr.length;Nn++)wn=wr[Nn]||_createElement("option",ge),wn.animation=mr[Nn],Vr=Nn&&mr[Nn].vars.id===mr[Nn-1].vars.id?Vr+1:0,wn.setAttribute("value",wn.innerHTML=mr[Nn].vars.id+(Vr?" ["+Vr+"]":mr[Nn+1]&&mr[Nn+1].vars.id===mr[Nn].vars.id?" [0]":""));for(;Nn<wr.length;Nn++)ge.removeChild(wr[Nn])},Rt=function(mr){var wr=parseFloat(mi.options[mi.selectedIndex].value)||1,Vr,wn;if(!arguments.length)return Et;if(_isString(mr)&&(mr=_getAnimationById(mr)),mr instanceof Animation||console.warn("GSDevTools error: invalid animation."),mr.scrollTrigger&&console.warn("GSDevTools can't work with ScrollTrigger-based animations; either the scrollbar -OR- the GSDevTools scrubber can control the animation."),mr!==Et){if(Et&&(Et._inProgress=le,Et._outProgress=he),Et=mr,Lt&&(wr=Lt.timeScale(),Lt._targets&&Lt._targets[0]===Zt&&(Zt.resume(),Lt.kill())),le=Et._inProgress||0,he=Et._outProgress||100,ne.style.left=le+"%",se.style.left=he+"%",Yt&&(l("animation",Et.vars.id),l("in",le),l("out",he)),Ht=0,wn=t.maxDuration||Math.min(1e3,_getClippedDuration(Et)),Et===_recordedRoot||t.globalSync){if(_merge(),Lt=_rootTween,_rootInstance&&_rootInstance!==i&&console.warn("Error: GSDevTools can only have one instance that's globally synchronized."),_rootInstance=i,Et!==_recordedRoot)for(Vr=Et,It=Vr.totalDuration(),It>99999999&&(It=Vr.duration());Vr.parent;)Ht=Ht/Vr._ts+Vr._start,It=It/Vr._ts+Vr._start,Vr=Vr.parent;else It=_recordedRoot.duration();It-Ht>wn&&(It=Ht+wn),_recordedRoot.pause(Ht),_rootTween.vars.time=It,_rootTween.invalidate(),_rootTween.duration(It-Ht).timeScale(wr),Ut?_rootTween.progress(1,!0).pause(0,!0):_delayedCall(.01,function(){_rootTween.resume().progress(le/100),Ut&&Si()})}else{if(_rootInstance===i&&(_rootInstance=null),Ht=Math.min(le*Et.duration(),Et.time()),Et===Zt||!Zt)Lt=Et,!jt&&Lt._repeat&&Nt(!0);else{for(Vr=Et,It=Vr.totalDuration(),It>99999999&&(It=Vr.duration());Vr.parent.parent&&Vr!==Zt;)Ht=Ht/(Vr._ts||Vr._pauseTS)+Vr._start,It=It/(Vr._ts||Vr._pauseTS)+Vr._start,Vr=Vr.parent;It-Ht>wn&&(It=Ht+wn),Zt.pause(Ht),Lt=gsap.to(Zt,{duration:It-Ht,time:It,ease:"none",data:"root",parent:_independentRoot},_independentRoot._time)}Lt.timeScale(wr),_rootTween.pause(),_recordedRoot.resume(),Lt.seek(0)}z.innerHTML=Lt.duration().toFixed(2),_selectValue(ge,Et.vars.id,xt)}},Xt=function(){var mr,wr,Vr;Et===_recordedRoot&&(mr=_recordedRoot._time,_recordedRoot.progress(1,!0).time(mr,!0),mr=(_rootTween._dp._time-_rootTween._start)*_rootTween._ts,Vr=Math.min(1e3,_recordedRoot.duration()),Vr===1e3&&(Vr=Math.min(1e3,_getClippedDuration(_recordedRoot))),wr=_rootTween.duration()/Vr,wr!==1&&Vr&&(le*=wr,he<100&&(he*=wr),_rootTween.seek(0),_rootTween.vars.time=Vr,_rootTween.invalidate(),_rootTween.duration(Vr),_rootTween.time(mr),z.innerHTML=Vr.toFixed(2),ne.style.left=le+"%",se.style.left=he+"%",ui(!0)))},Hi=function(mr){Rt(ge.options[ge.selectedIndex].animation),mr.target&&mr.target.blur&&mr.target.blur(),Ut&&Si()},Ni=function(mr){var wr=parseFloat(mi.options[mi.selectedIndex].value)||1,Vr;Lt.timeScale(wr),l("timeScale",wr),Ut||(Lt.progress()>=he/100?(Vr=Lt._targets&&Lt._targets[0],Vr===Et&&Vr.seek(Ht+(It-Ht)*le/100),Lt.progress(le/100,!0).pause()):Lt.pause(),_delayedCall(.01,function(){return Lt.resume()})),Xi.innerHTML=wr+"x",mi.blur&&mi.blur()},xi=gsap.to([o(".gs-bottom"),o(".gs-top")],{duration:.3,autoAlpha:0,y:50,ease:"power2.in",data:"root",paused:!0,parent:_independentRoot},_independentRoot._time),$i=!1,fr=function(mr){!Draggable.hitTest(mr,r)&&!Ir.isDragging&&!si.isDragging&&!Gt.isDragging&&Rr.restart(!0)},ir=function(){$i||(xi.play(),Rr.pause(),$i=!0)},lr=function(){Rr.pause(),$i&&(xi.reverse(),$i=!1)},Tr=function(){$i?lr():ir()},Rr=_delayedCall(1.3,ir).pause(),Jr=function(mr){_startupPhase&&!_globalStartTime&&(_globalStartTime=_recordedRoot._start),Yt=!mr,Zt=_parseAnimation(t.animation),Zt&&!Zt.vars.id&&(Zt.vars.id="[no id]"),_merge(),Ri();var wr=_getAnimationById(d("animation"));wr&&(wr._inProgress=d("in")||0,wr._outProgress=d("out")||100),t.paused&&Li(),Et=null,Rt(Zt||wr||_recordedRoot);var Vr=t.timeScale||d("timeScale"),wn=wr===Et;Vr&&(_selectValue(mi,Vr,Xi,Vr+"x"),Lt.timeScale(Vr)),le=("inTime"in t?_timeToProgress(t.inTime,Et,0,0):wn?wr._inProgress:0)||0,le===100&&!t.animation&&wr&&(Rt(_recordedRoot),le=_timeToProgress(t.inTime,Et,0,0)||0),le&&(ne.style.left=le+"%",ne.style.display=se.style.display="block"),he=("outTime"in t?_timeToProgress(t.outTime,Et,100,le):wn?wr._outProgress:0)||100,he<le&&(he=100),he!==100&&(se.style.left=he+"%",ne.style.display=se.style.display="block"),jt="loop"in t?t.loop:d("loop"),jt&&Nt(!0),t.paused&&Lt.progress(le/100,!0).pause(),_startupPhase&&Et===_recordedRoot&&_globalStartTime&&t.globalSync&&!Ut&&Lt.time(-_globalStartTime,!0),ui(!0)};_addListener(ge,"change",Hi),_addListener(ge,"mousedown",Ri),_addListener(ei,"mousedown",Mi),_addListener(o(".seek-bar"),"mousedown",oi),_addListener(o(".rewind"),"mousedown",kt),_addListener(Mt,"mousedown",gi),_addListener(mi,"change",Ni),t.visibility==="auto"?(_addListener(r,"mouseout",fr),_addListener(r,"mouseover",lr)):t.visibility==="hidden"&&($i=!0,xi.progress(1)),t.keyboard!==!1&&(_keyboardInstance&&t.keyboard?console.warn("[GSDevTools warning] only one instance can be affected by keyboard shortcuts. There is already one active."):(_keyboardInstance=i,ri=function(mr){var wr=mr.keyCode?mr.keyCode:mr.which,Vr;wr===32?Mi():wr===38?(Vr=parseFloat(_shiftSelectedValue(mi,-1,Xi)),Lt.timeScale(Vr),l("timeScale",Vr)):wr===40?(Vr=parseFloat(_shiftSelectedValue(mi,1,Xi)),Lt.timeScale(Vr),l("timeScale",Vr)):wr===37?kt():wr===39?Lt.progress(he/100):wr===76?gi():wr===72?Tr():wr===73?(le=Lt.progress()*100,l("in",le),ne.style.left=le+"%",ui(!0)):wr===79&&(he=Lt.progress()*100,l("out",he),se.style.left=he+"%",ui(!0))},_addListener(_docEl,"keydown",ri))),gsap.set(n,{xPercent:-50,x:0,data:"root"}),gsap.set(ne,{xPercent:-100,x:0,data:"root"}),ne._gsIgnore=se._gsIgnore=n._gsIgnore=ei._gsIgnore=Mt._gsIgnore=!0,gsap.killTweensOf([ne,se,n]),Jr(_startupPhase),_startupPhase&&_delayedCall(1e-4,Jr,[!1],this),gsap.ticker.add(ui),this.update=function(_r){_rootInstance===i&&((!_rootTween.paused()||_r)&&_merge(),Xt())},this.kill=this.revert=function(){_removeListener(ge,"change",Hi),_removeListener(ge,"mousedown",Ri),_removeListener(ei,"mousedown",Mi),_removeListener(o(".seek-bar"),"mousedown",oi),_removeListener(o(".rewind"),"mousedown",kt),_removeListener(Mt,"mousedown",gi),_removeListener(mi,"change",Ni),Ir.disable(),si.disable(),Gt.disable(),gsap.ticker.remove(ui),_removeListener(r,"mouseout",fr),_removeListener(r,"mouseover",lr),r.parentNode.removeChild(r),_rootInstance===i&&(_rootInstance=null),_keyboardInstance===i&&(_keyboardInstance=null,_removeListener(_docEl,"keydown",ri)),delete _lookup[t.id+""]},this.minimal=function(_r){var mr=r.classList.contains("minimal"),wr;if(!arguments.length||mr===_r)return mr;_r?r.classList.add("minimal"):r.classList.remove("minimal"),t.container&&(r.style.top=_r?"calc(100% - 42px)":"calc(100% - 51px)"),Ir.isPressed&&(ie=!0,Ir.endDrag(Ir.pointerEvent),ie=!1,wr=Lt.progress()*100,C.style.width=Math.max(0,wr-le)+"%",n.style.left=wr+"%",n.style.transform="translate(-50%,0)",n._gsap.x="0px",n._gsap.xPercent=-50,Ir.startDrag(Ir.pointerEvent,!0))},this.animation=Rt,this.updateList=Ri,_context$1(this)};GSDevTools.version="3.13.0";GSDevTools.globalRecordingTime=2;GSDevTools.getById=function(e){return e?_lookup[e]:_rootInstance};GSDevTools.getByAnimation=function(e){_isString(e)&&(e=gsap.getById(e));for(var t in _lookup)if(_lookup[t].animation()===e)return _lookup[t]};GSDevTools.create=function(e){return new GSDevTools(e)};GSDevTools.register=_initCore;_getGSAP()&&gsap.registerPlugin(GSDevTools);gsapWithCSS.registerPlugin(ScrollTrigger,DrawSVGPlugin,SplitText,GSDevTools);ScrollTrigger.config({ignoreMobileResize:!0});const gsap_client_4O_KCpEZFi9No8UfLrmvzlvCUnQWraJAKw3RsIfcXlg=defineNuxtPlugin(e=>{e.provide("gsap",gsapWithCSS),e.provide("scrollTrigger",ScrollTrigger),e.provide("drawSVG",DrawSVGPlugin),e.provide("splitText",SplitText),e.provide("gsDevTools",GSDevTools)});var version="1.3.3";function clamp(e,t,i){return Math.max(e,Math.min(t,i))}function lerp(e,t,i){return(1-i)*e+i*t}function damp(e,t,i,r){return lerp(e,t,1-Math.exp(-i*r))}function modulo(e,t){return(e%t+t)%t}var Animate=class{constructor(){kn(this,"isRunning",!1);kn(this,"value",0);kn(this,"from",0);kn(this,"to",0);kn(this,"currentTime",0);kn(this,"lerp");kn(this,"duration");kn(this,"easing");kn(this,"onUpdate")}advance(e){var i;if(!this.isRunning)return;let t=!1;if(this.duration&&this.easing){this.currentTime+=e;const r=clamp(0,this.currentTime/this.duration,1);t=r>=1;const o=t?1:this.easing(r);this.value=this.from+(this.to-this.from)*o}else this.lerp?(this.value=damp(this.value,this.to,this.lerp*60,e),Math.round(this.value)===this.to&&(this.value=this.to,t=!0)):(this.value=this.to,t=!0);t&&this.stop(),(i=this.onUpdate)==null||i.call(this,this.value,t)}stop(){this.isRunning=!1}fromTo(e,t,{lerp:i,duration:r,easing:o,onStart:l,onUpdate:d}){this.from=this.value=e,this.to=t,this.lerp=i,this.duration=r,this.easing=o,this.currentTime=0,this.isRunning=!0,l==null||l(),this.onUpdate=d}};function debounce(e,t){let i;return function(...r){let o=this;clearTimeout(i),i=setTimeout(()=>{i=void 0,e.apply(o,r)},t)}}var Dimensions=class{constructor(e,t,{autoResize:i=!0,debounce:r=250}={}){kn(this,"width",0);kn(this,"height",0);kn(this,"scrollHeight",0);kn(this,"scrollWidth",0);kn(this,"debouncedResize");kn(this,"wrapperResizeObserver");kn(this,"contentResizeObserver");kn(this,"resize",()=>{this.onWrapperResize(),this.onContentResize()});kn(this,"onWrapperResize",()=>{this.wrapper instanceof Window?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.wrapper.clientWidth,this.height=this.wrapper.clientHeight)});kn(this,"onContentResize",()=>{this.wrapper instanceof Window?(this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth):(this.scrollHeight=this.wrapper.scrollHeight,this.scrollWidth=this.wrapper.scrollWidth)});this.wrapper=e,this.content=t,i&&(this.debouncedResize=debounce(this.resize,r),this.wrapper instanceof Window?window.addEventListener("resize",this.debouncedResize,!1):(this.wrapperResizeObserver=new ResizeObserver(this.debouncedResize),this.wrapperResizeObserver.observe(this.wrapper)),this.contentResizeObserver=new ResizeObserver(this.debouncedResize),this.contentResizeObserver.observe(this.content)),this.resize()}destroy(){var e,t;(e=this.wrapperResizeObserver)==null||e.disconnect(),(t=this.contentResizeObserver)==null||t.disconnect(),this.wrapper===window&&this.debouncedResize&&window.removeEventListener("resize",this.debouncedResize,!1)}get limit(){return{x:this.scrollWidth-this.width,y:this.scrollHeight-this.height}}},Emitter=class{constructor(){kn(this,"events",{})}emit(e,...t){var r;let i=this.events[e]||[];for(let o=0,l=i.length;o<l;o++)(r=i[o])==null||r.call(i,...t)}on(e,t){var i;return(i=this.events[e])!=null&&i.push(t)||(this.events[e]=[t]),()=>{var r;this.events[e]=(r=this.events[e])==null?void 0:r.filter(o=>t!==o)}}off(e,t){var i;this.events[e]=(i=this.events[e])==null?void 0:i.filter(r=>t!==r)}destroy(){this.events={}}},LINE_HEIGHT=100/6,listenerOptions={passive:!1},VirtualScroll=class{constructor(e,t={wheelMultiplier:1,touchMultiplier:1}){kn(this,"touchStart",{x:0,y:0});kn(this,"lastDelta",{x:0,y:0});kn(this,"window",{width:0,height:0});kn(this,"emitter",new Emitter);kn(this,"onTouchStart",e=>{const{clientX:t,clientY:i}=e.targetTouches?e.targetTouches[0]:e;this.touchStart.x=t,this.touchStart.y=i,this.lastDelta={x:0,y:0},this.emitter.emit("scroll",{deltaX:0,deltaY:0,event:e})});kn(this,"onTouchMove",e=>{const{clientX:t,clientY:i}=e.targetTouches?e.targetTouches[0]:e,r=-(t-this.touchStart.x)*this.options.touchMultiplier,o=-(i-this.touchStart.y)*this.options.touchMultiplier;this.touchStart.x=t,this.touchStart.y=i,this.lastDelta={x:r,y:o},this.emitter.emit("scroll",{deltaX:r,deltaY:o,event:e})});kn(this,"onTouchEnd",e=>{this.emitter.emit("scroll",{deltaX:this.lastDelta.x,deltaY:this.lastDelta.y,event:e})});kn(this,"onWheel",e=>{let{deltaX:t,deltaY:i,deltaMode:r}=e;const o=r===1?LINE_HEIGHT:r===2?this.window.width:1,l=r===1?LINE_HEIGHT:r===2?this.window.height:1;t*=o,i*=l,t*=this.options.wheelMultiplier,i*=this.options.wheelMultiplier,this.emitter.emit("scroll",{deltaX:t,deltaY:i,event:e})});kn(this,"onWindowResize",()=>{this.window={width:window.innerWidth,height:window.innerHeight}});this.element=e,this.options=t,window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize(),this.element.addEventListener("wheel",this.onWheel,listenerOptions),this.element.addEventListener("touchstart",this.onTouchStart,listenerOptions),this.element.addEventListener("touchmove",this.onTouchMove,listenerOptions),this.element.addEventListener("touchend",this.onTouchEnd,listenerOptions)}on(e,t){return this.emitter.on(e,t)}destroy(){this.emitter.destroy(),window.removeEventListener("resize",this.onWindowResize,!1),this.element.removeEventListener("wheel",this.onWheel,listenerOptions),this.element.removeEventListener("touchstart",this.onTouchStart,listenerOptions),this.element.removeEventListener("touchmove",this.onTouchMove,listenerOptions),this.element.removeEventListener("touchend",this.onTouchEnd,listenerOptions)}},defaultEasing=e=>Math.min(1,1.001-Math.pow(2,-10*e)),Lenis=class{constructor({wrapper:e=window,content:t=document.documentElement,eventsTarget:i=e,smoothWheel:r=!0,syncTouch:o=!1,syncTouchLerp:l=.075,touchInertiaMultiplier:d=35,duration:n,easing:S,lerp:C=.1,infinite:I=!1,orientation:z="vertical",gestureOrientation:$="vertical",touchMultiplier:k=1,wheelMultiplier:Y=1,autoResize:ie=!0,prevent:ue,virtualScroll:ne,overscroll:se=!0,autoRaf:le=!1,anchors:he=!1,autoToggle:me=!1,allowNestedScroll:ge=!1,__experimental__naiveDimensions:xt=!1}={}){kn(this,"_isScrolling",!1);kn(this,"_isStopped",!1);kn(this,"_isLocked",!1);kn(this,"_preventNextNativeScrollEvent",!1);kn(this,"_resetVelocityTimeout",null);kn(this,"__rafID",null);kn(this,"isTouching");kn(this,"time",0);kn(this,"userData",{});kn(this,"lastVelocity",0);kn(this,"velocity",0);kn(this,"direction",0);kn(this,"options");kn(this,"targetScroll");kn(this,"animatedScroll");kn(this,"animate",new Animate);kn(this,"emitter",new Emitter);kn(this,"dimensions");kn(this,"virtualScroll");kn(this,"onScrollEnd",e=>{e instanceof CustomEvent||(this.isScrolling==="smooth"||this.isScrolling===!1)&&e.stopPropagation()});kn(this,"dispatchScrollendEvent",()=>{this.options.wrapper.dispatchEvent(new CustomEvent("scrollend",{bubbles:this.options.wrapper===window,detail:{lenisScrollEnd:!0}}))});kn(this,"onTransitionEnd",e=>{if(e.propertyName.includes("overflow")){const t=this.isHorizontal?"overflow-x":"overflow-y",i=getComputedStyle(this.rootElement)[t];["hidden","clip"].includes(i)?this.stop():this.start()}});kn(this,"onClick",e=>{const i=e.composedPath().find(r=>{var o,l,d;return r instanceof HTMLAnchorElement&&(((o=r.getAttribute("href"))==null?void 0:o.startsWith("#"))||((l=r.getAttribute("href"))==null?void 0:l.startsWith("/#"))||((d=r.getAttribute("href"))==null?void 0:d.startsWith("./#")))});if(i){const r=i.getAttribute("href");if(r){const o=typeof this.options.anchors=="object"&&this.options.anchors?this.options.anchors:void 0;let l=`#${r.split("#")[1]}`;["#","/#","./#","#top","/#top","./#top"].includes(r)&&(l=0),this.scrollTo(l,o)}}});kn(this,"onPointerDown",e=>{e.button===1&&this.reset()});kn(this,"onVirtualScroll",e=>{if(typeof this.options.virtualScroll=="function"&&this.options.virtualScroll(e)===!1)return;const{deltaX:t,deltaY:i,event:r}=e;if(this.emitter.emit("virtual-scroll",{deltaX:t,deltaY:i,event:r}),r.ctrlKey||r.lenisStopPropagation)return;const o=r.type.includes("touch"),l=r.type.includes("wheel");this.isTouching=r.type==="touchstart"||r.type==="touchmove";const d=t===0&&i===0;if(this.options.syncTouch&&o&&r.type==="touchstart"&&d&&!this.isStopped&&!this.isLocked){this.reset();return}const S=this.options.gestureOrientation==="vertical"&&i===0||this.options.gestureOrientation==="horizontal"&&t===0;if(d||S)return;let C=r.composedPath();C=C.slice(0,C.indexOf(this.rootElement));const I=this.options.prevent;if(C.find(ue=>{var ne,se,le;return ue instanceof HTMLElement&&(typeof I=="function"&&(I==null?void 0:I(ue))||((ne=ue.hasAttribute)==null?void 0:ne.call(ue,"data-lenis-prevent"))||o&&((se=ue.hasAttribute)==null?void 0:se.call(ue,"data-lenis-prevent-touch"))||l&&((le=ue.hasAttribute)==null?void 0:le.call(ue,"data-lenis-prevent-wheel"))||this.options.allowNestedScroll&&this.checkNestedScroll(ue,{deltaX:t,deltaY:i}))}))return;if(this.isStopped||this.isLocked){r.preventDefault();return}if(!(this.options.syncTouch&&o||this.options.smoothWheel&&l)){this.isScrolling="native",this.animate.stop(),r.lenisStopPropagation=!0;return}let $=i;this.options.gestureOrientation==="both"?$=Math.abs(i)>Math.abs(t)?i:t:this.options.gestureOrientation==="horizontal"&&($=t),(!this.options.overscroll||this.options.infinite||this.options.wrapper!==window&&(this.animatedScroll>0&&this.animatedScroll<this.limit||this.animatedScroll===0&&i>0||this.animatedScroll===this.limit&&i<0))&&(r.lenisStopPropagation=!0),r.preventDefault();const k=o&&this.options.syncTouch,ie=o&&r.type==="touchend"&&Math.abs($)>5;ie&&($=this.velocity*this.options.touchInertiaMultiplier),this.scrollTo(this.targetScroll+$,{programmatic:!1,...k?{lerp:ie?this.options.syncTouchLerp:1}:{lerp:this.options.lerp,duration:this.options.duration,easing:this.options.easing}})});kn(this,"onNativeScroll",()=>{if(this._resetVelocityTimeout!==null&&(clearTimeout(this._resetVelocityTimeout),this._resetVelocityTimeout=null),this._preventNextNativeScrollEvent){this._preventNextNativeScrollEvent=!1;return}if(this.isScrolling===!1||this.isScrolling==="native"){const e=this.animatedScroll;this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity,this.velocity=this.animatedScroll-e,this.direction=Math.sign(this.animatedScroll-e),this.isStopped||(this.isScrolling="native"),this.emit(),this.velocity!==0&&(this._resetVelocityTimeout=setTimeout(()=>{this.lastVelocity=this.velocity,this.velocity=0,this.isScrolling=!1,this.emit()},400))}});kn(this,"raf",e=>{const t=e-(this.time||e);this.time=e,this.animate.advance(t*.001),this.options.autoRaf&&(this.__rafID=requestAnimationFrame(this.raf))});window.lenisVersion=version,(!e||e===document.documentElement)&&(e=window),typeof n=="number"&&typeof S!="function"?S=defaultEasing:typeof S=="function"&&typeof n!="number"&&(n=1),this.options={wrapper:e,content:t,eventsTarget:i,smoothWheel:r,syncTouch:o,syncTouchLerp:l,touchInertiaMultiplier:d,duration:n,easing:S,lerp:C,infinite:I,gestureOrientation:$,orientation:z,touchMultiplier:k,wheelMultiplier:Y,autoResize:ie,prevent:ue,virtualScroll:ne,overscroll:se,autoRaf:le,anchors:he,autoToggle:me,allowNestedScroll:ge,__experimental__naiveDimensions:xt},this.dimensions=new Dimensions(e,t,{autoResize:ie}),this.updateClassName(),this.targetScroll=this.animatedScroll=this.actualScroll,this.options.wrapper.addEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.addEventListener("scrollend",this.onScrollEnd,{capture:!0}),this.options.anchors&&this.options.wrapper===window&&this.options.wrapper.addEventListener("click",this.onClick,!1),this.options.wrapper.addEventListener("pointerdown",this.onPointerDown,!1),this.virtualScroll=new VirtualScroll(i,{touchMultiplier:k,wheelMultiplier:Y}),this.virtualScroll.on("scroll",this.onVirtualScroll),this.options.autoToggle&&this.rootElement.addEventListener("transitionend",this.onTransitionEnd,{passive:!0}),this.options.autoRaf&&(this.__rafID=requestAnimationFrame(this.raf))}destroy(){this.emitter.destroy(),this.options.wrapper.removeEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.removeEventListener("scrollend",this.onScrollEnd,{capture:!0}),this.options.wrapper.removeEventListener("pointerdown",this.onPointerDown,!1),this.options.anchors&&this.options.wrapper===window&&this.options.wrapper.removeEventListener("click",this.onClick,!1),this.virtualScroll.destroy(),this.dimensions.destroy(),this.cleanUpClassName(),this.__rafID&&cancelAnimationFrame(this.__rafID)}on(e,t){return this.emitter.on(e,t)}off(e,t){return this.emitter.off(e,t)}setScroll(e){this.isHorizontal?this.options.wrapper.scrollTo({left:e,behavior:"instant"}):this.options.wrapper.scrollTo({top:e,behavior:"instant"})}resize(){this.dimensions.resize(),this.animatedScroll=this.targetScroll=this.actualScroll,this.emit()}emit(){this.emitter.emit("scroll",this)}reset(){this.isLocked=!1,this.isScrolling=!1,this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity=0,this.animate.stop()}start(){this.isStopped&&(this.reset(),this.isStopped=!1,this.emit())}stop(){this.isStopped||(this.reset(),this.isStopped=!0,this.emit())}scrollTo(e,{offset:t=0,immediate:i=!1,lock:r=!1,duration:o=this.options.duration,easing:l=this.options.easing,lerp:d=this.options.lerp,onStart:n,onComplete:S,force:C=!1,programmatic:I=!0,userData:z}={}){if(!((this.isStopped||this.isLocked)&&!C)){if(typeof e=="string"&&["top","left","start"].includes(e))e=0;else if(typeof e=="string"&&["bottom","right","end"].includes(e))e=this.limit;else{let $;if(typeof e=="string"?$=document.querySelector(e):e instanceof HTMLElement&&(e!=null&&e.nodeType)&&($=e),$){if(this.options.wrapper!==window){const Y=this.rootElement.getBoundingClientRect();t-=this.isHorizontal?Y.left:Y.top}const k=$.getBoundingClientRect();e=(this.isHorizontal?k.left:k.top)+this.animatedScroll}}if(typeof e=="number"){if(e+=t,e=Math.round(e),this.options.infinite){if(I){this.targetScroll=this.animatedScroll=this.scroll;const $=e-this.animatedScroll;$>this.limit/2?e=e-this.limit:$<-this.limit/2&&(e=e+this.limit)}}else e=clamp(0,e,this.limit);if(e===this.targetScroll){n==null||n(this),S==null||S(this);return}if(this.userData=z??{},i){this.animatedScroll=this.targetScroll=e,this.setScroll(this.scroll),this.reset(),this.preventNextNativeScrollEvent(),this.emit(),S==null||S(this),this.userData={},requestAnimationFrame(()=>{this.dispatchScrollendEvent()});return}I||(this.targetScroll=e),typeof o=="number"&&typeof l!="function"?l=defaultEasing:typeof l=="function"&&typeof o!="number"&&(o=1),this.animate.fromTo(this.animatedScroll,e,{duration:o,easing:l,lerp:d,onStart:()=>{r&&(this.isLocked=!0),this.isScrolling="smooth",n==null||n(this)},onUpdate:($,k)=>{this.isScrolling="smooth",this.lastVelocity=this.velocity,this.velocity=$-this.animatedScroll,this.direction=Math.sign(this.velocity),this.animatedScroll=$,this.setScroll(this.scroll),I&&(this.targetScroll=$),k||this.emit(),k&&(this.reset(),this.emit(),S==null||S(this),this.userData={},requestAnimationFrame(()=>{this.dispatchScrollendEvent()}),this.preventNextNativeScrollEvent())}})}}}preventNextNativeScrollEvent(){this._preventNextNativeScrollEvent=!0,requestAnimationFrame(()=>{this._preventNextNativeScrollEvent=!1})}checkNestedScroll(e,{deltaX:t,deltaY:i}){const r=Date.now(),o=e._lenis??(e._lenis={});let l,d,n,S,C,I,z,$;const k=this.options.gestureOrientation;if(r-(o.time??0)>2e3){o.time=Date.now();const me=window.getComputedStyle(e);o.computedStyle=me;const ge=me.overflowX,xt=me.overflowY;if(l=["auto","overlay","scroll"].includes(ge),d=["auto","overlay","scroll"].includes(xt),o.hasOverflowX=l,o.hasOverflowY=d,!l&&!d||k==="vertical"&&!d||k==="horizontal"&&!l)return!1;C=e.scrollWidth,I=e.scrollHeight,z=e.clientWidth,$=e.clientHeight,n=C>z,S=I>$,o.isScrollableX=n,o.isScrollableY=S,o.scrollWidth=C,o.scrollHeight=I,o.clientWidth=z,o.clientHeight=$}else n=o.isScrollableX,S=o.isScrollableY,l=o.hasOverflowX,d=o.hasOverflowY,C=o.scrollWidth,I=o.scrollHeight,z=o.clientWidth,$=o.clientHeight;if(!l&&!d||!n&&!S||k==="vertical"&&(!d||!S)||k==="horizontal"&&(!l||!n))return!1;let Y;if(k==="horizontal")Y="x";else if(k==="vertical")Y="y";else{const me=t!==0,ge=i!==0;me&&l&&n&&(Y="x"),ge&&d&&S&&(Y="y")}if(!Y)return!1;let ie,ue,ne,se,le;if(Y==="x")ie=e.scrollLeft,ue=C-z,ne=t,se=l,le=n;else if(Y==="y")ie=e.scrollTop,ue=I-$,ne=i,se=d,le=S;else return!1;return(ne>0?ie<ue:ie>0)&&se&&le}get rootElement(){return this.options.wrapper===window?document.documentElement:this.options.wrapper}get limit(){return this.options.__experimental__naiveDimensions?this.isHorizontal?this.rootElement.scrollWidth-this.rootElement.clientWidth:this.rootElement.scrollHeight-this.rootElement.clientHeight:this.dimensions.limit[this.isHorizontal?"x":"y"]}get isHorizontal(){return this.options.orientation==="horizontal"}get actualScroll(){const e=this.options.wrapper;return this.isHorizontal?e.scrollX??e.scrollLeft:e.scrollY??e.scrollTop}get scroll(){return this.options.infinite?modulo(this.animatedScroll,this.limit):this.animatedScroll}get progress(){return this.limit===0?1:this.scroll/this.limit}get isScrolling(){return this._isScrolling}set isScrolling(e){this._isScrolling!==e&&(this._isScrolling=e,this.updateClassName())}get isStopped(){return this._isStopped}set isStopped(e){this._isStopped!==e&&(this._isStopped=e,this.updateClassName())}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked!==e&&(this._isLocked=e,this.updateClassName())}get isSmooth(){return this.isScrolling==="smooth"}get className(){let e="lenis";return this.options.autoToggle&&(e+=" lenis-autoToggle"),this.isStopped&&(e+=" lenis-stopped"),this.isLocked&&(e+=" lenis-locked"),this.isScrolling&&(e+=" lenis-scrolling"),this.isScrolling==="smooth"&&(e+=" lenis-smooth"),e}updateClassName(){this.cleanUpClassName(),this.rootElement.className=`${this.rootElement.className} ${this.className}`.trim()}cleanUpClassName(){this.rootElement.className=this.rootElement.className.replace(/lenis(-\w+)?/g,"").trim()}};const lenis_client_4LxE3teLPytGU5rsn7QUsqpmbs5IWA12TrrawL01aN0=defineNuxtPlugin(e=>{let t={};t=new Lenis({lerp:.05}),t.stop(),e.$gsap.ticker.add(i=>{t.raf(i*1e3)}),t.on("scroll",()=>{e.$scrollTrigger.update()}),e.provide("lenis",t)});function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lottie$2={exports:{}},lottie$1=lottie$2.exports,hasRequiredLottie;function requireLottie(){return hasRequiredLottie||(hasRequiredLottie=1,function(module,exports){typeof document<"u"&&typeof navigator<"u"&&function(e,t){module.exports=t()}(lottie$1,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(t){_useWebWorker=!!t},getWebWorker=function(){return _useWebWorker},setLocationHref=function(t){locationHref=t},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,t){var i,r=e.length,o;for(i=0;i<r;i+=1){o=e[i].prototype;for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(t.prototype[l]=o[l])}}function getDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)}function createProxyFunction(e){function t(){}return t.prototype=e,t}var audioControllerFactory=function(){function e(t){this.audios=[],this.audioFactory=t,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(i){this.audios.push(i)},pause:function(){var i,r=this.audios.length;for(i=0;i<r;i+=1)this.audios[i].pause()},resume:function(){var i,r=this.audios.length;for(i=0;i<r;i+=1)this.audios[i].resume()},setRate:function(i){var r,o=this.audios.length;for(r=0;r<o;r+=1)this.audios[r].setRate(i)},createAudio:function(i){return this.audioFactory?this.audioFactory(i):window.Howl?new window.Howl({src:[i]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(i){this.audioFactory=i},setVolume:function(i){this._volume=i,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var i,r=this.audios.length;for(i=0;i<r;i+=1)this.audios[i].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(i,r){var o=0,l=[],d;switch(i){case"int16":case"uint8c":d=1;break;default:d=1.1;break}for(o=0;o<r;o+=1)l.push(d);return l}function t(i,r){return i==="float32"?new Float32Array(r):i==="int16"?new Int16Array(r):i==="uint8c"?new Uint8ClampedArray(r):e(i,r)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?t:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],t,i=e.length;for(t=0;t<i;t+=1)BMMath[e[t]]=Math[e[t]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var t=_typeof$6(e);if(t==="object"&&e.length){var i=createSizedArray(e.length),r,o=e.length;for(r=0;r<o;r+=1)i[r]=Math.abs(e[r]);return i}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,t,i,r){this.type=e,this.currentTime=t,this.totalTime=i,this.direction=r<0?-1:1}function BMCompleteEvent(e,t){this.type=e,this.direction=t<0?-1:1}function BMCompleteLoopEvent(e,t,i,r){this.type=e,this.currentLoop=i,this.totalLoops=t,this.direction=r<0?-1:1}function BMSegmentStartEvent(e,t,i){this.type=e,this.firstFrame=t,this.totalFrames=i}function BMDestroyEvent(e,t){this.type=e,this.target=t}function BMRenderFrameErrorEvent(e,t){this.type="renderFrameError",this.nativeError=e,this.currentTime=t}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,t,i){var r,o,l,d,n,S,C,I;switch(d=Math.floor(e*6),n=e*6-d,S=i*(1-t),C=i*(1-n*t),I=i*(1-(1-n)*t),d%6){case 0:r=i,o=I,l=S;break;case 1:r=C,o=i,l=S;break;case 2:r=S,o=i,l=I;break;case 3:r=S,o=C,l=i;break;case 4:r=I,o=S,l=i;break;case 5:r=i,o=S,l=C;break}return[r,o,l]}function RGBtoHSV(e,t,i){var r=Math.max(e,t,i),o=Math.min(e,t,i),l=r-o,d,n=r===0?0:l/r,S=r/255;switch(r){case o:d=0;break;case e:d=t-i+l*(t<i?6:0),d/=6*l;break;case t:d=i-e+l*2,d/=6*l;break;case i:d=e-t+l*4,d/=6*l;break}return[d,n,S]}function addSaturationToRGB(e,t){var i=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return i[1]+=t,i[1]>1?i[1]=1:i[1]<=0&&(i[1]=0),HSVtoRGB(i[0],i[1],i[2])}function addBrightnessToRGB(e,t){var i=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return i[2]+=t,i[2]>1?i[2]=1:i[2]<0&&(i[2]=0),HSVtoRGB(i[0],i[1],i[2])}function addHueToRGB(e,t){var i=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return i[0]+=t/360,i[0]>1?i[0]-=1:i[0]<0&&(i[0]+=1),HSVtoRGB(i[0],i[1],i[2])}var rgbToHex=function(){var e=[],t,i;for(t=0;t<256;t+=1)i=t.toString(16),e[t]=i.length===1?"0"+i:i;return function(r,o,l){return r<0&&(r=0),o<0&&(o=0),l<0&&(l=0),"#"+e[r]+e[o]+e[l]}}(),setSubframeEnabled=function(t){subframeEnabled=!!t},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(t){expressionsPlugin=t},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(t){expressionsInterfaces=t},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(t){defaultCurveSegments=t},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(t){idPrefix$1=t};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$5(e)}var dataManager=function(){var e=1,t=[],i,r,o={onmessage:function(){},postMessage:function(k){i({data:k})}},l={postMessage:function(k){o.onmessage({data:k})}};function d($){if(window.Worker&&window.Blob&&getWebWorker()){var k=new Blob(["var _workerSelf = self; self.onmessage = ",$.toString()],{type:"text/javascript"}),Y=URL.createObjectURL(k);return new Worker(Y)}return i=$,o}function n(){r||(r=d(function(k){function Y(){function ue(ei,Ct){var Ut,Mt,$t=ei.length,jt,mi,Xi,Er;for(Mt=0;Mt<$t;Mt+=1)if(Ut=ei[Mt],"ks"in Ut&&!Ut.completed){if(Ut.completed=!0,Ut.hasMask){var Ir=Ut.masksProperties;for(mi=Ir.length,jt=0;jt<mi;jt+=1)if(Ir[jt].pt.k.i)me(Ir[jt].pt.k);else for(Er=Ir[jt].pt.k.length,Xi=0;Xi<Er;Xi+=1)Ir[jt].pt.k[Xi].s&&me(Ir[jt].pt.k[Xi].s[0]),Ir[jt].pt.k[Xi].e&&me(Ir[jt].pt.k[Xi].e[0])}Ut.ty===0?(Ut.layers=le(Ut.refId,Ct),ue(Ut.layers,Ct)):Ut.ty===4?he(Ut.shapes):Ut.ty===5&&Yt(Ut)}}function ne(ei,Ct){if(ei){var Ut=0,Mt=ei.length;for(Ut=0;Ut<Mt;Ut+=1)ei[Ut].t===1&&(ei[Ut].data.layers=le(ei[Ut].data.refId,Ct),ue(ei[Ut].data.layers,Ct))}}function se(ei,Ct){for(var Ut=0,Mt=Ct.length;Ut<Mt;){if(Ct[Ut].id===ei)return Ct[Ut];Ut+=1}return null}function le(ei,Ct){var Ut=se(ei,Ct);return Ut?Ut.layers.__used?JSON.parse(JSON.stringify(Ut.layers)):(Ut.layers.__used=!0,Ut.layers):null}function he(ei){var Ct,Ut=ei.length,Mt,$t;for(Ct=Ut-1;Ct>=0;Ct-=1)if(ei[Ct].ty==="sh")if(ei[Ct].ks.k.i)me(ei[Ct].ks.k);else for($t=ei[Ct].ks.k.length,Mt=0;Mt<$t;Mt+=1)ei[Ct].ks.k[Mt].s&&me(ei[Ct].ks.k[Mt].s[0]),ei[Ct].ks.k[Mt].e&&me(ei[Ct].ks.k[Mt].e[0]);else ei[Ct].ty==="gr"&&he(ei[Ct].it)}function me(ei){var Ct,Ut=ei.i.length;for(Ct=0;Ct<Ut;Ct+=1)ei.i[Ct][0]+=ei.v[Ct][0],ei.i[Ct][1]+=ei.v[Ct][1],ei.o[Ct][0]+=ei.v[Ct][0],ei.o[Ct][1]+=ei.v[Ct][1]}function ge(ei,Ct){var Ut=Ct?Ct.split("."):[100,100,100];return ei[0]>Ut[0]?!0:Ut[0]>ei[0]?!1:ei[1]>Ut[1]?!0:Ut[1]>ei[1]?!1:ei[2]>Ut[2]?!0:Ut[2]>ei[2]?!1:null}var xt=function(){var ei=[4,4,14];function Ct(Mt){var $t=Mt.t.d;Mt.t.d={k:[{s:$t,t:0}]}}function Ut(Mt){var $t,jt=Mt.length;for($t=0;$t<jt;$t+=1)Mt[$t].ty===5&&Ct(Mt[$t])}return function(Mt){if(ge(ei,Mt.v)&&(Ut(Mt.layers),Mt.assets)){var $t,jt=Mt.assets.length;for($t=0;$t<jt;$t+=1)Mt.assets[$t].layers&&Ut(Mt.assets[$t].layers)}}}(),Et=function(){var ei=[4,7,99];return function(Ct){if(Ct.chars&&!ge(ei,Ct.v)){var Ut,Mt=Ct.chars.length;for(Ut=0;Ut<Mt;Ut+=1){var $t=Ct.chars[Ut];$t.data&&$t.data.shapes&&(he($t.data.shapes),$t.data.ip=0,$t.data.op=99999,$t.data.st=0,$t.data.sr=1,$t.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Ct.chars[Ut].t||($t.data.shapes.push({ty:"no"}),$t.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Lt=function(){var ei=[5,7,15];function Ct(Mt){var $t=Mt.t.p;typeof $t.a=="number"&&($t.a={a:0,k:$t.a}),typeof $t.p=="number"&&($t.p={a:0,k:$t.p}),typeof $t.r=="number"&&($t.r={a:0,k:$t.r})}function Ut(Mt){var $t,jt=Mt.length;for($t=0;$t<jt;$t+=1)Mt[$t].ty===5&&Ct(Mt[$t])}return function(Mt){if(ge(ei,Mt.v)&&(Ut(Mt.layers),Mt.assets)){var $t,jt=Mt.assets.length;for($t=0;$t<jt;$t+=1)Mt.assets[$t].layers&&Ut(Mt.assets[$t].layers)}}}(),Zt=function(){var ei=[4,1,9];function Ct(Mt){var $t,jt=Mt.length,mi,Xi;for($t=0;$t<jt;$t+=1)if(Mt[$t].ty==="gr")Ct(Mt[$t].it);else if(Mt[$t].ty==="fl"||Mt[$t].ty==="st")if(Mt[$t].c.k&&Mt[$t].c.k[0].i)for(Xi=Mt[$t].c.k.length,mi=0;mi<Xi;mi+=1)Mt[$t].c.k[mi].s&&(Mt[$t].c.k[mi].s[0]/=255,Mt[$t].c.k[mi].s[1]/=255,Mt[$t].c.k[mi].s[2]/=255,Mt[$t].c.k[mi].s[3]/=255),Mt[$t].c.k[mi].e&&(Mt[$t].c.k[mi].e[0]/=255,Mt[$t].c.k[mi].e[1]/=255,Mt[$t].c.k[mi].e[2]/=255,Mt[$t].c.k[mi].e[3]/=255);else Mt[$t].c.k[0]/=255,Mt[$t].c.k[1]/=255,Mt[$t].c.k[2]/=255,Mt[$t].c.k[3]/=255}function Ut(Mt){var $t,jt=Mt.length;for($t=0;$t<jt;$t+=1)Mt[$t].ty===4&&Ct(Mt[$t].shapes)}return function(Mt){if(ge(ei,Mt.v)&&(Ut(Mt.layers),Mt.assets)){var $t,jt=Mt.assets.length;for($t=0;$t<jt;$t+=1)Mt.assets[$t].layers&&Ut(Mt.assets[$t].layers)}}}(),Ht=function(){var ei=[4,4,18];function Ct(Mt){var $t,jt=Mt.length,mi,Xi;for($t=jt-1;$t>=0;$t-=1)if(Mt[$t].ty==="sh")if(Mt[$t].ks.k.i)Mt[$t].ks.k.c=Mt[$t].closed;else for(Xi=Mt[$t].ks.k.length,mi=0;mi<Xi;mi+=1)Mt[$t].ks.k[mi].s&&(Mt[$t].ks.k[mi].s[0].c=Mt[$t].closed),Mt[$t].ks.k[mi].e&&(Mt[$t].ks.k[mi].e[0].c=Mt[$t].closed);else Mt[$t].ty==="gr"&&Ct(Mt[$t].it)}function Ut(Mt){var $t,jt,mi=Mt.length,Xi,Er,Ir,nr;for(jt=0;jt<mi;jt+=1){if($t=Mt[jt],$t.hasMask){var si=$t.masksProperties;for(Er=si.length,Xi=0;Xi<Er;Xi+=1)if(si[Xi].pt.k.i)si[Xi].pt.k.c=si[Xi].cl;else for(nr=si[Xi].pt.k.length,Ir=0;Ir<nr;Ir+=1)si[Xi].pt.k[Ir].s&&(si[Xi].pt.k[Ir].s[0].c=si[Xi].cl),si[Xi].pt.k[Ir].e&&(si[Xi].pt.k[Ir].e[0].c=si[Xi].cl)}$t.ty===4&&Ct($t.shapes)}}return function(Mt){if(ge(ei,Mt.v)&&(Ut(Mt.layers),Mt.assets)){var $t,jt=Mt.assets.length;for($t=0;$t<jt;$t+=1)Mt.assets[$t].layers&&Ut(Mt.assets[$t].layers)}}}();function It(ei){ei.__complete||(Zt(ei),xt(ei),Et(ei),Lt(ei),Ht(ei),ue(ei.layers,ei.assets),ne(ei.chars,ei.assets),ei.__complete=!0)}function Yt(ei){ei.t.a.length===0&&"m"in ei.t.p}var ri={};return ri.completeData=It,ri.checkColors=Zt,ri.checkChars=Et,ri.checkPathProperties=Lt,ri.checkShapes=Ht,ri.completeLayers=ue,ri}if(l.dataManager||(l.dataManager=Y()),l.assetLoader||(l.assetLoader=function(){function ue(se){var le=se.getResponseHeader("content-type");return le&&se.responseType==="json"&&le.indexOf("json")!==-1||se.response&&_typeof$5(se.response)==="object"?se.response:se.response&&typeof se.response=="string"?JSON.parse(se.response):se.responseText?JSON.parse(se.responseText):null}function ne(se,le,he,me){var ge,xt=new XMLHttpRequest;try{xt.responseType="json"}catch{}xt.onreadystatechange=function(){if(xt.readyState===4)if(xt.status===200)ge=ue(xt),he(ge);else try{ge=ue(xt),he(ge)}catch(Et){me&&me(Et)}};try{xt.open(["G","E","T"].join(""),se,!0)}catch{xt.open(["G","E","T"].join(""),le+"/"+se,!0)}xt.send()}return{load:ne}}()),k.data.type==="loadAnimation")l.assetLoader.load(k.data.path,k.data.fullPath,function(ue){l.dataManager.completeData(ue),l.postMessage({id:k.data.id,payload:ue,status:"success"})},function(){l.postMessage({id:k.data.id,status:"error"})});else if(k.data.type==="complete"){var ie=k.data.animation;l.dataManager.completeData(ie),l.postMessage({id:k.data.id,payload:ie,status:"success"})}else k.data.type==="loadData"&&l.assetLoader.load(k.data.path,k.data.fullPath,function(ue){l.postMessage({id:k.data.id,payload:ue,status:"success"})},function(){l.postMessage({id:k.data.id,status:"error"})})}),r.onmessage=function($){var k=$.data,Y=k.id,ie=t[Y];t[Y]=null,k.status==="success"?ie.onComplete(k.payload):ie.onError&&ie.onError()})}function S($,k){e+=1;var Y="processId_"+e;return t[Y]={onComplete:$,onError:k},Y}function C($,k,Y){n();var ie=S(k,Y);r.postMessage({type:"loadAnimation",path:$,fullPath:window.location.origin+window.location.pathname,id:ie})}function I($,k,Y){n();var ie=S(k,Y);r.postMessage({type:"loadData",path:$,fullPath:window.location.origin+window.location.pathname,id:ie})}function z($,k,Y){n();var ie=S(k,Y);r.postMessage({type:"complete",animation:$,id:ie})}return{loadAnimation:C,loadData:I,completeAnimation:z}}(),ImagePreloader=function(){var e=function(){var ne=createTag("canvas");ne.width=1,ne.height=1;var se=ne.getContext("2d");return se.fillStyle="rgba(0,0,0,0)",se.fillRect(0,0,1,1),ne}();function t(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function i(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function r(ne,se,le){var he="";if(ne.e)he=ne.p;else if(se){var me=ne.p;me.indexOf("images/")!==-1&&(me=me.split("/")[1]),he=se+me}else he=le,he+=ne.u?ne.u:"",he+=ne.p;return he}function o(ne){var se=0,le=setInterval((function(){var he=ne.getBBox();(he.width||se>500)&&(this._imageLoaded(),clearInterval(le)),se+=1}).bind(this),50)}function l(ne){var se=r(ne,this.assetsPath,this.path),le=createNS("image");isSafari?this.testImageLoaded(le):le.addEventListener("load",this._imageLoaded,!1),le.addEventListener("error",(function(){he.img=e,this._imageLoaded()}).bind(this),!1),le.setAttributeNS("http://www.w3.org/1999/xlink","href",se),this._elementHelper.append?this._elementHelper.append(le):this._elementHelper.appendChild(le);var he={img:le,assetData:ne};return he}function d(ne){var se=r(ne,this.assetsPath,this.path),le=createTag("img");le.crossOrigin="anonymous",le.addEventListener("load",this._imageLoaded,!1),le.addEventListener("error",(function(){he.img=e,this._imageLoaded()}).bind(this),!1),le.src=se;var he={img:le,assetData:ne};return he}function n(ne){var se={assetData:ne},le=r(ne,this.assetsPath,this.path);return dataManager.loadData(le,(function(he){se.img=he,this._footageLoaded()}).bind(this),(function(){se.img={},this._footageLoaded()}).bind(this)),se}function S(ne,se){this.imagesLoadedCb=se;var le,he=ne.length;for(le=0;le<he;le+=1)ne[le].layers||(!ne[le].t||ne[le].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(ne[le]))):ne[le].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(ne[le]))))}function C(ne){this.path=ne||""}function I(ne){this.assetsPath=ne||""}function z(ne){for(var se=0,le=this.images.length;se<le;){if(this.images[se].assetData===ne)return this.images[se].img;se+=1}return null}function $(){this.imagesLoadedCb=null,this.images.length=0}function k(){return this.totalImages===this.loadedAssets}function Y(){return this.totalFootages===this.loadedFootagesCount}function ie(ne,se){ne==="svg"?(this._elementHelper=se,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function ue(){this._imageLoaded=t.bind(this),this._footageLoaded=i.bind(this),this.testImageLoaded=o.bind(this),this.createFootageData=n.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return ue.prototype={loadAssets:S,setAssetsPath:I,setPath:C,loadedImages:k,loadedFootages:Y,destroy:$,getAsset:z,createImgData:d,createImageData:l,imageLoaded:t,footageLoaded:i,setCacheType:ie},ue}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(t,i){if(this._cbs[t])for(var r=this._cbs[t],o=0;o<r.length;o+=1)r[o](i)},addEventListener:function(t,i){return this._cbs[t]||(this._cbs[t]=[]),this._cbs[t].push(i),(function(){this.removeEventListener(t,i)}).bind(this)},removeEventListener:function(t,i){if(!i)this._cbs[t]=null;else if(this._cbs[t]){for(var r=0,o=this._cbs[t].length;r<o;)this._cbs[t][r]===i&&(this._cbs[t].splice(r,1),r-=1,o-=1),r+=1;this._cbs[t].length||(this._cbs[t]=null)}}};var markerParser=function(){function e(t){for(var i=t.split(`\r
`),r={},o,l=0,d=0;d<i.length;d+=1)o=i[d].split(":"),o.length===2&&(r[o[0]]=o[1].trim(),l+=1);if(l===0)throw new Error;return r}return function(t){for(var i=[],r=0;r<t.length;r+=1){var o=t[r],l={time:o.tm,duration:o.dr};try{l.payload=JSON.parse(t[r].cm)}catch{try{l.payload=e(t[r].cm)}catch{l.payload={name:t[r].cm}}}i.push(l)}return i}}(),ProjectInterface=function(){function e(t){this.compositions.push(t)}return function(){function t(i){for(var r=0,o=this.compositions.length;r<o;){if(this.compositions[r].data&&this.compositions[r].data.nm===i)return this.compositions[r].prepareFrame&&this.compositions[r].data.xt&&this.compositions[r].prepareFrame(this.currentFrame),this.compositions[r].compInterface;r+=1}return null}return t.compositions=[],t.currentFrame=0,t.registerComposition=e,t}}(),renderers={},registerRenderer=function(t,i){renderers[t]=i};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var t="svg";e.animType?t=e.animType:e.renderer&&(t=e.renderer);var i=getRenderer(t);this.renderer=new i(this,e.rendererSettings),this.imagePreloader.setCacheType(t,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=t,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,t){t&&_typeof$4(t)!=="object"&&(t=JSON.parse(t));var i={wrapper:e,animationData:t},r=e.attributes;i.path=r.getNamedItem("data-animation-path")?r.getNamedItem("data-animation-path").value:r.getNamedItem("data-bm-path")?r.getNamedItem("data-bm-path").value:r.getNamedItem("bm-path")?r.getNamedItem("bm-path").value:"",i.animType=r.getNamedItem("data-anim-type")?r.getNamedItem("data-anim-type").value:r.getNamedItem("data-bm-type")?r.getNamedItem("data-bm-type").value:r.getNamedItem("bm-type")?r.getNamedItem("bm-type").value:r.getNamedItem("data-bm-renderer")?r.getNamedItem("data-bm-renderer").value:r.getNamedItem("bm-renderer")?r.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var o=r.getNamedItem("data-anim-loop")?r.getNamedItem("data-anim-loop").value:r.getNamedItem("data-bm-loop")?r.getNamedItem("data-bm-loop").value:r.getNamedItem("bm-loop")?r.getNamedItem("bm-loop").value:"";o==="false"?i.loop=!1:o==="true"?i.loop=!0:o!==""&&(i.loop=parseInt(o,10));var l=r.getNamedItem("data-anim-autoplay")?r.getNamedItem("data-anim-autoplay").value:r.getNamedItem("data-bm-autoplay")?r.getNamedItem("data-bm-autoplay").value:r.getNamedItem("bm-autoplay")?r.getNamedItem("bm-autoplay").value:!0;i.autoplay=l!=="false",i.name=r.getNamedItem("data-name")?r.getNamedItem("data-name").value:r.getNamedItem("data-bm-name")?r.getNamedItem("data-bm-name").value:r.getNamedItem("bm-name")?r.getNamedItem("bm-name").value:"";var d=r.getNamedItem("data-anim-prerender")?r.getNamedItem("data-anim-prerender").value:r.getNamedItem("data-bm-prerender")?r.getNamedItem("data-bm-prerender").value:r.getNamedItem("bm-prerender")?r.getNamedItem("bm-prerender").value:"";d==="false"&&(i.prerender=!1),i.path?this.setParams(i):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var t=this.animationData.layers,i,r=t.length,o=e.layers,l,d=o.length;for(l=0;l<d;l+=1)for(i=0;i<r;){if(t[i].id===o[l].id){t[i]=o[l];break}i+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(r=e.assets.length,i=0;i<r;i+=1)this.animationData.assets.push(e.assets[i]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var t=e.shift();this.timeCompleted=t.time*this.frameRate;var i=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(i,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(t){this.triggerConfigError(t)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,t){var i=typeof e=="number"?e:void 0,r=typeof t=="number"?t:void 0;this.renderer.updateContainerSize(i,r)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var t,i=0;i<this.markers.length;i+=1)if(t=this.markers[i],t.payload&&t.payload.name===e)return t;return null},AnimationItem.prototype.goToAndStop=function(e,t,i){if(!(i&&this.name!==i)){var r=Number(e);if(isNaN(r)){var o=this.getMarkerData(e);o&&this.goToAndStop(o.time,!0)}else t?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,t,i){if(!(i&&this.name!==i)){var r=Number(e);if(isNaN(r)){var o=this.getMarkerData(e);o&&(o.duration?this.playSegments([o.time,o.time+o.duration],!0):this.goToAndStop(o.time,!0))}else this.goToAndStop(r,t,i);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var t=this.currentRawFrame+e*this.frameModifier,i=!1;t>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(t>this.totalFrames?t%this.totalFrames:0)||(i=!0,t=this.totalFrames-1):t>=this.totalFrames?(this.playCount+=1,this.checkSegments(t%this.totalFrames)||(this.setCurrentRawFrameValue(t%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(t):t<0?this.checkSegments(t%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+t%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(i=!0,t=0)):this.setCurrentRawFrameValue(t),i&&(this.setCurrentRawFrameValue(t),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,t){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-t)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+t)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,t){var i=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?i=e:this.currentRawFrame+this.firstFrame>t&&(i=t-e)),this.firstFrame=e,this.totalFrames=t-e,this.timeCompleted=this.totalFrames,i!==-1&&this.goToAndStop(i,!0)},AnimationItem.prototype.playSegments=function(e,t){if(t&&(this.segments.length=0),_typeof$4(e[0])==="object"){var i,r=e.length;for(i=0;i<r;i+=1)this.segments.push(e[i])}else this.segments.push(e);this.segments.length&&t&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,t){t&&this.name!==t||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var t="";if(e.e)t=e.p;else if(this.assetsPath){var i=e.p;i.indexOf("images/")!==-1&&(i=i.split("/")[1]),t=this.assetsPath+i}else t=this.path,t+=e.u?e.u:"",t+=e.p;return t},AnimationItem.prototype.getAssetData=function(e){for(var t=0,i=this.assets.length;t<i;){if(e===this.assets[t].id)return this.assets[t];t+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,t,i){try{var r=this.renderer.getElementByPath(e);r.updateDocumentData(t,i)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var t=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)},AnimationItem.prototype.triggerConfigError=function(e){var t=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)};var animationManager=function(){var e={},t=[],i=0,r=0,o=0,l=!0,d=!1;function n(Ct){for(var Ut=0,Mt=Ct.target;Ut<r;)t[Ut].animation===Mt&&(t.splice(Ut,1),Ut-=1,r-=1,Mt.isPaused||z()),Ut+=1}function S(Ct,Ut){if(!Ct)return null;for(var Mt=0;Mt<r;){if(t[Mt].elem===Ct&&t[Mt].elem!==null)return t[Mt].animation;Mt+=1}var $t=new AnimationItem;return $($t,Ct),$t.setData(Ct,Ut),$t}function C(){var Ct,Ut=t.length,Mt=[];for(Ct=0;Ct<Ut;Ct+=1)Mt.push(t[Ct].animation);return Mt}function I(){o+=1,Zt()}function z(){o-=1}function $(Ct,Ut){Ct.addEventListener("destroy",n),Ct.addEventListener("_active",I),Ct.addEventListener("_idle",z),t.push({elem:Ut,animation:Ct}),r+=1}function k(Ct){var Ut=new AnimationItem;return $(Ut,null),Ut.setParams(Ct),Ut}function Y(Ct,Ut){var Mt;for(Mt=0;Mt<r;Mt+=1)t[Mt].animation.setSpeed(Ct,Ut)}function ie(Ct,Ut){var Mt;for(Mt=0;Mt<r;Mt+=1)t[Mt].animation.setDirection(Ct,Ut)}function ue(Ct){var Ut;for(Ut=0;Ut<r;Ut+=1)t[Ut].animation.play(Ct)}function ne(Ct){var Ut=Ct-i,Mt;for(Mt=0;Mt<r;Mt+=1)t[Mt].animation.advanceTime(Ut);i=Ct,o&&!d?window.requestAnimationFrame(ne):l=!0}function se(Ct){i=Ct,window.requestAnimationFrame(ne)}function le(Ct){var Ut;for(Ut=0;Ut<r;Ut+=1)t[Ut].animation.pause(Ct)}function he(Ct,Ut,Mt){var $t;for($t=0;$t<r;$t+=1)t[$t].animation.goToAndStop(Ct,Ut,Mt)}function me(Ct){var Ut;for(Ut=0;Ut<r;Ut+=1)t[Ut].animation.stop(Ct)}function ge(Ct){var Ut;for(Ut=0;Ut<r;Ut+=1)t[Ut].animation.togglePause(Ct)}function xt(Ct){var Ut;for(Ut=r-1;Ut>=0;Ut-=1)t[Ut].animation.destroy(Ct)}function Et(Ct,Ut,Mt){var $t=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),jt,mi=$t.length;for(jt=0;jt<mi;jt+=1)Mt&&$t[jt].setAttribute("data-bm-type",Mt),S($t[jt],Ct);if(Ut&&mi===0){Mt||(Mt="svg");var Xi=document.getElementsByTagName("body")[0];Xi.innerText="";var Er=createTag("div");Er.style.width="100%",Er.style.height="100%",Er.setAttribute("data-bm-type",Mt),Xi.appendChild(Er),S(Er,Ct)}}function Lt(){var Ct;for(Ct=0;Ct<r;Ct+=1)t[Ct].animation.resize()}function Zt(){!d&&o&&l&&(window.requestAnimationFrame(se),l=!1)}function Ht(){d=!0}function It(){d=!1,Zt()}function Yt(Ct,Ut){var Mt;for(Mt=0;Mt<r;Mt+=1)t[Mt].animation.setVolume(Ct,Ut)}function ri(Ct){var Ut;for(Ut=0;Ut<r;Ut+=1)t[Ut].animation.mute(Ct)}function ei(Ct){var Ut;for(Ut=0;Ut<r;Ut+=1)t[Ut].animation.unmute(Ct)}return e.registerAnimation=S,e.loadAnimation=k,e.setSpeed=Y,e.setDirection=ie,e.play=ue,e.pause=le,e.stop=me,e.togglePause=ge,e.searchAnimations=Et,e.resize=Lt,e.goToAndStop=he,e.destroy=xt,e.freeze=Ht,e.unfreeze=It,e.setVolume=Yt,e.mute=ri,e.unmute=ei,e.getRegisteredAnimations=C,e}(),BezierFactory=function(){var e={};e.getBezierEasing=i;var t={};function i(se,le,he,me,ge){var xt=ge||("bez_"+se+"_"+le+"_"+he+"_"+me).replace(/\./g,"p");if(t[xt])return t[xt];var Et=new ne([se,le,he,me]);return t[xt]=Et,Et}var r=4,o=.001,l=1e-7,d=10,n=11,S=1/(n-1),C=typeof Float32Array=="function";function I(se,le){return 1-3*le+3*se}function z(se,le){return 3*le-6*se}function $(se){return 3*se}function k(se,le,he){return((I(le,he)*se+z(le,he))*se+$(le))*se}function Y(se,le,he){return 3*I(le,he)*se*se+2*z(le,he)*se+$(le)}function ie(se,le,he,me,ge){var xt,Et,Lt=0;do Et=le+(he-le)/2,xt=k(Et,me,ge)-se,xt>0?he=Et:le=Et;while(Math.abs(xt)>l&&++Lt<d);return Et}function ue(se,le,he,me){for(var ge=0;ge<r;++ge){var xt=Y(le,he,me);if(xt===0)return le;var Et=k(le,he,me)-se;le-=Et/xt}return le}function ne(se){this._p=se,this._mSampleValues=C?new Float32Array(n):new Array(n),this._precomputed=!1,this.get=this.get.bind(this)}return ne.prototype={get:function(le){var he=this._p[0],me=this._p[1],ge=this._p[2],xt=this._p[3];return this._precomputed||this._precompute(),he===me&&ge===xt?le:le===0?0:le===1?1:k(this._getTForX(le),me,xt)},_precompute:function(){var le=this._p[0],he=this._p[1],me=this._p[2],ge=this._p[3];this._precomputed=!0,(le!==he||me!==ge)&&this._calcSampleValues()},_calcSampleValues:function(){for(var le=this._p[0],he=this._p[2],me=0;me<n;++me)this._mSampleValues[me]=k(me*S,le,he)},_getTForX:function(le){for(var he=this._p[0],me=this._p[2],ge=this._mSampleValues,xt=0,Et=1,Lt=n-1;Et!==Lt&&ge[Et]<=le;++Et)xt+=S;--Et;var Zt=(le-ge[Et])/(ge[Et+1]-ge[Et]),Ht=xt+Zt*S,It=Y(Ht,he,me);return It>=o?ue(le,Ht,he,me):It===0?Ht:ie(le,xt,xt+S,he,me)}},e}(),pooling=function(){function e(t){return t.concat(createSizedArray(t.length))}return{double:e}}(),poolFactory=function(){return function(e,t,i){var r=0,o=e,l=createSizedArray(o),d={newElement:n,release:S};function n(){var C;return r?(r-=1,C=l[r]):C=t(),C}function S(C){r===o&&(l=pooling.double(l),o*=2),i&&i(C),l[r]=C,r+=1}return d}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function t(i){var r,o=i.lengths.length;for(r=0;r<o;r+=1)bezierLengthPool.release(i.lengths[r]);i.lengths.length=0}return poolFactory(8,e,t)}();function bezFunction(){var e=Math;function t($,k,Y,ie,ue,ne){var se=$*ie+k*ue+Y*ne-ue*ie-ne*$-Y*k;return se>-.001&&se<.001}function i($,k,Y,ie,ue,ne,se,le,he){if(Y===0&&ne===0&&he===0)return t($,k,ie,ue,se,le);var me=e.sqrt(e.pow(ie-$,2)+e.pow(ue-k,2)+e.pow(ne-Y,2)),ge=e.sqrt(e.pow(se-$,2)+e.pow(le-k,2)+e.pow(he-Y,2)),xt=e.sqrt(e.pow(se-ie,2)+e.pow(le-ue,2)+e.pow(he-ne,2)),Et;return me>ge?me>xt?Et=me-ge-xt:Et=xt-ge-me:xt>ge?Et=xt-ge-me:Et=ge-me-xt,Et>-1e-4&&Et<1e-4}var r=function(){return function($,k,Y,ie){var ue=getDefaultCurveSegments(),ne,se,le,he,me,ge=0,xt,Et=[],Lt=[],Zt=bezierLengthPool.newElement();for(le=Y.length,ne=0;ne<ue;ne+=1){for(me=ne/(ue-1),xt=0,se=0;se<le;se+=1)he=bmPow(1-me,3)*$[se]+3*bmPow(1-me,2)*me*Y[se]+3*(1-me)*bmPow(me,2)*ie[se]+bmPow(me,3)*k[se],Et[se]=he,Lt[se]!==null&&(xt+=bmPow(Et[se]-Lt[se],2)),Lt[se]=Et[se];xt&&(xt=bmSqrt(xt),ge+=xt),Zt.percents[ne]=me,Zt.lengths[ne]=ge}return Zt.addedLength=ge,Zt}}();function o($){var k=segmentsLengthPool.newElement(),Y=$.c,ie=$.v,ue=$.o,ne=$.i,se,le=$._length,he=k.lengths,me=0;for(se=0;se<le-1;se+=1)he[se]=r(ie[se],ie[se+1],ue[se],ne[se+1]),me+=he[se].addedLength;return Y&&le&&(he[se]=r(ie[se],ie[0],ue[se],ne[0]),me+=he[se].addedLength),k.totalLength=me,k}function l($){this.segmentLength=0,this.points=new Array($)}function d($,k){this.partialLength=$,this.point=k}var n=function(){var $={};return function(k,Y,ie,ue){var ne=(k[0]+"_"+k[1]+"_"+Y[0]+"_"+Y[1]+"_"+ie[0]+"_"+ie[1]+"_"+ue[0]+"_"+ue[1]).replace(/\./g,"p");if(!$[ne]){var se=getDefaultCurveSegments(),le,he,me,ge,xt,Et=0,Lt,Zt,Ht=null;k.length===2&&(k[0]!==Y[0]||k[1]!==Y[1])&&t(k[0],k[1],Y[0],Y[1],k[0]+ie[0],k[1]+ie[1])&&t(k[0],k[1],Y[0],Y[1],Y[0]+ue[0],Y[1]+ue[1])&&(se=2);var It=new l(se);for(me=ie.length,le=0;le<se;le+=1){for(Zt=createSizedArray(me),xt=le/(se-1),Lt=0,he=0;he<me;he+=1)ge=bmPow(1-xt,3)*k[he]+3*bmPow(1-xt,2)*xt*(k[he]+ie[he])+3*(1-xt)*bmPow(xt,2)*(Y[he]+ue[he])+bmPow(xt,3)*Y[he],Zt[he]=ge,Ht!==null&&(Lt+=bmPow(Zt[he]-Ht[he],2));Lt=bmSqrt(Lt),Et+=Lt,It.points[le]=new d(Lt,Zt),Ht=Zt}It.segmentLength=Et,$[ne]=It}return $[ne]}}();function S($,k){var Y=k.percents,ie=k.lengths,ue=Y.length,ne=bmFloor((ue-1)*$),se=$*k.addedLength,le=0;if(ne===ue-1||ne===0||se===ie[ne])return Y[ne];for(var he=ie[ne]>se?-1:1,me=!0;me;)if(ie[ne]<=se&&ie[ne+1]>se?(le=(se-ie[ne])/(ie[ne+1]-ie[ne]),me=!1):ne+=he,ne<0||ne>=ue-1){if(ne===ue-1)return Y[ne];me=!1}return Y[ne]+(Y[ne+1]-Y[ne])*le}function C($,k,Y,ie,ue,ne){var se=S(ue,ne),le=1-se,he=e.round((le*le*le*$[0]+(se*le*le+le*se*le+le*le*se)*Y[0]+(se*se*le+le*se*se+se*le*se)*ie[0]+se*se*se*k[0])*1e3)/1e3,me=e.round((le*le*le*$[1]+(se*le*le+le*se*le+le*le*se)*Y[1]+(se*se*le+le*se*se+se*le*se)*ie[1]+se*se*se*k[1])*1e3)/1e3;return[he,me]}var I=createTypedArray("float32",8);function z($,k,Y,ie,ue,ne,se){ue<0?ue=0:ue>1&&(ue=1);var le=S(ue,se);ne=ne>1?1:ne;var he=S(ne,se),me,ge=$.length,xt=1-le,Et=1-he,Lt=xt*xt*xt,Zt=le*xt*xt*3,Ht=le*le*xt*3,It=le*le*le,Yt=xt*xt*Et,ri=le*xt*Et+xt*le*Et+xt*xt*he,ei=le*le*Et+xt*le*he+le*xt*he,Ct=le*le*he,Ut=xt*Et*Et,Mt=le*Et*Et+xt*he*Et+xt*Et*he,$t=le*he*Et+xt*he*he+le*Et*he,jt=le*he*he,mi=Et*Et*Et,Xi=he*Et*Et+Et*he*Et+Et*Et*he,Er=he*he*Et+Et*he*he+he*Et*he,Ir=he*he*he;for(me=0;me<ge;me+=1)I[me*4]=e.round((Lt*$[me]+Zt*Y[me]+Ht*ie[me]+It*k[me])*1e3)/1e3,I[me*4+1]=e.round((Yt*$[me]+ri*Y[me]+ei*ie[me]+Ct*k[me])*1e3)/1e3,I[me*4+2]=e.round((Ut*$[me]+Mt*Y[me]+$t*ie[me]+jt*k[me])*1e3)/1e3,I[me*4+3]=e.round((mi*$[me]+Xi*Y[me]+Er*ie[me]+Ir*k[me])*1e3)/1e3;return I}return{getSegmentsLength:o,getNewSegment:z,getPointInSegment:C,buildBezierData:n,pointOnLine2D:t,pointOnLine3D:i}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,t){var i=this.offsetTime,r;this.propType==="multidimensional"&&(r=createTypedArray("float32",this.pv.length));for(var o=t.lastIndex,l=o,d=this.keyframes.length-1,n=!0,S,C,I;n;){if(S=this.keyframes[l],C=this.keyframes[l+1],l===d-1&&e>=C.t-i){S.h&&(S=C),o=0;break}if(C.t-i>e){o=l;break}l<d-1?l+=1:(o=0,n=!1)}I=this.keyframesMetadata[l]||{};var z,$,k,Y,ie,ue,ne=C.t-i,se=S.t-i,le;if(S.to){I.bezierData||(I.bezierData=bez.buildBezierData(S.s,C.s||S.e,S.to,S.ti));var he=I.bezierData;if(e>=ne||e<se){var me=e>=ne?he.points.length-1:0;for($=he.points[me].point.length,z=0;z<$;z+=1)r[z]=he.points[me].point[z]}else{I.__fnct?ue=I.__fnct:(ue=BezierFactory.getBezierEasing(S.o.x,S.o.y,S.i.x,S.i.y,S.n).get,I.__fnct=ue),k=ue((e-se)/(ne-se));var ge=he.segmentLength*k,xt,Et=t.lastFrame<e&&t._lastKeyframeIndex===l?t._lastAddedLength:0;for(ie=t.lastFrame<e&&t._lastKeyframeIndex===l?t._lastPoint:0,n=!0,Y=he.points.length;n;){if(Et+=he.points[ie].partialLength,ge===0||k===0||ie===he.points.length-1){for($=he.points[ie].point.length,z=0;z<$;z+=1)r[z]=he.points[ie].point[z];break}else if(ge>=Et&&ge<Et+he.points[ie+1].partialLength){for(xt=(ge-Et)/he.points[ie+1].partialLength,$=he.points[ie].point.length,z=0;z<$;z+=1)r[z]=he.points[ie].point[z]+(he.points[ie+1].point[z]-he.points[ie].point[z])*xt;break}ie<Y-1?ie+=1:n=!1}t._lastPoint=ie,t._lastAddedLength=Et-he.points[ie].partialLength,t._lastKeyframeIndex=l}}else{var Lt,Zt,Ht,It,Yt;if(d=S.s.length,le=C.s||S.e,this.sh&&S.h!==1)if(e>=ne)r[0]=le[0],r[1]=le[1],r[2]=le[2];else if(e<=se)r[0]=S.s[0],r[1]=S.s[1],r[2]=S.s[2];else{var ri=createQuaternion(S.s),ei=createQuaternion(le),Ct=(e-se)/(ne-se);quaternionToEuler(r,slerp(ri,ei,Ct))}else for(l=0;l<d;l+=1)S.h!==1&&(e>=ne?k=1:e<se?k=0:(S.o.x.constructor===Array?(I.__fnct||(I.__fnct=[]),I.__fnct[l]?ue=I.__fnct[l]:(Lt=S.o.x[l]===void 0?S.o.x[0]:S.o.x[l],Zt=S.o.y[l]===void 0?S.o.y[0]:S.o.y[l],Ht=S.i.x[l]===void 0?S.i.x[0]:S.i.x[l],It=S.i.y[l]===void 0?S.i.y[0]:S.i.y[l],ue=BezierFactory.getBezierEasing(Lt,Zt,Ht,It).get,I.__fnct[l]=ue)):I.__fnct?ue=I.__fnct:(Lt=S.o.x,Zt=S.o.y,Ht=S.i.x,It=S.i.y,ue=BezierFactory.getBezierEasing(Lt,Zt,Ht,It).get,S.keyframeMetadata=ue),k=ue((e-se)/(ne-se)))),le=C.s||S.e,Yt=S.h===1?S.s[l]:S.s[l]+(le[l]-S.s[l])*k,this.propType==="multidimensional"?r[l]=Yt:r=Yt}return t.lastIndex=o,r}function slerp(e,t,i){var r=[],o=e[0],l=e[1],d=e[2],n=e[3],S=t[0],C=t[1],I=t[2],z=t[3],$,k,Y,ie,ue;return k=o*S+l*C+d*I+n*z,k<0&&(k=-k,S=-S,C=-C,I=-I,z=-z),1-k>1e-6?($=Math.acos(k),Y=Math.sin($),ie=Math.sin((1-i)*$)/Y,ue=Math.sin(i*$)/Y):(ie=1-i,ue=i),r[0]=ie*o+ue*S,r[1]=ie*l+ue*C,r[2]=ie*d+ue*I,r[3]=ie*n+ue*z,r}function quaternionToEuler(e,t){var i=t[0],r=t[1],o=t[2],l=t[3],d=Math.atan2(2*r*l-2*i*o,1-2*r*r-2*o*o),n=Math.asin(2*i*r+2*o*l),S=Math.atan2(2*i*l-2*r*o,1-2*i*i-2*o*o);e[0]=d/degToRads,e[1]=n/degToRads,e[2]=S/degToRads}function createQuaternion(e){var t=e[0]*degToRads,i=e[1]*degToRads,r=e[2]*degToRads,o=Math.cos(t/2),l=Math.cos(i/2),d=Math.cos(r/2),n=Math.sin(t/2),S=Math.sin(i/2),C=Math.sin(r/2),I=o*l*d-n*S*C,z=n*S*d+o*l*C,$=n*l*d+o*S*C,k=o*S*d-n*l*C;return[z,$,k,I]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,t=this.keyframes[0].t-this.offsetTime,i=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=i&&e>=i||this._caching.lastFrame<t&&e<t))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var r=this.interpolateValue(e,this._caching);this.pv=r}return this._caching.lastFrame=e,this.pv}function setVValue(e){var t;if(this.propType==="unidimensional")t=e*this.mult,mathAbs(this.v-t)>1e-5&&(this.v=t,this._mdf=!0);else for(var i=0,r=this.v.length;i<r;)t=e[i]*this.mult,mathAbs(this.v[i]-t)>1e-5&&(this.v[i]=t,this._mdf=!0),i+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,t=this.effectsSequence.length,i=this.kf?this.pv:this.data.k;for(e=0;e<t;e+=1)i=this.effectsSequence[e](i);this.setVValue(i),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,t,i,r){this.propType="unidimensional",this.mult=i||1,this.data=t,this.v=i?t.k*i:t.k,this.pv=t.k,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,t,i,r){this.propType="multidimensional",this.mult=i||1,this.data=t,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var o,l=t.k.length;for(this.v=createTypedArray("float32",l),this.pv=createTypedArray("float32",l),this.vel=createTypedArray("float32",l),o=0;o<l;o+=1)this.v[o]=t.k[o]*this.mult,this.pv[o]=t.k[o];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,t,i,r){this.propType="unidimensional",this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=t,this.mult=i||1,this.elem=e,this.container=r,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,t,i,r){this.propType="multidimensional";var o,l=t.k.length,d,n,S,C;for(o=0;o<l-1;o+=1)t.k[o].to&&t.k[o].s&&t.k[o+1]&&t.k[o+1].s&&(d=t.k[o].s,n=t.k[o+1].s,S=t.k[o].to,C=t.k[o].ti,(d.length===2&&!(d[0]===n[0]&&d[1]===n[1])&&bez.pointOnLine2D(d[0],d[1],n[0],n[1],d[0]+S[0],d[1]+S[1])&&bez.pointOnLine2D(d[0],d[1],n[0],n[1],n[0]+C[0],n[1]+C[1])||d.length===3&&!(d[0]===n[0]&&d[1]===n[1]&&d[2]===n[2])&&bez.pointOnLine3D(d[0],d[1],d[2],n[0],n[1],n[2],d[0]+S[0],d[1]+S[1],d[2]+S[2])&&bez.pointOnLine3D(d[0],d[1],d[2],n[0],n[1],n[2],n[0]+C[0],n[1]+C[1],n[2]+C[2]))&&(t.k[o].to=null,t.k[o].ti=null),d[0]===n[0]&&d[1]===n[1]&&S[0]===0&&S[1]===0&&C[0]===0&&C[1]===0&&(d.length===2||d[2]===n[2]&&S[2]===0&&C[2]===0)&&(t.k[o].to=null,t.k[o].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=t,this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=i||1,this.elem=e,this.container=r,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var I=t.k[0].s.length;for(this.v=createTypedArray("float32",I),this.pv=createTypedArray("float32",I),o=0;o<I;o+=1)this.v[o]=initFrame,this.pv[o]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",I)},this.addEffect=addEffect}var PropertyFactory=function(){function e(i,r,o,l,d){r.sid&&(r=i.globalData.slotManager.getProp(r));var n;if(!r.k.length)n=new ValueProperty(i,r,l,d);else if(typeof r.k[0]=="number")n=new MultiDimensionalProperty(i,r,l,d);else switch(o){case 0:n=new KeyframedValueProperty(i,r,l,d);break;case 1:n=new KeyframedMultidimensionalProperty(i,r,l,d);break}return n.effectsSequence.length&&d.addDynamicProperty(n),n}var t={getProp:e};return t}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(t){this.dynamicProperties.indexOf(t)===-1&&(this.dynamicProperties.push(t),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var t,i=this.dynamicProperties.length;for(t=0;t<i;t+=1)this.dynamicProperties[t].getValue(),this.dynamicProperties[t]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(t){this.container=t,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,t){this.c=e,this.setLength(t);for(var i=0;i<t;)this.v[i]=pointPool.newElement(),this.o[i]=pointPool.newElement(),this.i[i]=pointPool.newElement(),i+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,t,i,r,o){var l;switch(this._length=Math.max(this._length,r+1),this._length>=this._maxLength&&this.doubleArrayLength(),i){case"v":l=this.v;break;case"i":l=this.i;break;case"o":l=this.o;break;default:l=[];break}(!l[r]||l[r]&&!o)&&(l[r]=pointPool.newElement()),l[r][0]=e,l[r][1]=t},ShapePath.prototype.setTripleAt=function(e,t,i,r,o,l,d,n){this.setXYAt(e,t,"v",d,n),this.setXYAt(i,r,"o",d,n),this.setXYAt(o,l,"i",d,n)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var t=this.v,i=this.o,r=this.i,o=0;this.c&&(e.setTripleAt(t[0][0],t[0][1],r[0][0],r[0][1],i[0][0],i[0][1],0,!1),o=1);var l=this._length-1,d=this._length,n;for(n=o;n<d;n+=1)e.setTripleAt(t[l][0],t[l][1],r[l][0],r[l][1],i[l][0],i[l][1],n,!1),l-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function t(o){var l=o._length,d;for(d=0;d<l;d+=1)pointPool.release(o.v[d]),pointPool.release(o.i[d]),pointPool.release(o.o[d]),o.v[d]=null,o.i[d]=null,o.o[d]=null;o._length=0,o.c=!1}function i(o){var l=r.newElement(),d,n=o._length===void 0?o.v.length:o._length;for(l.setLength(n),l.c=o.c,d=0;d<n;d+=1)l.setTripleAt(o.v[d][0],o.v[d][1],o.o[d][0],o.o[d][1],o.i[d][0],o.i[d][1],d);return l}var r=poolFactory(4,e,t);return r.clone=i,r}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:o,release:l},t=0,i=4,r=createSizedArray(i);function o(){var d;return t?(t-=1,d=r[t]):d=new ShapeCollection,d}function l(d){var n,S=d._length;for(n=0;n<S;n+=1)shapePool.release(d.shapes[n]);d._length=0,t===i&&(r=pooling.double(r),i*=2),r[t]=d,t+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function t(ne,se,le){var he=le.lastIndex,me,ge,xt,Et,Lt,Zt,Ht,It,Yt,ri=this.keyframes;if(ne<ri[0].t-this.offsetTime)me=ri[0].s[0],xt=!0,he=0;else if(ne>=ri[ri.length-1].t-this.offsetTime)me=ri[ri.length-1].s?ri[ri.length-1].s[0]:ri[ri.length-2].e[0],xt=!0;else{for(var ei=he,Ct=ri.length-1,Ut=!0,Mt,$t,jt;Ut&&(Mt=ri[ei],$t=ri[ei+1],!($t.t-this.offsetTime>ne));)ei<Ct-1?ei+=1:Ut=!1;if(jt=this.keyframesMetadata[ei]||{},xt=Mt.h===1,he=ei,!xt){if(ne>=$t.t-this.offsetTime)It=1;else if(ne<Mt.t-this.offsetTime)It=0;else{var mi;jt.__fnct?mi=jt.__fnct:(mi=BezierFactory.getBezierEasing(Mt.o.x,Mt.o.y,Mt.i.x,Mt.i.y).get,jt.__fnct=mi),It=mi((ne-(Mt.t-this.offsetTime))/($t.t-this.offsetTime-(Mt.t-this.offsetTime)))}ge=$t.s?$t.s[0]:Mt.e[0]}me=Mt.s[0]}for(Zt=se._length,Ht=me.i[0].length,le.lastIndex=he,Et=0;Et<Zt;Et+=1)for(Lt=0;Lt<Ht;Lt+=1)Yt=xt?me.i[Et][Lt]:me.i[Et][Lt]+(ge.i[Et][Lt]-me.i[Et][Lt])*It,se.i[Et][Lt]=Yt,Yt=xt?me.o[Et][Lt]:me.o[Et][Lt]+(ge.o[Et][Lt]-me.o[Et][Lt])*It,se.o[Et][Lt]=Yt,Yt=xt?me.v[Et][Lt]:me.v[Et][Lt]+(ge.v[Et][Lt]-me.v[Et][Lt])*It,se.v[Et][Lt]=Yt}function i(){var ne=this.comp.renderedFrame-this.offsetTime,se=this.keyframes[0].t-this.offsetTime,le=this.keyframes[this.keyframes.length-1].t-this.offsetTime,he=this._caching.lastFrame;return he!==e&&(he<se&&ne<se||he>le&&ne>le)||(this._caching.lastIndex=he<ne?this._caching.lastIndex:0,this.interpolateShape(ne,this.pv,this._caching)),this._caching.lastFrame=ne,this.pv}function r(){this.paths=this.localShapeCollection}function o(ne,se){if(ne._length!==se._length||ne.c!==se.c)return!1;var le,he=ne._length;for(le=0;le<he;le+=1)if(ne.v[le][0]!==se.v[le][0]||ne.v[le][1]!==se.v[le][1]||ne.o[le][0]!==se.o[le][0]||ne.o[le][1]!==se.o[le][1]||ne.i[le][0]!==se.i[le][0]||ne.i[le][1]!==se.i[le][1])return!1;return!0}function l(ne){o(this.v,ne)||(this.v=shapePool.clone(ne),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function d(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var ne;this.kf?ne=this.pv:this.data.ks?ne=this.data.ks.k:ne=this.data.pt.k;var se,le=this.effectsSequence.length;for(se=0;se<le;se+=1)ne=this.effectsSequence[se](ne);this.setVValue(ne),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function n(ne,se,le){this.propType="shape",this.comp=ne.comp,this.container=ne,this.elem=ne,this.data=se,this.k=!1,this.kf=!1,this._mdf=!1;var he=le===3?se.pt.k:se.ks.k;this.v=shapePool.clone(he),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=r,this.effectsSequence=[]}function S(ne){this.effectsSequence.push(ne),this.container.addDynamicProperty(this)}n.prototype.interpolateShape=t,n.prototype.getValue=d,n.prototype.setVValue=l,n.prototype.addEffect=S;function C(ne,se,le){this.propType="shape",this.comp=ne.comp,this.elem=ne,this.container=ne,this.offsetTime=ne.data.st,this.keyframes=le===3?se.pt.k:se.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var he=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,he),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=r,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[i.bind(this)]}C.prototype.getValue=d,C.prototype.interpolateShape=t,C.prototype.setVValue=l,C.prototype.addEffect=S;var I=function(){var ne=roundCorner;function se(le,he){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=he.d,this.elem=le,this.comp=le.comp,this.frameId=-1,this.initDynamicPropertyContainer(le),this.p=PropertyFactory.getProp(le,he.p,1,0,this),this.s=PropertyFactory.getProp(le,he.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return se.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var he=this.p.v[0],me=this.p.v[1],ge=this.s.v[0]/2,xt=this.s.v[1]/2,Et=this.d!==3,Lt=this.v;Lt.v[0][0]=he,Lt.v[0][1]=me-xt,Lt.v[1][0]=Et?he+ge:he-ge,Lt.v[1][1]=me,Lt.v[2][0]=he,Lt.v[2][1]=me+xt,Lt.v[3][0]=Et?he-ge:he+ge,Lt.v[3][1]=me,Lt.i[0][0]=Et?he-ge*ne:he+ge*ne,Lt.i[0][1]=me-xt,Lt.i[1][0]=Et?he+ge:he-ge,Lt.i[1][1]=me-xt*ne,Lt.i[2][0]=Et?he+ge*ne:he-ge*ne,Lt.i[2][1]=me+xt,Lt.i[3][0]=Et?he-ge:he+ge,Lt.i[3][1]=me+xt*ne,Lt.o[0][0]=Et?he+ge*ne:he-ge*ne,Lt.o[0][1]=me-xt,Lt.o[1][0]=Et?he+ge:he-ge,Lt.o[1][1]=me+xt*ne,Lt.o[2][0]=Et?he-ge*ne:he+ge*ne,Lt.o[2][1]=me+xt,Lt.o[3][0]=Et?he-ge:he+ge,Lt.o[3][1]=me-xt*ne}},extendPrototype([DynamicPropertyContainer],se),se}(),z=function(){function ne(se,le){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=se,this.comp=se.comp,this.data=le,this.frameId=-1,this.d=le.d,this.initDynamicPropertyContainer(se),le.sy===1?(this.ir=PropertyFactory.getProp(se,le.ir,0,0,this),this.is=PropertyFactory.getProp(se,le.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(se,le.pt,0,0,this),this.p=PropertyFactory.getProp(se,le.p,1,0,this),this.r=PropertyFactory.getProp(se,le.r,0,degToRads,this),this.or=PropertyFactory.getProp(se,le.or,0,0,this),this.os=PropertyFactory.getProp(se,le.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return ne.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var le=Math.floor(this.pt.v)*2,he=Math.PI*2/le,me=!0,ge=this.or.v,xt=this.ir.v,Et=this.os.v,Lt=this.is.v,Zt=2*Math.PI*ge/(le*2),Ht=2*Math.PI*xt/(le*2),It,Yt,ri,ei,Ct=-Math.PI/2;Ct+=this.r.v;var Ut=this.data.d===3?-1:1;for(this.v._length=0,It=0;It<le;It+=1){Yt=me?ge:xt,ri=me?Et:Lt,ei=me?Zt:Ht;var Mt=Yt*Math.cos(Ct),$t=Yt*Math.sin(Ct),jt=Mt===0&&$t===0?0:$t/Math.sqrt(Mt*Mt+$t*$t),mi=Mt===0&&$t===0?0:-Mt/Math.sqrt(Mt*Mt+$t*$t);Mt+=+this.p.v[0],$t+=+this.p.v[1],this.v.setTripleAt(Mt,$t,Mt-jt*ei*ri*Ut,$t-mi*ei*ri*Ut,Mt+jt*ei*ri*Ut,$t+mi*ei*ri*Ut,It,!0),me=!me,Ct+=he*Ut}},convertPolygonToPath:function(){var le=Math.floor(this.pt.v),he=Math.PI*2/le,me=this.or.v,ge=this.os.v,xt=2*Math.PI*me/(le*4),Et,Lt=-Math.PI*.5,Zt=this.data.d===3?-1:1;for(Lt+=this.r.v,this.v._length=0,Et=0;Et<le;Et+=1){var Ht=me*Math.cos(Lt),It=me*Math.sin(Lt),Yt=Ht===0&&It===0?0:It/Math.sqrt(Ht*Ht+It*It),ri=Ht===0&&It===0?0:-Ht/Math.sqrt(Ht*Ht+It*It);Ht+=+this.p.v[0],It+=+this.p.v[1],this.v.setTripleAt(Ht,It,Ht-Yt*xt*ge*Zt,It-ri*xt*ge*Zt,Ht+Yt*xt*ge*Zt,It+ri*xt*ge*Zt,Et,!0),Lt+=he*Zt}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],ne),ne}(),$=function(){function ne(se,le){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=se,this.comp=se.comp,this.frameId=-1,this.d=le.d,this.initDynamicPropertyContainer(se),this.p=PropertyFactory.getProp(se,le.p,1,0,this),this.s=PropertyFactory.getProp(se,le.s,1,0,this),this.r=PropertyFactory.getProp(se,le.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return ne.prototype={convertRectToPath:function(){var le=this.p.v[0],he=this.p.v[1],me=this.s.v[0]/2,ge=this.s.v[1]/2,xt=bmMin(me,ge,this.r.v),Et=xt*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(le+me,he-ge+xt,le+me,he-ge+xt,le+me,he-ge+Et,0,!0),this.v.setTripleAt(le+me,he+ge-xt,le+me,he+ge-Et,le+me,he+ge-xt,1,!0),xt!==0?(this.v.setTripleAt(le+me-xt,he+ge,le+me-xt,he+ge,le+me-Et,he+ge,2,!0),this.v.setTripleAt(le-me+xt,he+ge,le-me+Et,he+ge,le-me+xt,he+ge,3,!0),this.v.setTripleAt(le-me,he+ge-xt,le-me,he+ge-xt,le-me,he+ge-Et,4,!0),this.v.setTripleAt(le-me,he-ge+xt,le-me,he-ge+Et,le-me,he-ge+xt,5,!0),this.v.setTripleAt(le-me+xt,he-ge,le-me+xt,he-ge,le-me+Et,he-ge,6,!0),this.v.setTripleAt(le+me-xt,he-ge,le+me-Et,he-ge,le+me-xt,he-ge,7,!0)):(this.v.setTripleAt(le-me,he+ge,le-me+Et,he+ge,le-me,he+ge,2),this.v.setTripleAt(le-me,he-ge,le-me,he-ge+Et,le-me,he-ge,3))):(this.v.setTripleAt(le+me,he-ge+xt,le+me,he-ge+Et,le+me,he-ge+xt,0,!0),xt!==0?(this.v.setTripleAt(le+me-xt,he-ge,le+me-xt,he-ge,le+me-Et,he-ge,1,!0),this.v.setTripleAt(le-me+xt,he-ge,le-me+Et,he-ge,le-me+xt,he-ge,2,!0),this.v.setTripleAt(le-me,he-ge+xt,le-me,he-ge+xt,le-me,he-ge+Et,3,!0),this.v.setTripleAt(le-me,he+ge-xt,le-me,he+ge-Et,le-me,he+ge-xt,4,!0),this.v.setTripleAt(le-me+xt,he+ge,le-me+xt,he+ge,le-me+Et,he+ge,5,!0),this.v.setTripleAt(le+me-xt,he+ge,le+me-Et,he+ge,le+me-xt,he+ge,6,!0),this.v.setTripleAt(le+me,he+ge-xt,le+me,he+ge-xt,le+me,he+ge-Et,7,!0)):(this.v.setTripleAt(le-me,he-ge,le-me+Et,he-ge,le-me,he-ge,1,!0),this.v.setTripleAt(le-me,he+ge,le-me,he+ge-Et,le-me,he+ge,2,!0),this.v.setTripleAt(le+me,he+ge,le+me-Et,he+ge,le+me,he+ge,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:r},extendPrototype([DynamicPropertyContainer],ne),ne}();function k(ne,se,le){var he;if(le===3||le===4){var me=le===3?se.pt:se.ks,ge=me.k;ge.length?he=new C(ne,se,le):he=new n(ne,se,le)}else le===5?he=new $(ne,se):le===6?he=new I(ne,se):le===7&&(he=new z(ne,se));return he.k&&ne.addDynamicProperty(he),he}function Y(){return n}function ie(){return C}var ue={};return ue.getShapeProp=k,ue.getConstructorFunction=Y,ue.getKeyframedConstructorFunction=ie,ue}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,t=Math.sin,i=Math.tan,r=Math.round;function o(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function l(Mt){if(Mt===0)return this;var $t=e(Mt),jt=t(Mt);return this._t($t,-jt,0,0,jt,$t,0,0,0,0,1,0,0,0,0,1)}function d(Mt){if(Mt===0)return this;var $t=e(Mt),jt=t(Mt);return this._t(1,0,0,0,0,$t,-jt,0,0,jt,$t,0,0,0,0,1)}function n(Mt){if(Mt===0)return this;var $t=e(Mt),jt=t(Mt);return this._t($t,0,jt,0,0,1,0,0,-jt,0,$t,0,0,0,0,1)}function S(Mt){if(Mt===0)return this;var $t=e(Mt),jt=t(Mt);return this._t($t,-jt,0,0,jt,$t,0,0,0,0,1,0,0,0,0,1)}function C(Mt,$t){return this._t(1,$t,Mt,1,0,0)}function I(Mt,$t){return this.shear(i(Mt),i($t))}function z(Mt,$t){var jt=e($t),mi=t($t);return this._t(jt,mi,0,0,-mi,jt,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,i(Mt),1,0,0,0,0,1,0,0,0,0,1)._t(jt,-mi,0,0,mi,jt,0,0,0,0,1,0,0,0,0,1)}function $(Mt,$t,jt){return!jt&&jt!==0&&(jt=1),Mt===1&&$t===1&&jt===1?this:this._t(Mt,0,0,0,0,$t,0,0,0,0,jt,0,0,0,0,1)}function k(Mt,$t,jt,mi,Xi,Er,Ir,nr,si,Gt,ui,oi,Si,Li,Mi,kt){return this.props[0]=Mt,this.props[1]=$t,this.props[2]=jt,this.props[3]=mi,this.props[4]=Xi,this.props[5]=Er,this.props[6]=Ir,this.props[7]=nr,this.props[8]=si,this.props[9]=Gt,this.props[10]=ui,this.props[11]=oi,this.props[12]=Si,this.props[13]=Li,this.props[14]=Mi,this.props[15]=kt,this}function Y(Mt,$t,jt){return jt=jt||0,Mt!==0||$t!==0||jt!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,Mt,$t,jt,1):this}function ie(Mt,$t,jt,mi,Xi,Er,Ir,nr,si,Gt,ui,oi,Si,Li,Mi,kt){var Nt=this.props;if(Mt===1&&$t===0&&jt===0&&mi===0&&Xi===0&&Er===1&&Ir===0&&nr===0&&si===0&&Gt===0&&ui===1&&oi===0)return Nt[12]=Nt[12]*Mt+Nt[15]*Si,Nt[13]=Nt[13]*Er+Nt[15]*Li,Nt[14]=Nt[14]*ui+Nt[15]*Mi,Nt[15]*=kt,this._identityCalculated=!1,this;var gi=Nt[0],Ri=Nt[1],Rt=Nt[2],Xt=Nt[3],Hi=Nt[4],Ni=Nt[5],xi=Nt[6],$i=Nt[7],fr=Nt[8],ir=Nt[9],lr=Nt[10],Tr=Nt[11],Rr=Nt[12],Jr=Nt[13],_r=Nt[14],mr=Nt[15];return Nt[0]=gi*Mt+Ri*Xi+Rt*si+Xt*Si,Nt[1]=gi*$t+Ri*Er+Rt*Gt+Xt*Li,Nt[2]=gi*jt+Ri*Ir+Rt*ui+Xt*Mi,Nt[3]=gi*mi+Ri*nr+Rt*oi+Xt*kt,Nt[4]=Hi*Mt+Ni*Xi+xi*si+$i*Si,Nt[5]=Hi*$t+Ni*Er+xi*Gt+$i*Li,Nt[6]=Hi*jt+Ni*Ir+xi*ui+$i*Mi,Nt[7]=Hi*mi+Ni*nr+xi*oi+$i*kt,Nt[8]=fr*Mt+ir*Xi+lr*si+Tr*Si,Nt[9]=fr*$t+ir*Er+lr*Gt+Tr*Li,Nt[10]=fr*jt+ir*Ir+lr*ui+Tr*Mi,Nt[11]=fr*mi+ir*nr+lr*oi+Tr*kt,Nt[12]=Rr*Mt+Jr*Xi+_r*si+mr*Si,Nt[13]=Rr*$t+Jr*Er+_r*Gt+mr*Li,Nt[14]=Rr*jt+Jr*Ir+_r*ui+mr*Mi,Nt[15]=Rr*mi+Jr*nr+_r*oi+mr*kt,this._identityCalculated=!1,this}function ue(Mt){var $t=Mt.props;return this.transform($t[0],$t[1],$t[2],$t[3],$t[4],$t[5],$t[6],$t[7],$t[8],$t[9],$t[10],$t[11],$t[12],$t[13],$t[14],$t[15])}function ne(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function se(Mt){for(var $t=0;$t<16;){if(Mt.props[$t]!==this.props[$t])return!1;$t+=1}return!0}function le(Mt){var $t;for($t=0;$t<16;$t+=1)Mt.props[$t]=this.props[$t];return Mt}function he(Mt){var $t;for($t=0;$t<16;$t+=1)this.props[$t]=Mt[$t]}function me(Mt,$t,jt){return{x:Mt*this.props[0]+$t*this.props[4]+jt*this.props[8]+this.props[12],y:Mt*this.props[1]+$t*this.props[5]+jt*this.props[9]+this.props[13],z:Mt*this.props[2]+$t*this.props[6]+jt*this.props[10]+this.props[14]}}function ge(Mt,$t,jt){return Mt*this.props[0]+$t*this.props[4]+jt*this.props[8]+this.props[12]}function xt(Mt,$t,jt){return Mt*this.props[1]+$t*this.props[5]+jt*this.props[9]+this.props[13]}function Et(Mt,$t,jt){return Mt*this.props[2]+$t*this.props[6]+jt*this.props[10]+this.props[14]}function Lt(){var Mt=this.props[0]*this.props[5]-this.props[1]*this.props[4],$t=this.props[5]/Mt,jt=-this.props[1]/Mt,mi=-this.props[4]/Mt,Xi=this.props[0]/Mt,Er=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/Mt,Ir=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/Mt,nr=new Matrix;return nr.props[0]=$t,nr.props[1]=jt,nr.props[4]=mi,nr.props[5]=Xi,nr.props[12]=Er,nr.props[13]=Ir,nr}function Zt(Mt){var $t=this.getInverseMatrix();return $t.applyToPointArray(Mt[0],Mt[1],Mt[2]||0)}function Ht(Mt){var $t,jt=Mt.length,mi=[];for($t=0;$t<jt;$t+=1)mi[$t]=Zt(Mt[$t]);return mi}function It(Mt,$t,jt){var mi=createTypedArray("float32",6);if(this.isIdentity())mi[0]=Mt[0],mi[1]=Mt[1],mi[2]=$t[0],mi[3]=$t[1],mi[4]=jt[0],mi[5]=jt[1];else{var Xi=this.props[0],Er=this.props[1],Ir=this.props[4],nr=this.props[5],si=this.props[12],Gt=this.props[13];mi[0]=Mt[0]*Xi+Mt[1]*Ir+si,mi[1]=Mt[0]*Er+Mt[1]*nr+Gt,mi[2]=$t[0]*Xi+$t[1]*Ir+si,mi[3]=$t[0]*Er+$t[1]*nr+Gt,mi[4]=jt[0]*Xi+jt[1]*Ir+si,mi[5]=jt[0]*Er+jt[1]*nr+Gt}return mi}function Yt(Mt,$t,jt){var mi;return this.isIdentity()?mi=[Mt,$t,jt]:mi=[Mt*this.props[0]+$t*this.props[4]+jt*this.props[8]+this.props[12],Mt*this.props[1]+$t*this.props[5]+jt*this.props[9]+this.props[13],Mt*this.props[2]+$t*this.props[6]+jt*this.props[10]+this.props[14]],mi}function ri(Mt,$t){if(this.isIdentity())return Mt+","+$t;var jt=this.props;return Math.round((Mt*jt[0]+$t*jt[4]+jt[12])*100)/100+","+Math.round((Mt*jt[1]+$t*jt[5]+jt[13])*100)/100}function ei(){for(var Mt=0,$t=this.props,jt="matrix3d(",mi=1e4;Mt<16;)jt+=r($t[Mt]*mi)/mi,jt+=Mt===15?")":",",Mt+=1;return jt}function Ct(Mt){var $t=1e4;return Mt<1e-6&&Mt>0||Mt>-1e-6&&Mt<0?r(Mt*$t)/$t:Mt}function Ut(){var Mt=this.props,$t=Ct(Mt[0]),jt=Ct(Mt[1]),mi=Ct(Mt[4]),Xi=Ct(Mt[5]),Er=Ct(Mt[12]),Ir=Ct(Mt[13]);return"matrix("+$t+","+jt+","+mi+","+Xi+","+Er+","+Ir+")"}return function(){this.reset=o,this.rotate=l,this.rotateX=d,this.rotateY=n,this.rotateZ=S,this.skew=I,this.skewFromAxis=z,this.shear=C,this.scale=$,this.setTransform=k,this.translate=Y,this.transform=ie,this.multiply=ue,this.applyToPoint=me,this.applyToX=ge,this.applyToY=xt,this.applyToZ=Et,this.applyToPointArray=Yt,this.applyToTriplePoints=It,this.applyToPointStringified=ri,this.toCSS=ei,this.to2dCSS=Ut,this.clone=le,this.cloneFromProps=he,this.equals=se,this.inversePoints=Ht,this.inversePoint=Zt,this.getInverseMatrix=Lt,this._t=this.transform,this.isIdentity=ne,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,t){e==="expressions"&&setExpressionsPlugin(t)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var t=queryString.split("&"),i=0;i<t.length;i+=1){var r=t[i].split("=");if(decodeURIComponent(r[0])==e)return decodeURIComponent(r[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},t={};e.registerModifier=i,e.getModifier=r;function i(o,l){t[o]||(t[o]=l)}function r(o,l,d){return new t[o](l,d)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var t={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(t),this.addShapeToModifier(t),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,t){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,t){this.s=PropertyFactory.getProp(e,t.s,0,.01,this),this.e=PropertyFactory.getProp(e,t.e,0,.01,this),this.o=PropertyFactory.getProp(e,t.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=t.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,t,i,r,o){var l=[];t<=1?l.push({s:e,e:t}):e>=1?l.push({s:e-1,e:t-1}):(l.push({s:e,e:1}),l.push({s:0,e:t-1}));var d=[],n,S=l.length,C;for(n=0;n<S;n+=1)if(C=l[n],!(C.e*o<r||C.s*o>r+i)){var I,z;C.s*o<=r?I=0:I=(C.s*o-r)/i,C.e*o>=r+i?z=1:z=(C.e*o-r)/i,d.push([I,z])}return d.length||d.push([0,0]),d},TrimModifier.prototype.releasePathsData=function(e){var t,i=e.length;for(t=0;t<i;t+=1)segmentsLengthPool.release(e[t]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var t,i;if(this._mdf||e){var r=this.o.v%360/360;if(r<0&&(r+=1),this.s.v>1?t=1+r:this.s.v<0?t=0+r:t=this.s.v+r,this.e.v>1?i=1+r:this.e.v<0?i=0+r:i=this.e.v+r,t>i){var o=t;t=i,i=o}t=Math.round(t*1e4)*1e-4,i=Math.round(i*1e4)*1e-4,this.sValue=t,this.eValue=i}else t=this.sValue,i=this.eValue;var l,d,n=this.shapes.length,S,C,I,z,$,k=0;if(i===t)for(d=0;d<n;d+=1)this.shapes[d].localShapeCollection.releaseShapes(),this.shapes[d].shape._mdf=!0,this.shapes[d].shape.paths=this.shapes[d].localShapeCollection,this._mdf&&(this.shapes[d].pathsData.length=0);else if(i===1&&t===0||i===0&&t===1){if(this._mdf)for(d=0;d<n;d+=1)this.shapes[d].pathsData.length=0,this.shapes[d].shape._mdf=!0}else{var Y=[],ie,ue;for(d=0;d<n;d+=1)if(ie=this.shapes[d],!ie.shape._mdf&&!this._mdf&&!e&&this.m!==2)ie.shape.paths=ie.localShapeCollection;else{if(l=ie.shape.paths,C=l._length,$=0,!ie.shape._mdf&&ie.pathsData.length)$=ie.totalShapeLength;else{for(I=this.releasePathsData(ie.pathsData),S=0;S<C;S+=1)z=bez.getSegmentsLength(l.shapes[S]),I.push(z),$+=z.totalLength;ie.totalShapeLength=$,ie.pathsData=I}k+=$,ie.shape._mdf=!0}var ne=t,se=i,le=0,he;for(d=n-1;d>=0;d-=1)if(ie=this.shapes[d],ie.shape._mdf){for(ue=ie.localShapeCollection,ue.releaseShapes(),this.m===2&&n>1?(he=this.calculateShapeEdges(t,i,ie.totalShapeLength,le,k),le+=ie.totalShapeLength):he=[[ne,se]],C=he.length,S=0;S<C;S+=1){ne=he[S][0],se=he[S][1],Y.length=0,se<=1?Y.push({s:ie.totalShapeLength*ne,e:ie.totalShapeLength*se}):ne>=1?Y.push({s:ie.totalShapeLength*(ne-1),e:ie.totalShapeLength*(se-1)}):(Y.push({s:ie.totalShapeLength*ne,e:ie.totalShapeLength}),Y.push({s:0,e:ie.totalShapeLength*(se-1)}));var me=this.addShapes(ie,Y[0]);if(Y[0].s!==Y[0].e){if(Y.length>1){var ge=ie.shape.paths.shapes[ie.shape.paths._length-1];if(ge.c){var xt=me.pop();this.addPaths(me,ue),me=this.addShapes(ie,Y[1],xt)}else this.addPaths(me,ue),me=this.addShapes(ie,Y[1])}this.addPaths(me,ue)}}ie.shape.paths=ue}}},TrimModifier.prototype.addPaths=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)t.addShape(e[i])},TrimModifier.prototype.addSegment=function(e,t,i,r,o,l,d){o.setXYAt(t[0],t[1],"o",l),o.setXYAt(i[0],i[1],"i",l+1),d&&o.setXYAt(e[0],e[1],"v",l),o.setXYAt(r[0],r[1],"v",l+1)},TrimModifier.prototype.addSegmentFromArray=function(e,t,i,r){t.setXYAt(e[1],e[5],"o",i),t.setXYAt(e[2],e[6],"i",i+1),r&&t.setXYAt(e[0],e[4],"v",i),t.setXYAt(e[3],e[7],"v",i+1)},TrimModifier.prototype.addShapes=function(e,t,i){var r=e.pathsData,o=e.shape.paths.shapes,l,d=e.shape.paths._length,n,S,C=0,I,z,$,k,Y=[],ie,ue=!0;for(i?(z=i._length,ie=i._length):(i=shapePool.newElement(),z=0,ie=0),Y.push(i),l=0;l<d;l+=1){for($=r[l].lengths,i.c=o[l].c,S=o[l].c?$.length:$.length+1,n=1;n<S;n+=1)if(I=$[n-1],C+I.addedLength<t.s)C+=I.addedLength,i.c=!1;else if(C>t.e){i.c=!1;break}else t.s<=C&&t.e>=C+I.addedLength?(this.addSegment(o[l].v[n-1],o[l].o[n-1],o[l].i[n],o[l].v[n],i,z,ue),ue=!1):(k=bez.getNewSegment(o[l].v[n-1],o[l].v[n],o[l].o[n-1],o[l].i[n],(t.s-C)/I.addedLength,(t.e-C)/I.addedLength,$[n-1]),this.addSegmentFromArray(k,i,z,ue),ue=!1,i.c=!1),C+=I.addedLength,z+=1;if(o[l].c&&$.length){if(I=$[n-1],C<=t.e){var ne=$[n-1].addedLength;t.s<=C&&t.e>=C+ne?(this.addSegment(o[l].v[n-1],o[l].o[n-1],o[l].i[0],o[l].v[0],i,z,ue),ue=!1):(k=bez.getNewSegment(o[l].v[n-1],o[l].v[0],o[l].o[n-1],o[l].i[0],(t.s-C)/ne,(t.e-C)/ne,$[n-1]),this.addSegmentFromArray(k,i,z,ue),ue=!1,i.c=!1)}else i.c=!1;C+=I.addedLength,z+=1}if(i._length&&(i.setXYAt(i.v[ie][0],i.v[ie][1],"i",ie),i.setXYAt(i.v[i._length-1][0],i.v[i._length-1][1],"o",i._length-1)),C>t.e)break;l<d-1&&(i=shapePool.newElement(),ue=!0,Y.push(i),z=0)}return Y};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,t){var i=t/100,r=[0,0],o=e._length,l=0;for(l=0;l<o;l+=1)r[0]+=e.v[l][0],r[1]+=e.v[l][1];r[0]/=o,r[1]/=o;var d=shapePool.newElement();d.c=e.c;var n,S,C,I,z,$;for(l=0;l<o;l+=1)n=e.v[l][0]+(r[0]-e.v[l][0])*i,S=e.v[l][1]+(r[1]-e.v[l][1])*i,C=e.o[l][0]+(r[0]-e.o[l][0])*-i,I=e.o[l][1]+(r[1]-e.o[l][1])*-i,z=e.i[l][0]+(r[0]-e.i[l][0])*-i,$=e.i[l][1]+(r[1]-e.i[l][1])*-i,d.setTripleAt(n,S,C,I,z,$,l);return d},PuckerAndBloatModifier.prototype.processShapes=function(e){var t,i,r=this.shapes.length,o,l,d=this.amount.v;if(d!==0){var n,S;for(i=0;i<r;i+=1){if(n=this.shapes[i],S=n.localShapeCollection,!(!n.shape._mdf&&!this._mdf&&!e))for(S.releaseShapes(),n.shape._mdf=!0,t=n.shape.paths.shapes,l=n.shape.paths._length,o=0;o<l;o+=1)S.addShape(this.processPath(t[o],d));n.shape.paths=n.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function t(S){var C=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||C,this.a&&S.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&S.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&S.skewFromAxis(-this.sk.v,this.sa.v),this.r?S.rotate(-this.r.v):S.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?S.translate(this.px.v,this.py.v,-this.pz.v):S.translate(this.px.v,this.py.v,0):S.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function i(S){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||S){var C;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var I,z;if(C=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(I=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/C,0),z=this.p.getValueAtTime(this.p.keyframes[0].t/C,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(I=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/C,0),z=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/C,0)):(I=this.p.pv,z=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/C,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){I=[],z=[];var $=this.px,k=this.py;$._caching.lastFrame+$.offsetTime<=$.keyframes[0].t?(I[0]=$.getValueAtTime(($.keyframes[0].t+.01)/C,0),I[1]=k.getValueAtTime((k.keyframes[0].t+.01)/C,0),z[0]=$.getValueAtTime($.keyframes[0].t/C,0),z[1]=k.getValueAtTime(k.keyframes[0].t/C,0)):$._caching.lastFrame+$.offsetTime>=$.keyframes[$.keyframes.length-1].t?(I[0]=$.getValueAtTime($.keyframes[$.keyframes.length-1].t/C,0),I[1]=k.getValueAtTime(k.keyframes[k.keyframes.length-1].t/C,0),z[0]=$.getValueAtTime(($.keyframes[$.keyframes.length-1].t-.01)/C,0),z[1]=k.getValueAtTime((k.keyframes[k.keyframes.length-1].t-.01)/C,0)):(I=[$.pv,k.pv],z[0]=$.getValueAtTime(($._caching.lastFrame+$.offsetTime-.01)/C,$.offsetTime),z[1]=k.getValueAtTime((k._caching.lastFrame+k.offsetTime-.01)/C,k.offsetTime))}else z=e,I=z;this.v.rotate(-Math.atan2(I[1]-z[1],I[0]-z[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function r(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function o(){}function l(S){this._addDynamicProperty(S),this.elem.addDynamicProperty(S),this._isDirty=!0}function d(S,C,I){if(this.elem=S,this.frameId=-1,this.propType="transform",this.data=C,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(I||S),C.p&&C.p.s?(this.px=PropertyFactory.getProp(S,C.p.x,0,0,this),this.py=PropertyFactory.getProp(S,C.p.y,0,0,this),C.p.z&&(this.pz=PropertyFactory.getProp(S,C.p.z,0,0,this))):this.p=PropertyFactory.getProp(S,C.p||{k:[0,0,0]},1,0,this),C.rx){if(this.rx=PropertyFactory.getProp(S,C.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(S,C.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(S,C.rz,0,degToRads,this),C.or.k[0].ti){var z,$=C.or.k.length;for(z=0;z<$;z+=1)C.or.k[z].to=null,C.or.k[z].ti=null}this.or=PropertyFactory.getProp(S,C.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(S,C.r||{k:0},0,degToRads,this);C.sk&&(this.sk=PropertyFactory.getProp(S,C.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(S,C.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(S,C.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(S,C.s||{k:[100,100,100]},1,.01,this),C.o?this.o=PropertyFactory.getProp(S,C.o,0,.01,S):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}d.prototype={applyToMatrix:t,getValue:i,precalculateMatrix:r,autoOrient:o},extendPrototype([DynamicPropertyContainer],d),d.prototype.addDynamicProperty=l,d.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function n(S,C,I){return new d(S,C,I)}return{getTransformProperty:n}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,t.c,0,null,this),this.o=PropertyFactory.getProp(e,t.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,t.tr,this),this.so=PropertyFactory.getProp(e,t.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,t.tr.eo,0,.01,this),this.data=t,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,t,i,r,o,l){var d=l?-1:1,n=r.s.v[0]+(1-r.s.v[0])*(1-o),S=r.s.v[1]+(1-r.s.v[1])*(1-o);e.translate(r.p.v[0]*d*o,r.p.v[1]*d*o,r.p.v[2]),t.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),t.rotate(-r.r.v*d*o),t.translate(r.a.v[0],r.a.v[1],r.a.v[2]),i.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),i.scale(l?1/n:n,l?1/S:S),i.translate(r.a.v[0],r.a.v[1],r.a.v[2])},RepeaterModifier.prototype.init=function(e,t,i,r){for(this.elem=e,this.arr=t,this.pos=i,this.elemsData=r,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t[i]);i>0;)i-=1,this._elements.unshift(t[i]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t]._processed=!1,e[t].ty==="gr"&&this.resetElements(e[t].it)},RepeaterModifier.prototype.cloneElements=function(e){var t=JSON.parse(JSON.stringify(e));return this.resetElements(t),t},RepeaterModifier.prototype.changeGroupRender=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)e[i]._render=t,e[i].ty==="gr"&&this.changeGroupRender(e[i].it,t)},RepeaterModifier.prototype.processShapes=function(e){var t,i,r,o,l,d=!1;if(this._mdf||e){var n=Math.ceil(this.c.v);if(this._groups.length<n){for(;this._groups.length<n;){var S={it:this.cloneElements(this._elements),ty:"gr"};S.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,S),this._groups.splice(0,0,S),this._currentCopies+=1}this.elem.reloadShapes(),d=!0}l=0;var C;for(r=0;r<=this._groups.length-1;r+=1){if(C=l<n,this._groups[r]._render=C,this.changeGroupRender(this._groups[r].it,C),!C){var I=this.elemsData[r].it,z=I[I.length-1];z.transform.op.v!==0?(z.transform.op._mdf=!0,z.transform.op.v=0):z.transform.op._mdf=!1}l+=1}this._currentCopies=n;var $=this.o.v,k=$%1,Y=$>0?Math.floor($):Math.ceil($),ie=this.pMatrix.props,ue=this.rMatrix.props,ne=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var se=0;if($>0){for(;se<Y;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),se+=1;k&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,k,!1),se+=k)}else if($<0){for(;se>Y;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),se-=1;k&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-k,!0),se-=k)}r=this.data.m===1?0:this._currentCopies-1,o=this.data.m===1?1:-1,l=this._currentCopies;for(var le,he;l;){if(t=this.elemsData[r].it,i=t[t.length-1].transform.mProps.v.props,he=i.length,t[t.length-1].transform.mProps._mdf=!0,t[t.length-1].transform.op._mdf=!0,t[t.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(r/(this._currentCopies-1)),se!==0){for((r!==0&&o===1||r!==this._currentCopies-1&&o===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(ue[0],ue[1],ue[2],ue[3],ue[4],ue[5],ue[6],ue[7],ue[8],ue[9],ue[10],ue[11],ue[12],ue[13],ue[14],ue[15]),this.matrix.transform(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5],ne[6],ne[7],ne[8],ne[9],ne[10],ne[11],ne[12],ne[13],ne[14],ne[15]),this.matrix.transform(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5],ie[6],ie[7],ie[8],ie[9],ie[10],ie[11],ie[12],ie[13],ie[14],ie[15]),le=0;le<he;le+=1)i[le]=this.matrix.props[le];this.matrix.reset()}else for(this.matrix.reset(),le=0;le<he;le+=1)i[le]=this.matrix.props[le];se+=1,l-=1,r+=o}}else for(l=this._currentCopies,r=0,o=1;l;)t=this.elemsData[r].it,i=t[t.length-1].transform.mProps.v.props,t[t.length-1].transform.mProps._mdf=!1,t[t.length-1].transform.op._mdf=!1,l-=1,r+=o;return d},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,t.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,t){var i=shapePool.newElement();i.c=e.c;var r,o=e._length,l,d,n,S,C,I,z=0,$,k,Y,ie,ue,ne;for(r=0;r<o;r+=1)l=e.v[r],n=e.o[r],d=e.i[r],l[0]===n[0]&&l[1]===n[1]&&l[0]===d[0]&&l[1]===d[1]?(r===0||r===o-1)&&!e.c?(i.setTripleAt(l[0],l[1],n[0],n[1],d[0],d[1],z),z+=1):(r===0?S=e.v[o-1]:S=e.v[r-1],C=Math.sqrt(Math.pow(l[0]-S[0],2)+Math.pow(l[1]-S[1],2)),I=C?Math.min(C/2,t)/C:0,ue=l[0]+(S[0]-l[0])*I,$=ue,ne=l[1]-(l[1]-S[1])*I,k=ne,Y=$-($-l[0])*roundCorner,ie=k-(k-l[1])*roundCorner,i.setTripleAt($,k,Y,ie,ue,ne,z),z+=1,r===o-1?S=e.v[0]:S=e.v[r+1],C=Math.sqrt(Math.pow(l[0]-S[0],2)+Math.pow(l[1]-S[1],2)),I=C?Math.min(C/2,t)/C:0,Y=l[0]+(S[0]-l[0])*I,$=Y,ie=l[1]+(S[1]-l[1])*I,k=ie,ue=$-($-l[0])*roundCorner,ne=k-(k-l[1])*roundCorner,i.setTripleAt($,k,Y,ie,ue,ne,z),z+=1):(i.setTripleAt(e.v[r][0],e.v[r][1],e.o[r][0],e.o[r][1],e.i[r][0],e.i[r][1],z),z+=1);return i},RoundCornersModifier.prototype.processShapes=function(e){var t,i,r=this.shapes.length,o,l,d=this.rd.v;if(d!==0){var n,S;for(i=0;i<r;i+=1){if(n=this.shapes[i],S=n.localShapeCollection,!(!n.shape._mdf&&!this._mdf&&!e))for(S.releaseShapes(),n.shape._mdf=!0,t=n.shape.paths.shapes,l=n.shape.paths._length,o=0;o<l;o+=1)S.addShape(this.processPath(t[o],d));n.shape.paths=n.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,t){return Math.abs(e-t)*1e5<=Math.min(Math.abs(e),Math.abs(t))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,t,i){return e*(1-i)+t*i}function lerpPoint(e,t,i){return[lerp(e[0],t[0],i),lerp(e[1],t[1],i)]}function quadRoots(e,t,i){if(e===0)return[];var r=t*t-4*e*i;if(r<0)return[];var o=-t/(2*e);if(r===0)return[o];var l=Math.sqrt(r)/(2*e);return[o-l,o+l]}function polynomialCoefficients(e,t,i,r){return[-e+3*t-3*i+r,3*e-6*t+3*i,-3*e+3*t,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,t,i,r,o){o&&pointEqual(e,t)&&(t=lerpPoint(e,r,1/3)),o&&pointEqual(i,r)&&(i=lerpPoint(e,r,2/3));var l=polynomialCoefficients(e[0],t[0],i[0],r[0]),d=polynomialCoefficients(e[1],t[1],i[1],r[1]);this.a=[l[0],d[0]],this.b=[l[1],d[1]],this.c=[l[2],d[2]],this.d=[l[3],d[3]],this.points=[e,t,i,r]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var t=this.derivative(e);return Math.atan2(t[1],t[0])},PolynomialBezier.prototype.normalAngle=function(e){var t=this.derivative(e);return Math.atan2(t[0],t[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var t=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,i=t*t-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(i<0)return[];var r=Math.sqrt(i);return floatZero(r)?r>0&&r<1?[t]:[]:[t-r,t+r].filter(function(o){return o>0&&o<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var t=lerpPoint(this.points[0],this.points[1],e),i=lerpPoint(this.points[1],this.points[2],e),r=lerpPoint(this.points[2],this.points[3],e),o=lerpPoint(t,i,e),l=lerpPoint(i,r,e),d=lerpPoint(o,l,e);return[new PolynomialBezier(this.points[0],t,o,d,!0),new PolynomialBezier(d,l,r,this.points[3],!0)]};function extrema(e,t){var i=e.points[0][t],r=e.points[e.points.length-1][t];if(i>r){var o=r;r=i,i=o}for(var l=quadRoots(3*e.a[t],2*e.b[t],e.c[t]),d=0;d<l.length;d+=1)if(l[d]>0&&l[d]<1){var n=e.point(l[d])[t];n<i?i=n:n>r&&(r=n)}return{min:i,max:r}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,t,i){var r=e.boundingBox();return{cx:r.cx,cy:r.cy,width:r.width,height:r.height,bez:e,t:(t+i)/2,t1:t,t2:i}}function splitData(e){var t=e.bez.split(.5);return[intersectData(t[0],e.t1,e.t),intersectData(t[1],e.t,e.t2)]}function boxIntersect(e,t){return Math.abs(e.cx-t.cx)*2<e.width+t.width&&Math.abs(e.cy-t.cy)*2<e.height+t.height}function intersectsImpl(e,t,i,r,o,l){if(boxIntersect(e,t)){if(i>=l||e.width<=r&&e.height<=r&&t.width<=r&&t.height<=r){o.push([e.t,t.t]);return}var d=splitData(e),n=splitData(t);intersectsImpl(d[0],n[0],i+1,r,o,l),intersectsImpl(d[0],n[1],i+1,r,o,l),intersectsImpl(d[1],n[0],i+1,r,o,l),intersectsImpl(d[1],n[1],i+1,r,o,l)}}PolynomialBezier.prototype.intersections=function(e,t,i){t===void 0&&(t=2),i===void 0&&(i=7);var r=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,t,r,i),r},PolynomialBezier.shapeSegment=function(e,t){var i=(t+1)%e.length();return new PolynomialBezier(e.v[t],e.o[t],e.i[i],e.v[i],!0)},PolynomialBezier.shapeSegmentInverted=function(e,t){var i=(t+1)%e.length();return new PolynomialBezier(e.v[i],e.i[i],e.o[t],e.v[t],!0)};function crossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function lineIntersection(e,t,i,r){var o=[e[0],e[1],1],l=[t[0],t[1],1],d=[i[0],i[1],1],n=[r[0],r[1],1],S=crossProduct(crossProduct(o,l),crossProduct(d,n));return floatZero(S[2])?null:[S[0]/S[2],S[1]/S[2]]}function polarOffset(e,t,i){return[e[0]+Math.cos(t)*i,e[1]-Math.sin(t)*i]}function pointDistance(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function pointEqual(e,t){return floatEqual(e[0],t[0])&&floatEqual(e[1],t[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,t.s,0,null,this),this.frequency=PropertyFactory.getProp(e,t.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,t.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,t,i,r,o,l,d){var n=i-Math.PI/2,S=i+Math.PI/2,C=t[0]+Math.cos(i)*r*o,I=t[1]-Math.sin(i)*r*o;e.setTripleAt(C,I,C+Math.cos(n)*l,I-Math.sin(n)*l,C+Math.cos(S)*d,I-Math.sin(S)*d,e.length())}function getPerpendicularVector(e,t){var i=[t[0]-e[0],t[1]-e[1]],r=-Math.PI*.5,o=[Math.cos(r)*i[0]-Math.sin(r)*i[1],Math.sin(r)*i[0]+Math.cos(r)*i[1]];return o}function getProjectingAngle(e,t){var i=t===0?e.length()-1:t-1,r=(t+1)%e.length(),o=e.v[i],l=e.v[r],d=getPerpendicularVector(o,l);return Math.atan2(0,1)-Math.atan2(d[1],d[0])}function zigZagCorner(e,t,i,r,o,l,d){var n=getProjectingAngle(t,i),S=t.v[i%t._length],C=t.v[i===0?t._length-1:i-1],I=t.v[(i+1)%t._length],z=l===2?Math.sqrt(Math.pow(S[0]-C[0],2)+Math.pow(S[1]-C[1],2)):0,$=l===2?Math.sqrt(Math.pow(S[0]-I[0],2)+Math.pow(S[1]-I[1],2)):0;setPoint(e,t.v[i%t._length],n,d,r,$/((o+1)*2),z/((o+1)*2))}function zigZagSegment(e,t,i,r,o,l){for(var d=0;d<r;d+=1){var n=(d+1)/(r+1),S=o===2?Math.sqrt(Math.pow(t.points[3][0]-t.points[0][0],2)+Math.pow(t.points[3][1]-t.points[0][1],2)):0,C=t.normalAngle(n),I=t.point(n);setPoint(e,I,C,l,i,S/((r+1)*2),S/((r+1)*2)),l=-l}return l}ZigZagModifier.prototype.processPath=function(e,t,i,r){var o=e._length,l=shapePool.newElement();if(l.c=e.c,e.c||(o-=1),o===0)return l;var d=-1,n=PolynomialBezier.shapeSegment(e,0);zigZagCorner(l,e,0,t,i,r,d);for(var S=0;S<o;S+=1)d=zigZagSegment(l,n,t,i,r,-d),S===o-1&&!e.c?n=null:n=PolynomialBezier.shapeSegment(e,(S+1)%o),zigZagCorner(l,e,S+1,t,i,r,d);return l},ZigZagModifier.prototype.processShapes=function(e){var t,i,r=this.shapes.length,o,l,d=this.amplitude.v,n=Math.max(0,Math.round(this.frequency.v)),S=this.pointsType.v;if(d!==0){var C,I;for(i=0;i<r;i+=1){if(C=this.shapes[i],I=C.localShapeCollection,!(!C.shape._mdf&&!this._mdf&&!e))for(I.releaseShapes(),C.shape._mdf=!0,t=C.shape.paths.shapes,l=C.shape.paths._length,o=0;o<l;o+=1)I.addShape(this.processPath(t[o],d,n,S));C.shape.paths=C.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,t,i){var r=Math.atan2(t[0]-e[0],t[1]-e[1]);return[polarOffset(e,r,i),polarOffset(t,r,i)]}function offsetSegment(e,t){var i,r,o,l,d,n,S;S=linearOffset(e.points[0],e.points[1],t),i=S[0],r=S[1],S=linearOffset(e.points[1],e.points[2],t),o=S[0],l=S[1],S=linearOffset(e.points[2],e.points[3],t),d=S[0],n=S[1];var C=lineIntersection(i,r,o,l);C===null&&(C=r);var I=lineIntersection(d,n,o,l);return I===null&&(I=d),new PolynomialBezier(i,C,I,n)}function joinLines(e,t,i,r,o){var l=t.points[3],d=i.points[0];if(r===3||pointEqual(l,d))return l;if(r===2){var n=-t.tangentAngle(1),S=-i.tangentAngle(0)+Math.PI,C=lineIntersection(l,polarOffset(l,n+Math.PI/2,100),d,polarOffset(d,n+Math.PI/2,100)),I=C?pointDistance(C,l):pointDistance(l,d)/2,z=polarOffset(l,n,2*I*roundCorner);return e.setXYAt(z[0],z[1],"o",e.length()-1),z=polarOffset(d,S,2*I*roundCorner),e.setTripleAt(d[0],d[1],d[0],d[1],z[0],z[1],e.length()),d}var $=pointEqual(l,t.points[2])?t.points[0]:t.points[2],k=pointEqual(d,i.points[1])?i.points[3]:i.points[1],Y=lineIntersection($,l,d,k);return Y&&pointDistance(Y,l)<o?(e.setTripleAt(Y[0],Y[1],Y[0],Y[1],Y[0],Y[1],e.length()),Y):l}function getIntersection(e,t){var i=e.intersections(t);return i.length&&floatEqual(i[0][0],1)&&i.shift(),i.length?i[0]:null}function pruneSegmentIntersection(e,t){var i=e.slice(),r=t.slice(),o=getIntersection(e[e.length-1],t[0]);return o&&(i[e.length-1]=e[e.length-1].split(o[0])[0],r[0]=t[0].split(o[1])[1]),e.length>1&&t.length>1&&(o=getIntersection(e[0],t[t.length-1]),o)?[[e[0].split(o[0])[0]],[t[t.length-1].split(o[1])[1]]]:[i,r]}function pruneIntersections(e){for(var t,i=1;i<e.length;i+=1)t=pruneSegmentIntersection(e[i-1],e[i]),e[i-1]=t[0],e[i]=t[1];return e.length>1&&(t=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=t[0],e[0]=t[1]),e}function offsetSegmentSplit(e,t){var i=e.inflectionPoints(),r,o,l,d;if(i.length===0)return[offsetSegment(e,t)];if(i.length===1||floatEqual(i[1],1))return l=e.split(i[0]),r=l[0],o=l[1],[offsetSegment(r,t),offsetSegment(o,t)];l=e.split(i[0]),r=l[0];var n=(i[1]-i[0])/(1-i[0]);return l=l[1].split(n),d=l[0],o=l[1],[offsetSegment(r,t),offsetSegment(d,t),offsetSegment(o,t)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,t.ml,0,null,this),this.lineJoin=t.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,t,i,r){var o=shapePool.newElement();o.c=e.c;var l=e.length();e.c||(l-=1);var d,n,S,C=[];for(d=0;d<l;d+=1)S=PolynomialBezier.shapeSegment(e,d),C.push(offsetSegmentSplit(S,t));if(!e.c)for(d=l-1;d>=0;d-=1)S=PolynomialBezier.shapeSegmentInverted(e,d),C.push(offsetSegmentSplit(S,t));C=pruneIntersections(C);var I=null,z=null;for(d=0;d<C.length;d+=1){var $=C[d];for(z&&(I=joinLines(o,z,$[0],i,r)),z=$[$.length-1],n=0;n<$.length;n+=1)S=$[n],I&&pointEqual(S.points[0],I)?o.setXYAt(S.points[1][0],S.points[1][1],"o",o.length()-1):o.setTripleAt(S.points[0][0],S.points[0][1],S.points[1][0],S.points[1][1],S.points[0][0],S.points[0][1],o.length()),o.setTripleAt(S.points[3][0],S.points[3][1],S.points[3][0],S.points[3][1],S.points[2][0],S.points[2][1],o.length()),I=S.points[3]}return C.length&&joinLines(o,z,C[0][0],i,r),o},OffsetPathModifier.prototype.processShapes=function(e){var t,i,r=this.shapes.length,o,l,d=this.amount.v,n=this.miterLimit.v,S=this.lineJoin;if(d!==0){var C,I;for(i=0;i<r;i+=1){if(C=this.shapes[i],I=C.localShapeCollection,!(!C.shape._mdf&&!this._mdf&&!e))for(I.releaseShapes(),C.shape._mdf=!0,t=C.shape.paths.shapes,l=C.shape.paths._length,o=0;o<l;o+=1)I.addShape(this.processPath(t[o],d,S,n));C.shape.paths=C.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var t=e.fStyle?e.fStyle.split(" "):[],i="normal",r="normal",o=t.length,l,d=0;d<o;d+=1)switch(l=t[d].toLowerCase(),l){case"italic":r="italic";break;case"bold":i="700";break;case"black":i="900";break;case"medium":i="500";break;case"regular":case"normal":i="400";break;case"light":case"thin":i="200";break}return{style:r,weight:e.fWeight||i}}var FontManager=function(){var e=5e3,t={w:0,size:0,shapes:[],data:{shapes:[]}},i=[];i=i.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var r=127988,o=917631,l=917601,d=917626,n=65039,S=8205,C=127462,I=127487,z=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function $(Ct){var Ut=Ct.split(","),Mt,$t=Ut.length,jt=[];for(Mt=0;Mt<$t;Mt+=1)Ut[Mt]!=="sans-serif"&&Ut[Mt]!=="monospace"&&jt.push(Ut[Mt]);return jt.join(",")}function k(Ct,Ut){var Mt=createTag("span");Mt.setAttribute("aria-hidden",!0),Mt.style.fontFamily=Ut;var $t=createTag("span");$t.innerText="giItT1WQy@!-/#",Mt.style.position="absolute",Mt.style.left="-10000px",Mt.style.top="-10000px",Mt.style.fontSize="300px",Mt.style.fontVariant="normal",Mt.style.fontStyle="normal",Mt.style.fontWeight="normal",Mt.style.letterSpacing="0",Mt.appendChild($t),document.body.appendChild(Mt);var jt=$t.offsetWidth;return $t.style.fontFamily=$(Ct)+", "+Ut,{node:$t,w:jt,parent:Mt}}function Y(){var Ct,Ut=this.fonts.length,Mt,$t,jt=Ut;for(Ct=0;Ct<Ut;Ct+=1)this.fonts[Ct].loaded?jt-=1:this.fonts[Ct].fOrigin==="n"||this.fonts[Ct].origin===0?this.fonts[Ct].loaded=!0:(Mt=this.fonts[Ct].monoCase.node,$t=this.fonts[Ct].monoCase.w,Mt.offsetWidth!==$t?(jt-=1,this.fonts[Ct].loaded=!0):(Mt=this.fonts[Ct].sansCase.node,$t=this.fonts[Ct].sansCase.w,Mt.offsetWidth!==$t&&(jt-=1,this.fonts[Ct].loaded=!0)),this.fonts[Ct].loaded&&(this.fonts[Ct].sansCase.parent.parentNode.removeChild(this.fonts[Ct].sansCase.parent),this.fonts[Ct].monoCase.parent.parentNode.removeChild(this.fonts[Ct].monoCase.parent)));jt!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function ie(Ct,Ut){var Mt=document.body&&Ut?"svg":"canvas",$t,jt=getFontProperties(Ct);if(Mt==="svg"){var mi=createNS("text");mi.style.fontSize="100px",mi.setAttribute("font-family",Ct.fFamily),mi.setAttribute("font-style",jt.style),mi.setAttribute("font-weight",jt.weight),mi.textContent="1",Ct.fClass?(mi.style.fontFamily="inherit",mi.setAttribute("class",Ct.fClass)):mi.style.fontFamily=Ct.fFamily,Ut.appendChild(mi),$t=mi}else{var Xi=new OffscreenCanvas(500,500).getContext("2d");Xi.font=jt.style+" "+jt.weight+" 100px "+Ct.fFamily,$t=Xi}function Er(Ir){return Mt==="svg"?($t.textContent=Ir,$t.getComputedTextLength()):$t.measureText(Ir).width}return{measureText:Er}}function ue(Ct,Ut){if(!Ct){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=Ct.list;return}if(!document.body){this.isLoaded=!0,Ct.list.forEach(function(ui){ui.helper=ie(ui),ui.cache={}}),this.fonts=Ct.list;return}var Mt=Ct.list,$t,jt=Mt.length,mi=jt;for($t=0;$t<jt;$t+=1){var Xi=!0,Er,Ir;if(Mt[$t].loaded=!1,Mt[$t].monoCase=k(Mt[$t].fFamily,"monospace"),Mt[$t].sansCase=k(Mt[$t].fFamily,"sans-serif"),!Mt[$t].fPath)Mt[$t].loaded=!0,mi-=1;else if(Mt[$t].fOrigin==="p"||Mt[$t].origin===3){if(Er=document.querySelectorAll('style[f-forigin="p"][f-family="'+Mt[$t].fFamily+'"], style[f-origin="3"][f-family="'+Mt[$t].fFamily+'"]'),Er.length>0&&(Xi=!1),Xi){var nr=createTag("style");nr.setAttribute("f-forigin",Mt[$t].fOrigin),nr.setAttribute("f-origin",Mt[$t].origin),nr.setAttribute("f-family",Mt[$t].fFamily),nr.type="text/css",nr.innerText="@font-face {font-family: "+Mt[$t].fFamily+"; font-style: normal; src: url('"+Mt[$t].fPath+"');}",Ut.appendChild(nr)}}else if(Mt[$t].fOrigin==="g"||Mt[$t].origin===1){for(Er=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Ir=0;Ir<Er.length;Ir+=1)Er[Ir].href.indexOf(Mt[$t].fPath)!==-1&&(Xi=!1);if(Xi){var si=createTag("link");si.setAttribute("f-forigin",Mt[$t].fOrigin),si.setAttribute("f-origin",Mt[$t].origin),si.type="text/css",si.rel="stylesheet",si.href=Mt[$t].fPath,document.body.appendChild(si)}}else if(Mt[$t].fOrigin==="t"||Mt[$t].origin===2){for(Er=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Ir=0;Ir<Er.length;Ir+=1)Mt[$t].fPath===Er[Ir].src&&(Xi=!1);if(Xi){var Gt=createTag("link");Gt.setAttribute("f-forigin",Mt[$t].fOrigin),Gt.setAttribute("f-origin",Mt[$t].origin),Gt.setAttribute("rel","stylesheet"),Gt.setAttribute("href",Mt[$t].fPath),Ut.appendChild(Gt)}}Mt[$t].helper=ie(Mt[$t],Ut),Mt[$t].cache={},this.fonts.push(Mt[$t])}mi===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function ne(Ct){if(Ct){this.chars||(this.chars=[]);var Ut,Mt=Ct.length,$t,jt=this.chars.length,mi;for(Ut=0;Ut<Mt;Ut+=1){for($t=0,mi=!1;$t<jt;)this.chars[$t].style===Ct[Ut].style&&this.chars[$t].fFamily===Ct[Ut].fFamily&&this.chars[$t].ch===Ct[Ut].ch&&(mi=!0),$t+=1;mi||(this.chars.push(Ct[Ut]),jt+=1)}}}function se(Ct,Ut,Mt){for(var $t=0,jt=this.chars.length;$t<jt;){if(this.chars[$t].ch===Ct&&this.chars[$t].style===Ut&&this.chars[$t].fFamily===Mt)return this.chars[$t];$t+=1}return(typeof Ct=="string"&&Ct.charCodeAt(0)!==13||!Ct)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",Ct,Ut,Mt)),t}function le(Ct,Ut,Mt){var $t=this.getFontByName(Ut),jt=Ct;if(!$t.cache[jt]){var mi=$t.helper;if(Ct===" "){var Xi=mi.measureText("|"+Ct+"|"),Er=mi.measureText("||");$t.cache[jt]=(Xi-Er)/100}else $t.cache[jt]=mi.measureText(Ct)/100}return $t.cache[jt]*Mt}function he(Ct){for(var Ut=0,Mt=this.fonts.length;Ut<Mt;){if(this.fonts[Ut].fName===Ct)return this.fonts[Ut];Ut+=1}return this.fonts[0]}function me(Ct){var Ut=0,Mt=Ct.charCodeAt(0);if(Mt>=55296&&Mt<=56319){var $t=Ct.charCodeAt(1);$t>=56320&&$t<=57343&&(Ut=(Mt-55296)*1024+$t-56320+65536)}return Ut}function ge(Ct,Ut){var Mt=Ct.toString(16)+Ut.toString(16);return z.indexOf(Mt)!==-1}function xt(Ct){return Ct===S}function Et(Ct){return Ct===n}function Lt(Ct){var Ut=me(Ct);return Ut>=C&&Ut<=I}function Zt(Ct){return Lt(Ct.substr(0,2))&&Lt(Ct.substr(2,2))}function Ht(Ct){return i.indexOf(Ct)!==-1}function It(Ct,Ut){var Mt=me(Ct.substr(Ut,2));if(Mt!==r)return!1;var $t=0;for(Ut+=2;$t<5;){if(Mt=me(Ct.substr(Ut,2)),Mt<l||Mt>d)return!1;$t+=1,Ut+=2}return me(Ct.substr(Ut,2))===o}function Yt(){this.isLoaded=!0}var ri=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};ri.isModifier=ge,ri.isZeroWidthJoiner=xt,ri.isFlagEmoji=Zt,ri.isRegionalCode=Lt,ri.isCombinedCharacter=Ht,ri.isRegionalFlag=It,ri.isVariationSelector=Et,ri.BLACK_FLAG_CODE_POINT=r;var ei={addChars:ne,addFonts:ue,getCharData:se,getFontByName:he,measureText:le,checkLoadedFonts:Y,setIsLoaded:Yt};return ri.prototype=ei,ri}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(t){this.renderableComponents.indexOf(t)===-1&&this.renderableComponents.push(t)},removeRenderableComponent:function(t){this.renderableComponents.indexOf(t)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(t),1)},prepareRenderableFrame:function(t){this.checkLayerLimits(t)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(t){this.data.ip-this.data.st<=t&&this.data.op-this.data.st>t?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var t,i=this.renderableComponents.length;for(t=0;t<i;t+=1)this.renderableComponents[t].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(t){return e[t]||""}}();function SliderEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function AngleEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function ColorEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,1,0,i)}function PointEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,1,0,i)}function LayerIndexEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function MaskIndexEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function CheckboxEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function NoValueEffect(){this.p={}}function EffectsManager(e,t){var i=e.ef||[];this.effectElements=[];var r,o=i.length,l;for(r=0;r<o;r+=1)l=new GroupEffect(i[r],t),this.effectElements.push(l)}function GroupEffect(e,t){this.init(e,t)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,t){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(t);var i,r=this.data.ef.length,o,l=this.data.ef;for(i=0;i<r;i+=1){switch(o=null,l[i].ty){case 0:o=new SliderEffect(l[i],t,this);break;case 1:o=new AngleEffect(l[i],t,this);break;case 2:o=new ColorEffect(l[i],t,this);break;case 3:o=new PointEffect(l[i],t,this);break;case 4:case 7:o=new CheckboxEffect(l[i],t,this);break;case 10:o=new LayerIndexEffect(l[i],t,this);break;case 11:o=new MaskIndexEffect(l[i],t,this);break;case 5:o=new EffectsManager(l[i],t);break;default:o=new NoValueEffect(l[i]);break}o&&this.effectElements.push(o)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var t=0,i=this.data.masksProperties.length;t<i;){if(this.data.masksProperties[t].mode!=="n"&&this.data.masksProperties[t].cl!==!1)return!0;t+=1}return!1},initExpressions:function(){var t=getExpressionInterfaces();if(t){var i=t("layer"),r=t("effects"),o=t("shape"),l=t("text"),d=t("comp");this.layerInterface=i(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var n=r.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(n),this.data.ty===0||this.data.xt?this.compInterface=d(this):this.data.ty===4?(this.layerInterface.shapeInterface=o(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=l(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var t=getBlendMode(this.data.bm),i=this.baseElement||this.layerElement;i.style["mix-blend-mode"]=t},initBaseData:function(t,i,r){this.globalData=i,this.comp=r,this.data=t,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(t,i){var r,o=this.dynamicProperties.length;for(r=0;r<o;r+=1)(i||this._isParent&&this.dynamicProperties[r].propType==="transform")&&(this.dynamicProperties[r].getValue(),this.dynamicProperties[r]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(t){this.dynamicProperties.indexOf(t)===-1&&this.dynamicProperties.push(t)}};function FootageElement(e,t,i){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.footageData=t.imageLoader.getAsset(this.assetData),this.initBaseData(e,t,i)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var t=e("footage");this.layerInterface=t(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,t,i){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.initBaseData(e,t,i),this._isPlaying=!1,this._canPlay=!1;var r=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(r),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var t=this.tm.v;this._currentTime=t}this._volume=this.lv.v[0];var i=this._volume*this._volumeMultiplier;this._previousVolume!==i&&(this._previousVolume=i,this.audio.volume(i))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var t,i=this.layers.length,r;for(this.completeLayers=!0,t=i-1;t>=0;t-=1)this.elements[t]||(r=this.layers[t],r.ip-r.st<=e-this.layers[t].st&&r.op-r.st>e-this.layers[t].st&&this.buildItem(t)),this.completeLayers=this.elements[t]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var t,i=e.length,r,o=this.layers.length;for(t=0;t<i;t+=1)for(r=0;r<o;){if(this.layers[r].id===e[t].id){this.layers[r]=e[t];break}r+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,t,i){for(var r=this.elements,o=this.layers,l=0,d=o.length;l<d;)o[l].ind==t&&(!r[l]||r[l]===!0?(this.buildItem(l),this.addPendingElement(e)):(i.push(r[l]),r[l].setAsParent(),o[l].parent!==void 0?this.buildElementParenting(e,o[l].parent,i):e.setHierarchy(i))),l+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var t,i=e.length;for(t=0;t<i;t+=1)if(e[t].xt){var r=this.createComp(e[t]);r.initExpressions(),this.globalData.projectInterface.registerComposition(r)}},BaseRenderer.prototype.getElementById=function(e){var t,i=this.elements.length;for(t=0;t<i;t+=1)if(this.elements[t].data.ind===e)return this.elements[t];return null},BaseRenderer.prototype.getElementByPath=function(e){var t=e.shift(),i;if(typeof t=="number")i=this.elements[t];else{var r,o=this.elements.length;for(r=0;r<o;r+=1)if(this.elements[r].data.nm===t){i=this.elements[r];break}}return e.length===0?i:i.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,t){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,t),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var t=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:t,localMat:t,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var t,i=this.finalTransform.mat,r=0,o=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;r<o;){if(this.hierarchy[r].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}r+=1}if(this.finalTransform._matMdf)for(t=this.finalTransform.mProp.v.props,i.cloneFromProps(t),r=0;r<o;r+=1)i.multiply(this.hierarchy[r].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var t=0,i=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;t<i;)this.localTransforms[t]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[t]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),t+=1;if(this.finalTransform._localMatMdf){var r=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(r),t=1;t<i;t+=1){var o=this.localTransforms[t].matrix;r.multiply(o)}r.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var l=this.finalTransform.localOpacity;for(t=0;t<i;t+=1)l*=this.localTransforms[t].opacity*.01;this.finalTransform.localOpacity=l}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var t=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(t.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var i=0,r=t.length;for(i=0;i<r;i+=1)this.localTransforms.push(t[i])}}},globalToLocal:function(t){var i=[];i.push(this.finalTransform);for(var r=!0,o=this.comp;r;)o.finalTransform?(o.data.hasMask&&i.splice(0,0,o.finalTransform),o=o.comp):r=!1;var l,d=i.length,n;for(l=0;l<d;l+=1)n=i[l].mat.applyToPointArray(0,0,0),t=[t[0]-n[0],t[1]-n[1],0];return t},mHelper:new Matrix};function MaskElement(e,t,i){this.data=e,this.element=t,this.globalData=i,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var r=this.globalData.defs,o,l=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(l),this.solidPath="";var d,n=this.masksProperties,S=0,C=[],I,z,$=createElementID(),k,Y,ie,ue,ne="clipPath",se="clip-path";for(o=0;o<l;o+=1)if((n[o].mode!=="a"&&n[o].mode!=="n"||n[o].inv||n[o].o.k!==100||n[o].o.x)&&(ne="mask",se="mask"),(n[o].mode==="s"||n[o].mode==="i")&&S===0?(k=createNS("rect"),k.setAttribute("fill","#ffffff"),k.setAttribute("width",this.element.comp.data.w||0),k.setAttribute("height",this.element.comp.data.h||0),C.push(k)):k=null,d=createNS("path"),n[o].mode==="n")this.viewData[o]={op:PropertyFactory.getProp(this.element,n[o].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,n[o],3),elem:d,lastPath:""},r.appendChild(d);else{S+=1,d.setAttribute("fill",n[o].mode==="s"?"#000000":"#ffffff"),d.setAttribute("clip-rule","nonzero");var le;if(n[o].x.k!==0?(ne="mask",se="mask",ue=PropertyFactory.getProp(this.element,n[o].x,0,null,this.element),le=createElementID(),Y=createNS("filter"),Y.setAttribute("id",le),ie=createNS("feMorphology"),ie.setAttribute("operator","erode"),ie.setAttribute("in","SourceGraphic"),ie.setAttribute("radius","0"),Y.appendChild(ie),r.appendChild(Y),d.setAttribute("stroke",n[o].mode==="s"?"#000000":"#ffffff")):(ie=null,ue=null),this.storedData[o]={elem:d,x:ue,expan:ie,lastPath:"",lastOperator:"",filterId:le,lastRadius:0},n[o].mode==="i"){z=C.length;var he=createNS("g");for(I=0;I<z;I+=1)he.appendChild(C[I]);var me=createNS("mask");me.setAttribute("mask-type","alpha"),me.setAttribute("id",$+"_"+S),me.appendChild(d),r.appendChild(me),he.setAttribute("mask","url("+getLocationHref()+"#"+$+"_"+S+")"),C.length=0,C.push(he)}else C.push(d);n[o].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[o]={elem:d,lastPath:"",op:PropertyFactory.getProp(this.element,n[o].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,n[o],3),invRect:k},this.viewData[o].prop.k||this.drawPath(n[o],this.viewData[o].prop.v,this.viewData[o])}for(this.maskElement=createNS(ne),l=C.length,o=0;o<l;o+=1)this.maskElement.appendChild(C[o]);S>0&&(this.maskElement.setAttribute("id",$),this.element.maskedElement.setAttribute(se,"url("+getLocationHref()+"#"+$+")"),r.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var t=this.element.finalTransform.mat,i,r=this.masksProperties.length;for(i=0;i<r;i+=1)if((this.viewData[i].prop._mdf||e)&&this.drawPath(this.masksProperties[i],this.viewData[i].prop.v,this.viewData[i]),(this.viewData[i].op._mdf||e)&&this.viewData[i].elem.setAttribute("fill-opacity",this.viewData[i].op.v),this.masksProperties[i].mode!=="n"&&(this.viewData[i].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[i].invRect.setAttribute("transform",t.getInverseMatrix().to2dCSS()),this.storedData[i].x&&(this.storedData[i].x._mdf||e))){var o=this.storedData[i].expan;this.storedData[i].x.v<0?(this.storedData[i].lastOperator!=="erode"&&(this.storedData[i].lastOperator="erode",this.storedData[i].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[i].filterId+")")),o.setAttribute("radius",-this.storedData[i].x.v)):(this.storedData[i].lastOperator!=="dilate"&&(this.storedData[i].lastOperator="dilate",this.storedData[i].elem.setAttribute("filter",null)),this.storedData[i].elem.setAttribute("stroke-width",this.storedData[i].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,t,i){var r=" M"+t.v[0][0]+","+t.v[0][1],o,l;for(l=t._length,o=1;o<l;o+=1)r+=" C"+t.o[o-1][0]+","+t.o[o-1][1]+" "+t.i[o][0]+","+t.i[o][1]+" "+t.v[o][0]+","+t.v[o][1];if(t.c&&l>1&&(r+=" C"+t.o[o-1][0]+","+t.o[o-1][1]+" "+t.i[0][0]+","+t.i[0][1]+" "+t.v[0][0]+","+t.v[0][1]),i.lastPath!==r){var d="";i.elem&&(t.c&&(d=e.inv?this.solidPath+r:r),i.elem.setAttribute("d",d)),i.lastPath=r}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=t,e.createAlphaToLuminanceFilter=i;function t(r,o){var l=createNS("filter");return l.setAttribute("id",r),o!==!0&&(l.setAttribute("filterUnits","objectBoundingBox"),l.setAttribute("x","0%"),l.setAttribute("y","0%"),l.setAttribute("width","100%"),l.setAttribute("height","100%")),l}function i(){var r=createNS("feColorMatrix");return r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),r}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var t,i="SourceGraphic",r=e.data.ef?e.data.ef.length:0,o=createElementID(),l=filtersFactory.createFilter(o,!0),d=0;this.filters=[];var n;for(t=0;t<r;t+=1){n=null;var S=e.data.ef[t].ty;if(registeredEffects$1[S]){var C=registeredEffects$1[S].effect;n=new C(l,e.effectsManager.effectElements[t],e,idPrefix+d,i),i=idPrefix+d,registeredEffects$1[S].countsAsEffect&&(d+=1)}n&&this.filters.push(n)}d&&(e.globalData.defs.appendChild(l),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+o+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var t,i=this.filters.length;for(t=0;t<i;t+=1)this.filters[t].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var t,i=this.filters.length,r=[];for(t=0;t<i;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r};function registerEffect$1(e,t,i){registeredEffects$1[e]={effect:t,countsAsEffect:i}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var t=null;if(this.data.td){this.matteMasks={};var i=createNS("g");i.setAttribute("id",this.layerId),i.appendChild(this.layerElement),t=i,this.globalData.defs.appendChild(i)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),t=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var r=createNS("clipPath"),o=createNS("path");o.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var l=createElementID();if(r.setAttribute("id",l),r.appendChild(o),this.globalData.defs.appendChild(r),this.checkMasks()){var d=createNS("g");d.setAttribute("clip-path","url("+getLocationHref()+"#"+l+")"),d.appendChild(this.layerElement),this.transformedElement=d,t?t.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+l+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(t){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[t]){var i=this.layerId+"_"+t,r,o,l,d;if(t===1||t===3){var n=createNS("mask");n.setAttribute("id",i),n.setAttribute("mask-type",t===3?"luminance":"alpha"),l=createNS("use"),l.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),n.appendChild(l),this.globalData.defs.appendChild(n),!featureSupport.maskType&&t===1&&(n.setAttribute("mask-type","luminance"),r=createElementID(),o=filtersFactory.createFilter(r),this.globalData.defs.appendChild(o),o.appendChild(filtersFactory.createAlphaToLuminanceFilter()),d=createNS("g"),d.appendChild(l),n.appendChild(d),d.setAttribute("filter","url("+getLocationHref()+"#"+r+")"))}else if(t===2){var S=createNS("mask");S.setAttribute("id",i),S.setAttribute("mask-type","alpha");var C=createNS("g");S.appendChild(C),r=createElementID(),o=filtersFactory.createFilter(r);var I=createNS("feComponentTransfer");I.setAttribute("in","SourceGraphic"),o.appendChild(I);var z=createNS("feFuncA");z.setAttribute("type","table"),z.setAttribute("tableValues","1.0 0.0"),I.appendChild(z),this.globalData.defs.appendChild(o);var $=createNS("rect");$.setAttribute("width",this.comp.data.w),$.setAttribute("height",this.comp.data.h),$.setAttribute("x","0"),$.setAttribute("y","0"),$.setAttribute("fill","#ffffff"),$.setAttribute("opacity","0"),C.setAttribute("filter","url("+getLocationHref()+"#"+r+")"),C.appendChild($),l=createNS("use"),l.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),C.appendChild(l),featureSupport.maskType||(S.setAttribute("mask-type","luminance"),o.appendChild(filtersFactory.createAlphaToLuminanceFilter()),d=createNS("g"),C.appendChild($),d.appendChild(this.layerElement),C.appendChild(d)),this.globalData.defs.appendChild(S)}this.matteMasks[t]=i}return this.matteMasks[t]},setMatte:function(t){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+t+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(t){this.hierarchy=t},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(i,r,o){this.initFrame(),this.initBaseData(i,r,o),this.initTransform(i,r,o),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var i=this.baseElement||this.layerElement;i.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var i=this.baseElement||this.layerElement;i.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(i){this._mdf=!1,this.prepareRenderableFrame(i),this.prepareProperties(i,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=t.slotManager.getProp(this.assetData)),this.initElement(e,t,i),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,t){this.elem=e,this.pos=t}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(t){var i,r=this.shapeModifiers.length;for(i=0;i<r;i+=1)this.shapeModifiers[i].addShape(t)},isShapeInAnimatedModifiers:function(t){for(var i=0,r=this.shapeModifiers.length;i<r;)if(this.shapeModifiers[i].isAnimatedWithShape(t))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var t,i=this.shapes.length;for(t=0;t<i;t+=1)this.shapes[t].sh.reset();i=this.shapeModifiers.length;var r;for(t=i-1;t>=0&&(r=this.shapeModifiers[t].processShapes(this._isFirstFrame),!r);t-=1);}},searchProcessedElement:function(t){for(var i=this.processedElements,r=0,o=i.length;r<o;){if(i[r].elem===t)return i[r].pos;r+=1}return 0},addProcessedElement:function(t,i){for(var r=this.processedElements,o=r.length;o;)if(o-=1,r[o].elem===t){r[o].pos=i;return}r.push(new ProcessedElement(t,i))},prepareFrame:function(t){this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,t,i){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=i,this.lvl=t,this._isAnimated=!!i.k;for(var r=0,o=e.length;r<o;){if(e[r].mProps.dynamicProperties.length){this._isAnimated=!0;break}r+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,t){this.data=e,this.type=e.ty,this.d="",this.lvl=t,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,t,i,r){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(t.length),this.renderer=i,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",t.length?t.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(r);var o,l=t.length||0,d;for(o=0;o<l;o+=1)d=PropertyFactory.getProp(e,t[o].v,0,0,this),this.k=d.k||this.k,this.dataProps[o]={n:t[o].n,p:d};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var t=0,i=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),t=0;t<i;t+=1)this.dataProps[t].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[t].p.v:this.dashArray[t]=this.dataProps[t].p.v:this.dashoffset[0]=this.dataProps[t].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=i,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=i}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=i}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,t,i){this.data=t,this.c=createTypedArray("uint8c",t.p*4);var r=t.k.k[0].s?t.k.k[0].s.length-t.p*4:t.k.k.length-t.p*4;this.o=createTypedArray("float32",r),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=r,this.initDynamicPropertyContainer(i),this.prop=PropertyFactory.getProp(e,t.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,t){for(var i=0,r=this.o.length/2,o;i<r;){if(o=Math.abs(e[i*4]-e[t*4+i*2]),o>.01)return!1;i+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,t=this.data.k.k.length;e<t;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var t,i=this.data.p*4,r,o;for(t=0;t<i;t+=1)r=t%4===0?100:255,o=Math.round(this.prop.v[t]*r),this.c[t]!==o&&(this.c[t]=o,this._cmdf=!e);if(this.o.length)for(i=this.prop.v.length,t=this.data.p*4;t<i;t+=1)r=t%2===0?100:1,o=t%2===0?Math.round(this.prop.v[t]*100):this.prop.v[t],this.o[t-this.data.p*4]!==o&&(this.o[t-this.data.p*4]=o,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,t,i)}SVGGradientFillStyleData.prototype.initGradientData=function(e,t,i){this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.s=PropertyFactory.getProp(e,t.s,1,null,this),this.e=PropertyFactory.getProp(e,t.e,1,null,this),this.h=PropertyFactory.getProp(e,t.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,t.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,t.g,this),this.style=i,this.stops=[],this.setGradientData(i.pElem,t),this.setGradientOpacity(t,i),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,t){var i=createElementID(),r=createNS(t.t===1?"linearGradient":"radialGradient");r.setAttribute("id",i),r.setAttribute("spreadMethod","pad"),r.setAttribute("gradientUnits","userSpaceOnUse");var o=[],l,d,n;for(n=t.g.p*4,d=0;d<n;d+=4)l=createNS("stop"),r.appendChild(l),o.push(l);e.setAttribute(t.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+i+")"),this.gf=r,this.cst=o},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,t){if(this.g._hasOpacity&&!this.g._collapsable){var i,r,o,l=createNS("mask"),d=createNS("path");l.appendChild(d);var n=createElementID(),S=createElementID();l.setAttribute("id",S);var C=createNS(e.t===1?"linearGradient":"radialGradient");C.setAttribute("id",n),C.setAttribute("spreadMethod","pad"),C.setAttribute("gradientUnits","userSpaceOnUse"),o=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var I=this.stops;for(r=e.g.p*4;r<o;r+=2)i=createNS("stop"),i.setAttribute("stop-color","rgb(255,255,255)"),C.appendChild(i),I.push(i);d.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+n+")"),e.ty==="gs"&&(d.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),d.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&d.setAttribute("stroke-miterlimit",e.ml)),this.of=C,this.ms=l,this.ost=I,this.maskId=S,t.msElem=d}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.initGradientData(e,t,i),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,t,i){this.transform={mProps:e,op:t,container:i},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(t,i,r,o){if(i===0)return"";var l=t.o,d=t.i,n=t.v,S,C=" M"+o.applyToPointStringified(n[0][0],n[0][1]);for(S=1;S<i;S+=1)C+=" C"+o.applyToPointStringified(l[S-1][0],l[S-1][1])+" "+o.applyToPointStringified(d[S][0],d[S][1])+" "+o.applyToPointStringified(n[S][0],n[S][1]);return r&&i&&(C+=" C"+o.applyToPointStringified(l[S-1][0],l[S-1][1])+" "+o.applyToPointStringified(d[0][0],d[0][1])+" "+o.applyToPointStringified(n[0][0],n[0][1]),C+="z"),C},SVGElementsRenderer=function(){var e=new Matrix,t=new Matrix,i={createRenderFunction:r};function r(z){switch(z.ty){case"fl":return n;case"gf":return C;case"gs":return S;case"st":return I;case"sh":case"el":case"rc":case"sr":return d;case"tr":return o;case"no":return l;default:return null}}function o(z,$,k){(k||$.transform.op._mdf)&&$.transform.container.setAttribute("opacity",$.transform.op.v),(k||$.transform.mProps._mdf)&&$.transform.container.setAttribute("transform",$.transform.mProps.v.to2dCSS())}function l(){}function d(z,$,k){var Y,ie,ue,ne,se,le,he=$.styles.length,me=$.lvl,ge,xt,Et,Lt;for(le=0;le<he;le+=1){if(ne=$.sh._mdf||k,$.styles[le].lvl<me){for(xt=t.reset(),Et=me-$.styles[le].lvl,Lt=$.transformers.length-1;!ne&&Et>0;)ne=$.transformers[Lt].mProps._mdf||ne,Et-=1,Lt-=1;if(ne)for(Et=me-$.styles[le].lvl,Lt=$.transformers.length-1;Et>0;)xt.multiply($.transformers[Lt].mProps.v),Et-=1,Lt-=1}else xt=e;if(ge=$.sh.paths,ie=ge._length,ne){for(ue="",Y=0;Y<ie;Y+=1)se=ge.shapes[Y],se&&se._length&&(ue+=buildShapeString(se,se._length,se.c,xt));$.caches[le]=ue}else ue=$.caches[le];$.styles[le].d+=z.hd===!0?"":ue,$.styles[le]._mdf=ne||$.styles[le]._mdf}}function n(z,$,k){var Y=$.style;($.c._mdf||k)&&Y.pElem.setAttribute("fill","rgb("+bmFloor($.c.v[0])+","+bmFloor($.c.v[1])+","+bmFloor($.c.v[2])+")"),($.o._mdf||k)&&Y.pElem.setAttribute("fill-opacity",$.o.v)}function S(z,$,k){C(z,$,k),I(z,$,k)}function C(z,$,k){var Y=$.gf,ie=$.g._hasOpacity,ue=$.s.v,ne=$.e.v;if($.o._mdf||k){var se=z.ty==="gf"?"fill-opacity":"stroke-opacity";$.style.pElem.setAttribute(se,$.o.v)}if($.s._mdf||k){var le=z.t===1?"x1":"cx",he=le==="x1"?"y1":"cy";Y.setAttribute(le,ue[0]),Y.setAttribute(he,ue[1]),ie&&!$.g._collapsable&&($.of.setAttribute(le,ue[0]),$.of.setAttribute(he,ue[1]))}var me,ge,xt,Et;if($.g._cmdf||k){me=$.cst;var Lt=$.g.c;for(xt=me.length,ge=0;ge<xt;ge+=1)Et=me[ge],Et.setAttribute("offset",Lt[ge*4]+"%"),Et.setAttribute("stop-color","rgb("+Lt[ge*4+1]+","+Lt[ge*4+2]+","+Lt[ge*4+3]+")")}if(ie&&($.g._omdf||k)){var Zt=$.g.o;for($.g._collapsable?me=$.cst:me=$.ost,xt=me.length,ge=0;ge<xt;ge+=1)Et=me[ge],$.g._collapsable||Et.setAttribute("offset",Zt[ge*2]+"%"),Et.setAttribute("stop-opacity",Zt[ge*2+1])}if(z.t===1)($.e._mdf||k)&&(Y.setAttribute("x2",ne[0]),Y.setAttribute("y2",ne[1]),ie&&!$.g._collapsable&&($.of.setAttribute("x2",ne[0]),$.of.setAttribute("y2",ne[1])));else{var Ht;if(($.s._mdf||$.e._mdf||k)&&(Ht=Math.sqrt(Math.pow(ue[0]-ne[0],2)+Math.pow(ue[1]-ne[1],2)),Y.setAttribute("r",Ht),ie&&!$.g._collapsable&&$.of.setAttribute("r",Ht)),$.s._mdf||$.e._mdf||$.h._mdf||$.a._mdf||k){Ht||(Ht=Math.sqrt(Math.pow(ue[0]-ne[0],2)+Math.pow(ue[1]-ne[1],2)));var It=Math.atan2(ne[1]-ue[1],ne[0]-ue[0]),Yt=$.h.v;Yt>=1?Yt=.99:Yt<=-1&&(Yt=-.99);var ri=Ht*Yt,ei=Math.cos(It+$.a.v)*ri+ue[0],Ct=Math.sin(It+$.a.v)*ri+ue[1];Y.setAttribute("fx",ei),Y.setAttribute("fy",Ct),ie&&!$.g._collapsable&&($.of.setAttribute("fx",ei),$.of.setAttribute("fy",Ct))}}}function I(z,$,k){var Y=$.style,ie=$.d;ie&&(ie._mdf||k)&&ie.dashStr&&(Y.pElem.setAttribute("stroke-dasharray",ie.dashStr),Y.pElem.setAttribute("stroke-dashoffset",ie.dashoffset[0])),$.c&&($.c._mdf||k)&&Y.pElem.setAttribute("stroke","rgb("+bmFloor($.c.v[0])+","+bmFloor($.c.v[1])+","+bmFloor($.c.v[2])+")"),($.o._mdf||k)&&Y.pElem.setAttribute("stroke-opacity",$.o.v),($.w._mdf||k)&&(Y.pElem.setAttribute("stroke-width",$.w.v),Y.msElem&&Y.msElem.setAttribute("stroke-width",$.w.v))}return i}();function SVGShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,t,i),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,t=this.shapes.length,i,r,o=this.stylesList.length,l,d=[],n=!1;for(r=0;r<o;r+=1){for(l=this.stylesList[r],n=!1,d.length=0,e=0;e<t;e+=1)i=this.shapes[e],i.styles.indexOf(l)!==-1&&(d.push(i),n=i._isAnimated||n);d.length>1&&n&&this.setShapesAsAnimated(d)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,t){var i,r=new SVGStyleData(e,t),o=r.pElem;if(e.ty==="st")i=new SVGStrokeStyleData(this,e,r);else if(e.ty==="fl")i=new SVGFillStyleData(this,e,r);else if(e.ty==="gf"||e.ty==="gs"){var l=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;i=new l(this,e,r),this.globalData.defs.appendChild(i.gf),i.maskId&&(this.globalData.defs.appendChild(i.ms),this.globalData.defs.appendChild(i.of),o.setAttribute("mask","url("+getLocationHref()+"#"+i.maskId+")"))}else e.ty==="no"&&(i=new SVGNoStyleData(this,e,r));return(e.ty==="st"||e.ty==="gs")&&(o.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),o.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),o.setAttribute("fill-opacity","0"),e.lj===1&&o.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&o.setAttribute("fill-rule","evenodd"),e.ln&&o.setAttribute("id",e.ln),e.cl&&o.setAttribute("class",e.cl),e.bm&&(o.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(r),this.addToAnimatedContents(e,i),i},SVGShapeElement.prototype.createGroupElement=function(e){var t=new ShapeGroupData;return e.ln&&t.gr.setAttribute("id",e.ln),e.cl&&t.gr.setAttribute("class",e.cl),e.bm&&(t.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),t},SVGShapeElement.prototype.createTransformElement=function(e,t){var i=TransformPropertyFactory.getTransformProperty(this,e,this),r=new SVGTransformData(i,i.o,t);return this.addToAnimatedContents(e,r),r},SVGShapeElement.prototype.createShapeElement=function(e,t,i){var r=4;e.ty==="rc"?r=5:e.ty==="el"?r=6:e.ty==="sr"&&(r=7);var o=ShapePropertyFactory.getShapeProp(this,e,r,this),l=new SVGShapeData(t,i,o);return this.shapes.push(l),this.addShapeToModifiers(l),this.addToAnimatedContents(e,l),l},SVGShapeElement.prototype.addToAnimatedContents=function(e,t){for(var i=0,r=this.animatedContents.length;i<r;){if(this.animatedContents[i].element===t)return;i+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:t,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var t=e.styles,i,r=this.stylesList.length;for(i=0;i<r;i+=1)t.indexOf(this.stylesList[i])===-1&&!this.stylesList[i].closed&&t.push(this.stylesList[i])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,t,i,r,o,l,d){var n=[].concat(l),S,C=e.length-1,I,z,$=[],k=[],Y,ie,ue;for(S=C;S>=0;S-=1){if(ue=this.searchProcessedElement(e[S]),ue?t[S]=i[ue-1]:e[S]._render=d,e[S].ty==="fl"||e[S].ty==="st"||e[S].ty==="gf"||e[S].ty==="gs"||e[S].ty==="no")ue?t[S].style.closed=e[S].hd:t[S]=this.createStyleElement(e[S],o),e[S]._render&&t[S].style.pElem.parentNode!==r&&r.appendChild(t[S].style.pElem),$.push(t[S].style);else if(e[S].ty==="gr"){if(!ue)t[S]=this.createGroupElement(e[S]);else for(z=t[S].it.length,I=0;I<z;I+=1)t[S].prevViewData[I]=t[S].it[I];this.searchShapes(e[S].it,t[S].it,t[S].prevViewData,t[S].gr,o+1,n,d),e[S]._render&&t[S].gr.parentNode!==r&&r.appendChild(t[S].gr)}else e[S].ty==="tr"?(ue||(t[S]=this.createTransformElement(e[S],r)),Y=t[S].transform,n.push(Y)):e[S].ty==="sh"||e[S].ty==="rc"||e[S].ty==="el"||e[S].ty==="sr"?(ue||(t[S]=this.createShapeElement(e[S],n,o)),this.setElementStyles(t[S])):e[S].ty==="tm"||e[S].ty==="rd"||e[S].ty==="ms"||e[S].ty==="pb"||e[S].ty==="zz"||e[S].ty==="op"?(ue?(ie=t[S],ie.closed=!1):(ie=ShapeModifiers.getModifier(e[S].ty),ie.init(this,e[S]),t[S]=ie,this.shapeModifiers.push(ie)),k.push(ie)):e[S].ty==="rp"&&(ue?(ie=t[S],ie.closed=!0):(ie=ShapeModifiers.getModifier(e[S].ty),t[S]=ie,ie.init(this,e,S,t),this.shapeModifiers.push(ie),d=!1),k.push(ie));this.addProcessedElement(e[S],S+1)}for(C=$.length,S=0;S<C;S+=1)$[S].closed=!0;for(C=k.length,S=0;S<C;S+=1)k[S].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<t;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,t=this.animatedContents.length,i;for(e=0;e<t;e+=1)i=this.animatedContents[e],(this._isFirstFrame||i.element._isAnimated)&&i.data!==!0&&i.fn(i.data,i.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,t,i,r,o,l){this.o=e,this.sw=t,this.sc=i,this.fc=r,this.m=o,this.p=l,this._mdf={o:!0,sw:!!t,sc:!!i,fc:!!r,m:!0,p:!0}}LetterProps.prototype.update=function(e,t,i,r,o,l){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var d=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,d=!0),this.sw!==t&&(this.sw=t,this._mdf.sw=!0,d=!0),this.sc!==i&&(this.sc=i,this._mdf.sc=!0,d=!0),this.fc!==r&&(this.fc=r,this._mdf.fc=!0,d=!0),this.m!==o&&(this.m=o,this._mdf.m=!0,d=!0),l.length&&(this.p[0]!==l[0]||this.p[1]!==l[1]||this.p[4]!==l[4]||this.p[5]!==l[5]||this.p[12]!==l[12]||this.p[13]!==l[13])&&(this.p=l,this._mdf.p=!0,d=!0),d};function TextProperty(e,t){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,t.d&&t.d.sid&&(t.d=e.globalData.slotManager.getProp(t.d)),this.data=t,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var t=this.currentData,i=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var r,o=this.effectsSequence.length,l=e||this.data.d.k[this.keysIndex].s;for(r=0;r<o;r+=1)i!==this.keysIndex?l=this.effectsSequence[r](l,l.t):l=this.effectsSequence[r](this.currentData,l.t);t!==l&&this.setCurrentData(l),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,t=this.elem.comp.renderedFrame,i=0,r=e.length;i<=r-1&&!(i===r-1||e[i+1].t>t);)i+=1;return this.keysIndex!==i&&(this.keysIndex=i),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var t=[],i=0,r=e.length,o,l,d=!1,n=!1,S="";i<r;)d=n,n=!1,o=e.charCodeAt(i),S=e.charAt(i),FontManager.isCombinedCharacter(o)?d=!0:o>=55296&&o<=56319?FontManager.isRegionalFlag(e,i)?S=e.substr(i,14):(l=e.charCodeAt(i+1),l>=56320&&l<=57343&&(FontManager.isModifier(o,l)?(S=e.substr(i,2),d=!0):FontManager.isFlagEmoji(e.substr(i,4))?S=e.substr(i,4):S=e.substr(i,2))):o>56319?(l=e.charCodeAt(i+1),FontManager.isVariationSelector(o)&&(d=!0)):FontManager.isZeroWidthJoiner(o)&&(d=!0,n=!0),d?(t[t.length-1]+=S,d=!1):t.push(S),i+=S.length;return t},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var t=this.elem.globalData.fontManager,i=this.data,r=[],o,l,d,n=0,S,C=i.m.g,I=0,z=0,$=0,k=[],Y=0,ie=0,ue,ne,se=t.getFontByName(e.f),le,he=0,me=getFontProperties(se);e.fWeight=me.weight,e.fStyle=me.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),l=e.finalText.length,e.finalLineHeight=e.lh;var ge=e.tr/1e3*e.finalSize,xt;if(e.sz)for(var Et=!0,Lt=e.sz[0],Zt=e.sz[1],Ht,It;Et;){It=this.buildFinalText(e.t),Ht=0,Y=0,l=It.length,ge=e.tr/1e3*e.finalSize;var Yt=-1;for(o=0;o<l;o+=1)xt=It[o].charCodeAt(0),d=!1,It[o]===" "?Yt=o:(xt===13||xt===3)&&(Y=0,d=!0,Ht+=e.finalLineHeight||e.finalSize*1.2),t.chars?(le=t.getCharData(It[o],se.fStyle,se.fFamily),he=d?0:le.w*e.finalSize/100):he=t.measureText(It[o],e.f,e.finalSize),Y+he>Lt&&It[o]!==" "?(Yt===-1?l+=1:o=Yt,Ht+=e.finalLineHeight||e.finalSize*1.2,It.splice(o,Yt===o?1:0,"\r"),Yt=-1,Y=0):(Y+=he,Y+=ge);Ht+=se.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&Zt<Ht?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=It,l=e.finalText.length,Et=!1)}Y=-ge,he=0;var ri=0,ei;for(o=0;o<l;o+=1)if(d=!1,ei=e.finalText[o],xt=ei.charCodeAt(0),xt===13||xt===3?(ri=0,k.push(Y),ie=Y>ie?Y:ie,Y=-2*ge,S="",d=!0,$+=1):S=ei,t.chars?(le=t.getCharData(ei,se.fStyle,t.getFontByName(e.f).fFamily),he=d?0:le.w*e.finalSize/100):he=t.measureText(S,e.f,e.finalSize),ei===" "?ri+=he+ge:(Y+=he+ge+ri,ri=0),r.push({l:he,an:he,add:I,n:d,anIndexes:[],val:S,line:$,animatorJustifyOffset:0}),C==2){if(I+=he,S===""||S===" "||o===l-1){for((S===""||S===" ")&&(I-=he);z<=o;)r[z].an=I,r[z].ind=n,r[z].extra=he,z+=1;n+=1,I=0}}else if(C==3){if(I+=he,S===""||o===l-1){for(S===""&&(I-=he);z<=o;)r[z].an=I,r[z].ind=n,r[z].extra=he,z+=1;I=0,n+=1}}else r[n].ind=n,r[n].extra=0,n+=1;if(e.l=r,ie=Y>ie?Y:ie,k.push(Y),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=ie,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=k;var Ct=i.a,Ut,Mt;ne=Ct.length;var $t,jt,mi=[];for(ue=0;ue<ne;ue+=1){for(Ut=Ct[ue],Ut.a.sc&&(e.strokeColorAnim=!0),Ut.a.sw&&(e.strokeWidthAnim=!0),(Ut.a.fc||Ut.a.fh||Ut.a.fs||Ut.a.fb)&&(e.fillColorAnim=!0),jt=0,$t=Ut.s.b,o=0;o<l;o+=1)Mt=r[o],Mt.anIndexes[ue]=jt,($t==1&&Mt.val!==""||$t==2&&Mt.val!==""&&Mt.val!==" "||$t==3&&(Mt.n||Mt.val==" "||o==l-1)||$t==4&&(Mt.n||o==l-1))&&(Ut.s.rn===1&&mi.push(jt),jt+=1);i.a[ue].s.totalChars=jt;var Xi=-1,Er;if(Ut.s.rn===1)for(o=0;o<l;o+=1)Mt=r[o],Xi!=Mt.anIndexes[ue]&&(Xi=Mt.anIndexes[ue],Er=mi.splice(Math.floor(Math.random()*mi.length),1)[0]),Mt.anIndexes[ue]=Er}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=se.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,t){t=t===void 0?this.keysIndex:t;var i=this.copyData({},this.data.d.k[t].s);i=this.copyData(i,e),this.data.d.k[t].s=i,this.recalculate(t),this.setCurrentData(i),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var t=this.data.d.k[e].s;t.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(t)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,t=Math.min,i=Math.floor;function r(l,d){this._currentTextLength=-1,this.k=!1,this.data=d,this.elem=l,this.comp=l.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(l),this.s=PropertyFactory.getProp(l,d.s||{k:0},0,0,this),"e"in d?this.e=PropertyFactory.getProp(l,d.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(l,d.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(l,d.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(l,d.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(l,d.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(l,d.a,0,.01,this),this.dynamicProperties.length||this.getValue()}r.prototype={getMult:function(d){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var n=0,S=0,C=1,I=1;this.ne.v>0?n=this.ne.v/100:S=-this.ne.v/100,this.xe.v>0?C=1-this.xe.v/100:I=1+this.xe.v/100;var z=BezierFactory.getBezierEasing(n,S,C,I).get,$=0,k=this.finalS,Y=this.finalE,ie=this.data.sh;if(ie===2)Y===k?$=d>=Y?1:0:$=e(0,t(.5/(Y-k)+(d-k)/(Y-k),1)),$=z($);else if(ie===3)Y===k?$=d>=Y?0:1:$=1-e(0,t(.5/(Y-k)+(d-k)/(Y-k),1)),$=z($);else if(ie===4)Y===k?$=0:($=e(0,t(.5/(Y-k)+(d-k)/(Y-k),1)),$<.5?$*=2:$=1-2*($-.5)),$=z($);else if(ie===5){if(Y===k)$=0;else{var ue=Y-k;d=t(e(0,d+.5-k),Y-k);var ne=-ue/2+d,se=ue/2;$=Math.sqrt(1-ne*ne/(se*se))}$=z($)}else ie===6?(Y===k?$=0:(d=t(e(0,d+.5-k),Y-k),$=(1+Math.cos(Math.PI+Math.PI*2*d/(Y-k)))/2),$=z($)):(d>=i(k)&&(d-k<0?$=e(0,t(t(Y,1)-(k-d),1)):$=e(0,t(Y-d,1))),$=z($));if(this.sm.v!==100){var le=this.sm.v*.01;le===0&&(le=1e-8);var he=.5-le*.5;$<he?$=0:($=($-he)/le,$>1&&($=1))}return $*this.a.v},getValue:function(d){this.iterateDynamicProperties(),this._mdf=d||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,d&&this.data.r===2&&(this.e.v=this._currentTextLength);var n=this.data.r===2?1:100/this.data.totalChars,S=this.o.v/n,C=this.s.v/n+S,I=this.e.v/n+S;if(C>I){var z=C;C=I,I=z}this.finalS=C,this.finalE=I}},extendPrototype([DynamicPropertyContainer],r);function o(l,d,n){return new r(l,d)}return{getTextSelectorProp:o}}();function TextAnimatorDataProperty(e,t,i){var r={propType:!1},o=PropertyFactory.getProp,l=t.a;this.a={r:l.r?o(e,l.r,0,degToRads,i):r,rx:l.rx?o(e,l.rx,0,degToRads,i):r,ry:l.ry?o(e,l.ry,0,degToRads,i):r,sk:l.sk?o(e,l.sk,0,degToRads,i):r,sa:l.sa?o(e,l.sa,0,degToRads,i):r,s:l.s?o(e,l.s,1,.01,i):r,a:l.a?o(e,l.a,1,0,i):r,o:l.o?o(e,l.o,0,.01,i):r,p:l.p?o(e,l.p,1,0,i):r,sw:l.sw?o(e,l.sw,0,0,i):r,sc:l.sc?o(e,l.sc,1,0,i):r,fc:l.fc?o(e,l.fc,1,0,i):r,fh:l.fh?o(e,l.fh,0,0,i):r,fs:l.fs?o(e,l.fs,0,.01,i):r,fb:l.fb?o(e,l.fb,0,.01,i):r,t:l.t?o(e,l.t,0,0,i):r},this.s=TextSelectorProp.getTextSelectorProp(e,t.s,i),this.s.t=t.s.t}function TextAnimatorProperty(e,t,i){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=t,this._elem=i,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(i)}TextAnimatorProperty.prototype.searchProperties=function(){var e,t=this._textData.a.length,i,r=PropertyFactory.getProp;for(e=0;e<t;e+=1)i=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,i,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:r(this._elem,this._textData.p.a,0,0,this),f:r(this._elem,this._textData.p.f,0,0,this),l:r(this._elem,this._textData.p.l,0,0,this),r:r(this._elem,this._textData.p.r,0,0,this),p:r(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=r(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,t){if(this.lettersChangedFlag=t,!(!this._mdf&&!this._isFirstFrame&&!t&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var i=this._moreOptions.alignment.v,r=this._animatorsData,o=this._textData,l=this.mHelper,d=this._renderType,n=this.renderedLetters.length,S,C,I,z,$=e.l,k,Y,ie,ue,ne,se,le,he,me,ge,xt,Et,Lt,Zt,Ht;if(this._hasMaskedPath){if(Ht=this._pathData.m,!this._pathData.n||this._pathData._mdf){var It=Ht.v;this._pathData.r.v&&(It=It.reverse()),k={tLength:0,segments:[]},z=It._length-1;var Yt;for(Et=0,I=0;I<z;I+=1)Yt=bez.buildBezierData(It.v[I],It.v[I+1],[It.o[I][0]-It.v[I][0],It.o[I][1]-It.v[I][1]],[It.i[I+1][0]-It.v[I+1][0],It.i[I+1][1]-It.v[I+1][1]]),k.tLength+=Yt.segmentLength,k.segments.push(Yt),Et+=Yt.segmentLength;I=z,Ht.v.c&&(Yt=bez.buildBezierData(It.v[I],It.v[0],[It.o[I][0]-It.v[I][0],It.o[I][1]-It.v[I][1]],[It.i[0][0]-It.v[0][0],It.i[0][1]-It.v[0][1]]),k.tLength+=Yt.segmentLength,k.segments.push(Yt),Et+=Yt.segmentLength),this._pathData.pi=k}if(k=this._pathData.pi,Y=this._pathData.f.v,le=0,se=1,ue=0,ne=!0,ge=k.segments,Y<0&&Ht.v.c)for(k.tLength<Math.abs(Y)&&(Y=-Math.abs(Y)%k.tLength),le=ge.length-1,me=ge[le].points,se=me.length-1;Y<0;)Y+=me[se].partialLength,se-=1,se<0&&(le-=1,me=ge[le].points,se=me.length-1);me=ge[le].points,he=me[se-1],ie=me[se],xt=ie.partialLength}z=$.length,S=0,C=0;var ri=e.finalSize*1.2*.714,ei=!0,Ct,Ut,Mt,$t,jt;$t=r.length;var mi,Xi=-1,Er,Ir,nr,si=Y,Gt=le,ui=se,oi=-1,Si,Li,Mi,kt,Nt,gi,Ri,Rt,Xt="",Hi=this.defaultPropsArray,Ni;if(e.j===2||e.j===1){var xi=0,$i=0,fr=e.j===2?-.5:-1,ir=0,lr=!0;for(I=0;I<z;I+=1)if($[I].n){for(xi&&(xi+=$i);ir<I;)$[ir].animatorJustifyOffset=xi,ir+=1;xi=0,lr=!0}else{for(Mt=0;Mt<$t;Mt+=1)Ct=r[Mt].a,Ct.t.propType&&(lr&&e.j===2&&($i+=Ct.t.v*fr),Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),mi.length?xi+=Ct.t.v*mi[0]*fr:xi+=Ct.t.v*mi*fr);lr=!1}for(xi&&(xi+=$i);ir<I;)$[ir].animatorJustifyOffset=xi,ir+=1}for(I=0;I<z;I+=1){if(l.reset(),Si=1,$[I].n)S=0,C+=e.yOffset,C+=ei?1:0,Y=si,ei=!1,this._hasMaskedPath&&(le=Gt,se=ui,me=ge[le].points,he=me[se-1],ie=me[se],xt=ie.partialLength,ue=0),Xt="",Rt="",gi="",Ni="",Hi=this.defaultPropsArray;else{if(this._hasMaskedPath){if(oi!==$[I].line){switch(e.j){case 1:Y+=Et-e.lineWidths[$[I].line];break;case 2:Y+=(Et-e.lineWidths[$[I].line])/2;break}oi=$[I].line}Xi!==$[I].ind&&($[Xi]&&(Y+=$[Xi].extra),Y+=$[I].an/2,Xi=$[I].ind),Y+=i[0]*$[I].an*.005;var Tr=0;for(Mt=0;Mt<$t;Mt+=1)Ct=r[Mt].a,Ct.p.propType&&(Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),mi.length?Tr+=Ct.p.v[0]*mi[0]:Tr+=Ct.p.v[0]*mi),Ct.a.propType&&(Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),mi.length?Tr+=Ct.a.v[0]*mi[0]:Tr+=Ct.a.v[0]*mi);for(ne=!0,this._pathData.a.v&&(Y=$[0].an*.5+(Et-this._pathData.f.v-$[0].an*.5-$[$.length-1].an*.5)*Xi/(z-1),Y+=this._pathData.f.v);ne;)ue+xt>=Y+Tr||!me?(Lt=(Y+Tr-ue)/ie.partialLength,Ir=he.point[0]+(ie.point[0]-he.point[0])*Lt,nr=he.point[1]+(ie.point[1]-he.point[1])*Lt,l.translate(-i[0]*$[I].an*.005,-(i[1]*ri)*.01),ne=!1):me&&(ue+=ie.partialLength,se+=1,se>=me.length&&(se=0,le+=1,ge[le]?me=ge[le].points:Ht.v.c?(se=0,le=0,me=ge[le].points):(ue-=ie.partialLength,me=null)),me&&(he=ie,ie=me[se],xt=ie.partialLength));Er=$[I].an/2-$[I].add,l.translate(-Er,0,0)}else Er=$[I].an/2-$[I].add,l.translate(-Er,0,0),l.translate(-i[0]*$[I].an*.005,-i[1]*ri*.01,0);for(Mt=0;Mt<$t;Mt+=1)Ct=r[Mt].a,Ct.t.propType&&(Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),(S!==0||e.j!==0)&&(this._hasMaskedPath?mi.length?Y+=Ct.t.v*mi[0]:Y+=Ct.t.v*mi:mi.length?S+=Ct.t.v*mi[0]:S+=Ct.t.v*mi));for(e.strokeWidthAnim&&(Mi=e.sw||0),e.strokeColorAnim&&(e.sc?Li=[e.sc[0],e.sc[1],e.sc[2]]:Li=[0,0,0]),e.fillColorAnim&&e.fc&&(kt=[e.fc[0],e.fc[1],e.fc[2]]),Mt=0;Mt<$t;Mt+=1)Ct=r[Mt].a,Ct.a.propType&&(Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),mi.length?l.translate(-Ct.a.v[0]*mi[0],-Ct.a.v[1]*mi[1],Ct.a.v[2]*mi[2]):l.translate(-Ct.a.v[0]*mi,-Ct.a.v[1]*mi,Ct.a.v[2]*mi));for(Mt=0;Mt<$t;Mt+=1)Ct=r[Mt].a,Ct.s.propType&&(Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),mi.length?l.scale(1+(Ct.s.v[0]-1)*mi[0],1+(Ct.s.v[1]-1)*mi[1],1):l.scale(1+(Ct.s.v[0]-1)*mi,1+(Ct.s.v[1]-1)*mi,1));for(Mt=0;Mt<$t;Mt+=1){if(Ct=r[Mt].a,Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),Ct.sk.propType&&(mi.length?l.skewFromAxis(-Ct.sk.v*mi[0],Ct.sa.v*mi[1]):l.skewFromAxis(-Ct.sk.v*mi,Ct.sa.v*mi)),Ct.r.propType&&(mi.length?l.rotateZ(-Ct.r.v*mi[2]):l.rotateZ(-Ct.r.v*mi)),Ct.ry.propType&&(mi.length?l.rotateY(Ct.ry.v*mi[1]):l.rotateY(Ct.ry.v*mi)),Ct.rx.propType&&(mi.length?l.rotateX(Ct.rx.v*mi[0]):l.rotateX(Ct.rx.v*mi)),Ct.o.propType&&(mi.length?Si+=(Ct.o.v*mi[0]-Si)*mi[0]:Si+=(Ct.o.v*mi-Si)*mi),e.strokeWidthAnim&&Ct.sw.propType&&(mi.length?Mi+=Ct.sw.v*mi[0]:Mi+=Ct.sw.v*mi),e.strokeColorAnim&&Ct.sc.propType)for(Nt=0;Nt<3;Nt+=1)mi.length?Li[Nt]+=(Ct.sc.v[Nt]-Li[Nt])*mi[0]:Li[Nt]+=(Ct.sc.v[Nt]-Li[Nt])*mi;if(e.fillColorAnim&&e.fc){if(Ct.fc.propType)for(Nt=0;Nt<3;Nt+=1)mi.length?kt[Nt]+=(Ct.fc.v[Nt]-kt[Nt])*mi[0]:kt[Nt]+=(Ct.fc.v[Nt]-kt[Nt])*mi;Ct.fh.propType&&(mi.length?kt=addHueToRGB(kt,Ct.fh.v*mi[0]):kt=addHueToRGB(kt,Ct.fh.v*mi)),Ct.fs.propType&&(mi.length?kt=addSaturationToRGB(kt,Ct.fs.v*mi[0]):kt=addSaturationToRGB(kt,Ct.fs.v*mi)),Ct.fb.propType&&(mi.length?kt=addBrightnessToRGB(kt,Ct.fb.v*mi[0]):kt=addBrightnessToRGB(kt,Ct.fb.v*mi))}}for(Mt=0;Mt<$t;Mt+=1)Ct=r[Mt].a,Ct.p.propType&&(Ut=r[Mt].s,mi=Ut.getMult($[I].anIndexes[Mt],o.a[Mt].s.totalChars),this._hasMaskedPath?mi.length?l.translate(0,Ct.p.v[1]*mi[0],-Ct.p.v[2]*mi[1]):l.translate(0,Ct.p.v[1]*mi,-Ct.p.v[2]*mi):mi.length?l.translate(Ct.p.v[0]*mi[0],Ct.p.v[1]*mi[1],-Ct.p.v[2]*mi[2]):l.translate(Ct.p.v[0]*mi,Ct.p.v[1]*mi,-Ct.p.v[2]*mi));if(e.strokeWidthAnim&&(gi=Mi<0?0:Mi),e.strokeColorAnim&&(Ri="rgb("+Math.round(Li[0]*255)+","+Math.round(Li[1]*255)+","+Math.round(Li[2]*255)+")"),e.fillColorAnim&&e.fc&&(Rt="rgb("+Math.round(kt[0]*255)+","+Math.round(kt[1]*255)+","+Math.round(kt[2]*255)+")"),this._hasMaskedPath){if(l.translate(0,-e.ls),l.translate(0,i[1]*ri*.01+C,0),this._pathData.p.v){Zt=(ie.point[1]-he.point[1])/(ie.point[0]-he.point[0]);var Rr=Math.atan(Zt)*180/Math.PI;ie.point[0]<he.point[0]&&(Rr+=180),l.rotate(-Rr*Math.PI/180)}l.translate(Ir,nr,0),Y-=i[0]*$[I].an*.005,$[I+1]&&Xi!==$[I+1].ind&&(Y+=$[I].an/2,Y+=e.tr*.001*e.finalSize)}else{switch(l.translate(S,C,0),e.ps&&l.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:l.translate($[I].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[$[I].line]),0,0);break;case 2:l.translate($[I].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[$[I].line])/2,0,0);break}l.translate(0,-e.ls),l.translate(Er,0,0),l.translate(i[0]*$[I].an*.005,i[1]*ri*.01,0),S+=$[I].l+e.tr*.001*e.finalSize}d==="html"?Xt=l.toCSS():d==="svg"?Xt=l.to2dCSS():Hi=[l.props[0],l.props[1],l.props[2],l.props[3],l.props[4],l.props[5],l.props[6],l.props[7],l.props[8],l.props[9],l.props[10],l.props[11],l.props[12],l.props[13],l.props[14],l.props[15]],Ni=Si}n<=I?(jt=new LetterProps(Ni,gi,Ri,Rt,Xt,Hi),this.renderedLetters.push(jt),n+=1,this.lettersChangedFlag=!0):(jt=this.renderedLetters[I],this.lettersChangedFlag=jt.update(Ni,gi,Ri,Rt,Xt,Hi)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,t,i){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,t,i),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,t,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,t){var i,r=t.length,o,l="";for(i=0;i<r;i+=1)t[i].ty==="sh"&&(o=t[i].ks.k,l+=buildShapeString(o,o.i.length,!0,e));return l},ITextElement.prototype.updateDocumentData=function(e,t){this.textProperty.updateDocumentData(e,t)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,t,i,r,o){switch(e.ps&&t.translate(e.ps[0],e.ps[1]+e.ascent,0),t.translate(0,-e.ls,0),e.j){case 1:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[i]),0,0);break;case 2:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[i])/2,0,0);break}t.translate(r,o,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,t,i){this.textSpans=[],this.renderType="svg",this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var t=0,i=e.length,r=[],o="";t<i;)e[t]==="\r"||e[t]===""?(r.push(o),o=""):o+=e[t],t+=1;return r.push(o),r},SVGTextLottieElement.prototype.buildShapeData=function(e,t){if(e.shapes&&e.shapes.length){var i=e.shapes[0];if(i.it){var r=i.it[i.it.length-1];r.s&&(r.s.k[0]=t,r.s.k[1]=t)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,t,i=this.textProperty.currentData;this.renderedLetters=createSizedArray(i?i.l.length:0),i.fc?this.layerElement.setAttribute("fill",this.buildColor(i.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),i.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(i.sc)),this.layerElement.setAttribute("stroke-width",i.sw)),this.layerElement.setAttribute("font-size",i.finalSize);var r=this.globalData.fontManager.getFontByName(i.f);if(r.fClass)this.layerElement.setAttribute("class",r.fClass);else{this.layerElement.setAttribute("font-family",r.fFamily);var o=i.fWeight,l=i.fStyle;this.layerElement.setAttribute("font-style",l),this.layerElement.setAttribute("font-weight",o)}this.layerElement.setAttribute("aria-label",i.t);var d=i.l||[],n=!!this.globalData.fontManager.chars;t=d.length;var S,C=this.mHelper,I="",z=this.data.singleShape,$=0,k=0,Y=!0,ie=i.tr*.001*i.finalSize;if(z&&!n&&!i.sz){var ue=this.textContainer,ne="start";switch(i.j){case 1:ne="end";break;case 2:ne="middle";break;default:ne="start";break}ue.setAttribute("text-anchor",ne),ue.setAttribute("letter-spacing",ie);var se=this.buildTextContents(i.finalText);for(t=se.length,k=i.ps?i.ps[1]+i.ascent:0,e=0;e<t;e+=1)S=this.textSpans[e].span||createNS("tspan"),S.textContent=se[e],S.setAttribute("x",0),S.setAttribute("y",k),S.style.display="inherit",ue.appendChild(S),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=S,k+=i.finalLineHeight;this.layerElement.appendChild(ue)}else{var le=this.textSpans.length,he;for(e=0;e<t;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!n||!z||e===0){if(S=le>e?this.textSpans[e].span:createNS(n?"g":"text"),le<=e){if(S.setAttribute("stroke-linecap","butt"),S.setAttribute("stroke-linejoin","round"),S.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=S,n){var me=createNS("g");S.appendChild(me),this.textSpans[e].childSpan=me}this.textSpans[e].span=S,this.layerElement.appendChild(S)}S.style.display="inherit"}if(C.reset(),z&&(d[e].n&&($=-ie,k+=i.yOffset,k+=Y?1:0,Y=!1),this.applyTextPropertiesToMatrix(i,C,d[e].line,$,k),$+=d[e].l||0,$+=ie),n){he=this.globalData.fontManager.getCharData(i.finalText[e],r.fStyle,this.globalData.fontManager.getFontByName(i.f).fFamily);var ge;if(he.t===1)ge=new SVGCompElement(he.data,this.globalData,this);else{var xt=emptyShapeData;he.data&&he.data.shapes&&(xt=this.buildShapeData(he.data,i.finalSize)),ge=new SVGShapeElement(xt,this.globalData,this)}if(this.textSpans[e].glyph){var Et=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(Et.layerElement),Et.destroy()}this.textSpans[e].glyph=ge,ge._debug=!0,ge.prepareFrame(0),ge.renderFrame(),this.textSpans[e].childSpan.appendChild(ge.layerElement),he.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+i.finalSize/100+","+i.finalSize/100+")")}else z&&S.setAttribute("transform","translate("+C.props[12]+","+C.props[13]+")"),S.textContent=d[e].val,S.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}z&&S&&S.setAttribute("d",I)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,t=this.textSpans.length,i;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<t;e+=1)i=this.textSpans[e].glyph,i&&(i.prepareFrame(this.comp.renderedFrame-this.data.st),i._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,t,i=this.textAnimator.renderedLetters,r=this.textProperty.currentData.l;t=r.length;var o,l,d;for(e=0;e<t;e+=1)r[e].n||(o=i[e],l=this.textSpans[e].span,d=this.textSpans[e].glyph,d&&d.renderFrame(),o._mdf.m&&l.setAttribute("transform",o.m),o._mdf.o&&l.setAttribute("opacity",o.o),o._mdf.sw&&l.setAttribute("stroke-width",o.sw),o._mdf.sc&&l.setAttribute("stroke",o.sc),o._mdf.fc&&l.setAttribute("fill",o.fc))}};function ISolidElement(e,t,i){this.initElement(e,t,i)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initFrame(),this.initTransform(e,t,i),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var t=this.globalData.defs;this.setupGlobalData(e,t),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var i=createNS("clipPath"),r=createNS("rect");r.setAttribute("width",e.w),r.setAttribute("height",e.h),r.setAttribute("x",0),r.setAttribute("y",0);var o=createElementID();i.setAttribute("id",o),i.appendChild(r),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+o+")"),t.appendChild(i),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var t=0,i=this.layers.length;for(t=0;t<i;t+=1)if(this.layers[t].ind===e)return t;return-1},SVGRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!(t[e]||this.layers[e].ty===99)){t[e]=!0;var i=this.createItem(this.layers[e]);if(t[e]=i,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(i),i.initExpressions()),this.appendElementInPos(i,e),this.layers[e].tt){var r="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(r===-1)return;if(!this.elements[r]||this.elements[r]===!0)this.buildItem(r),this.addPendingElement(i);else{var o=t[r],l=o.getMatte(this.layers[e].tt);i.setMatte(l)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var t=0,i=this.elements.length;t<i;){if(this.elements[t]===e){var r="tp"in e.data?this.findIndexByInd(e.data.tp):t-1,o=this.elements[r],l=o.getMatte(this.layers[t].tt);e.setMatte(l);break}t+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var t,i=this.layers.length;for(this.completeLayers||this.checkLayers(e),t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(e-this.layers[t].st);if(this.globalData._mdf)for(t=0;t<i;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,t){var i=e.getBaseElement();if(i){for(var r=0,o;r<t;)this.elements[r]&&this.elements[r]!==!0&&this.elements[r].getBaseElement()&&(o=this.elements[r].getBaseElement()),r+=1;o?this.layerElement.insertBefore(i,o):this.layerElement.appendChild(i)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initTransform(e,t,i),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!t.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var t=this.tm.v;t===this.data.op&&(t=this.data.op-1),this.renderedFrame=t}var i,r=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&(this.elements[i].prepareFrame(this.renderedFrame-this.layers[i].st),this.elements[i]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,t,i){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var i="";if(t&&t.title){var r=createNS("title"),o=createElementID();r.setAttribute("id",o),r.textContent=t.title,this.svgElement.appendChild(r),i+=o}if(t&&t.description){var l=createNS("desc"),d=createElementID();l.setAttribute("id",d),l.textContent=t.description,this.svgElement.appendChild(l),i+=" "+d}i&&this.svgElement.setAttribute("aria-labelledby",i);var n=createNS("defs");this.svgElement.appendChild(n);var S=createNS("g");this.svgElement.appendChild(S),this.layerElement=S,this.renderConfig={preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",progressiveLoad:t&&t.progressiveLoad||!1,hideOnTransparent:!(t&&t.hideOnTransparent===!1),viewBoxOnly:t&&t.viewBoxOnly||!1,viewBoxSize:t&&t.viewBoxSize||!1,className:t&&t.className||"",id:t&&t.id||"",focusable:t&&t.focusable,filterSize:{width:t&&t.filterSize&&t.filterSize.width||"100%",height:t&&t.filterSize&&t.filterSize.height||"100%",x:t&&t.filterSize&&t.filterSize.x||"0%",y:t&&t.filterSize&&t.filterSize.y||"0%"},width:t&&t.width,height:t&&t.height,runExpressions:!t||t.runExpressions===void 0||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:n,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(t){var i,r=t.length,o="_";for(i=0;i<r;i+=1)o+=t[i].transform.key+"_";var l=this.sequences[o];return l||(l={transforms:[].concat(t),finalTransform:new Matrix,_mdf:!1},this.sequences[o]=l,this.sequenceList.push(l)),l},processSequence:function(t,i){for(var r=0,o=t.transforms.length,l=i;r<o&&!i;){if(t.transforms[r].transform.mProps._mdf){l=!0;break}r+=1}if(l)for(t.finalTransform.reset(),r=o-1;r>=0;r-=1)t.finalTransform.multiply(t.transforms[r].transform.mProps.v);t._mdf=l},processSequences:function(t){var i,r=this.sequenceList.length;for(i=0;i<r;i+=1)this.processSequence(this.sequenceList[i],t)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var t="__lottie_element_luma_buffer",i=null,r=null,o=null;function l(){var S=createNS("svg"),C=createNS("filter"),I=createNS("feColorMatrix");return C.setAttribute("id",t),I.setAttribute("type","matrix"),I.setAttribute("color-interpolation-filters","sRGB"),I.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),C.appendChild(I),S.appendChild(C),S.setAttribute("id",t+"_svg"),featureSupport.svgLumaHidden&&(S.style.display="none"),S}function d(){i||(o=l(),document.body.appendChild(o),i=createTag("canvas"),r=i.getContext("2d"),r.filter="url(#"+t+")",r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1))}function n(S){return i||d(),i.width=S.width,i.height=S.height,r.filter="url(#"+t+")",i}return{load:d,get:n}};function createCanvas(e,t){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,t);var i=createTag("canvas");return i.width=e,i.height=t,i}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var t,i=e.data.ef?e.data.ef.length:0;this.filters=[];var r;for(t=0;t<i;t+=1){r=null;var o=e.data.ef[t].ty;if(registeredEffects[o]){var l=registeredEffects[o].effect;r=new l(e.effectsManager.effectElements[t],e)}r&&this.filters.push(r)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var t,i=this.filters.length;for(t=0;t<i;t+=1)this.filters[t].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var t,i=this.filters.length,r=[];for(t=0;t<i;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r};function registerEffect(e,t){registeredEffects[e]={effect:t}}function CVMaskElement(e,t){this.data=e,this.element=t,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var i,r=this.masksProperties.length,o=!1;for(i=0;i<r;i+=1)this.masksProperties[i].mode!=="n"&&(o=!0),this.viewData[i]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[i],3);this.hasMasks=o,o&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,t=this.element.canvasContext,i,r=this.masksProperties.length,o,l,d;for(t.beginPath(),i=0;i<r;i+=1)if(this.masksProperties[i].mode!=="n"){this.masksProperties[i].inv&&(t.moveTo(0,0),t.lineTo(this.element.globalData.compSize.w,0),t.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),t.lineTo(0,this.element.globalData.compSize.h),t.lineTo(0,0)),d=this.viewData[i].v,o=e.applyToPointArray(d.v[0][0],d.v[0][1],0),t.moveTo(o[0],o[1]);var n,S=d._length;for(n=1;n<S;n+=1)l=e.applyToTriplePoints(d.o[n-1],d.i[n],d.v[n]),t.bezierCurveTo(l[0],l[1],l[2],l[3],l[4],l[5]);l=e.applyToTriplePoints(d.o[n-1],d.i[0],d.v[0]),t.bezierCurveTo(l[0],l[1],l[2],l[3],l[4],l[5])}this.element.globalData.renderer.save(!0),t.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var t=this.globalData.canvasContext,i=assetLoader.createCanvas(t.canvas.width,t.canvas.height);this.buffers.push(i);var r=assetLoader.createCanvas(t.canvas.width,t.canvas.height);this.buffers.push(r),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var t=this.globalData;if(t.blendMode!==this.data.bm){t.blendMode=this.data.bm;var i=getBlendMode(this.data.bm);t.canvasContext.globalCompositeOperation=i}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(t){t.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var t=this.buffers[0],i=t.getContext("2d");this.clearCanvas(i),i.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var t=this.buffers[1],i=t.getContext("2d");this.clearCanvas(i),i.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var r=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(r.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var o=assetLoader.getLumaCanvas(this.canvasContext.canvas),l=o.getContext("2d");l.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(o,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(t,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(t){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!t)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var i=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(i),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(i),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,t,i,r){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var o=4;t.ty==="rc"?o=5:t.ty==="el"?o=6:t.ty==="sr"&&(o=7),this.sh=ShapePropertyFactory.getShapeProp(e,t,o,e);var l,d=i.length,n;for(l=0;l<d;l+=1)i[l].closed||(n={transforms:r.addTransformSequence(i[l].transforms),trNodes:[]},this.styledShapes.push(n),i[l].elements.push(n))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,t){var i={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(t),transforms:[],elements:[],closed:e.hd===!0},r={};if(e.ty==="fl"||e.ty==="st"?(r.c=PropertyFactory.getProp(this,e.c,1,255,this),r.c.k||(i.co="rgb("+bmFloor(r.c.v[0])+","+bmFloor(r.c.v[1])+","+bmFloor(r.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(r.s=PropertyFactory.getProp(this,e.s,1,null,this),r.e=PropertyFactory.getProp(this,e.e,1,null,this),r.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),r.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),r.g=new GradientProperty(this,e.g,this)),r.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(i.lc=lineCapEnum[e.lc||2],i.lj=lineJoinEnum[e.lj||2],e.lj==1&&(i.ml=e.ml),r.w=PropertyFactory.getProp(this,e.w,0,null,this),r.w.k||(i.wi=r.w.v),e.d){var o=new DashProperty(this,e.d,"canvas",this);r.d=o,r.d.k||(i.da=r.d.dashArray,i.do=r.d.dashoffset[0])}}else i.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(i),r.style=i,r},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var t={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return t},CVShapeElement.prototype.createShapeElement=function(e){var t=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(t),this.addShapeToModifiers(t),t},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var t,i=this.stylesList.length;for(t=0;t<i;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t].closed=!0},CVShapeElement.prototype.searchShapes=function(e,t,i,r,o){var l,d=e.length-1,n,S,C=[],I=[],z,$,k,Y=[].concat(o);for(l=d;l>=0;l-=1){if(z=this.searchProcessedElement(e[l]),z?t[l]=i[z-1]:e[l]._shouldRender=r,e[l].ty==="fl"||e[l].ty==="st"||e[l].ty==="gf"||e[l].ty==="gs")z?t[l].style.closed=!1:t[l]=this.createStyleElement(e[l],Y),C.push(t[l].style);else if(e[l].ty==="gr"){if(!z)t[l]=this.createGroupElement(e[l]);else for(S=t[l].it.length,n=0;n<S;n+=1)t[l].prevViewData[n]=t[l].it[n];this.searchShapes(e[l].it,t[l].it,t[l].prevViewData,r,Y)}else e[l].ty==="tr"?(z||(k=this.createTransformElement(e[l]),t[l]=k),Y.push(t[l]),this.addTransformToStyleList(t[l])):e[l].ty==="sh"||e[l].ty==="rc"||e[l].ty==="el"||e[l].ty==="sr"?z||(t[l]=this.createShapeElement(e[l])):e[l].ty==="tm"||e[l].ty==="rd"||e[l].ty==="pb"||e[l].ty==="zz"||e[l].ty==="op"?(z?($=t[l],$.closed=!1):($=ShapeModifiers.getModifier(e[l].ty),$.init(this,e[l]),t[l]=$,this.shapeModifiers.push($)),I.push($)):e[l].ty==="rp"&&(z?($=t[l],$.closed=!0):($=ShapeModifiers.getModifier(e[l].ty),t[l]=$,$.init(this,e,l,t),this.shapeModifiers.push($),r=!1),I.push($));this.addProcessedElement(e[l],l+1)}for(this.removeTransformFromStyleList(),this.closeStyles(C),d=I.length,l=0;l<d;l+=1)I[l].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,t){(e._opMdf||t.op._mdf||this._isFirstFrame)&&(t.opacity=e.opacity,t.opacity*=t.op.v,t._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,t=this.stylesList.length,i,r,o,l,d,n,S=this.globalData.renderer,C=this.globalData.canvasContext,I,z;for(e=0;e<t;e+=1)if(z=this.stylesList[e],I=z.type,!((I==="st"||I==="gs")&&z.wi===0||!z.data._shouldRender||z.coOp===0||this.globalData.currentGlobalAlpha===0)){for(S.save(),d=z.elements,I==="st"||I==="gs"?(S.ctxStrokeStyle(I==="st"?z.co:z.grd),S.ctxLineWidth(z.wi),S.ctxLineCap(z.lc),S.ctxLineJoin(z.lj),S.ctxMiterLimit(z.ml||0)):S.ctxFillStyle(I==="fl"?z.co:z.grd),S.ctxOpacity(z.coOp),I!=="st"&&I!=="gs"&&C.beginPath(),S.ctxTransform(z.preTransforms.finalTransform.props),r=d.length,i=0;i<r;i+=1){for((I==="st"||I==="gs")&&(C.beginPath(),z.da&&(C.setLineDash(z.da),C.lineDashOffset=z.do)),n=d[i].trNodes,l=n.length,o=0;o<l;o+=1)n[o].t==="m"?C.moveTo(n[o].p[0],n[o].p[1]):n[o].t==="c"?C.bezierCurveTo(n[o].pts[0],n[o].pts[1],n[o].pts[2],n[o].pts[3],n[o].pts[4],n[o].pts[5]):C.closePath();(I==="st"||I==="gs")&&(S.ctxStroke(),z.da&&C.setLineDash(this.dashResetter))}I!=="st"&&I!=="gs"&&this.globalData.renderer.ctxFill(z.r),S.restore()}},CVShapeElement.prototype.renderShape=function(e,t,i,r){var o,l=t.length-1,d;for(d=e,o=l;o>=0;o-=1)t[o].ty==="tr"?(d=i[o].transform,this.renderShapeTransform(e,d)):t[o].ty==="sh"||t[o].ty==="el"||t[o].ty==="rc"||t[o].ty==="sr"?this.renderPath(t[o],i[o]):t[o].ty==="fl"?this.renderFill(t[o],i[o],d):t[o].ty==="st"?this.renderStroke(t[o],i[o],d):t[o].ty==="gf"||t[o].ty==="gs"?this.renderGradientFill(t[o],i[o],d):t[o].ty==="gr"?this.renderShape(d,t[o].it,i[o].it):t[o].ty;r&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,t){if(this._isFirstFrame||t._mdf||e.transforms._mdf){var i=e.trNodes,r=t.paths,o,l,d,n=r._length;i.length=0;var S=e.transforms.finalTransform;for(d=0;d<n;d+=1){var C=r.shapes[d];if(C&&C.v){for(l=C._length,o=1;o<l;o+=1)o===1&&i.push({t:"m",p:S.applyToPointArray(C.v[0][0],C.v[0][1],0)}),i.push({t:"c",pts:S.applyToTriplePoints(C.o[o-1],C.i[o],C.v[o])});l===1&&i.push({t:"m",p:S.applyToPointArray(C.v[0][0],C.v[0][1],0)}),C.c&&l&&(i.push({t:"c",pts:S.applyToTriplePoints(C.o[o-1],C.i[0],C.v[0])}),i.push({t:"z"}))}}e.trNodes=i}},CVShapeElement.prototype.renderPath=function(e,t){if(e.hd!==!0&&e._shouldRender){var i,r=t.styledShapes.length;for(i=0;i<r;i+=1)this.renderStyledShape(t.styledShapes[i],t.sh)}},CVShapeElement.prototype.renderFill=function(e,t,i){var r=t.style;(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*i.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,t,i){var r=t.style,o;if(!r.grd||t.g._mdf||t.s._mdf||t.e._mdf||e.t!==1&&(t.h._mdf||t.a._mdf)){var l=this.globalData.canvasContext,d=t.s.v,n=t.e.v;if(e.t===1)o=l.createLinearGradient(d[0],d[1],n[0],n[1]);else{var S=Math.sqrt(Math.pow(d[0]-n[0],2)+Math.pow(d[1]-n[1],2)),C=Math.atan2(n[1]-d[1],n[0]-d[0]),I=t.h.v;I>=1?I=.99:I<=-1&&(I=-.99);var z=S*I,$=Math.cos(C+t.a.v)*z+d[0],k=Math.sin(C+t.a.v)*z+d[1];o=l.createRadialGradient($,k,0,d[0],d[1],S)}var Y,ie=e.g.p,ue=t.g.c,ne=1;for(Y=0;Y<ie;Y+=1)t.g._hasOpacity&&t.g._collapsable&&(ne=t.g.o[Y*2+1]),o.addColorStop(ue[Y*4]/100,"rgba("+ue[Y*4+1]+","+ue[Y*4+2]+","+ue[Y*4+3]+","+ne+")");r.grd=o}r.coOp=t.o.v*i.opacity},CVShapeElement.prototype.renderStroke=function(e,t,i){var r=t.style,o=t.d;o&&(o._mdf||this._isFirstFrame)&&(r.da=o.dashArray,r.do=o.dashoffset[0]),(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*i.opacity),(t.w._mdf||this._isFirstFrame)&&(r.wi=t.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,t,i){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=!1;e.fc?(t=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=t;var i=!1;e.sc&&(i=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var r=this.globalData.fontManager.getFontByName(e.f),o,l,d=e.l,n=this.mHelper;this.stroke=i,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,l=e.finalText.length;var S,C,I,z,$,k,Y,ie,ue,ne,se=this.data.singleShape,le=e.tr*.001*e.finalSize,he=0,me=0,ge=!0,xt=0;for(o=0;o<l;o+=1){S=this.globalData.fontManager.getCharData(e.finalText[o],r.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),C=S&&S.data||{},n.reset(),se&&d[o].n&&(he=-le,me+=e.yOffset,me+=ge?1:0,ge=!1),$=C.shapes?C.shapes[0].it:[],Y=$.length,n.scale(e.finalSize/100,e.finalSize/100),se&&this.applyTextPropertiesToMatrix(e,n,d[o].line,he,me),ue=createSizedArray(Y-1);var Et=0;for(k=0;k<Y;k+=1)if($[k].ty==="sh"){for(z=$[k].ks.k.i.length,ie=$[k].ks.k,ne=[],I=1;I<z;I+=1)I===1&&ne.push(n.applyToX(ie.v[0][0],ie.v[0][1],0),n.applyToY(ie.v[0][0],ie.v[0][1],0)),ne.push(n.applyToX(ie.o[I-1][0],ie.o[I-1][1],0),n.applyToY(ie.o[I-1][0],ie.o[I-1][1],0),n.applyToX(ie.i[I][0],ie.i[I][1],0),n.applyToY(ie.i[I][0],ie.i[I][1],0),n.applyToX(ie.v[I][0],ie.v[I][1],0),n.applyToY(ie.v[I][0],ie.v[I][1],0));ne.push(n.applyToX(ie.o[I-1][0],ie.o[I-1][1],0),n.applyToY(ie.o[I-1][0],ie.o[I-1][1],0),n.applyToX(ie.i[0][0],ie.i[0][1],0),n.applyToY(ie.i[0][0],ie.i[0][1],0),n.applyToX(ie.v[0][0],ie.v[0][1],0),n.applyToY(ie.v[0][0],ie.v[0][1],0)),ue[Et]=ne,Et+=1}se&&(he+=d[o].l,he+=le),this.textSpans[xt]?this.textSpans[xt].elem=ue:this.textSpans[xt]={elem:ue},xt+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var t,i,r,o,l,d,n=this.textAnimator.renderedLetters,S=this.textProperty.currentData.l;i=S.length;var C,I=null,z=null,$=null,k,Y,ie=this.globalData.renderer;for(t=0;t<i;t+=1)if(!S[t].n){if(C=n[t],C&&(ie.save(),ie.ctxTransform(C.p),ie.ctxOpacity(C.o)),this.fill){for(C&&C.fc?I!==C.fc&&(ie.ctxFillStyle(C.fc),I=C.fc):I!==this.values.fill&&(I=this.values.fill,ie.ctxFillStyle(this.values.fill)),k=this.textSpans[t].elem,o=k.length,this.globalData.canvasContext.beginPath(),r=0;r<o;r+=1)for(Y=k[r],d=Y.length,this.globalData.canvasContext.moveTo(Y[0],Y[1]),l=2;l<d;l+=6)this.globalData.canvasContext.bezierCurveTo(Y[l],Y[l+1],Y[l+2],Y[l+3],Y[l+4],Y[l+5]);this.globalData.canvasContext.closePath(),ie.ctxFill()}if(this.stroke){for(C&&C.sw?$!==C.sw&&($=C.sw,ie.ctxLineWidth(C.sw)):$!==this.values.sWidth&&($=this.values.sWidth,ie.ctxLineWidth(this.values.sWidth)),C&&C.sc?z!==C.sc&&(z=C.sc,ie.ctxStrokeStyle(C.sc)):z!==this.values.stroke&&(z=this.values.stroke,ie.ctxStrokeStyle(this.values.stroke)),k=this.textSpans[t].elem,o=k.length,this.globalData.canvasContext.beginPath(),r=0;r<o;r+=1)for(Y=k[r],d=Y.length,this.globalData.canvasContext.moveTo(Y[0],Y[1]),l=2;l<d;l+=6)this.globalData.canvasContext.bezierCurveTo(Y[l],Y[l+1],Y[l+2],Y[l+3],Y[l+4],Y[l+5]);this.globalData.canvasContext.closePath(),ie.ctxStroke()}C&&this.globalData.renderer.restore()}};function CVImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.img=t.imageLoader.getAsset(this.assetData),this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var t=e.getContext("2d"),i=this.img.width,r=this.img.height,o=i/r,l=this.assetData.w/this.assetData.h,d,n,S=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;o>l&&S==="xMidYMid slice"||o<l&&S!=="xMidYMid slice"?(n=r,d=n*l):(d=i,n=d/l),t.drawImage(this.img,(i-d)/2,(r-n)/2,d,n,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,t,i){this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,t,i,r){this.canvasContext.fillRect(e,t,i,r)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var t=this.animationItem.container.style;t.width="100%",t.height="100%";var i="0px 0px 0px";t.transformOrigin=i,t.mozTransformOrigin=i,t.webkitTransformOrigin=i,t["-webkit-transform"]=i,t.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,t){this.reset();var i,r;e?(i=e,r=t,this.canvasContext.canvas.width=i,this.canvasContext.canvas.height=r):(this.animationItem.wrapper&&this.animationItem.container?(i=this.animationItem.wrapper.offsetWidth,r=this.animationItem.wrapper.offsetHeight):(i=this.canvasContext.canvas.width,r=this.canvasContext.canvas.height),this.canvasContext.canvas.width=i*this.renderConfig.dpr,this.canvasContext.canvas.height=r*this.renderConfig.dpr);var o,l;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var d=this.renderConfig.preserveAspectRatio.split(" "),n=d[1]||"meet",S=d[0]||"xMidYMid",C=S.substr(0,4),I=S.substr(4);o=i/r,l=this.transformCanvas.w/this.transformCanvas.h,l>o&&n==="meet"||l<o&&n==="slice"?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=i/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr)),C==="xMid"&&(l<o&&n==="meet"||l>o&&n==="slice")?this.transformCanvas.tx=(i-this.transformCanvas.w*(r/this.transformCanvas.h))/2*this.renderConfig.dpr:C==="xMax"&&(l<o&&n==="meet"||l>o&&n==="slice")?this.transformCanvas.tx=(i-this.transformCanvas.w*(r/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,I==="YMid"&&(l>o&&n==="meet"||l<o&&n==="slice")?this.transformCanvas.ty=(r-this.transformCanvas.h*(i/this.transformCanvas.w))/2*this.renderConfig.dpr:I==="YMax"&&(l>o&&n==="meet"||l<o&&n==="slice")?this.transformCanvas.ty=(r-this.transformCanvas.h*(i/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,t=this.layers?this.layers.length:0;for(e=t-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,t){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!t||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||t,this.globalData.projectInterface.currentFrame=e;var i,r=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!(t[e]||this.layers[e].ty===99)){var i=this.createItem(this.layers[e],this,this.globalData);t[e]=i,i.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,t=15;for(e=0;e<t;e+=1){var i=new CanvasContext;this.stack[e]=i}this._length=t,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,t=0;for(t=this._length;t<e;t+=1)this.stack[t]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var t=this.stack[this.cArrPos],i=t.transform,r,o=this.cTr.props;for(r=0;r<16;r+=1)o[r]=i[r];if(e){this.nativeContext.restore();var l=this.stack[this.cArrPos+1];this.appliedFillStyle=l.fillStyle,this.appliedStrokeStyle=l.strokeStyle,this.appliedLineWidth=l.lineWidth,this.appliedLineCap=l.lineCap,this.appliedLineJoin=l.lineJoin,this.appliedMiterLimit=l.miterLimit}this.nativeContext.setTransform(i[0],i[1],i[4],i[5],i[12],i[13]),(e||t.opacity!==-1&&this.currentOpacity!==t.opacity)&&(this.nativeContext.globalAlpha=t.opacity,this.currentOpacity=t.opacity),this.currentFillStyle=t.fillStyle,this.currentStrokeStyle=t.strokeStyle,this.currentLineWidth=t.lineWidth,this.currentLineCap=t.lineCap,this.currentLineJoin=t.lineJoin,this.currentMiterLimit=t.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var t=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var i=this.stack[this.cArrPos],r;for(r=0;r<16;r+=1)i.transform[r]=t[r];this.cArrPos+=1;var o=this.stack[this.cArrPos];o.opacity=i.opacity,o.fillStyle=i.fillStyle,o.strokeStyle=i.strokeStyle,o.lineWidth=i.lineWidth,o.lineCap=i.lineCap,o.lineJoin=i.lineJoin,o.miterLimit=i.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var t=this.cTr;this.transformMat.multiply(t),t.cloneFromProps(this.transformMat.props);var i=t.props;this.nativeContext.setTransform(i[0],i[1],i[4],i[5],i[12],i[13])},CVContextData.prototype.opacity=function(e){var t=this.stack[this.cArrPos].opacity;t*=e<0?0:e,this.stack[this.cArrPos].opacity!==t&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=t)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,t,i,r){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,t,i,r)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,t,i){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var t,i=this.layers.length;for(t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()},CVCompElement.prototype.destroy=function(){var e,t=this.layers.length;for(e=t-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,t){this.animationItem=e,this.renderConfig={clearCanvas:t&&t.clearCanvas!==void 0?t.clearCanvas:!0,context:t&&t.context||null,progressiveLoad:t&&t.progressiveLoad||!1,preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",className:t&&t.className||"",id:t&&t.id||"",runExpressions:!t||t.runExpressions===void 0||t.runExpressions},this.renderConfig.dpr=t&&t.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=t&&t.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var t=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var i=this.finalTransform.mat.toCSS();t.transform=i,t.webkitTransform=i}this.finalTransform._opMdf&&(t.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,t,i){this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,t,i),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var t=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",t.w),e.setAttribute("height",t.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)t=e[i].mProps.v.applyToPointArray(t[0],t[1],0);return t},HShapeElement.prototype.calculateShapeBoundingBox=function(e,t){var i=e.sh.v,r=e.transformers,o,l=i._length,d,n,S,C;if(!(l<=1)){for(o=0;o<l-1;o+=1)d=this.getTransformedPoint(r,i.v[o]),n=this.getTransformedPoint(r,i.o[o]),S=this.getTransformedPoint(r,i.i[o+1]),C=this.getTransformedPoint(r,i.v[o+1]),this.checkBounds(d,n,S,C,t);i.c&&(d=this.getTransformedPoint(r,i.v[o]),n=this.getTransformedPoint(r,i.o[o]),S=this.getTransformedPoint(r,i.i[0]),C=this.getTransformedPoint(r,i.v[0]),this.checkBounds(d,n,S,C,t))}},HShapeElement.prototype.checkBounds=function(e,t,i,r,o){this.getBoundsOfCurve(e,t,i,r);var l=this.shapeBoundingBox;o.x=bmMin(l.left,o.x),o.xMax=bmMax(l.right,o.xMax),o.y=bmMin(l.top,o.y),o.yMax=bmMax(l.bottom,o.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,t,i,r){for(var o=[[e[0],r[0]],[e[1],r[1]]],l,d,n,S,C,I,z,$=0;$<2;++$)d=6*e[$]-12*t[$]+6*i[$],l=-3*e[$]+9*t[$]-9*i[$]+3*r[$],n=3*t[$]-3*e[$],d|=0,l|=0,n|=0,l===0&&d===0||(l===0?(S=-n/d,S>0&&S<1&&o[$].push(this.calculateF(S,e,t,i,r,$))):(C=d*d-4*n*l,C>=0&&(I=(-d+bmSqrt(C))/(2*l),I>0&&I<1&&o[$].push(this.calculateF(I,e,t,i,r,$)),z=(-d-bmSqrt(C))/(2*l),z>0&&z<1&&o[$].push(this.calculateF(z,e,t,i,r,$)))));this.shapeBoundingBox.left=bmMin.apply(null,o[0]),this.shapeBoundingBox.top=bmMin.apply(null,o[1]),this.shapeBoundingBox.right=bmMax.apply(null,o[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,o[1])},HShapeElement.prototype.calculateF=function(e,t,i,r,o,l){return bmPow(1-e,3)*t[l]+3*bmPow(1-e,2)*e*i[l]+3*(1-e)*bmPow(e,2)*r[l]+bmPow(e,3)*o[l]},HShapeElement.prototype.calculateBoundingBox=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)e[i]&&e[i].sh?this.calculateShapeBoundingBox(e[i],t):e[i]&&e[i].it?this.calculateBoundingBox(e[i].it,t):e[i]&&e[i].style&&e[i].w&&this.expandStrokeBoundingBox(e[i].w,t)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,t){var i=0;if(e.keyframes){for(var r=0;r<e.keyframes.length;r+=1){var o=e.keyframes[r].s;o>i&&(i=o)}i*=e.mult}else i=e.v*e.mult;t.x-=i,t.xMax+=i,t.y-=i,t.yMax+=i},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,t=999999;if(e.x=t,e.xMax=-t,e.y=t,e.yMax=-t,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var i=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),i=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),i=!0),i||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var r=this.shapeCont.style,o="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";r.transform=o,r.webkitTransform=o}}};function HTextElement(e,t,i){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=this.innerElem.style,i=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";t.fill=i,t.color=i,e.sc&&(t.stroke=this.buildColor(e.sc),t.strokeWidth=e.sw+"px");var r=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(t.fontSize=e.finalSize+"px",t.lineHeight=e.finalSize+"px",r.fClass)this.innerElem.className=r.fClass;else{t.fontFamily=r.fFamily;var o=e.fWeight,l=e.fStyle;t.fontStyle=l,t.fontWeight=o}var d,n,S=e.l;n=S.length;var C,I,z,$=this.mHelper,k,Y="",ie=0;for(d=0;d<n;d+=1){if(this.globalData.fontManager.chars?(this.textPaths[ie]?C=this.textPaths[ie]:(C=createNS("path"),C.setAttribute("stroke-linecap",lineCapEnum[1]),C.setAttribute("stroke-linejoin",lineJoinEnum[2]),C.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[ie]?(I=this.textSpans[ie],z=I.children[0]):(I=createTag("div"),I.style.lineHeight=0,z=createNS("svg"),z.appendChild(C),styleDiv(I)))):this.isMasked?C=this.textPaths[ie]?this.textPaths[ie]:createNS("text"):this.textSpans[ie]?(I=this.textSpans[ie],C=this.textPaths[ie]):(I=createTag("span"),styleDiv(I),C=createTag("span"),styleDiv(C),I.appendChild(C)),this.globalData.fontManager.chars){var ue=this.globalData.fontManager.getCharData(e.finalText[d],r.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),ne;if(ue?ne=ue.data:ne=null,$.reset(),ne&&ne.shapes&&ne.shapes.length&&(k=ne.shapes[0].it,$.scale(e.finalSize/100,e.finalSize/100),Y=this.createPathShape($,k),C.setAttribute("d",Y)),this.isMasked)this.innerElem.appendChild(C);else{if(this.innerElem.appendChild(I),ne&&ne.shapes){document.body.appendChild(z);var se=z.getBBox();z.setAttribute("width",se.width+2),z.setAttribute("height",se.height+2),z.setAttribute("viewBox",se.x-1+" "+(se.y-1)+" "+(se.width+2)+" "+(se.height+2));var le=z.style,he="translate("+(se.x-1)+"px,"+(se.y-1)+"px)";le.transform=he,le.webkitTransform=he,S[d].yOffset=se.y-1}else z.setAttribute("width",1),z.setAttribute("height",1);I.appendChild(z)}}else if(C.textContent=S[d].val,C.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(C);else{this.innerElem.appendChild(I);var me=C.style,ge="translate3d(0,"+-e.finalSize/1.2+"px,0)";me.transform=ge,me.webkitTransform=ge}this.isMasked?this.textSpans[ie]=C:this.textSpans[ie]=I,this.textSpans[ie].style.display="block",this.textPaths[ie]=C,ie+=1}for(;ie<this.textSpans.length;)this.textSpans[ie].style.display="none",ie+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var t="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=t,e.webkitTransform=t}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var i,r,o=0,l=this.textAnimator.renderedLetters,d=this.textProperty.currentData.l;r=d.length;var n,S,C;for(i=0;i<r;i+=1)d[i].n?o+=1:(S=this.textSpans[i],C=this.textPaths[i],n=l[o],o+=1,n._mdf.m&&(this.isMasked?S.setAttribute("transform",n.m):(S.style.webkitTransform=n.m,S.style.transform=n.m)),S.style.opacity=n.o,n.sw&&n._mdf.sw&&C.setAttribute("stroke-width",n.sw),n.sc&&n._mdf.sc&&C.setAttribute("stroke",n.sc),n.fc&&n._mdf.fc&&(C.setAttribute("fill",n.fc),C.style.color=n.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var I=this.innerElem.getBBox();this.currentBBox.w!==I.width&&(this.currentBBox.w=I.width,this.svgElement.setAttribute("width",I.width)),this.currentBBox.h!==I.height&&(this.currentBBox.h=I.height,this.svgElement.setAttribute("height",I.height));var z=1;if(this.currentBBox.w!==I.width+z*2||this.currentBBox.h!==I.height+z*2||this.currentBBox.x!==I.x-z||this.currentBBox.y!==I.y-z){this.currentBBox.w=I.width+z*2,this.currentBBox.h=I.height+z*2,this.currentBBox.x=I.x-z,this.currentBBox.y=I.y-z,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var $="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=$,e.webkitTransform=$}}}};function HCameraElement(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initHierarchy();var r=PropertyFactory.getProp;if(this.pe=r(this,e.pe,0,0,this),e.ks.p.s?(this.px=r(this,e.ks.p.x,1,0,this),this.py=r(this,e.ks.p.y,1,0,this),this.pz=r(this,e.ks.p.z,1,0,this)):this.p=r(this,e.ks.p,1,0,this),e.ks.a&&(this.a=r(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var o,l=e.ks.or.k.length;for(o=0;o<l;o+=1)e.ks.or.k[o].to=null,e.ks.or.k[o].ti=null}this.or=r(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=r(this,e.ks.rx,0,degToRads,this),this.ry=r(this,e.ks.ry,0,degToRads,this),this.rz=r(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,t=this.comp.threeDElements.length,i,r,o;for(e=0;e<t;e+=1)if(i=this.comp.threeDElements[e],i.type==="3d"){r=i.perspectiveElem.style,o=i.container.style;var l=this.pe.v+"px",d="0px 0px 0px",n="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";r.perspective=l,r.webkitPerspective=l,o.transformOrigin=d,o.mozTransformOrigin=d,o.webkitTransformOrigin=d,r.transform=n,r.webkitTransform=n}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,t,i;if(this.hierarchy)for(i=this.hierarchy.length,t=0;t<i;t+=1)e=this.hierarchy[t].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(i=this.hierarchy.length-1,t=i;t>=0;t-=1){var r=this.hierarchy[t].finalTransform.mProp;this.mat.translate(-r.p.v[0],-r.p.v[1],r.p.v[2]),this.mat.rotateX(-r.or.v[0]).rotateY(-r.or.v[1]).rotateZ(r.or.v[2]),this.mat.rotateX(-r.rx.v).rotateY(-r.ry.v).rotateZ(r.rz.v),this.mat.scale(1/r.s.v[0],1/r.s.v[1],1/r.s.v[2]),this.mat.translate(r.a.v[0],r.a.v[1],r.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var o;this.p?o=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:o=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var l=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2)),d=[o[0]/l,o[1]/l,o[2]/l],n=Math.sqrt(d[2]*d[2]+d[0]*d[0]),S=Math.atan2(d[1],n),C=Math.atan2(d[0],-d[2]);this.mat.rotateY(C).rotateX(-S)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var I=!this._prevMat.equals(this.mat);if((I||this.pe._mdf)&&this.comp.threeDElements){i=this.comp.threeDElements.length;var z,$,k;for(t=0;t<i;t+=1)if(z=this.comp.threeDElements[t],z.type==="3d"){if(I){var Y=this.mat.toCSS();k=z.container.style,k.transform=Y,k.webkitTransform=Y}this.pe._mdf&&($=z.perspectiveElem.style,$.perspective=this.pe.v+"px",$.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.initElement(e,t,i)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),t=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(t),t.crossOrigin="anonymous",t.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&t.hideOnTransparent===!1),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,t){var i=e.getBaseElement();if(i){var r=this.layers[t];if(!r.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(i,t);else{for(var o=0,l,d,n;o<t;)this.elements[o]&&this.elements[o]!==!0&&this.elements[o].getBaseElement&&(d=this.elements[o],n=this.layers[o].ddd?this.getThreeDContainerByPos(o):d.getBaseElement(),l=n||l),o+=1;l?(!r.ddd||!this.supports3d)&&this.layerElement.insertBefore(i,l):(!r.ddd||!this.supports3d)&&this.layerElement.appendChild(i)}else this.addTo3dContainer(i,t)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var t=0,i=this.threeDElements.length;t<i;){if(this.threeDElements[t].startPos<=e&&this.threeDElements[t].endPos>=e)return this.threeDElements[t].perspectiveElem;t+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,t){var i=createTag("div"),r,o;styleDiv(i);var l=createTag("div");if(styleDiv(l),t==="3d"){r=i.style,r.width=this.globalData.compSize.w+"px",r.height=this.globalData.compSize.h+"px";var d="50% 50%";r.webkitTransformOrigin=d,r.mozTransformOrigin=d,r.transformOrigin=d,o=l.style;var n="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";o.transform=n,o.webkitTransform=n}i.appendChild(l);var S={container:l,perspectiveElem:i,startPos:e,endPos:e,type:t};return this.threeDElements.push(S),S},HybridRendererBase.prototype.build3dContainers=function(){var e,t=this.layers.length,i,r="";for(e=0;e<t;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(r!=="3d"&&(r="3d",i=this.createThreeDContainer(e,"3d")),i.endPos=Math.max(i.endPos,e)):(r!=="2d"&&(r="2d",i=this.createThreeDContainer(e,"2d")),i.endPos=Math.max(i.endPos,e));for(t=this.threeDElements.length,e=t-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,t){for(var i=0,r=this.threeDElements.length;i<r;){if(t<=this.threeDElements[i].endPos){for(var o=this.threeDElements[i].startPos,l;o<t;)this.elements[o]&&this.elements[o].getBaseElement&&(l=this.elements[o].getBaseElement()),o+=1;l?this.threeDElements[i].container.insertBefore(e,l):this.threeDElements[i].container.appendChild(e);break}i+=1}},HybridRendererBase.prototype.configAnimation=function(e){var t=createTag("div"),i=this.animationItem.wrapper,r=t.style;r.width=e.w+"px",r.height=e.h+"px",this.resizerElem=t,styleDiv(t),r.transformStyle="flat",r.mozTransformStyle="flat",r.webkitTransformStyle="flat",this.renderConfig.className&&t.setAttribute("class",this.renderConfig.className),i.appendChild(t),r.overflow="hidden";var o=createNS("svg");o.setAttribute("width","1"),o.setAttribute("height","1"),styleDiv(o),this.resizerElem.appendChild(o);var l=createNS("defs");o.appendChild(l),this.data=e,this.setupGlobalData(e,o),this.globalData.defs=l,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,t=this.animationItem.wrapper.offsetHeight,i=e/t,r=this.globalData.compSize.w/this.globalData.compSize.h,o,l,d,n;r>i?(o=e/this.globalData.compSize.w,l=e/this.globalData.compSize.w,d=0,n=(t-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):(o=t/this.globalData.compSize.h,l=t/this.globalData.compSize.h,d=(e-this.globalData.compSize.w*(t/this.globalData.compSize.h))/2,n=0);var S=this.resizerElem.style;S.webkitTransform="matrix3d("+o+",0,0,0,0,"+l+",0,0,0,0,1,0,"+d+","+n+",0,1)",S.transform=S.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,t=this.globalData.compSize.h,i,r=this.threeDElements.length;for(i=0;i<r;i+=1){var o=this.threeDElements[i].perspectiveElem.style;o.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(t,2))+"px",o.perspective=o.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var t,i=e.length,r=createTag("div");for(t=0;t<i;t+=1)if(e[t].xt){var o=this.createComp(e[t],r,this.globalData.comp,null);o.initExpressions(),this.globalData.projectInterface.registerComposition(o)}};function HCompElement(e,t,i){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,t){for(var i=0,r;i<t;)this.elements[i]&&this.elements[i].getBaseElement&&(r=this.elements[i].getBaseElement()),i+=1;r?this.layerElement.insertBefore(e,r):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&t.hideOnTransparent===!1),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"},runExpressions:!t||t.runExpressions===void 0||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function t(i){for(var r=0,o=e.layers.length;r<o;){if(e.layers[r].nm===i||e.layers[r].ind===i)return e.elements[r].layerInterface;r+=1}return null}return Object.defineProperty(t,"_name",{value:e.data.nm}),t.layer=t,t.pixelAspect=1,t.height=e.data.h||e.globalData.compSize.h,t.width=e.data.w||e.globalData.compSize.w,t.pixelAspect=1,t.frameDuration=1/e.globalData.frameRate,t.displayStartTime=0,t.numLayers=e.layers.length,t}}();function _typeof$2(e){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$2(e)}function seedRandom(e,t){var i=this,r=256,o=6,l=52,d="random",n=t.pow(r,o),S=t.pow(2,l),C=S*2,I=r-1,z;function $(le,he,me){var ge=[];he=he===!0?{entropy:!0}:he||{};var xt=ue(ie(he.entropy?[le,se(e)]:le===null?ne():le,3),ge),Et=new k(ge),Lt=function(){for(var Ht=Et.g(o),It=n,Yt=0;Ht<S;)Ht=(Ht+Yt)*r,It*=r,Yt=Et.g(1);for(;Ht>=C;)Ht/=2,It/=2,Yt>>>=1;return(Ht+Yt)/It};return Lt.int32=function(){return Et.g(4)|0},Lt.quick=function(){return Et.g(4)/4294967296},Lt.double=Lt,ue(se(Et.S),e),(he.pass||me||function(Zt,Ht,It,Yt){return Yt&&(Yt.S&&Y(Yt,Et),Zt.state=function(){return Y(Et,{})}),It?(t[d]=Zt,Ht):Zt})(Lt,xt,"global"in he?he.global:this==t,he.state)}t["seed"+d]=$;function k(le){var he,me=le.length,ge=this,xt=0,Et=ge.i=ge.j=0,Lt=ge.S=[];for(me||(le=[me++]);xt<r;)Lt[xt]=xt++;for(xt=0;xt<r;xt++)Lt[xt]=Lt[Et=I&Et+le[xt%me]+(he=Lt[xt])],Lt[Et]=he;ge.g=function(Zt){for(var Ht,It=0,Yt=ge.i,ri=ge.j,ei=ge.S;Zt--;)Ht=ei[Yt=I&Yt+1],It=It*r+ei[I&(ei[Yt]=ei[ri=I&ri+Ht])+(ei[ri]=Ht)];return ge.i=Yt,ge.j=ri,It}}function Y(le,he){return he.i=le.i,he.j=le.j,he.S=le.S.slice(),he}function ie(le,he){var me=[],ge=_typeof$2(le),xt;if(he&&ge=="object")for(xt in le)try{me.push(ie(le[xt],he-1))}catch{}return me.length?me:ge=="string"?le:le+"\0"}function ue(le,he){for(var me=le+"",ge,xt=0;xt<me.length;)he[I&xt]=I&(ge^=he[I&xt]*19)+me.charCodeAt(xt++);return se(he)}function ne(){try{var le=new Uint8Array(r);return(i.crypto||i.msCrypto).getRandomValues(le),se(le)}catch{var he=i.navigator,me=he&&he.plugins;return[+new Date,i,me,i.screen,se(e)]}}function se(le){return String.fromCharCode.apply(0,le)}ue(t.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,t){return e==="number"||t instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var t=_typeof$1(e);if(t==="number"||e instanceof Number||t==="boolean")return-e;if($bm_isInstanceOfArray(e)){var i,r=e.length,o=[];for(i=0;i<r;i+=1)o[i]=-e[i];return o}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,t){var i=_typeof$1(e),r=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(r,t)||i==="string"||r==="string")return e+t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return e=e.slice(0),e[0]+=t,e;if(isNumerable(i,e)&&$bm_isInstanceOfArray(t))return t=t.slice(0),t[0]=e+t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var o=0,l=e.length,d=t.length,n=[];o<l||o<d;)(typeof e[o]=="number"||e[o]instanceof Number)&&(typeof t[o]=="number"||t[o]instanceof Number)?n[o]=e[o]+t[o]:n[o]=t[o]===void 0?e[o]:e[o]||t[o],o+=1;return n}return 0}var add=sum;function sub(e,t){var i=_typeof$1(e),r=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(r,t))return i==="string"&&(e=parseInt(e,10)),r==="string"&&(t=parseInt(t,10)),e-t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return e=e.slice(0),e[0]-=t,e;if(isNumerable(i,e)&&$bm_isInstanceOfArray(t))return t=t.slice(0),t[0]=e-t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var o=0,l=e.length,d=t.length,n=[];o<l||o<d;)(typeof e[o]=="number"||e[o]instanceof Number)&&(typeof t[o]=="number"||t[o]instanceof Number)?n[o]=e[o]-t[o]:n[o]=t[o]===void 0?e[o]:e[o]||t[o],o+=1;return n}return 0}function mul(e,t){var i=_typeof$1(e),r=_typeof$1(t),o;if(isNumerable(i,e)&&isNumerable(r,t))return e*t;var l,d;if($bm_isInstanceOfArray(e)&&isNumerable(r,t)){for(d=e.length,o=createTypedArray("float32",d),l=0;l<d;l+=1)o[l]=e[l]*t;return o}if(isNumerable(i,e)&&$bm_isInstanceOfArray(t)){for(d=t.length,o=createTypedArray("float32",d),l=0;l<d;l+=1)o[l]=e*t[l];return o}return 0}function div(e,t){var i=_typeof$1(e),r=_typeof$1(t),o;if(isNumerable(i,e)&&isNumerable(r,t))return e/t;var l,d;if($bm_isInstanceOfArray(e)&&isNumerable(r,t)){for(d=e.length,o=createTypedArray("float32",d),l=0;l<d;l+=1)o[l]=e[l]/t;return o}if(isNumerable(i,e)&&$bm_isInstanceOfArray(t)){for(d=t.length,o=createTypedArray("float32",d),l=0;l<d;l+=1)o[l]=e/t[l];return o}return 0}function mod(e,t){return typeof e=="string"&&(e=parseInt(e,10)),typeof t=="string"&&(t=parseInt(t,10)),e%t}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,t,i){if(t>i){var r=i;i=t,t=r}return Math.min(Math.max(e,t),i)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,t){if(typeof e=="number"||e instanceof Number)return t=t||0,Math.abs(e-t);t||(t=helperLengthArray);var i,r=Math.min(e.length,t.length),o=0;for(i=0;i<r;i+=1)o+=Math.pow(t[i]-e[i],2);return Math.sqrt(o)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var t=e[0],i=e[1],r=e[2],o=Math.max(t,i,r),l=Math.min(t,i,r),d,n,S=(o+l)/2;if(o===l)d=0,n=0;else{var C=o-l;switch(n=S>.5?C/(2-o-l):C/(o+l),o){case t:d=(i-r)/C+(i<r?6:0);break;case i:d=(r-t)/C+2;break;case r:d=(t-i)/C+4;break}d/=6}return[d,n,S,e[3]]}function hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function hslToRgb(e){var t=e[0],i=e[1],r=e[2],o,l,d;if(i===0)o=r,d=r,l=r;else{var n=r<.5?r*(1+i):r+i-r*i,S=2*r-n;o=hue2rgb(S,n,t+1/3),l=hue2rgb(S,n,t),d=hue2rgb(S,n,t-1/3)}return[o,l,d,e[3]]}function linear(e,t,i,r,o){if((r===void 0||o===void 0)&&(r=t,o=i,t=0,i=1),i<t){var l=i;i=t,t=l}if(e<=t)return r;if(e>=i)return o;var d=i===t?0:(e-t)/(i-t);if(!r.length)return r+(o-r)*d;var n,S=r.length,C=createTypedArray("float32",S);for(n=0;n<S;n+=1)C[n]=r[n]+(o[n]-r[n])*d;return C}function random(e,t){if(t===void 0&&(e===void 0?(e=0,t=1):(t=e,e=void 0)),t.length){var i,r=t.length;e||(e=createTypedArray("float32",r));var o=createTypedArray("float32",r),l=BMMath.random();for(i=0;i<r;i+=1)o[i]=e[i]+l*(t[i]-e[i]);return o}e===void 0&&(e=0);var d=BMMath.random();return e+d*(t-e)}function createPath(e,t,i,r){var o,l=e.length,d=shapePool.newElement();d.setPathData(!!r,l);var n=[0,0],S,C;for(o=0;o<l;o+=1)S=t&&t[o]?t[o]:n,C=i&&i[o]?i[o]:n,d.setTripleAt(e[o][0],e[o][1],C[0]+e[o][0],C[1]+e[o][1],S[0]+e[o][0],S[1]+e[o][1],o,!0);return d}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(t,i){var r,o,l=this.pv.length?this.pv.length:1,d=createTypedArray("float32",l);t=5;var n=Math.floor(time*t);for(r=0,o=0;r<n;){for(o=0;o<l;o+=1)d[o]+=-i+i*2*BMMath.random();r+=1}var S=time*t,C=S-Math.floor(S),I=createTypedArray("float32",l);if(l>1){for(o=0;o<l;o+=1)I[o]=this.pv[o]+d[o]+(-i+i*2*BMMath.random())*C;return I}return this.pv+d[0]+(-i+i*2*BMMath.random())*C}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,t){return loopIn(e,t,!0)}function loopOutDuration(e,t){return loopOut(e,t,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,t){var i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],r=Math.atan2(i[0],Math.sqrt(i[1]*i[1]+i[2]*i[2]))/degToRads,o=-Math.atan2(i[1],i[2])/degToRads;return[o,r,0]}function easeOut(e,t,i,r,o){return applyEase(easeOutBez,e,t,i,r,o)}function easeIn(e,t,i,r,o){return applyEase(easeInBez,e,t,i,r,o)}function ease(e,t,i,r,o){return applyEase(easeInOutBez,e,t,i,r,o)}function applyEase(e,t,i,r,o,l){o===void 0?(o=i,l=r):t=(t-i)/(r-i),t>1?t=1:t<0&&(t=0);var d=e(t);if($bm_isInstanceOfArray(o)){var n,S=o.length,C=createTypedArray("float32",S);for(n=0;n<S;n+=1)C[n]=(l[n]-o[n])*d+o[n];return C}return(l-o)*d+o}function nearestKey(e){var t,i=data.k.length,r,o;if(!data.k.length||typeof data.k[0]=="number")r=0,o=0;else if(r=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)r=1,o=data.k[0].t;else{for(t=0;t<i-1;t+=1)if(e===data.k[t].t){r=t+1,o=data.k[t].t;break}else if(e>data.k[t].t&&e<data.k[t+1].t){e-data.k[t].t>data.k[t+1].t-e?(r=t+2,o=data.k[t+1].t):(r=t+1,o=data.k[t].t);break}r===-1&&(r=t+1,o=data.k[t].t)}var l={};return l.index=r,l.time=o/elem.comp.globalData.frameRate,l}function key(e){var t,i,r;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,t={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var o=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(r=o.length,i=0;i<r;i+=1)t[i]=o[i],t.value[i]=o[i];return t}function framesToTime(e,t){return t||(t=elem.comp.globalData.frameRate),e/t}function timeToFrames(e,t){return!e&&e!==0&&(e=time),t||(t=elem.comp.globalData.frameRate),e*t}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,t){return typeof value=="string"?t===void 0?value.substring(e):value.substring(e,t):""}function substr(e,t){return typeof value=="string"?t===void 0?value.substr(e):value.substr(e,t):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=t,e.resetFrame=ExpressionManager.resetFrame;function t(i){var r=0,o=[];function l(){r+=1}function d(){r-=1,r===0&&S()}function n(C){o.indexOf(C)===-1&&o.push(C)}function S(){var C,I=o.length;for(C=0;C<I;C+=1)o[C].release();o.length=0}i.renderer.compInterface=CompExpressionInterface(i.renderer),i.renderer.globalData.projectInterface.registerComposition(i.renderer),i.renderer.globalData.pushExpression=l,i.renderer.globalData.popExpression=d,i.renderer.globalData.registerExpressionProperty=n}return e}(),MaskManagerInterface=function(){function e(i,r){this._mask=i,this._data=r}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var t=function(r){var o=createSizedArray(r.viewData.length),l,d=r.viewData.length;for(l=0;l<d;l+=1)o[l]=new e(r.viewData[l],r.masksProperties[l]);var n=function(C){for(l=0;l<d;){if(r.masksProperties[l].nm===C)return o[l];l+=1}return null};return n};return t}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},t={pv:[0,0,0],v:[0,0,0],mult:1};function i(d,n,S){Object.defineProperty(d,"velocity",{get:function(){return n.getVelocityAtTime(n.comp.currentFrame)}}),d.numKeys=n.keyframes?n.keyframes.length:0,d.key=function(C){if(!d.numKeys)return 0;var I="";"s"in n.keyframes[C-1]?I=n.keyframes[C-1].s:"e"in n.keyframes[C-2]?I=n.keyframes[C-2].e:I=n.keyframes[C-2].s;var z=S==="unidimensional"?new Number(I):Object.assign({},I);return z.time=n.keyframes[C-1].t/n.elem.comp.globalData.frameRate,z.value=S==="unidimensional"?I[0]:I,z},d.valueAtTime=n.getValueAtTime,d.speedAtTime=n.getSpeedAtTime,d.velocityAtTime=n.getVelocityAtTime,d.propertyGroup=n.propertyGroup}function r(d){(!d||!("pv"in d))&&(d=e);var n=1/d.mult,S=d.pv*n,C=new Number(S);return C.value=S,i(C,d,"unidimensional"),function(){return d.k&&d.getValue(),S=d.v*n,C.value!==S&&(C=new Number(S),C.value=S,C[0]=S,i(C,d,"unidimensional")),C}}function o(d){(!d||!("pv"in d))&&(d=t);var n=1/d.mult,S=d.data&&d.data.l||d.pv.length,C=createTypedArray("float32",S),I=createTypedArray("float32",S);return C.value=I,i(C,d,"multidimensional"),function(){d.k&&d.getValue();for(var z=0;z<S;z+=1)I[z]=d.v[z]*n,C[z]=I[z];return C}}function l(){return e}return function(d){return d?d.propType==="unidimensional"?r(d):o(d):l}}(),TransformExpressionInterface=function(){return function(e){function t(d){switch(d){case"scale":case"Scale":case"ADBE Scale":case 6:return t.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return t.rotation;case"ADBE Rotate X":return t.xRotation;case"ADBE Rotate Y":return t.yRotation;case"position":case"Position":case"ADBE Position":case 2:return t.position;case"ADBE Position_0":return t.xPosition;case"ADBE Position_1":return t.yPosition;case"ADBE Position_2":return t.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return t.anchorPoint;case"opacity":case"Opacity":case 11:return t.opacity;default:return null}}Object.defineProperty(t,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(t,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(t,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(t,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(t,"scale",{get:ExpressionPropertyInterface(e.s)});var i,r,o,l;return e.p?l=ExpressionPropertyInterface(e.p):(i=ExpressionPropertyInterface(e.px),r=ExpressionPropertyInterface(e.py),e.pz&&(o=ExpressionPropertyInterface(e.pz))),Object.defineProperty(t,"position",{get:function(){return e.p?l():[i(),r(),o?o():0]}}),Object.defineProperty(t,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(t,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(t,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(t,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(t,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(t,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(t,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(t,"orientation",{get:ExpressionPropertyInterface(e.or)}),t}}(),LayerExpressionInterface=function(){function e(C){var I=new Matrix;if(C!==void 0){var z=this._elem.finalTransform.mProp.getValueAtTime(C);z.clone(I)}else{var $=this._elem.finalTransform.mProp;$.applyToMatrix(I)}return I}function t(C,I){var z=this.getMatrix(I);return z.props[12]=0,z.props[13]=0,z.props[14]=0,this.applyPoint(z,C)}function i(C,I){var z=this.getMatrix(I);return this.applyPoint(z,C)}function r(C,I){var z=this.getMatrix(I);return z.props[12]=0,z.props[13]=0,z.props[14]=0,this.invertPoint(z,C)}function o(C,I){var z=this.getMatrix(I);return this.invertPoint(z,C)}function l(C,I){if(this._elem.hierarchy&&this._elem.hierarchy.length){var z,$=this._elem.hierarchy.length;for(z=0;z<$;z+=1)this._elem.hierarchy[z].finalTransform.mProp.applyToMatrix(C)}return C.applyToPointArray(I[0],I[1],I[2]||0)}function d(C,I){if(this._elem.hierarchy&&this._elem.hierarchy.length){var z,$=this._elem.hierarchy.length;for(z=0;z<$;z+=1)this._elem.hierarchy[z].finalTransform.mProp.applyToMatrix(C)}return C.inversePoint(I)}function n(C){var I=new Matrix;if(I.reset(),this._elem.finalTransform.mProp.applyToMatrix(I),this._elem.hierarchy&&this._elem.hierarchy.length){var z,$=this._elem.hierarchy.length;for(z=0;z<$;z+=1)this._elem.hierarchy[z].finalTransform.mProp.applyToMatrix(I);return I.inversePoint(C)}return I.inversePoint(C)}function S(){return[1,1,1,1]}return function(C){var I;function z(ie){k.mask=new MaskManagerInterface(ie,C)}function $(ie){k.effect=ie}function k(ie){switch(ie){case"ADBE Root Vectors Group":case"Contents":case 2:return k.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return I;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return k.effect;case"ADBE Text Properties":return k.textInterface;default:return null}}k.getMatrix=e,k.invertPoint=d,k.applyPoint=l,k.toWorld=i,k.toWorldVec=t,k.fromWorld=o,k.fromWorldVec=r,k.toComp=i,k.fromComp=n,k.sampleImage=S,k.sourceRectAtTime=C.sourceRectAtTime.bind(C),k._elem=C,I=TransformExpressionInterface(C.finalTransform.mProp);var Y=getDescriptor(I,"anchorPoint");return Object.defineProperties(k,{hasParent:{get:function(){return C.hierarchy.length}},parent:{get:function(){return C.hierarchy[0].layerInterface}},rotation:getDescriptor(I,"rotation"),scale:getDescriptor(I,"scale"),position:getDescriptor(I,"position"),opacity:getDescriptor(I,"opacity"),anchorPoint:Y,anchor_point:Y,transform:{get:function(){return I}},active:{get:function(){return C.isInRange}}}),k.startTime=C.data.st,k.index=C.data.ind,k.source=C.data.refId,k.height=C.data.ty===0?C.data.h:100,k.width=C.data.ty===0?C.data.w:100,k.inPoint=C.data.ip/C.comp.globalData.frameRate,k.outPoint=C.data.op/C.comp.globalData.frameRate,k._name=C.data.nm,k.registerMaskInterface=z,k.registerEffectsInterface=$,k}}(),propertyGroupFactory=function(){return function(e,t){return function(i){return i=i===void 0?1:i,i<=0?e:t(i-1)}}}(),PropertyInterface=function(){return function(e,t){var i={_name:e};function r(o){return o=o===void 0?1:o,o<=0?i:t(o-1)}return r}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:t};function t(o,l){if(o.effectsManager){var d=[],n=o.data.ef,S,C=o.effectsManager.effectElements.length;for(S=0;S<C;S+=1)d.push(i(n[S],o.effectsManager.effectElements[S],l,o));var I=o.data.ef||[],z=function(k){for(S=0,C=I.length;S<C;){if(k===I[S].nm||k===I[S].mn||k===I[S].ix)return d[S];S+=1}return null};return Object.defineProperty(z,"numProperties",{get:function(){return I.length}}),z}return null}function i(o,l,d,n){function S(k){for(var Y=o.ef,ie=0,ue=Y.length;ie<ue;){if(k===Y[ie].nm||k===Y[ie].mn||k===Y[ie].ix)return Y[ie].ty===5?I[ie]:I[ie]();ie+=1}throw new Error}var C=propertyGroupFactory(S,d),I=[],z,$=o.ef.length;for(z=0;z<$;z+=1)o.ef[z].ty===5?I.push(i(o.ef[z],l.effectElements[z],l.effectElements[z].propertyGroup,n)):I.push(r(l.effectElements[z],o.ef[z].ty,n,C));return o.mn==="ADBE Color Control"&&Object.defineProperty(S,"color",{get:function(){return I[0]()}}),Object.defineProperties(S,{numProperties:{get:function(){return o.np}},_name:{value:o.nm},propertyGroup:{value:C}}),S.enabled=o.en!==0,S.active=S.enabled,S}function r(o,l,d,n){var S=ExpressionPropertyInterface(o.p);function C(){return l===10?d.comp.compInterface(o.p.v):S()}return o.p.setGroupProperty&&o.p.setGroupProperty(PropertyInterface("",n)),C}return e}(),ShapePathInterface=function(){return function(t,i,r){var o=i.sh;function l(n){return n==="Shape"||n==="shape"||n==="Path"||n==="path"||n==="ADBE Vector Shape"||n===2?l.path:null}var d=propertyGroupFactory(l,r);return o.setGroupProperty(PropertyInterface("Path",d)),Object.defineProperties(l,{path:{get:function(){return o.k&&o.getValue(),o}},shape:{get:function(){return o.k&&o.getValue(),o}},_name:{value:t.nm},ix:{value:t.ix},propertyIndex:{value:t.ix},mn:{value:t.mn},propertyGroup:{value:r}}),l}}(),ShapeExpressionInterface=function(){function e(Y,ie,ue){var ne=[],se,le=Y?Y.length:0;for(se=0;se<le;se+=1)Y[se].ty==="gr"?ne.push(i(Y[se],ie[se],ue)):Y[se].ty==="fl"?ne.push(r(Y[se],ie[se],ue)):Y[se].ty==="st"?ne.push(d(Y[se],ie[se],ue)):Y[se].ty==="tm"?ne.push(n(Y[se],ie[se],ue)):Y[se].ty==="tr"||(Y[se].ty==="el"?ne.push(C(Y[se],ie[se],ue)):Y[se].ty==="sr"?ne.push(I(Y[se],ie[se],ue)):Y[se].ty==="sh"?ne.push(ShapePathInterface(Y[se],ie[se],ue)):Y[se].ty==="rc"?ne.push(z(Y[se],ie[se],ue)):Y[se].ty==="rd"?ne.push($(Y[se],ie[se],ue)):Y[se].ty==="rp"?ne.push(k(Y[se],ie[se],ue)):Y[se].ty==="gf"?ne.push(o(Y[se],ie[se],ue)):ne.push(l(Y[se],ie[se])));return ne}function t(Y,ie,ue){var ne,se=function(me){for(var ge=0,xt=ne.length;ge<xt;){if(ne[ge]._name===me||ne[ge].mn===me||ne[ge].propertyIndex===me||ne[ge].ix===me||ne[ge].ind===me)return ne[ge];ge+=1}return typeof me=="number"?ne[me-1]:null};se.propertyGroup=propertyGroupFactory(se,ue),ne=e(Y.it,ie.it,se.propertyGroup),se.numProperties=ne.length;var le=S(Y.it[Y.it.length-1],ie.it[ie.it.length-1],se.propertyGroup);return se.transform=le,se.propertyIndex=Y.cix,se._name=Y.nm,se}function i(Y,ie,ue){var ne=function(me){switch(me){case"ADBE Vectors Group":case"Contents":case 2:return ne.content;default:return ne.transform}};ne.propertyGroup=propertyGroupFactory(ne,ue);var se=t(Y,ie,ne.propertyGroup),le=S(Y.it[Y.it.length-1],ie.it[ie.it.length-1],ne.propertyGroup);return ne.content=se,ne.transform=le,Object.defineProperty(ne,"_name",{get:function(){return Y.nm}}),ne.numProperties=Y.np,ne.propertyIndex=Y.ix,ne.nm=Y.nm,ne.mn=Y.mn,ne}function r(Y,ie,ue){function ne(se){return se==="Color"||se==="color"?ne.color:se==="Opacity"||se==="opacity"?ne.opacity:null}return Object.defineProperties(ne,{color:{get:ExpressionPropertyInterface(ie.c)},opacity:{get:ExpressionPropertyInterface(ie.o)},_name:{value:Y.nm},mn:{value:Y.mn}}),ie.c.setGroupProperty(PropertyInterface("Color",ue)),ie.o.setGroupProperty(PropertyInterface("Opacity",ue)),ne}function o(Y,ie,ue){function ne(se){return se==="Start Point"||se==="start point"?ne.startPoint:se==="End Point"||se==="end point"?ne.endPoint:se==="Opacity"||se==="opacity"?ne.opacity:null}return Object.defineProperties(ne,{startPoint:{get:ExpressionPropertyInterface(ie.s)},endPoint:{get:ExpressionPropertyInterface(ie.e)},opacity:{get:ExpressionPropertyInterface(ie.o)},type:{get:function(){return"a"}},_name:{value:Y.nm},mn:{value:Y.mn}}),ie.s.setGroupProperty(PropertyInterface("Start Point",ue)),ie.e.setGroupProperty(PropertyInterface("End Point",ue)),ie.o.setGroupProperty(PropertyInterface("Opacity",ue)),ne}function l(){function Y(){return null}return Y}function d(Y,ie,ue){var ne=propertyGroupFactory(xt,ue),se=propertyGroupFactory(ge,ne);function le(Et){Object.defineProperty(ge,Y.d[Et].nm,{get:ExpressionPropertyInterface(ie.d.dataProps[Et].p)})}var he,me=Y.d?Y.d.length:0,ge={};for(he=0;he<me;he+=1)le(he),ie.d.dataProps[he].p.setGroupProperty(se);function xt(Et){return Et==="Color"||Et==="color"?xt.color:Et==="Opacity"||Et==="opacity"?xt.opacity:Et==="Stroke Width"||Et==="stroke width"?xt.strokeWidth:null}return Object.defineProperties(xt,{color:{get:ExpressionPropertyInterface(ie.c)},opacity:{get:ExpressionPropertyInterface(ie.o)},strokeWidth:{get:ExpressionPropertyInterface(ie.w)},dash:{get:function(){return ge}},_name:{value:Y.nm},mn:{value:Y.mn}}),ie.c.setGroupProperty(PropertyInterface("Color",ne)),ie.o.setGroupProperty(PropertyInterface("Opacity",ne)),ie.w.setGroupProperty(PropertyInterface("Stroke Width",ne)),xt}function n(Y,ie,ue){function ne(le){return le===Y.e.ix||le==="End"||le==="end"?ne.end:le===Y.s.ix?ne.start:le===Y.o.ix?ne.offset:null}var se=propertyGroupFactory(ne,ue);return ne.propertyIndex=Y.ix,ie.s.setGroupProperty(PropertyInterface("Start",se)),ie.e.setGroupProperty(PropertyInterface("End",se)),ie.o.setGroupProperty(PropertyInterface("Offset",se)),ne.propertyIndex=Y.ix,ne.propertyGroup=ue,Object.defineProperties(ne,{start:{get:ExpressionPropertyInterface(ie.s)},end:{get:ExpressionPropertyInterface(ie.e)},offset:{get:ExpressionPropertyInterface(ie.o)},_name:{value:Y.nm}}),ne.mn=Y.mn,ne}function S(Y,ie,ue){function ne(le){return Y.a.ix===le||le==="Anchor Point"?ne.anchorPoint:Y.o.ix===le||le==="Opacity"?ne.opacity:Y.p.ix===le||le==="Position"?ne.position:Y.r.ix===le||le==="Rotation"||le==="ADBE Vector Rotation"?ne.rotation:Y.s.ix===le||le==="Scale"?ne.scale:Y.sk&&Y.sk.ix===le||le==="Skew"?ne.skew:Y.sa&&Y.sa.ix===le||le==="Skew Axis"?ne.skewAxis:null}var se=propertyGroupFactory(ne,ue);return ie.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",se)),ie.transform.mProps.p.setGroupProperty(PropertyInterface("Position",se)),ie.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",se)),ie.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",se)),ie.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",se)),ie.transform.mProps.sk&&(ie.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",se)),ie.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",se))),ie.transform.op.setGroupProperty(PropertyInterface("Opacity",se)),Object.defineProperties(ne,{opacity:{get:ExpressionPropertyInterface(ie.transform.mProps.o)},position:{get:ExpressionPropertyInterface(ie.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(ie.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(ie.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(ie.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(ie.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(ie.transform.mProps.sa)},_name:{value:Y.nm}}),ne.ty="tr",ne.mn=Y.mn,ne.propertyGroup=ue,ne}function C(Y,ie,ue){function ne(he){return Y.p.ix===he?ne.position:Y.s.ix===he?ne.size:null}var se=propertyGroupFactory(ne,ue);ne.propertyIndex=Y.ix;var le=ie.sh.ty==="tm"?ie.sh.prop:ie.sh;return le.s.setGroupProperty(PropertyInterface("Size",se)),le.p.setGroupProperty(PropertyInterface("Position",se)),Object.defineProperties(ne,{size:{get:ExpressionPropertyInterface(le.s)},position:{get:ExpressionPropertyInterface(le.p)},_name:{value:Y.nm}}),ne.mn=Y.mn,ne}function I(Y,ie,ue){function ne(he){return Y.p.ix===he?ne.position:Y.r.ix===he?ne.rotation:Y.pt.ix===he?ne.points:Y.or.ix===he||he==="ADBE Vector Star Outer Radius"?ne.outerRadius:Y.os.ix===he?ne.outerRoundness:Y.ir&&(Y.ir.ix===he||he==="ADBE Vector Star Inner Radius")?ne.innerRadius:Y.is&&Y.is.ix===he?ne.innerRoundness:null}var se=propertyGroupFactory(ne,ue),le=ie.sh.ty==="tm"?ie.sh.prop:ie.sh;return ne.propertyIndex=Y.ix,le.or.setGroupProperty(PropertyInterface("Outer Radius",se)),le.os.setGroupProperty(PropertyInterface("Outer Roundness",se)),le.pt.setGroupProperty(PropertyInterface("Points",se)),le.p.setGroupProperty(PropertyInterface("Position",se)),le.r.setGroupProperty(PropertyInterface("Rotation",se)),Y.ir&&(le.ir.setGroupProperty(PropertyInterface("Inner Radius",se)),le.is.setGroupProperty(PropertyInterface("Inner Roundness",se))),Object.defineProperties(ne,{position:{get:ExpressionPropertyInterface(le.p)},rotation:{get:ExpressionPropertyInterface(le.r)},points:{get:ExpressionPropertyInterface(le.pt)},outerRadius:{get:ExpressionPropertyInterface(le.or)},outerRoundness:{get:ExpressionPropertyInterface(le.os)},innerRadius:{get:ExpressionPropertyInterface(le.ir)},innerRoundness:{get:ExpressionPropertyInterface(le.is)},_name:{value:Y.nm}}),ne.mn=Y.mn,ne}function z(Y,ie,ue){function ne(he){return Y.p.ix===he?ne.position:Y.r.ix===he?ne.roundness:Y.s.ix===he||he==="Size"||he==="ADBE Vector Rect Size"?ne.size:null}var se=propertyGroupFactory(ne,ue),le=ie.sh.ty==="tm"?ie.sh.prop:ie.sh;return ne.propertyIndex=Y.ix,le.p.setGroupProperty(PropertyInterface("Position",se)),le.s.setGroupProperty(PropertyInterface("Size",se)),le.r.setGroupProperty(PropertyInterface("Rotation",se)),Object.defineProperties(ne,{position:{get:ExpressionPropertyInterface(le.p)},roundness:{get:ExpressionPropertyInterface(le.r)},size:{get:ExpressionPropertyInterface(le.s)},_name:{value:Y.nm}}),ne.mn=Y.mn,ne}function $(Y,ie,ue){function ne(he){return Y.r.ix===he||he==="Round Corners 1"?ne.radius:null}var se=propertyGroupFactory(ne,ue),le=ie;return ne.propertyIndex=Y.ix,le.rd.setGroupProperty(PropertyInterface("Radius",se)),Object.defineProperties(ne,{radius:{get:ExpressionPropertyInterface(le.rd)},_name:{value:Y.nm}}),ne.mn=Y.mn,ne}function k(Y,ie,ue){function ne(he){return Y.c.ix===he||he==="Copies"?ne.copies:Y.o.ix===he||he==="Offset"?ne.offset:null}var se=propertyGroupFactory(ne,ue),le=ie;return ne.propertyIndex=Y.ix,le.c.setGroupProperty(PropertyInterface("Copies",se)),le.o.setGroupProperty(PropertyInterface("Offset",se)),Object.defineProperties(ne,{copies:{get:ExpressionPropertyInterface(le.c)},offset:{get:ExpressionPropertyInterface(le.o)},_name:{value:Y.nm}}),ne.mn=Y.mn,ne}return function(Y,ie,ue){var ne;function se(he){if(typeof he=="number")return he=he===void 0?1:he,he===0?ue:ne[he-1];for(var me=0,ge=ne.length;me<ge;){if(ne[me]._name===he)return ne[me];me+=1}return null}function le(){return ue}return se.propertyGroup=propertyGroupFactory(se,le),ne=e(Y,ie,se.propertyGroup),se.numProperties=ne.length,se._name="Contents",se}}(),TextExpressionInterface=function(){return function(e){var t;function i(r){switch(r){case"ADBE Text Document":return i.sourceText;default:return null}}return Object.defineProperty(i,"sourceText",{get:function(){e.textProperty.getValue();var o=e.textProperty.currentData.t;return(!t||o!==t.value)&&(t=new String(o),t.value=o||new String(o),Object.defineProperty(t,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),t}}),i}}();function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var FootageInterface=function(){var e=function(r){var o="",l=r.getFootageData();function d(){return o="",l=r.getFootageData(),n}function n(S){if(l[S])return o=S,l=l[S],_typeof(l)==="object"?n:l;var C=S.indexOf(o);if(C!==-1){var I=parseInt(S.substr(C+o.length),10);return l=l[I],_typeof(l)==="object"?n:l}return""}return d},t=function(r){function o(l){return l==="Outline"?o.outlineInterface():null}return o._name="Outline",o.outlineInterface=e(r),o};return function(i){function r(o){return o==="Data"?r.dataInterface:null}return r._name="Data",r.dataInterface=t(i),r}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(d,n,S){n.x&&(S.k=!0,S.x=!0,S.initiateExpression=ExpressionManager.initiateExpression,S.effectsSequence.push(S.initiateExpression(d,n,S).bind(S)))}function t(d){return d*=this.elem.globalData.frameRate,d-=this.offsetTime,d!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<d?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(d,this._cachingAtTime),this._cachingAtTime.lastFrame=d),this._cachingAtTime.value}function i(d){var n=-.01,S=this.getValueAtTime(d),C=this.getValueAtTime(d+n),I=0;if(S.length){var z;for(z=0;z<S.length;z+=1)I+=Math.pow(C[z]-S[z],2);I=Math.sqrt(I)*100}else I=0;return I}function r(d){if(this.vel!==void 0)return this.vel;var n=-.001,S=this.getValueAtTime(d),C=this.getValueAtTime(d+n),I;if(S.length){I=createTypedArray("float32",S.length);var z;for(z=0;z<S.length;z+=1)I[z]=(C[z]-S[z])/n}else I=(C-S)/n;return I}function o(){return this.pv}function l(d){this.propertyGroup=d}return{searchExpressions:e,getSpeedAtTime:i,getVelocityAtTime:r,getValueAtTime:t,getStaticValueAtTime:o,setGroupProperty:l}}();function addPropertyDecorator(){function e($,k,Y){if(!this.k||!this.keyframes)return this.pv;$=$?$.toLowerCase():"";var ie=this.comp.renderedFrame,ue=this.keyframes,ne=ue[ue.length-1].t;if(ie<=ne)return this.pv;var se,le;Y?(k?se=Math.abs(ne-this.elem.comp.globalData.frameRate*k):se=Math.max(0,ne-this.elem.data.ip),le=ne-se):((!k||k>ue.length-1)&&(k=ue.length-1),le=ue[ue.length-1-k].t,se=ne-le);var he,me,ge;if($==="pingpong"){var xt=Math.floor((ie-le)/se);if(xt%2!==0)return this.getValueAtTime((se-(ie-le)%se+le)/this.comp.globalData.frameRate,0)}else if($==="offset"){var Et=this.getValueAtTime(le/this.comp.globalData.frameRate,0),Lt=this.getValueAtTime(ne/this.comp.globalData.frameRate,0),Zt=this.getValueAtTime(((ie-le)%se+le)/this.comp.globalData.frameRate,0),Ht=Math.floor((ie-le)/se);if(this.pv.length){for(ge=new Array(Et.length),me=ge.length,he=0;he<me;he+=1)ge[he]=(Lt[he]-Et[he])*Ht+Zt[he];return ge}return(Lt-Et)*Ht+Zt}else if($==="continue"){var It=this.getValueAtTime(ne/this.comp.globalData.frameRate,0),Yt=this.getValueAtTime((ne-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(ge=new Array(It.length),me=ge.length,he=0;he<me;he+=1)ge[he]=It[he]+(It[he]-Yt[he])*((ie-ne)/this.comp.globalData.frameRate)/5e-4;return ge}return It+(It-Yt)*((ie-ne)/.001)}return this.getValueAtTime(((ie-le)%se+le)/this.comp.globalData.frameRate,0)}function t($,k,Y){if(!this.k)return this.pv;$=$?$.toLowerCase():"";var ie=this.comp.renderedFrame,ue=this.keyframes,ne=ue[0].t;if(ie>=ne)return this.pv;var se,le;Y?(k?se=Math.abs(this.elem.comp.globalData.frameRate*k):se=Math.max(0,this.elem.data.op-ne),le=ne+se):((!k||k>ue.length-1)&&(k=ue.length-1),le=ue[k].t,se=le-ne);var he,me,ge;if($==="pingpong"){var xt=Math.floor((ne-ie)/se);if(xt%2===0)return this.getValueAtTime(((ne-ie)%se+ne)/this.comp.globalData.frameRate,0)}else if($==="offset"){var Et=this.getValueAtTime(ne/this.comp.globalData.frameRate,0),Lt=this.getValueAtTime(le/this.comp.globalData.frameRate,0),Zt=this.getValueAtTime((se-(ne-ie)%se+ne)/this.comp.globalData.frameRate,0),Ht=Math.floor((ne-ie)/se)+1;if(this.pv.length){for(ge=new Array(Et.length),me=ge.length,he=0;he<me;he+=1)ge[he]=Zt[he]-(Lt[he]-Et[he])*Ht;return ge}return Zt-(Lt-Et)*Ht}else if($==="continue"){var It=this.getValueAtTime(ne/this.comp.globalData.frameRate,0),Yt=this.getValueAtTime((ne+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(ge=new Array(It.length),me=ge.length,he=0;he<me;he+=1)ge[he]=It[he]+(It[he]-Yt[he])*(ne-ie)/.001;return ge}return It+(It-Yt)*(ne-ie)/.001}return this.getValueAtTime((se-((ne-ie)%se+ne))/this.comp.globalData.frameRate,0)}function i($,k){if(!this.k)return this.pv;if($=($||.4)*.5,k=Math.floor(k||5),k<=1)return this.pv;var Y=this.comp.renderedFrame/this.comp.globalData.frameRate,ie=Y-$,ue=Y+$,ne=k>1?(ue-ie)/(k-1):1,se=0,le=0,he;this.pv.length?he=createTypedArray("float32",this.pv.length):he=0;for(var me;se<k;){if(me=this.getValueAtTime(ie+se*ne),this.pv.length)for(le=0;le<this.pv.length;le+=1)he[le]+=me[le];else he+=me;se+=1}if(this.pv.length)for(le=0;le<this.pv.length;le+=1)he[le]/=k;else he/=k;return he}function r($){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var k=this._transformCachingAtTime.v;if(k.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Y=this.a.getValueAtTime($);k.translate(-Y[0]*this.a.mult,-Y[1]*this.a.mult,Y[2]*this.a.mult)}if(this.appliedTransformations<2){var ie=this.s.getValueAtTime($);k.scale(ie[0]*this.s.mult,ie[1]*this.s.mult,ie[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var ue=this.sk.getValueAtTime($),ne=this.sa.getValueAtTime($);k.skewFromAxis(-ue*this.sk.mult,ne*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var se=this.r.getValueAtTime($);k.rotate(-se*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var le=this.rz.getValueAtTime($),he=this.ry.getValueAtTime($),me=this.rx.getValueAtTime($),ge=this.or.getValueAtTime($);k.rotateZ(-le*this.rz.mult).rotateY(he*this.ry.mult).rotateX(me*this.rx.mult).rotateZ(-ge[2]*this.or.mult).rotateY(ge[1]*this.or.mult).rotateX(ge[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var xt=this.px.getValueAtTime($),Et=this.py.getValueAtTime($);if(this.data.p.z){var Lt=this.pz.getValueAtTime($);k.translate(xt*this.px.mult,Et*this.py.mult,-Lt*this.pz.mult)}else k.translate(xt*this.px.mult,Et*this.py.mult,0)}else{var Zt=this.p.getValueAtTime($);k.translate(Zt[0]*this.p.mult,Zt[1]*this.p.mult,-Zt[2]*this.p.mult)}return k}function o(){return this.v.clone(new Matrix)}var l=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function($,k,Y){var ie=l($,k,Y);return ie.dynamicProperties.length?ie.getValueAtTime=r.bind(ie):ie.getValueAtTime=o.bind(ie),ie.setGroupProperty=expressionHelpers.setGroupProperty,ie};var d=PropertyFactory.getProp;PropertyFactory.getProp=function($,k,Y,ie,ue){var ne=d($,k,Y,ie,ue);ne.kf?ne.getValueAtTime=expressionHelpers.getValueAtTime.bind(ne):ne.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(ne),ne.setGroupProperty=expressionHelpers.setGroupProperty,ne.loopOut=e,ne.loopIn=t,ne.smooth=i,ne.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(ne),ne.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(ne),ne.numKeys=k.a===1?k.k.length:0,ne.propertyIndex=k.ix;var se=0;return Y!==0&&(se=createTypedArray("float32",k.a===1?k.k[0].s.length:k.k.length)),ne._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:se},expressionHelpers.searchExpressions($,k,ne),ne.k&&ue.addDynamicProperty(ne),ne};function n($){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),$*=this.elem.globalData.frameRate,$-=this.offsetTime,$!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<$?this._caching.lastIndex:0,this._cachingAtTime.lastTime=$,this.interpolateShape($,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var S=ShapePropertyFactory.getConstructorFunction(),C=ShapePropertyFactory.getKeyframedConstructorFunction();function I(){}I.prototype={vertices:function(k,Y){this.k&&this.getValue();var ie=this.v;Y!==void 0&&(ie=this.getValueAtTime(Y,0));var ue,ne=ie._length,se=ie[k],le=ie.v,he=createSizedArray(ne);for(ue=0;ue<ne;ue+=1)k==="i"||k==="o"?he[ue]=[se[ue][0]-le[ue][0],se[ue][1]-le[ue][1]]:he[ue]=[se[ue][0],se[ue][1]];return he},points:function(k){return this.vertices("v",k)},inTangents:function(k){return this.vertices("i",k)},outTangents:function(k){return this.vertices("o",k)},isClosed:function(){return this.v.c},pointOnPath:function(k,Y){var ie=this.v;Y!==void 0&&(ie=this.getValueAtTime(Y,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(ie));for(var ue=this._segmentsLength,ne=ue.lengths,se=ue.totalLength*k,le=0,he=ne.length,me=0,ge;le<he;){if(me+ne[le].addedLength>se){var xt=le,Et=ie.c&&le===he-1?0:le+1,Lt=(se-me)/ne[le].addedLength;ge=bez.getPointInSegment(ie.v[xt],ie.v[Et],ie.o[xt],ie.i[Et],Lt,ne[le]);break}else me+=ne[le].addedLength;le+=1}return ge||(ge=ie.c?[ie.v[0][0],ie.v[0][1]]:[ie.v[ie._length-1][0],ie.v[ie._length-1][1]]),ge},vectorOnPath:function(k,Y,ie){k==1?k=this.v.c:k==0&&(k=.999);var ue=this.pointOnPath(k,Y),ne=this.pointOnPath(k+.001,Y),se=ne[0]-ue[0],le=ne[1]-ue[1],he=Math.sqrt(Math.pow(se,2)+Math.pow(le,2));if(he===0)return[0,0];var me=ie==="tangent"?[se/he,le/he]:[-le/he,se/he];return me},tangentOnPath:function(k,Y){return this.vectorOnPath(k,Y,"tangent")},normalOnPath:function(k,Y){return this.vectorOnPath(k,Y,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([I],S),extendPrototype([I],C),C.prototype.getValueAtTime=n,C.prototype.initiateExpression=ExpressionManager.initiateExpression;var z=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function($,k,Y,ie,ue){var ne=z($,k,Y,ie,ue);return ne.propertyIndex=k.ix,ne.lock=!1,Y===3?expressionHelpers.searchExpressions($,k.pt,ne):Y===4&&expressionHelpers.searchExpressions($,k.ks,ne),ne.k&&$.addDynamicProperty(ne),ne}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(t,i){var r=this.calculateExpression(i);if(t.t!==r){var o={};return this.copyData(o,t),o.t=r.toString(),o.__complete=!1,o}return t},TextProperty.prototype.searchProperty=function(){var t=this.searchKeyframes(),i=this.searchExpressions();return this.kf=t||i,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(t,i){var r=createNS("feMerge");r.setAttribute("result",t);var o,l;for(l=0;l<i.length;l+=1)o=createNS("feMergeNode"),o.setAttribute("in",i[l]),r.appendChild(o),r.appendChild(o);return r}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,t,i,r,o){this.filterManager=t;var l=createNS("feColorMatrix");l.setAttribute("type","matrix"),l.setAttribute("color-interpolation-filters","linearRGB"),l.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=l,l.setAttribute("result",r+"_tint_1"),e.appendChild(l),l=createNS("feColorMatrix"),l.setAttribute("type","matrix"),l.setAttribute("color-interpolation-filters","sRGB"),l.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),l.setAttribute("result",r+"_tint_2"),e.appendChild(l),this.matrixFilter=l;var d=this.createMergeNode(r,[o,r+"_tint_1",r+"_tint_2"]);e.appendChild(d)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+r+" 0"),this.matrixFilter.setAttribute("values",i[0]-t[0]+" 0 0 0 "+t[0]+" "+(i[1]-t[1])+" 0 0 0 "+t[1]+" "+(i[2]-t[2])+" 0 0 0 "+t[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,t,i,r){this.filterManager=t;var o=createNS("feColorMatrix");o.setAttribute("type","matrix"),o.setAttribute("color-interpolation-filters","sRGB"),o.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),o.setAttribute("result",r),e.appendChild(o),this.matrixFilter=o}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[2].p.v,i=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+t[0]+" 0 0 0 0 "+t[1]+" 0 0 0 0 "+t[2]+" 0 0 0 "+i+" 0")}};function SVGStrokeEffect(e,t,i){this.initialized=!1,this.filterManager=t,this.elem=i,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,t,i,r,o;for(this.filterManager.effectElements[1].p.v===1?(o=this.elem.maskManager.masksProperties.length,r=0):(r=this.filterManager.effectElements[0].p.v-1,o=r+1),i=createNS("g"),i.setAttribute("fill","none"),i.setAttribute("stroke-linecap","round"),i.setAttribute("stroke-dashoffset",1),r;r<o;r+=1)t=createNS("path"),i.appendChild(t),this.paths.push({p:t,m:r});if(this.filterManager.effectElements[10].p.v===3){var l=createNS("mask"),d=createElementID();l.setAttribute("id",d),l.setAttribute("mask-type","alpha"),l.appendChild(i),this.elem.globalData.defs.appendChild(l);var n=createNS("g");for(n.setAttribute("mask","url("+getLocationHref()+"#"+d+")");e[0];)n.appendChild(e[0]);this.elem.layerElement.appendChild(n),this.masker=l,i.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(i),this.elem.layerElement.removeAttribute("mask"),i.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=i},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var t,i=this.paths.length,r,o;for(t=0;t<i;t+=1)if(this.paths[t].m!==-1&&(r=this.elem.maskManager.viewData[this.paths[t].m],o=this.paths[t].p,(e||this.filterManager._mdf||r.prop._mdf)&&o.setAttribute("d",r.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||r.prop._mdf)){var l;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var d=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,n=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,S=o.getTotalLength();l="0 0 0 "+S*d+" ";var C=S*(n-d),I=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,z=Math.floor(C/I),$;for($=0;$<z;$+=1)l+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";l+="0 "+S*10+" 0 0"}else l="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;o.setAttribute("stroke-dasharray",l)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var k=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(k[0]*255)+","+bmFloor(k[1]*255)+","+bmFloor(k[2]*255)+")")}};function SVGTritoneFilter(e,t,i,r){this.filterManager=t;var o=createNS("feColorMatrix");o.setAttribute("type","matrix"),o.setAttribute("color-interpolation-filters","linearRGB"),o.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(o);var l=createNS("feComponentTransfer");l.setAttribute("color-interpolation-filters","sRGB"),l.setAttribute("result",r),this.matrixFilter=l;var d=createNS("feFuncR");d.setAttribute("type","table"),l.appendChild(d),this.feFuncR=d;var n=createNS("feFuncG");n.setAttribute("type","table"),l.appendChild(n),this.feFuncG=n;var S=createNS("feFuncB");S.setAttribute("type","table"),l.appendChild(S),this.feFuncB=S,e.appendChild(l)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v,o=r[0]+" "+i[0]+" "+t[0],l=r[1]+" "+i[1]+" "+t[1],d=r[2]+" "+i[2]+" "+t[2];this.feFuncR.setAttribute("tableValues",o),this.feFuncG.setAttribute("tableValues",l),this.feFuncB.setAttribute("tableValues",d)}};function SVGProLevelsFilter(e,t,i,r){this.filterManager=t;var o=this.filterManager.effectElements,l=createNS("feComponentTransfer");(o[10].p.k||o[10].p.v!==0||o[11].p.k||o[11].p.v!==1||o[12].p.k||o[12].p.v!==1||o[13].p.k||o[13].p.v!==0||o[14].p.k||o[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",l)),(o[17].p.k||o[17].p.v!==0||o[18].p.k||o[18].p.v!==1||o[19].p.k||o[19].p.v!==1||o[20].p.k||o[20].p.v!==0||o[21].p.k||o[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",l)),(o[24].p.k||o[24].p.v!==0||o[25].p.k||o[25].p.v!==1||o[26].p.k||o[26].p.v!==1||o[27].p.k||o[27].p.v!==0||o[28].p.k||o[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",l)),(o[31].p.k||o[31].p.v!==0||o[32].p.k||o[32].p.v!==1||o[33].p.k||o[33].p.v!==1||o[34].p.k||o[34].p.v!==0||o[35].p.k||o[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",l)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(l.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(l)),(o[3].p.k||o[3].p.v!==0||o[4].p.k||o[4].p.v!==1||o[5].p.k||o[5].p.v!==1||o[6].p.k||o[6].p.v!==0||o[7].p.k||o[7].p.v!==1)&&(l=createNS("feComponentTransfer"),l.setAttribute("color-interpolation-filters","sRGB"),l.setAttribute("result",r),e.appendChild(l),this.feFuncRComposed=this.createFeFunc("feFuncR",l),this.feFuncGComposed=this.createFeFunc("feFuncG",l),this.feFuncBComposed=this.createFeFunc("feFuncB",l))}SVGProLevelsFilter.prototype.createFeFunc=function(e,t){var i=createNS(e);return i.setAttribute("type","table"),t.appendChild(i),i},SVGProLevelsFilter.prototype.getTableValue=function(e,t,i,r,o){for(var l=0,d=256,n,S=Math.min(e,t),C=Math.max(e,t),I=Array.call(null,{length:d}),z,$=0,k=o-r,Y=t-e;l<=256;)n=l/256,n<=S?z=Y<0?o:r:n>=C?z=Y<0?r:o:z=r+k*Math.pow((n-e)/Y,1/i),I[$]=z,$+=1,l+=256/(d-1);return I.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t,i=this.filterManager.effectElements;this.feFuncRComposed&&(e||i[3].p._mdf||i[4].p._mdf||i[5].p._mdf||i[6].p._mdf||i[7].p._mdf)&&(t=this.getTableValue(i[3].p.v,i[4].p.v,i[5].p.v,i[6].p.v,i[7].p.v),this.feFuncRComposed.setAttribute("tableValues",t),this.feFuncGComposed.setAttribute("tableValues",t),this.feFuncBComposed.setAttribute("tableValues",t)),this.feFuncR&&(e||i[10].p._mdf||i[11].p._mdf||i[12].p._mdf||i[13].p._mdf||i[14].p._mdf)&&(t=this.getTableValue(i[10].p.v,i[11].p.v,i[12].p.v,i[13].p.v,i[14].p.v),this.feFuncR.setAttribute("tableValues",t)),this.feFuncG&&(e||i[17].p._mdf||i[18].p._mdf||i[19].p._mdf||i[20].p._mdf||i[21].p._mdf)&&(t=this.getTableValue(i[17].p.v,i[18].p.v,i[19].p.v,i[20].p.v,i[21].p.v),this.feFuncG.setAttribute("tableValues",t)),this.feFuncB&&(e||i[24].p._mdf||i[25].p._mdf||i[26].p._mdf||i[27].p._mdf||i[28].p._mdf)&&(t=this.getTableValue(i[24].p.v,i[25].p.v,i[26].p.v,i[27].p.v,i[28].p.v),this.feFuncB.setAttribute("tableValues",t)),this.feFuncA&&(e||i[31].p._mdf||i[32].p._mdf||i[33].p._mdf||i[34].p._mdf||i[35].p._mdf)&&(t=this.getTableValue(i[31].p.v,i[32].p.v,i[33].p.v,i[34].p.v,i[35].p.v),this.feFuncA.setAttribute("tableValues",t))}};function SVGDropShadowEffect(e,t,i,r,o){var l=t.container.globalData.renderConfig.filterSize,d=t.data.fs||l;e.setAttribute("x",d.x||l.x),e.setAttribute("y",d.y||l.y),e.setAttribute("width",d.width||l.width),e.setAttribute("height",d.height||l.height),this.filterManager=t;var n=createNS("feGaussianBlur");n.setAttribute("in","SourceAlpha"),n.setAttribute("result",r+"_drop_shadow_1"),n.setAttribute("stdDeviation","0"),this.feGaussianBlur=n,e.appendChild(n);var S=createNS("feOffset");S.setAttribute("dx","25"),S.setAttribute("dy","0"),S.setAttribute("in",r+"_drop_shadow_1"),S.setAttribute("result",r+"_drop_shadow_2"),this.feOffset=S,e.appendChild(S);var C=createNS("feFlood");C.setAttribute("flood-color","#00ff00"),C.setAttribute("flood-opacity","1"),C.setAttribute("result",r+"_drop_shadow_3"),this.feFlood=C,e.appendChild(C);var I=createNS("feComposite");I.setAttribute("in",r+"_drop_shadow_3"),I.setAttribute("in2",r+"_drop_shadow_2"),I.setAttribute("operator","in"),I.setAttribute("result",r+"_drop_shadow_4"),e.appendChild(I);var z=this.createMergeNode(r,[r+"_drop_shadow_4",o]);e.appendChild(z)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var t=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(t[0]*255),Math.round(t[1]*255),Math.round(t[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var i=this.filterManager.effectElements[3].p.v,r=(this.filterManager.effectElements[2].p.v-90)*degToRads,o=i*Math.cos(r),l=i*Math.sin(r);this.feOffset.setAttribute("dx",o),this.feOffset.setAttribute("dy",l)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,t,i){this.initialized=!1,this.filterManager=t,this.filterElem=e,this.elem=i,i.matteElement=createNS("g"),i.matteElement.appendChild(i.layerElement),i.matteElement.appendChild(i.transformedElement),i.baseElement=i.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var t=0,i=_svgMatteSymbols.length;t<i;){if(_svgMatteSymbols[t]===e)return _svgMatteSymbols[t];t+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,t){var i=e.layerElement.parentNode;if(i){for(var r=i.children,o=0,l=r.length;o<l&&r[o]!==e.layerElement;)o+=1;var d;o<=l-2&&(d=r[o+1]);var n=createNS("use");n.setAttribute("href","#"+t),d?i.insertBefore(n,d):i.appendChild(n)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,t){if(!this.findSymbol(t)){var i=createElementID(),r=createNS("mask");r.setAttribute("id",t.layerId),r.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(t);var o=e.globalData.defs;o.appendChild(r);var l=createNS("symbol");l.setAttribute("id",i),this.replaceInParent(t,i),l.appendChild(t.layerElement),o.appendChild(l);var d=createNS("use");d.setAttribute("href","#"+i),r.appendChild(d),t.data.hd=!1,t.show()}e.setMatte(t.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,t=this.elem.comp.elements,i=0,r=t.length;i<r;)t[i]&&t[i].data.ind===e&&this.setElementAsMask(this.elem,t[i]),i+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,t,i,r){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=t;var o=createNS("feGaussianBlur");o.setAttribute("result",r),e.appendChild(o),this.feGaussianBlur=o}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=.3,i=this.filterManager.effectElements[0].p.v*t,r=this.filterManager.effectElements[1].p.v,o=r==3?0:i,l=r==2?0:i;this.feGaussianBlur.setAttribute("stdDeviation",o+" "+l);var d=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",d)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var t=this.effectsManager.effectElements,i=t[0].p.v,r=t[1].p.v,o=t[2].p.v===1,l=t[3].p.v,d=o?l:t[4].p.v,n=t[5].p.v,S=t[6].p.v,C=t[7].p.v;this.matrix.reset(),this.matrix.translate(-i[0],-i[1],i[2]),this.matrix.scale(d*.01,l*.01,1),this.matrix.rotate(-C*degToRads),this.matrix.skewFromAxis(-n*degToRads,(S+90)*degToRads),this.matrix.translate(r[0],r[1],0),this._mdf=!0,this.opacity!==t[8].p.v&&(this.opacity=t[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,t){this.init(t)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})}(lottie$2,lottie$2.exports)),lottie$2.exports}var lottieExports=requireLottie();const lottie=getDefaultExportFromCjs(lottieExports),lottie_client_TETKLg2oYPPADqer81OFjqzB5fggVha_BKSZAO_ZtKQ=defineNuxtPlugin(e=>{e.provide("lottie",lottie)});var mapboxGl$1={exports:{}},mapboxGl=mapboxGl$1.exports,hasRequiredMapboxGl;function requireMapboxGl(){return hasRequiredMapboxGl||(hasRequiredMapboxGl=1,function(e,t){(function(i,r){e.exports=r()})(mapboxGl,function(){var i,r,o;function l(n,S){if(!i)i=S;else if(!r)r=S;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",I={};i(I),o=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}l(["exports"],function(n){var S=1e-6,C=typeof Float32Array<"u"?Float32Array:Array;function I(u,s){var c=s[0],g=s[1],y=s[2],T=s[3],E=c*T-y*g;return E?(u[0]=T*(E=1/E),u[1]=-g*E,u[2]=-y*E,u[3]=c*E,u):null}function z(){var u=new C(9);return C!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function $(u,s){var c=s[0],g=s[1],y=s[2],T=s[3],E=s[4],D=s[5],W=s[6],X=s[7],ae=s[8];return u[0]=E*ae-D*X,u[1]=y*X-g*ae,u[2]=g*D-y*E,u[3]=D*W-T*ae,u[4]=c*ae-y*W,u[5]=y*T-c*D,u[6]=T*X-E*W,u[7]=g*W-c*X,u[8]=c*E-g*T,u}function k(u,s,c){var g=s[0],y=s[1],T=s[2],E=s[3],D=s[4],W=s[5],X=s[6],ae=s[7],ce=s[8],fe=c[0],ye=c[1],_t=c[2],St=c[3],Pt=c[4],zt=c[5],Kt=c[6],Qt=c[7],Tt=c[8];return u[0]=fe*g+ye*E+_t*X,u[1]=fe*y+ye*D+_t*ae,u[2]=fe*T+ye*W+_t*ce,u[3]=St*g+Pt*E+zt*X,u[4]=St*y+Pt*D+zt*ae,u[5]=St*T+Pt*W+zt*ce,u[6]=Kt*g+Qt*E+Tt*X,u[7]=Kt*y+Qt*D+Tt*ae,u[8]=Kt*T+Qt*W+Tt*ce,u}function Y(){var u=new C(16);return C!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function ie(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ue(u,s){var c=s[0],g=s[1],y=s[2],T=s[3],E=s[4],D=s[5],W=s[6],X=s[7],ae=s[8],ce=s[9],fe=s[10],ye=s[11],_t=s[12],St=s[13],Pt=s[14],zt=s[15],Kt=c*D-g*E,Qt=c*W-y*E,Tt=c*X-T*E,Wt=g*W-y*D,ti=g*X-T*D,ci=y*X-T*W,ki=ae*St-ce*_t,Ci=ae*Pt-fe*_t,Di=ae*zt-ye*_t,Vi=ce*Pt-fe*St,Qi=ce*zt-ye*St,br=fe*zt-ye*Pt,hr=Kt*br-Qt*Qi+Tt*Vi+Wt*Di-ti*Ci+ci*ki;return hr?(u[0]=(D*br-W*Qi+X*Vi)*(hr=1/hr),u[1]=(y*Qi-g*br-T*Vi)*hr,u[2]=(St*ci-Pt*ti+zt*Wt)*hr,u[3]=(fe*ti-ce*ci-ye*Wt)*hr,u[4]=(W*Di-E*br-X*Ci)*hr,u[5]=(c*br-y*Di+T*Ci)*hr,u[6]=(Pt*Tt-_t*ci-zt*Qt)*hr,u[7]=(ae*ci-fe*Tt+ye*Qt)*hr,u[8]=(E*Qi-D*Di+X*ki)*hr,u[9]=(g*Di-c*Qi-T*ki)*hr,u[10]=(_t*ti-St*Tt+zt*Kt)*hr,u[11]=(ce*Tt-ae*ti-ye*Kt)*hr,u[12]=(D*Ci-E*Vi-W*ki)*hr,u[13]=(c*Vi-g*Ci+y*ki)*hr,u[14]=(St*Qt-_t*Wt-Pt*Kt)*hr,u[15]=(ae*Wt-ce*Qt+fe*Kt)*hr,u):null}function ne(u,s,c){var g=s[0],y=s[1],T=s[2],E=s[3],D=s[4],W=s[5],X=s[6],ae=s[7],ce=s[8],fe=s[9],ye=s[10],_t=s[11],St=s[12],Pt=s[13],zt=s[14],Kt=s[15],Qt=c[0],Tt=c[1],Wt=c[2],ti=c[3];return u[0]=Qt*g+Tt*D+Wt*ce+ti*St,u[1]=Qt*y+Tt*W+Wt*fe+ti*Pt,u[2]=Qt*T+Tt*X+Wt*ye+ti*zt,u[3]=Qt*E+Tt*ae+Wt*_t+ti*Kt,u[4]=(Qt=c[4])*g+(Tt=c[5])*D+(Wt=c[6])*ce+(ti=c[7])*St,u[5]=Qt*y+Tt*W+Wt*fe+ti*Pt,u[6]=Qt*T+Tt*X+Wt*ye+ti*zt,u[7]=Qt*E+Tt*ae+Wt*_t+ti*Kt,u[8]=(Qt=c[8])*g+(Tt=c[9])*D+(Wt=c[10])*ce+(ti=c[11])*St,u[9]=Qt*y+Tt*W+Wt*fe+ti*Pt,u[10]=Qt*T+Tt*X+Wt*ye+ti*zt,u[11]=Qt*E+Tt*ae+Wt*_t+ti*Kt,u[12]=(Qt=c[12])*g+(Tt=c[13])*D+(Wt=c[14])*ce+(ti=c[15])*St,u[13]=Qt*y+Tt*W+Wt*fe+ti*Pt,u[14]=Qt*T+Tt*X+Wt*ye+ti*zt,u[15]=Qt*E+Tt*ae+Wt*_t+ti*Kt,u}function se(u,s,c){var g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St=c[0],Pt=c[1],zt=c[2];return s===u?(u[12]=s[0]*St+s[4]*Pt+s[8]*zt+s[12],u[13]=s[1]*St+s[5]*Pt+s[9]*zt+s[13],u[14]=s[2]*St+s[6]*Pt+s[10]*zt+s[14],u[15]=s[3]*St+s[7]*Pt+s[11]*zt+s[15]):(y=s[1],T=s[2],E=s[3],D=s[4],W=s[5],X=s[6],ae=s[7],ce=s[8],fe=s[9],ye=s[10],_t=s[11],u[0]=g=s[0],u[1]=y,u[2]=T,u[3]=E,u[4]=D,u[5]=W,u[6]=X,u[7]=ae,u[8]=ce,u[9]=fe,u[10]=ye,u[11]=_t,u[12]=g*St+D*Pt+ce*zt+s[12],u[13]=y*St+W*Pt+fe*zt+s[13],u[14]=T*St+X*Pt+ye*zt+s[14],u[15]=E*St+ae*Pt+_t*zt+s[15]),u}function le(u,s,c){var g=c[0],y=c[1],T=c[2];return u[0]=s[0]*g,u[1]=s[1]*g,u[2]=s[2]*g,u[3]=s[3]*g,u[4]=s[4]*y,u[5]=s[5]*y,u[6]=s[6]*y,u[7]=s[7]*y,u[8]=s[8]*T,u[9]=s[9]*T,u[10]=s[10]*T,u[11]=s[11]*T,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u}function he(u,s,c){var g=Math.sin(c),y=Math.cos(c),T=s[4],E=s[5],D=s[6],W=s[7],X=s[8],ae=s[9],ce=s[10],fe=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=T*y+X*g,u[5]=E*y+ae*g,u[6]=D*y+ce*g,u[7]=W*y+fe*g,u[8]=X*y-T*g,u[9]=ae*y-E*g,u[10]=ce*y-D*g,u[11]=fe*y-W*g,u}function me(u,s,c){var g=Math.sin(c),y=Math.cos(c),T=s[0],E=s[1],D=s[2],W=s[3],X=s[8],ae=s[9],ce=s[10],fe=s[11];return s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=T*y-X*g,u[1]=E*y-ae*g,u[2]=D*y-ce*g,u[3]=W*y-fe*g,u[8]=T*g+X*y,u[9]=E*g+ae*y,u[10]=D*g+ce*y,u[11]=W*g+fe*y,u}function ge(u,s,c){var g=Math.sin(c),y=Math.cos(c),T=s[0],E=s[1],D=s[2],W=s[3],X=s[4],ae=s[5],ce=s[6],fe=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=T*y+X*g,u[1]=E*y+ae*g,u[2]=D*y+ce*g,u[3]=W*y+fe*g,u[4]=X*y-T*g,u[5]=ae*y-E*g,u[6]=ce*y-D*g,u[7]=fe*y-W*g,u}function xt(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Et(u,s,c){var g,y,T,E=c[0],D=c[1],W=c[2],X=Math.hypot(E,D,W);return X<S?null:(E*=X=1/X,D*=X,W*=X,g=Math.sin(s),y=Math.cos(s),u[0]=E*E*(T=1-y)+y,u[1]=D*E*T+W*g,u[2]=W*E*T-D*g,u[3]=0,u[4]=E*D*T-W*g,u[5]=D*D*T+y,u[6]=W*D*T+E*g,u[7]=0,u[8]=E*W*T+D*g,u[9]=D*W*T-E*g,u[10]=W*W*T+y,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function Lt(u,s){var c=s[0],g=s[1],y=s[2],T=s[3],E=c+c,D=g+g,W=y+y,X=c*E,ae=g*E,ce=g*D,fe=y*E,ye=y*D,_t=y*W,St=T*E,Pt=T*D,zt=T*W;return u[0]=1-ce-_t,u[1]=ae+zt,u[2]=fe-Pt,u[3]=0,u[4]=ae-zt,u[5]=1-X-_t,u[6]=ye+St,u[7]=0,u[8]=fe+Pt,u[9]=ye-St,u[10]=1-X-ce,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}Math.hypot||(Math.hypot=function(){for(var u=0,s=arguments.length;s--;)u+=arguments[s]*arguments[s];return Math.sqrt(u)});var Zt=ne;function Ht(){var u=new C(3);return C!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function It(u){var s=new C(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s}function Yt(u){return Math.hypot(u[0],u[1],u[2])}function ri(u,s,c){var g=new C(3);return g[0]=u,g[1]=s,g[2]=c,g}function ei(u,s,c){return u[0]=s[0]+c[0],u[1]=s[1]+c[1],u[2]=s[2]+c[2],u}function Ct(u,s,c){return u[0]=s[0]-c[0],u[1]=s[1]-c[1],u[2]=s[2]-c[2],u}function Ut(u,s,c){return u[0]=s[0]*c[0],u[1]=s[1]*c[1],u[2]=s[2]*c[2],u}function Mt(u,s,c){return u[0]=Math.min(s[0],c[0]),u[1]=Math.min(s[1],c[1]),u[2]=Math.min(s[2],c[2]),u}function $t(u,s,c){return u[0]=Math.max(s[0],c[0]),u[1]=Math.max(s[1],c[1]),u[2]=Math.max(s[2],c[2]),u}function jt(u,s,c){return u[0]=s[0]*c,u[1]=s[1]*c,u[2]=s[2]*c,u}function mi(u,s,c,g){return u[0]=s[0]+c[0]*g,u[1]=s[1]+c[1]*g,u[2]=s[2]+c[2]*g,u}function Xi(u,s){var c=s[0]-u[0],g=s[1]-u[1],y=s[2]-u[2];return c*c+g*g+y*y}function Er(u){var s=u[0],c=u[1],g=u[2];return s*s+c*c+g*g}function Ir(u,s){return u[0]=-s[0],u[1]=-s[1],u[2]=-s[2],u}function nr(u,s){var c=s[0],g=s[1],y=s[2],T=c*c+g*g+y*y;return T>0&&(T=1/Math.sqrt(T)),u[0]=s[0]*T,u[1]=s[1]*T,u[2]=s[2]*T,u}function si(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]}function Gt(u,s,c){var g=s[0],y=s[1],T=s[2],E=c[0],D=c[1],W=c[2];return u[0]=y*W-T*D,u[1]=T*E-g*W,u[2]=g*D-y*E,u}function ui(u,s,c,g){var y=s[0],T=s[1],E=s[2];return u[0]=y+g*(c[0]-y),u[1]=T+g*(c[1]-T),u[2]=E+g*(c[2]-E),u}function oi(u,s,c){var g=s[0],y=s[1],T=s[2],E=c[3]*g+c[7]*y+c[11]*T+c[15];return u[0]=(c[0]*g+c[4]*y+c[8]*T+c[12])/(E=E||1),u[1]=(c[1]*g+c[5]*y+c[9]*T+c[13])/E,u[2]=(c[2]*g+c[6]*y+c[10]*T+c[14])/E,u}function Si(u,s,c){var g=s[0],y=s[1],T=s[2];return u[0]=g*c[0]+y*c[3]+T*c[6],u[1]=g*c[1]+y*c[4]+T*c[7],u[2]=g*c[2]+y*c[5]+T*c[8],u}function Li(u,s,c){var g=c[0],y=c[1],T=c[2],E=s[0],D=s[1],W=s[2],X=y*W-T*D,ae=T*E-g*W,ce=g*D-y*E,fe=y*ce-T*ae,ye=T*X-g*ce,_t=g*ae-y*X,St=2*c[3];return ae*=St,ce*=St,ye*=2,_t*=2,u[0]=E+(X*=St)+(fe*=2),u[1]=D+ae+ye,u[2]=W+ce+_t,u}function Mi(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]}var kt=Ct,Nt=Ut,gi=Yt;function Ri(){var u=new C(4);return C!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function Rt(u,s,c){return u[0]=s[0]*c,u[1]=s[1]*c,u[2]=s[2]*c,u[3]=s[3]*c,u}function Xt(u,s){var c=s[0],g=s[1],y=s[2],T=s[3],E=c*c+g*g+y*y+T*T;return E>0&&(E=1/Math.sqrt(E)),u[0]=c*E,u[1]=g*E,u[2]=y*E,u[3]=T*E,u}function Hi(u,s,c){var g=s[0],y=s[1],T=s[2],E=s[3];return u[0]=c[0]*g+c[4]*y+c[8]*T+c[12]*E,u[1]=c[1]*g+c[5]*y+c[9]*T+c[13]*E,u[2]=c[2]*g+c[6]*y+c[10]*T+c[14]*E,u[3]=c[3]*g+c[7]*y+c[11]*T+c[15]*E,u}function Ni(){var u=new C(4);return C!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function xi(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function $i(u,s,c){c*=.5;var g=s[0],y=s[1],T=s[2],E=s[3],D=Math.sin(c),W=Math.cos(c);return u[0]=g*W+E*D,u[1]=y*W+T*D,u[2]=T*W-y*D,u[3]=E*W-g*D,u}function fr(u,s,c){c*=.5;var g=s[0],y=s[1],T=s[2],E=s[3],D=Math.sin(c),W=Math.cos(c);return u[0]=g*W-T*D,u[1]=y*W+E*D,u[2]=T*W+g*D,u[3]=E*W-y*D,u}Ht(),Ri();var ir,lr,Tr,Rr,Jr,_r=Xt,mr=(ir=Ht(),lr=ri(1,0,0),Tr=ri(0,1,0),function(u,s,c){var g=si(s,c);return g<-.999999?(Gt(ir,lr,s),gi(ir)<1e-6&&Gt(ir,Tr,s),nr(ir,ir),function(y,T,E){E*=.5;var D=Math.sin(E);y[0]=D*T[0],y[1]=D*T[1],y[2]=D*T[2],y[3]=Math.cos(E)}(u,ir,Math.PI),u):g>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(Gt(ir,s,c),u[0]=ir[0],u[1]=ir[1],u[2]=ir[2],u[3]=1+g,_r(u,u))});function wr(){var u=new C(2);return C!=Float32Array&&(u[0]=0,u[1]=0),u}function Vr(u,s){var c=new C(2);return c[0]=u,c[1]=s,c}function wn(u,s,c){return u[0]=s[0]+c[0],u[1]=s[1]+c[1],u}function Nn(u,s,c){return u[0]=s[0]-c[0],u[1]=s[1]-c[1],u}function zs(u,s,c){return u[0]=s[0]*c,u[1]=s[1]*c,u}function es(u){return Math.hypot(u[0],u[1])}function As(u,s){var c=s[0],g=s[1],y=c*c+g*g;return y>0&&(y=1/Math.sqrt(y)),u[0]=s[0]*y,u[1]=s[1]*y,u}function Dn(u,s){return u[0]*s[0]+u[1]*s[1]}function Sn(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}Ni(),Ni(),z(),wr();var Os,Un,Ks=function(){if(Jr)return Rr;function u(s,c,g,y){this.cx=3*s,this.bx=3*(g-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(y-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=c,this.p2x=g,this.p2y=y}return Jr=1,Rr=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,c){if(c===void 0&&(c=1e-6),s<0)return 0;if(s>1)return 1;for(var g=s,y=0;y<8;y++){var T=this.sampleCurveX(g)-s;if(Math.abs(T)<c)return g;var E=this.sampleCurveDerivativeX(g);if(Math.abs(E)<1e-6)break;g-=T/E}var D=0,W=1;for(g=s,y=0;y<20&&(T=this.sampleCurveX(g),!(Math.abs(T-s)<c));y++)s>T?D=g:W=g,g=.5*(W-D)+D;return g},solve:function(s,c){return this.sampleCurveY(this.solveCurveX(s,c))}},Rr}(),xs=Sn(Ks);function eo(){if(Un)return Os;function u(s,c){this.x=s,this.y=c}return Un=1,Os=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,c){return this.clone()._rotateAround(s,c)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var c=s.x-this.x,g=s.y-this.y;return c*c+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,c){return Math.atan2(this.x*c-this.y*s,this.x*s+this.y*c)},_matMult:function(s){var c=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=c,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var c=Math.cos(s),g=Math.sin(s),y=g*this.x+c*this.y;return this.x=c*this.x-g*this.y,this.y=y,this},_rotateAround:function(s,c){var g=Math.cos(s),y=Math.sin(s),T=c.y+y*(this.x-c.x)+g*(this.y-c.y);return this.x=c.x+g*(this.x-c.x)-y*(this.y-c.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(s){return s instanceof u?s:Array.isArray(s)?new u(s[0],s[1]):s},Os}var rr=Sn(eo());function Ki(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let c=0;c<u.length;c++)if(!Ki(u[c],s[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const c in u)if(!Ki(u[c],s[c]))return!1;return!0}return u===s}const pi=Math.PI/180,Ii=180/Math.PI;function Ai(u){return u*pi}function ii(u){return u*Ii}const wt=[[0,0],[1,0],[1,1],[0,1]];function Ft(u){if(u<=0)return 0;if(u>=1)return 1;const s=u*u,c=s*u;return 4*(u<.5?c:3*(u-s)+c-.75)}function Vt(u,s,c,g){const y=new xs(u,s,c,g);return function(T){return y.solve(T)}}const ni=Vt(.25,.1,.25,1);function Jt(u,s,c){return Math.min(c,Math.max(s,u))}function yi(u,s,c){return(c=Jt((c-u)/(s-u),0,1))*c*(3-2*c)}function Fi(u,s,c){const g=c-s,y=((u-s)%g+g)%g+s;return y===s?c:y}function bi(u,s,c){if(!u.length)return c(null,[]);let g=u.length;const y=new Array(u.length);let T=null;u.forEach((E,D)=>{s(E,(W,X)=>{W&&(T=W),y[D]=X,--g==0&&c(T,y)})})}function Oi(u,...s){for(const c of s)for(const g in c)u[g]=c[g];return u}let qi=1;function Bi(){return qi++}function dr(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function pr(u,s){u.forEach(c=>{s[c]&&(s[c]=s[c].bind(s))})}function Nr(u,s,c){const g={};for(const y in u)g[y]=s.call(this,u[y],y,u);return g}function Gr(u,s,c){const g={};for(const y in u)s.call(this,u[y],y,u)&&(g[y]=u[y]);return g}function rn(u){return Array.isArray(u)?u.map(rn):typeof u=="object"&&u?Nr(u,rn):u}function sn(u,s){for(let c=0;c<u.length;c++)if(s.indexOf(u[c])>=0)return!0;return!1}const hn={};function yn(u){hn[u]||(typeof console<"u"&&console.warn(u),hn[u]=!0)}function ts(u,s,c){return(c.y-u.y)*(s.x-u.x)>(s.y-u.y)*(c.x-u.x)}function Hn(u){let s=0;for(let c,g,y=0,T=u.length,E=T-1;y<T;E=y++)c=u[y],g=u[E],s+=(g.x-c.x)*(c.y+g.y);return s}function Vn([u,s,c]){const g=Ai(s+90),y=Ai(c);return{x:u*Math.cos(g)*Math.sin(y),y:u*Math.sin(g)*Math.sin(y),z:u*Math.cos(y),azimuthal:s,polar:c}}function Gn(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function qn(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,g,y,T)=>{const E=y||T;return s[g]=!E||E.toLowerCase(),""}),s["max-age"]){const c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}let Bs=null;function bs(u,s){return[u[4*s],u[4*s+1],u[4*s+2],u[4*s+3]]}function ls(u,s,c,g){for(;s<c;){const y=s+c>>1;u[y]<g?s=y+1:c=y}return s}function Js(u,s,c,g){for(;s<c;){const y=s+c>>1;u[y]<=g?s=y+1:c=y}return s}function uo(u){return u>0?1/(1.001-u):1+u}function Qs(u){return u>0?1-1/(1.001-u):-u}function Sc(u,s,c){return(u-s.min)*(c.max-c.min)/(s.max-s.min)+c.min}const po={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!po.API_URL)return null;try{const u=new URL(po.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function za(u){return po.API_URL_REGEX.test(u)}function Cu(u){return po.API_SPRITE_REGEX.test(u)}let Tc,Ec,Pu,Iu,al,Mc;function Ru(){return Tc==null&&(Tc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Tc}const ia={now:()=>Iu!==void 0?Iu:performance.now(),setNow(u){Iu=u},restoreNow(){Iu=void 0},frame(u){const s=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(u,s=0){const{width:c,height:g}=u;al||(al=document.createElement("canvas"));const y=al.getContext("2d",{willReadFrequently:!0});if(!y)throw new Error("failed to create canvas 2d context");return(c>al.width||g>al.height)&&(al.width=c,al.height=g),y.clearRect(-s,-s,c+2*s,g+2*s),y.drawImage(u,0,0,c,g),y.getImageData(-s,-s,c+2*s,g+2*s)},resolveURL:u=>(Ec||(Ec=document.createElement("a")),Ec.href=u,Ec.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pu==null&&(Pu=window.matchMedia("(prefers-reduced-motion: reduce)")),Pu.matches)},hasCanvasFingerprintNoise(){if(Mc!==void 0)return Mc;if(!Ru())return Mc=!1,!1;const u=new OffscreenCanvas(85,1),s=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let y=0;y<u.width;++y)s.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,s.fillRect(y,0,1,1);const g=s.getImageData(0,0,u.width,u.height);c=0;for(let y=0;y<g.data.length;++y)if(y%4!=3&&c++!==g.data[y])return Mc=!0,!0;return Mc=!1,!1}};function Uo(u,s){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(s).toString()}`;const g=new URLSearchParams(u.slice(c));for(const y in s)g.set(y,s[y]);return`${u.slice(0,c)}?${g.toString()}`}function Xo(u,s={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const g=new URLSearchParams,y=new URLSearchParams(u.slice(c));for(const E of s.persistentParams){const D=y.get(E);D&&g.set(E,D)}const T=g.toString();return`${u.slice(0,c)}${T.length>0?`?${T}`:""}`}const va="mapbox-tiles";let ra=500,xa=50;const Ac=["language","worldview","jobid"];let ha,Cc;function ll(){try{return caches}catch{}}function kl(){const u=ll();u&&ha==null&&(ha=u.open(va))}let Wh=1/0;const qh={supported:!1,testSupport:function(u){!Pc&&cl&&(Dl?Dd(u):Lo=u)}};let Lo,cl,Pc=!1,Dl=!1;const kd=typeof self<"u"?self:{};function Dd(u){const s=u.createTexture();u.bindTexture(u.TEXTURE_2D,s);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,cl),u.isContextLost())return;qh.supported=!0}catch{}u.deleteTexture(s),Pc=!0}kd.document&&(cl=kd.document.createElement("img"),cl.onload=function(){Lo&&Dd(Lo),Lo=null,Dl=!0},cl.onerror=function(){Pc=!0,Lo=null},cl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ic={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ic);class Xn extends Error{constructor(s,c,g){c===401&&za(g)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=c,this.url=g}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Lu=Gn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Fl=function(u,s){if(!(/^file:/.test(c=u.url)||/^file:/.test(Lu())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(g,y){const T=new AbortController,E=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,referrer:Lu(),referrerPolicy:g.referrerPolicy,signal:T.signal});let D=!1,W=!1;const X=(ae=E.url).indexOf("sku=")>0&&za(ae);var ae;g.type==="json"&&E.headers.set("Accept","application/json");const ce=(ye,_t,St)=>{if(W)return;if(ye&&ye.message!=="SecurityError"&&yn(ye.toString()),_t&&St)return fe(_t);const Pt=Date.now();fetch(E).then(zt=>{if(zt.ok){const Kt=X?zt.clone():null;return fe(zt,Kt,Pt)}return y(new Xn(zt.statusText,zt.status,g.url))}).catch(zt=>{zt.name!=="AbortError"&&y(new Error(`${zt.message} ${g.url}`))})},fe=(ye,_t,St)=>{(g.type==="arrayBuffer"?ye.arrayBuffer():g.type==="json"?ye.json():ye.text()).then(Pt=>{W||(_t&&St&&function(zt,Kt,Qt){if(kl(),ha==null)return;const Tt=qn(Kt.headers.get("Cache-Control")||"");if(Tt["no-store"])return;const Wt={status:Kt.status,statusText:Kt.statusText,headers:new Headers};Kt.headers.forEach((ki,Ci)=>Wt.headers.set(Ci,ki)),Tt["max-age"]&&Wt.headers.set("Expires",new Date(Qt+1e3*Tt["max-age"]).toUTCString());const ti=Wt.headers.get("Expires");if(!ti||new Date(ti).getTime()-Qt<42e4)return;let ci=Xo(zt.url,{persistentParams:Ac});if(Kt.status===206){const ki=zt.headers.get("Range");if(!ki)return;Wt.status=200,ci=Uo(ci,{range:ki})}(function(ki,Ci){if(Cc===void 0)try{new Response(new ReadableStream),Cc=!0}catch{Cc=!1}Cc?Ci(ki.body):ki.blob().then(Ci).catch(Di=>yn(Di.message))})(Kt,ki=>{const Ci=new Response((Di=Kt.status)!==200&&Di!==404&&[101,103,204,205,304].includes(Di)?null:ki,Wt);var Di;kl(),ha!=null&&ha.then(Vi=>Vi.put(ci,Ci)).catch(Vi=>yn(Vi.message))})}(E,_t,St),D=!0,y(null,Pt,ye.headers.get("Cache-Control"),ye.headers.get("Expires")))}).catch(Pt=>{W||y(new Error(Pt.message))})};return X?function(ye,_t){if(kl(),ha==null)return _t(null);ha.then(St=>{let Pt=Xo(ye.url,{persistentParams:Ac});const zt=ye.headers.get("Range");zt&&(Pt=Uo(Pt,{range:zt})),St.match(Pt).then(Kt=>{const Qt=function(Tt){if(!Tt)return!1;const Wt=new Date(Tt.headers.get("Expires")||0),ti=qn(Tt.headers.get("Cache-Control")||"");return Number(Wt)>Date.now()&&!ti["no-cache"]}(Kt);St.delete(Pt).catch(_t),Qt&&St.put(Pt,Kt.clone()).catch(_t),_t(null,Kt,Qt)}).catch(_t)}).catch(_t)}(E,ce):ce(null,null),{cancel:()=>{W=!0,D||T.abort()}}}(u,s);if(Gn(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,s,void 0,!0)}var c;return function(g,y){const T=new XMLHttpRequest;T.open(g.method||"GET",g.url,!0),g.type==="arrayBuffer"&&(T.responseType="arraybuffer");for(const E in g.headers)T.setRequestHeader(E,g.headers[E]);return g.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=g.credentials==="include",T.onerror=()=>{y(new Error(T.statusText))},T.onload=()=>{if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let E=T.response;if(g.type==="json")try{E=JSON.parse(T.response)}catch(D){return y(D)}y(null,E,T.getResponseHeader("Cache-Control"),T.getResponseHeader("Expires"))}else y(new Xn(T.statusText,T.status,g.url))},T.send(g.body),{cancel:()=>T.abort()}}(u,s)},Rc=function(u,s){return Fl(Oi(u,{type:"arrayBuffer"}),s)};function Pm(u){const s=document.createElement("a");return s.href=u,s.protocol===location.protocol&&s.host===location.host}const Lc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ul,Ba;ul=[],Ba=0;const Xh=function(u,s){if(qh.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Ba>=po.MAX_PARALLEL_IMAGE_REQUESTS){const T={requestParameters:u,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return ul.push(T),T}Ba++;let c=!1;const g=()=>{if(!c)for(c=!0,Ba--;ul.length&&Ba<po.MAX_PARALLEL_IMAGE_REQUESTS;){const T=ul.shift(),{requestParameters:E,callback:D,cancelled:W}=T;W||(T.cancel=Xh(E,D).cancel)}},y=Rc(u,(T,E,D,W)=>{g(),T?s(T):E&&(self.createImageBitmap?function(X,ae){const ce=new Blob([new Uint8Array(X)],{type:"image/png"});createImageBitmap(ce).then(fe=>{ae(null,fe)}).catch(fe=>{ae(new Error(`Could not load image because of ${fe.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(E,(X,ae)=>s(X,ae,D,W)):function(X,ae){const ce=new Image;ce.onload=()=>{ae(null,ce),URL.revokeObjectURL(ce.src),ce.onload=null,requestAnimationFrame(()=>{ce.src=Lc})},ce.onerror=()=>ae(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const fe=new Blob([new Uint8Array(X)],{type:"image/png"});ce.src=X.byteLength?URL.createObjectURL(fe):Lc}(E,(X,ae)=>s(X,ae,D,W)))});return{cancel:()=>{y.cancel(),g()}}};var Zh,hl,Fd,ba={exports:{}},ku={exports:{}},Du={exports:{}},na=function(){if(Fd)return ba.exports;Fd=1;var u=(Zh||(Zh=1,ku.exports=function(c,g){var y,T,E,D,W,X,ae,ce;for(T=c.length-(y=3&c.length),E=g,W=3432918353,X=461845907,ce=0;ce<T;)ae=255&c.charCodeAt(ce)|(255&c.charCodeAt(++ce))<<8|(255&c.charCodeAt(++ce))<<16|(255&c.charCodeAt(++ce))<<24,++ce,E=27492+(65535&(D=5*(65535&(E=(E^=ae=(65535&(ae=(ae=(65535&ae)*W+(((ae>>>16)*W&65535)<<16)&4294967295)<<15|ae>>>17))*X+(((ae>>>16)*X&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(ae=0,y){case 3:ae^=(255&c.charCodeAt(ce+2))<<16;case 2:ae^=(255&c.charCodeAt(ce+1))<<8;case 1:E^=ae=(65535&(ae=(ae=(65535&(ae^=255&c.charCodeAt(ce)))*W+(((ae>>>16)*W&65535)<<16)&4294967295)<<15|ae>>>17))*X+(((ae>>>16)*X&65535)<<16)&4294967295}return E^=c.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}),ku.exports),s=(hl||(hl=1,Du.exports=function(c,g){for(var y,T=c.length,E=g^T,D=0;T>=4;)y=1540483477*(65535&(y=255&c.charCodeAt(D)|(255&c.charCodeAt(++D))<<8|(255&c.charCodeAt(++D))<<16|(255&c.charCodeAt(++D))<<24))+((1540483477*(y>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),T-=4,++D;switch(T){case 3:E^=(255&c.charCodeAt(D+2))<<16;case 2:E^=(255&c.charCodeAt(D+1))<<8;case 1:E=1540483477*(65535&(E^=255&c.charCodeAt(D)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}),Du.exports);return ba.exports=u,ba.exports.murmur3=u,ba.exports.murmur2=s,ba.exports}(),kc=Sn(na);class fl{constructor(s,...c){Oi(this,c[0]||{}),this.type=s}}class Fu extends fl{constructor(s,c={}){super("error",Oi({error:s},c))}}function Yh(u,s,c){c[u]&&c[u].indexOf(s)!==-1||(c[u]=c[u]||[],c[u].push(s))}function Ou(u,s,c){if(c&&c[u]){const g=c[u].indexOf(s);g!==-1&&c[u].splice(g,1)}}class dl{on(s,c){return this._listeners=this._listeners||{},Yh(s,c,this._listeners),this}off(s,c){return Ou(s,c,this._listeners),Ou(s,c,this._oneTimeListeners),this}once(s,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Yh(s,c,this._oneTimeListeners),this):new Promise(g=>{this.once(s,g)})}fire(s,c){const g=typeof s=="string"?new fl(s,c):s,y=g.type;if(this.listens(y)){g.target=this;const T=this._listeners&&this._listeners[y]?this._listeners[y].slice():[];for(const W of T)W.call(this,g);const E=this._oneTimeListeners&&this._oneTimeListeners[y]?this._oneTimeListeners[y].slice():[];for(const W of E)Ou(y,W,this._oneTimeListeners),W.call(this,g);const D=this._eventedParent;D&&(Oi(g,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(g))}else g instanceof Fu&&console.error(g.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,c){return this._eventedParent=s,this._eventedParentData=c,this}}class Oo{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new Oo(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[c,g]=s.split("");return new Oo({name:c,iconsetId:g})}static isEqual(s,c){return s.name===c.name&&s.iconsetId===c.iconsetId}toString(){return Oo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Kh,Ol={},pl=function(){if(Kh)return Ol;Kh=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(T){return(T=Math.round(T))<0?0:T>255?255:T}function c(T){return s(T[T.length-1]==="%"?parseFloat(T)/100*255:parseInt(T))}function g(T){return(E=T[T.length-1]==="%"?parseFloat(T)/100:parseFloat(T))<0?0:E>1?1:E;var E}function y(T,E,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?T+(E-T)*D*6:2*D<1?E:3*D<2?T+(E-T)*(2/3-D)*6:T}try{Ol.parseCSSColor=function(T){var E,D=T.replace(/ /g,"").toLowerCase();if(D in u)return u[D].slice();if(D[0]==="#")return D.length===4?(E=parseInt(D.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:D.length===7&&(E=parseInt(D.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var W=D.indexOf("("),X=D.indexOf(")");if(W!==-1&&X+1===D.length){var ae=D.substr(0,W),ce=D.substr(W+1,X-(W+1)).split(","),fe=1;switch(ae){case"rgba":if(ce.length!==4)return null;fe=g(ce.pop());case"rgb":return ce.length!==3?null:[c(ce[0]),c(ce[1]),c(ce[2]),fe];case"hsla":if(ce.length!==4)return null;fe=g(ce.pop());case"hsl":if(ce.length!==3)return null;var ye=(parseFloat(ce[0])%360+360)%360/360,_t=g(ce[1]),St=g(ce[2]),Pt=St<=.5?St*(_t+1):St+_t-St*_t,zt=2*St-Pt;return[s(255*y(zt,Pt,ye+1/3)),s(255*y(zt,Pt,ye)),s(255*y(zt,Pt,ye-1/3)),fe];default:return null}}return null}}catch{}return Ol}();class rs{constructor(s,c,g,y=1){this.r=s,this.g=c,this.b=g,this.a=y}static parse(s){if(!s)return;if(s instanceof rs)return s;if(typeof s!="string")return;const c=pl.parseCSSColor(s);return c?new rs(c[0]/255,c[1]/255,c[2]/255,c[3]):void 0}toString(){const[s,c,g,y]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*c)},${Math.round(255*g)},${y})`}toNonPremultipliedRenderColor(s){const{r:c,g,b:y,a:T}=this;return new Im(s,c,g,y,T)}toPremultipliedRenderColor(s){const{r:c,g,b:y,a:T}=this;return new Jh(s,c*T,g*T,y*T,T)}clone(){return new rs(this.r,this.g,this.b,this.a)}}class sa{constructor(s,c,g,y,T,E=!1){if(this.premultiplied=!1,this.premultiplied=E,s){const D=s.image.height,W=D*D;this.premultiplied?(c=T===0?0:c/T*(D-1),g=T===0?0:g/T*(D-1),y=T===0?0:y/T*(D-1)):(c*=D-1,g*=D-1,y*=D-1);const X=Math.floor(c),ae=Math.floor(g),ce=Math.floor(y),fe=Math.ceil(c),ye=Math.ceil(g),_t=Math.ceil(y),St=c-X,Pt=g-ae,zt=y-ce,Kt=s.image.data,Qt=4*(X+ae*W+ce*D),Tt=4*(X+ae*W+_t*D),Wt=4*(X+ye*W+ce*D),ti=4*(X+ye*W+_t*D),ci=4*(fe+ae*W+ce*D),ki=4*(fe+ae*W+_t*D),Ci=4*(fe+ye*W+ce*D),Di=4*(fe+ye*W+_t*D);if(Qt<0||Di>=Kt.length)throw new Error("out of range");this.r=pn(pn(pn(Kt[Qt],Kt[Tt],zt),pn(Kt[Wt],Kt[ti],zt),Pt),pn(pn(Kt[ci],Kt[ki],zt),pn(Kt[Ci],Kt[Di],zt),Pt),St)/255*(this.premultiplied?T:1),this.g=pn(pn(pn(Kt[Qt+1],Kt[Tt+1],zt),pn(Kt[Wt+1],Kt[ti+1],zt),Pt),pn(pn(Kt[ci+1],Kt[ki+1],zt),pn(Kt[Ci+1],Kt[Di+1],zt),Pt),St)/255*(this.premultiplied?T:1),this.b=pn(pn(pn(Kt[Qt+2],Kt[Tt+2],zt),pn(Kt[Wt+2],Kt[ti+2],zt),Pt),pn(pn(Kt[ci+2],Kt[ki+2],zt),pn(Kt[Ci+2],Kt[Di+2],zt),Pt),St)/255*(this.premultiplied?T:1),this.a=T}else this.r=c,this.g=g,this.b=y,this.a=T}toArray(){const{r:s,g:c,b:g,a:y}=this;return[255*s,255*c,255*g,y]}toHslaArray(){let{r:s,g:c,b:g,a:y}=this;if(this.premultiplied){if(y===0)return[0,0,0,0];s/=y,c/=y,g/=y}const T=Math.min(Math.max(s,0),1),E=Math.min(Math.max(c,0),1),D=Math.min(Math.max(g,0),1),W=Math.min(T,E,D),X=Math.max(T,E,D),ae=(W+X)/2;if(W===X)return[0,0,100*ae,y];const ce=X-W,fe=ae>.5?ce/(2-X-W):ce/(X+W);let ye=0;return X===T?ye=(E-D)/ce+(E<D?6:0):X===E?ye=(D-T)/ce+2:X===D&&(ye=(T-E)/ce+4),ye*=60,[Math.min(Math.max(ye,0),360),Math.min(Math.max(100*fe,0),100),Math.min(Math.max(100*ae,0),100),y]}toArray01(){const{r:s,g:c,b:g,a:y}=this;return[s,c,g,y]}toArray01Scaled(s){const{r:c,g,b:y}=this;return[c*s,g*s,y*s]}toArray01Linear(){const{r:s,g:c,b:g,a:y}=this;return[Math.pow(s,2.2),Math.pow(c,2.2),Math.pow(g,2.2),y]}}class Im extends sa{constructor(s,c,g,y,T){super(s,c,g,y,T,!1)}}class Jh extends sa{constructor(s,c,g,y,T){super(s,c,g,y,T,!0)}}function pn(u,s,c){return u*(1-c)+s*c}function zu(u,s,c){return u.map((g,y)=>pn(g,s[y],c))}rs.black=new rs(0,0,0,1),rs.white=new rs(1,1,1,1),rs.transparent=new rs(0,0,0,0),rs.red=new rs(1,0,0,1),rs.blue=new rs(0,0,1,1);var Dc=Object.freeze({__proto__:null,array:zu,color:function(u,s,c){return new rs(pn(u.r,s.r,c),pn(u.g,s.g,c),pn(u.b,s.b,c),pn(u.a,s.a,c))},number:pn});function ml(u,...s){for(const c of s)for(const g in c)u[g]=c[g];return u}class Go extends Error{constructor(s,c){super(c),this.message=c,this.key=s}}class Qh{constructor(s,c=[]){this.parent=s,this.bindings={};for(const[g,y]of c)this.bindings[g]=y}concat(s){return new Qh(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const zl={kind:"null"},tn={kind:"number"},hs={kind:"string"},Jn={kind:"boolean"},zo={kind:"color"},wa={kind:"object"},ns={kind:"value"},Bu={kind:"collator"},Fc={kind:"formatted"},Oc={kind:"resolvedImage"};function Mo(u,s){return{kind:"array",itemType:u,N:s}}function no(u){if(u.kind==="array"){const s=no(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const Rm=[zl,tn,hs,Jn,zo,Fc,wa,Mo(ns),Oc];function Bl(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Bl(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const c of Rm)if(!Bl(c,s))return null}}return`Expected ${no(u)} but found ${no(s)} instead.`}function Na(u,s){return s.some(c=>c.kind===u.kind)}function zc(u,s){return s.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function Nu(u,s){return u.kind==="array"&&s.kind==="array"?u.N===s.N&&Nu(u.itemType,s.itemType):u.kind===s.kind}class Bc{constructor(s,c,g){this.sensitivity=s?c?"variant":"case":c?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,c){return this.collator.compare(s,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vu{constructor(s,c,g,y,T){this.text=s.normalize?s.normalize():s,this.image=c,this.scale=g,this.fontStack=y,this.textColor=T}}class Ao{constructor(s){this.sections=s}static fromString(s){return new Ao([new Vu(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof Ao?s:Ao.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const c of this.sections){if(c.image){const y=c.image.getPrimary().id.toString();s.push(["image",y]);continue}s.push(c.text);const g={};c.fontStack&&(g["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(g["font-scale"]=c.scale),c.textColor&&(g["text-color"]=["rgba"].concat(c.textColor.toNonPremultipliedRenderColor(null).toArray())),s.push(g)}return s}}class Sa{constructor(s,c={}){if(this.id=Oo.from(s),this.options=Object.assign({},c),c.transform){const{a:g,b:y,c:T,d:E,e:D,f:W}=c.transform;this.options.transform=new DOMMatrix([g,y,T,E,D,W])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:s,b:c,c:g,d:y,e:T,f:E}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:s,b:c,c:g,d:y,e:T,f:E}})}static parse(s){let c,g,y,T;try{({name:c,iconsetId:g,params:y,transform:T}=JSON.parse(s)||{})}catch{return null}if(!c)return null;const{a:E,b:D,c:W,d:X,e:ae,f:ce}=T||{};return new Sa({name:c,iconsetId:g},{params:y,transform:new DOMMatrix([E,D,W,X,ae,ce])})}scaleSelf(s,c){return this.options.transform.scaleSelf(s,c),this}}class ko{constructor(s,c,g,y,T=!1){this.primaryId=Oo.from(s),this.primaryOptions=c,g&&(this.secondaryId=Oo.from(g)),this.secondaryOptions=y,this.available=T}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Sa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Sa(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?ko.build({name:s}):s}static build(s,c,g,y){return!s||typeof s=="object"&&!("name"in s)?null:new ko(s,g,c,y)}}function gl(u,s,c,g){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[u,s,c,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[u,s,c,g]:[u,s,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function In(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof rs||u instanceof Bc||u instanceof Ao||u instanceof ko)return!0;if(Array.isArray(u)){for(const s of u)if(!In(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!In(u[s]))return!1;return!0}return!1}function Hr(u){if(u===null)return zl;if(typeof u=="string")return hs;if(typeof u=="boolean")return Jn;if(typeof u=="number")return tn;if(u instanceof rs)return zo;if(u instanceof Bc)return Bu;if(u instanceof Ao)return Fc;if(u instanceof ko)return Oc;if(Array.isArray(u)){const s=u.length;let c;for(const g of u){const y=Hr(g);if(c){if(c===y)continue;c=ns;break}c=y}return Mo(c||ns,s)}return wa}function Zo(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof Ao||u instanceof ko||u instanceof rs?u.toString():JSON.stringify(u)}class _n{constructor(s,c){this.type=s,this.value=c}static parse(s,c){if(s.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!In(s[1]))return c.error("invalid value");const g=s[1];let y=Hr(g);const T=c.expectedType;return y.kind!=="array"||y.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(y=T),new _n(y,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof rs?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ao?this.value.serialize():this.value}}class to{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Nc={string:hs,number:tn,boolean:Jn,object:wa};class fn{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");let g,y=1;const T=s[0];if(T==="array"){let D,W;if(s.length>2){const X=s[1];if(typeof X!="string"||!(X in Nc)||X==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);D=Nc[X],y++}else D=ns;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return c.error('The length argument to "array" must be a positive integer literal',2);W=s[2],y++}g=Mo(D,W)}else g=Nc[T];const E=[];for(;y<s.length;y++){const D=c.parse(s[y],y,ns);if(!D)return null;E.push(D)}return new fn(g,E)}evaluate(s){for(let c=0;c<this.args.length;c++){const g=this.args[c].evaluate(s);if(!Bl(this.type,Hr(g)))return g;if(c===this.args.length-1)throw new to(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${no(Hr(g))} but was expected to be of type ${no(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,c=[s.kind];if(s.kind==="array"){const g=s.itemType;if(g.kind==="string"||g.kind==="number"||g.kind==="boolean"){c.push(g.kind);const y=s.N;(typeof y=="number"||this.args.length>1)&&c.push(y)}}return c.concat(this.args.map(g=>g.serialize()))}}class Nl{constructor(s){this.type=Fc,this.sections=s}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");const g=s[1];if(!Array.isArray(g)&&typeof g=="object")return c.error("First argument must be an image or text section.");const y=[];let T=!1;for(let E=1;E<=s.length-1;++E){const D=s[E];if(T&&typeof D=="object"&&!Array.isArray(D)){T=!1;let W=null;if(D["font-scale"]&&(W=c.parseObjectValue(D["font-scale"],E,"font-scale",tn),!W))return null;let X=null;if(D["text-font"]&&(X=c.parseObjectValue(D["text-font"],E,"text-font",Mo(hs)),!X))return null;let ae=null;if(D["text-color"]&&(ae=c.parseObjectValue(D["text-color"],E,"text-color",zo),!ae))return null;const ce=y[y.length-1];ce.scale=W,ce.font=X,ce.textColor=ae}else{const W=c.parse(s[E],E,ns);if(!W)return null;const X=W.type.kind;if(X!=="string"&&X!=="value"&&X!=="null"&&X!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,y.push({content:W,scale:null,font:null,textColor:null})}}return new Nl(y)}evaluate(s){return new Ao(this.sections.map(c=>{const g=c.content.evaluate(s);return Nu(Hr(g),Oc)?new Vu("",g,null,null,null):new Vu(Zo(g),null,c.scale?c.scale.evaluate(s):null,c.font?c.font.evaluate(s).join(","):null,c.textColor?c.textColor.evaluate(s):null)}))}eachChild(s){for(const c of this.sections)s(c.content),c.scale&&s(c.scale),c.font&&s(c.font),c.textColor&&s(c.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const c of this.sections){s.push(c.content.serialize());const g={};c.scale&&(g["font-scale"]=c.scale.serialize()),c.font&&(g["text-font"]=c.font.serialize()),c.textColor&&(g["text-color"]=c.textColor.serialize()),s.push(g)}return s}}class Vl{constructor(s,c,g,y){this._imageWarnHistory={},this.type=Oc,this.namePrimary=s,this.nameSecondary=c,g&&(this.paramsPrimary=g.params,this.iconsetIdPrimary=g.iconset?g.iconset.id:void 0),y&&(this.paramsSecondary=y.params,this.iconsetIdSecondary=y.iconset?y.iconset.id:void 0)}static parse(s,c){if(s.length<2)return c.error("Expected two or more arguments.");let g=1;const y=[];function T(){if(g<s.length){const D=c.parse(s[g],g++,hs);return D?(y.push({image:D,options:{}}),!0):(c.error(y.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function E(){if(g<s.length){const W=s[g];if((D=W)===null||typeof D!="object"||Array.isArray(D))return!0;const X=W.params,ae=W.iconset,ce=c.concat(g);if(!X&&!ae)return g++,!0;if(X){if(typeof X!="object"||X.constructor!==Object)return ce.error('Image options "params" should be an object'),!1;const fe={},ye=ce.concat(void 0,"params");for(const _t in X){if(!_t)return ye.error("Image parameter name should be non-empty"),!1;const St=ye.concat(void 0,_t).parse(X[_t],void 0,zo,void 0,{typeAnnotation:"coerce"});if(!St)return!1;fe[_t]=St}y[y.length-1].options.params=fe}if(ae){if(typeof ae!="object"||ae.constructor!==Object)return ce.error('Image options "iconset" should be an object'),!1;if(!ae.id)return ce.error('Image options "iconset" should have an "id" property'),!1;y[y.length-1].options.iconset=ae}return g++,!0}var D;return!0}for(let D=0;D<2;D++)if(!T()||!E())return;return new Vl(y[0].image,y[1]?y[1].image:void 0,y[0].options,y[1]?y[1].options:void 0)}evaluateParams(s,c){const g={};if(c){for(const y in c)if(c[y])try{g[y]=c[y].evaluate(s)}catch{continue}if(Object.keys(g).length!==0)return{params:g}}}evaluate(s){const c={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},g=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,y=ko.build(c,g,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if(y&&s.availableImages){const T=y.getPrimary().id;if(y.available=s.availableImages.some(E=>Oo.isEqual(E,T)),y.available){const E=y.getSecondary()?y.getSecondary().id:null;E&&(y.available=s.availableImages.some(D=>Oo.isEqual(D,E)))}}return y}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&s(this.paramsPrimary[c]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&s(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(s,c){const g={};if(c&&(g.iconset={id:c}),s){g.params={};for(const y in s)s[y]&&(g.params[y]=s[y].serialize())}return Object.keys(g).length>0?g:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&s.push(c)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&s.push(c)}return s}}function Va(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}const Od={"to-boolean":Jn,"to-color":zo,"to-number":tn,"to-string":hs};class Yo{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");const g=s[0],y=[];let T=zl;if(g==="to-array"){if(!Array.isArray(s[1]))return null;const E=s[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);T=Mo(c.expectedType.itemType,E)}else{if(!(E>0&&In(s[1][0])))return null;T=Mo(Hr(s[1][0]),E)}for(let D=0;D<E;D++){const W=s[1][D];let X;if(Va(W)==="array")X=c.parse(W,void 0,T.itemType);else{const ae=Va(W);if(ae!==T.itemType.kind)return c.error(`Expected ${T.itemType.kind} but found ${ae}.`);X=c.registry.literal.parse(["literal",W===void 0?null:W],c)}if(!X)return null;y.push(X)}}else{if((g==="to-boolean"||g==="to-string")&&s.length!==2)return c.error("Expected one argument.");T=Od[g];for(let E=1;E<s.length;E++){const D=c.parse(s[E],E,ns);if(!D)return null;y.push(D)}}return new Yo(T,y)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let c,g;for(const y of this.args){if(c=y.evaluate(s),g=null,c instanceof rs)return c;if(typeof c=="string"){const T=s.parseColor(c);if(T)return T}else if(Array.isArray(c)&&(g=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:gl(c[0],c[1],c[2],c[3]),!g))return new rs(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new to(g||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const g of this.args){if(c=g.evaluate(s),c===null)return 0;const y=Number(c);if(!isNaN(y))return y}throw new to(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?Ao.fromString(Zo(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?ko.build(Zo(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(c=>c.evaluate(s)):Zo(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vl(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{s.push(c.serialize())}),s}}const Co=["Unknown","Point","LineString","Polygon"];class Vc{constructor(s,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Co[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:g,y}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(g*c-s[0])+this.featureDistanceData.bearing[1]*(y*c-s[1])}return 0}parseColor(s){let c=this._parseColorCache[s];return c||(c=this._parseColorCache[s]=rs.parse(s)),c}getConfig(s){return this.options?this.options.get(s):null}}class ho{constructor(s,c,g,y,T){this.name=s,this.type=c,this._evaluate=g,this.args=y,this._overloadIndex=T}evaluate(s){if(!this._evaluate){const c=ho.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,c){const g=s[0],y=ho.definitions[g];if(!y)return c.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(y)?y[0]:y.type,E=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,D=[];let W=null,X=-1;for(const[ae,ce]of E){if(Array.isArray(ae)&&ae.length!==s.length-1)continue;D.push(ae),X++,W=new Ju(c.registry,c.path,null,c.scope,void 0,c._scope,c.options);const fe=[];let ye=!1;for(let _t=1;_t<s.length;_t++){const St=s[_t],Pt=Array.isArray(ae)?ae[_t-1]:ae.type,zt=W.parse(St,1+fe.length,Pt);if(!zt){ye=!0;break}fe.push(zt)}if(!ye)if(Array.isArray(ae)&&ae.length!==fe.length)W.error(`Expected ${ae.length} arguments, but found ${fe.length} instead.`);else{for(let _t=0;_t<fe.length;_t++){const St=Array.isArray(ae)?ae[_t]:ae.type,Pt=fe[_t];W.concat(_t+1).checkSubtype(St,Pt.type)}if(W.errors.length===0)return new ho(g,T,ce,fe,X)}}if(D.length===1)c.errors.push(...W.errors);else{const ae=(D.length?D:E.map(([fe])=>fe)).map(ef).join(" | "),ce=[];for(let fe=1;fe<s.length;fe++){const ye=c.parse(s[fe],1+ce.length);if(!ye)return null;ce.push(no(ye.type))}c.error(`Expected arguments of type ${ae}, but found (${ce.join(", ")}) instead.`)}return null}static register(s,c){ho.definitions=c;for(const g in c)s[g]=ho}}function ef(u){return Array.isArray(u)?`(${u.map(no).join(", ")})`:`(${no(u.type)}...)`}class fa{constructor(s,c,g){this.type=Bu,this.locale=g,this.caseSensitive=s,this.diacriticSensitive=c}static parse(s,c){if(s.length!==2)return c.error("Expected one argument.");const g=s[1];if(typeof g!="object"||Array.isArray(g))return c.error("Collator options argument must be an object.");const y=g["case-sensitive"]===void 0?c.parse(!1,1,Jn):c.parseObjectValue(g["case-sensitive"],1,"case-sensitive",Jn);if(!y)return null;const T=g["diacritic-sensitive"]===void 0?c.parse(!1,1,Jn):c.parseObjectValue(g["diacritic-sensitive"],1,"diacritic-sensitive",Jn);if(!T)return null;let E=null;return g.locale&&(E=c.parseObjectValue(g.locale,1,"locale",hs),!E)?null:new fa(y,T,E)}evaluate(s){return new Bc(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function wo(u,s,c=0,g=u.length-1,y=Lm){for(;g>c;){if(g-c>600){const W=g-c+1,X=s-c+1,ae=Math.log(W),ce=.5*Math.exp(2*ae/3),fe=.5*Math.sqrt(ae*ce*(W-ce)/W)*(X-W/2<0?-1:1);wo(u,s,Math.max(c,Math.floor(s-X*ce/W+fe)),Math.min(g,Math.floor(s+(W-X)*ce/W+fe)),y)}const T=u[s];let E=c,D=g;for($c(u,c,s),y(u[g],T)>0&&$c(u,c,g);E<D;){for($c(u,E,D),E++,D--;y(u[E],T)<0;)E++;for(;y(u[D],T)>0;)D--}y(u[c],T)===0?$c(u,c,D):(D++,$c(u,D,g)),D<=s&&(c=D+1),s<=D&&(g=D-1)}}function $c(u,s,c){const g=u[s];u[s]=u[c],u[c]=g}function Lm(u,s){return u<s?-1:u>s?1:0}function km(u){let s=0;for(let c,g,y=0,T=u.length,E=T-1;y<T;E=y++)c=u[y],g=u[E],s+=(g.x-c.x)*(c.y+g.y);return s}function $a(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function $l(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function _l(u,s,c){const g=u[0]-s[0],y=u[1]-s[1],T=u[0]-c[0],E=u[1]-c[1];return g*E-T*y==0&&g*T<=0&&y*E<=0}function Ul(u,s,c=!1){let g=!1;for(let D=0,W=s.length;D<W;D++){const X=s[D];for(let ae=0,ce=X.length,fe=ce-1;ae<ce;fe=ae++){const ye=X[fe],_t=X[ae];if(_l(u,ye,_t))return c;(T=ye)[1]>(y=u)[1]!=(E=_t)[1]>y[1]&&y[0]<(E[0]-T[0])*(y[1]-T[1])/(E[1]-T[1])+T[0]&&(g=!g)}}var y,T,E;return g}function zd(u,s,c,g){const y=g[0]-c[0],T=g[1]-c[1],E=(u[0]-c[0])*T-y*(u[1]-c[1]),D=(s[0]-c[0])*T-y*(s[1]-c[1]);return E>0&&D<0||E<0&&D>0}function $u(u,s,c,g){return(y=[g[0]-c[0],g[1]-c[1]])[0]*(T=[s[0]-u[0],s[1]-u[1]])[1]-y[1]*T[0]!=0&&!(!zd(u,s,c,g)||!zd(c,g,u,s));var y,T}function tf(u){const s=new rr(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new rr(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const g of u[0])s.x>g.x&&(s.x=g.x),s.y>g.y&&(s.y=g.y),c.x<g.x&&(c.x=g.x),c.y<g.y&&(c.y=g.y);return{min:s,max:c}}const Ta=8192;function Dm(u,s){const c=(180+u[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,y=Math.pow(2,s.z);return[Math.round(c*y*Ta),Math.round(g*y*Ta)]}function Fm(u,s){for(let c=0;c<s.length;c++)if(Ul(u,s[c]))return!0;return!1}function Bd(u,s,c){for(const g of c)for(let y=0,T=g.length,E=T-1;y<T;E=y++)if($u(u,s,g[E],g[y]))return!0;return!1}function Nd(u,s){for(let c=0;c<u.length;++c)if(!Ul(u[c],s))return!1;for(let c=0;c<u.length-1;++c)if(Bd(u[c],u[c+1],s))return!1;return!0}function yl(u,s){for(let c=0;c<s.length;c++)if(Nd(u,s[c]))return!0;return!1}function rf(u,s,c){const g=[];for(let y=0;y<u.length;y++){const T=[];for(let E=0;E<u[y].length;E++){const D=Dm(u[y][E],c);$a(s,D),T.push(D)}g.push(T)}return g}function Vd(u,s,c){const g=[];for(let y=0;y<u.length;y++){const T=rf(u[y],s,c);g.push(T)}return g}function Uu(u,s,c,g){if(u[0]<c[0]||u[0]>c[2]){const y=.5*g;let T=u[0]-c[0]>y?-g:c[0]-u[0]>y?g:0;T===0&&(T=u[0]-c[2]>y?-g:c[2]-u[0]>y?g:0),u[0]+=T}$a(s,u)}function nf(u,s,c,g){const y=Math.pow(2,g.z)*Ta,T=[g.x*Ta,g.y*Ta],E=[];if(!u)return E;for(const D of u)for(const W of D){const X=[W.x+T[0],W.y+T[1]];Uu(X,s,c,y),E.push(X)}return E}function sf(u,s,c,g){const y=Math.pow(2,g.z)*Ta,T=[g.x*Ta,g.y*Ta],E=[];if(!u)return E;for(const W of u){const X=[];for(const ae of W){const ce=[ae.x+T[0],ae.y+T[1]];$a(s,ce),X.push(ce)}E.push(X)}if(s[2]-s[0]<=y/2){(D=s)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const W of E)for(const X of W)Uu(X,s,c,y)}var D;return E}class So{constructor(s,c){this.type=Jn,this.geojson=s,this.geometries=c}static parse(s,c){if(s.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(In(s[1])){const g=s[1];if(g.type==="FeatureCollection")for(let y=0;y<g.features.length;++y){const T=g.features[y].geometry.type;if(T==="Polygon"||T==="MultiPolygon")return new So(g,g.features[y].geometry)}else if(g.type==="Feature"){const y=g.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new So(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new So(g,g)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(c,g){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],E=c.canonicalID();if(!E)return!1;if(g.type==="Polygon"){const D=rf(g.coordinates,T,E),W=nf(c.geometry(),y,T,E);if(!$l(y,T))return!1;for(const X of W)if(!Ul(X,D))return!1}if(g.type==="MultiPolygon"){const D=Vd(g.coordinates,T,E),W=nf(c.geometry(),y,T,E);if(!$l(y,T))return!1;for(const X of W)if(!Fm(X,D))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(c,g){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],E=c.canonicalID();if(!E)return!1;if(g.type==="Polygon"){const D=rf(g.coordinates,T,E),W=sf(c.geometry(),y,T,E);if(!$l(y,T))return!1;for(const X of W)if(!Nd(X,D))return!1}if(g.type==="MultiPolygon"){const D=Vd(g.coordinates,T,E),W=sf(c.geometry(),y,T,E);if(!$l(y,T))return!1;for(const X of W)if(!yl(X,D))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Uc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},of=1/298.257223563,af=of*(2-of),Gl=Math.PI/180;class Hl{static fromTile(s,c,g){const y=Math.PI*(1-2*(s+.5)/Math.pow(2,c)),T=Math.atan(.5*(Math.exp(y)-Math.exp(-y)))/Gl;return new Hl(T,g)}static get units(){return Uc}constructor(s,c){if(s===void 0)throw new Error("No latitude given.");if(c&&!Uc[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Uc).join(", ")}`);const g=6378.137*Gl*(c?Uc[c]:1),y=Math.cos(s*Gl),T=1/(1-af*(1-y*y)),E=Math.sqrt(T);this.kx=g*E*y,this.ky=g*E*T*(1-af)}distance(s,c){const g=Ho(s[0]-c[0])*this.kx,y=(s[1]-c[1])*this.ky;return Math.sqrt(g*g+y*y)}bearing(s,c){const g=Ho(c[0]-s[0])*this.kx;return Math.atan2(g,(c[1]-s[1])*this.ky)/Gl}destination(s,c,g){const y=g*Gl;return this.offset(s,Math.sin(y)*c,Math.cos(y)*c)}offset(s,c,g){return[s[0]+c/this.kx,s[1]+g/this.ky]}lineDistance(s){let c=0;for(let g=0;g<s.length-1;g++)c+=this.distance(s[g],s[g+1]);return c}area(s){let c=0;for(let g=0;g<s.length;g++){const y=s[g];for(let T=0,E=y.length,D=E-1;T<E;D=T++)c+=Ho(y[T][0]-y[D][0])*(y[T][1]+y[D][1])*(g?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(s,c){let g=0;if(c<=0)return s[0];for(let y=0;y<s.length-1;y++){const T=s[y],E=s[y+1],D=this.distance(T,E);if(g+=D,g>c)return Gu(T,E,(c-(g-D))/D)}return s[s.length-1]}pointToSegmentDistance(s,c,g){let[y,T]=c,E=Ho(g[0]-y)*this.kx,D=(g[1]-T)*this.ky;if(E!==0||D!==0){const W=(Ho(s[0]-y)*this.kx*E+(s[1]-T)*this.ky*D)/(E*E+D*D);W>1?(y=g[0],T=g[1]):W>0&&(y+=E/this.kx*W,T+=D/this.ky*W)}return E=Ho(s[0]-y)*this.kx,D=(s[1]-T)*this.ky,Math.sqrt(E*E+D*D)}pointOnLine(s,c){let g=1/0,y=s[0][0],T=s[0][1],E=0,D=0;for(let W=0;W<s.length-1;W++){let X=s[W][0],ae=s[W][1],ce=Ho(s[W+1][0]-X)*this.kx,fe=(s[W+1][1]-ae)*this.ky,ye=0;ce===0&&fe===0||(ye=(Ho(c[0]-X)*this.kx*ce+(c[1]-ae)*this.ky*fe)/(ce*ce+fe*fe),ye>1?(X=s[W+1][0],ae=s[W+1][1]):ye>0&&(X+=ce/this.kx*ye,ae+=fe/this.ky*ye)),ce=Ho(c[0]-X)*this.kx,fe=(c[1]-ae)*this.ky;const _t=ce*ce+fe*fe;_t<g&&(g=_t,y=X,T=ae,E=W,D=ye)}return{point:[y,T],index:E,t:Math.max(0,Math.min(1,D))}}lineSlice(s,c,g){let y=this.pointOnLine(g,s),T=this.pointOnLine(g,c);if(y.index>T.index||y.index===T.index&&y.t>T.t){const X=y;y=T,T=X}const E=[y.point],D=y.index+1,W=T.index;!lf(g[D],E[0])&&D<=W&&E.push(g[D]);for(let X=D+1;X<=W;X++)E.push(g[X]);return lf(g[W],T.point)||E.push(T.point),E}lineSliceAlong(s,c,g){let y=0;const T=[];for(let E=0;E<g.length-1;E++){const D=g[E],W=g[E+1],X=this.distance(D,W);if(y+=X,y>s&&T.length===0&&T.push(Gu(D,W,(s-(y-X))/X)),y>=c)return T.push(Gu(D,W,(c-(y-X))/X)),T;y>s&&T.push(W)}return T}bufferPoint(s,c){const g=c/this.ky,y=c/this.kx;return[s[0]-y,s[1]-g,s[0]+y,s[1]+g]}bufferBBox(s,c){const g=c/this.ky,y=c/this.kx;return[s[0]-y,s[1]-g,s[2]+y,s[3]+g]}insideBBox(s,c){return Ho(s[0]-c[0])>=0&&Ho(s[0]-c[2])<=0&&s[1]>=c[1]&&s[1]<=c[3]}}function lf(u,s){return u[0]===s[0]&&u[1]===s[1]}function Gu(u,s,c){const g=Ho(s[0]-u[0]);return[u[0]+g*c,u[1]+(s[1]-u[1])*c]}function Ho(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Hu{constructor(s=[],c=(g,y)=>g<y?-1:g>y?1:0){if(this.data=s,this.length=this.data.length,this.compare=c,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:c,compare:g}=this,y=c[s];for(;s>0;){const T=s-1>>1,E=c[T];if(g(y,E)>=0)break;c[s]=E,s=T}c[s]=y}_down(s){const{data:c,compare:g}=this,y=this.length>>1,T=c[s];for(;s<y;){let E=1+(s<<1);const D=E+1;if(D<this.length&&g(c[D],c[E])<0&&(E=D),g(c[E],T)>=0)break;c[s]=c[E],s=E}c[s]=T}}var Fr=8192;function cf(u,s){return s.dist-u.dist}const jl=100,Wl=50;function Gc(u){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++)if(s[c]!==u[c])return!1;return!0}function Hc(u){return u[1]-u[0]+1}function da(u,s){const c=u[1]>=u[0]&&u[1]<s;return c||console.warn("Distance Expression: Index is out of range"),c}function ju(u,s){if(u[0]>u[1])return[null,null];const c=Hc(u);if(s){if(c===2)return[u,null];const g=Math.floor(c/2);return[[u[0],u[0]+g],[u[0]+g,u[1]]]}{if(c===1)return[u,null];const g=Math.floor(c/2)-1;return[[u[0],u[0]+g],[u[0]+g+1,u[1]]]}}function Ko(u,s){const c=[1/0,1/0,-1/0,-1/0];if(!da(s,u.length))return c;for(let g=s[0];g<=s[1];++g)$a(c,u[g]);return c}function $n(u){const s=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let g=0;g<u[c].length;++g)$a(s,u[c][g]);return s}function ql(u,s,c){if(Gc(u)||Gc(s))return NaN;let g=0,y=0;return u[2]<s[0]&&(g=s[0]-u[2]),u[0]>s[2]&&(g=u[0]-s[2]),u[1]>s[3]&&(y=u[1]-s[3]),u[3]<s[1]&&(y=s[1]-u[3]),c.distance([0,0],[g,y])}function Om(u){return 360*u-180}function zm(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Wu(u,s){const c=Math.pow(2,s.z),g=(u.y/Fr+s.y)/c;return[Om((u.x/Fr+s.x)/c),zm(g)]}function Bm(u,s){const c=[];for(let g=0;g<u.length;++g)c.push(Wu(u[g],s));return c}function Ns(u,s,c){const g=c.pointOnLine(s,u).point;return c.distance(u,g)}function $d(u,s,c,g,y){const T=c.slice(g[0],g[1]+1);let E=1/0;for(let D=s[0];D<=s[1];++D)if((E=Math.min(E,Ns(u[D],T,y)))===0)return 0;return E}function uf(u,s,c,g,y){const T=Math.min(y.pointToSegmentDistance(u,c,g),y.pointToSegmentDistance(s,c,g)),E=Math.min(y.pointToSegmentDistance(c,u,s),y.pointToSegmentDistance(g,u,s));return Math.min(T,E)}function Nm(u,s,c,g,y){if(!da(s,u.length)||!da(g,c.length))return NaN;let T=1/0;for(let E=s[0];E<s[1];++E)for(let D=g[0];D<g[1];++D){if($u(u[E],u[E+1],c[D],c[D+1]))return 0;T=Math.min(T,uf(u[E],u[E+1],c[D],c[D+1],y))}return T}function Vm(u,s,c,g,y){if(!da(s,u.length)||!da(g,c.length))return NaN;let T=1/0;for(let E=s[0];E<=s[1];++E)for(let D=g[0];D<=g[1];++D)if((T=Math.min(T,y.distance(u[E],c[D])))===0)return T;return T}function $m(u,s,c){if(Ul(u,s,!0))return 0;let g=1/0;for(const y of s){const T=y.length;if(T<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(y[0]!==y[T-1]&&(g=Math.min(g,c.pointToSegmentDistance(u,y[T-1],y[0])))===0||(g=Math.min(g,Ns(u,y,c)))===0)return g}return g}function Um(u,s,c,g){if(!da(s,u.length))return NaN;for(let T=s[0];T<=s[1];++T)if(Ul(u[T],c,!0))return 0;let y=1/0;for(let T=s[0];T<s[1];++T)for(const E of c)for(let D=0,W=E.length,X=W-1;D<W;X=D++){if($u(u[T],u[T+1],E[X],E[D]))return 0;y=Math.min(y,uf(u[T],u[T+1],E[X],E[D],g))}return y}function Ud(u,s){for(const c of u)for(let g=0;g<=c.length-1;++g)if(Ul(c[g],s,!0))return!0;return!1}function Gm(u,s,c,g=1/0){const y=$n(u),T=$n(s);if(g!==1/0&&ql(y,T,c)>=g)return g;if($l(y,T)){if(Ud(u,s))return 0}else if(Ud(s,u))return 0;let E=g;for(const D of u)for(let W=0,X=D.length,ae=X-1;W<X;ae=W++)for(const ce of s)for(let fe=0,ye=ce.length,_t=ye-1;fe<ye;_t=fe++){if($u(D[ae],D[W],ce[_t],ce[fe]))return 0;E=Math.min(E,uf(D[ae],D[W],ce[_t],ce[fe],c))}return E}function qu(u,s,c,g,y,T,E){if(T===null||E===null)return;const D=ql(Ko(g,T),Ko(y,E),c);D<s&&u.push({dist:D,range1:T,range2:E})}function Hm(u,s,c,g,y=1/0){let T=Math.min(g.distance(u[0],c[0][0]),y);if(T===0)return T;const E=new Hu([{dist:0,range1:[0,u.length-1],range2:[0,0]}],cf),D=s?Wl:jl,W=$n(c);for(;E.length;){const X=E.pop();if(X.dist>=T)continue;const ae=X.range1;if(Hc(ae)<=D){if(!da(ae,u.length))return NaN;if(s){const ce=Um(u,ae,c,g);if((T=Math.min(T,ce))===0)return T}else for(let ce=ae[0];ce<=ae[1];++ce){const fe=$m(u[ce],c,g);if((T=Math.min(T,fe))===0)return T}}else{const ce=ju(ae,s);if(ce[0]!==null){const fe=ql(Ko(u,ce[0]),W,g);fe<T&&E.push({dist:fe,range1:ce[0],range2:[0,0]})}if(ce[1]!==null){const fe=ql(Ko(u,ce[1]),W,g);fe<T&&E.push({dist:fe,range1:ce[1],range2:[0,0]})}}}return T}function Gd(u,s,c,g,y,T=1/0){let E=Math.min(T,y.distance(u[0],c[0]));if(E===0)return E;const D=new Hu([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],cf),W=s?Wl:jl,X=g?Wl:jl;for(;D.length;){const ae=D.pop();if(ae.dist>=E)continue;const ce=ae.range1,fe=ae.range2;if(Hc(ce)<=W&&Hc(fe)<=X){if(!da(ce,u.length)||!da(fe,c.length))return NaN;if(s&&g?E=Math.min(E,Nm(u,ce,c,fe,y)):s||g?s&&!g?E=Math.min(E,$d(c,fe,u,ce,y)):!s&&g&&(E=Math.min(E,$d(u,ce,c,fe,y))):E=Math.min(E,Vm(u,ce,c,fe,y)),E===0)return E}else{const ye=ju(ce,s),_t=ju(fe,g);qu(D,E,y,u,c,ye[0],_t[0]),qu(D,E,y,u,c,ye[0],_t[1]),qu(D,E,y,u,c,ye[1],_t[0]),qu(D,E,y,u,c,ye[1],_t[1])}}return E}function hf(u,s,c,g,y=1/0){let T=y;const E=Ko(u,[0,u.length-1]);for(const D of c)if(!(T!==1/0&&ql(E,Ko(D,[0,D.length-1]),g)>=T)&&(T=Math.min(T,Gd(u,s,D,!0,g,T)),T===0))return T;return T}function Xu(u,s,c,g,y=1/0){let T=y;const E=Ko(u,[0,u.length-1]);for(const D of c){if(T!==1/0&&ql(E,$n(D),g)>=T)continue;const W=Hm(u,s,D,g,T);if(isNaN(W))return W;if((T=Math.min(T,W))===0)return T}return T}function ff(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class vl{constructor(s,c){this.type=tn,this.geojson=s,this.geometries=c}static parse(s,c){if(s.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(In(s[1])){const g=s[1];if(g.type==="FeatureCollection"){for(let y=0;y<g.features.length;++y)if(ff(g.features[y].geometry.type))return new vl(g,g.features[y].geometry)}else if(g.type==="Feature"){if(ff(g.geometry.type))return new vl(g,g.geometry)}else if(ff(g.type))return new vl(g,g)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const c=s.geometry(),g=s.canonicalID();if(c!=null&&g!=null){if(s.geometryType()==="Point")return function(y,T,E){const D=[];for(const X of y)for(const ae of X)D.push(Wu(ae,T));const W=new Hl(D[0][1],"meters");return E.type==="Point"||E.type==="MultiPoint"||E.type==="LineString"?Gd(D,!1,E.type==="Point"?[E.coordinates]:E.coordinates,E.type==="LineString",W):E.type==="MultiLineString"?hf(D,!1,E.coordinates,W):E.type==="Polygon"||E.type==="MultiPolygon"?Xu(D,!1,E.type==="Polygon"?[E.coordinates]:E.coordinates,W):null}(c,g,this.geometries);if(s.geometryType()==="LineString")return function(y,T,E){const D=[];for(const X of y){const ae=[];for(const ce of X)ae.push(Wu(ce,T));D.push(ae)}const W=new Hl(D[0][0][1],"meters");if(E.type==="Point"||E.type==="MultiPoint"||E.type==="LineString")return hf(E.type==="Point"?[E.coordinates]:E.coordinates,E.type==="LineString",D,W);if(E.type==="MultiLineString"){let X=1/0;for(let ae=0;ae<E.coordinates.length;ae++){const ce=hf(E.coordinates[ae],!0,D,W,X);if(isNaN(ce))return ce;if((X=Math.min(X,ce))===0)return X}return X}if(E.type==="Polygon"||E.type==="MultiPolygon"){let X=1/0;for(let ae=0;ae<D.length;ae++){const ce=Xu(D[ae],!0,E.type==="Polygon"?[E.coordinates]:E.coordinates,W,X);if(isNaN(ce))return ce;if((X=Math.min(X,ce))===0)return X}return X}return null}(c,g,this.geometries);if(s.geometryType()==="Polygon")return function(y,T,E){const D=[];for(const X of function(ae,ce){const fe=ae.length;if(fe<=1)return[ae];const ye=[];let _t,St;for(let Pt=0;Pt<fe;Pt++){const zt=km(ae[Pt]);zt!==0&&(ae[Pt].area=Math.abs(zt),St===void 0&&(St=zt<0),St===zt<0?(_t&&ye.push(_t),_t=[ae[Pt]]):_t.push(ae[Pt]))}return _t&&ye.push(_t),ye}(y)){const ae=[];for(let ce=0;ce<X.length;++ce)ae.push(Bm(X[ce],T));D.push(ae)}const W=new Hl(D[0][0][0][1],"meters");if(E.type==="Point"||E.type==="MultiPoint"||E.type==="LineString")return Xu(E.type==="Point"?[E.coordinates]:E.coordinates,E.type==="LineString",D,W);if(E.type==="MultiLineString"){let X=1/0;for(let ae=0;ae<E.coordinates.length;ae++){const ce=Xu(E.coordinates[ae],!0,D,W,X);if(isNaN(ce))return ce;if((X=Math.min(X,ce))===0)return X}return X}return E.type==="Polygon"||E.type==="MultiPolygon"?function(X,ae,ce){let fe=1/0;for(const ye of X)for(const _t of ae){const St=Gm(ye,_t,ce,fe);if(isNaN(St))return St;if((fe=Math.min(fe,St))===0)return fe}return fe}(E.type==="Polygon"?[E.coordinates]:E.coordinates,D,W):null}(c,g,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xl(u){if(u instanceof ho&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof So||u instanceof vl)return!1;if(u instanceof Yl)return u.featureConstant;let s=!0;return u.eachChild(c=>{s&&!Xl(c)&&(s=!1)}),s}function Zu(u){if(u instanceof ho&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(c=>{s&&!Zu(c)&&(s=!1)}),s}function Yu(u){if(u instanceof Yl)return new Set([u.key]);let s=new Set;return u.eachChild(c=>{s=new Set([...s,...Yu(c)])}),s}function Zl(u,s){if(u instanceof ho&&s.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(g=>{c&&!Zl(g,s)&&(c=!1)}),c}function Hd(u,s,c){return[u,s,c].filter(Boolean).join("")}function df(u,s){switch(u){case"string":return Zo(s);case"number":return+s;case"boolean":return!!s;case"color":return rs.parse(s);case"formatted":return Ao.fromString(Zo(s));case"resolvedImage":return ko.build(Zo(s))}return s}function jd(u,s,c,g){return g!==void 0&&(u=g*Math.round(u/g)),s!==void 0&&u<s&&(u=s),c!==void 0&&u>c&&(u=c),u}class Yl{constructor(s,c,g,y=!1){this.type=s,this.key=c,this.scope=g,this.featureConstant=y}static parse(s,c){let g=c.expectedType;if(g==null&&(g=ns),s.length<2||s.length>3)return c.error("Invalid number of arguments for 'config' expression.");const y=c.parse(s[1],1);if(!(y instanceof _n))return c.error("Key name of 'config' expression must be a string literal.");let T,E=!0;const D=Zo(y.value);if(s.length>=3){const W=c.parse(s[2],2);if(!(W instanceof _n))return c.error("Scope of 'config' expression must be a string literal.");T=Zo(W.value)}if(c.options){const W=Hd(D,T,c._scope),X=c.options.get(W);X&&(E=Xl(X.value||X.default))}return new Yl(g,D,T,E)}evaluate(s){const c=Hd(this.key,this.scope,s.scope),g=s.getConfig(c);if(!g)return null;const{type:y,value:T,values:E,minValue:D,maxValue:W,stepValue:X}=g,ae=g.default.evaluate(s);let ce=ae;if(T){const fe=s.scope;s.scope=(fe||"").split("").slice(1).join(""),ce=T.evaluate(s),s.scope=fe}return y&&(ce=df(y,ce)),ce===void 0||D===void 0&&W===void 0&&X===void 0||(typeof ce=="number"?ce=jd(ce,D,W,X):Array.isArray(ce)&&(ce=ce.map(fe=>typeof fe=="number"?jd(fe,D,W,X):fe))),T!==void 0&&ce!==void 0&&E&&!E.includes(ce)&&(ce=ae,y&&(ce=df(y,ce))),(y&&y!==this.type||ce!==void 0&&!Nu(Hr(ce),this.type))&&(ce=df(this.type.kind,ce)),ce}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.scope),s}}class Ku{constructor(s,c){this.type=c.type,this.name=s,this.boundExpression=c}static parse(s,c){if(s.length!==2||typeof s[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const g=s[1];return c.scope.has(g)?new Ku(g,c.scope.get(g)):c.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ju{constructor(s,c=[],g,y=new Qh,T=[],E,D){this.registry=s,this.path=c,this.key=c.map(W=>typeof W=="string"?`['${W}']`:`[${W}]`).join(""),this.scope=y,this.errors=T,this.expectedType=g,this._scope=E,this.options=D}parse(s,c,g,y,T={}){return c||g?this.concat(c,null,g,y)._parse(s,T):this._parse(s,T)}parseObjectValue(s,c,g,y,T,E={}){return this.concat(c,g,y,T)._parse(s,E)}_parse(s,c){function g(y,T,E){return E==="assert"?new fn(T,[y]):E==="coerce"?new Yo(T,[y]):y}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=typeof s[0]=="string"?this.registry[s[0]]:void 0;if(y){let T=y.parse(s,this);if(!T)return null;if(this.expectedType){const E=this.expectedType,D=T.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||D.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string"){if(this.checkSubtype(E,D))return null}else T=g(T,E,c.typeAnnotation||"coerce");else T=g(T,E,c.typeAnnotation||"assert")}if(!(T instanceof _n)&&T.type.kind!=="resolvedImage"&&pf(T)){const E=new Vc(this._scope,this.options);try{T=new _n(T.type,T.evaluate(E))}catch(D){return this.error(D.message),null}}return T}return Yo.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,c,g,y){let T=typeof s=="number"?this.path.concat(s):this.path;T=typeof c=="string"?T.concat(c):T;const E=y?this.scope.concat(y):this.scope;return new Ju(this.registry,T,g||null,E,this.errors,this._scope,this.options)}error(s,...c){const g=`${this.key}${c.map(y=>`[${y}]`).join("")}`;this.errors.push(new Go(g,s))}checkSubtype(s,c){const g=Bl(s,c);return g&&this.error(g),g}}function pf(u){if(u instanceof Ku)return pf(u.boundExpression);if(u instanceof ho&&u.name==="error"||u instanceof fa||u instanceof So||u instanceof vl||u instanceof Yl)return!1;const s=u instanceof Yo||u instanceof fn;let c=!0;return u.eachChild(g=>{c=s?c&&pf(g):c&&g instanceof _n}),!!c&&Xl(u)&&Zl(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Qu(u,s){const c=u.length-1;let g,y,T=0,E=c,D=0;for(;T<=E;)if(D=Math.floor((T+E)/2),g=u[D],y=u[D+1],g<=s){if(D===c||s<y)return D;T=D+1}else{if(!(g>s))throw new to("Input is not a number.");E=D-1}return 0}class jc{constructor(s,c,g){this.type=s,this.input=c,this.labels=[],this.outputs=[];for(const[y,T]of g)this.labels.push(y),this.outputs.push(T)}static parse(s,c){if(s.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return c.error("Expected an even number of arguments.");const g=c.parse(s[1],1,tn);if(!g)return null;const y=[];let T=null;c.expectedType&&c.expectedType.kind!=="value"&&(T=c.expectedType);for(let E=1;E<s.length;E+=2){const D=E===1?-1/0:s[E],W=s[E+1],X=E,ae=E+1;if(typeof D!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(y.length&&y[y.length-1][0]>=D)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',X);const ce=c.parse(W,ae,T);if(!ce)return null;T=T||ce.type,y.push([D,ce])}return new jc(T,g,y)}evaluate(s){const c=this.labels,g=this.outputs;if(c.length===1)return g[0].evaluate(s);const y=this.input.evaluate(s);if(y<=c[0])return g[0].evaluate(s);const T=c.length;return y>=c[T-1]?g[T-1].evaluate(s):g[Qu(c,y)].evaluate(s)}eachChild(s){s(this.input);for(const c of this.outputs)s(c)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&s.push(this.labels[c]),s.push(this.outputs[c].serialize());return s}}const Wd=.95047,qd=1.08883,Xd=4/29,Ua=6/29,Zd=3*Ua*Ua,Yd=Ua*Ua*Ua,jm=Math.PI/180,Wm=180/Math.PI;function mf(u){return u>Yd?Math.pow(u,1/3):u/Zd+Xd}function eh(u){return u>Ua?u*u*u:Zd*(u-Xd)}function th(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function Ga(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function gf(u){const s=Ga(u.r),c=Ga(u.g),g=Ga(u.b),y=mf((.4124564*s+.3575761*c+.1804375*g)/Wd),T=mf((.2126729*s+.7151522*c+.072175*g)/1);return{l:116*T-16,a:500*(y-T),b:200*(T-mf((.0193339*s+.119192*c+.9503041*g)/qd)),alpha:u.a}}function _f(u){let s=(u.l+16)/116,c=isNaN(u.a)?s:s+u.a/500,g=isNaN(u.b)?s:s-u.b/200;return s=1*eh(s),c=Wd*eh(c),g=qd*eh(g),new rs(th(3.2404542*c-1.5371385*s-.4985314*g),th(-.969266*c+1.8760108*s+.041556*g),th(.0556434*c-.2040259*s+1.0572252*g),u.alpha)}function qm(u,s,c){const g=s-u;return u+c*(g>180||g<-180?g-360*Math.round(g/360):g)}const xl={forward:gf,reverse:_f,interpolate:function(u,s,c){return{l:pn(u.l,s.l,c),a:pn(u.a,s.a,c),b:pn(u.b,s.b,c),alpha:pn(u.alpha,s.alpha,c)}}},bl={forward:function(u){const{l:s,a:c,b:g}=gf(u),y=Math.atan2(g,c)*Wm;return{h:y<0?y+360:y,c:Math.sqrt(c*c+g*g),l:s,alpha:u.a}},reverse:function(u){const s=u.h*jm,c=u.c;return _f({l:u.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:u.alpha})},interpolate:function(u,s,c){return{h:qm(u.h,s.h,c),c:pn(u.c,s.c,c),l:pn(u.l,s.l,c),alpha:pn(u.alpha,s.alpha,c)}}};var Kd=Object.freeze({__proto__:null,hcl:bl,lab:xl});class jo{constructor(s,c,g,y,T){this.type=s,this.operator=c,this.interpolation=g,this.input=y,this.labels=[],this.outputs=[];for(const[E,D]of T)this.labels.push(E),this.outputs.push(D)}static interpolationFactor(s,c,g,y){let T=0;if(s.name==="exponential")T=ih(c,s.base,g,y);else if(s.name==="linear")T=ih(c,1,g,y);else if(s.name==="cubic-bezier"){const E=s.controlPoints;T=new xs(E[0],E[1],E[2],E[3]).solve(ih(c,1,g,y))}return T}static parse(s,c){let[g,y,T,...E]=s;if(!Array.isArray(y)||y.length===0)return c.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const X=y[1];if(typeof X!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:X}}else{if(y[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const X=y.slice(1);if(X.length!==4||X.some(ae=>typeof ae!="number"||ae<0||ae>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:X}}}if(s.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(T=c.parse(T,2,tn),!T)return null;const D=[];let W=null;g==="interpolate-hcl"||g==="interpolate-lab"?W=zo:c.expectedType&&c.expectedType.kind!=="value"&&(W=c.expectedType);for(let X=0;X<E.length;X+=2){const ae=E[X],ce=E[X+1],fe=X+3,ye=X+4;if(typeof ae!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',fe);if(D.length&&D[D.length-1][0]>=ae)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',fe);const _t=c.parse(ce,ye,W);if(!_t)return null;W=W||_t.type,D.push([ae,_t])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new jo(W,g,y,T,D):c.error(`Type ${no(W)} is not interpolatable.`)}evaluate(s){const c=this.labels,g=this.outputs;if(c.length===1)return g[0].evaluate(s);const y=this.input.evaluate(s);if(y<=c[0])return g[0].evaluate(s);const T=c.length;if(y>=c[T-1])return g[T-1].evaluate(s);const E=Qu(c,y),D=jo.interpolationFactor(this.interpolation,y,c[E],c[E+1]),W=g[E].evaluate(s),X=g[E+1].evaluate(s);return this.operator==="interpolate"?Dc[this.type.kind.toLowerCase()](W,X,D):this.operator==="interpolate-hcl"?bl.reverse(bl.interpolate(bl.forward(W),bl.forward(X),D)):xl.reverse(xl.interpolate(xl.forward(W),xl.forward(X),D))}eachChild(s){s(this.input);for(const c of this.outputs)s(c)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,s,this.input.serialize()];for(let g=0;g<this.labels.length;g++)c.push(this.labels[g],this.outputs[g].serialize());return c}}function ih(u,s,c,g){const y=g-c,T=u-c;return y===0?0:s===1?T/y:(Math.pow(s,T)-1)/(Math.pow(s,y)-1)}class Wc{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expectected at least one argument.");let g=null;const y=c.expectedType;y&&y.kind!=="value"&&(g=y);const T=[];for(const D of s.slice(1)){const W=c.parse(D,1+T.length,g,void 0,{typeAnnotation:"omit"});if(!W)return null;g=g||W.type,T.push(W)}const E=y&&T.some(D=>Bl(y,D.type));return new Wc(E?ns:g,T)}evaluate(s){let c,g=null,y=0;for(const T of this.args){if(y++,g=T.evaluate(s),g&&g instanceof ko&&!g.available&&(c||(c=g),g=null,y===this.args.length))return c;if(g!==null)break}return g}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(c=>{s.push(c.serialize())}),s}}class rh{constructor(s,c){this.type=c.type,this.bindings=[].concat(s),this.result=c}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const c of this.bindings)s(c[1]);s(this.result)}static parse(s,c){if(s.length<4)return c.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const g=[];for(let T=1;T<s.length-1;T+=2){const E=s[T];if(typeof E!="string")return c.error(`Expected string, but found ${typeof E} instead.`,T);if(/[^a-zA-Z0-9_]/.test(E))return c.error("Variable names must contain only alphanumeric characters or '_'.",T);const D=c.parse(s[T+1],T+1);if(!D)return null;g.push([E,D])}const y=c.parse(s[s.length-1],s.length-1,c.expectedType,g);return y?new rh(g,y):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[c,g]of this.bindings)s.push(c,g.serialize());return s.push(this.result.serialize()),s}}class yf{constructor(s,c,g){this.type=s,this.index=c,this.input=g}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const g=c.parse(s[1],1,tn),y=c.parse(s[2],2,Mo(c.expectedType||ns));return g&&y?new yf(y.type.itemType,g,y):null}evaluate(s){const c=this.index.evaluate(s),g=this.input.evaluate(s);if(c<0)throw new to(`Array index out of bounds: ${c} < 0.`);if(c>=g.length)throw new to(`Array index out of bounds: ${c} > ${g.length-1}.`);if(c!==Math.floor(c))throw new to(`Array index must be an integer, but found ${c} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return g[c]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vf{constructor(s,c,g){this.type=s,this.index=c,this.input=g}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const g=c.parse(s[1],1,tn),y=c.parse(s[2],2,Mo(c.expectedType||ns));return g&&y?new vf(y.type.itemType,g,y):null}evaluate(s){const c=this.index.evaluate(s),g=this.input.evaluate(s);if(c<0)throw new to(`Array index out of bounds: ${c} < 0.`);if(c>g.length-1)throw new to(`Array index out of bounds: ${c} > ${g.length-1}.`);if(c===Math.floor(c))return g[c];const y=Math.floor(c),T=Math.ceil(c),E=g[y],D=g[T];if(typeof E!="number"||typeof D!="number")throw new to(`Cannot interpolate between non-number values at index ${c}.`);const W=c-y;return E*(1-W)+D*W}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class nh{constructor(s,c){this.type=Jn,this.needle=s,this.haystack=c}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const g=c.parse(s[1],1,ns),y=c.parse(s[2],2,ns);return g&&y?Na(g.type,[Jn,hs,tn,zl,ns])?new nh(g,y):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${no(g.type)} instead`):null}evaluate(s){const c=this.needle.evaluate(s),g=this.haystack.evaluate(s);if(g==null)return!1;if(!zc(c,["boolean","string","number","null"]))throw new to(`Expected first argument to be of type boolean, string, number or null, but found ${no(Hr(c))} instead.`);if(!zc(g,["string","array"]))throw new to(`Expected second argument to be of type array or string, but found ${no(Hr(g))} instead.`);return g.indexOf(c)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qc{constructor(s,c,g){this.type=tn,this.needle=s,this.haystack=c,this.fromIndex=g}static parse(s,c){if(s.length<=2||s.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const g=c.parse(s[1],1,ns),y=c.parse(s[2],2,ns);if(!g||!y)return null;if(!Na(g.type,[Jn,hs,tn,zl,ns]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${no(g.type)} instead`);if(s.length===4){const T=c.parse(s[3],3,tn);return T?new qc(g,y,T):null}return new qc(g,y)}evaluate(s){const c=this.needle.evaluate(s),g=this.haystack.evaluate(s);if(!zc(c,["boolean","string","number","null"]))throw new to(`Expected first argument to be of type boolean, string, number or null, but found ${no(Hr(c))} instead.`);if(!zc(g,["string","array"]))throw new to(`Expected second argument to be of type array or string, but found ${no(Hr(g))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(s);return g.indexOf(c,y)}return g.indexOf(c)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Kl{constructor(s,c,g,y,T,E){this.inputType=s,this.type=c,this.input=g,this.cases=y,this.outputs=T,this.otherwise=E}static parse(s,c){if(s.length<5)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return c.error("Expected an even number of arguments.");let g,y;c.expectedType&&c.expectedType.kind!=="value"&&(y=c.expectedType);const T={},E=[];for(let X=2;X<s.length-1;X+=2){let ae=s[X];const ce=s[X+1];Array.isArray(ae)||(ae=[ae]);const fe=c.concat(X);if(ae.length===0)return fe.error("Expected at least one branch label.");for(const _t of ae){if(typeof _t!="number"&&typeof _t!="string")return fe.error("Branch labels must be numbers or strings.");if(typeof _t=="number"&&Math.abs(_t)>Number.MAX_SAFE_INTEGER)return fe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof _t=="number"&&Math.floor(_t)!==_t)return fe.error("Numeric branch labels must be integer values.");if(g){if(fe.checkSubtype(g,Hr(_t)))return null}else g=Hr(_t);if(T[String(_t)]!==void 0)return fe.error("Branch labels must be unique.");T[String(_t)]=E.length}const ye=c.parse(ce,X,y);if(!ye)return null;y=y||ye.type,E.push(ye)}const D=c.parse(s[1],1,ns);if(!D)return null;const W=c.parse(s[s.length-1],s.length-1,y);return W?D.type.kind!=="value"&&c.concat(1).checkSubtype(g,D.type)?null:new Kl(g,y,D,T,E,W):null}evaluate(s){const c=this.input.evaluate(s);return(Nu(Hr(c),this.inputType)&&this.outputs[this.cases[c]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),g=[],y={};for(const E of c){const D=y[this.cases[E]];D===void 0?(y[this.cases[E]]=g.length,g.push([this.cases[E],[E]])):g[D][1].push(E)}const T=E=>this.inputType.kind==="number"?Number(E):E;for(const[E,D]of g)s.push(D.length===1?T(D[0]):D.map(T)),s.push(this.outputs[E].serialize());return s.push(this.otherwise.serialize()),s}}class xf{constructor(s,c,g){this.type=s,this.branches=c,this.otherwise=g}static parse(s,c){if(s.length<4)return c.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return c.error("Expected an odd number of arguments.");let g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const y=[];for(let E=1;E<s.length-1;E+=2){const D=c.parse(s[E],E,Jn);if(!D)return null;const W=c.parse(s[E+1],E+1,g);if(!W)return null;y.push([D,W]),g=g||W.type}const T=c.parse(s[s.length-1],s.length-1,g);return T?new xf(g,y,T):null}evaluate(s){for(const[c,g]of this.branches)if(c.evaluate(s))return g.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[c,g]of this.branches)s(c),s(g);s(this.otherwise)}outputDefined(){return this.branches.every(([s,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(c=>{s.push(c.serialize())}),s}}class Xc{constructor(s,c,g,y){this.type=s,this.input=c,this.beginIndex=g,this.endIndex=y}static parse(s,c){if(s.length<=2||s.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const g=c.parse(s[1],1,ns),y=c.parse(s[2],2,tn);if(!g||!y)return null;if(!Na(g.type,[Mo(ns),hs,ns]))return c.error(`Expected first argument to be of type array or string, but found ${no(g.type)} instead`);if(s.length===4){const T=c.parse(s[3],3,tn);return T?new Xc(g.type,g,y,T):null}return new Xc(g.type,g,y)}evaluate(s){const c=this.input.evaluate(s),g=this.beginIndex.evaluate(s);if(!zc(c,["string","array"]))throw new to(`Expected first argument to be of type array or string, but found ${no(Hr(c))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(s);return c.slice(g,y)}return c.slice(g)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jd(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Qd(u,s,c,g){return g.compare(s,c)===0}function wl(u,s,c){const g=u!=="=="&&u!=="!=";return class Mx{constructor(T,E,D){this.type=Jn,this.lhs=T,this.rhs=E,this.collator=D,this.hasUntypedArgument=T.type.kind==="value"||E.type.kind==="value"}static parse(T,E){if(T.length!==3&&T.length!==4)return E.error("Expected two or three arguments.");const D=T[0];let W=E.parse(T[1],1,ns);if(!W)return null;if(!Jd(D,W.type))return E.concat(1).error(`"${D}" comparisons are not supported for type '${no(W.type)}'.`);let X=E.parse(T[2],2,ns);if(!X)return null;if(!Jd(D,X.type))return E.concat(2).error(`"${D}" comparisons are not supported for type '${no(X.type)}'.`);if(W.type.kind!==X.type.kind&&W.type.kind!=="value"&&X.type.kind!=="value")return E.error(`Cannot compare types '${no(W.type)}' and '${no(X.type)}'.`);g&&(W.type.kind==="value"&&X.type.kind!=="value"?W=new fn(X.type,[W]):W.type.kind!=="value"&&X.type.kind==="value"&&(X=new fn(W.type,[X])));let ae=null;if(T.length===4){if(W.type.kind!=="string"&&X.type.kind!=="string"&&W.type.kind!=="value"&&X.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(ae=E.parse(T[3],3,Bu),!ae)return null}return new Mx(W,X,ae)}evaluate(T){const E=this.lhs.evaluate(T),D=this.rhs.evaluate(T);if(g&&this.hasUntypedArgument){const W=Hr(E),X=Hr(D);if(W.kind!==X.kind||W.kind!=="string"&&W.kind!=="number")throw new to(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${W.kind}, ${X.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const W=Hr(E),X=Hr(D);if(W.kind!=="string"||X.kind!=="string")return s(T,E,D)}return this.collator?c(T,E,D,this.collator.evaluate(T)):s(T,E,D)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}serialize(){const T=[u];return this.eachChild(E=>{T.push(E.serialize())}),T}}}const ep=wl("==",function(u,s,c){return s===c},Qd),Xm=wl("!=",function(u,s,c){return s!==c},function(u,s,c,g){return!Qd(0,s,c,g)}),Zm=wl("<",function(u,s,c){return s<c},function(u,s,c,g){return g.compare(s,c)<0}),Ym=wl(">",function(u,s,c){return s>c},function(u,s,c,g){return g.compare(s,c)>0}),sh=wl("<=",function(u,s,c){return s<=c},function(u,s,c,g){return g.compare(s,c)<=0}),Km=wl(">=",function(u,s,c){return s>=c},function(u,s,c,g){return g.compare(s,c)>=0});class oh{constructor(s,c,g,y,T,E){this.type=hs,this.number=s,this.locale=c,this.currency=g,this.unit=y,this.minFractionDigits=T,this.maxFractionDigits=E}static parse(s,c){if(s.length!==3)return c.error("Expected two arguments.");const g=c.parse(s[1],1,tn);if(!g)return null;const y=s[2];if(typeof y!="object"||Array.isArray(y))return c.error("NumberFormat options argument must be an object.");let T=null;if(y.locale&&(T=c.parseObjectValue(y.locale,2,"locale",hs),!T))return null;let E=null;if(y.currency&&(E=c.parseObjectValue(y.currency,2,"currency",hs),!E))return null;let D=null;if(y.unit&&(D=c.parseObjectValue(y.unit,2,"unit",hs),!D))return null;let W=null;if(y["min-fraction-digits"]&&(W=c.parseObjectValue(y["min-fraction-digits"],2,"min-fraction-digits",tn),!W))return null;let X=null;return y["max-fraction-digits"]&&(X=c.parseObjectValue(y["max-fraction-digits"],2,"max-fraction-digits",tn),!X)?null:new oh(g,T,E,D,W,X)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class bf{constructor(s){this.type=tn,this.input=s}static parse(s,c){if(s.length!==2)return c.error(`Expected 1 argument, but found ${s.length-1} instead.`);const g=c.parse(s[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${no(g.type)} instead.`):new bf(g):null}evaluate(s){const c=this.input.evaluate(s);if(typeof c=="string"||Array.isArray(c))return c.length;throw new to(`Expected value to be of type string or array, but found ${no(Hr(c))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(c=>{s.push(c.serialize())}),s}}function tp(u){return function(){u=1831565813+(u|=0)|0;let s=Math.imul(u^u>>>15,1|u);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const Sl={"==":ep,"!=":Xm,">":Ym,"<":Zm,">=":Km,"<=":sh,array:fn,at:yf,"at-interpolated":vf,boolean:fn,case:xf,coalesce:Wc,collator:fa,format:Nl,image:Vl,in:nh,"index-of":qc,interpolate:jo,"interpolate-hcl":jo,"interpolate-lab":jo,length:bf,let:rh,literal:_n,match:Kl,number:fn,"number-format":oh,object:fn,slice:Xc,step:jc,string:fn,"to-boolean":Yo,"to-color":Yo,"to-number":Yo,"to-string":Yo,var:Ku,within:So,distance:vl,config:Yl};function wf(u,[s,c,g,y]){s=s.evaluate(u),c=c.evaluate(u),g=g.evaluate(u);const T=y?y.evaluate(u):1,E=gl(s,c,g,T);if(E)throw new to(E);return new rs(s/255,c/255,g/255,T)}function Sf(u,[s,c,g,y]){s=s.evaluate(u),c=c.evaluate(u),g=g.evaluate(u);const T=y?y.evaluate(u):1,E=function(X,ae,ce,fe){return typeof X=="number"&&X>=0&&X<=360?typeof ae=="number"&&ae>=0&&ae<=100&&typeof ce=="number"&&ce>=0&&ce<=100?fe===void 0||typeof fe=="number"&&fe>=0&&fe<=1?null:`Invalid hsla value [${[X,ae,ce,fe].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof fe=="number"?[X,ae,ce,fe]:[X,ae,ce]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof fe=="number"?[X,ae,ce,fe]:[X,ae,ce]).join(", ")}]: 'h' must be between 0 and 360.`}(s,c,g,T);if(E)throw new to(E);const D=`hsla(${s}, ${c}%, ${g}%, ${T})`,W=rs.parse(D);if(!W)throw new to(`Failed to parse HSLA color: ${D}`);return W}function ip(u,s){return u in s}function Ha(u,s){const c=s[u];return c===void 0?null:c}function Tl(u){return{type:u}}function rp(u){return{result:"success",value:u}}function ja(u){return{result:"error",value:u}}function ah(u,s){return!!u&&!!u.parameters&&u.parameters.indexOf(s)>-1}function Zc(u){return u["property-type"]==="data-driven"}function Tf(u){return ah(u.expression,"measure-light")}function Ef(u){return ah(u.expression,"zoom")}function Yc(u){return!!u.expression&&u.expression.interpolated}function Kc(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function np(u){return u}function sp(u,s){const c=s.type==="color",g=u.stops&&typeof u.stops[0][0]=="object",y=g||!(g||u.property!==void 0),T=u.type||(Yc(s)?"exponential":"interval");if(c&&((u=ml({},u)).stops&&(u.stops=u.stops.map(X=>[X[0],rs.parse(X[1])])),u.default=rs.parse(u.default?u.default:s.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!Kd[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let E,D,W;if(T==="exponential")E=Mf;else if(T==="interval")E=Qm;else if(T==="categorical"){E=Jm,D=Object.create(null);for(const X of u.stops)D[X[0]]=X[1];W=typeof u.stops[0][0]}else{if(T!=="identity")throw new Error(`Unknown function type "${T}"`);E=eg}if(g){const X={},ae=[];for(let ye=0;ye<u.stops.length;ye++){const _t=u.stops[ye],St=_t[0].zoom;X[St]===void 0&&(X[St]={zoom:St,type:u.type,property:u.property,default:u.default,stops:[]},ae.push(St)),X[St].stops.push([_t[0].value,_t[1]])}const ce=[];for(const ye of ae)ce.push([X[ye].zoom,sp(X[ye],s)]);const fe={name:"linear"};return{kind:"composite",interpolationType:fe,interpolationFactor:jo.interpolationFactor.bind(void 0,fe),zoomStops:ce.map(ye=>ye[0]),evaluate:({zoom:ye},_t)=>Mf({stops:ce,base:u.base},s,ye).evaluate(ye,_t)}}if(y){const X=T==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:jo.interpolationFactor.bind(void 0,X),zoomStops:u.stops.map(ae=>ae[0]),evaluate:({zoom:ae})=>E(u,s,ae,D,W)}}return{kind:"source",evaluate(X,ae){const ce=ae&&ae.properties?ae.properties[u.property]:void 0;return ce===void 0?Jo(u.default,s.default):E(u,s,ce,D,W)}}}function Jo(u,s,c){return u!==void 0?u:s!==void 0?s:c!==void 0?c:void 0}function Jm(u,s,c,g,y){return Jo(typeof c===y?g[c]:void 0,u.default,s.default)}function Qm(u,s,c){if(Va(c)!=="number")return Jo(u.default,s.default);const g=u.stops.length;if(g===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[g-1][0])return u.stops[g-1][1];const y=Qu(u.stops.map(T=>T[0]),c);return u.stops[y][1]}function Mf(u,s,c){const g=u.base!==void 0?u.base:1;if(Va(c)!=="number")return Jo(u.default,s.default);const y=u.stops.length;if(y===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[y-1][0])return u.stops[y-1][1];const T=Qu(u.stops.map(ae=>ae[0]),c),E=function(ae,ce,fe,ye){const _t=ye-fe,St=ae-fe;return _t===0?0:ce===1?St/_t:(Math.pow(ce,St)-1)/(Math.pow(ce,_t)-1)}(c,g,u.stops[T][0],u.stops[T+1][0]),D=u.stops[T][1],W=u.stops[T+1][1];let X=Dc[s.type]||np;if(u.colorSpace&&u.colorSpace!=="rgb"){const ae=Kd[u.colorSpace];X=(ce,fe)=>ae.reverse(ae.interpolate(ae.forward(ce),ae.forward(fe),E))}return typeof D.evaluate=="function"?{evaluate(...ae){const ce=D.evaluate.apply(void 0,ae),fe=W.evaluate.apply(void 0,ae);if(ce!==void 0&&fe!==void 0)return X(ce,fe,E)}}:X(D,W,E)}function eg(u,s,c){return s.type==="color"?c=rs.parse(c):s.type==="formatted"?c=Ao.fromString(c.toString()):s.type==="resolvedImage"?c=ko.build(c.toString()):Va(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Jo(c,u.default,s.default)}ho.register(Sl,{error:[{kind:"error"},[hs],(u,[s])=>{throw new to(s.evaluate(u))}],typeof:[hs,[ns],(u,[s])=>no(Hr(s.evaluate(u)))],"to-rgba":[Mo(tn,4),[zo],(u,[s])=>s.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Mo(tn,4),[zo],(u,[s])=>s.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[zo,[tn,tn,tn],wf],rgba:[zo,[tn,tn,tn,tn],wf],hsl:[zo,[tn,tn,tn],Sf],hsla:[zo,[tn,tn,tn,tn],Sf],has:{type:Jn,overloads:[[[hs],(u,[s])=>ip(s.evaluate(u),u.properties())],[[hs,wa],(u,[s,c])=>ip(s.evaluate(u),c.evaluate(u))]]},get:{type:ns,overloads:[[[hs],(u,[s])=>Ha(s.evaluate(u),u.properties())],[[hs,wa],(u,[s,c])=>Ha(s.evaluate(u),c.evaluate(u))]]},"feature-state":[ns,[hs],(u,[s])=>Ha(s.evaluate(u),u.featureState||{})],properties:[wa,[],u=>u.properties()],"geometry-type":[hs,[],u=>u.geometryType()],worldview:[hs,[],u=>u.globals.worldview||""],id:[ns,[],u=>u.id()],zoom:[tn,[],u=>u.globals.zoom],pitch:[tn,[],u=>u.globals.pitch||0],"distance-from-center":[tn,[],u=>u.distanceFromCenter()],"measure-light":[tn,[hs],(u,[s])=>u.measureLight(s.evaluate(u))],"heatmap-density":[tn,[],u=>u.globals.heatmapDensity||0],"line-progress":[tn,[],u=>u.globals.lineProgress||0],"raster-value":[tn,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[tn,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[tn,[],u=>u.globals.skyRadialProgress||0],accumulated:[ns,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[tn,Tl(tn),(u,s)=>{let c=0;for(const g of s)c+=g.evaluate(u);return c}],"*":[tn,Tl(tn),(u,s)=>{let c=1;for(const g of s)c*=g.evaluate(u);return c}],"-":{type:tn,overloads:[[[tn,tn],(u,[s,c])=>s.evaluate(u)-c.evaluate(u)],[[tn],(u,[s])=>-s.evaluate(u)]]},"/":[tn,[tn,tn],(u,[s,c])=>s.evaluate(u)/c.evaluate(u)],"%":[tn,[tn,tn],(u,[s,c])=>s.evaluate(u)%c.evaluate(u)],ln2:[tn,[],()=>Math.LN2],pi:[tn,[],()=>Math.PI],e:[tn,[],()=>Math.E],"^":[tn,[tn,tn],(u,[s,c])=>Math.pow(s.evaluate(u),c.evaluate(u))],sqrt:[tn,[tn],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[tn,[tn],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[tn,[tn],(u,[s])=>Math.log(s.evaluate(u))],log2:[tn,[tn],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[tn,[tn],(u,[s])=>Math.sin(s.evaluate(u))],cos:[tn,[tn],(u,[s])=>Math.cos(s.evaluate(u))],tan:[tn,[tn],(u,[s])=>Math.tan(s.evaluate(u))],asin:[tn,[tn],(u,[s])=>Math.asin(s.evaluate(u))],acos:[tn,[tn],(u,[s])=>Math.acos(s.evaluate(u))],atan:[tn,[tn],(u,[s])=>Math.atan(s.evaluate(u))],min:[tn,Tl(tn),(u,s)=>Math.min(...s.map(c=>c.evaluate(u)))],max:[tn,Tl(tn),(u,s)=>Math.max(...s.map(c=>c.evaluate(u)))],abs:[tn,[tn],(u,[s])=>Math.abs(s.evaluate(u))],round:[tn,[tn],(u,[s])=>{const c=s.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[tn,[tn],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[tn,[tn],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[Jn,[hs,ns],(u,[s,c])=>u.properties()[s.value]===c.value],"filter-id-==":[Jn,[ns],(u,[s])=>u.id()===s.value],"filter-type-==":[Jn,[hs],(u,[s])=>u.geometryType()===s.value],"filter-<":[Jn,[hs,ns],(u,[s,c])=>{const g=u.properties()[s.value],y=c.value;return typeof g==typeof y&&g<y}],"filter-id-<":[Jn,[ns],(u,[s])=>{const c=u.id(),g=s.value;return typeof c==typeof g&&c<g}],"filter->":[Jn,[hs,ns],(u,[s,c])=>{const g=u.properties()[s.value],y=c.value;return typeof g==typeof y&&g>y}],"filter-id->":[Jn,[ns],(u,[s])=>{const c=u.id(),g=s.value;return typeof c==typeof g&&c>g}],"filter-<=":[Jn,[hs,ns],(u,[s,c])=>{const g=u.properties()[s.value],y=c.value;return typeof g==typeof y&&g<=y}],"filter-id-<=":[Jn,[ns],(u,[s])=>{const c=u.id(),g=s.value;return typeof c==typeof g&&c<=g}],"filter->=":[Jn,[hs,ns],(u,[s,c])=>{const g=u.properties()[s.value],y=c.value;return typeof g==typeof y&&g>=y}],"filter-id->=":[Jn,[ns],(u,[s])=>{const c=u.id(),g=s.value;return typeof c==typeof g&&c>=g}],"filter-has":[Jn,[ns],(u,[s])=>s.value in u.properties()],"filter-has-id":[Jn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Jn,[Mo(hs)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[Jn,[Mo(ns)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[Jn,[hs,Mo(ns)],(u,[s,c])=>c.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[Jn,[hs,Mo(ns)],(u,[s,c])=>function(g,y,T,E){for(;T<=E;){const D=T+E>>1;if(y[D]===g)return!0;y[D]>g?E=D-1:T=D+1}return!1}(u.properties()[s.value],c.value,0,c.value.length-1)],all:{type:Jn,overloads:[[[Jn,Jn],(u,[s,c])=>s.evaluate(u)&&c.evaluate(u)],[Tl(Jn),(u,s)=>{for(const c of s)if(!c.evaluate(u))return!1;return!0}]]},any:{type:Jn,overloads:[[[Jn,Jn],(u,[s,c])=>s.evaluate(u)||c.evaluate(u)],[Tl(Jn),(u,s)=>{for(const c of s)if(c.evaluate(u))return!0;return!1}]]},"!":[Jn,[Jn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[Jn,[hs],(u,[s])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(s.evaluate(u))}],upcase:[hs,[hs],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[hs,[hs],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[hs,Tl(ns),(u,s)=>s.map(c=>Zo(c.evaluate(u))).join("")],"resolved-locale":[hs,[Bu],(u,[s])=>s.evaluate(u).resolvedLocale()],random:[tn,[tn,tn,ns],(u,s)=>{const[c,g,y]=s.map(E=>E.evaluate(u));if(c>g||c===g)return c;let T;if(typeof y=="string")T=function(E){let D=0;if(E.length===0)return D;for(let W=0;W<E.length;W++)D=(D<<5)-D+E.charCodeAt(W),D|=0;return D}(y);else{if(typeof y!="number")throw new to(`Invalid seed input: ${y}`);T=y}return c+tp(T)()*(g-c)}]});class Jl{constructor(s,c,g,y){this.expression=s,this._warningHistory={},this._evaluator=new Vc(g,y),this._defaultValue=c?function(T){return T.type==="color"&&(Kc(T.default)||Array.isArray(T.default))?new rs(0,0,0,0):T.type==="color"?rs.parse(T.default)||null:T.default===void 0?null:T.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=Yu(s)}evaluateWithoutErrorHandling(s,c,g,y,T,E,D,W){return this._evaluator.globals=s,this._evaluator.feature=c,this._evaluator.featureState=g,this._evaluator.canonical=y||null,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=E,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=W||null,this.expression.evaluate(this._evaluator)}evaluate(s,c,g,y,T,E,D,W){this._evaluator.globals=s,this._evaluator.feature=c||null,this._evaluator.featureState=g||null,this._evaluator.canonical=y||null,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=E||null,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=W||null;try{const X=this.expression.evaluate(this._evaluator);if(X==null||typeof X=="number"&&X!=X)return this._defaultValue;if(this._enumValues&&!(X in this._enumValues))throw new to(`Expected value to be one of ${Object.keys(this._enumValues).map(ae=>JSON.stringify(ae)).join(", ")}, but found ${JSON.stringify(X)} instead.`);return X}catch(X){return this._warningHistory[X.message]||(this._warningHistory[X.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${X.message}`)),this._defaultValue}}}function lh(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Sl}function Ea(u,s,c,g){const y=new Ju(Sl,[],s?function(E){const D={color:zo,string:hs,number:tn,enum:hs,boolean:Jn,formatted:Fc,resolvedImage:Oc};return E.type==="array"?Mo(D[E.value]||ns,E.length):D[E.type]}(s):void 0,void 0,void 0,c,g),T=y.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?rp(new Jl(T,s,c,g)):ja(y.errors)}class Jc{constructor(s,c,g,y){this.kind=s,this._styleExpression=c,this.isLightConstant=g,this.isLineProgressConstant=y,this.isStateDependent=s!=="constant"&&!Zu(c.expression),this.configDependencies=Yu(c.expression)}evaluateWithoutErrorHandling(s,c,g,y,T,E){return this._styleExpression.evaluateWithoutErrorHandling(s,c,g,y,T,E)}evaluate(s,c,g,y,T,E){return this._styleExpression.evaluate(s,c,g,y,T,E)}}class Qc{constructor(s,c,g,y,T,E){this.kind=s,this.zoomStops=g,this._styleExpression=c,this.isStateDependent=s!=="camera"&&!Zu(c.expression),this.isLightConstant=T,this.isLineProgressConstant=E,this.configDependencies=Yu(c.expression),this.interpolationType=y}evaluateWithoutErrorHandling(s,c,g,y,T,E){return this._styleExpression.evaluateWithoutErrorHandling(s,c,g,y,T,E)}evaluate(s,c,g,y,T,E){return this._styleExpression.evaluate(s,c,g,y,T,E)}interpolationFactor(s,c,g){return this.interpolationType?jo.interpolationFactor(this.interpolationType,s,c,g):0}}function op(u,s,c,g){if((u=Ea(u,s,c,g)).result==="error")return u;const y=u.value.expression,T=Xl(y);if(!T&&!Zc(s))return ja([new Go("","data expressions not supported")]);const E=Zl(y,["zoom","pitch","distance-from-center"]);if(!E&&!Ef(s))return ja([new Go("","zoom expressions not supported")]);const D=Zl(y,["measure-light"]);if(!D&&!Tf(s))return ja([new Go("","measure-light expression not supported")]);const W=Zl(y,["line-progress"]);if(!W&&!function(ce){return ah(ce.expression,"line-progress")}(s))return ja([new Go("","line-progress expression not supported")]);const X=s.expression&&s.expression.relaxZoomRestriction,ae=ec(y);return ae||E||X?ae instanceof Go?ja([ae]):ae instanceof jo&&!Yc(s)?ja([new Go("",'"interpolate" expressions cannot be used with this property')]):rp(ae?new Qc(T&&W?"camera":"composite",u.value,ae.labels,ae instanceof jo?ae.interpolation:void 0,D,W):new Jc(T&&W?"constant":"source",u.value,D,W)):ja([new Go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ql{constructor(s,c){this._parameters=s,this._specification=c,ml(this,sp(this._parameters,this._specification))}static deserialize(s){return new Ql(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function ec(u){let s=null;if(u instanceof rh)s=ec(u.result);else if(u instanceof Wc){for(const c of u.args)if(s=ec(c),s)break}else(u instanceof jc||u instanceof jo)&&u.input instanceof ho&&u.input.name==="zoom"&&(s=u);return s instanceof Go||u.eachChild(c=>{const g=ec(c);g instanceof Go?s=g:s&&g&&s!==g&&(s=new Go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var ch,Af,Cf=function(){if(Af)return ch;Af=1,ch=s;var u=3;function s(c,g,y){var T=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var E=new Int32Array(this.arrayBuffer);c=E[0],this.d=(g=E[1])+2*(y=E[2]);for(var D=0;D<this.d*this.d;D++){var W=E[u+D],X=E[u+D+1];T.push(W===X?null:E.subarray(W,X))}var ae=E[u+T.length+1];this.keys=E.subarray(E[u+T.length],ae),this.bboxes=E.subarray(ae),this.insert=this._insertReadonly}else{this.d=g+2*y;for(var ce=0;ce<this.d*this.d;ce++)T.push([]);this.keys=[],this.bboxes=[]}this.n=g,this.extent=c,this.padding=y,this.scale=g/c,this.uid=0;var fe=y/g*c;this.min=-fe,this.max=c+fe}return s.prototype.insert=function(c,g,y,T,E){this._forEachCell(g,y,T,E,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(g),this.bboxes.push(y),this.bboxes.push(T),this.bboxes.push(E)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(c,g,y,T,E,D){this.cells[E].push(D)},s.prototype.query=function(c,g,y,T,E){var D=this.min,W=this.max;if(c<=D&&g<=D&&W<=y&&W<=T&&!E)return Array.prototype.slice.call(this.keys);var X=[];return this._forEachCell(c,g,y,T,this._queryCell,X,{},E),X},s.prototype._queryCell=function(c,g,y,T,E,D,W,X){var ae=this.cells[E];if(ae!==null)for(var ce=this.keys,fe=this.bboxes,ye=0;ye<ae.length;ye++){var _t=ae[ye];if(W[_t]===void 0){var St=4*_t;(X?X(fe[St+0],fe[St+1],fe[St+2],fe[St+3]):c<=fe[St+2]&&g<=fe[St+3]&&y>=fe[St+0]&&T>=fe[St+1])?(W[_t]=!0,D.push(ce[_t])):W[_t]=!1}}},s.prototype._forEachCell=function(c,g,y,T,E,D,W,X){for(var ae=this._convertToCellCoord(c),ce=this._convertToCellCoord(g),fe=this._convertToCellCoord(y),ye=this._convertToCellCoord(T),_t=ae;_t<=fe;_t++)for(var St=ce;St<=ye;St++){var Pt=this.d*St+_t;if((!X||X(this._convertFromCellCoord(_t),this._convertFromCellCoord(St),this._convertFromCellCoord(_t+1),this._convertFromCellCoord(St+1)))&&E.call(this,c,g,y,T,Pt,D,W,X))return}},s.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},s.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,g=u+this.cells.length+1+1,y=0,T=0;T<this.cells.length;T++)y+=this.cells[T].length;var E=new Int32Array(g+y+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;for(var D=g,W=0;W<c.length;W++){var X=c[W];E[u+W]=D,E.set(X,D),D+=X.length}return E[u+c.length]=D,E.set(this.keys,D),E[u+c.length+1]=D+=this.keys.length,E.set(this.bboxes,D),D+=this.bboxes.length,E.buffer},ch}(),Ma=Sn(Cf);const Aa={};function jr(u,s,c={}){Object.defineProperty(u,"_classRegistryKey",{value:s,writable:!1}),Aa[s]={klass:u,omit:c.omit||[]}}jr(Object,"Object"),Ma.serialize=function(u,s){const c=u.toArrayBuffer();return s&&s.add(c),{buffer:c}},Ma.deserialize=function(u){return new Ma(u.buffer)},Object.defineProperty(Ma,"name",{value:"Grid"}),jr(Ma,"Grid"),typeof DOMMatrix<"u"&&jr(DOMMatrix,"DOMMatrix"),jr(rs,"Color"),jr(Error,"Error"),jr(Ao,"Formatted"),jr(Vu,"FormattedSection"),jr(Xn,"AJAXError"),jr(ko,"ResolvedImage"),jr(Ql,"StylePropertyFunction"),jr(Jl,"StyleExpression",{omit:["_evaluator"]}),jr(Oo,"ImageId"),jr(Sa,"ImageVariant"),jr(Qc,"ZoomDependentExpression"),jr(Jc,"ZoomConstantExpression"),jr(ho,"CompoundExpression",{omit:["_evaluate"]});for(const u in Sl)Aa[Sl[u]._classRegistryKey]||jr(Sl[u],`Expression${u}`);function ap(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function lp(u){return self.ImageBitmap&&u instanceof ImageBitmap}function Wa(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(ap(u)||lp(u))return s&&s.add(u),u;if(ArrayBuffer.isView(u))return s&&s.add(u.buffer),u;if(u instanceof ImageData)return s&&s.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const g of u)c.push(Wa(g,s));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[g,y]of u.entries())c.entries.push(Wa(g),Wa(y,s));return c}if(u instanceof Set){const c={$name:"Set"};let g=0;for(const y of u.values())c[++g]=Wa(y);return c}if(u instanceof DOMMatrix){const c={$name:"DOMMatrix"},g=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const y of g)c[y]=u[y];return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,g=c._classRegistryKey;if(!g)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const y=c.serialize?c.serialize(u,s):{};if(!c.serialize){for(const T in u)u.hasOwnProperty(T)&&(Aa[g].omit.indexOf(T)>=0||(y[T]=Wa(u[T],s)));u instanceof Error&&(y.message=u.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(y.$name=g),y}throw new Error("can't serialize object of type "+typeof u)}function qa(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||ap(u)||lp(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(qa);if(typeof u=="object"){const s=u.$name||"Object";if(s==="Map"){const y=u.entries||[],T=new Map;for(let E=0;E<y.length;E+=2)T.set(qa(y[E]),qa(y[E+1]));return T}if(s==="Set"){const y=new Set;for(const T of Object.keys(u))T!=="$name"&&y.add(qa(u[T]));return y}if(s==="DOMMatrix"){let y;return y=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(y)}if(s==="BigInt")return BigInt(u.value);const{klass:c}=Aa[s];if(!c)throw new Error(`Can't deserialize unregistered class "${s}".`);if(c.deserialize)return c.deserialize(u);const g=Object.create(c.prototype);for(const y of Object.keys(u))y!=="$name"&&(g[y]=qa(u[y]));return g}throw new Error("can't deserialize object of type "+typeof u)}const cn={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function eu(u){for(const s of u)if(Pf(s.charCodeAt(0)))return!0;return!1}function tg(u){for(const s of u)if(!ig(s.charCodeAt(0)))return!1;return!0}function ig(u){return!(cn.Arabic(u)||cn["Arabic Supplement"](u)||cn["Arabic Extended-A"](u)||cn["Arabic Presentation Forms-A"](u)||cn["Arabic Presentation Forms-B"](u))}function Pf(u){return!(u!==746&&u!==747&&(u<4352||!(cn["Bopomofo Extended"](u)||cn.Bopomofo(u)||cn["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||cn["CJK Compatibility Ideographs"](u)||cn["CJK Compatibility"](u)||cn["CJK Radicals Supplement"](u)||cn["CJK Strokes"](u)||!(!cn["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||cn["CJK Unified Ideographs Extension A"](u)||cn["CJK Unified Ideographs"](u)||cn["Enclosed CJK Letters and Months"](u)||cn["Hangul Compatibility Jamo"](u)||cn["Hangul Jamo Extended-A"](u)||cn["Hangul Jamo Extended-B"](u)||cn["Hangul Jamo"](u)||cn["Hangul Syllables"](u)||cn.Hiragana(u)||cn["Ideographic Description Characters"](u)||cn.Kanbun(u)||cn["Kangxi Radicals"](u)||cn["Katakana Phonetic Extensions"](u)||cn.Katakana(u)&&u!==12540||!(!cn["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!cn["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||cn["Unified Canadian Aboriginal Syllabics"](u)||cn["Unified Canadian Aboriginal Syllabics Extended"](u)||cn["Vertical Forms"](u)||cn["Yijing Hexagram Symbols"](u)||cn["Yi Syllables"](u)||cn["Yi Radicals"](u))))}function cp(u){return!(Pf(u)||function(s){return!!(cn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||cn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||cn["Letterlike Symbols"](s)||cn["Number Forms"](s)||cn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||cn["Control Pictures"](s)&&s!==9251||cn["Optical Character Recognition"](s)||cn["Enclosed Alphanumerics"](s)||cn["Geometric Shapes"](s)||cn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||cn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||cn["CJK Symbols and Punctuation"](s)||cn.Katakana(s)||cn["Private Use Area"](s)||cn["CJK Compatibility Forms"](s)||cn["Small Form Variants"](s)||cn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function rg(u){return cn.Arabic(u)||cn["Arabic Supplement"](u)||cn["Arabic Extended-A"](u)||cn["Arabic Presentation Forms-A"](u)||cn["Arabic Presentation Forms-B"](u)}function up(u){return u>=1424&&u<=2303||cn["Arabic Presentation Forms-A"](u)||cn["Arabic Presentation Forms-B"](u)}function ng(u,s){return!(!s&&up(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||cn.Khmer(u))}function sg(u){for(const s of u)if(up(s.charCodeAt(0)))return!0;return!1}const Bo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let If=null,Po=Bo.unavailable,Ca=null;const El=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(Po=Bo.error),If&&If(u)};function uh(){hh.fire(new fl("pluginStateChange",{pluginStatus:Po,pluginURL:Ca}))}const hh=new dl,tc=function(){return Po},hp=function(){if(Po!==Bo.deferred||!Ca)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Po=Bo.loading,uh(),Ca&&Rc({url:Ca},u=>{u?El(u):(Po=Bo.loaded,uh())})},Pa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Po===Bo.loaded||Pa.applyArabicShaping!=null,isLoading:()=>Po===Bo.loading,setState(u){Po=u.pluginStatus,Ca=u.pluginURL},isParsing:()=>Po===Bo.parsing,isParsed:()=>Po===Bo.parsed,getPluginURL:()=>Ca};class ps{constructor(s,c){this.zoom=s,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness,this.worldview=c.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(c,g){for(const y of c)if(!ng(y.charCodeAt(0),g))return!1;return!0}(s,Pa.isLoaded())}}class tu{constructor(s,c,g,y){this.property=s,this.value=c,this.expression=function(T,E,D,W){if(Kc(T))return new Ql(T,E);if(lh(T)||Array.isArray(T)&&T.length>0){const X=op(T,E,D,W);if(X.result==="error")throw new Error(X.value.map(ae=>`${ae.key}: ${ae.message}`).join(", "));return X.value}{let X=T;return typeof T=="string"&&E.type==="color"&&(X=rs.parse(T)),{kind:"constant",configDependencies:new Set,evaluate:()=>X}}}(c===void 0?s.specification.default:c,s.specification,g,y)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,c,g){return this.property.possiblyEvaluate(this,s,c,g)}}class Xa{constructor(s,c,g){this.property=s,this.value=new tu(s,void 0,c,g)}transitioned(s,c){return new dp(this.property,this.value,c,Oi({},s.transition,this.transition),s.now)}untransitioned(){return new dp(this.property,this.value,null,{},0)}}class fp{constructor(s,c,g){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=c,this._options=g,this.configDependencies=new Set}getValue(s){return rn(this._values[s].value.value)}setValue(s,c){this._values.hasOwnProperty(s)||(this._values[s]=new Xa(this._values[s].property,this._scope,this._options)),this._values[s].value=new tu(this._values[s].property,c===null?void 0:rn(c),this._scope,this._options),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]))}setTransitionOrValue(s,c){c&&(this._options=c);const g=this._properties.properties;if(s)for(const y in s){const T=s[y];if(y.endsWith("-transition")){const E=y.slice(0,-11);g[E]&&this.setTransition(E,T)}else g.hasOwnProperty(y)&&this.setValue(y,T)}}getTransition(s){return rn(this._values[s].transition)}setTransition(s,c){this._values.hasOwnProperty(s)||(this._values[s]=new Xa(this._values[s].property)),this._values[s].transition=rn(c)||void 0}serialize(){const s={};for(const c of Object.keys(this._values)){const g=this.getValue(c);g!==void 0&&(s[c]=g);const y=this.getTransition(c);y!==void 0&&(s[`${c}-transition`]=y)}return s}transitioned(s,c){const g=new pp(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].transitioned(s,c._values[y]);return g}untransitioned(){const s=new pp(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].untransitioned();return s}}class dp{constructor(s,c,g,y,T){const E=y.delay||0,D=y.duration||0;T=T||0,this.property=s,this.value=c,this.begin=T+E,this.end=this.begin+D,s.specification.transition&&(y.delay||y.duration)&&(this.prior=g)}possiblyEvaluate(s,c,g){const y=s.now||0,T=this.value.possiblyEvaluate(s,c,g),E=this.prior;if(E){if(y>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(y<this.begin)return E.possiblyEvaluate(s,c,g);{const D=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(s,c,g),T,Ft(D))}}return T}}class pp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,c,g){const y=new Ml(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(s,c,g);return y}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class og{constructor(s,c,g){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=c,this._options=g,this.configDependencies=new Set}getValue(s){return rn(this._values[s].value)}setValue(s,c){this._values[s]=new tu(this._values[s].property,c===null?void 0:rn(c),this._scope,this._options),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]))}serialize(){const s={};for(const c of Object.keys(this._values)){const g=this.getValue(c);g!==void 0&&(s[c]=g)}return s}possiblyEvaluate(s,c,g){const y=new Ml(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(s,c,g);return y}}class ic{constructor(s,c,g){this.property=s,this.value=c,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,c,g,y){return this.property.evaluate(this.value,this.parameters,s,c,g,y)}}class Ml{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class Mr{constructor(s){this.specification=s}possiblyEvaluate(s,c){return s.expression.evaluate(c)}interpolate(s,c,g){const y=Dc[this.specification.type];return y?y(s,c,g):s}}class $r{constructor(s,c){this.specification=s,this.overrides=c}possiblyEvaluate(s,c,g,y){return new ic(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(c,null,{},g,y)}:s.expression,c)}interpolate(s,c,g){if(s.value.kind!=="constant"||c.value.kind!=="constant")return s;if(s.value.value===void 0||c.value.value===void 0)return new ic(this,{kind:"constant",value:void 0},s.parameters);const y=Dc[this.specification.type];return y?new ic(this,{kind:"constant",value:y(s.value.value,c.value.value,g)},s.parameters):s}evaluate(s,c,g,y,T,E){return s.kind==="constant"?s.value:s.evaluate(c,g,y,T,E)}}class Al{constructor(s){this.specification=s}possiblyEvaluate(s,c,g,y){return!!s.expression.evaluate(c,null,{},g,y)}interpolate(){return!1}}class Us{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new ps(0,{});for(const g in s){const y=s[g];y.specification.overridable&&this.overridableProperties.push(g);const T=this.defaultPropertyValues[g]=new tu(y,void 0),E=this.defaultTransitionablePropertyValues[g]=new Xa(y);this.defaultTransitioningPropertyValues[g]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[g]=T.possiblyEvaluate(c)}}}jr($r,"DataDrivenProperty"),jr(Mr,"DataConstantProperty"),jr(Al,"ColorRampProperty");var Gi=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function oa(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function fh(u){if(Array.isArray(u))return u.map(fh);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const c in u)s[c]=fh(u[c]);return s}return oa(u)}function dh(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!dh(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function Rf(u,s="",c=null,g="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};dh(u)||(u=ph(u));const y=u;let T=!0;try{T=function(ae){if(!rc(ae))return ae;let ce=fh(ae);return gp(ce),ce=mp(ce),ce}(y)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(y,null,2)}
        `)}let E=null,D=null;if(g!=="background"&&g!=="sky"&&g!=="slot"){D=Gi[`filter_${g}`];const ae=Ea(T,D,s,c);if(ae.result==="error")throw new Error(ae.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));E=(ce,fe,ye)=>ae.value.evaluate(ce,fe,{},ye)}let W=null,X=null;if(T!==y){const ae=Ea(y,D,s,c);if(ae.result==="error")throw new Error(ae.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));W=(ce,fe,ye,_t,St)=>ae.value.evaluate(ce,fe,{},ye,void 0,void 0,_t,St),X=!Xl(ae.value.expression)}return{filter:E,dynamicFilter:W||void 0,needGeometry:_p(T),needFeature:!!X}}function mp(u){if(!Array.isArray(u))return u;const s=function(c){if(ag.has(c[0])){for(let g=1;g<c.length;g++)if(rc(c[g]))return!0}return c}(u);return s===!0?s:s.map(c=>mp(c))}function gp(u){let s=!1;const c=[];if(u[0]==="case"){for(let g=1;g<u.length-1;g+=2)s=s||rc(u[g]),c.push(u[g+1]);c.push(u[u.length-1])}else if(u[0]==="match"){s=s||rc(u[1]);for(let g=2;g<u.length-1;g+=2)c.push(u[g+1]);c.push(u[u.length-1])}else if(u[0]==="step"){s=s||rc(u[1]);for(let g=1;g<u.length-1;g+=2)c.push(u[g+1])}s&&(u.length=0,u.push("any",...c));for(let g=1;g<u.length;g++)gp(u[g])}function rc(u){if(!Array.isArray(u))return!1;if((s=u[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let c=1;c<u.length;c++)if(rc(u[c]))return!0;return!1}const ag=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function lg(u,s){return u<s?-1:u>s?1:0}function _p(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let s=1;s<u.length;s++)if(_p(u[s]))return!0;return!1}function ph(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?Lf(u[1],u[2],"=="):s==="!="?mh(Lf(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Lf(u[1],u[2],s):s==="any"?(c=u.slice(1),["any"].concat(c.map(ph))):s==="all"?["all"].concat(u.slice(1).map(ph)):s==="none"?["all"].concat(u.slice(1).map(ph).map(mh)):s==="in"?kf(u[1],u.slice(2)):s==="!in"?mh(kf(u[1],u.slice(2))):s==="has"?yp(u[1]):s!=="!has"||mh(yp(u[1]));var c}function Lf(u,s,c){switch(u){case"$type":return[`filter-type-${c}`,s];case"$id":return[`filter-id-${c}`,s];default:return[`filter-${c}`,u,s]}}function kf(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(c=>typeof c!=typeof s[0])?["filter-in-large",u,["literal",s.sort(lg)]]:["filter-in-small",u,["literal",s]]}}function yp(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function mh(u){return["!",u]}const iu="";function Cl(u,s){return s?`${u}${iu}${s}`:u}const Df="-transition",Za=new Set(["fill","line","background","hillshade","raster"]);class To extends dl{constructor(s,c,g,y,T){if(super(),this.id=s.id,this.fqid=Cl(this.id,g),this.type=s.type,this.scope=g,this.lut=y,this.options=T,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const E=Ea(this.filter,Gi[`filter_${s.type}`]);E.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...E.value.configDependencies]))}if(s.slot&&(this.slot=s.slot),c.layout&&(this._unevaluatedLayout=new og(c.layout,this.scope,T),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),c.paint){this._transitionablePaint=new fp(c.paint,this.scope,T);for(const E in s.paint)this.setPaintProperty(E,s.paint[E]);for(const E in s.layout)this.setLayoutProperty(E,s.layout[E]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ml(c.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&Za.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,c){if(this.type==="custom"&&s==="visibility")return void(this.visibility=c);const g=this._unevaluatedLayout;g._properties.properties[s]&&(g.setValue(s,c),this.configDependencies=new Set([...this.configDependencies,...g.configDependencies]),s==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(Df)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,c){const g=this._transitionablePaint,y=g._properties.properties;if(s.endsWith(Df)){const ce=s.slice(0,-11);return y[ce]&&g.setTransition(ce,c||void 0),!1}if(!y[s])return!1;const T=g._values[s],E=T.value.isDataDriven(),D=T.value;g.setValue(s,c),this.configDependencies=new Set([...this.configDependencies,...g.configDependencies]),this._handleSpecialPaintPropertyUpdate(s);const W=g._values[s].value,X=W.isDataDriven(),ae=s.endsWith("pattern")||s==="line-dasharray";return X||E||ae||this._handleOverridablePaintPropertyUpdate(s,D,W)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,c,g){return null}_handleOverridablePaintPropertyUpdate(s,c,g){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,c)}serialize(){return Gr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const s in this.paint._values){const c=this.paint.get(s);if(c instanceof ic&&Zc(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=Rf(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(s){}queryIntersectsFeature(s,c,g,y,T,E,D,W,X){}}const cg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ru{constructor(s,c){this._structArray=s,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ks{constructor(){this.capacity=-1,this.resize(0)}static serialize(s,c){return s._trim(),c&&c.add(s.arrayBuffer),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const c=Object.create(this.prototype);return c.arrayBuffer=s.arrayBuffer,c.length=s.length,c.capacity=s.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Zn(u,s=1){let c=0,g=0;return{members:u.map(y=>{const T=cg[y.type].BYTES_PER_ELEMENT,E=c=Ff(c,Math.max(s,T)),D=y.components||1;return g=Math.max(g,T),c+=T*D,{name:y.name,type:y.type,components:D,offset:E}}),size:Ff(c,Math.max(g,s)),alignment:s}}function Ff(u,s){return Math.ceil(u/s)*s}class Ia extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c){const g=this.length;return this.resize(g+1),this.emplace(g,s,c)}emplace(s,c,g){const y=2*s;return this.int16[y+0]=c,this.int16[y+1]=g,s}}Ia.prototype.bytesPerElement=4,jr(Ia,"StructArrayLayout2i4");class nu extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g){const y=this.length;return this.resize(y+1),this.emplace(y,s,c,g)}emplace(s,c,g,y){const T=3*s;return this.int16[T+0]=c,this.int16[T+1]=g,this.int16[T+2]=y,s}}nu.prototype.bytesPerElement=6,jr(nu,"StructArrayLayout3i6");class nc extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,g,y)}emplace(s,c,g,y,T){const E=4*s;return this.int16[E+0]=c,this.int16[E+1]=g,this.int16[E+2]=y,this.int16[E+3]=T,s}}nc.prototype.bytesPerElement=8,jr(nc,"StructArrayLayout4i8");class Ya extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.float32[1*s+0]=c,s}}Ya.prototype.bytesPerElement=4,jr(Ya,"StructArrayLayout1f4");class Of extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g){const y=this.length;return this.resize(y+1),this.emplace(y,s,c,g)}emplace(s,c,g,y){const T=4*s,E=2*s;return this.int16[T+0]=c,this.int16[T+1]=g,this.float32[E+1]=y,s}}Of.prototype.bytesPerElement=8,jr(Of,"StructArrayLayout2i1f8");class gh extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g){const y=this.length;return this.resize(y+1),this.emplace(y,s,c,g)}emplace(s,c,g,y){const T=4*s;return this.int16[T+0]=c,this.int16[T+1]=g,this.int16[T+2]=y,s}}gh.prototype.bytesPerElement=8,jr(gh,"StructArrayLayout3i8");class sc extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,g,y,T)}emplace(s,c,g,y,T,E){const D=5*s;return this.int16[D+0]=c,this.int16[D+1]=g,this.int16[D+2]=y,this.int16[D+3]=T,this.int16[D+4]=E,s}}sc.prototype.bytesPerElement=10,jr(sc,"StructArrayLayout5i10");class zf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D){const W=this.length;return this.resize(W+1),this.emplace(W,s,c,g,y,T,E,D)}emplace(s,c,g,y,T,E,D,W){const X=6*s,ae=12*s,ce=3*s;return this.int16[X+0]=c,this.int16[X+1]=g,this.uint8[ae+4]=y,this.uint8[ae+5]=T,this.uint8[ae+6]=E,this.uint8[ae+7]=D,this.float32[ce+2]=W,s}}zf.prototype.bytesPerElement=12,jr(zf,"StructArrayLayout2i4ub1f12");class pa extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g){const y=this.length;return this.resize(y+1),this.emplace(y,s,c,g)}emplace(s,c,g,y){const T=3*s;return this.float32[T+0]=c,this.float32[T+1]=g,this.float32[T+2]=y,s}}pa.prototype.bytesPerElement=12,jr(pa,"StructArrayLayout3f12");class Ka extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,g,y,T)}emplace(s,c,g,y,T,E){const D=6*s,W=3*s;return this.uint16[D+0]=c,this.uint16[D+1]=g,this.uint16[D+2]=y,this.uint16[D+3]=T,this.float32[W+2]=E,s}}Ka.prototype.bytesPerElement=12,jr(Ka,"StructArrayLayout4ui1f12");class su extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,g,y)}emplace(s,c,g,y,T){const E=4*s;return this.uint16[E+0]=c,this.uint16[E+1]=g,this.uint16[E+2]=y,this.uint16[E+3]=T,s}}su.prototype.bytesPerElement=8,jr(su,"StructArrayLayout4ui8");class _h extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E){const D=this.length;return this.resize(D+1),this.emplace(D,s,c,g,y,T,E)}emplace(s,c,g,y,T,E,D){const W=6*s;return this.int16[W+0]=c,this.int16[W+1]=g,this.int16[W+2]=y,this.int16[W+3]=T,this.int16[W+4]=E,this.int16[W+5]=D,s}}_h.prototype.bytesPerElement=12,jr(_h,"StructArrayLayout6i12");class oc extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X,ae,ce,fe){const ye=this.length;return this.resize(ye+1),this.emplace(ye,s,c,g,y,T,E,D,W,X,ae,ce,fe)}emplace(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye){const _t=12*s;return this.int16[_t+0]=c,this.int16[_t+1]=g,this.int16[_t+2]=y,this.int16[_t+3]=T,this.uint16[_t+4]=E,this.uint16[_t+5]=D,this.uint16[_t+6]=W,this.uint16[_t+7]=X,this.int16[_t+8]=ae,this.int16[_t+9]=ce,this.int16[_t+10]=fe,this.int16[_t+11]=ye,s}}oc.prototype.bytesPerElement=24,jr(oc,"StructArrayLayout4i4ui4i24");class ac extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E){const D=this.length;return this.resize(D+1),this.emplace(D,s,c,g,y,T,E)}emplace(s,c,g,y,T,E,D){const W=10*s,X=5*s;return this.int16[W+0]=c,this.int16[W+1]=g,this.int16[W+2]=y,this.float32[X+2]=T,this.float32[X+3]=E,this.float32[X+4]=D,s}}ac.prototype.bytesPerElement=20,jr(ac,"StructArrayLayout3i3f20");class mo extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,g,y)}emplace(s,c,g,y,T){const E=4*s;return this.float32[E+0]=c,this.float32[E+1]=g,this.float32[E+2]=y,this.float32[E+3]=T,s}}mo.prototype.bytesPerElement=16,jr(mo,"StructArrayLayout4f16");class lc extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint32[1*s+0]=c,s}}lc.prototype.bytesPerElement=4,jr(lc,"StructArrayLayout1ul4");class Ja extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c){const g=this.length;return this.resize(g+1),this.emplace(g,s,c)}emplace(s,c,g){const y=2*s;return this.uint16[y+0]=c,this.uint16[y+1]=g,s}}Ja.prototype.bytesPerElement=4,jr(Ja,"StructArrayLayout2ui4");class Bf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye){const _t=this.length;return this.resize(_t+1),this.emplace(_t,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye)}emplace(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t){const St=20*s,Pt=10*s;return this.int16[St+0]=c,this.int16[St+1]=g,this.int16[St+2]=y,this.int16[St+3]=T,this.int16[St+4]=E,this.float32[Pt+3]=D,this.float32[Pt+4]=W,this.float32[Pt+5]=X,this.float32[Pt+6]=ae,this.int16[St+14]=ce,this.uint32[Pt+8]=fe,this.uint16[St+18]=ye,this.uint16[St+19]=_t,s}}Bf.prototype.bytesPerElement=40,jr(Bf,"StructArrayLayout5i4f1i1ul2ui40");class yh extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D){const W=this.length;return this.resize(W+1),this.emplace(W,s,c,g,y,T,E,D)}emplace(s,c,g,y,T,E,D,W){const X=8*s;return this.int16[X+0]=c,this.int16[X+1]=g,this.int16[X+2]=y,this.int16[X+4]=T,this.int16[X+5]=E,this.int16[X+6]=D,this.int16[X+7]=W,s}}yh.prototype.bytesPerElement=16,jr(yh,"StructArrayLayout3i2i2i16");class Nf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,g,y,T)}emplace(s,c,g,y,T,E){const D=4*s,W=8*s;return this.float32[D+0]=c,this.float32[D+1]=g,this.float32[D+2]=y,this.int16[W+6]=T,this.int16[W+7]=E,s}}Nf.prototype.bytesPerElement=16,jr(Nf,"StructArrayLayout2f1f2i16");class ou extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E){const D=this.length;return this.resize(D+1),this.emplace(D,s,c,g,y,T,E)}emplace(s,c,g,y,T,E,D){const W=20*s,X=5*s;return this.uint8[W+0]=c,this.uint8[W+1]=g,this.float32[X+1]=y,this.float32[X+2]=T,this.float32[X+3]=E,this.float32[X+4]=D,s}}ou.prototype.bytesPerElement=20,jr(ou,"StructArrayLayout2ub4f20");class go extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,g){const y=this.length;return this.resize(y+1),this.emplace(y,s,c,g)}emplace(s,c,g,y){const T=3*s;return this.uint16[T+0]=c,this.uint16[T+1]=g,this.uint16[T+2]=y,s}}go.prototype.bytesPerElement=6,jr(go,"StructArrayLayout3ui6");class au extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt,Tt,Wt){const ti=this.length;return this.resize(ti+1),this.emplace(ti,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt,Tt,Wt)}emplace(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt,Tt,Wt,ti){const ci=30*s,ki=15*s,Ci=60*s;return this.int16[ci+0]=c,this.int16[ci+1]=g,this.int16[ci+2]=y,this.float32[ki+2]=T,this.float32[ki+3]=E,this.uint16[ci+8]=D,this.uint16[ci+9]=W,this.uint32[ki+5]=X,this.uint32[ki+6]=ae,this.uint32[ki+7]=ce,this.uint16[ci+16]=fe,this.uint16[ci+17]=ye,this.uint16[ci+18]=_t,this.float32[ki+10]=St,this.float32[ki+11]=Pt,this.uint8[Ci+48]=zt,this.uint8[Ci+49]=Kt,this.uint8[Ci+50]=Qt,this.uint32[ki+13]=Tt,this.int16[ci+28]=Wt,this.uint8[Ci+58]=ti,s}}au.prototype.bytesPerElement=60,jr(au,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Vf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt,Tt,Wt,ti,ci,ki,Ci,Di,Vi,Qi,br,hr,xr,Sr,tr){const yr=this.length;return this.resize(yr+1),this.emplace(yr,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt,Tt,Wt,ti,ci,ki,Ci,Di,Vi,Qi,br,hr,xr,Sr,tr)}emplace(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt,Tt,Wt,ti,ci,ki,Ci,Di,Vi,Qi,br,hr,xr,Sr,tr,yr){const Yi=20*s,er=40*s,Cr=80*s;return this.float32[Yi+0]=c,this.float32[Yi+1]=g,this.int16[er+4]=y,this.int16[er+5]=T,this.int16[er+6]=E,this.int16[er+7]=D,this.int16[er+8]=W,this.int16[er+9]=X,this.int16[er+10]=ae,this.int16[er+11]=ce,this.int16[er+12]=fe,this.uint16[er+13]=ye,this.uint16[er+14]=_t,this.uint16[er+15]=St,this.uint16[er+16]=Pt,this.uint16[er+17]=zt,this.uint16[er+18]=Kt,this.uint16[er+19]=Qt,this.uint16[er+20]=Tt,this.uint16[er+21]=Wt,this.uint16[er+22]=ti,this.uint16[er+23]=ci,this.uint16[er+24]=ki,this.uint16[er+25]=Ci,this.uint16[er+26]=Di,this.uint16[er+27]=Vi,this.uint32[Yi+14]=Qi,this.float32[Yi+15]=br,this.float32[Yi+16]=hr,this.float32[Yi+17]=xr,this.float32[Yi+18]=Sr,this.uint8[Cr+76]=tr,this.uint16[er+39]=yr,s}}Vf.prototype.bytesPerElement=80,jr(Vf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class $f extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E){const D=this.length;return this.resize(D+1),this.emplace(D,s,c,g,y,T,E)}emplace(s,c,g,y,T,E,D){const W=6*s;return this.float32[W+0]=c,this.float32[W+1]=g,this.float32[W+2]=y,this.float32[W+3]=T,this.float32[W+4]=E,this.float32[W+5]=D,s}}$f.prototype.bytesPerElement=24,jr($f,"StructArrayLayout6f24");class Qa extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,g,y,T)}emplace(s,c,g,y,T,E){const D=5*s;return this.float32[D+0]=c,this.float32[D+1]=g,this.float32[D+2]=y,this.float32[D+3]=T,this.float32[D+4]=E,s}}Qa.prototype.bytesPerElement=20,jr(Qa,"StructArrayLayout5f20");class lu extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D){const W=this.length;return this.resize(W+1),this.emplace(W,s,c,g,y,T,E,D)}emplace(s,c,g,y,T,E,D,W){const X=7*s;return this.float32[X+0]=c,this.float32[X+1]=g,this.float32[X+2]=y,this.float32[X+3]=T,this.float32[X+4]=E,this.float32[X+5]=D,this.float32[X+6]=W,s}}lu.prototype.bytesPerElement=28,jr(lu,"StructArrayLayout7f28");class Uf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X,ae,ce){const fe=this.length;return this.resize(fe+1),this.emplace(fe,s,c,g,y,T,E,D,W,X,ae,ce)}emplace(s,c,g,y,T,E,D,W,X,ae,ce,fe){const ye=11*s;return this.float32[ye+0]=c,this.float32[ye+1]=g,this.float32[ye+2]=y,this.float32[ye+3]=T,this.float32[ye+4]=E,this.float32[ye+5]=D,this.float32[ye+6]=W,this.float32[ye+7]=X,this.float32[ye+8]=ae,this.float32[ye+9]=ce,this.float32[ye+10]=fe,s}}Uf.prototype.bytesPerElement=44,jr(Uf,"StructArrayLayout11f44");class vh extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X){const ae=this.length;return this.resize(ae+1),this.emplace(ae,s,c,g,y,T,E,D,W,X)}emplace(s,c,g,y,T,E,D,W,X,ae){const ce=9*s;return this.float32[ce+0]=c,this.float32[ce+1]=g,this.float32[ce+2]=y,this.float32[ce+3]=T,this.float32[ce+4]=E,this.float32[ce+5]=D,this.float32[ce+6]=W,this.float32[ce+7]=X,this.float32[ce+8]=ae,s}}vh.prototype.bytesPerElement=36,jr(vh,"StructArrayLayout9f36");class Pl extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c){const g=this.length;return this.resize(g+1),this.emplace(g,s,c)}emplace(s,c,g){const y=2*s;return this.float32[y+0]=c,this.float32[y+1]=g,s}}Pl.prototype.bytesPerElement=8,jr(Pl,"StructArrayLayout2f8");class Gf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,g,y)}emplace(s,c,g,y,T){const E=6*s;return this.uint32[3*s+0]=c,this.uint16[E+2]=g,this.uint16[E+3]=y,this.uint16[E+4]=T,s}}Gf.prototype.bytesPerElement=12,jr(Gf,"StructArrayLayout1ul3ui12");class cu extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint16[1*s+0]=c,s}}cu.prototype.bytesPerElement=2,jr(cu,"StructArrayLayout1ui2");class cc extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt)}emplace(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt){const Kt=16*s;return this.float32[Kt+0]=c,this.float32[Kt+1]=g,this.float32[Kt+2]=y,this.float32[Kt+3]=T,this.float32[Kt+4]=E,this.float32[Kt+5]=D,this.float32[Kt+6]=W,this.float32[Kt+7]=X,this.float32[Kt+8]=ae,this.float32[Kt+9]=ce,this.float32[Kt+10]=fe,this.float32[Kt+11]=ye,this.float32[Kt+12]=_t,this.float32[Kt+13]=St,this.float32[Kt+14]=Pt,this.float32[Kt+15]=zt,s}}cc.prototype.bytesPerElement=64,jr(cc,"StructArrayLayout16f64");class uu extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,g,y,T,E,D){const W=this.length;return this.resize(W+1),this.emplace(W,s,c,g,y,T,E,D)}emplace(s,c,g,y,T,E,D,W){const X=10*s,ae=5*s;return this.uint16[X+0]=c,this.uint16[X+1]=g,this.uint16[X+2]=y,this.uint16[X+3]=T,this.float32[ae+2]=E,this.float32[ae+3]=D,this.float32[ae+4]=W,s}}uu.prototype.bytesPerElement=20,jr(uu,"StructArrayLayout4ui3f20");class Hf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.int16[1*s+0]=c,s}}Hf.prototype.bytesPerElement=2,jr(Hf,"StructArrayLayout1i2");class xh extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint8[1*s+0]=c,s}}xh.prototype.bytesPerElement=1,jr(xh,"StructArrayLayout1ub1");class vp extends ru{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vp.prototype.size=40;class bh extends Bf{get(s){return new vp(this,s)}}jr(bh,"CollisionBoxArray");class xp extends ru{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}xp.prototype.size=60;class bp extends au{get(s){return new xp(this,s)}}jr(bp,"PlacedSymbolArray");class wp extends ru{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}wp.prototype.size=80;class Sp extends Vf{get(s){return new wp(this,s)}}jr(Sp,"SymbolInstanceArray");class jf extends Ya{getoffsetX(s){return this.float32[1*s+0]}}jr(jf,"GlyphOffsetArray");class Tp extends Ia{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}jr(Tp,"SymbolLineVertexArray");class Ep extends ru{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ep.prototype.size=12;class Mp extends Gf{get(s){return new Ep(this,s)}}jr(Mp,"FeatureIndexArray");class Ap extends Ja{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}jr(Ap,"FillExtrusionCentroidArray");class Cp extends ru{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Cp.prototype.size=6;class Pp extends nu{get(s){return new Cp(this,s)}}jr(Pp,"FillExtrusionWallArray");const ug=Zn([{name:"a_pos",components:2,type:"Int16"}],4),hg=Zn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),wh=Zn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hs{constructor(s=[]){this.segments=s}_prepareSegment(s,c,g,y){let T=this.segments[this.segments.length-1];return s>Hs.MAX_VERTEX_ARRAY_LENGTH&&yn(`Max vertices per segment is ${Hs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!T||T.vertexLength+s>Hs.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==y)&&(T={vertexOffset:c,primitiveOffset:g,vertexLength:0,primitiveLength:0},y!==void 0&&(T.sortKey=y),this.segments.push(T)),T}prepareSegment(s,c,g,y){return this._prepareSegment(s,c.length,g.length,y)}get(){return this.segments}destroy(){for(const s of this.segments)for(const c in s.vaos)s.vaos[c].destroy()}static simpleSegment(s,c,g,y){return new Hs([{vertexOffset:s,primitiveOffset:c,vertexLength:g,primitiveLength:y,vaos:{},sortKey:0}])}}function Ip(u,s){return 256*(u=Jt(Math.floor(u),0,255))+Jt(Math.floor(s),0,255)}Hs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jr(Hs,"SegmentVector");const Sh=Zn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Wf=Zn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Rp=Zn([{name:"a_dash",components:4,type:"Uint16"}]);class hu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,c,g,y){this.ids.push(qf(s)),this.positions.push(c,g,y)}eachPosition(s,c){const g=qf(s);let y=0,T=this.ids.length-1;for(;y<T;){const E=y+T>>1;this.ids[E]>=g?T=E:y=E+1}for(;this.ids[y]===g;)c(this.positions[3*y],this.positions[3*y+1],this.positions[3*y+2]),y++}static serialize(s,c){const g=new Float64Array(s.ids),y=new Uint32Array(s.positions);return Th(g,y,0,g.length-1),c&&(c.add(g.buffer),c.add(y.buffer)),{ids:g,positions:y}}static deserialize(s){const c=new hu;let g;c.ids=s.ids,c.positions=s.positions;for(const y of c.ids)y!==g&&c.uniqueIds.push(y),g=y;return c.indexed=!0,c}}function qf(u){const s=+u;return!isNaN(s)&&Number.MIN_SAFE_INTEGER<=s&&s<=Number.MAX_SAFE_INTEGER?s:kc(String(u))}function Th(u,s,c,g){for(;c<g;){const y=u[c+g>>1];let T=c-1,E=g+1;for(;;){do T++;while(u[T]<y);do E--;while(u[E]>y);if(T>=E)break;fu(u,T,E),fu(s,3*T,3*E),fu(s,3*T+1,3*E+1),fu(s,3*T+2,3*E+2)}E-c<g-E?(Th(u,s,c,E),c=E+1):(Th(u,s,E+1,g),g=E)}}function fu(u,s,c){const g=u[s];u[s]=u[c],u[c]=g}jr(hu,"FeaturePositionMap");class Ra{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,c),this.initialized=!0),!!this.location}set(s,c,g){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Eh extends Ra{constructor(s){super(s),this.current=0}set(s,c,g){this.fetchUniformLocation(s,c)&&this.current!==g&&(this.current=g,this.gl.uniform1i(this.location,g))}}class Zs extends Ra{constructor(s){super(s),this.current=0}set(s,c,g){this.fetchUniformLocation(s,c)&&this.current!==g&&(this.current=g,this.gl.uniform1f(this.location,g))}}class ma extends Ra{constructor(s){super(s),this.current=[0,0]}set(s,c,g){this.fetchUniformLocation(s,c)&&(g[0]===this.current[0]&&g[1]===this.current[1]||(this.current=g,this.gl.uniform2f(this.location,g[0],g[1])))}}class du extends Ra{constructor(s){super(s),this.current=[0,0,0]}set(s,c,g){this.fetchUniformLocation(s,c)&&(g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]||(this.current=g,this.gl.uniform3f(this.location,g[0],g[1],g[2])))}}class Mh extends Ra{constructor(s){super(s),this.current=[0,0,0,0]}set(s,c,g){this.fetchUniformLocation(s,c)&&(g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]&&g[3]===this.current[3]||(this.current=g,this.gl.uniform4f(this.location,g[0],g[1],g[2],g[3])))}}class Lp extends Ra{constructor(s){super(s),this.current=rs.transparent.toPremultipliedRenderColor(null)}set(s,c,g){this.fetchUniformLocation(s,c)&&(g.r===this.current.r&&g.g===this.current.g&&g.b===this.current.b&&g.a===this.current.a||(this.current=g,this.gl.uniform4f(this.location,g.r,g.g,g.b,g.a)))}}const fg=new Float32Array(16);class uc extends Ra{constructor(s){super(s),this.current=fg}set(s,c,g){if(this.fetchUniformLocation(s,c)){if(g[12]!==this.current[12]||g[0]!==this.current[0])return this.current=g,void this.gl.uniformMatrix4fv(this.location,!1,g);for(let y=1;y<16;y++)if(g[y]!==this.current[y]){this.current=g,this.gl.uniformMatrix4fv(this.location,!1,g);break}}}}const Xf=new Float32Array(9),ga=new Float32Array(4);class pu extends Ra{constructor(s){super(s),this.current=ga}set(s,c,g){if(this.fetchUniformLocation(s,c)){for(let y=0;y<4;y++)if(g[y]!==this.current[y]){this.current=g,this.gl.uniformMatrix2fv(this.location,!1,g);break}}}}function Zf(u){return[Ip(255*u.r,255*u.g),Ip(255*u.b,255*u.a)]}class mu{constructor(s,c,g,y){this.value=s,this.uniformNames=c.map(T=>`u_${T}`),this.type=g,this.context=y}setUniform(s,c,g,y,T){const E=y.constantOr(this.value);c.set(s,T,E instanceof rs?E.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):E)}getBinding(s,c){return this.type==="color"?new Lp(s):new Zs(s)}}class hc{constructor(s,c){this.uniformNames=c.map(g=>`u_${g}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,c){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(s,c,g,y,T){let E=null;T!=="u_pattern"&&T!=="u_dash"||(E=this.pattern),T==="u_pattern_b"&&(E=this.patternTransition),T==="u_pixel_ratio"&&(E=this.pixelRatio),E&&c.set(s,T,E)}getBinding(s,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new Mh(s):new Zs(s)}}class La{constructor(s,c,g,y){this.expression=s,this.type=g,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(s,c,g,y,T,E,D,W){const X=this.paintVertexArray.length,ae=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ps(0,{brightness:E,worldview:W}),c,{},T,y,D):this.expression.kind==="constant"&&this.expression.value,ce=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ps(0,{brightness:E,worldview:W}),c,{},T,y,D):this.lutExpression.value)==="none";this.paintVertexArray.resize(s),this._setPaintValue(X,s,ae,ce?null:this.context.lut)}updatePaintArray(s,c,g,y,T,E,D,W){const X=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:D,worldview:W},g,y,void 0,T):this.expression.kind==="constant"&&this.expression.value,ae=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ps(0,{brightness:D,worldview:W}),g,y,void 0,T):this.lutExpression.value)==="none";this._setPaintValue(s,c,X,ae?null:this.context.lut)}_setPaintValue(s,c,g,y){if(this.type==="color"){const T=Zf(g.toPremultipliedRenderColor(y));for(let E=s;E<c;E++)this.paintVertexArray.emplace(E,T[0],T[1])}else{for(let T=s;T<c;T++)this.paintVertexArray.emplace(T,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(s,c,g,y,T,E){this.expression=s,this.uniformNames=c.map(D=>`u_${D}_t`),this.type=g,this.useIntegerZoom=y,this.context=T,this.maxValue=0,this.paintVertexAttributes=c.map(D=>({name:`a_${D}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(s,c,g,y,T,E,D,W){const X=this.expression.evaluate(new ps(this.context.zoom,{brightness:E,worldview:W}),c,{},T,y,D),ae=this.expression.evaluate(new ps(this.context.zoom+1,{brightness:E,worldview:W}),c,{},T,y,D),ce=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ps(0,{brightness:E,worldview:W}),c,{},T,y,D):this.lutExpression.value)==="none",fe=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(fe,s,X,ae,ce?null:this.context.lut)}updatePaintArray(s,c,g,y,T,E,D,W){const X=this.expression.evaluate({zoom:this.context.zoom,brightness:D,worldview:W},g,y,void 0,T),ae=this.expression.evaluate({zoom:this.context.zoom+1,brightness:D,worldview:W},g,y,void 0,T),ce=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ps(0,{brightness:D,worldview:W}),g,y,void 0,T):this.lutExpression.value)==="none";this._setPaintValue(s,c,X,ae,ce?null:this.context.lut)}_setPaintValue(s,c,g,y,T){if(this.type==="color"){const E=Zf(g.toPremultipliedRenderColor(T)),D=Zf(g.toPremultipliedRenderColor(T));for(let W=s;W<c;W++)this.paintVertexArray.emplace(W,E[0],E[1],D[0],D[1])}else{for(let E=s;E<c;E++)this.paintVertexArray.emplace(E,g,y);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(y))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,c,g,y,T){const E=this.useIntegerZoom?Math.floor(g.zoom):g.zoom,D=Jt(this.expression.interpolationFactor(E,this.context.zoom,this.context.zoom+1),0,1);c.set(s,T,D)}getBinding(s,c){return new Zs(s)}}class Qo{constructor(s,c,g,y,T){this.expression=s,this.layerId=T,this.paintVertexAttributes=(g==="array"?Rp:Sh).members;for(let E=0;E<c.length;++E);this.paintVertexArray=new y,this.paintTransitionVertexArray=new su}populatePaintArray(s,c,g,y){const T=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(T,s,c.patterns&&c.patterns[this.layerId],g)}updatePaintArray(s,c,g,y,T,E,D){this._setPaintValues(s,c,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(s,c,g,y){if(!y||!g)return;const T=y[g[0]],E=y[g[1]];if(T){if(T){const{tl:D,br:W,pixelRatio:X}=T;for(let ae=s;ae<c;ae++)this.paintVertexArray.emplace(ae,D[0],D[1],W[0],W[1],X)}if(E){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:D,br:W}=E;for(let X=s;X<c;X++)this.paintTransitionVertexArray.emplace(X,D[0],D[1],W[0],W[1])}}}upload(s){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,Wf.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class fc{constructor(s,c,g=()=>!0){this.binders={},this._buffers=[],this.context=c;const y=[];for(const T in s.paint._values){const E=s.paint.get(T);if(T.endsWith("-use-theme")||!g(T)||!(E instanceof ic&&Zc(E.property.specification)))continue;const D=f(T,s.type),W=E.value,X=E.property.specification.type,ae=!!E.property.useIntegerZoom,ce=T==="line-dasharray"||T.endsWith("pattern"),fe=s.paint.get(`${T}-use-theme`),ye=T==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||fe&&fe.value.kind!=="constant";if(W.kind!=="constant"||ye)if(W.kind==="source"||ye||ce){const _t=R(T,X,"source");this.binders[T]=ce?new Qo(W,D,X,_t,s.id):new La(W,D,X,_t),y.push(`/a_${T}`)}else{const _t=R(T,X,"composite");this.binders[T]=new aa(W,D,X,ae,c,_t),y.push(`/z_${T}`)}else this.binders[T]=ce?new hc(W.value,D):new mu(W.value,D,X,c),y.push(`/u_${T}`);fe&&(this.binders[T].lutExpression=fe.value)}this.cacheKey=y.sort().join("")}getMaxValue(s){const c=this.binders[s];return c instanceof La||c instanceof aa?c.maxValue:0}populatePaintArrays(s,c,g,y,T,E,D,W){for(const X in this.binders){const ae=this.binders[X];ae.context=this.context,(ae instanceof La||ae instanceof aa||ae instanceof Qo)&&ae.populatePaintArray(s,c,g,y,T,E,D,W)}}setConstantPatternPositions(s,c){for(const g in this.binders){const y=this.binders[g];y instanceof hc&&y.setConstantPatternPositions(s,c)}}getPatternTransitionVertexBuffer(s){const c=this.binders[s];return c instanceof Qo?c.paintTransitionVertexBuffer:null}updatePaintArrays(s,c,g,y,T,E,D,W,X,ae){let ce=!1;const fe=Object.keys(s),ye=fe.length!==0&&!W,_t=ye?fe:c.uniqueIds;this.context.lut=T.lut;for(const St in this.binders){const Pt=this.binders[St];if(Pt.context=this.context,(Pt instanceof La||Pt instanceof aa||Pt instanceof Qo)&&Pt.expression&&Pt.expression.kind&&Pt.expression.kind!=="constant"&&(Pt.expression.isStateDependent===!0||Pt.expression.isLightConstant===!1)){const zt=T.paint.get(St);Pt.expression=zt.value;for(const Kt of _t){const Qt=s[Kt.toString()];c.eachPosition(Kt,(Tt,Wt,ti)=>{const ci=y.feature(Tt);Pt.updatePaintArray(Wt,ti,ci,Qt,E,D,X,ae)})}if(!ye)for(const Kt of g.uniqueIds){const Qt=s[Kt.toString()];g.eachPosition(Kt,(Tt,Wt,ti)=>{const ci=y.feature(Tt);Pt.updatePaintArray(Wt,ti,ci,Qt,E,D,X,ae)})}ce=!0}}return ce}defines(){const s=[];for(const c in this.binders){const g=this.binders[c];(g instanceof mu||g instanceof hc)&&s.push(...g.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return s}getBinderAttributes(){const s=[];for(const c in this.binders){const g=this.binders[c];if(g instanceof La||g instanceof aa||g instanceof Qo)for(let y=0;y<g.paintVertexAttributes.length;y++)s.push(g.paintVertexAttributes[y].name);if(g instanceof Qo)for(let y=0;y<Wf.members.length;y++)s.push(Wf.members[y].name)}return s}getBinderUniforms(){const s=[];for(const c in this.binders){const g=this.binders[c];if(g instanceof mu||g instanceof hc||g instanceof aa)for(const y of g.uniformNames)s.push(y)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const c=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof mu||y instanceof hc||y instanceof aa)for(const T of y.uniformNames)c.push({name:T,property:g,binding:y.getBinding(s,T)})}return c}setUniforms(s,c,g,y,T){for(const{name:E,property:D,binding:W}of g)this.binders[D].setUniform(s,W,T,y.get(D),E)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const c=this.binders[s];(c instanceof La||c instanceof aa||c instanceof Qo)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof Qo&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(s){for(const c in this.binders){const g=this.binders[c];(g instanceof La||g instanceof aa||g instanceof Qo)&&g.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const c=this.binders[s];(c instanceof La||c instanceof aa||c instanceof Qo)&&c.destroy()}}}class b{constructor(s,c,g=()=>!0){this.programConfigurations={};for(const y of s)this.programConfigurations[y.id]=new fc(y,c,g);this.needsUpload=!1,this._featureMap=new hu,this._featureMapWithoutIds=new hu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,c,g,y,T,E,D,W,X){for(const ae in this.programConfigurations)this.programConfigurations[ae].populatePaintArrays(s,c,y,T,E,D,W,X);c.id!==void 0?this._featureMap.add(c.id,g,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,g,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,c,g,y,T,E,D,W){for(const X of g)this.needsUpload=this.programConfigurations[X.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,c,X,y,T,E,D||0,W)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const a={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function f(u,s){return a[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}const w={"line-pattern":{source:Ka,composite:Ka},"fill-pattern":{source:Ka,composite:Ka},"fill-extrusion-pattern":{source:Ka,composite:Ka},"line-dasharray":{source:su,composite:su}},P={color:{source:Pl,composite:mo},number:{source:Ya,composite:Pl}};function R(u,s,c){const g=w[u];return g&&g[c]||P[s][c]}jr(mu,"ConstantBinder"),jr(hc,"PatternConstantBinder"),jr(La,"SourceExpressionBinder"),jr(Qo,"PatternCompositeBinder"),jr(aa,"CompositeExpressionBinder"),jr(fc,"ProgramConfiguration",{omit:["_buffers"]}),jr(b,"ProgramConfigurationSet");const H=Fr/Math.PI/2,Q=5,oe=6,de=16383,pe=64,yt=[pe,32,16],pt=-H,vt=H;function Dt(u,s,c,g=H){return c=Ai(c),[u*Math.sin(c)*g,-s*g,u*Math.cos(c)*g]}function At(u,s,c){return Dt(Math.cos(Ai(u)),Math.sin(Ai(u)),s,c)}const Ot=63710088e-1,Bt=2*Math.PI*Ot;class qt{constructor(s,c){if(isNaN(s)||isNaN(c))throw new Error(`Invalid LngLat object: (${s}, ${c})`);if(this.lng=+s,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qt(Fi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const c=Math.PI/180,g=this.lat*c,y=s.lat*c,T=Math.sin(g)*Math.sin(y)+Math.cos(g)*Math.cos(y)*Math.cos((s.lng-this.lng)*c);return Ot*Math.acos(Math.min(T,1))}toBounds(s=0){const c=360*s/40075017,g=c/Math.cos(Math.PI/180*this.lat);return new li({lng:this.lng-g,lat:this.lat-c},{lng:this.lng+g,lat:this.lat+c})}toEcef(s){return At(this.lat,this.lng,H+s*H/Ot)}static convert(s){if(s instanceof qt)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new qt(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new qt(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class li{constructor(s,c){if(s)if(c)this.setSouthWest(s).setNorthEast(c);else if(s.length===4){const g=s;this.setSouthWest([g[0],g[1]]).setNorthEast([g[2],g[3]])}else{const g=s;this.setSouthWest(g[0]).setNorthEast(g[1])}}setNorthEast(s){return this._ne=s instanceof qt?new qt(s.lng,s.lat):qt.convert(s),this}setSouthWest(s){return this._sw=s instanceof qt?new qt(s.lng,s.lat):qt.convert(s),this}extend(s){const c=this._sw,g=this._ne;let y,T;if(s instanceof qt)y=s,T=s;else{if(!(s instanceof li))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(li.convert(s)):this.extend(qt.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(qt.convert(s)):this;if(y=s._sw,T=s._ne,!y||!T)return this}return c||g?(c.lng=Math.min(y.lng,c.lng),c.lat=Math.min(y.lat,c.lat),g.lng=Math.max(T.lng,g.lng),g.lat=Math.max(T.lat,g.lat)):(this._sw=new qt(y.lng,y.lat),this._ne=new qt(T.lng,T.lat)),this}getCenter(){return new qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qt(this.getWest(),this.getNorth())}getSouthEast(){return new qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:c,lat:g}=qt.convert(s);let y=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&y}static convert(s){if(s)return s instanceof li?s:new li(s)}}const fi=0,Ti=25.5;function wi(u){return Bt*Math.cos(u*Math.PI/180)}function vi(u){return(180+u)/360}function di(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Ei(u,s){return u/wi(s)}function Pi(u){return 360*u-180}function ji(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Wi(u,s){return u*wi(ji(s))}const or=85.051129;function ar(u){return Math.cos(Ai(Jt(u,-85.051129,or)))}function vr(u,s){const c=Jt(s,fi,Ti),g=Math.pow(2,c);return ar(u)*Bt/(512*g)}function Ui(u){return 1/Math.cos(u*Math.PI/180)}function Ji(u,s=0){const c=Math.exp(Math.PI*(1-(u.y+s/Fr)/(1<<u.z)*2));return 80150034*c/(c*c+1)/Fr/(1<<u.z)}class zi{constructor(s,c,g=0){this.x=+s,this.y=+c,this.z=+g}static fromLngLat(s,c=0){const g=qt.convert(s);return new zi(vi(g.lng),di(g.lat),Ei(c,g.lat))}toLngLat(){return new qt(Pi(this.x),ji(this.y))}toAltitude(){return Wi(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bt*Ui(ji(this.y))}}function ur(u,s,c,g,y,T,E,D,W){const X=(s+g)/2,ae=(c+y)/2,ce=new rr(X,ae);D(ce),function(fe,ye,_t,St,Pt,zt){const Kt=_t-Pt,Qt=St-zt;return Math.abs((St-ye)*Kt-(_t-fe)*Qt)/Math.hypot(Kt,Qt)}(ce.x,ce.y,T.x,T.y,E.x,E.y)>=W?(ur(u,s,c,X,ae,T,ce,D,W),ur(u,X,ae,g,y,ce,E,D,W)):u.push(E)}function Zi(u,s,c){let g=u[0],y=g.x,T=g.y;s(g);const E=[g];for(let D=1;D<u.length;D++){const W=u[D],{x:X,y:ae}=W;s(W),ur(E,y,T,X,ae,g,W,s,c),y=X,T=ae,g=W}return E}function gr(u,s,c,g){if(g(s,c)){const y=s.add(c)._mult(.5);gr(u,s,y,g),gr(u,y,c,g)}else u.push(c)}function kr(u,s){let c=u[0];const g=[c];for(let y=1;y<u.length;y++){const T=u[y];gr(g,c,T,s),c=T}return g}const cr=Math.pow(2,14)-1,Pr=-cr-1;function Wr(u,s){const c=Math.round(u.x*s),g=Math.round(u.y*s);return u.x=Jt(c,Pr,cr),u.y=Jt(g,Pr,cr),(c<u.x||c>u.x+1||g<u.y||g>u.y+1)&&yn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function qr(u,s,c){const g=u.loadGeometry(),y=u.extent,T=Fr/y;if(s&&c&&c.projection.isReprojectedInTileSpace){const E=1<<s.z,{scale:D,x:W,y:X,projection:ae}=c,ce=fe=>{const ye=Pi((s.x+fe.x/y)/E),_t=ji((s.y+fe.y/y)/E),St=ae.project(ye,_t);fe.x=(St.x*D-W)*y,fe.y=(St.y*D-X)*y};for(let fe=0;fe<g.length;fe++)if(u.type!==1)g[fe]=Zi(g[fe],ce,1);else{const ye=[];for(const _t of g[fe])_t.x<0||_t.x>=y||_t.y<0||_t.y>=y||(ce(_t),ye.push(_t));g[fe]=ye}}for(const E of g)for(const D of E)Wr(D,T);return g}function Ur(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?qr(u):[]}}var Qr,nn,ln,gn,En,ss,ws,cs={};function fs(){if(nn)return Qr;nn=1;var u=eo();function s(y,T,E,D,W){this.properties={},this.extent=E,this.type=0,this._pbf=y,this._geometry=-1,this._keys=D,this._values=W,y.readFields(c,this,T)}function c(y,T,E){y==1?T.id=E.readVarint():y==2?function(D,W){for(var X=D.readVarint()+D.pos;D.pos<X;){var ae=W._keys[D.readVarint()],ce=W._values[D.readVarint()];W.properties[ae]=ce}}(E,T):y==3?T.type=E.readVarint():y==4&&(T._geometry=E.pos)}function g(y){for(var T,E,D=0,W=0,X=y.length,ae=X-1;W<X;ae=W++)D+=((E=y[ae]).x-(T=y[W]).x)*(T.y+E.y);return D}return Qr=s,s.types=["Unknown","Point","LineString","Polygon"],s.prototype.loadGeometry=function(){var y=this._pbf;y.pos=this._geometry;for(var T,E=y.readVarint()+y.pos,D=1,W=0,X=0,ae=0,ce=[];y.pos<E;){if(W<=0){var fe=y.readVarint();D=7&fe,W=fe>>3}if(W--,D===1||D===2)X+=y.readSVarint(),ae+=y.readSVarint(),D===1&&(T&&ce.push(T),T=[]),T.push(new u(X,ae));else{if(D!==7)throw new Error("unknown command "+D);T&&T.push(T[0].clone())}}return T&&ce.push(T),ce},s.prototype.bbox=function(){var y=this._pbf;y.pos=this._geometry;for(var T=y.readVarint()+y.pos,E=1,D=0,W=0,X=0,ae=1/0,ce=-1/0,fe=1/0,ye=-1/0;y.pos<T;){if(D<=0){var _t=y.readVarint();E=7&_t,D=_t>>3}if(D--,E===1||E===2)(W+=y.readSVarint())<ae&&(ae=W),W>ce&&(ce=W),(X+=y.readSVarint())<fe&&(fe=X),X>ye&&(ye=X);else if(E!==7)throw new Error("unknown command "+E)}return[ae,fe,ce,ye]},s.prototype.toGeoJSON=function(y,T,E){var D,W,X=this.extent*Math.pow(2,E),ae=this.extent*y,ce=this.extent*T,fe=this.loadGeometry(),ye=s.types[this.type];function _t(zt){for(var Kt=0;Kt<zt.length;Kt++){var Qt=zt[Kt];zt[Kt]=[360*(Qt.x+ae)/X-180,360/Math.PI*Math.atan(Math.exp((180-360*(Qt.y+ce)/X)*Math.PI/180))-90]}}switch(this.type){case 1:var St=[];for(D=0;D<fe.length;D++)St[D]=fe[D][0];_t(fe=St);break;case 2:for(D=0;D<fe.length;D++)_t(fe[D]);break;case 3:for(fe=function(zt){var Kt=zt.length;if(Kt<=1)return[zt];for(var Qt,Tt,Wt=[],ti=0;ti<Kt;ti++){var ci=g(zt[ti]);ci!==0&&(Tt===void 0&&(Tt=ci<0),Tt===ci<0?(Qt&&Wt.push(Qt),Qt=[zt[ti]]):Qt.push(zt[ti]))}return Qt&&Wt.push(Qt),Wt}(fe),D=0;D<fe.length;D++)for(W=0;W<fe[D].length;W++)_t(fe[D][W])}fe.length===1?fe=fe[0]:ye="Multi"+ye;var Pt={type:"Feature",geometry:{type:ye,coordinates:fe},properties:this.properties};return"id"in this&&(Pt.id=this.id),Pt},Qr}function qs(){if(gn)return ln;gn=1;var u=fs();function s(g,y){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(c,this,y),this.length=this._features.length}function c(g,y,T){g===15?y.version=T.readVarint():g===1?y.name=T.readString():g===5?y.extent=T.readVarint():g===2?y._features.push(T.pos):g===3?y._keys.push(T.readString()):g===4&&y._values.push(function(E){for(var D=null,W=E.readVarint()+E.pos;E.pos<W;){var X=E.readVarint()>>3;D=X===1?E.readString():X===2?E.readFloat():X===3?E.readDouble():X===4?E.readVarint64():X===5?E.readVarint():X===6?E.readSVarint():X===7?E.readBoolean():null}return D}(T))}return ln=s,s.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var y=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,y,this.extent,this._keys,this._values)},ln}function xn(){return ws||(ws=1,cs.VectorTile=function(){if(ss)return En;ss=1;var u=qs();function s(c,g,y){if(c===3){var T=new u(y,y.readVarint()+y.pos);T.length&&(g[T.name]=T)}}return En=function(c,g){this.layers=c.readFields(s,{},g)},En}(),cs.VectorTileFeature=fs(),cs.VectorTileLayer=qs()),cs}var Cn=xn();const Fn="3d_elevation_id",Cs="level";class io{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,c){return this._valid&&s(c(this._geometry)),this}require(s,c,g){return this.get(s,!0,c,g)}optional(s,c,g){return this.get(s,!1,c,g)}success(){return this._valid}get(s,c,g,y){const T=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&T!==void 0&&!Number.isNaN(T)?g(y?y(T):T):c&&(this._valid=!1),this}}class Ss{constructor(s,c){this.featureFunc=s,this.vertexFunc=c}parseFeature(s,c,g){return this.featureFunc(s,c,g)}parseVertex(s,c,g){return this.vertexFunc(s,c,g)}}const Kn=new Ss((u,s,c)=>u.reset(s).require(Fn,g=>{c.id=g}).optional("fixed_height_relative",g=>{c.constantHeight=g},jn.decodeRelativeHeight).geometry(g=>{c.bounds=g},tf).success(),(u,s,c)=>u.reset(s).require(Fn,g=>{c.id=g}).require("elevation_idx",g=>{c.idx=g}).require("extent",g=>{c.extent=g}).require("height_relative",g=>{c.height=g},jn.decodeRelativeHeight).geometry(g=>{c.position=g},jn.getPoint).success()),Gs=new Ss((u,s,c)=>u.reset(s).require(Fn,g=>{c.id=g}).optional("fixed_height",g=>{c.constantHeight=g},jn.decodeMetricHeight).geometry(g=>{c.bounds=g},tf).success(),(u,s,c)=>u.reset(s).require(Fn,g=>{c.id=g}).require("elevation_idx",g=>{c.idx=g}).require("extent",g=>{c.extent=g}).require("height",g=>{c.height=g},jn.decodeMetricHeight).geometry(g=>{c.position=g},jn.getPoint).success());class jn{static getPoint(s){return Vr(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static parse(s){const c=[],g=[],y=s.length,T=new io;for(let D=0;D<y;D++){const W=s.feature(D),X=W.properties.hasOwnProperty("version")?String(W.properties.version):void 0,ae=(E=X)?E==="1.0.1"?Gs:void 0:Kn;if(ae===void 0){yn(`Unknown elevation feature version number ${X||"(unknown)"}`);continue}const ce=W.properties.hasOwnProperty("type")?W.properties.type:void 0;if(ce){if(Cn.VectorTileFeature.types[W.type]==="Point"&&ce==="curve_point"){const fe={};ae.parseVertex(T,W,fe)&&c.push(fe)}else if(Cn.VectorTileFeature.types[W.type]==="Polygon"&&ce==="curve_meta"){const fe={};ae.parseFeature(T,W,fe)&&g.push(fe)}}}var E;return{vertices:c,features:g}}}class Ys{constructor(s,c){this.pos=s,this.dir=c}intersectsPlane(s,c,g){const y=Dn(c,this.dir);if(Math.abs(y)<1e-6)return!1;const T=((s[0]-this.pos[0])*c[0]+(s[1]-this.pos[1])*c[1])/y;return g[0]=this.pos[0]+this.dir[0]*T,g[1]=this.pos[1]+this.dir[1]*T,!0}}class Ps{constructor(s,c){this.pos=s,this.dir=c}intersectsPlane(s,c,g){const y=si(c,this.dir);if(Math.abs(y)<1e-6)return!1;const T=((s[0]-this.pos[0])*c[0]+(s[1]-this.pos[1])*c[1]+(s[2]-this.pos[2])*c[2])/y;return g[0]=this.pos[0]+this.dir[0]*T,g[1]=this.pos[1]+this.dir[1]*T,g[2]=this.pos[2]+this.dir[2]*T,!0}closestPointOnSphere(s,c,g){if(function(ye,_t){var St=ye[0],Pt=ye[1],zt=ye[2],Kt=_t[0],Qt=_t[1],Tt=_t[2];return Math.abs(St-Kt)<=S*Math.max(1,Math.abs(St),Math.abs(Kt))&&Math.abs(Pt-Qt)<=S*Math.max(1,Math.abs(Pt),Math.abs(Qt))&&Math.abs(zt-Tt)<=S*Math.max(1,Math.abs(zt),Math.abs(Tt))}(this.pos,s)||c===0)return g[0]=g[1]=g[2]=0,!1;const[y,T,E]=this.dir,D=this.pos[0]-s[0],W=this.pos[1]-s[1],X=this.pos[2]-s[2],ae=y*y+T*T+E*E,ce=2*(D*y+W*T+X*E),fe=ce*ce-4*ae*(D*D+W*W+X*X-c*c);if(fe<0){const ye=Math.max(-ce/2,0),_t=D+y*ye,St=W+T*ye,Pt=X+E*ye,zt=Math.hypot(_t,St,Pt);return g[0]=_t*c/zt,g[1]=St*c/zt,g[2]=Pt*c/zt,!1}{const ye=(-ce-Math.sqrt(fe))/(2*ae);if(ye<0){const _t=Math.hypot(D,W,X);return g[0]=D*c/_t,g[1]=W*c/_t,g[2]=X*c/_t,!1}return g[0]=D+y*ye,g[1]=W+T*ye,g[2]=X+E*ye,!0}}}class _s{constructor(s,c,g,y,T){this.TL=s,this.TR=c,this.BR=g,this.BL=y,this.horizon=T}static fromInvProjectionMatrix(s,c,g){const y=[-1,1,1],T=[1,1,1],E=[1,-1,1],D=[-1,-1,1],W=oi(y,y,s),X=oi(T,T,s),ae=oi(E,E,s),ce=oi(D,D,s);return new _s(W,X,ae,ce,c/g)}}function Is(u,s,c){let g=1/0,y=-1/0;const T=[];for(const E of u){kt(T,E,s);const D=si(T,c);g=Math.min(g,D),y=Math.max(y,D)}return[g,y]}function Qn(u,s){let c=!0;for(let g=0;g<u.planes.length;g++){const y=u.planes[g];let T=0;for(let E=0;E<s.length;E++)T+=si(y,s[E])+y[3]>=0;if(T===0)return 0;T!==s.length&&(c=!1)}return c?2:1}function js(u,s){for(const c of u.projections){const g=Is(s,u.points[0],c.axis);if(c.projection[1]<g[0]||c.projection[0]>g[1])return 0}return 1}function _o(u,s){let c=0;const g=[0,0,0,0];for(let E=0;E<u.length;E++)g[0]=u[E][0],g[1]=u[E][1],g[2]=u[E][2],g[3]=1,(y=g)[0]*(T=s)[0]+y[1]*T[1]+y[2]*T[2]+y[3]*T[3]>=0&&c++;var y,T;return c}class Ds{constructor(s,c){this.points=s||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=Yn.fromPoints(this.points),this.projections=[],this.frustumEdges=[kt([],this.points[2],this.points[3]),kt([],this.points[0],this.points[3]),kt([],this.points[4],this.points[0]),kt([],this.points[5],this.points[1]),kt([],this.points[6],this.points[2]),kt([],this.points[7],this.points[3])];for(const g of this.frustumEdges){const y=[0,-g[2],g[1]],T=[g[2],0,-g[0]];this.projections.push({axis:y,projection:Is(this.points,this.points[0],y)}),this.projections.push({axis:T,projection:Is(this.points,this.points[0],T)})}}static fromInvProjectionMatrix(s,c,g,y){const T=Math.pow(2,g),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(X=>{const ae=Hi([],X,s),ce=1/ae[3]/c*T;return(fe=ae)[0]=(ye=ae)[0]*(_t=[ce,ce,y?1/ae[3]:ce,ce])[0],fe[1]=ye[1]*_t[1],fe[2]=ye[2]*_t[2],fe[3]=ye[3]*_t[3],fe;var fe,ye,_t}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(X=>{const ae=nr([],Gt([],kt([],E[X[0]],E[X[1]]),kt([],E[X[2]],E[X[1]]))),ce=-si(ae,E[X[1]]);return ae.concat(ce)}),W=[];for(let X=0;X<E.length;X++)W.push([E[X][0],E[X][1],E[X][2]]);return new Ds(W,D)}intersectsPrecise(s,c,g){for(let y=0;y<c.length;y++)if(!_o(s,c[y]))return 0;for(let y=0;y<this.planes.length;y++)if(!_o(s,this.planes[y]))return 0;for(const y of g)for(const T of this.frustumEdges){const E=Gt([],y,T),D=Yt(E);if(D===0)continue;jt(E,E,1/D);const W=Is(this.points,this.points[0],E),X=Is(s,this.points[0],E);if(W[0]>X[1]||X[0]>W[1])return 0}return 1}containsPoint(s){for(const c of this.planes){const g=c[3];if(si([c[0],c[1],c[2]],s)+g<0)return!1}return!0}}class Yn{static fromPoints(s){const c=[1/0,1/0,1/0],g=[-1/0,-1/0,-1/0];for(const y of s)Mt(c,c,y),$t(g,g,y);return new Yn(c,g)}static fromTileIdAndHeight(s,c,g){const y=1<<s.canonical.z,T=s.canonical.x,E=s.canonical.y;return new Yn([T/y,E/y,c],[(T+1)/y,(E+1)/y,g])}static applyTransform(s,c){const g=s.getCorners();for(let y=0;y<g.length;++y)oi(g[y],g[y],c);return Yn.fromPoints(g)}static applyTransformFast(s,c){const g=[c[12],c[13],c[14]],y=[...g];for(let T=0;T<3;T++)for(let E=0;E<3;E++){const D=c[4*E+T],W=D*s.min[E],X=D*s.max[E];g[T]+=Math.min(W,X),y[T]+=Math.max(W,X)}return new Yn(g,y)}static projectAabbCorners(s,c){const g=s.getCorners();for(let y=0;y<g.length;++y)oi(g[y],g[y],c);return g}constructor(s,c){this.min=s,this.max=c,this.center=jt([],ei([],this.min,this.max),.5)}quadrant(s){const c=[s%2==0,s<2],g=It(this.min),y=It(this.max);for(let T=0;T<c.length;T++)g[T]=c[T]?this.min[T]:this.center[T],y[T]=c[T]?this.center[T]:this.max[T];return y[2]=this.max[2],new Yn(g,y)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,c=this.max;return[[s[0],s[1],s[2]],[c[0],s[1],s[2]],[c[0],c[1],s[2]],[s[0],c[1],s[2]],[s[0],s[1],c[2]],[c[0],s[1],c[2]],[c[0],c[1],c[2]],[s[0],c[1],c[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?Qn(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?Qn(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,c){return c||this.intersects(s)?js(s,this.getCorners()):0}intersectsPreciseFlat(s,c){return c||this.intersectsFlat(s)?js(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let c=0;c<3;++c)if(this.min[c]>s.max[c]||s.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],s.min[c]),this.max[c]=Math.max(this.max[c],s.max[c])}encapsulatePoint(s){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],s[c]),this.max[c]=Math.max(this.max[c],s[c])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}jr(Yn,"Aabb");class No{constructor(s,c){this.feature=s,this.metersToTile=c,this.index=0}get(){const s=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,g=c[1],y=-c[0],T=(s.extent+1)*this.metersToTile;return[new rr(Math.trunc(s.position[0]+g*T),Math.trunc(s.position[1]+y*T)),new rr(Math.trunc(s.position[0]-g*T),Math.trunc(s.position[1]-y*T))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Do{constructor(s,c,g,y,T,E){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=s,this.heightRange={min:g,max:g},this.safeArea=c,this.constantHeight=g,this.constantHeight==null&&(this.constantHeight!=null||y.length!==0)){this.vertices=y,this.edges=T,this.edges=this.edges.filter(D=>{return D.a<this.vertices.length&&D.b<this.vertices.length&&!((W=this.vertices[D.a].position)[0]===(X=this.vertices[D.b].position)[0]&&W[1]===X[1]);var W,X}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const D of this.vertices)this.vertexProps.push({dir:Vr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,D.height),this.heightRange.max=Math.max(this.heightRange.max,D.height);for(const D of this.edges){const W=this.vertices[D.a].position,X=this.vertices[D.b].position,ae=Nn(wr(),X,W),ce=es(ae),fe=zs(wr(),ae,1/ce);this.edgeProps.push({vec:ae,dir:fe,len:ce});const ye=this.vertexProps[D.a].dir,_t=this.vertexProps[D.b].dir;wn(ye,ye,fe),wn(_t,_t,fe)}for(const D of this.vertexProps)D.dir[0]===0&&D.dir[1]===0||As(D.dir,D.dir);this.tessellate(E)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(s);if(c==null)return 0;const[g,y]=c;return pn(this.vertices[this.edges[g].a].height,this.vertices[this.edges[g].b].height,y)}computeSlopeNormal(s,c){const g=this.getClosestEdge(s);if(!g)return ri(0,0,1);const y=g[0],T=this.edges[y],E=this.edgeProps[y].vec,D=ri(E[0],E[1],(this.vertices[T.b].height-this.vertices[T.a].height)*c),W=ri(D[1],-D[0],0);Gt(W,W,D);const X=Yt(W);return X>0?jt(W,W,1/X):ri(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let c=0,g=Number.POSITIVE_INFINITY,y=0;const T=Vr(s.x,s.y);for(let E=0;E<this.edges.length;E++){const D=this.edges[E],W=this.edgeProps[E].dir,X=new Ys(T,this.edgeProps[E].dir),ae=this.vertices[D.a].position,ce=this.vertices[D.b].position,fe=wr(),ye=wr(),_t=X.intersectsPlane(ae,this.vertexProps[D.a].dir,fe),St=X.intersectsPlane(ce,this.vertexProps[D.b].dir,ye);if(!_t||!St)continue;const Pt=Nn(wr(),ye,fe),zt=Nn(wr(),T,fe),Kt=Dn(Pt,Pt),Qt=Kt>0?Dn(zt,Pt)/Kt:0,Tt=Jt(Qt,0,1),Wt=Math.abs((Qt-Tt)*this.edgeProps[E].len),ti=Nn(wr(),T,ae),ci=Wt+Math.abs(Dn(ti,Vr(W[1],-W[0])));ci<g&&(c=E,g=ci,y=Tt)}return[c,y]}tessellate(s){for(let c=this.edges.length-1;c>=0;--c){const g=this.edges[c].a,y=this.edges[c].b,{position:T,height:E,extent:D}=this.vertices[g],{position:W,height:X,extent:ae}=this.vertices[y],ce=this.vertexProps[g].dir,fe=this.vertexProps[y].dir,ye=ri(T[0]/s,T[1]/s,E),_t=ri(W[0]/s,W[1]/s,X),St=ri(ce[1],-ce[0],0);jt(St,St,D);const Pt=ri(fe[1],-fe[0],0);if(jt(Pt,Pt,ae),this.distSqLines(ri(ye[0]+.5*St[0],ye[1]+.5*St[1],ye[2]+.5*St[2]),ri(_t[0]-.5*Pt[0],_t[1]-.5*Pt[1],_t[2]-.5*Pt[2]),ri(ye[0]-.5*St[0],ye[1]-.5*St[1],ye[2]-.5*St[2]),ri(_t[0]+.5*Pt[0],_t[1]+.5*Pt[1],_t[2]+.5*Pt[2]))<=.0025000000000000005)continue;const zt=this.vertices.length,Kt=wn(wr(),T,W);this.vertices.push({position:zs(Kt,Kt,.5),height:.5*(E+X),extent:.5*(D+ae)});const Qt=wn(wr(),ce,fe);this.vertexProps.push({dir:As(Qt,Qt)}),this.edges.splice(c,1),this.edgeProps.splice(c,1),this.edges.push({a:g,b:zt}),this.edges.push({a:zt,b:y});const Tt=Nn(wr(),this.vertices[zt].position,T),Wt=es(Tt),ti={vec:Tt,dir:zs(wr(),Tt,1/Wt),len:Wt};this.edgeProps.push(ti),this.edgeProps.push(ti)}}distSqLines(s,c,g,y){const T=Ct(Ht(),c,s),E=Ct(Ht(),y,g),D=Ct(Ht(),s,g),W=si(T,T),X=si(T,E),ae=si(T,D),ce=si(E,E),fe=si(E,D),ye=W*ce-X*X;if(ye===0){const Pt=si(D,E)/si(E,E);return Xi(ui(Ht(),g,y,Pt),s)}const _t=(X*fe-ae*ce)/ye,St=(W*fe-X*ae)/ye;return Xi(ui(Ht(),s,c,_t),ui(Ht(),g,y,St))}}class Wo{static parseFrom(s,c){const g=jn.parse(s);if(!g)return[];let{vertices:y,features:T}=g;const E=1/Ji(c);T.sort((ae,ce)=>ae.id-ce.id),y.sort((ae,ce)=>ae.id-ce.id||ae.idx-ce.idx),y=y.filter((ae,ce,fe)=>ce===fe.findIndex(ye=>ye.id===ae.id&&ye.idx===ae.idx));const D=new Array;let W=0;const X=y.length;for(const ae of T){if(ae.constantHeight){D.push(new Do(ae.id,ae.bounds,ae.constantHeight));continue}for(;W!==X&&y[W].id<ae.id;)W++;if(W===X||y[W].id!==ae.id)continue;const ce=new Array,fe=new Array,ye=W;for(;W!==X&&y[W].id===ae.id;){const _t=y[W];if(ce.push({position:_t.position,height:_t.height,extent:_t.extent}),W!==ye&&y[W-1].idx===_t.idx-1){const St=W-ye;fe.push({a:St-1,b:St})}W++}D.push(new Do(ae.id,ae.bounds,void 0,ce,fe,E))}return D}static getElevationFeature(s,c){if(!c)return;const g=+s.properties[Fn];return Number.isNaN(g)?void 0:c.find(y=>y.id===g)}}class la{constructor(s,c){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(c)||(this.zScale=Math.pow(2,c.z-s.z),this.xOffset=(s.x*this.zScale-c.x)*Fr,this.yOffset=(s.y*this.zScale-c.y)*Fr)}constantElevation(s,c){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,c)}pointElevation(s,c,g){const y=this.constantElevation(c,g);return y??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(s),g))}computeBiasedHeight(s,c){return c<=0?s:s+c*yi(0,c,s>=0?s:Math.abs(.5*s))}}jr(Do,"ElevationFeature");class ea{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new Ia,this.indexArray=new go,this.segments=new Hs,this.programConfigurations=new b(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ya),this.worldview=s.worldview}updateFootprints(s,c){}populate(s,c,g,y){const T=this.layers[0],E=[];let D=null;T.type==="circle"&&(D=T.layout.get("circle-sort-key"));for(const{feature:X,id:ae,index:ce,sourceLayerIndex:fe}of s){const ye=this.layers[0]._featureFilter.needGeometry,_t=Ur(X,ye);if(!this.layers[0]._featureFilter.filter(new ps(this.zoom,{worldview:this.worldview}),_t,g))continue;const St=D?D.evaluate(_t,{},g):void 0,Pt={id:ae,properties:X.properties,type:X.type,sourceLayerIndex:fe,index:ce,geometry:ye?_t.geometry:qr(X,g,y),patterns:{},sortKey:St};E.push(Pt)}D&&E.sort((X,ae)=>X.sortKey-ae.sortKey);let W=null;y.projection.name==="globe"&&(this.globeExtVertexArray=new _h,W=y.projection);for(const X of E){const{geometry:ae,index:ce,sourceLayerIndex:fe}=X,ye=s[ce].feature;this.addFeature(X,ae,ce,c.availableImages,g,W,c.brightness,c.elevationFeatures),c.featureIndex.insert(ye,ae,ce,fe,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(s,c,g,y,T,E,D){this.programConfigurations.updatePaintArrays(s,c,T,g,y,E,D,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ug.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,wh.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,hg.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(s,c,g,y,T,E,D,W){let X;this.elevationMode!=="none"&&(X=Wo.getElevationFeature(s,W));for(const ae of c)for(const ce of ae){const fe=ce.x,ye=ce.y;if(fe<0||fe>=Fr||ye<0||ye>=Fr)continue;if(E){const Pt=E.projectTilePoint(fe,ye,T),zt=E.upVector(T,fe,ye);this.addGlobeExtVertex(Pt,zt),this.addGlobeExtVertex(Pt,zt),this.addGlobeExtVertex(Pt,zt),this.addGlobeExtVertex(Pt,zt)}const _t=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),St=_t.vertexLength;if(this.addCircleVertex(fe,ye,-1,-1),this.addCircleVertex(fe,ye,1,-1),this.addCircleVertex(fe,ye,1,1),this.addCircleVertex(fe,ye,-1,1),this.elevationMode!=="none"){const Pt=X?X.pointElevation(new rr(fe,ye)):0;this.hasElevation=this.hasElevation||Pt!==0;for(let zt=0;zt<4;zt++)this.elevatedLayoutVertexArray.emplaceBack(Pt)}this.indexArray.emplaceBack(St,St+1,St+2),this.indexArray.emplaceBack(St,St+2,St+3),_t.vertexLength+=4,_t.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,{},y,T,D,void 0,this.worldview)}addCircleVertex(s,c,g,y){this.layoutVertexArray.emplaceBack(2*s+(g+1)/2,2*c+(y+1)/2)}addGlobeExtVertex(s,c){this.globeExtVertexArray.emplaceBack(s.x,s.y,s.z,c[0]*16384,c[1]*16384,c[2]*16384)}}function Fo(u,s){for(let c=0;c<u.length;c++)if(_a(s,u[c]))return!0;for(let c=0;c<s.length;c++)if(_a(u,s[c]))return!0;return!!gu(u,s)}function el(u,s,c){return!!_a(u,s)||!!_u(s,u,c)}function ca(u,s){if(u.length===1)return Ch(s,u[0]);for(let c=0;c<s.length;c++){const g=s[c];for(let y=0;y<g.length;y++)if(_a(u,g[y]))return!0}for(let c=0;c<u.length;c++)if(Ch(s,u[c]))return!0;for(let c=0;c<s.length;c++)if(gu(u,s[c]))return!0;return!1}function tl(u,s,c){if(u.length>1){if(gu(u,s))return!0;for(let g=0;g<s.length;g++)if(_u(s[g],u,c))return!0}for(let g=0;g<u.length;g++)if(_u(u[g],s,c))return!0;return!1}function gu(u,s){if(u.length===0||s.length===0)return!1;for(let c=0;c<u.length-1;c++){const g=u[c],y=u[c+1];for(let T=0;T<s.length-1;T++)if(Yf(g,y,s[T],s[T+1]))return!0}return!1}function Yf(u,s,c,g){return ts(u,c,g)!==ts(s,c,g)&&ts(u,s,c)!==ts(u,s,g)}function dc(u,s,c){return(u.x-c.x)*(s.y-c.y)-(u.y-c.y)*(s.x-c.x)}function Kf(u,s,c,g){const y=dc(u,s,g),T=dc(u,s,c);if(Math.sign(y)===Math.sign(T))return;const E=dc(c,g,u),D=E+T-y;return Math.sign(E)!==Math.sign(D)?[E/(E-D),T/(T-y)]:void 0}function _u(u,s,c){const g=c*c;if(s.length===1)return u.distSqr(s[0])<g;for(let y=1;y<s.length;y++)if(Ah(u,s[y-1],s[y])<g)return!0;return!1}function Ah(u,s,c){const g=s.distSqr(c);if(g===0)return u.distSqr(s);const y=((u.x-s.x)*(c.x-s.x)+(u.y-s.y)*(c.y-s.y))/g;return u.distSqr(y<0?s:y>1?c:c.sub(s)._mult(y)._add(s))}function Ch(u,s){let c,g,y,T=!1;for(let E=0;E<u.length;E++){c=u[E];for(let D=0,W=c.length-1;D<c.length;W=D++)g=c[D],y=c[W],g.y>s.y!=y.y>s.y&&s.x<(y.x-g.x)*(s.y-g.y)/(y.y-g.y)+g.x&&(T=!T)}return T}function _a(u,s){let c=!1;for(let g=0,y=u.length-1;g<u.length;y=g++){const T=u[g],E=u[y];T.y>s.y!=E.y>s.y&&s.x<(E.x-T.x)*(s.y-T.y)/(E.y-T.y)+T.x&&(c=!c)}return c}function pc(u,s,c,g,y){for(const E of u)if(s<=E.x&&c<=E.y&&g>=E.x&&y>=E.y)return!0;const T=[new rr(s,c),new rr(s,y),new rr(g,y),new rr(g,c)];if(u.length>2){for(const E of T)if(_a(u,E))return!0}for(let E=0;E<u.length-1;E++)if(Il(u[E],u[E+1],T))return!0;return!1}function Il(u,s,c){const g=c[0],y=c[2];if(u.x<g.x&&s.x<g.x||u.x>y.x&&s.x>y.x||u.y<g.y&&s.y<g.y||u.y>y.y&&s.y>y.y)return!1;const T=ts(u,s,c[0]);return T!==ts(u,s,c[1])||T!==ts(u,s,c[2])||T!==ts(u,s,c[3])}function il(u,s,c,g,y,T){let E=s.y-u.y,D=u.x-s.x;if(T=T||0){const W=E*E+D*D;if(W===0)return!0;const X=Math.sqrt(W);E/=X,D/=X}return!((c.x-u.x)*E+(c.y-u.y)*D-T<0||(g.x-u.x)*E+(g.y-u.y)*D-T<0||(y.x-u.x)*E+(y.y-u.y)*D-T<0)}function dg(u,s,c,g,y,T,E){return!(il(u,s,g,y,T,E)||il(s,c,g,y,T,E)||il(c,u,g,y,T,E)||il(g,y,u,s,c,E)||il(y,T,u,s,c,E)||il(T,g,u,s,c,E))}function Ph(u,s,c){const g=s.paint.get(u).value;return g.kind==="constant"?g.value:c.programConfigurations.get(s.id).getMaxValue(u)}function kp(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function P_(u,s,c,g,y){if(!s[0]&&!s[1])return u;const T=rr.convert(s)._mult(y);c==="viewport"&&T._rotate(-g);const E=[];for(let D=0;D<u.length;D++)E.push(u[D].sub(T));return E}function I_(u,s,c,g){const y=rr.convert(u)._mult(g);return s==="viewport"&&y._rotate(-c),y}let R_,L_;function k_(u,s,c){var g=2*Math.PI*6378137/256/Math.pow(2,c);return[u*g-2*Math.PI*6378137/2,s*g-2*Math.PI*6378137/2]}jr(ea,"CircleBucket",{omit:["layers"]});class yu{constructor(s,c,g){this.z=s,this.x=c,this.y=g,this.key=Ih(0,s,s,c,g)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,c){const g=function(T,E,D){var W=k_(256*T,256*(E=Math.pow(2,D)-E-1),D),X=k_(256*(T+1),256*(E+1),D);return W[0]+","+W[1]+","+X[0]+","+X[1]}(this.x,this.y,this.z),y=function(T,E,D){let W,X="";for(let ae=T;ae>0;ae--)W=1<<ae-1,X+=(E&W?1:0)+(D&W?2:0);return X}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",y).replace("{bbox-epsg-3857}",g)}toString(){return`${this.z}/${this.x}/${this.y}`}}class D_{constructor(s,c){this.wrap=s,this.canonical=c,this.key=Ih(s,c.z,c.z,c.x,c.y)}}class Io{constructor(s,c,g,y,T){this.overscaledZ=s,this.wrap=c,this.canonical=new yu(g,+y,+T),this.key=c===0&&s===g?this.canonical.key:Ih(c,s,g,y,T)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const c=this.canonical.z-s;return s>this.canonical.z?new Io(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Io(s,this.wrap,s,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(s,c=!0){if(this.overscaledZ===s&&c)return this.key;if(s>this.canonical.z)return Ih(this.wrap*+c,s,this.canonical.z,this.canonical.x,this.canonical.y);{const g=this.canonical.z-s;return Ih(this.wrap*+c,s,s,this.canonical.x>>g,this.canonical.y>>g)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const c=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>c&&s.canonical.y===this.canonical.y>>c}children(s){if(this.overscaledZ>=s)return[new Io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,g=2*this.canonical.x,y=2*this.canonical.y;return[new Io(c,this.wrap,c,g,y),new Io(c,this.wrap,c,g+1,y),new Io(c,this.wrap,c,g,y+1),new Io(c,this.wrap,c,g+1,y+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Io(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new D_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ih(u,s,c,g,y){const T=1<<Math.min(c,22);let E=T*(y%T)+g%T;return u&&c<22&&(E+=T*T*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*E+c)+(s-c)}const Ax=[u=>{let s=u.canonical.x-1,c=u.wrap;return s<0&&(s=(1<<u.canonical.z)-1,c--),new Io(u.overscaledZ,c,u.canonical.z,s,u.canonical.y)},u=>{let s=u.canonical.x+1,c=u.wrap;return s===1<<u.canonical.z&&(s=0,c++),new Io(u.overscaledZ,c,u.canonical.z,s,u.canonical.y)},u=>new Io(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new Io(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];jr(yu,"CanonicalTileID"),jr(Io,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Cx=Zn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dp}=Cx,Px=Zn([{name:"a_pos_3",components:3,type:"Int16"}]);var F_=Zn([{name:"a_pos",type:"Int16",components:2}]);function Fp(u){return u*H/Ot}const Ix=[new Yn([pt,pt,pt],[vt,vt,vt]),new Yn([pt,pt,pt],[0,0,vt]),new Yn([0,pt,pt],[vt,0,vt]),new Yn([pt,0,pt],[0,vt,vt]),new Yn([0,0,pt],[vt,vt,vt])];function O_(u,s,c,g=!0){const y=jt([],u._camera.position,u.worldSize),T=[s,c,1,1];Hi(T,T,u.pixelMatrixInverse),Rt(T,T,1/T[3]);const E=nr([],kt([],T,y)),D=u.globeMatrix,W=[D[12],D[13],D[14]],X=kt([],W,y),ae=Yt(X),ce=nr([],X),fe=u.worldSize/(2*Math.PI),ye=si(ce,E),_t=Math.asin(fe/ae);if(_t<Math.acos(ye)){if(!g)return null;const Di=[],Vi=[];jt(Di,E,ae/ye),nr(Vi,kt(Vi,Di,X)),nr(E,ei(E,X,jt(E,Vi,Math.tan(_t)*ae)))}const St=[];new Ps(y,E).closestPointOnSphere(W,fe,St);const Pt=nr([],bs(D,0)),zt=nr([],bs(D,1)),Kt=nr([],bs(D,2)),Qt=si(Pt,St),Tt=si(zt,St),Wt=si(Kt,St),ti=ii(Math.asin(-Tt/fe));let ci=ii(Math.atan2(Qt,Wt));ci=u.center.lng+function(Di,Vi){const Qi=(Vi-Di+180)%360-180;return Qi<-180?Qi+360:Qi}(u.center.lng,ci);const ki=vi(ci),Ci=Jt(di(ti),0,1);return new zi(ki,Ci)}class Rx{constructor(s,c,g){this.a=kt([],s,g),this.b=kt([],c,g),this.center=g;const y=nr([],this.a),T=nr([],this.b);this.angle=Math.acos(si(y,T))}}function pg(u,s){if(u.angle===0)return null;let c;return c=u.a[s]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[s]/u.a[s]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(g,y,T,E){const D=Math.sin(T);return g*(Math.sin((1-E)*T)/D)+y*(Math.sin(E*T)/D)}(u.a[s],u.b[s],u.angle,Jt(c,0,1))+u.center[s]}function rl(u){if(u.z<=1)return Ix[u.z+2*u.y+u.x];const s=mg(Op(u));return Yn.fromPoints(s)}function Rl(u,s,c){return jt(u,u,1-c),mi(u,u,s,c)}function z_(u,s,c){for(const g of u)oi(g,g,s),jt(g,g,c)}function B_(u,s,c,g){const y=s/u.worldSize,T=u.globeMatrix;if(c.z<=1){const Ci=rl(c).getCorners();return z_(Ci,T,y),Yn.fromPoints(Ci)}const E=Op(c,g),D=mg(E,H+Fp(u._tileCoverLift));z_(D,T,y);const W=Number.MAX_VALUE,X=[-W,-W,-W],ae=[W,W,W];if(E.contains(u.center)){for(const Vi of D)Mt(ae,ae,Vi),$t(X,X,Vi);X[2]=0;const Ci=u.point,Di=[Ci.x*y,Ci.y*y,0];return Mt(ae,ae,Di),$t(X,X,Di),new Yn(ae,X)}if(u._tileCoverLift>0){for(const Ci of D)Mt(ae,ae,Ci),$t(X,X,Ci);return new Yn(ae,X)}const ce=[T[12]*y,T[13]*y,T[14]*y],fe=E.getCenter(),ye=Jt(u.center.lat,-85.051129,or),_t=Jt(fe.lat,-85.051129,or),St=vi(u.center.lng),Pt=di(ye);let zt=St-vi(fe.lng);const Kt=Pt-di(_t);zt>.5?zt-=1:zt<-.5&&(zt+=1);let Qt=0;Math.abs(zt)>Math.abs(Kt)?Qt=zt>=0?1:3:(Qt=Kt>=0?0:2,mi(ce,ce,[T[4]*y,T[5]*y,T[6]*y],-Math.sin(Ai(Kt>=0?E.getSouth():E.getNorth()))*H));const Tt=D[Qt],Wt=D[(Qt+1)%4],ti=new Rx(Tt,Wt,ce),ci=[pg(ti,0)||Tt[0],pg(ti,1)||Tt[1],pg(ti,2)||Tt[2]],ki=mc(u.zoom);if(ki>0){const Ci=function({x:Vi,y:Qi,z:br},hr,xr,Sr,tr){const yr=1/(1<<br);let Yi=Vi*yr,er=Yi+yr,Cr=Qi*yr,Lr=Cr+yr,an=0;const Yr=(Yi+er)/2-Sr;return Yr>.5?an=-1:Yr<-.5&&(an=1),Yi=((Yi+an)*hr-(Sr*=hr))*xr+Sr,er=((er+an)*hr-Sr)*xr+Sr,Cr=(Cr*hr-(tr*=hr))*xr+tr,Lr=(Lr*hr-tr)*xr+tr,[[Yi,Lr,0],[er,Lr,0],[er,Cr,0],[Yi,Cr,0]]}(c,s,u._pixelsPerMercatorPixel,St,Pt);for(let Vi=0;Vi<D.length;Vi++)Rl(D[Vi],Ci[Vi],ki);const Di=ei([],Ci[Qt],Ci[(Qt+1)%4]);jt(Di,Di,.5),Rl(ci,Di,ki)}for(const Ci of D)Mt(ae,ae,Ci),$t(X,X,Ci);return ae[2]=Math.min(Tt[2],Wt[2]),Mt(ae,ae,ci),$t(X,X,ci),new Yn(ae,X)}function Op({x:u,y:s,z:c},g=!1){const y=1/(1<<c),T=new qt(Pi(u*y),s===(1<<c)-1&&g?-90:ji((s+1)*y)),E=new qt(Pi((u+1)*y),s===0&&g?90:ji(s*y));return new li(T,E)}function mg(u,s=H){const c=Ai(u.getNorth()),g=Ai(u.getSouth()),y=Math.cos(c),T=Math.cos(g),E=Math.sin(c),D=Math.sin(g),W=u.getWest(),X=u.getEast();return[Dt(T,D,W,s),Dt(T,D,X,s),Dt(y,E,X,s),Dt(y,E,W,s)]}function Jf(u,s,c,g){const y=1<<c.z,T=(u/Fr+c.x)/y;return At(ji((s/Fr+c.y)/y),Pi(T),g)}function zp({min:u,max:s}){return de/Math.max(s[0]-u[0],s[1]-u[1],s[2]-u[2])}const N_=new Float64Array(16);function Bp(u){const s=zp(u),c=xt(N_,[s,s,s]);return se(c,c,Ir([],u.min))}function gg(u){const s=(g=u.min,(c=N_)[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=g[0],c[13]=g[1],c[14]=g[2],c[15]=1,c);var c,g;const y=1/zp(u);return le(s,s,[y,y,y])}function _g(u){const s=Fr/(2*Math.PI);return u/(2*Math.PI)/s}function V_(u,s){return Fr/(512*Math.pow(2,u))*zp(rl(s))}function $_(u,s,c,g,y){const T=_g(c),E=[u,s,-c/(2*Math.PI)],D=ie(new Float64Array(16));return se(D,D,E),le(D,D,[T,T,T]),he(D,D,Ai(-y)),me(D,D,Ai(-g)),D}function mc(u){return yi(Q,oe,u)}function U_(u,s){const c=At(s.lat,s.lng),g=function(_t){const St=At(_t._center.lat,_t._center.lng);let Pt=Gt([],ri(0,1,0),St);const zt=Et([],-_t.angle,St);Pt=oi(Pt,Pt,zt),Et(zt,-_t._pitch,Pt);const Kt=nr([],St);return jt(Kt,Kt,Fp(_t.cameraToCenterDistance/_t.pixelsPerMeter)),oi(Kt,Kt,zt),ei([],St,Kt)}(u);return E=(y=Ct([],g,c))[0],D=y[1],W=y[2],X=(T=c)[0],ae=T[1],ce=T[2],ye=(fe=Math.sqrt(E*E+D*D+W*W)*Math.sqrt(X*X+ae*ae+ce*ce))&&si(y,T)/fe,Math.acos(Math.min(Math.max(ye,-1),1));var y,T,E,D,W,X,ae,ce,fe,ye}function yg(u,s){return U_(u,s)>Math.PI/2*1.01}const G_=Ai(85),Lx=Math.cos(G_),kx=Math.sin(G_),Dx=Y(),H_=u=>{const s=[];return u.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function j_(u,s,c,g,y,T,E,D,W){if(T&&u.queryGeometry.isAboveHorizon)return!1;T&&(W*=u.pixelToTileUnitsFactor);const X=u.tileID.canonical,ae=c.projection.upVectorScale(X,c.center.lat,c.worldSize).metersToTile;for(const ce of s)for(const fe of ce){const ye=fe.add(D),_t=y&&c.elevation?c.elevation.exaggeration()*y.getElevationAt(ye.x,ye.y,!0):0,St=c.projection.projectTilePoint(ye.x,ye.y,X);if(_t>0){const Qt=c.projection.upVector(X,ye.x,ye.y);St.x+=Qt[0]*ae*_t,St.y+=Qt[1]*ae*_t,St.z+=Qt[2]*ae*_t}const Pt=T?ye:Fx(St.x,St.y,St.z,g),zt=T?u.tilespaceRays.map(Qt=>zx(Qt,_t)):u.queryGeometry.screenGeometry,Kt=Hi([],[St.x,St.y,St.z,1],g);if(!E&&T?W*=Kt[3]/c.cameraToCenterDistance:E&&!T&&(W*=c.cameraToCenterDistance/Kt[3]),T){const Qt=ji((fe.y/Fr+X.y)/(1<<X.z));W/=c.projection.pixelsPerMeter(Qt,1)/Ei(1,Qt)}if(el(zt,Pt,W))return!0}return!1}function Fx(u,s,c,g){const y=Hi([],[u,s,c,1],g);return new rr(y[0]/y[3],y[1]/y[3])}const W_=ri(0,0,0),Ox=ri(0,0,1);function zx(u,s){const c=Ht();return W_[2]=s,u.intersectsPlane(W_,Ox,c),new rr(c[0],c[1])}class q_ extends ea{}let X_,Z_,Y_,K_;function J_(u,{width:s,height:c},g,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==s*c*g)throw new RangeError("mismatched image size")}else y=new Uint8Array(s*c*g);return u.width=s,u.height=c,u.data=y,u}function Q_(u,s,c){const{width:g,height:y}=s;g===u.width&&y===u.height||(vg(u,s,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,g),height:Math.min(u.height,y)},c,null),u.width=g,u.height=y,u.data=s.data)}function vg(u,s,c,g,y,T,E,D){if(y.width===0||y.height===0)return s;if(y.width>u.width||y.height>u.height||c.x>u.width-y.width||c.y>u.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>s.width||y.height>s.height||g.x>s.width-y.width||g.y>s.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const W=u.data,X=s.data,ae=T===4&&D;for(let ce=0;ce<y.height;ce++){const fe=((c.y+ce)*u.width+c.x)*T,ye=((g.y+ce)*s.width+g.x)*T;if(ae)for(let _t=0;_t<y.width;_t++){const St=fe+_t*T+3,Pt=ye+_t*T;X[Pt+0]=255,X[Pt+1]=255,X[Pt+2]=255,X[Pt+3]=W[St]}else if(E)for(let _t=0;_t<y.width;_t++){const St=fe+_t*T,Pt=ye+_t*T,zt=new rs(W[St+0]/255,W[St+1]/255,W[St+2]/255,W[St+3]).toNonPremultipliedRenderColor(E).toArray();X[Pt+0]=zt[0],X[Pt+1]=zt[1],X[Pt+2]=zt[2],X[Pt+3]=zt[3]}else for(let _t=0;_t<y.width*T;_t++)X[ye+_t]=W[fe+_t]}return s}jr(q_,"HeatmapBucket",{omit:["layers"]});class gc{constructor(s,c){J_(this,s,1,c)}resize(s){Q_(this,new gc(s),1)}clone(){return new gc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,c,g,y,T){vg(s,c,g,y,T,1,null)}}class vo{constructor(s,c){J_(this,s,4,c)}resize(s){Q_(this,new vo(s),4)}replace(s,c){c?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new vo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,c,g,y,T,E,D){vg(s,c,g,y,T,4,E,D)}}class ey{constructor(s,c){this.width=s.width,this.height=s.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function Qf(u){const s={},c=u.resolution||256,g=u.clips?u.clips.length:1,y=u.image||new vo({width:c,height:g}),T=(E,D,W)=>{s[u.evaluationKey]=W;const X=u.expression.evaluate(s),ae=X?X.toNonPremultipliedRenderColor(null):null;ae&&(y.data[E+D+0]=Math.floor(255*ae.r),y.data[E+D+1]=Math.floor(255*ae.g),y.data[E+D+2]=Math.floor(255*ae.b),y.data[E+D+3]=Math.floor(255*ae.a))};if(u.clips)for(let E=0,D=0;E<g;++E,D+=4*c)for(let W=0,X=0;W<c;W++,X+=4){const ae=W/(c-1),{start:ce,end:fe}=u.clips[E];T(D,X,ce*(1-ae)+fe*ae)}else for(let E=0,D=0;E<c;E++,D+=4)T(0,D,E/(c-1));return y}jr(gc,"AlphaImage"),jr(vo,"RGBAImage");const Bx=Zn([{name:"a_pos",components:2,type:"Int16"}],4),Nx=Zn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Vx=Zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),$x=Zn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function ed(u,s,c=2){const g=s&&s.length,y=g?s[0]*c:u.length;let T=ty(u,0,y,c,!0);const E=[];if(!T||T.next===T.prev)return E;let D,W,X;if(g&&(T=function(ae,ce,fe,ye){const _t=[];for(let St=0,Pt=ce.length;St<Pt;St++){const zt=ty(ae,ce[St]*ye,St<Pt-1?ce[St+1]*ye:ae.length,ye,!1);zt===zt.next&&(zt.steiner=!0),_t.push(Zx(zt))}_t.sort(Wx);for(let St=0;St<_t.length;St++)fe=qx(_t[St],fe);return fe}(u,s,T,c)),u.length>80*c){D=1/0,W=1/0;let ae=-1/0,ce=-1/0;for(let fe=c;fe<y;fe+=c){const ye=u[fe],_t=u[fe+1];ye<D&&(D=ye),_t<W&&(W=_t),ye>ae&&(ae=ye),_t>ce&&(ce=_t)}X=Math.max(ae-D,ce-W),X=X!==0?32767/X:0}return td(T,E,c,D,W,X,0),E}function ty(u,s,c,g,y){let T;if(y===function(E,D,W,X){let ae=0;for(let ce=D,fe=W-X;ce<W;ce+=X)ae+=(E[fe]-E[ce])*(E[ce+1]+E[fe+1]),fe=ce;return ae}(u,s,c,g)>0)for(let E=s;E<c;E+=g)T=sy(E/g|0,u[E],u[E+1],T);else for(let E=c-g;E>=s;E-=g)T=sy(E/g|0,u[E],u[E+1],T);return T&&Rh(T,T.next)&&(nd(T),T=T.next),T}function vu(u,s){if(!u)return u;s||(s=u);let c,g=u;do if(c=!1,g.steiner||!Rh(g,g.next)&&co(g.prev,g,g.next)!==0)g=g.next;else{if(nd(g),g=s=g.prev,g===g.next)break;c=!0}while(c||g!==s);return s}function td(u,s,c,g,y,T,E){if(!u)return;!E&&T&&function(W,X,ae,ce){let fe=W;do fe.z===0&&(fe.z=xg(fe.x,fe.y,X,ae,ce)),fe.prevZ=fe.prev,fe.nextZ=fe.next,fe=fe.next;while(fe!==W);fe.prevZ.nextZ=null,fe.prevZ=null,function(ye){let _t,St=1;do{let Pt,zt=ye;ye=null;let Kt=null;for(_t=0;zt;){_t++;let Qt=zt,Tt=0;for(let ti=0;ti<St&&(Tt++,Qt=Qt.nextZ,Qt);ti++);let Wt=St;for(;Tt>0||Wt>0&&Qt;)Tt!==0&&(Wt===0||!Qt||zt.z<=Qt.z)?(Pt=zt,zt=zt.nextZ,Tt--):(Pt=Qt,Qt=Qt.nextZ,Wt--),Kt?Kt.nextZ=Pt:ye=Pt,Pt.prevZ=Kt,Kt=Pt;zt=Qt}Kt.nextZ=null,St*=2}while(_t>1)}(fe)}(u,g,y,T);let D=u;for(;u.prev!==u.next;){const W=u.prev,X=u.next;if(T?Gx(u,g,y,T):Ux(u))s.push(W.i,u.i,X.i),nd(u),u=X.next,D=X.next;else if((u=X)===D){E?E===1?td(u=Hx(vu(u),s),s,c,g,y,T,2):E===2&&jx(u,s,c,g,y,T):td(vu(u),s,c,g,y,T,1);break}}}function Ux(u){const s=u.prev,c=u,g=u.next;if(co(s,c,g)>=0)return!1;const y=s.x,T=c.x,E=g.x,D=s.y,W=c.y,X=g.y,ae=Math.min(y,T,E),ce=Math.min(D,W,X),fe=Math.max(y,T,E),ye=Math.max(D,W,X);let _t=g.next;for(;_t!==s;){if(_t.x>=ae&&_t.x<=fe&&_t.y>=ce&&_t.y<=ye&&id(y,D,T,W,E,X,_t.x,_t.y)&&co(_t.prev,_t,_t.next)>=0)return!1;_t=_t.next}return!0}function Gx(u,s,c,g){const y=u.prev,T=u,E=u.next;if(co(y,T,E)>=0)return!1;const D=y.x,W=T.x,X=E.x,ae=y.y,ce=T.y,fe=E.y,ye=Math.min(D,W,X),_t=Math.min(ae,ce,fe),St=Math.max(D,W,X),Pt=Math.max(ae,ce,fe),zt=xg(ye,_t,s,c,g),Kt=xg(St,Pt,s,c,g);let Qt=u.prevZ,Tt=u.nextZ;for(;Qt&&Qt.z>=zt&&Tt&&Tt.z<=Kt;){if(Qt.x>=ye&&Qt.x<=St&&Qt.y>=_t&&Qt.y<=Pt&&Qt!==y&&Qt!==E&&id(D,ae,W,ce,X,fe,Qt.x,Qt.y)&&co(Qt.prev,Qt,Qt.next)>=0||(Qt=Qt.prevZ,Tt.x>=ye&&Tt.x<=St&&Tt.y>=_t&&Tt.y<=Pt&&Tt!==y&&Tt!==E&&id(D,ae,W,ce,X,fe,Tt.x,Tt.y)&&co(Tt.prev,Tt,Tt.next)>=0))return!1;Tt=Tt.nextZ}for(;Qt&&Qt.z>=zt;){if(Qt.x>=ye&&Qt.x<=St&&Qt.y>=_t&&Qt.y<=Pt&&Qt!==y&&Qt!==E&&id(D,ae,W,ce,X,fe,Qt.x,Qt.y)&&co(Qt.prev,Qt,Qt.next)>=0)return!1;Qt=Qt.prevZ}for(;Tt&&Tt.z<=Kt;){if(Tt.x>=ye&&Tt.x<=St&&Tt.y>=_t&&Tt.y<=Pt&&Tt!==y&&Tt!==E&&id(D,ae,W,ce,X,fe,Tt.x,Tt.y)&&co(Tt.prev,Tt,Tt.next)>=0)return!1;Tt=Tt.nextZ}return!0}function Hx(u,s){let c=u;do{const g=c.prev,y=c.next.next;!Rh(g,y)&&ry(g,c,c.next,y)&&rd(g,y)&&rd(y,g)&&(s.push(g.i,c.i,y.i),nd(c),nd(c.next),c=u=y),c=c.next}while(c!==u);return vu(c)}function jx(u,s,c,g,y,T){let E=u;do{let D=E.next.next;for(;D!==E.prev;){if(E.i!==D.i&&Yx(E,D)){let W=ny(E,D);return E=vu(E,E.next),W=vu(W,W.next),td(E,s,c,g,y,T,0),void td(W,s,c,g,y,T,0)}D=D.next}E=E.next}while(E!==u)}function Wx(u,s){let c=u.x-s.x;return c===0&&(c=u.y-s.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(s.next.y-s.y)/(s.next.x-s.x)),c}function qx(u,s){const c=function(y,T){let E=T;const D=y.x,W=y.y;let X,ae=-1/0;if(Rh(y,E))return E;do{if(Rh(y,E.next))return E.next;if(W<=E.y&&W>=E.next.y&&E.next.y!==E.y){const St=E.x+(W-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(St<=D&&St>ae&&(ae=St,X=E.x<E.next.x?E:E.next,St===D))return X}E=E.next}while(E!==T);if(!X)return null;const ce=X,fe=X.x,ye=X.y;let _t=1/0;E=X;do{if(D>=E.x&&E.x>=fe&&D!==E.x&&iy(W<ye?D:ae,W,fe,ye,W<ye?ae:D,W,E.x,E.y)){const St=Math.abs(W-E.y)/(D-E.x);rd(E,y)&&(St<_t||St===_t&&(E.x>X.x||E.x===X.x&&Xx(X,E)))&&(X=E,_t=St)}E=E.next}while(E!==ce);return X}(u,s);if(!c)return s;const g=ny(c,u);return vu(g,g.next),vu(c,c.next)}function Xx(u,s){return co(u.prev,u,s.prev)<0&&co(s.next,u,u.next)<0}function xg(u,s,c,g,y){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*y|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-g)*y|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Zx(u){let s=u,c=u;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==u);return c}function iy(u,s,c,g,y,T,E,D){return(y-E)*(s-D)>=(u-E)*(T-D)&&(u-E)*(g-D)>=(c-E)*(s-D)&&(c-E)*(T-D)>=(y-E)*(g-D)}function id(u,s,c,g,y,T,E,D){return!(u===E&&s===D)&&iy(u,s,c,g,y,T,E,D)}function Yx(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(c,g){let y=c;do{if(y.i!==c.i&&y.next.i!==c.i&&y.i!==g.i&&y.next.i!==g.i&&ry(y,y.next,c,g))return!0;y=y.next}while(y!==c);return!1}(u,s)&&(rd(u,s)&&rd(s,u)&&function(c,g){let y=c,T=!1;const E=(c.x+g.x)/2,D=(c.y+g.y)/2;do y.y>D!=y.next.y>D&&y.next.y!==y.y&&E<(y.next.x-y.x)*(D-y.y)/(y.next.y-y.y)+y.x&&(T=!T),y=y.next;while(y!==c);return T}(u,s)&&(co(u.prev,u,s.prev)||co(u,s.prev,s))||Rh(u,s)&&co(u.prev,u,u.next)>0&&co(s.prev,s,s.next)>0)}function co(u,s,c){return(s.y-u.y)*(c.x-s.x)-(s.x-u.x)*(c.y-s.y)}function Rh(u,s){return u.x===s.x&&u.y===s.y}function ry(u,s,c,g){const y=Vp(co(u,s,c)),T=Vp(co(u,s,g)),E=Vp(co(c,g,u)),D=Vp(co(c,g,s));return y!==T&&E!==D||!(y!==0||!Np(u,c,s))||!(T!==0||!Np(u,g,s))||!(E!==0||!Np(c,u,g))||!(D!==0||!Np(c,s,g))}function Np(u,s,c){return s.x<=Math.max(u.x,c.x)&&s.x>=Math.min(u.x,c.x)&&s.y<=Math.max(u.y,c.y)&&s.y>=Math.min(u.y,c.y)}function Vp(u){return u>0?1:u<0?-1:0}function rd(u,s){return co(u.prev,u,u.next)<0?co(u,s,u.next)>=0&&co(u,u.prev,s)>=0:co(u,s,u.prev)<0||co(u,u.next,s)<0}function ny(u,s){const c=bg(u.i,u.x,u.y),g=bg(s.i,s.x,s.y),y=u.next,T=s.prev;return u.next=s,s.prev=u,c.next=y,y.prev=c,g.next=c,c.prev=g,T.next=g,g.prev=T,g}function sy(u,s,c,g){const y=bg(u,s,c);return g?(y.next=g.next,y.prev=g,g.next.prev=y,g.next=y):(y.prev=y,y.next=y),y}function nd(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function bg(u,s,c){return{i:u,x:s,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $p(u,s){const c=u.length;if(c<=1)return[u];const g=[];let y,T;for(let E=0;E<c;E++){const D=Hn(u[E]);D!==0&&(u[E].area=Math.abs(D),T===void 0&&(T=D<0),T===D<0?(y&&g.push(y),y=[u[E]]):y.push(u[E]))}if(y&&g.push(y),s>1)for(let E=0;E<g.length;E++)g[E].length<=s||(wo(g[E],s,1,g[E].length-1,Kx),g[E]=g[E].slice(0,s));return g}function Kx(u,s){return s.area-u.area}function oy(u,s,c=1){if(!u)return null;const g=typeof u=="string"?ko.from(u).getPrimary():u.getPrimary(),y=typeof u=="string"?null:u.getSecondary();for(const T of[g,y]){if(!T)continue;const E=T.id.toString();s.has(E)||s.set(E,[]),T.scaleSelf(c),s.get(E).push(T)}return{primary:g.toString(),secondary:y?y.toString():null}}function wg(u,s,c,g){const y=g.patternDependencies;let T=!1;for(const E of s){const D=E.paint.get(`${u}-pattern`);D.isConstant()||(T=!0),oy(D.constantOr(null),y,c)&&(T=!0)}return T}function Sg(u,s,c,g,y,T){const E=T.patternDependencies;for(const D of s){const W=D.paint.get(`${u}-pattern`).value;if(W.kind!=="constant"){let X=W.evaluate({zoom:g},c,{},T.availableImages);X=X&&X.name?X.name:X;const ae=oy(X,E,y);if(!ae)continue;const{primary:ce,secondary:fe}=ae;ce&&(c.patterns[D.id]=[ce,fe].filter(Boolean))}}return c}class ay{constructor(){this.polygons=new Map}add(s,...c){this.polygons.has(s)?this.polygons.get(s).push(...c):this.polygons.set(s,c)}merge(s){for(const[c,g]of s.polygons)this.add(c,...g)}}class xu{constructor(){this.portals=[]}static evaluate(s){if(s.length===0)return new xu;let c=[];for(const X of s)c.push(...X.portals);if(c.length===0)return new xu;const g=(X,ae)=>X<=0&&ae<=0||X>=Fr&&ae>=Fr;for(const X of c){const ae=X.va,ce=X.vb;(g(ae.x,ce.x)||g(ae.y,ce.y))&&(X.type="border")}const y=c.filter(X=>X.type!=="unevaluated"),T=c.filter(X=>X.type==="unevaluated");if(T.length===0)return new xu;T.sort((X,ae)=>X.hash===ae.hash?X.isTunnel===ae.isTunnel?0:X.isTunnel?-1:1:X.hash<ae.hash?1:-1),c=y.concat(T);let E=y.length,D=E,W=E;do if(D++,D===c.length||c[E].hash!==c[D].hash){if(D-E==2){W<E&&(c[W]=c[E],c[E]=null);const X=c[W],ae=c[D-1];X.type=X.isTunnel!==ae.isTunnel?"tunnel":"polygon",X.connection={a:X.connection.a,b:ae.connection.a},W++}E=D}while(E!==c.length);return c.splice(W),c.sort((X,ae)=>X.hash<ae.hash?1:-1),{portals:c}}}jr(xu,"ElevationPortalGraph"),jr(ay,"ElevationPolygons");class Jx{constructor(s,c,g){this.outPositions=s,this.outNormals=c,this.outIndices=g,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(s,c,g){let y=s[2];g!=null&&(y*=g);const T=this.getVec3Bits(s)<<96n|this.getVec3Bits(c),E=this.vertexLookup.get(T);if(E!=null)return E;const D=this.outPositions.length;this.vertexLookup.set(T,D);const W=Math.trunc(16384*c[0]),X=Math.trunc(16384*c[1]),ae=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(s[0],s[1],y),this.outNormals.emplaceBack(W,X,ae),D}addVertices(s,c,...g){const y=[];for(const T of g){const E=this.addVertex(T,s,c);y.push(E)}return y}addTriangles(s,c,g){if(c&&g){const y=g.length===1,T=ri(0,0,0);for(let E=0;E<s.length;E+=3){const D=c[s[E+0]],W=c[s[E+1]],X=c[s[E+2]],ae=y?g[0]:g[s[E+1]],ce=y?g[0]:g[s[E+2]],fe=this.addVertex(ri(D.x,D.y,y?g[0]:g[s[E+0]]),T),ye=this.addVertex(ri(W.x,W.y,ae),T),_t=this.addVertex(ri(X.x,X.y,ce),T);this.outIndices.emplaceBack(fe,ye,_t)}}else for(let y=0;y<s.length;y+=3)this.outIndices.emplaceBack(s[y+0],s[y+1],s[y+2])}addQuad(s,c){const g=this.addVertices(c,void 0,...s.map(W=>ri(W.coord.x,W.coord.y,W.height))),[y,T,E,D]=g;this.addTriangles([y,T,E,E,D,y])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(s){return this.view.setFloat32(0,s),BigInt(this.view.getUint32(0))}getVec3Bits(s){return this.getBits(s[0])<<64n|this.getBits(s[1])<<32n|this.getBits(s[2])}}class ta{constructor(s,c,g,y){this.unevaluatedPortals=new xu,this.portalPolygons=new ay,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Of,this.vertexNormals=new gh,this.indexArray=new go,this.tileToMeters=Ji(s),this.bridgeProgramConfigurations=new b(c,{zoom:g,lut:y},T=>T!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new b(c,{zoom:g,lut:y},T=>T!=="fill-bridge-guard-rail-color")}addVertices(s,c){const g=this.unevalVertices.length;for(let y=0;y<s.length;y++)this.unevalVertices.push(s[y]),this.unevalHeights.push(c[y]);return g}addTriangles(s,c,g){const y=g?this.unevalTunnelTriangles:this.unevalTriangles;for(const T of s)y.push(T+c)}addRenderableRing(s,c,g,y,T,E){const D=[new rr(T.min.x,T.min.y),new rr(T.max.x,T.min.y),new rr(T.max.x,T.max.y),new rr(T.min.x,T.max.y)];for(let W=0;W<g-1;W++){const X=c+W,ae=X+1,ce=this.unevalVertices[X],fe=this.unevalVertices[ae];if(!(ce.x>=T.min.x&&ce.x<=T.max.x&&ce.y>=T.min.y&&ce.y<=T.max.y||fe.x>=T.min.x&&fe.x<=T.max.x&&fe.y>=T.min.y&&fe.y<=T.max.y||Il(ce,fe,D))||this.isOnBorder(ce.x,fe.x)||this.isOnBorder(ce.y,fe.y))continue;const ye=ta.computeEdgeHash(this.unevalVertices[X],this.unevalVertices[ae]);let _t,St=this.vertexHashLookup.get(ta.computePosHash(ce));St!=null?_t=St.next:(St=this.vertexHashLookup.get(ta.computePosHash(fe)),_t=St!=null?St.prev:ye),this.unevalEdges.push({polygonIdx:s,a:X,b:ae,hash:ye,portalHash:_t,isTunnel:y,type:"unevaluated",featureInfo:E})}}addPortalCandidates(s,c,g,y,T){if(c.length===0)return;this.portalPolygons.add(s,{geometry:c,zLevel:T});const E=c[0];this.vertexHashLookup.clear();let D=ta.computeEdgeHash(E[E.length-2],E[E.length-1]);for(let W=0;W<E.length-1;W++){const X=E[W+0],ae=E[W+1],ce=Vr(ae.x-X.x,ae.y-X.y),fe=es(ce);if(fe===0)continue;let ye="unevaluated";const _t=y.pointElevation(X),St=y.pointElevation(ae);Math.abs(_t)<.01&&Math.abs(St)<.01?ye="entrance":(this.isOnBorder(X.x,ae.x)||this.isOnBorder(X.y,ae.y))&&(ye="border");const Pt=ta.computeEdgeHash(X,ae);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:X,vb:ae,vab:ce,length:fe,hash:Pt,isTunnel:g,type:ye});const zt=ta.computePosHash(X);this.vertexHashLookup.set(zt,{prev:D,next:Pt}),D=Pt}}construct(s){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),g=fe=>{fe.primitiveLength=this.indexArray.length-fe.primitiveOffset},y=new Jx(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const T=c(),E=c(),D=c(),W=(fe,ye)=>{fe.sort((St,Pt)=>St.type===ye&&Pt.type!==ye?-1:St.type!==ye&&Pt.type===ye?1:0);const _t=fe.findIndex(St=>St.type!==ye);return _t>=0?_t:fe.length};let X=0;this.unevalEdges.length>0&&(X=W(this.unevalEdges,"none"),this.constructBridgeStructures(y,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:X},this.tileToMeters)),g(D);const ae=c(),ce=c();if(this.unevalEdges.length>0){const fe=this.unevalEdges.splice(X),ye=W(fe,"tunnel")+X;this.unevalEdges.push(...fe),this.constructTunnelStructures(y,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:X},{min:X,max:ye})}g(ae),y.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),g(ce),y.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),g(E),y.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),g(T),this.maskSegments=Hs.simpleSegment(0,ce.primitiveOffset,0,ce.primitiveLength),this.depthSegments=Hs.simpleSegment(0,E.primitiveOffset,0,E.primitiveLength),this.renderableBridgeSegments=Hs.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.renderableTunnelSegments=Hs.simpleSegment(0,ae.primitiveOffset,0,ae.primitiveLength),this.shadowCasterSegments=Hs.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength)}update(s,c,g,y,T,E,D,W){this.bridgeProgramConfigurations.updatePaintArrays(s,c,T,g,y,E,D,W),this.tunnelProgramConfigurations.updatePaintArrays(s,c,T,g,y,E,D,W)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,Vx.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,$x.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(s),this.tunnelProgramConfigurations.upload(s))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(s,c,g,y,T){const E=(D,W)=>{for(let X=0;X<W.length-1;X++){const ae=W[X].featureIndex,ce=W[X+1].vertexStart,fe=s.feature(ae);D.populatePaintArrays(ce,fe,ae,{},g,c,y,void 0,T)}};E(this.bridgeProgramConfigurations,this.bridgeFeatureSections),E(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(s,c,g,y,T){const E=new Map;for(let D=y;D<T;D++){const W=g[D],X=W.a,ae=W.b,ce=ta.computePosHash(s[X]),fe=ta.computePosHash(s[ae]);E.has(ce)||E.set(ce,{}),E.has(fe)||E.set(fe,{});const ye=E.get(ce),_t=E.get(fe);c[X]<=0&&c[ae]<=0||(ye.to=ae,_t.from=X)}return E}constructBridgeStructures(s,c,g,y,T,E){s.clearVertexLookup();const D=this.computeVertexConnections(c,g,y,T.min,T.max),W=1/E,X=.5*W,ae=ye=>ri(c[ye].x,c[ye].y,g[ye]*W),ce=ye=>{const _t=D.get(ta.computePosHash(c[ye])),St=_t.from,Pt=_t.to;if(!St||!Pt)return;const zt=ae(St),Kt=ae(ye),Qt=ae(Pt),Tt=ri(0,0,0);if(!Mi(zt,Kt)){const ti=kt(Ht(),Kt,zt);ei(Tt,Tt,nr(ti,ti))}if(!Mi(Qt,Kt)){const ti=kt(Ht(),Qt,Kt);ei(Tt,Tt,nr(ti,ti))}const Wt=gi(Tt);return Wt>0?jt(Tt,Tt,1/Wt):void 0};let fe=Number.POSITIVE_INFINITY;this.sortSubarray(y,T.min,T.max,(ye,_t)=>ye.featureInfo.featureIndex-_t.featureInfo.featureIndex);for(let ye=T.min;ye<T.max;ye++){const _t=y[ye];if(!_t.featureInfo.guardRailEnabled)continue;const St=this.prepareEdgePoints(c,g,_t,(vn,Zr)=>vn>Zr);if(St==null)continue;const Pt=St[0],zt=St[1],Kt=ri(Pt.coord.x,Pt.coord.y,W*Pt.height),Qt=ri(zt.coord.x,zt.coord.y,W*zt.height);if(Mi(Kt,Qt))continue;const Tt=kt(Ht(),Qt,Kt);nr(Tt,Tt);const Wt=vn=>nr(vn,vn),ti=ce(_t.a)||Tt,ci=ce(_t.b)||Tt,ki=Wt(ri(ti[1],-ti[0],0)),Ci=Wt(ri(ci[1],-ci[0],0)),Di=Wt(Gt(Ht(),ki,ti)),Vi=Wt(Gt(Ht(),Ci,ci)),Qi=Ht(),br=[ei(Ht(),Kt,jt(Qi,kt(Qi,ki,Di),X)),ei(Ht(),Kt,jt(Qi,ei(Qi,ki,Di),X)),ei(Ht(),Kt,jt(Qi,Di,X)),Kt],hr=[ei(Ht(),Qt,jt(Qi,kt(Qi,Ci,Vi),X)),ei(Ht(),Qt,jt(Qi,ei(Qi,Ci,Vi),X)),ei(Ht(),Qt,jt(Qi,Vi,X)),Qt];fe=this.addFeatureSection(_t.featureInfo.featureIndex,fe,this.bridgeFeatureSections,s);const[xr,Sr]=s.addVertices(ki,E,br[0],br[1]),[tr,yr]=s.addVertices(Ci,E,hr[0],hr[1]);s.addTriangles([xr,Sr,tr,Sr,yr,tr]);const[Yi,er]=s.addVertices(Di,E,br[1],br[2]),[Cr,Lr]=s.addVertices(Vi,E,hr[1],hr[2]);s.addTriangles([Yi,er,Cr,er,Lr,Cr]);const[an,Yr]=s.addVertices(Ir(ki,ki),E,br[2],br[3]),[zr,Ar]=s.addVertices(Ir(Ci,Ci),E,hr[2],hr[3]);s.addTriangles([an,Yr,zr,Yr,Ar,zr])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}constructTunnelStructures(s,c,g,y,T,E){s.clearVertexLookup();let D=Number.POSITIVE_INFINITY;const W=(ae,ce)=>ae.featureInfo.featureIndex-ce.featureInfo.featureIndex;this.sortSubarray(y,T.min,T.max,W),this.sortSubarray(y,E.min,E.max,W);const X=ae=>nr(ae,ae);for(let ae=T.min;ae<T.max;ae++){const ce=this.prepareEdgePoints(c,g,y[ae],(St,Pt)=>St<Pt);if(ce==null)continue;const[fe,ye]=ce,_t=X(ri(-(ye.coord.y-fe.coord.y),ye.coord.x-fe.coord.x,0));D=this.addFeatureSection(y[ae].featureInfo.featureIndex,D,this.tunnelFeatureSections,s),s.addQuad([fe,ye,{coord:ye.coord,height:y[ae].isTunnel?-.1:0},{coord:fe.coord,height:y[ae].isTunnel?-.1:0}],_t)}for(let ae=E.min;ae<E.max;ae++){const ce=y[ae];ce.isTunnel&&([ce.a,ce.b]=[ce.b,ce.a]);const fe=c[ce.a],ye=c[ce.b],_t=X(ri(-(ye.y-fe.y),ye.x-fe.x,0));D=this.addFeatureSection(ce.featureInfo.featureIndex,D,this.tunnelFeatureSections,s),s.addQuad([{coord:ye,height:0},{coord:fe,height:0},{coord:fe,height:g[ce.a]+4},{coord:ye,height:g[ce.b]+4}],_t),s.addQuad([{coord:fe,height:0},{coord:ye,height:0},{coord:ye,height:g[ce.b]+4},{coord:fe,height:g[ce.a]+4}],_t)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}prepareEdgePoints(s,c,g,y){let T=c[g.a],E=c[g.b];const D=y(T,0),W=y(E,0);if(D&&W)return[{coord:s[g.a],height:T},{coord:s[g.b],height:E}];if(!D&&!W)return;const X=s[g.a].clone(),ae=s[g.b].clone();if(D){if(!W){const ce=E/(E-T);ae.x=pn(ae.x,X.x,ce),ae.y=pn(ae.y,X.y,ce),E=pn(E,T,ce)}}else{const ce=T/(T-E);X.x=pn(X.x,ae.x,ce),X.y=pn(X.y,ae.y,ce),T=pn(T,E,ce)}return[{coord:X,height:T},{coord:ae,height:E}]}prepareEdges(s,c){if(c.length===0)return;c.sort((D,W)=>D.hash===W.hash?W.polygonIdx-D.polygonIdx:W.hash>D.hash?1:-1);let g=0,y=0,T=0,E=c[g].polygonIdx;do y++,(y===c.length||c[g].hash!==c[y].hash)&&((y-g==1||c[y-1].polygonIdx!==E)&&(T<g&&(c[T]=c[g],c[g]=null),c[T].type="none",T++),g=y,g!==c.length&&(E=c[g].polygonIdx));while(g!==c.length);if(c.splice(T),c.length!==0&&s.length!==0){c.sort((X,ae)=>X.portalHash<ae.portalHash?1:-1);let D=0,W=0;for(;D!==c.length&&W!==s.length;){const X=c[D],ae=s[W];X.portalHash>ae.hash?D++:ae.hash>X.portalHash?W++:(X.type=ae.type,D++)}}}isOnBorder(s,c){return s<=0&&c<=0||s>=Fr&&c>=Fr}addFeatureSection(s,c,g,y){return s!==c&&(c=s,g.push({featureIndex:s,vertexStart:y.getVertexCount()}),y.clearVertexLookup()),c}sortSubarray(s,c,g,y){const T=s.slice(c,g);T.sort(y),s.splice(c,T.length,...T)}static computeEdgeHash(s,c){return(s.y===c.y&&s.x>c.x||s.y>c.y)&&([s,c]=[c,s]),BigInt(ta.computePosHash(s))<<32n|BigInt(ta.computePosHash(c))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var ly,cy={exports:{}},uy=(ly||(ly=1,function(u,s){(function(c){function g(ai,hi){return ai>hi?1:ai<hi?-1:0}var y=function(ai,hi){ai===void 0&&(ai=g),hi===void 0&&(hi=!1),this._compare=ai,this._root=null,this._size=0,this._noDuplicates=!!hi},T={size:{configurable:!0}};function E(ai,hi,sr,Dr,Br){var Or=Br-Dr;if(Or>0){var Xr=Dr+Math.floor(Or/2),dn={key:hi[Xr],data:sr[Xr],parent:ai};return dn.left=E(dn,hi,sr,Dr,Xr),dn.right=E(dn,hi,sr,Xr+1,Br),dn}return null}function D(ai,hi,sr,Dr,Br){if(!(sr>=Dr)){for(var Or=ai[sr+Dr>>1],Xr=sr-1,dn=Dr+1;;){do Xr++;while(Br(ai[Xr],Or)<0);do dn--;while(Br(ai[dn],Or)>0);if(Xr>=dn)break;var On=ai[Xr];ai[Xr]=ai[dn],ai[dn]=On,On=hi[Xr],hi[Xr]=hi[dn],hi[dn]=On}D(ai,hi,sr,dn,Br),D(ai,hi,dn+1,Dr,Br)}}y.prototype.rotateLeft=function(ai){var hi=ai.right;hi&&(ai.right=hi.left,hi.left&&(hi.left.parent=ai),hi.parent=ai.parent),ai.parent?ai===ai.parent.left?ai.parent.left=hi:ai.parent.right=hi:this._root=hi,hi&&(hi.left=ai),ai.parent=hi},y.prototype.rotateRight=function(ai){var hi=ai.left;hi&&(ai.left=hi.right,hi.right&&(hi.right.parent=ai),hi.parent=ai.parent),ai.parent?ai===ai.parent.left?ai.parent.left=hi:ai.parent.right=hi:this._root=hi,hi&&(hi.right=ai),ai.parent=hi},y.prototype._splay=function(ai){for(;ai.parent;){var hi=ai.parent;hi.parent?hi.left===ai&&hi.parent.left===hi?(this.rotateRight(hi.parent),this.rotateRight(hi)):hi.right===ai&&hi.parent.right===hi?(this.rotateLeft(hi.parent),this.rotateLeft(hi)):hi.left===ai&&hi.parent.right===hi?(this.rotateRight(hi),this.rotateLeft(hi)):(this.rotateLeft(hi),this.rotateRight(hi)):hi.left===ai?this.rotateRight(hi):this.rotateLeft(hi)}},y.prototype.splay=function(ai){for(var hi,sr,Dr,Br,Or;ai.parent;)(sr=(hi=ai.parent).parent)&&sr.parent?((Dr=sr.parent).left===sr?Dr.left=ai:Dr.right=ai,ai.parent=Dr):(ai.parent=null,this._root=ai),Br=ai.left,Or=ai.right,ai===hi.left?(sr&&(sr.left===hi?(hi.right?(sr.left=hi.right,sr.left.parent=sr):sr.left=null,hi.right=sr,sr.parent=hi):(Br?(sr.right=Br,Br.parent=sr):sr.right=null,ai.left=sr,sr.parent=ai)),Or?(hi.left=Or,Or.parent=hi):hi.left=null,ai.right=hi,hi.parent=ai):(sr&&(sr.right===hi?(hi.left?(sr.right=hi.left,sr.right.parent=sr):sr.right=null,hi.left=sr,sr.parent=hi):(Or?(sr.left=Or,Or.parent=sr):sr.left=null,ai.right=sr,sr.parent=ai)),Br?(hi.right=Br,Br.parent=hi):hi.right=null,ai.left=hi,hi.parent=ai)},y.prototype.replace=function(ai,hi){ai.parent?ai===ai.parent.left?ai.parent.left=hi:ai.parent.right=hi:this._root=hi,hi&&(hi.parent=ai.parent)},y.prototype.minNode=function(ai){if(ai===void 0&&(ai=this._root),ai)for(;ai.left;)ai=ai.left;return ai},y.prototype.maxNode=function(ai){if(ai===void 0&&(ai=this._root),ai)for(;ai.right;)ai=ai.right;return ai},y.prototype.insert=function(ai,hi){var sr=this._root,Dr=null,Br=this._compare;if(this._noDuplicates)for(;sr;){if(Dr=sr,Br(sr.key,ai)===0)return;sr=Br(sr.key,ai)<0?sr.right:sr.left}else for(;sr;)Dr=sr,sr=Br(sr.key,ai)<0?sr.right:sr.left;return sr={key:ai,data:hi,left:null,right:null,parent:Dr},Dr?Br(Dr.key,sr.key)<0?Dr.right=sr:Dr.left=sr:this._root=sr,this.splay(sr),this._size++,sr},y.prototype.find=function(ai){for(var hi=this._root,sr=this._compare;hi;){var Dr=sr(hi.key,ai);if(Dr<0)hi=hi.right;else{if(!(Dr>0))return hi;hi=hi.left}}return null},y.prototype.contains=function(ai){for(var hi=this._root,sr=this._compare;hi;){var Dr=sr(ai,hi.key);if(Dr===0)return!0;hi=Dr<0?hi.left:hi.right}return!1},y.prototype.remove=function(ai){var hi=this.find(ai);if(!hi)return!1;if(this.splay(hi),hi.left)if(hi.right){var sr=this.minNode(hi.right);sr.parent!==hi&&(this.replace(sr,sr.right),sr.right=hi.right,sr.right.parent=sr),this.replace(hi,sr),sr.left=hi.left,sr.left.parent=sr}else this.replace(hi,hi.left);else this.replace(hi,hi.right);return this._size--,!0},y.prototype.removeNode=function(ai){if(!ai)return!1;if(this.splay(ai),ai.left)if(ai.right){var hi=this.minNode(ai.right);hi.parent!==ai&&(this.replace(hi,hi.right),hi.right=ai.right,hi.right.parent=hi),this.replace(ai,hi),hi.left=ai.left,hi.left.parent=hi}else this.replace(ai,ai.left);else this.replace(ai,ai.right);return this._size--,!0},y.prototype.erase=function(ai){var hi=this.find(ai);if(hi){this.splay(hi);var sr=hi.left,Dr=hi.right,Br=null;sr&&(sr.parent=null,Br=this.maxNode(sr),this.splay(Br),this._root=Br),Dr&&(sr?Br.right=Dr:this._root=Dr,Dr.parent=Br),this._size--}},y.prototype.pop=function(){var ai=this._root,hi=null;if(ai){for(;ai.left;)ai=ai.left;hi={key:ai.key,data:ai.data},this.remove(ai.key)}return hi},y.prototype.next=function(ai){var hi=ai;if(hi)if(hi.right)for(hi=hi.right;hi&&hi.left;)hi=hi.left;else for(hi=ai.parent;hi&&hi.right===ai;)ai=hi,hi=hi.parent;return hi},y.prototype.prev=function(ai){var hi=ai;if(hi)if(hi.left)for(hi=hi.left;hi&&hi.right;)hi=hi.right;else for(hi=ai.parent;hi&&hi.left===ai;)ai=hi,hi=hi.parent;return hi},y.prototype.forEach=function(ai){for(var hi=this._root,sr=[],Dr=!1,Br=0;!Dr;)hi?(sr.push(hi),hi=hi.left):sr.length>0?(ai(hi=sr.pop(),Br++),hi=hi.right):Dr=!0;return this},y.prototype.range=function(ai,hi,sr,Dr){for(var Br=[],Or=this._compare,Xr=this._root;Br.length!==0||Xr;)if(Xr)Br.push(Xr),Xr=Xr.left;else{if(Or((Xr=Br.pop()).key,hi)>0)break;if(Or(Xr.key,ai)>=0&&sr.call(Dr,Xr))return this;Xr=Xr.right}return this},y.prototype.keys=function(){for(var ai=this._root,hi=[],sr=[],Dr=!1;!Dr;)ai?(hi.push(ai),ai=ai.left):hi.length>0?(ai=hi.pop(),sr.push(ai.key),ai=ai.right):Dr=!0;return sr},y.prototype.values=function(){for(var ai=this._root,hi=[],sr=[],Dr=!1;!Dr;)ai?(hi.push(ai),ai=ai.left):hi.length>0?(ai=hi.pop(),sr.push(ai.data),ai=ai.right):Dr=!0;return sr},y.prototype.at=function(ai){for(var hi=this._root,sr=[],Dr=!1,Br=0;!Dr;)if(hi)sr.push(hi),hi=hi.left;else if(sr.length>0){if(hi=sr.pop(),Br===ai)return hi;Br++,hi=hi.right}else Dr=!0;return null},y.prototype.load=function(ai,hi,sr){if(ai===void 0&&(ai=[]),hi===void 0&&(hi=[]),sr===void 0&&(sr=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Dr=ai.length;return sr&&D(ai,hi,0,Dr-1,this._compare),this._root=E(null,ai,hi,0,Dr),this._size=Dr,this},y.prototype.min=function(){var ai=this.minNode(this._root);return ai?ai.key:null},y.prototype.max=function(){var ai=this.maxNode(this._root);return ai?ai.key:null},y.prototype.isEmpty=function(){return this._root===null},T.size.get=function(){return this._size},y.createTree=function(ai,hi,sr,Dr,Br){return new y(sr,Br).load(ai,hi,Dr)},Object.defineProperties(y.prototype,T);var W=0,X=1,ae=2,ce=3,fe=0,ye=1,_t=2,St=3;function Pt(ai,hi,sr){hi===null?(ai.inOut=!1,ai.otherInOut=!0):(ai.isSubject===hi.isSubject?(ai.inOut=!hi.inOut,ai.otherInOut=hi.otherInOut):(ai.inOut=!hi.otherInOut,ai.otherInOut=hi.isVertical()?!hi.inOut:hi.inOut),hi&&(ai.prevInResult=!zt(hi,sr)||hi.isVertical()?hi.prevInResult:hi));var Dr=zt(ai,sr);ai.resultTransition=Dr?function(Br,Or){var Xr,dn=!Br.inOut,On=!Br.otherInOut;switch(Or){case fe:Xr=dn&&On;break;case ye:Xr=dn||On;break;case St:Xr=dn^On;break;case _t:Xr=Br.isSubject?dn&&!On:On&&!dn}return Xr?1:-1}(ai,sr):0}function zt(ai,hi){switch(ai.type){case W:switch(hi){case fe:return!ai.otherInOut;case ye:return ai.otherInOut;case _t:return ai.isSubject&&ai.otherInOut||!ai.isSubject&&!ai.otherInOut;case St:return!0}break;case ae:return hi===fe||hi===ye;case ce:return hi===_t;case X:return!1}return!1}var Kt=function(ai,hi,sr,Dr,Br){this.left=hi,this.point=ai,this.otherEvent=sr,this.isSubject=Dr,this.type=Br||W,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Qt={inResult:{configurable:!0}};function Tt(ai,hi){return ai[0]===hi[0]&&ai[1]===hi[1]}Kt.prototype.isBelow=function(ai){var hi=this.point,sr=this.otherEvent.point;return this.left?(hi[0]-ai[0])*(sr[1]-ai[1])-(sr[0]-ai[0])*(hi[1]-ai[1])>0:(sr[0]-ai[0])*(hi[1]-ai[1])-(hi[0]-ai[0])*(sr[1]-ai[1])>0},Kt.prototype.isAbove=function(ai){return!this.isBelow(ai)},Kt.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Qt.inResult.get=function(){return this.resultTransition!==0},Kt.prototype.clone=function(){var ai=new Kt(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ai.contourId=this.contourId,ai.resultTransition=this.resultTransition,ai.prevInResult=this.prevInResult,ai.isExteriorRing=this.isExteriorRing,ai.inOut=this.inOut,ai.otherInOut=this.otherInOut,ai},Object.defineProperties(Kt.prototype,Qt);var Wt=11102230246251565e-32,ti=134217729,ci=(3+8*Wt)*Wt;function ki(ai,hi,sr,Dr,Br){var Or,Xr,dn,On,zn=hi[0],An=Dr[0],us=0,ys=0;An>zn==An>-zn?(Or=zn,zn=hi[++us]):(Or=An,An=Dr[++ys]);var Bn=0;if(us<ai&&ys<sr)for(An>zn==An>-zn?(dn=Or-((Xr=zn+Or)-zn),zn=hi[++us]):(dn=Or-((Xr=An+Or)-An),An=Dr[++ys]),Or=Xr,dn!==0&&(Br[Bn++]=dn);us<ai&&ys<sr;)An>zn==An>-zn?(dn=Or-((Xr=Or+zn)-(On=Xr-Or))+(zn-On),zn=hi[++us]):(dn=Or-((Xr=Or+An)-(On=Xr-Or))+(An-On),An=Dr[++ys]),Or=Xr,dn!==0&&(Br[Bn++]=dn);for(;us<ai;)dn=Or-((Xr=Or+zn)-(On=Xr-Or))+(zn-On),zn=hi[++us],Or=Xr,dn!==0&&(Br[Bn++]=dn);for(;ys<sr;)dn=Or-((Xr=Or+An)-(On=Xr-Or))+(An-On),An=Dr[++ys],Or=Xr,dn!==0&&(Br[Bn++]=dn);return Or===0&&Bn!==0||(Br[Bn++]=Or),Bn}function Ci(ai){return new Float64Array(ai)}var Di=33306690738754716e-32,Vi=22204460492503146e-32,Qi=11093356479670487e-47,br=Ci(4),hr=Ci(8),xr=Ci(12),Sr=Ci(16),tr=Ci(4);function yr(ai,hi,sr){var Dr=function(Br,Or,Xr,dn,On,zn){var An=(Or-zn)*(Xr-On),us=(Br-On)*(dn-zn),ys=An-us;if(An===0||us===0||An>0!=us>0)return ys;var Bn=Math.abs(An+us);return Math.abs(ys)>=Di*Bn?ys:-function(Vs,Es,as,Xs,Rs,vs,Ms){var ds,Pn,ms,$s,un,Wn,Ls,Ws,Fs,so,gs,ro,Vo,xo,yo,$o,ol,oo,lo=Vs-Rs,bo=as-Rs,Ro=Es-vs,Eo=Xs-vs;br[0]=(yo=(Ws=lo-(Ls=(Wn=ti*lo)-(Wn-lo)))*(so=Eo-(Fs=(Wn=ti*Eo)-(Wn-Eo)))-((xo=lo*Eo)-Ls*Fs-Ws*Fs-Ls*so))-((gs=yo-(ol=(Ws=Ro-(Ls=(Wn=ti*Ro)-(Wn-Ro)))*(so=bo-(Fs=(Wn=ti*bo)-(Wn-bo)))-(($o=Ro*bo)-Ls*Fs-Ws*Fs-Ls*so)))+(un=yo-gs))+(un-ol),br[1]=(Vo=xo-((ro=xo+gs)-(un=ro-xo))+(gs-un))-((gs=Vo-$o)+(un=Vo-gs))+(un-$o),br[2]=ro-((oo=ro+gs)-(un=oo-ro))+(gs-un),br[3]=oo;var wc=function(Ww,Sx){for(var Tx=Sx[0],C_=1;C_<4;C_++)Tx+=Sx[C_];return Tx}(0,br),Ld=Vi*Ms;if(wc>=Ld||-wc>=Ld||(ds=Vs-(lo+(un=Vs-lo))+(un-Rs),ms=as-(bo+(un=as-bo))+(un-Rs),Pn=Es-(Ro+(un=Es-Ro))+(un-vs),$s=Xs-(Eo+(un=Xs-Eo))+(un-vs),ds===0&&Pn===0&&ms===0&&$s===0)||(Ld=Qi*Ms+ci*Math.abs(wc),(wc+=lo*$s+Eo*ds-(Ro*ms+bo*Pn))>=Ld||-wc>=Ld))return wc;tr[0]=(yo=(Ws=ds-(Ls=(Wn=ti*ds)-(Wn-ds)))*(so=Eo-(Fs=(Wn=ti*Eo)-(Wn-Eo)))-((xo=ds*Eo)-Ls*Fs-Ws*Fs-Ls*so))-((gs=yo-(ol=(Ws=Pn-(Ls=(Wn=ti*Pn)-(Wn-Pn)))*(so=bo-(Fs=(Wn=ti*bo)-(Wn-bo)))-(($o=Pn*bo)-Ls*Fs-Ws*Fs-Ls*so)))+(un=yo-gs))+(un-ol),tr[1]=(Vo=xo-((ro=xo+gs)-(un=ro-xo))+(gs-un))-((gs=Vo-$o)+(un=Vo-gs))+(un-$o),tr[2]=ro-((oo=ro+gs)-(un=oo-ro))+(gs-un),tr[3]=oo;var $w=ki(4,br,4,tr,hr);tr[0]=(yo=(Ws=lo-(Ls=(Wn=ti*lo)-(Wn-lo)))*(so=$s-(Fs=(Wn=ti*$s)-(Wn-$s)))-((xo=lo*$s)-Ls*Fs-Ws*Fs-Ls*so))-((gs=yo-(ol=(Ws=Ro-(Ls=(Wn=ti*Ro)-(Wn-Ro)))*(so=ms-(Fs=(Wn=ti*ms)-(Wn-ms)))-(($o=Ro*ms)-Ls*Fs-Ws*Fs-Ls*so)))+(un=yo-gs))+(un-ol),tr[1]=(Vo=xo-((ro=xo+gs)-(un=ro-xo))+(gs-un))-((gs=Vo-$o)+(un=Vo-gs))+(un-$o),tr[2]=ro-((oo=ro+gs)-(un=oo-ro))+(gs-un),tr[3]=oo;var Uw=ki($w,hr,4,tr,xr);tr[0]=(yo=(Ws=ds-(Ls=(Wn=ti*ds)-(Wn-ds)))*(so=$s-(Fs=(Wn=ti*$s)-(Wn-$s)))-((xo=ds*$s)-Ls*Fs-Ws*Fs-Ls*so))-((gs=yo-(ol=(Ws=Pn-(Ls=(Wn=ti*Pn)-(Wn-Pn)))*(so=ms-(Fs=(Wn=ti*ms)-(Wn-ms)))-(($o=Pn*ms)-Ls*Fs-Ws*Fs-Ls*so)))+(un=yo-gs))+(un-ol),tr[1]=(Vo=xo-((ro=xo+gs)-(un=ro-xo))+(gs-un))-((gs=Vo-$o)+(un=Vo-gs))+(un-$o),tr[2]=ro-((oo=ro+gs)-(un=oo-ro))+(gs-un),tr[3]=oo;var Gw=ki(Uw,xr,4,tr,Sr);return Sr[Gw-1]}(Br,Or,Xr,dn,On,zn,Bn)}(ai[0],ai[1],hi[0],hi[1],sr[0],sr[1]);return Dr>0?-1:Dr<0?1:0}function Yi(ai,hi){var sr=ai.point,Dr=hi.point;return sr[0]>Dr[0]?1:sr[0]<Dr[0]?-1:sr[1]!==Dr[1]?sr[1]>Dr[1]?1:-1:function(Br,Or,Xr,dn){return Br.left!==Or.left?Br.left?1:-1:yr(Xr,Br.otherEvent.point,Or.otherEvent.point)!==0?Br.isBelow(Or.otherEvent.point)?-1:1:!Br.isSubject&&Or.isSubject?1:-1}(ai,hi,sr)}function er(ai,hi,sr){var Dr=new Kt(hi,!1,ai,ai.isSubject),Br=new Kt(hi,!0,ai.otherEvent,ai.isSubject);return Tt(ai.point,ai.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ai),Dr.contourId=Br.contourId=ai.contourId,Yi(Br,ai.otherEvent)>0&&(ai.otherEvent.left=!0,Br.left=!1),ai.otherEvent.otherEvent=Br,ai.otherEvent=Dr,sr.push(Br),sr.push(Dr),sr}function Cr(ai,hi){return ai[0]*hi[1]-ai[1]*hi[0]}function Lr(ai,hi){return ai[0]*hi[0]+ai[1]*hi[1]}function an(ai,hi,sr){var Dr=function(On,zn,An,us,ys){var Bn=[zn[0]-On[0],zn[1]-On[1]],Vs=[us[0]-An[0],us[1]-An[1]];function Es(Wn,Ls,Ws){return[Wn[0]+Ls*Ws[0],Wn[1]+Ls*Ws[1]]}var as=[An[0]-On[0],An[1]-On[1]],Xs=Cr(Bn,Vs),Rs=Xs*Xs,vs=Lr(Bn,Bn);if(Rs>0){var Ms=Cr(as,Vs)/Xs;if(Ms<0||Ms>1)return null;var ds=Cr(as,Bn)/Xs;return ds<0||ds>1?null:Ms===0||Ms===1?[Es(On,Ms,Bn)]:ds===0||ds===1?[Es(An,ds,Vs)]:[Es(On,Ms,Bn)]}if((Rs=(Xs=Cr(as,Bn))*Xs)>0)return null;var Pn=Lr(Bn,as)/vs,ms=Pn+Lr(Bn,Vs)/vs,$s=Math.min(Pn,ms),un=Math.max(Pn,ms);return $s<=1&&un>=0?$s===1?[Es(On,$s>0?$s:0,Bn)]:un===0?[Es(On,un<1?un:1,Bn)]:[Es(On,$s>0?$s:0,Bn),Es(On,un<1?un:1,Bn)]:null}(ai.point,ai.otherEvent.point,hi.point,hi.otherEvent.point),Br=Dr?Dr.length:0;if(Br===0||Br===1&&(Tt(ai.point,hi.point)||Tt(ai.otherEvent.point,hi.otherEvent.point))||Br===2&&ai.isSubject===hi.isSubject)return 0;if(Br===1)return Tt(ai.point,Dr[0])||Tt(ai.otherEvent.point,Dr[0])||er(ai,Dr[0],sr),Tt(hi.point,Dr[0])||Tt(hi.otherEvent.point,Dr[0])||er(hi,Dr[0],sr),1;var Or=[],Xr=!1,dn=!1;return Tt(ai.point,hi.point)?Xr=!0:Yi(ai,hi)===1?Or.push(hi,ai):Or.push(ai,hi),Tt(ai.otherEvent.point,hi.otherEvent.point)?dn=!0:Yi(ai.otherEvent,hi.otherEvent)===1?Or.push(hi.otherEvent,ai.otherEvent):Or.push(ai.otherEvent,hi.otherEvent),Xr&&dn||Xr?(hi.type=X,ai.type=hi.inOut===ai.inOut?ae:ce,Xr&&!dn&&er(Or[1].otherEvent,Or[0].point,sr),2):dn?(er(Or[0],Or[1].point,sr),3):Or[0]!==Or[3].otherEvent?(er(Or[0],Or[1].point,sr),er(Or[1],Or[2].point,sr),3):(er(Or[0],Or[1].point,sr),er(Or[3].otherEvent,Or[2].point,sr),3)}function Yr(ai,hi){if(ai===hi)return 0;if(yr(ai.point,ai.otherEvent.point,hi.point)!==0||yr(ai.point,ai.otherEvent.point,hi.otherEvent.point)!==0)return Tt(ai.point,hi.point)?ai.isBelow(hi.otherEvent.point)?-1:1:ai.point[0]===hi.point[0]?ai.point[1]<hi.point[1]?-1:1:Yi(ai,hi)===1?hi.isAbove(ai.point)?-1:1:ai.isBelow(hi.point)?-1:1;if(ai.isSubject!==hi.isSubject)return ai.isSubject?-1:1;var sr=ai.point,Dr=hi.point;return sr[0]===Dr[0]&&sr[1]===Dr[1]?(sr=ai.otherEvent.point)[0]===(Dr=hi.otherEvent.point)[0]&&sr[1]===Dr[1]?0:ai.contourId>hi.contourId?1:-1:Yi(ai,hi)===1?1:-1}var zr=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ar(ai,hi,sr,Dr){var Br,Or=ai+1,Xr=hi[ai].point,dn=hi.length;for(Or<dn&&(Br=hi[Or].point);Or<dn&&Br[0]===Xr[0]&&Br[1]===Xr[1];){if(!sr[Or])return Or;++Or<dn&&(Br=hi[Or].point)}for(Or=ai-1;sr[Or]&&Or>Dr;)Or--;return Or}zr.prototype.isExterior=function(){return this.holeOf==null};var vn=Kr,Zr=Kr;function Kr(ai,hi){if(!(this instanceof Kr))return new Kr(ai,hi);if(this.data=ai||[],this.length=this.data.length,this.compare=hi||mn,this.length>0)for(var sr=(this.length>>1)-1;sr>=0;sr--)this._down(sr)}function mn(ai,hi){return ai<hi?-1:ai>hi?1:0}Kr.prototype={push:function(ai){this.data.push(ai),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ai=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ai}},peek:function(){return this.data[0]},_up:function(ai){for(var hi=this.data,sr=this.compare,Dr=hi[ai];ai>0;){var Br=ai-1>>1,Or=hi[Br];if(sr(Dr,Or)>=0)break;hi[ai]=Or,ai=Br}hi[ai]=Dr},_down:function(ai){for(var hi=this.data,sr=this.compare,Dr=this.length>>1,Br=hi[ai];ai<Dr;){var Or=1+(ai<<1),Xr=Or+1,dn=hi[Or];if(Xr<this.length&&sr(hi[Xr],dn)<0&&(Or=Xr,dn=hi[Xr]),sr(dn,Br)>=0)break;hi[ai]=dn,ai=Or}hi[ai]=Br}},vn.default=Zr;var Tn=Math.max,bn=Math.min,Rn=0;function Mn(ai,hi,sr,Dr,Br,Or){var Xr,dn,On,zn,An,us;for(Xr=0,dn=ai.length-1;Xr<dn;Xr++)if(zn=ai[Xr+1],An=new Kt(On=ai[Xr],!1,void 0,hi),us=new Kt(zn,!1,An,hi),An.otherEvent=us,On[0]!==zn[0]||On[1]!==zn[1]){An.contourId=us.contourId=sr,Or||(An.isExteriorRing=!1,us.isExteriorRing=!1),Yi(An,us)>0?us.left=!0:An.left=!0;var ys=On[0],Bn=On[1];Br[0]=bn(Br[0],ys),Br[1]=bn(Br[1],Bn),Br[2]=Tn(Br[2],ys),Br[3]=Tn(Br[3],Bn),Dr.push(An),Dr.push(us)}}var Ln=[];function os(ai,hi,sr){typeof ai[0][0][0]=="number"&&(ai=[ai]),typeof hi[0][0][0]=="number"&&(hi=[hi]);var Dr=function(Bn,Vs,Es){var as=null;return Bn.length*Vs.length==0&&(Es===fe?as=Ln:Es===_t?as=Bn:Es!==ye&&Es!==St||(as=Bn.length===0?Vs:Bn)),as}(ai,hi,sr);if(Dr)return Dr===Ln?null:Dr;var Br=[1/0,1/0,-1/0,-1/0],Or=[1/0,1/0,-1/0,-1/0],Xr=function(Bn,Vs,Es,as,Xs){var Rs,vs,Ms,ds,Pn,ms,$s=new vn(null,Yi);for(Ms=0,ds=Bn.length;Ms<ds;Ms++)for(Pn=0,ms=(Rs=Bn[Ms]).length;Pn<ms;Pn++)(vs=Pn===0)&&Rn++,Mn(Rs[Pn],!0,Rn,$s,Es,vs);for(Ms=0,ds=Vs.length;Ms<ds;Ms++)for(Pn=0,ms=(Rs=Vs[Ms]).length;Pn<ms;Pn++)vs=Pn===0,Xs===_t&&(vs=!1),vs&&Rn++,Mn(Rs[Pn],!1,Rn,$s,as,vs);return $s}(ai,hi,Br,Or,sr);if(Dr=function(Bn,Vs,Es,as,Xs){var Rs=null;return(Es[0]>as[2]||as[0]>Es[2]||Es[1]>as[3]||as[1]>Es[3])&&(Xs===fe?Rs=Ln:Xs===_t?Rs=Bn:Xs!==ye&&Xs!==St||(Rs=Bn.concat(Vs))),Rs}(ai,hi,Br,Or,sr))return Dr===Ln?null:Dr;for(var dn=function(Bn){var Vs,Es,as=function(Ms){var ds,Pn,ms,$s,un=[];for(Pn=0,ms=Ms.length;Pn<ms;Pn++)((ds=Ms[Pn]).left&&ds.inResult||!ds.left&&ds.otherEvent.inResult)&&un.push(ds);for(var Wn=!1;!Wn;)for(Wn=!0,Pn=0,ms=un.length;Pn<ms;Pn++)Pn+1<ms&&Yi(un[Pn],un[Pn+1])===1&&($s=un[Pn],un[Pn]=un[Pn+1],un[Pn+1]=$s,Wn=!1);for(Pn=0,ms=un.length;Pn<ms;Pn++)(ds=un[Pn]).otherPos=Pn;for(Pn=0,ms=un.length;Pn<ms;Pn++)(ds=un[Pn]).left||($s=ds.otherPos,ds.otherPos=ds.otherEvent.otherPos,ds.otherEvent.otherPos=$s);return un}(Bn),Xs={},Rs=[],vs=function(){if(!Xs[Vs]){var Ms=Rs.length,ds=function(un,Wn,Ls){var Ws=new zr;if(un.prevInResult!=null){var Fs=un.prevInResult,so=Fs.outputContourId;if(Fs.resultTransition>0){var gs=Wn[so];if(gs.holeOf!=null){var ro=gs.holeOf;Wn[ro].holeIds.push(Ls),Ws.holeOf=ro,Ws.depth=Wn[so].depth}else Wn[so].holeIds.push(Ls),Ws.holeOf=so,Ws.depth=Wn[so].depth+1}else Ws.holeOf=null,Ws.depth=Wn[so].depth}else Ws.holeOf=null,Ws.depth=0;return Ws}(as[Vs],Rs,Ms),Pn=function(un){Xs[un]=!0,un<as.length&&as[un]&&(as[un].outputContourId=Ms)},ms=Vs,$s=Vs;for(ds.points.push(as[Vs].point);Pn(ms),Pn(ms=as[ms].otherPos),ds.points.push(as[ms].point),!((ms=Ar(ms,as,Xs,$s))==$s||ms>=as.length)&&as[ms];);Rs.push(ds)}};for(Vs=0,Es=as.length;Vs<Es;Vs++)vs();return Rs}(function(Bn,Vs,Es,as,Xs,Rs){for(var vs,Ms,ds,Pn=new y(Yr),ms=[],$s=Math.min(as[2],Xs[2]);Bn.length!==0;){var un=Bn.pop();if(ms.push(un),Rs===fe&&un.point[0]>$s||Rs===_t&&un.point[0]>as[2])break;if(un.left){Ms=vs=Pn.insert(un),vs=vs!==(ds=Pn.minNode())?Pn.prev(vs):null,Ms=Pn.next(Ms);var Wn=vs?vs.key:null;if(Pt(un,Wn,Rs),Ms&&an(un,Ms.key,Bn)===2&&(Pt(un,Wn,Rs),Pt(Ms.key,un,Rs)),vs&&an(vs.key,un,Bn)===2){var Ls=vs;Pt(Wn,(Ls=Ls!==ds?Pn.prev(Ls):null)?Ls.key:null,Rs),Pt(un,Wn,Rs)}}else Ms=vs=Pn.find(un=un.otherEvent),vs&&Ms&&(vs=vs!==ds?Pn.prev(vs):null,Ms=Pn.next(Ms),Pn.remove(un),Ms&&vs&&an(vs.key,Ms.key,Bn))}return ms}(Xr,0,0,Br,Or,sr)),On=[],zn=0;zn<dn.length;zn++){var An=dn[zn];if(An.isExterior()){for(var us=[An.points],ys=0;ys<An.holeIds.length;ys++)us.push(dn[An.holeIds[ys]].points);On.push(us)}}return On}var Ts={UNION:ye,DIFFERENCE:_t,INTERSECTION:fe,XOR:St};c.diff=function(ai,hi){return os(ai,hi,_t)},c.intersection=function(ai,hi){return os(ai,hi,fe)},c.operations=Ts,c.union=function(ai,hi){return os(ai,hi,ye)},c.xor=function(ai,hi){return os(ai,hi,St)},Object.defineProperty(c,"__esModule",{value:!0})})(s)}(0,cy.exports)),cy.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Up(u,s,c,g){const y=[],T=g===0?(E,D,W,X,ae,ce)=>{E.push(new rr(ce,W+(ce-D)/(X-D)*(ae-W)))}:(E,D,W,X,ae,ce)=>{E.push(new rr(D+(ce-W)/(ae-W)*(X-D),ce))};for(const E of u){const D=[];for(const W of E){if(W.length<=2)continue;const X=[];for(let fe=0;fe<W.length-1;fe++){const ye=W[fe].x,_t=W[fe].y,St=W[fe+1].x,Pt=W[fe+1].y,zt=g===0?ye:_t,Kt=g===0?St:Pt;zt<s?Kt>s&&T(X,ye,_t,St,Pt,s):zt>c?Kt<c&&T(X,ye,_t,St,Pt,c):X.push(W[fe]),Kt<s&&zt>=s&&T(X,ye,_t,St,Pt,s),Kt>c&&zt<=c&&T(X,ye,_t,St,Pt,c)}let ae=W[W.length-1];const ce=g===0?ae.x:ae.y;ce>=s&&ce<=c&&X.push(ae),X.length&&(ae=X[X.length-1],X[0].x===ae.x&&X[0].y===ae.y||X.push(X[0]),D.push(X))}D.length&&y.push(D)}return y}function Qx(u,s){const c=Tg(u),g=Tg([s]),y=uy.intersection(c,g);return y==null?[]:hy(y)}function eb(u,s){let g=Tg(u,65536);for(;s.valid();s.next()){const[y,T]=s.get(),E=y.x*65536,D=y.y*65536,W=T.x*65536,X=T.y*65536,ae=W-E,ce=X-D,fe=Math.hypot(ae,ce),ye=Math.trunc(ce/fe*3),_t=-Math.trunc(ae/fe*3);g=uy.diff(g,[[[E,D],[W,X],[W+ye,X+_t],[E+ye,D+_t],[E,D]]])}return hy(g,1/65536)}function Tg(u,s=1){return[u.map(c=>c.map(g=>[g.x*s,g.y*s]))]}function hy(u,s=1){return u.map(c=>c.map((g,y)=>{const T=g.map(E=>new rr(E[0]*s,E[1]*s).round());return y>0&&T.reverse(),T}))}class Eg{constructor(s,c){this.layoutVertexArray=new Ia,this.indexArray=new go,this.lineIndexArray=new Ja,this.triangleSegments=new Hs,this.lineSegments=new Hs,this.programConfigurations=new b(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new Ya)}update(s,c,g,y,T,E,D,W){this.programConfigurations.updatePaintArrays(s,c,T,g,y,E,D,W)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Bx.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,Nx.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,c,g,y,T,E,D){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,c,g,y,T,E,void 0,D)}}class Mg{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=s.lut,this.bufferData=new Eg(s,!1),this.elevationBufferData=new Eg(s,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=s.sourceLayerIndex,this.worldview=s.worldview}updateFootprints(s,c){}populate(s,c,g,y){this.hasPattern=wg("fill",this.layers,this.pixelRatio,c);const T=this.layers[0].layout.get("fill-sort-key"),E=[];for(const{feature:D,id:W,index:X,sourceLayerIndex:ae}of s){const ce=this.layers[0]._featureFilter.needGeometry,fe=Ur(D,ce);if(!this.layers[0]._featureFilter.filter(new ps(this.zoom,{worldview:this.worldview}),fe,g))continue;const ye=T?T.evaluate(fe,{},g,c.availableImages):void 0,_t={id:W,properties:D.properties,type:D.type,sourceLayerIndex:ae,index:X,geometry:ce?fe.geometry:qr(D,g,y),patterns:{},sortKey:ye};E.push(_t)}T&&E.sort((D,W)=>D.sortKey-W.sortKey);for(const D of E){const{geometry:W,index:X,sourceLayerIndex:ae}=D;if(this.hasPattern){const ce=Sg("fill",this.layers,D,this.zoom,this.pixelRatio,c);this.patternFeatures.push(ce)}else this.addFeature(D,W,X,g,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(s[X].feature,W,X,ae,this.index)}}update(s,c,g,y,T,E,D){this.bufferData.update(s,c,g,y,T,E,D,this.worldview),this.elevationBufferData.update(s,c,g,y,T,E,D,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(s,c,g,y,T,E,D,this.worldview)}addFeatures(s,c,g,y,T,E){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,c,g,y,E,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,c,g,y,T,E=[],D,W){const X=$p(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,X,y,g,W):this.addGeometry(X,this.bufferData),this.bufferData.populatePaintArrays(s,g,T,E,y,D,this.worldview),this.elevationBufferData.populatePaintArrays(s,g,T,E,y,D,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s,c,g,y,T){this.elevatedStructures&&(this.elevatedStructures.construct(s),this.elevatedStructures.populatePaintArrays(c,g,y,T,this.worldview))}addElevatedRoadFeature(s,c,g,y,T){const E=new Array,D=Wo.getElevationFeature(s,T);if(!D)return void this.addGeometry(c,this.bufferData);{const X=this.clipPolygonsToTile(c,1);X.length>0&&E.push({polygons:X,elevationFeature:D,elevationTileID:g})}const W={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(s,{},g),featureIndex:y};for(const X of E)if(X.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ta(X.elevationTileID,this.layers,this.zoom,this.lut));const ce=X.elevationFeature.isTunnel();let fe=0;s.properties.hasOwnProperty(Cs)&&(fe=+s.properties[Cs]);for(const ye of X.polygons)this.elevatedStructures.addPortalCandidates(X.elevationFeature.id,ye,ce,X.elevationFeature,fe)}X.elevationFeature.constantHeight==null&&(X.polygons=this.prepareElevatedPolygons(X.polygons,X.elevationFeature,X.elevationTileID));const ae=new la(g,X.elevationTileID);this.addElevatedGeometry(X.polygons,ae,X.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,y,W)}}addElevatedGeometry(s,c,g,y,T,E){const D={elevation:g,elevationSampler:c,bias:y,index:T,featureInfo:E},[W,X]=this.addGeometry(s,this.elevationBufferData,D);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:W,max:X}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,W),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,X))}addGeometry(s,c,g){let y=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,E=null;g&&(E=g.elevationSampler.constantElevation(g.elevation,g.bias),E!=null&&(y=E,T=E));const D=(W,X,ae)=>{if(g!=null)if(X.push(W),E!=null)c.elevatedLayoutVertexArray.emplaceBack(E),ae.push(E);else{const ce=g.elevationSampler.pointElevation(W,g.elevation,g.bias);c.elevatedLayoutVertexArray.emplaceBack(ce),ae.push(ce),y=Math.min(y,ce),T=Math.max(T,ce)}};for(const W of s){let X=0;for(const Qt of W)X+=Qt.length;const ae=c.triangleSegments.prepareSegment(X,c.layoutVertexArray,c.indexArray),ce=ae.vertexLength,fe=[],ye=[],_t=[],St=[],Pt=[],zt=c.layoutVertexArray.length;for(const Qt of W){if(Qt.length===0)continue;Qt!==W[0]&&ye.push(fe.length/2);const Tt=c.lineSegments.prepareSegment(Qt.length,c.layoutVertexArray,c.lineIndexArray),Wt=Tt.vertexLength;g&&Pt.push(c.layoutVertexArray.length-zt),D(Qt[0],_t,St),c.layoutVertexArray.emplaceBack(Qt[0].x,Qt[0].y),c.lineIndexArray.emplaceBack(Wt+Qt.length-1,Wt),fe.push(Qt[0].x),fe.push(Qt[0].y);for(let ti=1;ti<Qt.length;ti++)D(Qt[ti],_t,St),c.layoutVertexArray.emplaceBack(Qt[ti].x,Qt[ti].y),c.lineIndexArray.emplaceBack(Wt+ti-1,Wt+ti),fe.push(Qt[ti].x),fe.push(Qt[ti].y);Tt.vertexLength+=Qt.length,Tt.primitiveLength+=Qt.length}const Kt=ed(fe,ye);for(let Qt=0;Qt<Kt.length;Qt+=3)c.indexArray.emplaceBack(ce+Kt[Qt],ce+Kt[Qt+1],ce+Kt[Qt+2]);if(Kt.length>0&&g&&this.elevationMode==="hd-road-base"){const Qt=g.elevation.isTunnel(),Tt=g.elevation.safeArea,Wt=this.elevatedStructures.addVertices(_t,St);this.elevatedStructures.addTriangles(Kt,Wt,Qt);const ti=Pt.length;if(ti>0){for(let ci=0;ci<ti-1;ci++)this.elevatedStructures.addRenderableRing(g.index,Pt[ci]+Wt,Pt[ci+1]-Pt[ci],Qt,Tt,g.featureInfo);this.elevatedStructures.addRenderableRing(g.index,Pt[ti-1]+Wt,_t.length-Pt[ti-1],Qt,Tt,g.featureInfo)}}ae.vertexLength+=X,ae.primitiveLength+=Kt.length/3}return[y,T]}prepareElevatedPolygons(s,c,g){const y=1/Ji(g),T=[];for(const E of s){const D=eb(E,new No(c,y));T.push(...D)}return T}clipPolygonsToTile(s,c){const g=-c,y=-c,T=Fr+c,E=Fr+c;let D=0;const W=[],X=[];for(;D<s.length;D++){const fe=s[D],ye=tf(fe);(ye.min.x>=g&&ye.max.x<=T&&ye.min.y>=y&&ye.max.y<=E?W:X).push(fe)}if(W.length===s.length)return s;const ae=[new rr(g,y),new rr(T,y),new rr(T,E),new rr(g,E),new rr(g,y)],ce=W;for(const fe of X)ce.push(...Qx(fe,ae));return ce}}let fy,dy,my,gy;jr(Mg,"FillBucket",{omit:["layers","patternFeatures"]}),jr(Eg,"FillBufferData"),jr(ta,"ElevatedStructures");class Ag{constructor(s,c,g,y){if(this.triangleCount=c.length/3,this.min=new rr(0,0),this.max=new rr(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[T,E]=[s[0].clone(),s[0].clone()];for(let ce=1;ce<s.length;++ce){const fe=s[ce];T.x=Math.min(T.x,fe.x),T.y=Math.min(T.y,fe.y),E.x=Math.max(E.x,fe.x),E.y=Math.max(E.y,fe.y)}if(y){const ce=Math.ceil(Math.max(E.x-T.x,E.y-T.y)/y);g=Math.max(g,ce)}if(g===0)return;this.min=T,this.max=E;const D=this.max.sub(this.min);D.x=Math.max(D.x,1),D.y=Math.max(D.y,1);const W=Math.max(D.x,D.y)/g;this.cellsX=Math.max(1,Math.ceil(D.x/W)),this.cellsY=Math.max(1,Math.ceil(D.y/W)),this.xScale=1/W,this.yScale=1/W;const X=[];for(let ce=0;ce<this.triangleCount;ce++){const fe=s[c[3*ce+0]].sub(this.min),ye=s[c[3*ce+1]].sub(this.min),_t=s[c[3*ce+2]].sub(this.min),St=nl(Math.floor(Math.min(fe.x,ye.x,_t.x)),this.xScale,this.cellsX),Pt=nl(Math.floor(Math.max(fe.x,ye.x,_t.x)),this.xScale,this.cellsX),zt=nl(Math.floor(Math.min(fe.y,ye.y,_t.y)),this.yScale,this.cellsY),Kt=nl(Math.floor(Math.max(fe.y,ye.y,_t.y)),this.yScale,this.cellsY),Qt=new rr(0,0),Tt=new rr(0,0),Wt=new rr(0,0),ti=new rr(0,0);for(let ci=zt;ci<=Kt;++ci){Qt.y=Tt.y=ci*W,Wt.y=ti.y=(ci+1)*W;for(let ki=St;ki<=Pt;++ki)Qt.x=Wt.x=ki*W,Tt.x=ti.x=(ki+1)*W,(dg(fe,ye,_t,Qt,Tt,ti)||dg(fe,ye,_t,Qt,ti,Wt))&&X.push({cellIdx:ci*this.cellsX+ki,triIdx:ce})}}if(X.length===0)return;X.sort((ce,fe)=>ce.cellIdx-fe.cellIdx||ce.triIdx-fe.triIdx);let ae=0;for(;ae<X.length;){const ce=X[ae].cellIdx,fe={start:this.payload.length,len:0};for(;ae<X.length&&X[ae].cellIdx===ce;)++fe.len,this.payload.push(X[ae++].triIdx);this.cells[ce]=fe}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,c){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const g=nl(s.x-this.min.x,this.xScale,this.cellsX),y=nl(s.y-this.min.y,this.yScale,this.cellsY),T=this.cells[y*this.cellsX+g];if(T){this._lazyInitLookup();for(let E=0;E<T.len;E++){const D=this.payload[T.start+E],W=Math.floor(D/8),X=1<<D%8;if(!(this.lookup[W]&X)&&(this.lookup[W]|=X,c.push(D),c.length===this.triangleCount))return}}}query(s,c,g){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>c.x||s.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const y=nl(s.x-this.min.x,this.xScale,this.cellsX),T=nl(c.x-this.min.x,this.xScale,this.cellsX),E=nl(s.y-this.min.y,this.yScale,this.cellsY),D=nl(c.y-this.min.y,this.yScale,this.cellsY);for(let W=E;W<=D;W++)for(let X=y;X<=T;X++){const ae=this.cells[W*this.cellsX+X];if(ae)for(let ce=0;ce<ae.len;ce++){const fe=this.payload[ae.start+ce],ye=Math.floor(fe/8),_t=1<<fe%8;if(!(this.lookup[ye]&_t)&&(this.lookup[ye]|=_t,g.push(fe),g.length===this.triangleCount))return}}}}function nl(u,s,c){return Math.max(0,Math.min(c-1,Math.floor(u*s)))}jr(Ag,"TriangleGridIndex");class yy{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[],this.worldview=s.worldview}updateFootprints(s,c){for(const g of this.footprints)c.push({footprint:g,id:s})}populate(s,c,g,y){const T=[];for(const{feature:E,id:D,index:W,sourceLayerIndex:X}of s){const ae=this.layers[0]._featureFilter.needGeometry,ce=Ur(E,ae);if(!this.layers[0]._featureFilter.filter(new ps(this.zoom,{worldview:this.worldview}),ce,g))continue;const fe={id:D,properties:E.properties,type:E.type,sourceLayerIndex:X,index:W,geometry:ae?ce.geometry:qr(E,g,y),patterns:{}};T.push(fe)}for(const E of T){const{geometry:D,index:W,sourceLayerIndex:X}=E;this.addFeature(E,D,W,g,{},c.availableImages,c.brightness),c.featureIndex.insert(s[W].feature,D,W,X,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,c,g,y,T,E,D){}destroy(){}addFeature(s,c,g,y,T,E=[],D){for(const W of $p(c,2)){const X=[],ae=[],ce=[],fe=new rr(1/0,1/0),ye=new rr(-1/0,-1/0);for(const Pt of W)if(Pt.length!==0){Pt!==W[0]&&ce.push(ae.length/2);for(let zt=0;zt<Pt.length;zt++)ae.push(Pt[zt].x),ae.push(Pt[zt].y),X.push(Pt[zt]),fe.x=Math.min(fe.x,Pt[zt].x),fe.y=Math.min(fe.y,Pt[zt].y),ye.x=Math.max(ye.x,Pt[zt].x),ye.y=Math.max(ye.y,Pt[zt].y)}const _t=ed(ae,ce),St=new Ag(X,_t,8,256);this.footprints.push({vertices:X,indices:_t,grid:St,min:fe,max:ye})}}}jr(yy,"ClipBucket",{omit:["layers"]});const tb=Zn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ib=Zn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rb=Zn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),nb=Zn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),sb=Zn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),ab=Zn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:lb}=tb,Gp=Number.MAX_SAFE_INTEGER;function vy(u,s,c,g){return u.order<s||u.order===Gp||!(u.clipMask&c)||function(y,T){return T.length!==0&&T.find(E=>E===y)===void 0}(g,u.clipScope)}function Hp(u,s){return u.x-s.x||u.y-s.y}function xy(u,s){return Hp(u.min,s.min)===0&&Hp(u.max,s.max)===0}function Cg(u,s){return!(u.min.x>s.max.x||u.max.x<s.min.x||u.min.y>s.max.y||u.max.y<s.min.y)}function Pg(u,s){if(u.length!==s.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==s[c].sourceId||!xy(u[c],s[c])||u[c].order!==s[c].order||u[c].clipMask!==s[c].clipMask||!Ki(u[c].clipScope,s[c].clipScope))return!1;return!0}function by(u,s,c){const g=1/Fr,y=1/(1<<c.canonical.z),T=(s.x*g+c.canonical.x)*y+c.wrap,E=(s.y*g+c.canonical.y)*y;return{min:new rr((u.x*g+c.canonical.x)*y+c.wrap,(u.y*g+c.canonical.y)*y),max:new rr(T,E)}}function cb(u,s,c){const g=1<<c.canonical.z,y=((s.x-c.wrap)*g-c.canonical.x)*Fr,T=(s.y*g-c.canonical.y)*Fr;return{min:new rr(((u.x-c.wrap)*g-c.canonical.x)*Fr,(u.y*g-c.canonical.y)*Fr),max:new rr(y,T)}}function wy(u,s,c,g,y,T,E){const D=u.indices,W=u.vertices,X=[];for(let ae=g;ae<g+y;ae+=3){const ce=s[c[ae+0]+T],fe=s[c[ae+1]+T],ye=s[c[ae+2]+T],_t=Math.min(ce.x,fe.x,ye.x),St=Math.max(ce.x,fe.x,ye.x),Pt=Math.min(ce.y,fe.y,ye.y),zt=Math.max(ce.y,fe.y,ye.y);X.length=0,u.grid.query(new rr(_t,Pt),new rr(St,zt),X);for(let Kt=0;Kt<X.length;Kt++){const Qt=X[Kt];if(dg(W[D[3*Qt+0]],W[D[3*Qt+1]],W[D[3*Qt+2]],ce,fe,ye,E))return!0}}return!1}function Sy(u,s,c,g){if(!u||!c)return!1;let y=u.vertices;if(!s.canonical.equals(g.canonical)||s.wrap!==g.wrap){if(c.vertices.length<u.vertices.length)return Sy(c,g,u,s);const T=s.canonical,E=g.canonical,D=Math.pow(2,E.z-T.z);y=u.vertices.map(W=>new rr((W.x+T.x*Fr)*D-E.x*Fr,(W.y+T.y*Fr)*D-E.y*Fr))}return wy(c,y,u.indices,0,u.indices.length,0,0)}function Ty(u,s,c,g){const y=Math.pow(2,g.z-c.z);return new rr((u+c.x*Fr)*y-g.x*Fr,(s+c.y*Fr)*y-g.y*Fr)}function Ey(u,s){const c=[];s.grid.queryPoint(u,c);const g=s.indices,y=s.vertices;for(let T=0;T<c.length;T++){const E=c[T];if(_a([y[g[3*E+0]],y[g[3*E+1]],y[g[3*E+2]]],u))return!0}return!1}const Ig=[new rr(0,0),new rr(Fr,0),new rr(Fr,Fr),new rr(0,Fr)];function My(u,s){const c=[];let g=[];if(!s||u.length<2)return[u];if(u.length===2)return Il(u[0],u[1],Ig)?[u]:[];for(let y=0;y<u.length+2;y++){const T=u[y%u.length],E=u[(y+1)%u.length],D=Il(y===0?u[u.length-1]:u[(y-1)%u.length],T,Ig),W=Il(T,E,Ig),X=D||W;X&&g.push(T),X&&W||g.length>0&&(g.length>1&&c.push(g),g=[])}return g.length>1&&c.push(g),c}const Rg=Cn.VectorTileFeature.types,ub=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],hb=["fill-extrusion-flood-light-ground-radius"],fb=Math.pow(2,13),db=Math.pow(2,15)-1,Ay=new rr(0,1),_c=2147483648;function sd(u,s,c,g,y,T,E,D){u.emplaceBack((s<<1)+E,(c<<1)+T,(Math.floor(g*fb)<<1)+y,Math.round(D))}function od(u,s,c){u.emplaceBack(s.x*Fr,s.y*Fr,c?1:0)}function jp(u,s,c,g,y,T){u.emplaceBack(s.x,s.y,(c.x<<1)+g,(c.y<<1)+y,T)}function ad(u,s,c){u.emplaceBack(s.x,s.y,s.z,c[0]*16384,c[1]*16384,c[2]*16384)}class Cy{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Py{constructor(){this.centroidXY=new rr(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new rr(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new rr(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new rr(this.max.x-this.min.x,this.max.y-this.min.y)}}class Iy{constructor(){this.acc=new rr(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,c){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=c.x,s.min.y=s.max.y=c.y)}appendEdge(s,c,g){this.accCount++,this.acc._add(c);let y=!!this.borders;c.x<s.min.x?(s.min.x=c.x,y=!0):c.x>s.max.x&&(s.max.x=c.x,y=!0),c.y<s.min.y?(s.min.y=c.y,y=!0):c.y>s.max.y&&(s.max.y=c.y,y=!0),((c.x===0||c.x===Fr)&&c.x===g.x)!=((c.y===0||c.y===Fr)&&c.y===g.y)&&this.processBorderOverlap(c,g),y&&this.checkBorderIntersection(c,g)}checkBorderIntersection(s,c){c.x<0!=s.x<0&&this.addBorderIntersection(0,pn(c.y,s.y,(0-c.x)/(s.x-c.x))),c.x>Fr!=s.x>Fr&&this.addBorderIntersection(1,pn(c.y,s.y,(Fr-c.x)/(s.x-c.x))),c.y<0!=s.y<0&&this.addBorderIntersection(2,pn(c.x,s.x,(0-c.y)/(s.y-c.y))),c.y>Fr!=s.y>Fr&&this.addBorderIntersection(3,pn(c.x,s.x,(Fr-c.y)/(s.y-c.y)))}addBorderIntersection(s,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const g=this.borders[s];c<g[0]&&(g[0]=c),c>g[1]&&(g[1]=c)}processBorderOverlap(s,c){if(s.x===c.x){if(s.y===c.y)return;const g=s.x===0?0:1;this.addBorderIntersection(g,c.y),this.addBorderIntersection(g,s.y)}else{const g=s.y===0?2:3;this.addBorderIntersection(g,c.x),this.addBorderIntersection(g,s.x)}}centroid(){return this.accCount===0?new rr(0,0):new rr(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,c)=>s+ +(c[0]!==Number.MAX_VALUE),0):0}}function Ry(u,s){const c=u.add(s)._unit(),g=Jt(u.x*c.x+u.y*c.y,-1,1);var y,T,E;return y=Math.acos(g),Math.min(4,Math.max(-4,Math.tan(y)))/4*db*((T=u).x*(E=s).y-T.y*E.x<0?-1:1)}const pb=[u=>u.x<0,u=>u.x>Fr,u=>u.y<0,u=>u.y>Fr];function mb(u,s,c,g){const y=[4];if(g===0)return y;c._mult(g);const T=u.sub(c),E=s.sub(c),D=[u,s,T,E];for(let W=0;W<4;W++)for(const X of D)if(pb[W](X)){y.push(W);break}return y}class Ly{constructor(s){this.vertexArray=new sc,this.indexArray=new go,this.programConfigurations=new b(s.layers,{zoom:s.zoom,lut:s.lut},c=>hb.includes(c)),this._segments=new Hs,this.hiddenByLandmarkVertexArray=new xh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Hs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,c,g,y=!1){const T=s.length;if(T>2){let E=Math.max(0,this._segments.get().length-1);const D=this._segments._prepareSegment(4*T,this.vertexArray.length,2*this._segmentToGroundQuads[E].length);let W;E!==this._segments.get().length-1&&(E++,this._segmentToGroundQuads[E]=[],this._segmentToRegionTriCounts[E]=[0,0,0,0,0]);{const X=s[0],ae=s[1];W=Ry(X.sub(s[T-1])._perp()._unit(),ae.sub(X)._perp()._unit())}for(let X=0;X<T;X++){const ae=X===T-1?0:X+1,ce=s[X],fe=s[ae],ye=s[ae===T-1?0:ae+1],_t=fe.sub(ce)._perp()._unit(),St=Ry(_t,ye.sub(fe)._perp()._unit()),Pt=W,zt=St;if(Lg(ce,fe,c)||y&&Fy(ce,c)&&Fy(fe,c)){W=St;continue}const Kt=D.vertexLength;jp(this.vertexArray,ce,fe,1,1,Pt),jp(this.vertexArray,ce,fe,1,0,Pt),jp(this.vertexArray,ce,fe,0,1,zt),jp(this.vertexArray,ce,fe,0,0,zt),D.vertexLength+=4;const Qt=mb(ce,fe,_t,g);for(const Tt of Qt)this._segmentToGroundQuads[E].push({id:Kt,region:Tt}),this._segmentToRegionTriCounts[E][Tt]+=2,D.primitiveLength+=2;W=St}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),c=s.length;for(let g=0;g<c;g++)this._segmentToGroundQuads[g].sort((y,T)=>y.region-T.region);for(let g=0;g<c;g++){const y=this._segmentToGroundQuads[g],T=s[g],E=this._segmentToRegionTriCounts[g];E.reduce((W,X)=>W+X,0);let D=0;for(let W=0;W<=4;W++){const X=E[W];if(X!==0){let ae=this.regionSegments[W];ae||(ae=this.regionSegments[W]=new Hs);const ce={vertexOffset:T.vertexOffset,primitiveOffset:T.primitiveOffset+D,vertexLength:T.vertexLength,primitiveLength:X};ae.get().push(ce)}D+=X}for(let W=0;W<y.length;W++){const X=y[W].id;this.indexArray.emplaceBack(X,X+1,X+3),this.indexArray.emplaceBack(X,X+3,X+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,c,g,y,T,E,D){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,c,g,y,T,E,void 0,D)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,ib.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,c,g,y,T,E,D,W){this.hasData()&&this.programConfigurations.updatePaintArrays(s,c,g,y,T,E,D,W)}updateHiddenByLandmark(s){if(!this.hasData())return;const c=s.groundVertexCount+s.groundVertexArrayOffset;if(s.groundVertexCount===0)return;const g=s.flags&_c?1:0;for(let y=s.groundVertexArrayOffset;y<c;++y)this.hiddenByLandmarkVertexArray.emplace(y,g);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,sb.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const c=this.regionSegments[s];c&&c.destroy()}}}}class Wp{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new go,this.footprintVertices=new Ia,this.footprintSegments=[],this.layoutVertexArray=new nc,this.centroidVertexArray=new Ap,this.wallVertexArray=new Pp,this.indexArray=new go,this.programConfigurations=new b(s.layers,{zoom:s.zoom,lut:s.lut},c=>ub.includes(c)),this.segments=new Hs,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new Ly(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=s.worldview}updateFootprints(s,c){}populate(s,c,g,y){this.features=[],this.hasPattern=wg("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ji(g),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:T,id:E,index:D,sourceLayerIndex:W}of s){const X=this.layers[0]._featureFilter.needGeometry,ae=Ur(T,X);if(!this.layers[0]._featureFilter.filter(new ps(this.zoom,{worldview:this.worldview}),ae,g))continue;const ce={id:E,sourceLayerIndex:W,index:D,geometry:X?ae.geometry:qr(T,g,y),properties:T.properties,type:T.type,patterns:{}},fe=this.layoutVertexArray.length,ye=Rg[ce.type]==="Polygon";if(this.hasPattern)this.features.push(Sg("fill-extrusion",this.layers,ce,this.zoom,this.pixelRatio,c));else if(this.wallMode)for(const _t of ce.geometry)for(const St of My(_t,ye))this.addFeature(ce,[St],D,g,{},c.availableImages,y,c.brightness);else this.addFeature(ce,ce.geometry,D,g,{},c.availableImages,y,c.brightness);c.featureIndex.insert(T,ce.geometry,D,W,this.index,fe)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,c,g,y,T,E){for(const D of this.features){const W=Rg[D.type]==="Polygon",{geometry:X}=D;if(this.wallMode)for(const ae of X)for(const ce of My(ae,W))this.addFeature(D,[ce],D.index,c,g,y,T,E);else this.addFeature(D,X,D.index,c,g,y,T,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,c,g,y,T,E,D){this.programConfigurations.updatePaintArrays(s,c,T,g,y,E,D,this.worldview),this.groundEffect.update(s,c,T,g,y,E,D,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,lb),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,nb.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,ab.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,rb.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,c,g,y,T,E,D,W){const X=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,ae=[new rr(0,0),new rr(Fr,Fr)],ce=D.projection,fe=ce.name==="globe",ye=this.wallMode||Rg[s.type]==="Polygon",_t=new Iy;_t.centroidDataIndex=this.centroidData.length;const St=new Py,Pt=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},y)<=0,zt=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},y);let Kt;if(St.height=zt,St.vertexArrayOffset=this.layoutVertexArray.length,St.groundVertexArrayOffset=this.groundEffect.vertexArray.length,fe&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _h),this.wallMode){if(fe)return void yn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;Kt=function(Di){const Vi=Di[0].x===Di[Di.length-1].x&&Di[0].y===Di[Di.length-1].y;(function(zr){let Ar=0;const vn=zr.length;for(let Zr=0;Zr<vn;Zr++)Ar+=(zr[(Zr+1)%vn].x-zr[Zr].x)*(zr[(Zr+1)%vn].y+zr[Zr].y);return Ar>=0})(Di)||(Di=Di.reverse());const br={geometry:[],joinNormals:[],indices:[]},hr=[],xr=[],Sr=[];let tr=Di.length;for(;tr>=2&&Di[tr-1].equals(Di[tr-2]);)tr--;if(tr<(Vi?3:2))return br;let yr,Yi,er,Cr,Lr,an=0;for(;an<tr-1&&Di[an].equals(Di[an+1]);)an++;Vi&&(yr=Di[tr-2],Lr=Di[an].sub(yr)._unit()._perp());for(let zr=an;zr<tr;zr++){if(er=zr===tr-1?Vi?Di[an+1]:void 0:Di[zr+1],er&&Di[zr].equals(er))continue;Lr&&(Cr=Lr),yr&&(Yi=yr),yr=Di[zr],Lr=er?er.sub(yr)._unit()._perp():Cr,Cr=Cr||Lr;let Ar=Cr.add(Lr);Ar.x===0&&Ar.y===0||Ar._unit();const vn=Ar.x*Lr.x+Ar.y*Lr.y,Zr=vn!==0?1/vn:1/0,Kr=Cr.x*Lr.y-Cr.y*Lr.x>0;let mn="miter";const Tn=2;mn==="miter"&&Zr>Tn&&(mn="bevel"),mn==="bevel"&&(Zr>100&&(mn="flipbevel"),Zr<Tn&&(mn="miter"));const bn=(Rn,Mn,Ln,os)=>{const Ts=new rr(Rn.x,Rn.y),ai=new rr(Rn.x,Rn.y);Ts.x+=Mn.x*os,Ts.y+=Mn.y*os,ai.x-=Mn.x*Math.max(Ln,1),ai.y-=Mn.y*Math.max(Ln,1),Sr.push(Mn),hr.push(Ts),xr.push(ai)};if(mn==="miter")Ar._mult(Zr),bn(yr,Ar,0,0);else if(mn==="flipbevel")Ar=Lr.mult(-1),bn(yr,Ar,0,0),bn(yr,Ar.mult(-1),0,0);else{const Rn=-Math.sqrt(Zr*Zr-1),Mn=Kr?Rn:0,Ln=Kr?0:Rn;Yi&&bn(yr,Cr,Mn,Ln),er&&bn(yr,Lr,Mn,Ln)}}br.geometry=[...hr,...xr.reverse(),hr[0]],br.joinNormals=[...Sr,...Sr.reverse(),Sr[Sr.length-1]];const Yr=br.geometry.length-1;for(let zr=0;zr<Yr/2;zr++)if(zr+1<Yr/2){let Ar=zr,vn=zr+1,Zr=Yr-1-zr,Kr=Yr-2-zr;Ar=Ar===0?Yr-1:Ar-1,vn=vn===0?Yr-1:vn-1,Zr=Zr===0?Yr-1:Zr-1,Kr=Kr===0?Yr-1:Kr-1,br.indices.push(Zr),br.indices.push(vn),br.indices.push(Ar),br.indices.push(Zr),br.indices.push(Kr),br.indices.push(vn)}return br}(c[0]),c=[Kt.geometry]}const Qt=(Di,Vi)=>Di<(Vi.length-1)/2||Di===Vi.length-1,Tt=this.wallMode?[c]:$p(c,500);for(let Di=Tt.length-1;Di>=0;Di--){const Vi=Tt[Di];(Vi.length===0||(Wt=Vi[0]).every(Qi=>Qi.x<=0)||Wt.every(Qi=>Qi.x>=Fr)||Wt.every(Qi=>Qi.y<=0)||Wt.every(Qi=>Qi.y>=Fr))&&Tt.splice(Di,1)}var Wt;let ti;if(fe)ti=Ny(Tt,ae,y);else{ti=[];for(const Di of Tt)ti.push({polygon:Di,bounds:ae})}const ci=ye?this.edgeRadius:0,ki=ci>0&&this.zoom<17,Ci=(Di,Vi)=>{if(Di.length===0)return!1;const Qi=Di[Di.length-1];return Vi.x===Qi.x&&Vi.y===Qi.y};for(const{polygon:Di,bounds:Vi}of ti){let Qi=0,br=0;for(const tr of Di)ye&&!tr[0].equals(tr[tr.length-1])&&tr.push(tr[0]),br+=ye?tr.length-1:tr.length;const hr=this.segments.prepareSegment((ye?5:4)*br,this.layoutVertexArray,this.indexArray);St.footprintSegIdx<0&&(St.footprintSegIdx=this.footprintSegments.length),St.polygonSegIdx<0&&(St.polygonSegIdx=this.polygonSegments.length);const xr={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Sr=new Cy;if(Sr.vertexOffset=this.footprintVertices.length,Sr.indexOffset=3*this.footprintIndices.length,Sr.ringIndices=[],ye){const tr=[],yr=[];Qi=hr.vertexLength;for(let er=0;er<Di.length;er++){const Cr=Di[er];Cr.length&&er!==0&&yr.push(tr.length/2);const Lr=[];let an,Yr;an=Cr[1].sub(Cr[0])._perp()._unit(),Sr.ringIndices.push(Cr.length-1);for(let zr=1;zr<Cr.length;zr++){const Ar=Cr[zr],vn=Cr[zr===Cr.length-1?1:zr+1],Zr=Ar.clone();if(ci){Yr=vn.sub(Ar)._perp()._unit();const Kr=an.add(Yr)._unit(),mn=ci*Math.min(4,1/(an.x*Kr.x+an.y*Kr.y));Zr.x+=mn*Kr.x,Zr.y+=mn*Kr.y,Zr.x=Math.round(Zr.x),Zr.y=Math.round(Zr.y),an=Yr}if(!Pt||ci!==0&&!ki||Ci(Lr,Zr)||Lr.push(Zr),sd(this.layoutVertexArray,Zr.x,Zr.y,0,0,1,1,0),this.wallMode){const Kr=Qt(zr,Cr);od(this.wallVertexArray,Kt.joinNormals[zr],!Kr)}hr.vertexLength++,this.footprintVertices.emplaceBack(Ar.x,Ar.y),tr.push(Ar.x,Ar.y),fe&&ad(this.layoutVertexExtArray,ce.projectTilePoint(Zr.x,Zr.y,y),ce.upVector(y,Zr.x,Zr.y))}Pt&&(ci===0||ki)&&(Lr.length!==0&&Ci(Lr,Lr[0])&&Lr.pop(),this.groundEffect.addData(Lr,Vi,X))}const Yi=this.wallMode?Kt.indices:ed(tr,yr);for(let er=0;er<Yi.length;er+=3)this.footprintIndices.emplaceBack(Sr.vertexOffset+Yi[er+0],Sr.vertexOffset+Yi[er+1],Sr.vertexOffset+Yi[er+2]),this.indexArray.emplaceBack(Qi+Yi[er],Qi+Yi[er+2],Qi+Yi[er+1]),hr.primitiveLength++;Sr.indexCount+=Yi.length,Sr.vertexCount+=this.footprintVertices.length-Sr.vertexOffset}for(let tr=0;tr<Di.length;tr++){const yr=Di[tr];_t.startRing(St,yr[0]);let Yi=yr.length>4&&Oy(yr[yr.length-2],yr[0],yr[1]),er=ci?gb(yr[yr.length-2],yr[0],yr[1],ci):0;const Cr=[];let Lr,an,Yr;an=yr[1].sub(yr[0])._perp()._unit();let zr=!0;for(let Ar=1,vn=0;Ar<yr.length;Ar++){let Zr=yr[Ar-1],Kr=yr[Ar];const mn=yr[Ar===yr.length-1?1:Ar+1];if(_t.appendEdge(St,Kr,Zr),Lg(Kr,Zr,Vi)){ci&&(an=mn.sub(Kr)._perp()._unit(),zr=!zr);continue}const Tn=Kr.sub(Zr)._perp(),bn=Tn.x/(Math.abs(Tn.x)+Math.abs(Tn.y)),Rn=Tn.y>0?1:0,Mn=Zr.dist(Kr);if(vn+Mn>32768&&(vn=0),ci){Yr=mn.sub(Kr)._perp()._unit();let ai=Dy(Zr,Kr,mn,ky(an,Yr),ci);isNaN(ai)&&(ai=0);const hi=Kr.sub(Zr)._unit();Zr=Zr.add(hi.mult(er))._round(),Kr=Kr.add(hi.mult(-ai))._round(),er=ai,an=Yr,Pt&&this.zoom>=17&&(Ci(Cr,Zr)||Cr.push(Zr),Ci(Cr,Kr)||Cr.push(Kr))}const Ln=hr.vertexLength,os=yr.length>4&&Oy(Zr,Kr,mn);let Ts=zy(vn,Yi,zr);if(sd(this.layoutVertexArray,Zr.x,Zr.y,bn,Rn,0,0,Ts),sd(this.layoutVertexArray,Zr.x,Zr.y,bn,Rn,0,1,Ts),this.wallMode){const ai=Qt(Ar-1,yr),hi=Kt.joinNormals[Ar-1];od(this.wallVertexArray,hi,ai),od(this.wallVertexArray,hi,ai)}if(vn+=Mn,Ts=zy(vn,os,!zr),Yi=os,sd(this.layoutVertexArray,Kr.x,Kr.y,bn,Rn,0,0,Ts),sd(this.layoutVertexArray,Kr.x,Kr.y,bn,Rn,0,1,Ts),this.wallMode){const ai=Qt(Ar,yr),hi=Kt.joinNormals[Ar];od(this.wallVertexArray,hi,ai),od(this.wallVertexArray,hi,ai)}if(hr.vertexLength+=4,this.indexArray.emplaceBack(Ln+0,Ln+1,Ln+2),this.indexArray.emplaceBack(Ln+1,Ln+3,Ln+2),hr.primitiveLength+=2,ci){const ai=Qi+(Ar===1?yr.length-2:Ar-2),hi=Ar===1?Qi:ai+1;if(this.indexArray.emplaceBack(Ln+1,ai,Ln+3),this.indexArray.emplaceBack(ai,hi,Ln+3),hr.primitiveLength+=2,Lr===void 0&&(Lr=Ln),!Lg(mn,yr[Ar],Vi)){const sr=Ar===yr.length-1?Lr:hr.vertexLength;this.indexArray.emplaceBack(Ln+2,Ln+3,sr),this.indexArray.emplaceBack(Ln+3,sr+1,sr),this.indexArray.emplaceBack(Ln+3,hi,sr+1),hr.primitiveLength+=3}zr=!zr}if(fe){const ai=this.layoutVertexExtArray,hi=ce.projectTilePoint(Zr.x,Zr.y,y),sr=ce.projectTilePoint(Kr.x,Kr.y,y),Dr=ce.upVector(y,Zr.x,Zr.y),Br=ce.upVector(y,Kr.x,Kr.y);ad(ai,hi,Dr),ad(ai,hi,Dr),ad(ai,sr,Br),ad(ai,sr,Br)}}ye&&(Qi+=yr.length-1),Pt&&ci&&this.zoom>=17&&(Cr.length!==0&&Ci(Cr,Cr[0])&&Cr.pop(),this.groundEffect.addData(Cr,Vi,X,ci>0))}this.footprintSegments.push(Sr),xr.triangleCount=this.indexArray.length-xr.triangleArrayOffset,this.polygonSegments.push(xr),++St.footprintSegLen,++St.polygonSegLen}if(St.vertexCount=this.layoutVertexArray.length-St.vertexArrayOffset,St.groundVertexCount=this.groundEffect.vertexArray.length-St.groundVertexArrayOffset,St.vertexCount!==0){if(St.centroidXY=_t.borders?Ay:this.encodeCentroid(_t,St),this.centroidData.push(St),_t.borders){this.featuresOnBorder.push(_t);const Di=this.featuresOnBorder.length-1;for(let Vi=0;Vi<_t.borders.length;Vi++)_t.borders[Vi][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Vi].push(Di)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,T,E,y,W,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,g,T,E,y,W,this.worldview),this.maxHeight=Math.max(this.maxHeight,zt)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((c,g)=>this.featuresOnBorder[c].borders[s][0]-this.featuresOnBorder[g].borders[s][0])}splitToSubtiles(){const s=[];for(let D=0;D<this.centroidData.length;D++){const W=this.centroidData[D],X=+(W.min.y+W.max.y>Fr),ae=2*X+(+(W.min.x+W.max.x>Fr)^X);for(let ce=0;ce<W.polygonSegLen;ce++){const fe=W.polygonSegIdx+ce;s.push({centroidIdx:D,subtile:ae,polygonSegmentIdx:fe,triangleSegmentIdx:this.polygonSegments[fe].triangleSegIdx})}}const c=new go;s.sort((D,W)=>D.triangleSegmentIdx===W.triangleSegmentIdx?D.subtile-W.subtile:D.triangleSegmentIdx-W.triangleSegmentIdx);let g=0,y=0,T=0;for(const D of s){if(D.triangleSegmentIdx!==g)break;T++}const E=s.length;for(;y!==s.length;){g=s[y].triangleSegmentIdx;let D=0,W=y,X=y;for(let ae=W;ae<T&&s[ae].subtile===D;ae++)X++;for(;W!==T;){const ae=s[W];D=ae.subtile;const ce=this.centroidData[ae.centroidIdx].min.clone(),fe=this.centroidData[ae.centroidIdx].max.clone(),ye={vertexOffset:this.segments.segments[g].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[g].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let _t=W;_t<X;_t++){const St=s[_t],Pt=this.polygonSegments[St.polygonSegmentIdx],zt=this.centroidData[St.centroidIdx].min,Kt=this.centroidData[St.centroidIdx].max,Qt=this.indexArray.uint16;for(let Tt=Pt.triangleArrayOffset;Tt<Pt.triangleArrayOffset+Pt.triangleCount;Tt++)c.emplaceBack(Qt[3*Tt],Qt[3*Tt+1],Qt[3*Tt+2]);ye.primitiveLength+=Pt.triangleCount,ce.x=Math.min(ce.x,zt.x),ce.y=Math.min(ce.y,zt.y),fe.x=Math.max(fe.x,Kt.x),fe.y=Math.max(fe.y,Kt.y)}ye.primitiveLength>0&&this.triangleSubSegments.push({segment:ye,min:ce,max:fe}),W=X;for(let _t=W;_t<T&&s[_t].subtile===s[W].subtile;_t++)X++}y=T;for(let ae=y;ae<E&&s[ae].triangleSegmentIdx===s[y].triangleSegmentIdx;ae++)T++}c._trim(),this.indexArray=c}getVisibleSegments(s,c,g){const y=new Hs;if(this.wallMode){for(const St of this.triangleSubSegments)y.segments.push(St.segment);return y}let T=0,E=0;const D=1<<s.canonical.z;if(c){const St=c.getMinMaxForTile(s);St&&(T=St.min,E=St.max)}E+=this.maxHeight;const W=s.toUnwrapped();let X;const ae=[W.canonical.x/D+W.wrap,W.canonical.y/D],ce=[(W.canonical.x+1)/D+W.wrap,(W.canonical.y+1)/D],fe=(St,Pt,zt)=>[St[0]*(1-zt[0])+Pt[0]*zt[0],St[1]*(1-zt[1])+Pt[1]*zt[1]],ye=[],_t=[];for(const St of this.triangleSubSegments){ye[0]=St.min.x/Fr,ye[1]=St.min.y/Fr,_t[0]=St.max.x/Fr,_t[1]=St.max.y/Fr;const Pt=fe(ae,ce,ye),zt=fe(ae,ce,_t);if(new Yn([Pt[0],Pt[1],T],[zt[0],zt[1],E]).intersectsPrecise(g)===0){X&&(y.segments.push(X),X=void 0);continue}const Kt=St.segment;X&&X.vertexOffset!==Kt.vertexOffset&&(y.segments.push(X),X=void 0),X?(X.vertexLength+=Kt.vertexLength,X.primitiveLength+=Kt.primitiveLength):X={vertexOffset:Kt.vertexOffset,primitiveLength:Kt.primitiveLength,vertexLength:Kt.vertexLength,primitiveOffset:Kt.primitiveOffset,sortKey:void 0,vaos:{}}}return X&&y.segments.push(X),y}encodeCentroid(s,c){const g=s.centroid(),y=c.span(),T=Math.min(7,Math.round(y.x*this.tileToMeter/10)),E=Math.min(7,Math.round(y.y*this.tileToMeter/10));return new rr(Jt(g.x,1,Fr-1)<<3|T,Jt(g.y,1,Fr-1)<<3|E)}encodeBorderCentroid(s){if(!s.borders)return new rr(0,0);const c=s.borders,g=Number.MAX_VALUE;if(c[0][0]!==g||c[1][0]!==g){const y=c[0][0]!==g?0:1;return new rr(6|(c[0][0]!==g?0:65528),(c[y][0]+c[y][1])/2<<3|6)}{const y=c[2][0]!==g?2:3;return new rr((c[y][0]+c[y][1])/2<<3|6,6|(c[2][0]!==g?0:65528))}}showCentroid(s){const c=this.centroidData[s.centroidDataIndex];c.flags&=_c,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const c=s.vertexArrayOffset,g=s.vertexCount+s.vertexArrayOffset,y=s.flags&_c?Ay:s.centroidXY,T=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==y.y||T!==y.x){for(let E=c;E<g;++E)this.centroidVertexArray.emplace(E,y.x,y.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,c,g){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const y=c.getReplacementRegionsForTile(s.toUnwrapped());if(Pg(this.activeReplacements,y))return;if(this.activeReplacements=y,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const E of this.centroidData)E.flags&=2147483647;const T=[];for(const E of this.activeReplacements){if(E.order<g)continue;const D=Math.max(1,Math.pow(2,E.footprintTileId.canonical.z-s.canonical.z));for(const W of this.centroidData)if(!(W.flags&_c||E.min.x>W.max.x||W.min.x>E.max.x||E.min.y>W.max.y||W.min.y>E.max.y))for(let X=0;X<W.footprintSegLen;X++){const ae=this.footprintSegments[W.footprintSegIdx+X];if(T.length=0,_b(this.footprintVertices,ae.vertexOffset,ae.vertexCount,E.footprintTileId.canonical,s.canonical,T),wy(E.footprint,T,this.footprintIndices.uint16,ae.indexOffset,ae.indexCount,-ae.vertexOffset,-D)){W.flags|=_c;break}}}for(const E of this.centroidData)this.writeCentroidToBuffer(E);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,c,g){let y=!1;for(let T=0;T<g.footprintSegLen;T++){const E=this.footprintSegments[g.footprintSegIdx+T];let D=0;for(const W of E.ringIndices){for(let X=D,ae=W+D-1;X<W+D;ae=X++){const ce=this.footprintVertices.int16[2*(X+E.vertexOffset)+0],fe=this.footprintVertices.int16[2*(X+E.vertexOffset)+1],ye=this.footprintVertices.int16[2*(ae+E.vertexOffset)+1];fe>c!=ye>c&&s<(this.footprintVertices.int16[2*(ae+E.vertexOffset)+0]-ce)*(c-fe)/(ye-fe)+ce&&(y=!y)}D=W}}return y}getHeightAtTileCoord(s,c){let g=Number.NEGATIVE_INFINITY,y=!0;const T=4*(s+Fr)*Fr+(c+Fr);if(this.partLookup.hasOwnProperty(T)){const E=this.partLookup[T];return E?{height:E.height,hidden:!!(E.flags&_c)}:void 0}for(const E of this.centroidData)s>E.max.x||E.min.x>s||c>E.max.y||E.min.y>c||this.footprintContainsPoint(s,c,E)&&E&&E.height>g&&(g=E.height,this.partLookup[T]=E,y=!!(E.flags&_c));if(g!==Number.NEGATIVE_INFINITY)return{height:g,hidden:y};this.partLookup[T]=void 0}}function ky(u,s){const c=u.add(s)._unit();return u.x*c.x+u.y*c.y}function gb(u,s,c,g){const y=s.sub(u)._perp()._unit(),T=c.sub(s)._perp()._unit();return Dy(u,s,c,ky(y,T),g)}function Dy(u,s,c,g,y){const T=Math.sqrt(1-g*g);return Math.min(u.dist(s)/3,s.dist(c)/3,y*T/g)}function Lg(u,s,c){return u.x<c[0].x&&s.x<c[0].x||u.x>c[1].x&&s.x>c[1].x||u.y<c[0].y&&s.y<c[0].y||u.y>c[1].y&&s.y>c[1].y}function Fy(u,s){return u.x<s[0].x||u.x>s[1].x||u.y<s[0].y||u.y>s[1].y}function Oy(u,s,c){if(u.x<0||u.x>=Fr||s.x<0||s.x>=Fr||c.x<0||c.x>=Fr)return!1;const g=c.sub(s),y=g.perp(),T=u.sub(s);return(g.x*T.x+g.y*T.y)/Math.sqrt((g.x*g.x+g.y*g.y)*(T.x*T.x+T.y*T.y))>-.866&&y.x*T.x+y.y*T.y<0}function zy(u,s,c){const g=s?2|u:-3&u;return c?1|g:-2&g}function By(){const u=Math.PI/32,s=Math.tan(u),c=Ot;return c*Math.sqrt(1+2*s*s)-c}function Ny(u,s,c){const g=1<<c.z,y=Pi(c.x/g),T=Pi((c.x+1)/g),E=ji(c.y/g),D=ji((c.y+1)/g);return function(W,X,ae,ce,fe=0,ye){const _t=[];if(!W.length||!ae||!ce)return _t;const St=(ti,ci)=>{for(const ki of ti)_t.push({polygon:ki,bounds:ci})},Pt=Math.ceil(Math.log2(ae)),zt=Math.ceil(Math.log2(ce)),Kt=Pt-zt,Qt=[];for(let ti=0;ti<Math.abs(Kt);ti++)Qt.push(Kt>0?0:1);for(let ti=0;ti<Math.min(Pt,zt);ti++)Qt.push(0),Qt.push(1);let Tt=W;if(Tt=Up(Tt,X[0].y-fe,X[1].y+fe,1),Tt=Up(Tt,X[0].x-fe,X[1].x+fe,0),!Tt.length)return _t;const Wt=[];for(Qt.length?Wt.push({polygons:Tt,bounds:X,depth:0}):St(Tt,X);Wt.length;){const ti=Wt.pop(),ci=ti.depth,ki=Qt[ci],Ci=ti.bounds[0],Di=ti.bounds[1],Vi=ki===0?Ci.x:Ci.y,Qi=ki===0?Di.x:Di.y,br=ye?ye(ki,Vi,Qi):.5*(Vi+Qi),hr=Up(ti.polygons,Vi-fe,br+fe,ki),xr=Up(ti.polygons,br-fe,Qi+fe,ki);if(hr.length){const Sr=[Ci,new rr(ki===0?br:Di.x,ki===1?br:Di.y)];Qt.length>ci+1?Wt.push({polygons:hr,bounds:Sr,depth:ci+1}):St(hr,Sr)}if(xr.length){const Sr=[new rr(ki===0?br:Ci.x,ki===1?br:Ci.y),Di];Qt.length>ci+1?Wt.push({polygons:xr,bounds:Sr,depth:ci+1}):St(xr,Sr)}}return _t}(u,s,Math.ceil((T-y)/11.25),Math.ceil((E-D)/11.25),1,(W,X,ae)=>{if(W===0)return .5*(X+ae);{const ce=ji((c.y+X/Fr)/g);return(di(.5*(ji((c.y+ae/Fr)/g)+ce))*g-c.y)*Fr}})}function _b(u,s,c,g,y,T){const E=Math.pow(2,g.z-y.z);for(let D=0;D<c;D++){let W=u.int16[2*(D+s)+0],X=u.int16[2*(D+s)+1];W=(W+y.x*Fr)*E-g.x*Fr,X=(X+y.y*Fr)*E-g.y*Fr,T.push(new rr(W,X))}}let Vy,$y;jr(Wp,"FillExtrusionBucket",{omit:["layers","features"]}),jr(Py,"PartData"),jr(Cy,"FootprintSegment"),jr(Iy,"BorderCentroidData"),jr(Ly,"GroundEffect");class bu extends rr{constructor(s,c,g){super(s,c),this.z=g}}class Uy extends bu{constructor(s,c,g,y){super(s,c,g),this.w=y}}function Gy(u,s,c,g){const y=c==="x"?"y":"x",T=(g-u[c])/(s[c]-u[c]);u[y]=Math.round(u[y]+(s[y]-u[y])*T),u[c]=g,u.hasOwnProperty("z")&&(u.z=pn(u.z,s.z,T)),u.hasOwnProperty("w")&&(u.w=pn(u.w,s.w,T))}function Hy(u,s,c,g){const y=c,T=g;for(const E of["x","y"]){let D=u,W=s;D[E]>=W[E]&&(D=s,W=u),D[E]<y&&W[E]>y&&Gy(D,W,E,y),D[E]<T&&W[E]>T&&Gy(W,D,E,T)}}function qp(u,s,c,g,y,T){const E=[];for(let D=0;D<u.length;D++){const W=u[D];let X;const ae=E.length;let ce=0;for(let fe=0;fe<W.length-1;fe++){let ye=W[fe],_t=W[fe+1],St=0;const Pt=ce;let zt,Kt;T&&(St=Math.hypot(_t.x-ye.x,_t.y-ye.y),ce+=St,zt=ye,Kt=_t),ye.x<s&&_t.x<s||(ye.x<s?ye=new rr(s,ye.y+(s-ye.x)/(_t.x-ye.x)*(_t.y-ye.y))._round():_t.x<s&&(_t=new rr(s,ye.y+(s-ye.x)/(_t.x-ye.x)*(_t.y-ye.y))._round()),ye.y<c&&_t.y<c||(ye.y<c?ye=new rr(ye.x+(c-ye.y)/(_t.y-ye.y)*(_t.x-ye.x),c)._round():_t.y<c&&(_t=new rr(ye.x+(c-ye.y)/(_t.y-ye.y)*(_t.x-ye.x),c)._round()),ye.x>=g&&_t.x>=g||(ye.x>=g?ye=new rr(g,ye.y+(g-ye.x)/(_t.x-ye.x)*(_t.y-ye.y))._round():_t.x>=g&&(_t=new rr(g,ye.y+(g-ye.x)/(_t.x-ye.x)*(_t.y-ye.y))._round()),ye.y>=y&&_t.y>=y||(ye.y>=y?ye=new rr(ye.x+(y-ye.y)/(_t.y-ye.y)*(_t.x-ye.x),y)._round():_t.y>=y&&(_t=new rr(ye.x+(y-ye.y)/(_t.y-ye.y)*(_t.x-ye.x),y)._round()),X&&ye.equals(X[X.length-1])||(X=[ye],E.push(X),T&&T.push({progress:{min:Pt+jy(zt,Kt,ye)*St,max:1},parentIndex:D,prevPoint:zt,nextPoint:Kt})),X.push(_t),T&&(T[T.length-1].progress.max=Pt+jy(zt,Kt,_t)*St,T[T.length-1].nextPoint=Kt)))))}if(T&&ce>0)for(let fe=ae;fe<E.length;fe++)T[fe].progress.min/=ce,T[fe].progress.max/=ce}return E}function yb(u,s,c,g,y){if(u.length<2)return void g.push(u);const T=[];for(;s.valid();){const[X,ae]=s.get();for(let ce=0;ce<u.length-1;ce++){const fe=u[ce],ye=u[ce+1],_t=Kf(fe,ye,X,ae);if(_t){const[St]=_t,Pt=new rr(pn(fe.x,ye.x,St),pn(fe.y,ye.y,St));T.push({t:ce+St,distance:0,point:Pt})}}s.next()}if(T.length===0)return void g.push(u);T.sort((X,ae)=>X.t-ae.t);let E=0,D=0,W=[];for(g.push(W);E!==u.length;){if(D===T.length){for(;E!==u.length;)W.length!==0&&W[W.length-1].equals(u[E])||W.push(u[E]),E++;break}T[D].t<=E?(W.length!==0&&W[W.length-1].equals(T[D].point)||W.push(T[D].point),Math.trunc(T[D].t),D++):(W.length!==0&&W[W.length-1].equals(u[E])||W.push(u[E]),E++)}}function jy(u,s,c){return u.x!==s.x?(c.x-u.x)/(s.x-u.x):u.y!==s.y?(c.y-u.y)/(s.y-u.y):0}function ld(u,s){return u.x*s.x+u.y*s.y}function Wy(u,s){if(u.length===1){let c=0;const g=s[c++];let y;for(;!y||g.equals(y);)if(y=s[c++],!y)return 1/0;for(;c<s.length;c++){const T=s[c],E=u[0],D=y.sub(g),W=T.sub(g),X=E.sub(g),ae=ld(D,D),ce=ld(D,W),fe=ld(W,W),ye=ld(X,D),_t=ld(X,W),St=ae*fe-ce*ce,Pt=(fe*ye-ce*_t)/St,zt=(ae*_t-ce*ye)/St,Kt=g.z*(1-Pt-zt)+y.z*Pt+T.z*zt;if(isFinite(Kt))return Kt}return 1/0}{let c=1/0;for(const g of s)c=Math.min(c,g.z);return c}}function qy(u,s,c,g,y,T,E,D){const W=E*y.getElevationAt(u,s,!0,!0),X=T[0]!==0,ae=X?T[1]===0?E*(T[0]/7-450):E*function(ce,fe,ye){const _t=Math.floor(fe[0]/8),St=Math.floor(fe[1]/8),Pt=10*(fe[0]-8*_t),zt=10*(fe[1]-8*St),Kt=ce.getElevationAt(_t,St,!0,!0),Qt=ce.getMeterToDEM(ye),Tt=Math.floor(.5*(Pt*Qt-1)),Wt=Math.floor(.5*(zt*Qt-1)),ti=ce.tileCoordToPixel(_t,St),ci=2*Tt+1,ki=2*Wt+1,Ci=function(xr,Sr,tr,yr,Yi){return[xr.getElevationAtPixel(Sr,tr,!0),xr.getElevationAtPixel(Sr+Yi,tr,!0),xr.getElevationAtPixel(Sr,tr+Yi,!0),xr.getElevationAtPixel(Sr+yr,tr+Yi,!0)]}(ce,ti.x-Tt,ti.y-Wt,ci,ki),Di=Math.abs(Ci[0]-Ci[1]),Vi=Math.abs(Ci[2]-Ci[3]),Qi=Math.abs(Ci[0]-Ci[2])+Math.abs(Ci[1]-Ci[3]),br=Math.min(.25,.5*Qt*(Di+Vi)/ci),hr=Math.min(.25,.5*Qt*Qi/ki);return Kt+Math.max(br*Pt,hr*zt)}(y,T,D):W;return{base:W+(c===0?-1:c),top:X?Math.max(ae+g,W+c+2):W+g}}class vb{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xb{constructor(){this.tasks={},this.taskQueue=[],pr(["process"],this),this.invoker=new vb(this.process),this.nextId=0}add(s,c){const g=this.nextId++,y=function({type:T,isSymbolTile:E,zoom:D}){return D=D||0,T==="message"?0:T!=="maybePrepare"||E?T!=="parseTile"||E?T==="parseTile"&&E?300-D:T==="maybePrepare"&&E?400-D:500:200-D:100-D}(c);if(y===0){try{s()}finally{}return null}return this.tasks[g]={fn:s,metadata:c,priority:y,id:g},this.taskQueue.push(g),this.invoker.trigger(),{cancel:()=>{delete this.tasks[g]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(g=>!!this.tasks[g]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const c=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let s=null,c=1/0;for(let y=0;y<this.taskQueue.length;y++){const T=this.tasks[this.taskQueue[y]];T.priority<c&&(c=T.priority,s=y)}if(s===null)return null;const g=this.taskQueue[s];return this.taskQueue.splice(s,1),g}remove(){this.invoker.remove()}}class Xy{constructor(s,c,g){this.target=s,this.parent=c,this.mapId=g,this.callbacks={},this.cancelCallbacks={},pr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new xb}send(s,c,g,y,T=!1,E){const D=Math.round(1e18*Math.random()).toString(36).substring(0,10);g&&(g.metadata=E,this.callbacks[D]=g);const W=new Set;return this.target.postMessage({id:D,type:s,hasCallback:!!g,targetMapId:y,mustQueue:T,sourceMapId:this.mapId,data:Wa(c,W)},W),{cancel:()=>{g&&delete this.callbacks[D],this.target.postMessage({id:D,type:"<cancel>",targetMapId:y,sourceMapId:this.mapId})}}}receive(s){const c=s.data;if(!c)return;const g=c.id;if(g&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const y=this.cancelCallbacks[g];delete this.cancelCallbacks[g],y&&y.cancel()}else if(c.mustQueue||Gn(self)){const y=this.callbacks[g],T=this.scheduler.add(()=>this.processTask(g,c),y&&y.metadata||{type:"message"});T&&(this.cancelCallbacks[g]=T)}else this.processTask(g,c)}processTask(s,c){if(delete this.cancelCallbacks[s],c.type==="<response>"){const g=this.callbacks[s];delete this.callbacks[s],g&&(c.error?g(qa(c.error)):g(null,qa(c.data)))}else{const g=new Set,y=c.hasCallback?(E,D)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:E?Wa(E):null,data:Wa(D,g)},g)}:()=>{},T=qa(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,T,y);else if(this.parent.getWorkerSource){const E=c.type.split("."),{source:D,scope:W}=T;this.parent.getWorkerSource(c.sourceMapId,E[0],D,W)[E[1]](T,y)}else y(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var cd={workerUrl:"",workerClass:null,workerParams:void 0};const kg="mapboxgl_preloaded_worker_pool";class wu{constructor(){this.active={}}acquire(s,c=wu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(cd.workerClass!=null?new cd.workerClass:new self.Worker(cd.workerUrl,cd.workerParams));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kg]}numActive(){return Object.keys(this.active).length}}wu.workerCount=2;class Lh{constructor(s,c,g="Worker",y=wu.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=Bi();const T=this.workerPool.acquire(this.id,y);for(let E=0;E<T.length;E++){const D=new Lh.Actor(T[E],c,this.id);D.name=`${g} ${E}`,this.actors.push(D)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,c,g){bi(this.actors,(y,T)=>{y.send(s,c,T)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ud,Dg;function Xp(){return ud||(ud=new wu),ud}Lh.Actor=Xy;class bb{constructor(s){this.module=s}createIntArray(s){const c=new Int32Array(s),g=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heap32.set(c,g/c.BYTES_PER_ELEMENT),g}createFloatArray(s){const c=new Float32Array(s),g=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heapF32.set(c,g/c.BYTES_PER_ELEMENT),g}createStringBuffer(s){const c=this.module.malloc(s.length+1);for(let g=0;g<s.length;++g)this.module.heapU8[c+g]=s.charCodeAt(g);return this.module.heapU8[c+s.length]=0,c}readStringBuffer(s){let c="";for(;this.module.heapU8[s]!==0;)c+=String.fromCharCode(this.module.heapU8[s]),++s;return c}setStyle(s){const c=s.entranceColorRgb,g=s.facadeGlazingColorRgb,y=s.roofColorRgb,T=s.wallColorRgb,E=s.normalScale;this.module.setStyle(c[0],c[1],c[2],g[0],g[1],g[2],y[0],y[1],y[2],T[0],T[1],T[2],E[0],E[1],E[2],s.tileToMeters)}setAOOptions(s,c){this.module.setAOOptions(s?1:0,c)}setMetricOptions(s,c){this.module.setMetricOptions(s?1:0,c)}setFacadeOptions(s,c,g){this.module.setFacadeOptions(s,c,g)}generateMesh(s,c){for(const D of s){const W=this.createStringBuffer(D.roofType),X=[0],ae=[];for(const ye of D.coordinates)if(Array.isArray(ye)){for(const _t of ye)ae.push(_t.x),ae.push(_t.y);X.push(ae.length)}const ce=this.createIntArray(X),fe=this.createFloatArray(ae);this.module.addFeature(D.id,D.sourceId,D.minHeight,D.height,W,D.roofType.length,fe,ce,X.length-1),this.module.free(W),this.module.free(ce),this.module.free(fe)}for(const D of c){let W;W=D.entrances?JSON.parse(D.entrances):[];const X=this.createFloatArray(W),ae=[];for(const fe of D.coordinates)ae.push(fe.x),ae.push(fe.y);const ce=this.createFloatArray(ae);this.module.addFacade(D.sourceId,D.crossPerc,D.distanceToRoad,X,W.length,ce,ae.length),this.module.free(X),this.module.free(ce)}if(!this.module.generateMesh()){const D=this.module.getLastError();return this.readStringBuffer(D)}const g=this.module.getMeshCount(),y=new Array(g);for(let D=0;D<g;D++){const W=this.module.getPositionsPtr(D),X=this.module.getPositionsLength(D),ae=new Float32Array(this.module.heapF32.buffer,W,X),ce=this.module.getNormalsPtr(D),fe=this.module.getNormalsLength(D),ye=new Float32Array(this.module.heapF32.buffer,ce,fe),_t=this.module.getColorsPtr(D),St=this.module.getColorsLength(D),Pt=new Uint8Array(this.module.heapU8.buffer,_t,St),zt=this.module.getAOPtr(D),Kt=this.module.getAOLength(D),Qt=new Float32Array(this.module.heapF32.buffer,zt,Kt),Tt=this.module.getIndicesPtr(D),Wt=this.module.getIndicesLength(D),ti=new Int32Array(this.module.heap32.buffer,Tt,Wt),ci=this.module.getBuildingPart(D),ki=this.readStringBuffer(ci);y[D]={positions:ae,normals:ye,colors:Pt,ao:Qt,indices:ti,buildingPart:ki}}const T=this.module.getRingCount(),E=[];for(let D=0;D<T;D++){const W=this.module.getRingPtr(D),X=this.module.getRingLength(D),ae=new Float32Array(this.module.heapF32.buffer,W,X);E.push(ae)}return{meshes:y,modifiedPolygonRings:E}}}let hd,Fg,ka,kh,Og,Dh=null,Fh=null,Zy=null,zg=null;function Yy(){return Gn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Fg||po.DRACO_URL}function Ky(){if(Gn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(kh)return kh;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return kh=WebAssembly.validate(u)?po.MESHOPT_SIMD_URL:po.MESHOPT_URL,kh}const Zp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},wb={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},fd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Jy(u,s,c){const g=c.json.bufferViews.length,y=c.buffers.length;s.bufferView=g,c.json.bufferViews[g]={buffer:y,byteLength:u.byteLength},c.buffers[y]=u}const Bg="KHR_draco_mesh_compression";function Sb(u,s){const c=u.extensions&&u.extensions[Bg];if(!c)return;const g=new ka.Decoder,y=iv(s,c.bufferView),T=new ka.Mesh;if(!g.DecodeArrayToMesh(y,y.byteLength,T))throw new Error("Failed to decode Draco mesh");const E=s.json.accessors[u.indices],D=Zp[E.componentType],W=E.count*D.BYTES_PER_ELEMENT,X=ka._malloc(W);D===Uint16Array?g.GetTrianglesUInt16Array(T,W,X):g.GetTrianglesUInt32Array(T,W,X),Jy(ka.memory.buffer.slice(X,X+W),E,s),ka._free(X);for(const ae of Object.keys(c.attributes)){const ce=g.GetAttributeByUniqueId(T,c.attributes[ae]),fe=s.json.accessors[u.attributes[ae]],ye=wb[fe.componentType],_t=fe.count*fd[fe.type]*Zp[fe.componentType].BYTES_PER_ELEMENT,St=ka._malloc(_t);g.GetAttributeDataArrayForAllPoints(T,ce,ka[ye],_t,St),Jy(ka.memory.buffer.slice(St,St+_t),fe,s),ka._free(St)}g.destroy(),T.destroy(),delete u.extensions[Bg]}const Yp="EXT_meshopt_compression";function Tb(u,s){if(!u.extensions||!u.extensions[Yp])return;const c=u.extensions[Yp],g=new Uint8Array(s.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),y=new Uint8Array(c.count*c.byteStride);Og.decodeGltfBuffer(y,c.count,c.byteStride,g,c.mode,c.filter),u.buffer=s.buffers.length,u.byteOffset=0,s.buffers[u.buffer]=y.buffer,delete u.extensions[Yp]}const Qy=1179937895,ev=new TextDecoder("utf8");function tv(u,s){return new URL(u,s).href}function Eb(u,s,c,g){return fetch(tv(u.uri,g)).then(y=>y.arrayBuffer()).then(y=>{s.buffers[c]=y})}function iv(u,s){const c=u.json.bufferViews[s];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function Mb(u,s,c,g){if(u.uri){const y=tv(u.uri,g);return fetch(y).then(T=>T.blob()).then(T=>createImageBitmap(T)).then(T=>{s.images[c]=T})}if(u.bufferView!==void 0){const y=iv(s,u.bufferView),T=new Blob([y],{type:u.mimeType});return createImageBitmap(T).then(E=>{s.images[c]=E})}}function rv(u,s=0,c){const g={json:null,images:[],buffers:[]};if(new Uint32Array(u,s,1)[0]===Qy){const ae=new Uint32Array(u,s);let ce=2;const fe=(ae[ce++]>>2)-3,ye=ae[ce++]>>2;if(ce++,g.json=JSON.parse(ev.decode(ae.subarray(ce,ce+ye))),ce+=ye,ce<fe){const _t=ae[ce++];ce++;const St=s+(ce<<2);g.buffers[0]=u.slice(St,St+_t)}}else g.json=JSON.parse(ev.decode(new Uint8Array(u,s)));const{buffers:y,images:T,meshes:E,extensionsUsed:D,bufferViews:W}=g.json;let X=Promise.resolve();if(y){const ae=[];for(let ce=0;ce<y.length;ce++){const fe=y[ce];fe.uri?ae.push(Eb(fe,g,ce,c)):g.buffers[ce]||(g.buffers[ce]=null)}X=Promise.all(ae)}return X.then(()=>{const ae=[],ce=D&&D.includes(Bg),fe=D&&D.includes(Yp);if(ce&&ae.push(function(){if(!ka)return hd??(hd=function(ye){let _t,St=null;function Pt(){_t=new Uint8Array(St.buffer)}function zt(){throw new Error("Unexpected Draco error.")}const Kt={a:{a:zt,d:function(Qt,Tt,Wt){return _t.copyWithin(Qt,Tt,Tt+Wt)},c:function(Qt){const Tt=_t.length,Wt=Math.max(Qt>>>0,Math.ceil(1.2*Tt)),ti=Math.ceil((Wt-Tt)/65536);try{return St.grow(ti),Pt(),!0}catch{return!1}},b:zt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(ye,Kt):ye.then(Qt=>Qt.arrayBuffer()).then(Qt=>WebAssembly.instantiate(Qt,Kt))).then(Qt=>{const{Rb:Tt,Qb:Wt,P:ti,T:ci,X:ki,Ja:Ci,La:Di,Qa:Vi,Va:Qi,Wa:br,eb:hr,jb:xr,f:Sr,e:tr,yb:yr,zb:Yi,Ab:er,Bb:Cr,Db:Lr,Gb:an}=Qt.instance.exports;St=tr;const Yr=(()=>{let zr=0,Ar=0,vn=0,Zr=0;return Kr=>{vn&&(Tt(Zr),Tt(zr),Ar+=vn,vn=zr=0),zr||(Ar+=128,zr=Wt(Ar));const mn=Kr.length+7&-8;let Tn=zr;mn>=Ar&&(vn=mn,Tn=Zr=Wt(mn));for(let bn=0;bn<Kr.length;bn++)_t[Tn+bn]=Kr[bn];return Tn}})();return Pt(),Sr(),{memory:tr,_free:Tt,_malloc:Wt,Mesh:class{constructor(){this.ptr=ti()}destroy(){ci(this.ptr)}},Decoder:class{constructor(){this.ptr=Ci()}destroy(){xr(this.ptr)}DecodeArrayToMesh(zr,Ar,vn){const Zr=Yr(zr),Kr=Di(this.ptr,Zr,Ar,vn.ptr);return!!ki(Kr)}GetAttributeByUniqueId(zr,Ar){return{ptr:Vi(this.ptr,zr.ptr,Ar)}}GetTrianglesUInt16Array(zr,Ar,vn){Qi(this.ptr,zr.ptr,Ar,vn)}GetTrianglesUInt32Array(zr,Ar,vn){br(this.ptr,zr.ptr,Ar,vn)}GetAttributeDataArrayForAllPoints(zr,Ar,vn,Zr,Kr){hr(this.ptr,zr.ptr,Ar.ptr,vn,Zr,Kr)}},DT_INT8:yr(),DT_UINT8:Yi(),DT_INT16:er(),DT_UINT16:Cr(),DT_UINT32:Lr(),DT_FLOAT32:an()}})}(fetch(Yy())),hd.then(ye=>{ka=ye,hd=void 0}))}()),fe&&ae.push(function(){if(Og)return;const ye=function(_t){let St;const Pt=WebAssembly.instantiateStreaming(_t,{}).then(Qt=>{St=Qt.instance,St.exports.__wasm_call_ctors()}),zt={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Kt={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Pt,supported:!0,decodeGltfBuffer(Qt,Tt,Wt,ti,ci,ki){(function(Ci,Di,Vi,Qi,br,hr,xr){const Sr=Ci.exports.sbrk,tr=Qi+3&-4,yr=Sr(tr*br),Yi=Sr(hr.length),er=new Uint8Array(Ci.exports.memory.buffer);er.set(hr,Yi);const Cr=Di(yr,Qi,br,Yi,hr.length);if(Cr===0&&xr&&xr(yr,tr,br),Vi.set(er.subarray(yr,yr+Qi*br)),Sr(yr-Sr(0)),Cr!==0)throw new Error(`Malformed buffer data: ${Cr}`)})(St,St.exports[Kt[ci]],Qt,Tt,Wt,ti,St.exports[zt[ki]])}}}(fetch(Ky()));return ye.ready.then(()=>{Og=ye})}()),T)for(let ye=0;ye<T.length;ye++)ae.push(Mb(T[ye],g,ye,c));return(ae.length?Promise.all(ae):Promise.resolve()).then(()=>{if(ce&&E)for(const{primitives:ye}of E)for(const _t of ye)Sb(_t,g);if(fe&&E&&W)for(const ye of W)Tb(ye,g);return g})})}class nv{constructor(s){this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.hasPattern=!1,this.worldview=s.worldview}updateFootprints(s,c){}prepare(){return function(){if(zg!=null||Zy!=null)return null;if(Fh!=null)return Fh;const s=fetch(po.BUILDING_GEN_URL);return Fh=function(c){let g,y,T,E;function D(){g=new Uint8Array(E.buffer),y=new Int32Array(E.buffer),T=new Float32Array(E.buffer)}function W(){throw new Error("Unexpected BuildingGen error.")}const X=()=>{},ae={a:{a:W,f:function(ce){const fe=g.length,ye=Math.max(ce>>>0,Math.ceil(1.2*fe)),_t=Math.ceil((ye-fe)/65536);try{return E.grow(_t),D(),!0}catch{return!1}},g:W,b:X,c:X,d:X,e:X}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(c,ae):c.then(ce=>ce.arrayBuffer()).then(ce=>WebAssembly.instantiate(ce,ae))).then(ce=>{const fe=ce.instance.exports;return(0,fe.g)(),E=fe.f,D(),new bb({setStyle:fe.h,setAOOptions:fe.i,setMetricOptions:fe.j,setFacadeOptions:fe.k,addFeature:fe.l,addFacade:fe.m,generateMesh:fe.n,getLastError:fe.o,getMeshCount:fe.p,getPositionsPtr:fe.q,getPositionsLength:fe.r,getNormalsPtr:fe.s,getNormalsLength:fe.t,getColorsPtr:fe.u,getColorsLength:fe.v,getAOPtr:fe.w,getAOLength:fe.x,getIndicesPtr:fe.y,getIndicesLength:fe.z,getBuildingPart:fe.A,getRingCount:fe.B,getRingPtr:fe.C,getRingLength:fe.D,free:fe.E,malloc:fe.F,heapU8:g,heap32:y,heapF32:T})})}(s).then(c=>(Fh=null,zg=c,zg)).catch(c=>{yn("Could not load building-gen"),Fh=null,Zy=c}),Fh}()}populate(s,c,g,y){}update(s,c,g,y,T,E,D){}isEmpty(){return!1}uploadPending(){return!1}upload(s){}destroy(){}getHeightAtTileCoord(s,c){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let sv,ov;jr(nv,"BuildingBucket",{omit:["layers"]});const Ab=Zn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Cb=Zn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Pb}=Ab,Ib=Zn([{name:"a_packed",components:3,type:"Float32"}]),{members:Rb}=Ib,Lb=Zn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:kb}=Lb;class av{constructor(s,c){this.width=s,this.height=c,this.nextRow=0,this.image=new gc({width:s,height:c}),this.positions={},this.uploaded=!1}getDash(s,c){const g=this.getKey(s,c);return this.positions[g]}trim(){const s=this.width,c=this.height=dr(this.nextRow);this.image.resize({width:s,height:c})}getKey(s,c){return s.join(",")+c}getDashRanges(s,c,g){const y=[];let T=s.length%2==1?-s[s.length-1]*g:0,E=s[0]*g,D=!0;y.push({left:T,right:E,isDash:D,zeroLength:s[0]===0});let W=s[0];for(let X=1;X<s.length;X++){D=!D;const ae=s[X];T=W*g,W+=ae,E=W*g,y.push({left:T,right:E,isDash:D,zeroLength:ae===0})}return y}addRoundDash(s,c,g){const y=c/2;for(let T=-g;T<=g;T++){const E=this.width*(this.nextRow+g+T);let D=0,W=s[D];for(let X=0;X<this.width;X++){X/W.right>1&&(W=s[++D]);const ae=Math.abs(X-W.left),ce=Math.abs(X-W.right),fe=Math.min(ae,ce);let ye;const _t=T/g*(y+1);if(W.isDash){const St=y-Math.abs(_t);ye=Math.sqrt(fe*fe+St*St)}else ye=y-Math.sqrt(fe*fe+_t*_t);this.image.data[E+X]=Math.max(0,Math.min(255,ye+128))}}}addRegularDash(s,c){for(let W=s.length-1;W>=0;--W){const X=s[W],ae=s[W+1];X.zeroLength?s.splice(W,1):ae&&ae.isDash===X.isDash&&(ae.left=X.left,s.splice(W,1))}const g=s[0],y=s[s.length-1];g.isDash===y.isDash&&(g.left=y.left-this.width,y.right=g.right+this.width);const T=this.width*this.nextRow;let E=0,D=s[E];for(let W=0;W<this.width;W++){W/D.right>1&&(D=s[++E]);const X=Math.abs(W-D.left),ae=Math.abs(W-D.right),ce=Math.min(X,ae);this.image.data[T+W]=Math.max(0,Math.min(255,(D.isDash?ce:-ce)+c+128))}}addDash(s,c){const g=this.getKey(s,c);if(this.positions[g])return this.positions[g];const y=c==="round",T=y?7:0,E=2*T+1;if(this.nextRow+E>this.height)return yn("LineAtlas out of space"),null;s.length===0&&s.push(1);let D=0;for(let ae=0;ae<s.length;ae++)s[ae]<0&&(yn("Negative value is found in line dasharray, replacing values with 0"),s[ae]=0),D+=s[ae];if(D!==0){const ae=this.width/D,ce=this.getDashRanges(s,this.width,ae);y?this.addRoundDash(ce,ae,T):this.addRegularDash(ce,c==="square"?.5*ae:0)}const W=this.nextRow+T;this.nextRow+=E;const X={tl:[W,T],br:[D,0]};return this.positions[g]=X,X}}jr(av,"LineAtlas");const Db=Cn.VectorTileFeature.types,Fb=Math.cos(Math.PI/180*37.5),Ob=Math.cos(Math.PI/180*5);class Ng{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new zf,this.layoutVertexArray2=new pa,this.patternVertexArray=new pa,this.indexArray=new go,this.programConfigurations=new b(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new Hs,this.maxLineLength=0,this.zOffsetVertexArray=new pa,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Fr/64,this.worldview=s.worldview}updateFootprints(s,c){}populate(s,c,g,y){this.hasPattern=wg("line",this.layers,this.pixelRatio,c);const T=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ji(g);const E=this.layers[0].layout.get("line-elevation-reference");if(E==="hd-road-markup")this.elevationType="road";else{const fe=this.layers[0].layout.get("line-z-offset"),ye=fe.isConstant()&&!fe.constantOr(0);this.elevationType=E!=="sea"&&E!=="ground"&&ye?"none":"offset",this.elevationType==="offset"&&E==="none"&&yn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const D=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&D!==void 0;const W=[];for(const{feature:fe,id:ye,index:_t,sourceLayerIndex:St}of s){const Pt=this.layers[0]._featureFilter.needGeometry,zt=Ur(fe,Pt);if(!this.layers[0]._featureFilter.filter(new ps(this.zoom,{worldview:this.worldview}),zt,g))continue;const Kt=T?T.evaluate(zt,{},g):void 0,Qt={id:ye,properties:fe.properties,type:fe.type,sourceLayerIndex:St,index:_t,geometry:Pt?zt.geometry:qr(fe,g,y),patterns:{},sortKey:Kt};W.push(Qt)}T&&W.sort((fe,ye)=>fe.sortKey-ye.sortKey);const{lineAtlas:X,featureIndex:ae}=c,ce=this.addConstantDashes(X);for(const fe of W){const{geometry:ye,index:_t,sourceLayerIndex:St}=fe;if(ce&&this.addFeatureDashes(fe,X),this.hasPattern){const Pt=Sg("line",this.layers,fe,this.zoom,this.pixelRatio,c);this.patternFeatures.push(Pt)}else this.addFeature(fe,ye,_t,g,X.positions,c.availableImages,c.brightness,c.elevationFeatures);ae.insert(s[_t].feature,ye,_t,St,this.index)}}addConstantDashes(s){let c=!1;for(const g of this.layers){const y=g.paint.get("line-dasharray").value,T=g.layout.get("line-cap").value;if(y.kind!=="constant"||T.kind!=="constant")c=!0;else{const E=T.value,D=y.value;if(!D)continue;s.addDash(D,E)}}return c}addFeatureDashes(s,c){const g=this.zoom;for(const y of this.layers){const T=y.paint.get("line-dasharray").value,E=y.layout.get("line-cap").value;if(T.kind==="constant"&&E.kind==="constant")continue;let D,W;if(T.kind==="constant"){if(D=T.value,!D)continue}else D=T.evaluate({zoom:g},s);W=E.kind==="constant"?E.value:E.evaluate({zoom:g},s),c.addDash(D,W),s.patterns[y.id]=[c.getKey(D,W)]}}update(s,c,g,y,T,E,D,W){this.programConfigurations.updatePaintArrays(s,c,T,g,y,E,D,W)}addFeatures(s,c,g,y,T,E){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,c,g,y,E)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Rb)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,kb)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,Cb.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Pb),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,c,g,y,T,E,D,W){const X=this.layers[0].layout,ae=X.get("line-join").evaluate(s,{}),ce=X.get("line-cap").evaluate(s,{}),fe=X.get("line-miter-limit"),ye=X.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s,this.zOffsetValue=X.get("line-z-offset").value;const _t=this.layers[0].paint.get("line-width").value;if(_t.kind!=="constant"&&_t.isLineProgressConstant===!1&&(this.variableWidthValue=_t),this.elevationType==="road"){const St=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,c,y,W,ae,ce,fe,ye)){const[Pt,zt]=this.clipRuntimeLinesToTile(c,1);for(let Kt=0;Kt<Pt.length;Kt++){const Qt=Pt[Kt],Tt=zt[Kt],Wt={progress:{min:Tt.progress.min,max:Tt.progress.max},nextDir:this.computeSegNextDir(Tt,Qt),prevDir:this.computeSegPrevDir(Tt,Qt)};this.addLine(Qt,s,y,ae,ce,fe,ye,Wt)}this.fillNonElevatedRoadSegment(St)}}else for(const St of c)this.addLine(St,s,y,ae,ce,fe,ye);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,T,E,y,D,void 0,this.worldview)}computeSegNextDir(s,c){return s.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(s,c){return c[1].sub(s.prevPoint).unit()}clipLinesToTile(s,c){return qp(s,-c,-c,Fr+c,Fr+c)}clipRuntimeLinesToTile(s,c){const g=[];return[qp(s,-c,-c,Fr+c,Fr+c,g),g]}addElevatedRoadFeature(s,c,g,y,T,E,D,W){const X=[],ae=Wo.getElevationFeature(s,y);if(ae){const ce=this.clipLinesToTile(c,1),fe=this.prepareElevatedLines(ce,ae,g);for(const ye of fe)X.push({geometry:ye,elevation:ae,elevationTileID:g,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(X.length===0)return!1;for(const ce of X){const fe=this.layoutVertexArray.length;this.addLine(ce.geometry,s,g,T,E,D,W);const ye=new la(g,ce.elevationTileID);if(ce.elevation)for(let _t=fe;_t<this.layoutVertexArray.length;_t++){const St=new rr(this.layoutVertexArray.int16[6*_t]>>1,this.layoutVertexArray.int16[6*_t+1]>>1),Pt=ye.pointElevation(St,ce.elevation,.05);this.updateHeightRange(Pt),this.zOffsetVertexArray.emplaceBack(Pt,0,0)}else this.fillNonElevatedRoadSegment(fe)}return!0}prepareElevatedLines(s,c,g){if(c.constantHeight!=null)return s;const y=[],T=1/Ji(g);for(const E of s)yb(E,new No(c,T),0,y);return y}fillNonElevatedRoadSegment(s){for(let c=s;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,c,g,y,T,E,D,W){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const X=y==="none";this.patternJoinNone=this.hasPattern&&X,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const ae=W&&W.progress.min>0,ce=W&&W.progress.max<1;if(this.lineClips){let ki={min:this.lineClips.start,max:this.lineClips.end},Ci=1;if(W){const Qi=this.lineClips.end-this.lineClips.start;ki=function(br,hr,xr){return{min:Sc(br.min,hr,xr),max:Sc(br.max,hr,xr)}}(W.progress,{min:0,max:1},ki),Qi>0&&(Ci=(ki.max-ki.min)/Qi)}const Di=+c.properties.mapbox_clip_feature_len,Vi=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(Di)||Number.isNaN(Vi)){for(let br=0;br<s.length-1;br++)this.totalDistance+=s[br].dist(s[br+1]);const Qi=this.totalDistance/(ki.max-ki.min);this.totalFeatureLength=Number.isFinite(Qi)?Qi:0,this.lineClips.start=ki.min,this.lineClips.end=ki.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Di,this.distance=Vi*Ci,this.lineClips.start=ki.min,this.lineClips.end=ki.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const fe=Db[c.type]==="Polygon";let ye=s.length;for(;ye>=2&&s[ye-1].equals(s[ye-2]);)ye--;let _t=0;for(;_t<ye-1&&s[_t].equals(s[_t+1]);)_t++;if(ye<(fe?3:2))return;y==="bevel"&&(E=1.05);const St=this.segments.prepareSegment(10*ye,this.layoutVertexArray,this.indexArray);let Pt,zt,Kt,Qt,Tt,Wt,ti,ci;W&&W.prevDir&&(Wt=W.prevDir.perp()),W&&W.nextDir&&(ti=W.nextDir.perp()),this.e1=this.e2=-1,fe&&(Pt=s[ye-2],Tt=s[_t].sub(Pt)._unit()._perp());for(let ki=_t;ki<ye;ki++){if(Kt=ki===ye-1?fe?s[_t+1]:void 0:s[ki+1],Kt&&s[ki].equals(Kt))continue;Tt&&(Qt=Tt),Pt&&(zt=Pt),Pt=s[ki],ci=this.evaluateLineProgressFeatures(zt?zt.dist(Pt):0),Tt=Kt?Kt.sub(Pt)._unit()._perp():Qt,Qt=Qt||Tt;const Ci=zt&&Kt;let Di=Ci?y:fe||X?"butt":T;const Vi=Qt.x*Tt.x+Qt.y*Tt.y;if(X){const Yi=function(er){if(er.patternJoinNone){const Cr=er.segmentPoints.length/2,Lr=er.lineSoFar-er.segmentStart;for(let an=0;an<Cr;++an){const Yr=er.segmentPoints[2*an+1],zr=Math.round(er.segmentPoints[2*an])+.5+.25*Yr;er.patternVertexArray.emplaceBack(zr,Lr,er.segmentStart),er.patternVertexArray.emplaceBack(zr,Lr,er.segmentStart)}er.segmentPoints.length=0}er.e1=er.e2=-1};if(Ci&&Vi<Ob){this.updateDistance(zt,Pt),this.addCurrentVertex(Pt,Qt,1,1,St,ci),Yi(this),this.addCurrentVertex(Pt,Tt,-1,-1,St,ci);continue}if(zt){if(!Kt){this.updateDistance(zt,Pt),this.addCurrentVertex(Pt,Qt,1,1,St,ci),Yi(this);continue}Di="miter"}}let Qi=Qt.add(Tt);Qi.x===0&&Qi.y===0||Qi._unit();const br=Qi.x*Tt.x+Qi.y*Tt.y,hr=br!==0?1/br:1/0,xr=2*Math.sqrt(2-2*br),Sr=br<Fb&&zt&&Kt,tr=Qt.x*Tt.y-Qt.y*Tt.x>0,yr=this.overscaling<=16?15*Fr/(512*this.overscaling):0;if(Ci&&Di==="round"){if(hr<D)Di="miter";else if(hr<=2){const Yi=Vg(Pt,-10,Fr+10);Di=this.elevationType==="offset"&&(Yi||this.hasCrossSlope)?"miter":"fakeround"}}if(Di==="miter"&&hr>E&&(Di="bevel"),Di==="bevel"&&(hr>2&&(Di="flipbevel"),hr<E&&(Di="miter")),zt&&!(Di==="miter"&&Sr)&&this.updateDistance(zt,Pt),Di==="miter")if(Sr){const Yi=Pt.dist(zt);if(Yi>2*yr){const Cr=Pt.sub(Pt.sub(zt)._mult(yr/Yi)._round());this.updateDistance(zt,Cr),this.addCurrentVertex(Cr,Qt,0,0,St,ci),zt=Cr}this.updateDistance(zt,Pt),Qi._mult(hr),this.addCurrentVertex(Pt,Qi,0,0,St,ci);const er=Pt.dist(Kt);if(er>2*yr){const Cr=Pt.add(Kt.sub(Pt)._mult(yr/er)._round());this.updateDistance(Pt,Cr),this.addCurrentVertex(Cr,Tt,0,0,St,ci),Pt=Cr}}else Qi._mult(hr),this.addCurrentVertex(Pt,Qi,0,0,St,ci);else if(Di==="flipbevel"){if(hr>100)Qi=Tt.mult(-1);else{const Yi=hr*Qt.add(Tt).mag()/Qt.sub(Tt).mag();Qi._perp()._mult(Yi*(tr?-1:1))}this.addCurrentVertex(Pt,Qi,0,0,St,ci),this.addCurrentVertex(Pt,Qi.mult(-1),0,0,St,ci)}else if(Di==="bevel"||Di==="fakeround"){ci!=null&&zt&&this.addCurrentVertex(Pt,ti||Qt,-1,-1,St,ci);const Yi=Pt.dist(zt)<=2*yr&&Di!=="bevel",er=Qi.mult(tr?1:-1);er._mult(hr);const Cr=Tt.mult(tr?-1:1),Lr=Qt.mult(tr?-1:1),an=this.evaluateLineProgressFeatures(this.distance);if(ci==null&&(this.addHalfVertex(Pt,er.x,er.y,!1,!tr,0,St,an),Yi||this.addHalfVertex(Pt,er.x+2*Lr.x,er.y+2*Lr.y,!1,tr,0,St,an)),Di==="fakeround"){const Yr=Math.round(180*xr/Math.PI/20);this.addHalfVertex(Pt,Lr.x,Lr.y,!1,tr,0,St,an);for(let zr=0;zr<Yr;zr++){let Ar=zr/Yr;if(Ar!==.5){const Zr=Ar-.5;Ar+=Ar*Zr*(Ar-1)*((1.0904+Vi*(Vi*(3.55645-1.43519*Vi)-3.2452))*Zr*Zr+(.848013+Vi*(.215638*Vi-1.06021)))}const vn=Cr.sub(Lr)._mult(Ar)._add(Lr)._unit();this.addHalfVertex(Pt,vn.x,vn.y,!1,tr,0,St,an)}this.addHalfVertex(Pt,Cr.x,Cr.y,!1,tr,0,St,an)}Yi||ci!=null||this.addHalfVertex(Pt,er.x+2*Cr.x,er.y+2*Cr.y,!1,tr,0,St,an),ci!=null&&Kt&&this.addCurrentVertex(Pt,Wt||Tt,1,1,St,ci)}else if(Di==="butt")this.addCurrentVertex(Pt,Qi,0,0,St,ci);else if(Di==="square"){if(!zt){const Yi=ae?0:-1;this.addCurrentVertex(Pt,Qi,Yi,Yi,St,ci)}if(this.addCurrentVertex(Pt,Qi,0,0,St,ci),zt){const Yi=ce?0:1;this.addCurrentVertex(Pt,Qi,Yi,Yi,St,ci)}}else if(Di==="round"){if(zt){const Yi=!Ci&&ti?ti:Qt;this.addCurrentVertex(Pt,Yi,0,0,St,ci),!Ci&&ce||this.addCurrentVertex(Pt,Yi,1,1,St,ci,!0)}if(Kt){const Yi=!Ci&&Wt?Wt:Tt;!Ci&&ae||this.addCurrentVertex(Pt,Yi,-1,-1,St,ci,!0),this.addCurrentVertex(Pt,Yi,0,0,St,ci)}}}}addVerticesTo(s,c,g,y,T,E,D,W,X,ae){const ce=(c.w-s.w)/this.tessellationStep|0;let fe=0;const ye=this.scaledDistance;if(ce>1){this.lineSoFar=s.w;const St=(c.x-s.x)/ce,Pt=(c.y-s.y)/ce,zt=(c.z-s.z)/ce,Kt=(c.w-s.w)/ce;for(let Qt=1;Qt<ce;++Qt){s.x+=St,s.y+=Pt,s.z+=zt,this.lineSoFar+=Kt,fe+=Kt;const Tt=this.evaluateLineProgressFeatures(this.prevDistance+fe);this.scaledDistance=(this.prevDistance+fe)/this.totalDistance,this.addHalfVertex(s,g,y,ae,!1,D,X,Tt),this.addHalfVertex(s,T,E,ae,!0,-W,X,Tt)}}this.lineSoFar=c.w,this.scaledDistance=ye;const _t=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,g,y,ae,!1,D,X,_t),this.addHalfVertex(c,T,E,ae,!0,-W,X,_t)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):yn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(s,c,g,y,T,E,D=!1){const W=c.x+c.y*g,X=c.y-c.x*g,ae=c.y*y-c.x,ce=-c.y-c.x*y;if(E!=null){const fe=this.elevationType==="offset",ye=-10,_t=Fr+10,St=E.zOffset,Pt=new Uy(s.x,s.y,St,this.lineSoFar),zt=!!fe&&Vg(s,ye,_t),Kt=this.lineSoFar,Qt=this.distance;if(this.currentVertex)if(zt){const Tt=this.currentVertexIsOutside,Wt=this.currentVertex,ti=new Uy(s.x,s.y,St,this.lineSoFar);if(Hy(Wt,ti,ye,_t),!Vg(ti,ye,_t)){if(Tt){this.e1=this.e2=-1,this.distance-=Wt.dist(Pt),this.lineSoFar=Wt.w;const ci=this.evaluateLineProgressFeatures(Wt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Wt,W,X,D,!1,g,T,ci),this.addHalfVertex(Wt,ae,ce,D,!0,-y,T,ci),this.prevDistance=this.distance}this.distance=this.prevDistance+Wt.dist(ti),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Wt,ti,W,X,ae,ce,g,y,T,D),this.distance=Qt,this.scaledDistance=this.distance/this.totalDistance}}else{const Tt=this.currentVertex;if(this.currentVertexIsOutside){Hy(Tt,Pt,ye,_t),this.e1=this.e2=-1,this.distance-=Tt.dist(Pt),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Tt.w;const Wt=this.evaluateLineProgressFeatures(Tt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Tt,W,X,D,!1,g,T,Wt),this.addHalfVertex(Tt,ae,ce,D,!0,-y,T,Wt),this.prevDistance=this.distance,this.distance=Qt,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Tt,Pt,W,X,ae,ce,g,y,T,D)}else zt||(this.addHalfVertex(s,W,X,D,!1,g,T,E),this.addHalfVertex(s,ae,ce,D,!0,-y,T,E));this.currentVertex=Pt,this.currentVertexIsOutside=zt,this.lineSoFar=Kt}else this.addHalfVertex(s,W,X,D,!1,g,T,E),this.addHalfVertex(s,ae,ce,D,!0,-y,T,E)}addHalfVertex({x:s,y:c},g,y,T,E,D,W,X){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),E||this.segmentPoints.push(this.lineSoFar-this.segmentStart,D)),this.layoutVertexArray.emplaceBack((s<<1)+(T?1:0),(c<<1)+(E?1:0),Math.round(63*g)+128,Math.round(63*y)+128,1+(D===0?0:D<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const ce=pn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,ce)}const ae=W.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ae),W.primitiveLength++),E?this.e2=ae:this.e1=ae,X!=null&&this.zOffsetVertexArray.emplaceBack(X.zOffset,X.variableWidth,X.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,c){this.prevDistance=this.distance,this.distance+=s.dist(c),this.updateScaledDistance()}}function Vg(u,s,c){return u.x<s||u.x>c||u.y<s||u.y>c}let lv,cv;function uv(u,s,c){return s*(Fr/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}jr(Ng,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const hv=(u,s,c)=>(1-c)*u+c*s;function fv(u,s){return 1/uv(u,1,s.tileZoom)}function dv(u,s,c,g){return u.translatePosMatrix(g||s.tileID.projMatrix,s,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const pv=u=>{const s=[];mv(u)&&s.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const g=u.layout.get("line-join").constantOr("miter")==="none",y=!!u.paint.get("line-pattern").constantOr(1);return g&&y&&s.push("LINE_JOIN_NONE"),s};function mv(u){const s=u.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}let $g;const gv=()=>$g||($g={layout:lv||(lv=new Us({"line-cap":new $r(Gi.layout_line["line-cap"]),"line-join":new $r(Gi.layout_line["line-join"]),"line-miter-limit":new Mr(Gi.layout_line["line-miter-limit"]),"line-round-limit":new Mr(Gi.layout_line["line-round-limit"]),"line-sort-key":new $r(Gi.layout_line["line-sort-key"]),"line-z-offset":new $r(Gi.layout_line["line-z-offset"]),"line-elevation-reference":new Mr(Gi.layout_line["line-elevation-reference"]),"line-cross-slope":new Mr(Gi.layout_line["line-cross-slope"]),visibility:new Mr(Gi.layout_line.visibility),"line-width-unit":new Mr(Gi.layout_line["line-width-unit"])})),paint:cv||(cv=new Us({"line-opacity":new $r(Gi.paint_line["line-opacity"]),"line-color":new $r(Gi.paint_line["line-color"]),"line-translate":new Mr(Gi.paint_line["line-translate"]),"line-translate-anchor":new Mr(Gi.paint_line["line-translate-anchor"]),"line-width":new $r(Gi.paint_line["line-width"]),"line-gap-width":new $r(Gi.paint_line["line-gap-width"]),"line-offset":new $r(Gi.paint_line["line-offset"]),"line-blur":new $r(Gi.paint_line["line-blur"]),"line-dasharray":new $r(Gi.paint_line["line-dasharray"]),"line-pattern":new $r(Gi.paint_line["line-pattern"]),"line-pattern-cross-fade":new Mr(Gi.paint_line["line-pattern-cross-fade"]),"line-gradient":new Al(Gi.paint_line["line-gradient"]),"line-trim-offset":new Mr(Gi.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mr(Gi.paint_line["line-trim-fade-range"]),"line-trim-color":new Mr(Gi.paint_line["line-trim-color"]),"line-emissive-strength":new Mr(Gi.paint_line["line-emissive-strength"]),"line-border-width":new $r(Gi.paint_line["line-border-width"]),"line-border-color":new $r(Gi.paint_line["line-border-color"]),"line-occlusion-opacity":new Mr(Gi.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},$g);class zb extends $r{possiblyEvaluate(s,c){return c=new ps(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition,worldview:c.worldview}),super.possiblyEvaluate(s,c)}evaluate(s,c,g,y){return c=Oi({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(s,c,g,y)}}let dd;function _v(u,s){return s>0?s+2*u:u}const Bb=Zn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nb=Zn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vb=Zn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Zn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $b=Zn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Ub=Zn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Gb=Zn([{name:"a_texb",components:2,type:"Uint16"}]),Hb=Zn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),jb=Zn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Zn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yv=Zn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wb=Zn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zn([{name:"triangle",components:3,type:"Uint16"}]),Zn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Zn([{type:"Float32",name:"offsetX"}]),Zn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fo=24;function qb(u,s,c){return u.sections.forEach(g=>{g.text=function(y,T,E){const D=T.layout.get("text-transform").evaluate(E,{});return D==="uppercase"?y=y.toLocaleUpperCase():D==="lowercase"&&(y=y.toLocaleLowerCase()),Pa.applyArabicShaping&&(y=Pa.applyArabicShaping(y)),y}(g.text,s,c)}),u}const pd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Xb(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function Zb(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}var vv,Ug,xv,Gg={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Yb(){return vv||(vv=1,Gg.read=function(u,s,c,g,y){var T,E,D=8*y-g-1,W=(1<<D)-1,X=W>>1,ae=-7,ce=c?y-1:0,fe=c?-1:1,ye=u[s+ce];for(ce+=fe,T=ye&(1<<-ae)-1,ye>>=-ae,ae+=D;ae>0;T=256*T+u[s+ce],ce+=fe,ae-=8);for(E=T&(1<<-ae)-1,T>>=-ae,ae+=g;ae>0;E=256*E+u[s+ce],ce+=fe,ae-=8);if(T===0)T=1-X;else{if(T===W)return E?NaN:1/0*(ye?-1:1);E+=Math.pow(2,g),T-=X}return(ye?-1:1)*E*Math.pow(2,T-g)},Gg.write=function(u,s,c,g,y,T){var E,D,W,X=8*T-y-1,ae=(1<<X)-1,ce=ae>>1,fe=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ye=g?0:T-1,_t=g?1:-1,St=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(D=isNaN(s)?1:0,E=ae):(E=Math.floor(Math.log(s)/Math.LN2),s*(W=Math.pow(2,-E))<1&&(E--,W*=2),(s+=E+ce>=1?fe/W:fe*Math.pow(2,1-ce))*W>=2&&(E++,W/=2),E+ce>=ae?(D=0,E=ae):E+ce>=1?(D=(s*W-1)*Math.pow(2,y),E+=ce):(D=s*Math.pow(2,ce-1)*Math.pow(2,y),E=0));y>=8;u[c+ye]=255&D,ye+=_t,D/=256,y-=8);for(E=E<<y|D,X+=y;X>0;u[c+ye]=255&E,ye+=_t,E/=256,X-=8);u[c+ye-_t]|=128*St}),Gg}function bv(){if(xv)return Ug;xv=1,Ug=s;var u=Yb();function s(Tt){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Tt)?Tt:new Uint8Array(Tt||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var c=4294967296,g=1/c,y=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function T(Tt){return Tt.type===s.Bytes?Tt.readVarint()+Tt.pos:Tt.pos+1}function E(Tt,Wt,ti){return ti?4294967296*Wt+(Tt>>>0):4294967296*(Wt>>>0)+(Tt>>>0)}function D(Tt,Wt,ti){var ci=Wt<=16383?1:Wt<=2097151?2:Wt<=268435455?3:Math.floor(Math.log(Wt)/(7*Math.LN2));ti.realloc(ci);for(var ki=ti.pos-1;ki>=Tt;ki--)ti.buf[ki+ci]=ti.buf[ki]}function W(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeVarint(Tt[ti])}function X(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeSVarint(Tt[ti])}function ae(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeFloat(Tt[ti])}function ce(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeDouble(Tt[ti])}function fe(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeBoolean(Tt[ti])}function ye(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeFixed32(Tt[ti])}function _t(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeSFixed32(Tt[ti])}function St(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeFixed64(Tt[ti])}function Pt(Tt,Wt){for(var ti=0;ti<Tt.length;ti++)Wt.writeSFixed64(Tt[ti])}function zt(Tt,Wt){return(Tt[Wt]|Tt[Wt+1]<<8|Tt[Wt+2]<<16)+16777216*Tt[Wt+3]}function Kt(Tt,Wt,ti){Tt[ti]=Wt,Tt[ti+1]=Wt>>>8,Tt[ti+2]=Wt>>>16,Tt[ti+3]=Wt>>>24}function Qt(Tt,Wt){return(Tt[Wt]|Tt[Wt+1]<<8|Tt[Wt+2]<<16)+(Tt[Wt+3]<<24)}return s.prototype={destroy:function(){this.buf=null},readFields:function(Tt,Wt,ti){for(ti=ti||this.length;this.pos<ti;){var ci=this.readVarint(),ki=ci>>3,Ci=this.pos;this.type=7&ci,Tt(ki,Wt,this),this.pos===Ci&&this.skip(ci)}return Wt},readMessage:function(Tt,Wt){return this.readFields(Tt,Wt,this.readVarint()+this.pos)},readFixed32:function(){var Tt=zt(this.buf,this.pos);return this.pos+=4,Tt},readSFixed32:function(){var Tt=Qt(this.buf,this.pos);return this.pos+=4,Tt},readFixed64:function(){var Tt=zt(this.buf,this.pos)+zt(this.buf,this.pos+4)*c;return this.pos+=8,Tt},readSFixed64:function(){var Tt=zt(this.buf,this.pos)+Qt(this.buf,this.pos+4)*c;return this.pos+=8,Tt},readFloat:function(){var Tt=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Tt},readDouble:function(){var Tt=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Tt},readVarint:function(Tt){var Wt,ti,ci=this.buf;return Wt=127&(ti=ci[this.pos++]),ti<128?Wt:(Wt|=(127&(ti=ci[this.pos++]))<<7,ti<128?Wt:(Wt|=(127&(ti=ci[this.pos++]))<<14,ti<128?Wt:(Wt|=(127&(ti=ci[this.pos++]))<<21,ti<128?Wt:function(ki,Ci,Di){var Vi,Qi,br=Di.buf;if(Vi=(112&(Qi=br[Di.pos++]))>>4,Qi<128||(Vi|=(127&(Qi=br[Di.pos++]))<<3,Qi<128)||(Vi|=(127&(Qi=br[Di.pos++]))<<10,Qi<128)||(Vi|=(127&(Qi=br[Di.pos++]))<<17,Qi<128)||(Vi|=(127&(Qi=br[Di.pos++]))<<24,Qi<128)||(Vi|=(1&(Qi=br[Di.pos++]))<<31,Qi<128))return E(ki,Vi,Ci);throw new Error("Expected varint not more than 10 bytes")}(Wt|=(15&(ti=ci[this.pos]))<<28,Tt,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Tt=this.readVarint();return Tt%2==1?(Tt+1)/-2:Tt/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Tt=this.readVarint()+this.pos,Wt=this.pos;return this.pos=Tt,Tt-Wt>=12&&y?function(ti,ci,ki){return y.decode(ti.subarray(ci,ki))}(this.buf,Wt,Tt):function(ti,ci,ki){for(var Ci="",Di=ci;Di<ki;){var Vi,Qi,br,hr=ti[Di],xr=null,Sr=hr>239?4:hr>223?3:hr>191?2:1;if(Di+Sr>ki)break;Sr===1?hr<128&&(xr=hr):Sr===2?(192&(Vi=ti[Di+1]))==128&&(xr=(31&hr)<<6|63&Vi)<=127&&(xr=null):Sr===3?(Qi=ti[Di+2],(192&(Vi=ti[Di+1]))==128&&(192&Qi)==128&&((xr=(15&hr)<<12|(63&Vi)<<6|63&Qi)<=2047||xr>=55296&&xr<=57343)&&(xr=null)):Sr===4&&(Qi=ti[Di+2],br=ti[Di+3],(192&(Vi=ti[Di+1]))==128&&(192&Qi)==128&&(192&br)==128&&((xr=(15&hr)<<18|(63&Vi)<<12|(63&Qi)<<6|63&br)<=65535||xr>=1114112)&&(xr=null)),xr===null?(xr=65533,Sr=1):xr>65535&&(xr-=65536,Ci+=String.fromCharCode(xr>>>10&1023|55296),xr=56320|1023&xr),Ci+=String.fromCharCode(xr),Di+=Sr}return Ci}(this.buf,Wt,Tt)},readBytes:function(){var Tt=this.readVarint()+this.pos,Wt=this.buf.subarray(this.pos,Tt);return this.pos=Tt,Wt},readPackedVarint:function(Tt,Wt){if(this.type!==s.Bytes)return Tt.push(this.readVarint(Wt));var ti=T(this);for(Tt=Tt||[];this.pos<ti;)Tt.push(this.readVarint(Wt));return Tt},readPackedSVarint:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readSVarint());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readSVarint());return Tt},readPackedBoolean:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readBoolean());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readBoolean());return Tt},readPackedFloat:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readFloat());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readFloat());return Tt},readPackedDouble:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readDouble());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readDouble());return Tt},readPackedFixed32:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readFixed32());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readFixed32());return Tt},readPackedSFixed32:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readSFixed32());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readSFixed32());return Tt},readPackedFixed64:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readFixed64());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readFixed64());return Tt},readPackedSFixed64:function(Tt){if(this.type!==s.Bytes)return Tt.push(this.readSFixed64());var Wt=T(this);for(Tt=Tt||[];this.pos<Wt;)Tt.push(this.readSFixed64());return Tt},skip:function(Tt){var Wt=7&Tt;if(Wt===s.Varint)for(;this.buf[this.pos++]>127;);else if(Wt===s.Bytes)this.pos=this.readVarint()+this.pos;else if(Wt===s.Fixed32)this.pos+=4;else{if(Wt!==s.Fixed64)throw new Error("Unimplemented type: "+Wt);this.pos+=8}},writeTag:function(Tt,Wt){this.writeVarint(Tt<<3|Wt)},realloc:function(Tt){for(var Wt=this.length||16;Wt<this.pos+Tt;)Wt*=2;if(Wt!==this.length){var ti=new Uint8Array(Wt);ti.set(this.buf),this.buf=ti,this.length=Wt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Tt){this.realloc(4),Kt(this.buf,Tt,this.pos),this.pos+=4},writeSFixed32:function(Tt){this.realloc(4),Kt(this.buf,Tt,this.pos),this.pos+=4},writeFixed64:function(Tt){this.realloc(8),Kt(this.buf,-1&Tt,this.pos),Kt(this.buf,Math.floor(Tt*g),this.pos+4),this.pos+=8},writeSFixed64:function(Tt){this.realloc(8),Kt(this.buf,-1&Tt,this.pos),Kt(this.buf,Math.floor(Tt*g),this.pos+4),this.pos+=8},writeVarint:function(Tt){(Tt=+Tt||0)>268435455||Tt<0?function(Wt,ti){var ci,ki;if(Wt>=0?(ci=Wt%4294967296|0,ki=Wt/4294967296|0):(ki=~(-Wt/4294967296),4294967295^(ci=~(-Wt%4294967296))?ci=ci+1|0:(ci=0,ki=ki+1|0)),Wt>=18446744073709552e3||Wt<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ti.realloc(10),function(Ci,Di,Vi){Vi.buf[Vi.pos++]=127&Ci|128,Ci>>>=7,Vi.buf[Vi.pos++]=127&Ci|128,Ci>>>=7,Vi.buf[Vi.pos++]=127&Ci|128,Ci>>>=7,Vi.buf[Vi.pos++]=127&Ci|128,Vi.buf[Vi.pos]=127&(Ci>>>=7)}(ci,0,ti),function(Ci,Di){var Vi=(7&Ci)<<4;Di.buf[Di.pos++]|=Vi|((Ci>>>=3)?128:0),Ci&&(Di.buf[Di.pos++]=127&Ci|((Ci>>>=7)?128:0),Ci&&(Di.buf[Di.pos++]=127&Ci|((Ci>>>=7)?128:0),Ci&&(Di.buf[Di.pos++]=127&Ci|((Ci>>>=7)?128:0),Ci&&(Di.buf[Di.pos++]=127&Ci|((Ci>>>=7)?128:0),Ci&&(Di.buf[Di.pos++]=127&Ci)))))}(ki,ti)}(Tt,this):(this.realloc(4),this.buf[this.pos++]=127&Tt|(Tt>127?128:0),Tt<=127||(this.buf[this.pos++]=127&(Tt>>>=7)|(Tt>127?128:0),Tt<=127||(this.buf[this.pos++]=127&(Tt>>>=7)|(Tt>127?128:0),Tt<=127||(this.buf[this.pos++]=Tt>>>7&127))))},writeSVarint:function(Tt){this.writeVarint(Tt<0?2*-Tt-1:2*Tt)},writeBoolean:function(Tt){this.writeVarint(!!Tt)},writeString:function(Tt){Tt=String(Tt),this.realloc(4*Tt.length),this.pos++;var Wt=this.pos;this.pos=function(ci,ki,Ci){for(var Di,Vi,Qi=0;Qi<ki.length;Qi++){if((Di=ki.charCodeAt(Qi))>55295&&Di<57344){if(!Vi){Di>56319||Qi+1===ki.length?(ci[Ci++]=239,ci[Ci++]=191,ci[Ci++]=189):Vi=Di;continue}if(Di<56320){ci[Ci++]=239,ci[Ci++]=191,ci[Ci++]=189,Vi=Di;continue}Di=Vi-55296<<10|Di-56320|65536,Vi=null}else Vi&&(ci[Ci++]=239,ci[Ci++]=191,ci[Ci++]=189,Vi=null);Di<128?ci[Ci++]=Di:(Di<2048?ci[Ci++]=Di>>6|192:(Di<65536?ci[Ci++]=Di>>12|224:(ci[Ci++]=Di>>18|240,ci[Ci++]=Di>>12&63|128),ci[Ci++]=Di>>6&63|128),ci[Ci++]=63&Di|128)}return Ci}(this.buf,Tt,this.pos);var ti=this.pos-Wt;ti>=128&&D(Wt,ti,this),this.pos=Wt-1,this.writeVarint(ti),this.pos+=ti},writeFloat:function(Tt){this.realloc(4),u.write(this.buf,Tt,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Tt){this.realloc(8),u.write(this.buf,Tt,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Tt){var Wt=Tt.length;this.writeVarint(Wt),this.realloc(Wt);for(var ti=0;ti<Wt;ti++)this.buf[this.pos++]=Tt[ti]},writeRawMessage:function(Tt,Wt){this.pos++;var ti=this.pos;Tt(Wt,this);var ci=this.pos-ti;ci>=128&&D(ti,ci,this),this.pos=ti-1,this.writeVarint(ci),this.pos+=ci},writeMessage:function(Tt,Wt,ti){this.writeTag(Tt,s.Bytes),this.writeRawMessage(Wt,ti)},writePackedVarint:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,W,Wt)},writePackedSVarint:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,X,Wt)},writePackedBoolean:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,fe,Wt)},writePackedFloat:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,ae,Wt)},writePackedDouble:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,ce,Wt)},writePackedFixed32:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,ye,Wt)},writePackedSFixed32:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,_t,Wt)},writePackedFixed64:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,St,Wt)},writePackedSFixed64:function(Tt,Wt){Wt.length&&this.writeMessage(Tt,Pt,Wt)},writeBytesField:function(Tt,Wt){this.writeTag(Tt,s.Bytes),this.writeBytes(Wt)},writeFixed32Field:function(Tt,Wt){this.writeTag(Tt,s.Fixed32),this.writeFixed32(Wt)},writeSFixed32Field:function(Tt,Wt){this.writeTag(Tt,s.Fixed32),this.writeSFixed32(Wt)},writeFixed64Field:function(Tt,Wt){this.writeTag(Tt,s.Fixed64),this.writeFixed64(Wt)},writeSFixed64Field:function(Tt,Wt){this.writeTag(Tt,s.Fixed64),this.writeSFixed64(Wt)},writeVarintField:function(Tt,Wt){this.writeTag(Tt,s.Varint),this.writeVarint(Wt)},writeSVarintField:function(Tt,Wt){this.writeTag(Tt,s.Varint),this.writeSVarint(Wt)},writeStringField:function(Tt,Wt){this.writeTag(Tt,s.Bytes),this.writeString(Wt)},writeFloatField:function(Tt,Wt){this.writeTag(Tt,s.Fixed32),this.writeFloat(Wt)},writeDoubleField:function(Tt,Wt){this.writeTag(Tt,s.Fixed64),this.writeDouble(Wt)},writeBooleanField:function(Tt,Wt){this.writeVarintField(Tt,!!Wt)}},Ug}var Kp=Sn(bv());const Hg=3;function Kb(u,s,c){s.glyphs=[],u===1&&c.readMessage(Jb,s)}function Jb(u,s,c){if(u===3){const{id:g,bitmap:y,width:T,height:E,left:D,top:W,advance:X}=c.readMessage(Qb,{});s.glyphs.push({id:g,bitmap:new gc({width:T+2*Hg,height:E+2*Hg},y),metrics:{width:T,height:E,left:D,top:W,advance:X}})}else u===4?s.ascender=c.readSVarint():u===5&&(s.descender=c.readSVarint())}function Qb(u,s,c){u===1?s.id=c.readVarint():u===2?s.bitmap=c.readBytes():u===3?s.width=c.readVarint():u===4?s.height=c.readVarint():u===5?s.left=c.readSVarint():u===6?s.top=c.readSVarint():u===7&&(s.advance=c.readVarint())}const e1=Hg,qo={horizontal:1,vertical:2,horizontalOnly:3};class md{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,c){const g=new md;return g.scale=s||1,g.fontStack=c,g}static forImage(s){const c=new md;return c.image=s,c}}class Oh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,c,g){const y=new Oh;for(let T=0;T<s.sections.length;T++){const E=s.sections[T];E.image?y.addImageSection(E,g):y.addTextSection(E,c)}return y}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(c,g){let y="";for(let T=0;T<c.length;T++){const E=c.charCodeAt(T+1)||null,D=c.charCodeAt(T-1)||null;y+=!g&&(E&&cp(E)&&!pd[c[T+1]]||D&&cp(D)&&!pd[c[T-1]])||!pd[c[T]]?c[T]:pd[c[T]]}return y}(this.text,s)}trim(){let s=0;for(let g=0;g<this.text.length&&Jp[this.text.charCodeAt(g)];g++)s++;let c=this.text.length;for(let g=this.text.length-1;g>=0&&g>=s&&Jp[this.text.charCodeAt(g)];g--)c--;this.text=this.text.substring(s,c),this.sectionIndex=this.sectionIndex.slice(s,c)}substring(s,c){const g=new Oh;return g.text=this.text.substring(s,c),g.sectionIndex=this.sectionIndex.slice(s,c),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,c)=>Math.max(s,this.sections[c].scale),0)}addTextSection(s,c){this.text+=s.text,this.sections.push(md.forText(s.scale,s.fontStack||c));const g=this.sections.length-1;for(let y=0;y<s.text.length;++y)this.sectionIndex.push(g)}addImageSection(s,c){const g=s.image?s.image.getPrimary():null;if(!g)return void yn("Can't add FormattedSection with an empty image.");g.scaleSelf(c);const y=this.getNextImageSectionCharCode();y?(this.text+=String.fromCodePoint(y),this.sections.push(md.forImage(g)),this.sectionIndex.push(this.sections.length-1)):yn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jg(u,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St=1){const Pt=Oh.fromFeature(u,y,St);ce===qo.vertical&&Pt.verticalizePunctuation(fe);let zt=[];const Kt=function(ci,ki,Ci,Di,Vi,Qi){if(!ci)return[];const br=[],hr=function(yr,Yi,er,Cr,Lr,an){let Yr=0;for(let zr=0;zr<yr.length();zr++){const Ar=yr.getSection(zr);Yr+=wv(yr.getCodePoint(zr),Ar,Cr,Lr,Yi,an)}return Yr/Math.max(1,Math.ceil(Yr/er))}(ci,ki,Ci,Di,Vi,Qi),xr=ci.text.indexOf("")>=0;let Sr=0;for(let yr=0;yr<ci.length();yr++){const Yi=ci.getSection(yr),er=ci.getCodePoint(yr);if(Jp[er]||(Sr+=wv(er,Yi,Di,Vi,ki,Qi)),yr<ci.length()-1){const Cr=!((tr=er)<11904||!(cn["Bopomofo Extended"](tr)||cn.Bopomofo(tr)||cn["CJK Compatibility Forms"](tr)||cn["CJK Compatibility Ideographs"](tr)||cn["CJK Compatibility"](tr)||cn["CJK Radicals Supplement"](tr)||cn["CJK Strokes"](tr)||cn["CJK Symbols and Punctuation"](tr)||cn["CJK Unified Ideographs Extension A"](tr)||cn["CJK Unified Ideographs"](tr)||cn["Enclosed CJK Letters and Months"](tr)||cn["Halfwidth and Fullwidth Forms"](tr)||cn.Hiragana(tr)||cn["Ideographic Description Characters"](tr)||cn["Kangxi Radicals"](tr)||cn["Katakana Phonetic Extensions"](tr)||cn.Katakana(tr)||cn["Vertical Forms"](tr)||cn["Yi Radicals"](tr)||cn["Yi Syllables"](tr)));(t1[er]||Cr||Yi.image)&&br.push(Tv(yr+1,Sr,hr,br,i1(er,ci.getCodePoint(yr+1),Cr&&xr),!1))}}var tr;return Ev(Tv(ci.length(),Sr,hr,br,0,!0))}(Pt,X,T,s,g,ye),{processBidirectionalText:Qt,processStyledBidirectionalText:Tt}=Pa;if(Qt&&Pt.sections.length===1){const ci=Qt(Pt.toString(),Kt);for(const ki of ci){const Ci=new Oh;Ci.text=ki,Ci.sections=Pt.sections;for(let Di=0;Di<ki.length;Di++)Ci.sectionIndex.push(0);zt.push(Ci)}}else if(Tt){const ci=Tt(Pt.text,Pt.sectionIndex,Kt);for(const ki of ci){const Ci=new Oh;Ci.text=ki[0],Ci.sectionIndex=ki[1],Ci.sections=Pt.sections,zt.push(Ci)}}else zt=function(ci,ki){const Ci=[],Di=ci.text;let Vi=0;for(const Qi of ki)Ci.push(ci.substring(Vi,Qi)),Vi=Qi;return Vi<Di.length&&Ci.push(ci.substring(Vi,Di.length)),Ci}(Pt,Kt);const Wt=[],ti={positionedLines:Wt,text:Pt.toString(),top:ae[1],bottom:ae[1],left:ae[0],right:ae[0],writingMode:ce,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ci,ki,Ci,Di,Vi,Qi,br,hr,xr,Sr,tr,yr){let Yi=0,er=0,Cr=0;const Lr=hr==="right"?1:hr==="left"?0:.5;let an=!1;for(const Kr of Vi){const mn=Kr.getSections();for(const Tn of mn){if(Tn.image)continue;const bn=ki[Tn.fontStack];if(bn&&(an=bn.ascender!==void 0&&bn.descender!==void 0,!an))break}if(!an)break}let Yr=0;for(const Kr of Vi){Kr.trim();const mn=Kr.getMaxScale(),Tn=(mn-1)*fo,bn={positionedGlyphs:[],lineOffset:0};ci.positionedLines[Yr]=bn;const Rn=bn.positionedGlyphs;let Mn=0;if(!Kr.length()){er+=Qi,++Yr;continue}let Ln=0,os=0;for(let ai=0;ai<Kr.length();ai++){const hi=Kr.getSection(ai),sr=Kr.getSectionIndex(ai),Dr=Kr.getCodePoint(ai);let Br=hi.scale,Or=null,Xr=null,dn=null,On=fo,zn=0;xr===qo.vertical&&((zr=Dr)===12312||zr===12313||zr===12316||zr===12540||zr===12448)&&(xr=qo.horizontal);const An=!(xr===qo.horizontal||!tr&&!Pf(Dr)||tr&&(Jp[Dr]||rg(Dr)));if(hi.image){const us=Di.get(hi.image.toString());if(!us)continue;dn=hi.image,ci.iconsInText=ci.iconsInText||!0,Xr=us.paddedRect;const ys=us.displaySize;Br=Br*fo/yr,Or={width:ys[0],height:ys[1],left:0,top:-3,advance:An?ys[1]:ys[0],localGlyph:!1},zn=an?-Or.height*Br:mn*fo-17-ys[1]*Br,On=Or.advance;const Bn=(An?ys[0]:ys[1])*Br-fo*mn;Bn>0&&Bn>Mn&&(Mn=Bn)}else{const us=Ci[hi.fontStack];if(!us)continue;us[Dr]&&(Xr=us[Dr]);const ys=ki[hi.fontStack];if(!ys)continue;const Bn=ys.glyphs[Dr];if(!Bn)continue;if(Or=Bn.metrics,On=Dr!==8203?fo:0,an){const Vs=ys.ascender!==void 0?Math.abs(ys.ascender):0,Es=ys.descender!==void 0?Math.abs(ys.descender):0,as=(Vs+Es)*Br;Ln<as&&(Ln=as,os=(Vs-Es)/2*Br),zn=-Vs*Br}else zn=(mn-Br)*fo-17}An?(ci.verticalizable=!0,Rn.push({glyph:Dr,image:dn,x:Yi,y:er+zn,vertical:An,scale:Br,localGlyph:Or.localGlyph,fontStack:hi.fontStack,sectionIndex:sr,metrics:Or,rect:Xr}),Yi+=On*Br+Sr):(Rn.push({glyph:Dr,image:dn,x:Yi,y:er+zn,vertical:An,scale:Br,localGlyph:Or.localGlyph,fontStack:hi.fontStack,sectionIndex:sr,metrics:Or,rect:Xr}),Yi+=Or.advance*Br+Sr)}Rn.length!==0&&(Cr=Math.max(Yi-Sr,Cr),an?Mv(Rn,Lr,Mn,os,Qi*mn/2):Mv(Rn,Lr,Mn,0,Qi/2)),Yi=0;const Ts=Qi*mn+Mn;bn.lineOffset=Math.max(Mn,Tn),er+=Ts,++Yr}var zr;const Ar=er,{horizontalAlign:vn,verticalAlign:Zr}=Wg(br);(function(Kr,mn,Tn,bn,Rn,Mn){const Ln=(mn-Tn)*Rn,os=-Mn*bn;for(const Ts of Kr)for(const ai of Ts.positionedGlyphs)ai.x+=Ln,ai.y+=os})(ci.positionedLines,Lr,vn,Zr,Cr,Ar),ci.top+=-Zr*Ar,ci.bottom=ci.top+Ar,ci.left+=-vn*Cr,ci.right=ci.left+Cr,ci.hasBaseline=an}(ti,s,c,g,zt,E,D,W,ce,X,fe,_t),!function(ci){for(const ki of ci)if(ki.positionedGlyphs.length!==0)return!1;return!0}(Wt))return ti}const Jp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},t1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wv(u,s,c,g,y,T){if(s.image){const E=g.get(s.image.toString());return E?E.displaySize[0]*s.scale*fo/T+y:0}{const E=c[s.fontStack],D=E&&E.glyphs[u];return D?D.metrics.advance*s.scale+y:0}}function Sv(u,s,c,g){const y=Math.pow(u-s,2);return g?u<s?y/2:2*y:y+Math.abs(c)*c}function i1(u,s,c){let g=0;return u===10&&(g-=1e4),c&&(g+=150),u!==40&&u!==65288||(g+=50),s!==41&&s!==65289||(g+=50),g}function Tv(u,s,c,g,y,T){let E=null,D=Sv(s,c,y,T);for(const W of g){const X=Sv(s-W.x,c,y,T)+W.badness;X<=D&&(E=W,D=X)}return{index:u,x:s,priorBreak:E,badness:D}}function Ev(u){return u?Ev(u.priorBreak).concat(u.index):[]}function Wg(u){let s=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function Mv(u,s,c,g,y){if(!(s||c||g||y))return;const T=u.length-1,E=u[T],D=(E.x+E.metrics.advance*E.scale)*s;for(let W=0;W<=T;W++)u[W].x-=D,u[W].y+=c+g+y}function Av(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function r1(u,s,c,g){const{horizontalAlign:y,verticalAlign:T}=Wg(g),E=c[0]-u.displaySize[0]*y,D=c[1]-u.displaySize[1]*T;return{imagePrimary:u,imageSecondary:s,top:D,bottom:D+u.displaySize[1],left:E,right:E+u.displaySize[0]}}function Cv(u,s,c,g,y,T){const E=u.imagePrimary;let D;if(E.content){const Pt=E.content,zt=E.pixelRatio||1;D=[Pt[0]/zt,Pt[1]/zt,E.displaySize[0]-Pt[2]/zt,E.displaySize[1]-Pt[3]/zt]}const W=s.left*T,X=s.right*T;let ae,ce,fe,ye;c==="width"||c==="both"?(ye=y[0]+W-g[3],ce=y[0]+X+g[1]):(ye=y[0]+(W+X-E.displaySize[0])/2,ce=ye+E.displaySize[0]);const _t=s.top*T,St=s.bottom*T;return c==="height"||c==="both"?(ae=y[1]+_t-g[0],fe=y[1]+St+g[2]):(ae=y[1]+(_t+St-E.displaySize[1])/2,fe=ae+E.displaySize[1]),{imagePrimary:E,imageSecondary:void 0,top:ae,right:ce,bottom:fe,left:ye,collisionPadding:D}}function Pv(u){return!u.imagePrimary.stretchX}function Iv(u){return!u.imagePrimary.stretchY}function Rv(u){return{width:u.right-u.left,height:u.bottom-u.top}}const sl=128;function Lv(u,s,c){const{expression:g}=s;if(g.kind==="constant")return{kind:"constant",layoutSize:g.evaluate(new ps(u+1,{worldview:c}))};if(g.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:T}=g;let E=0;for(;E<y.length&&y[E]<=u;)E++;E=Math.max(0,E-1);let D=E;for(;D<y.length&&y[D]<u+1;)D++;D=Math.min(y.length-1,D);const W=y[E],X=y[D];return g.kind==="composite"?{kind:"composite",minZoom:W,maxZoom:X,interpolationType:T}:{kind:"camera",minZoom:W,maxZoom:X,minSize:g.evaluate(new ps(W,{worldview:c})),maxSize:g.evaluate(new ps(X,{worldview:c})),interpolationType:T}}}function qg(u,{uSize:s,uSizeT:c},{lowerSize:g,upperSize:y}){return u.kind==="source"?g/sl:u.kind==="composite"?pn(g/sl,y/sl,c):s}function gd(u,s,c=1){let g=0,y=0;if(u.kind==="constant")y=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:T,minZoom:E,maxZoom:D}=u,W=T?Jt(jo.interpolationFactor(T,s,E,D),0,1):0;u.kind==="camera"?y=pn(u.minSize,u.maxSize,W)*c:g=W*c}return{uSizeT:g,uSize:y}}class Ll extends rr{constructor(s,c,g,y,T){super(s,c),this.angle=y,this.z=g,T!==void 0&&(this.segment=T)}clone(){return new Ll(this.x,this.y,this.z,this.angle,this.segment)}}function kv(u,s,c,g,y){if(s.segment===void 0)return!0;let T=s,E=s.segment+1,D=0;for(;D>-c/2;){if(E--,E<0)return!1;D-=u[E].dist(T),T=u[E]}D+=u[E].dist(u[E+1]),E++;const W=[];let X=0;for(;D<c/2;){const ae=u[E],ce=u[E+1];if(!ce)return!1;let fe=u[E-1].angleTo(ae)-ae.angleTo(ce);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),W.push({distance:D,angleDelta:fe}),X+=fe;D-W[0].distance>g;)X-=W.shift().angleDelta;if(X>y)return!1;E++,D+=ae.dist(ce)}return!0}function Dv(u){let s=0;for(let c=0;c<u.length-1;c++)s+=u[c].dist(u[c+1]);return s}function Fv(u,s,c){return u?.6*s*c:0}function Ov(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function n1(u,s,c,g,y,T){const E=Fv(c,y,T),D=Ov(c,g)*T;let W=0;const X=Dv(u)/2;for(let ae=0;ae<u.length-1;ae++){const ce=u[ae],fe=u[ae+1],ye=ce.dist(fe);if(W+ye>X){const _t=(X-W)/ye,St=pn(ce.x,fe.x,_t),Pt=pn(ce.y,fe.y,_t),zt=new Ll(St,Pt,0,fe.angleTo(ce),ae);return!E||kv(u,zt,D,E,s)?zt:void 0}W+=ye}}function s1(u,s,c,g,y,T,E,D,W){const X=Fv(g,T,E),ae=Ov(g,y),ce=ae*E,fe=u[0].x===0||u[0].x===W||u[0].y===0||u[0].y===W;return s-ce<s/4&&(s=ce+s/4),zv(u,fe?s/2*D%s:(ae/2+2*T)*E*D%s,s,X,c,ce,fe,!1,W)}function zv(u,s,c,g,y,T,E,D,W){const X=T/2,ae=Dv(u);let ce=0,fe=s-c,ye=[];for(let _t=0;_t<u.length-1;_t++){const St=u[_t],Pt=u[_t+1],zt=St.dist(Pt),Kt=Pt.angleTo(St);for(;fe+c<ce+zt;){fe+=c;const Qt=(fe-ce)/zt,Tt=pn(St.x,Pt.x,Qt),Wt=pn(St.y,Pt.y,Qt);if(Tt>=0&&Tt<W&&Wt>=0&&Wt<W&&fe-X>=0&&fe+X<=ae){const ti=new Ll(Tt,Wt,0,Kt,_t);g&&!kv(u,ti,T,g,y)||ye.push(ti)}}ce+=zt}return D||ye.length||E||(ye=zv(u,ce/2,c,g,y,T,E,!0,W)),ye}function Bv(u){let s=0,c=0;for(const E of u)s+=E.w*E.h,c=Math.max(c,E.w);u.sort((E,D)=>D.h-E.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}];let y=0,T=0;for(const E of u)for(let D=g.length-1;D>=0;D--){const W=g[D];if(!(E.w>W.w||E.h>W.h)){if(E.x=W.x,E.y=W.y,T=Math.max(T,E.y+E.h),y=Math.max(y,E.x+E.w),E.w===W.w&&E.h===W.h){const X=g.pop();D<g.length&&(g[D]=X)}else E.h===W.h?(W.x+=E.w,W.w-=E.w):E.w===W.w?(W.y+=E.h,W.h-=E.h):(g.push({x:W.x+E.w,y:W.y,w:W.w-E.w,h:E.h}),W.y+=E.h,W.h-=E.h);break}}return{w:y,h:T,fill:s/(y*T)||0}}jr(Ll,"Anchor");const Su=1;class _d{static getImagePositionScale(s,c,g){if(c&&s&&s.options&&s.options.transform){const y=s.options.transform;return{x:y.a,y:y.d}}return{x:g,y:g}}constructor(s,c,g,y){this.paddedRect=s;const{pixelRatio:T,version:E,stretchX:D,stretchY:W,content:X,sdf:ae,usvg:ce}=c;this.pixelRatio=T,this.stretchX=D,this.stretchY=W,this.content=X,this.version=E,this.padding=g,this.sdf=ae,this.usvg=ce,this.scale=_d.getImagePositionScale(y,ce,T)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Xg(u,s,c){const g=Sa.parse(u),y=function(T,E,D=[1,1]){return{x:0,y:0,w:(T.data?T.data.width:T.width*D[0])+2*E,h:(T.data?T.data.height:T.height*D[1])+2*E}}(s,c,[g.options.transform.a,g.options.transform.d]);return{bin:y,imagePosition:new _d(y,s,c,g),imageVariant:g}}class Nv{constructor(s,c,g){const y=new Map,T=new Map;this.haveRenderCallbacks=[];const E=[];this.addImages(s,y,Su,E),this.addImages(c,T,2,E);const{w:D,h:W}=Bv(E),X=new vo({width:D||1,height:W||1});for(const[ae,ce]of s.entries()){const fe=y.get(ae).paddedRect;vo.copy(ce.data,X,{x:0,y:0},{x:fe.x+Su,y:fe.y+Su},ce.data,g,ce.sdf)}for(const[ae,ce]of c.entries()){const fe=T.get(ae),ye=fe.paddedRect;let _t=fe.padding;const St=ye.x+_t,Pt=ye.y+_t,zt=ce.data.width,Kt=ce.data.height;_t=_t>1?_t-1:_t,vo.copy(ce.data,X,{x:0,y:0},{x:St,y:Pt},ce.data,g),vo.copy(ce.data,X,{x:0,y:Kt-_t},{x:St,y:Pt-_t},{width:zt,height:_t},g),vo.copy(ce.data,X,{x:0,y:0},{x:St,y:Pt+Kt},{width:zt,height:_t},g),vo.copy(ce.data,X,{x:zt-_t,y:0},{x:St-_t,y:Pt},{width:_t,height:Kt},g),vo.copy(ce.data,X,{x:0,y:0},{x:St+zt,y:Pt},{width:_t,height:Kt},g),vo.copy(ce.data,X,{x:zt-_t,y:Kt-_t},{x:St-_t,y:Pt-_t},{width:_t,height:_t},g),vo.copy(ce.data,X,{x:0,y:Kt-_t},{x:St+zt,y:Pt-_t},{width:_t,height:_t},g),vo.copy(ce.data,X,{x:0,y:0},{x:St+zt,y:Pt+Kt},{width:_t,height:_t},g),vo.copy(ce.data,X,{x:zt-_t,y:0},{x:St-_t,y:Pt+Kt},{width:_t,height:_t},g)}this.lut=g,this.image=X,this.iconPositions=y,this.patternPositions=T}addImages(s,c,g,y){for(const[T,E]of s.entries()){const{bin:D,imagePosition:W,imageVariant:X}=Xg(T,E,g);c.set(T,W),y.push(D),E.hasRenderCallback&&this.haveRenderCallbacks.push(X.id)}}patchUpdatedImages(s,c,g){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(y=>s.hasImage(y,g)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,g);for(const y of s.getUpdatedImages(g)){for(const T of this.iconPositions.keys()){const E=Sa.parse(T);if(Oo.isEqual(E.id,y)){const D=s.getImage(y,g);this.patchUpdatedImage(this.iconPositions.get(T),D,c)}}for(const T of this.patternPositions.keys()){const E=Sa.parse(T);if(Oo.isEqual(E.id,y)){const D=s.getImage(y,g);this.patchUpdatedImage(this.patternPositions.get(T),D,c)}}}}patchUpdatedImage(s,c,g){if(!s||!c||s.version===c.version)return;s.version=c.version;const[y,T]=s.tl,E=s.sdf;if(this.lut||E){const D={width:c.data.width,height:c.data.height},W=new vo(D);vo.copy(c.data,W,{x:0,y:0},{x:0,y:0},D,this.lut,E),g.update(W,{position:{x:y,y:T}})}else g.update(c.data,{position:{x:y,y:T}})}}jr(_d,"ImagePosition"),jr(Nv,"ImageAtlas");const Qp=1e20;function Vv(u,s,c,g,y,T,E,D,W){for(let X=s;X<s+g;X++)$v(u,c*T+X,T,y,E,D,W);for(let X=c;X<c+y;X++)$v(u,X*T+s,1,g,E,D,W)}function $v(u,s,c,g,y,T,E){T[0]=0,E[0]=-1e20,E[1]=Qp,y[0]=u[s];for(let D=1,W=0,X=0;D<g;D++){y[D]=u[s+D*c];const ae=D*D;do{const ce=T[W];X=(y[D]-y[ce]+ae-ce*ce)/(D-ce)/2}while(X<=E[W]&&--W>-1);W++,T[W]=D,E[W]=X,E[W+1]=Qp}for(let D=0,W=0;D<g;D++){for(;E[W+1]<D;)W++;const X=T[W],ae=D-X;u[s+D*c]=y[X]+ae*ae}}const Da=2,Zg={none:0,ideographs:1,all:2};class zh{constructor(s,c,g){this.requestManager=s,this.localGlyphMode=c,this.localFontFamily=g,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s,c){this.urls[c]=s}getGlyphs(s,c,g){const y=[],T=this.urls[c]||po.GLYPHS_URL;for(const E in s)for(const D of s[E])y.push({stack:E,id:D});bi(y,({stack:E,id:D},W)=>{let X=this.entries[E];X||(X=this.entries[E]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let ae=X.glyphs[D];if(ae!==void 0)return void W(null,{stack:E,id:D,glyph:ae});if(ae=this._tinySDF(X,E,D),ae)return X.glyphs[D]=ae,void W(null,{stack:E,id:D,glyph:ae});const ce=Math.floor(D/256);if(256*ce>65535)return yn("glyphs > 65535 not supported"),void W(null,{stack:E,id:D,glyph:ae});if(X.ranges[ce])return void W(null,{stack:E,id:D,glyph:ae});let fe=X.requests[ce];fe||(fe=X.requests[ce]=[],zh.loadGlyphRange(E,ce,T,this.requestManager,(ye,_t)=>{if(_t){X.ascender=_t.ascender,X.descender=_t.descender;for(const St in _t.glyphs)this._doesCharSupportLocalGlyph(+St)||(X.glyphs[+St]=_t.glyphs[+St]);X.ranges[ce]=!0}for(const St of fe)St(ye,_t);delete X.requests[ce]})),fe.push((ye,_t)=>{ye?W(ye):_t&&W(null,{stack:E,id:D,glyph:_t.glyphs[D]||null})})},(E,D)=>{if(E)g(E);else if(D){const W={};for(const{stack:X,id:ae,glyph:ce}of D)W[X]===void 0&&(W[X]={}),W[X].glyphs===void 0&&(W[X].glyphs={}),W[X].glyphs[ae]=ce&&{id:ce.id,bitmap:ce.bitmap.clone(),metrics:ce.metrics},W[X].ascender=this.entries[X].ascender,W[X].descender=this.entries[X].descender;g(null,W)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==Zg.none&&(this.localGlyphMode===Zg.all?!!this.localFontFamily:!!this.localFontFamily&&(cn["CJK Unified Ideographs"](s)||cn["Hangul Syllables"](s)||cn.Hiragana(s)||cn.Katakana(s)||cn["CJK Symbols and Punctuation"](s)||cn["CJK Unified Ideographs Extension A"](s)||cn["CJK Unified Ideographs Extension B"](s)||cn.Osage(s)))}_tinySDF(s,c,g){const y=this.localFontFamily;if(!y||!this._doesCharSupportLocalGlyph(g))return;let T=s.tinySDF;if(!T){let St="400";/bold/i.test(c)?St="900":/medium/i.test(c)?St="500":/light/i.test(c)&&(St="200"),T=s.tinySDF=new zh.TinySDF({fontFamily:y,fontWeight:St,fontSize:24*Da,buffer:3*Da,radius:8*Da}),T.fontWeight=St}if(this.localGlyphs[T.fontWeight][g])return this.localGlyphs[T.fontWeight][g];const E=String.fromCodePoint(g),{data:D,width:W,height:X,glyphWidth:ae,glyphHeight:ce,glyphLeft:fe,glyphTop:ye,glyphAdvance:_t}=T.draw(E);return this.localGlyphs[T.fontWeight][g]={id:g,bitmap:new gc({width:W,height:X},D),metrics:{width:ae/Da,height:ce/Da,left:fe/Da,top:ye/Da-27,advance:_t/Da,localGlyph:!0}}}}zh.loadGlyphRange=function(u,s,c,g,y){const T=256*s,E=T+255,D=g.transformRequest(g.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${T}-${E}`),Ic.Glyphs);Rc(D,(W,X)=>{if(W)y(W);else if(X){const ae={},ce=function(fe){return new Kp(fe).readFields(Kb,{})}(X);for(const fe of ce.glyphs)ae[fe.id]=fe;y(null,{glyphs:ae,ascender:ce.ascender,descender:ce.descender})}})},zh.TinySDF=class{constructor({fontSize:u=24,buffer:s=3,radius:c=8,cutoff:g=.25,fontFamily:y="sans-serif",fontWeight:T="normal",fontStyle:E="normal"}={}){this.buffer=s,this.cutoff=g,this.radius=c;const D=this.size=u+4*s,W=this._createCanvas(D),X=this.ctx=W.getContext("2d",{willReadFrequently:!0});X.font=`${E} ${T} ${u}px ${y}`,X.textBaseline="alphabetic",X.textAlign="left",X.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(u){const s=document.createElement("canvas");return s.width=s.height=u,s}draw(u){const{width:s,actualBoundingBoxAscent:c,actualBoundingBoxDescent:g,actualBoundingBoxLeft:y,actualBoundingBoxRight:T}=this.ctx.measureText(u),E=Math.ceil(c),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-y))),W=Math.min(this.size-this.buffer,E+Math.ceil(g)),X=D+2*this.buffer,ae=W+2*this.buffer,ce=Math.max(X*ae,0),fe=new Uint8ClampedArray(ce),ye={data:fe,width:X,height:ae,glyphWidth:D,glyphHeight:W,glyphTop:E,glyphLeft:0,glyphAdvance:s};if(D===0||W===0)return ye;const{ctx:_t,buffer:St,gridInner:Pt,gridOuter:zt}=this;_t.clearRect(St,St,D,W),_t.fillText(u,St,St+E);const Kt=_t.getImageData(St,St,D,W);zt.fill(Qp,0,ce),Pt.fill(0,0,ce);for(let Qt=0;Qt<W;Qt++)for(let Tt=0;Tt<D;Tt++){const Wt=Kt.data[4*(Qt*D+Tt)+3]/255;if(Wt===0)continue;const ti=(Qt+St)*X+Tt+St;if(Wt===1)zt[ti]=0,Pt[ti]=Qp;else{const ci=.5-Wt;zt[ti]=ci>0?ci*ci:0,Pt[ti]=ci<0?ci*ci:0}}Vv(zt,0,0,X,ae,X,this.f,this.v,this.z),Vv(Pt,St,St,D,W,X,this.f,this.v,this.z);for(let Qt=0;Qt<ce;Qt++){const Tt=Math.sqrt(zt[Qt])-Math.sqrt(Pt[Qt]);fe[Qt]=Math.round(255-255*(Tt/this.radius+this.cutoff))}return ye}};const Tu=Su;function Uv(u,s){return u+s[1]-s[0]}function Gv(u,s,c,g,y=1){const T=[],E=u.imagePrimary,D=E.pixelRatio,W=E.paddedRect.w-2*Tu,X=E.paddedRect.h-2*Tu,ae=(u.right-u.left)*y,ce=(u.bottom-u.top)*y,fe=E.stretchX||[[0,W]],ye=E.stretchY||[[0,X]],_t=fe.reduce(Uv,0),St=ye.reduce(Uv,0),Pt=W-_t,zt=X-St;let Kt=0,Qt=_t,Tt=0,Wt=St,ti=0,ci=Pt,ki=0,Ci=zt;if(E.content&&g){const Vi=E.content;Kt=em(fe,0,Vi[0]),Tt=em(ye,0,Vi[1]),Qt=em(fe,Vi[0],Vi[2]),Wt=em(ye,Vi[1],Vi[3]),ti=Vi[0]-Kt,ki=Vi[1]-Tt,ci=Vi[2]-Vi[0]-Qt,Ci=Vi[3]-Vi[1]-Wt}const Di=(Vi,Qi,br,hr)=>{const xr=tm(Vi.stretch-Kt,Qt,ae,u.left*y),Sr=im(Vi.fixed-ti,ci,Vi.stretch,_t),tr=tm(Qi.stretch-Tt,Wt,ce,u.top*y),yr=im(Qi.fixed-ki,Ci,Qi.stretch,St),Yi=tm(br.stretch-Kt,Qt,ae,u.left*y),er=im(br.fixed-ti,ci,br.stretch,_t),Cr=tm(hr.stretch-Tt,Wt,ce,u.top*y),Lr=im(hr.fixed-ki,Ci,hr.stretch,St),an=new rr(xr,tr),Yr=new rr(Yi,tr),zr=new rr(Yi,Cr),Ar=new rr(xr,Cr),vn=new rr(Sr/D,yr/D),Zr=new rr(er/D,Lr/D),Kr=s*Math.PI/180;if(Kr){const Ln=Math.sin(Kr),os=Math.cos(Kr),Ts=[os,-Ln,Ln,os];an._matMult(Ts),Yr._matMult(Ts),Ar._matMult(Ts),zr._matMult(Ts)}const mn=Vi.stretch+Vi.fixed,Tn=br.stretch+br.fixed,bn=Qi.stretch+Qi.fixed,Rn=hr.stretch+hr.fixed,Mn=u.imageSecondary;return{tl:an,tr:Yr,bl:Ar,br:zr,texPrimary:{x:E.paddedRect.x+Tu+mn,y:E.paddedRect.y+Tu+bn,w:Tn-mn,h:Rn-bn},texSecondary:Mn?{x:Mn.paddedRect.x+Tu+mn,y:Mn.paddedRect.y+Tu+bn,w:Tn-mn,h:Rn-bn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vn,pixelOffsetBR:Zr,minFontScaleX:ci/D/ae,minFontScaleY:Ci/D/ce,isSDF:c}};if(g&&(E.stretchX||E.stretchY)){const Vi=Hv(fe,Pt,_t),Qi=Hv(ye,zt,St);for(let br=0;br<Vi.length-1;br++){const hr=Vi[br],xr=Vi[br+1];for(let Sr=0;Sr<Qi.length-1;Sr++)T.push(Di(hr,Qi[Sr],xr,Qi[Sr+1]))}}else T.push(Di({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:W+1},{fixed:0,stretch:X+1}));return T}function em(u,s,c){let g=0;for(const y of u)g+=Math.max(s,Math.min(c,y[1]))-Math.max(s,Math.min(c,y[0]));return g}function Hv(u,s,c){const g=[{fixed:-1,stretch:0}];for(const[y,T]of u){const E=g[g.length-1];g.push({fixed:y-E.stretch,stretch:E.stretch}),g.push({fixed:y-E.stretch,stretch:E.stretch+(T-y)})}return g.push({fixed:s+Tu,stretch:c}),g}function tm(u,s,c,g){return u/s*c+g}function im(u,s,c,g){return u-s*c/g}function o1(u,s,c,g){const y=s+u.positionedLines[g].lineOffset;return g===0?c+y/2:c+(y+(s+u.positionedLines[g-1].lineOffset))/2}function a1(u,s=1,c=!1){let g=1/0,y=1/0,T=-1/0,E=-1/0;const D=u[0];for(let ye=0;ye<D.length;ye++){const _t=D[ye];(!ye||_t.x<g)&&(g=_t.x),(!ye||_t.y<y)&&(y=_t.y),(!ye||_t.x>T)&&(T=_t.x),(!ye||_t.y>E)&&(E=_t.y)}const W=Math.min(T-g,E-y);let X=W/2;const ae=new Hu([],l1);if(W===0)return new rr(g,y);for(let ye=g;ye<T;ye+=W)for(let _t=y;_t<E;_t+=W)ae.push(new Bh(ye+X,_t+X,X,u));let ce=function(ye){let _t=0,St=0,Pt=0;const zt=ye[0];for(let Kt=0,Qt=zt.length,Tt=Qt-1;Kt<Qt;Tt=Kt++){const Wt=zt[Kt],ti=zt[Tt],ci=Wt.x*ti.y-ti.x*Wt.y;St+=(Wt.x+ti.x)*ci,Pt+=(Wt.y+ti.y)*ci,_t+=3*ci}return new Bh(St/_t,Pt/_t,0,ye)}(u),fe=ae.length;for(;ae.length;){const ye=ae.pop();(ye.d>ce.d||!ce.d)&&(ce=ye,c&&console.log("found best %d after %d probes",Math.round(1e4*ye.d)/1e4,fe)),ye.max-ce.d<=s||(X=ye.h/2,ae.push(new Bh(ye.p.x-X,ye.p.y-X,X,u)),ae.push(new Bh(ye.p.x+X,ye.p.y-X,X,u)),ae.push(new Bh(ye.p.x-X,ye.p.y+X,X,u)),ae.push(new Bh(ye.p.x+X,ye.p.y+X,X,u)),fe+=4)}return c&&(console.log(`num probes: ${fe}`),console.log(`best distance: ${ce.d}`)),ce.p}function l1(u,s){return s.max-u.max}class Bh{constructor(s,c,g,y){this.p=new rr(s,c),this.h=g,this.d=function(T,E){let D=!1,W=1/0;for(let X=0;X<E.length;X++){const ae=E[X];for(let ce=0,fe=ae.length,ye=fe-1;ce<fe;ye=ce++){const _t=ae[ce],St=ae[ye];_t.y>T.y!=St.y>T.y&&T.x<(St.x-_t.x)*(T.y-_t.y)/(St.y-_t.y)+_t.x&&(D=!D),W=Math.min(W,Ah(T,_t,St))}}return(D?1:-1)*Math.sqrt(W)}(this.p,y),this.max=this.d+this.h*Math.SQRT2}}const c1=Object.keys,Yg=Number.POSITIVE_INFINITY,u1=Math.sqrt(2);function jv(u,[s,c]){let g=0,y=0;if(c===Yg){s<0&&(s=0);const T=s/u1;switch(u){case"top-right":case"top-left":y=T-7;break;case"bottom-right":case"bottom-left":y=7-T;break;case"bottom":y=7-s;break;case"top":y=s-7}switch(u){case"top-right":case"bottom-right":g=-T;break;case"top-left":case"bottom-left":g=T;break;case"left":g=s;break;case"right":g=-s}}else{switch(s=Math.abs(s),c=Math.abs(c),u){case"top-right":case"top-left":case"top":y=c-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-c}switch(u){case"top-right":case"bottom-right":case"right":g=-s;break;case"top-left":case"bottom-left":case"left":g=s}}return[g,y]}function rm(u,s,c,g,y,T,E,D,W){if(!s||!s.usvg)return;const X=Rv(g),ae=Rv(y),ce=T!=="both"&&T!=="width"||!Pv(g)?1:ae.width/X.width,fe=T!=="both"&&T!=="height"||!Iv(g)?1:ae.height/X.height;c.scaleSelf(ce,fe);const ye=c.toString();E.set(ye,c),D.set(ye,s);const{imagePosition:_t}=Xg(ye,s,Su);W.set(ye,_t)}function Wv(u,s,c,g,y,T,E,D,W){if(!u)return;const X=function(ae,ce,fe,ye,_t,St){if(ae.kind==="camera")return ae.maxSize;if(ae.kind==="composite"){const Pt=ce.possiblyEvaluate(new ps(ae.maxZoom,{worldview:St}),fe).evaluate(_t,{},fe),zt=ce.possiblyEvaluate(new ps(ae.minZoom,{worldview:St}),fe).evaluate(_t,{},fe);return Math.max(Pt,zt)}return ce.possiblyEvaluate(new ps(ye,{worldview:St})).evaluate(_t,{},fe)}(s,c,g,y,T,W);return u.scaleSelf(X*D*E)}function qv(u,s,c,g,y,T,E,D,W){return{iconPrimary:Wv(u.getPrimary(),s,c,g,y,T,E,D,W),iconSecondary:Wv(u.getSecondary(),s,c,g,y,T,E,D,W)}}function h1(u,s,c){if(!s)return;const g=c.get(u.toString()),y=c.get(s.toString());y&&(g.paddedRect.w===y.paddedRect.w&&g.paddedRect.h===y.paddedRect.h||yn(`Mismatch in icon variant sizes: ${u.toString()} and ${s.toString()}`),g.usvg!==y.usvg&&yn(`Mismatch in icon variant image types: ${u.id} and ${s.id}`))}function Xv(u,s,c,g){if(!u)return;const y=s.get(c.toString());if(u.imagePrimary=y,g){const T=s.get(g.toString());u.imageSecondary=T}}function f1(u,s){for(const c in u.horizontal)Zv(u.horizontal[c],s);Zv(u.vertical,s)}function Zv(u,s){if(u){for(const c of u.positionedLines)for(const g of c.positionedGlyphs)if(g.image!==null){const y=g.image.toString();g.rect=s.get(y).paddedRect}}}function Kg(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d1(u,s,c,g,y,T,E,D,W){const X=Jg(T.horizontal)||T.vertical,ae=c.get("icon-text-fit-padding").evaluate(g,{},y);let ce,fe=s;return s&&W!=="none"&&(u.allowVerticalPlacement&&T.vertical&&(ce=Cv(s,T.vertical,W,ae,D,E)),X&&(fe=Cv(s,X,W,ae,D,E))),{defaultShapedIcon:fe,verticallyShapedIcon:ce}}function p1(u,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt,Kt,Qt){let Tt=E.textMaxSize.evaluate(s,{},fe);Tt===void 0?Tt=D*E.textScaleFactor:Tt*=E.textScaleFactor;const Wt=u.layers[0].layout,ti=Jg(c.horizontal)||c.vertical,ci=ye.name==="globe",ki=fo,Ci=u.tilePixelRatio*Tt/ki,Di=(Sr=u.overscaling,u.zoom>18&&Sr>2&&(Sr>>=1),Math.max(Fr/(512*Sr),1)*Wt.get("symbol-spacing")),Vi=Wt.get("text-padding")*u.tilePixelRatio,Qi=Wt.get("icon-padding")*u.tilePixelRatio,br=Ai(Wt.get("text-max-angle")),hr=Wt.get("icon-rotation-alignment")==="map"&&Qt!=="point",xr=Di/2;var Sr;u.hasAnyIconTextFit===!1&&Pt!=="none"&&(u.hasAnyIconTextFit=!0);const tr=s.properties?+s.properties[Fn]:null,yr=tr&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(tr):65535,Yi=(er,Cr,Lr)=>{if(Cr.x<0||Cr.x>=Fr||Cr.y<0||Cr.y>=Fr)return;let an=null;if(ci){const{x:Yr,y:zr,z:Ar}=ye.projectTilePoint(Cr.x,Cr.y,Lr);an={anchor:new Ll(Yr,zr,Ar,0,void 0),up:ye.upVector(Lr,Cr.x,Cr.y)}}(function(Yr,zr,Ar,vn,Zr,Kr,mn,Tn,bn,Rn,Mn,Ln,os,Ts,ai,hi,sr,Dr,Br,Or,Xr,dn,On,zn,An,us,ys,Bn,Vs){const Es=Yr.addToLineVertexArray(zr,vn);let as,Xs,Rs,vs,Ms,ds,Pn,ms=0,$s=0,un=0,Wn=0,Ls=-1,Ws=-1;const Fs={};let so=kc("");const gs=Ar?Ar.anchor:zr,ro=Bn!=="none";let Vo=0,xo=0;if(bn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const oo=bn.layout.get("text-offset").evaluate(Xr,{},An);Vo=oo[0]*fo,xo=oo[1]*fo}else Vo=bn.layout.get("text-radial-offset").evaluate(Xr,{},An)*fo,xo=Yg;if(Yr.allowVerticalPlacement&&Zr.vertical){const oo=Zr.vertical;if(ai)ds=Qg(oo),Tn&&(Pn=Qg(Tn));else{const lo=bn.layout.get("text-rotate").evaluate(Xr,{},An)+90;Rs=nm(Rn,gs,zr,Mn,Ln,os,oo,Ts,lo,hi),Tn&&(vs=nm(Rn,gs,zr,Mn,Ln,os,Tn,Dr,lo))}}if(Kr){const oo=Yr.iconSizeData,lo=bn.layout.get("icon-rotate").evaluate(Xr,{},An),bo=Gv(Kr,lo,On,ro,dn.iconScaleFactor),Ro=Tn?Gv(Tn,lo,On,ro,dn.iconScaleFactor):void 0;Xs=nm(Rn,gs,zr,Mn,Ln,os,Kr,Dr,lo,null),ms=4*bo.length;let Eo=null;oo.kind==="source"?(Eo=[sl*bn.layout.get("icon-size").evaluate(Xr,{},An)*dn.iconScaleFactor],Eo[0]>yc&&yn(`${Yr.layerIds[0]}: Value for "icon-size" is >= ${yd}. Reduce your "icon-size".`)):oo.kind==="composite"&&(Eo=[sl*dn.compositeIconSizes[0].evaluate(Xr,{},An)*dn.iconScaleFactor,sl*dn.compositeIconSizes[1].evaluate(Xr,{},An)*dn.iconScaleFactor],(Eo[0]>yc||Eo[1]>yc)&&yn(`${Yr.layerIds[0]}: Value for "icon-size" is >= ${yd}. Reduce your "icon-size".`)),Yr.addSymbols(Yr.icon,bo,Eo,Or,Br,Xr,void 0,Ar,zr,Es.lineStartIndex,Es.lineLength,-1,zn,An,us,ys),Ls=Yr.icon.placedSymbolArray.length-1,Ro&&($s=4*Ro.length,Yr.addSymbols(Yr.icon,Ro,Eo,Or,Br,Xr,qo.vertical,Ar,zr,Es.lineStartIndex,Es.lineLength,-1,zn,An,us,ys),Ws=Yr.icon.placedSymbolArray.length-1)}for(const oo in Zr.horizontal){const lo=oo,bo=Zr.horizontal[lo];as||(so=kc(bo.text),ai?Ms=Qg(bo):as=nm(Rn,gs,zr,Mn,Ln,os,bo,Ts,bn.layout.get("text-rotate").evaluate(Xr,{},An),hi));const Ro=bo.positionedLines.length===1;if(un+=Yv(Yr,Ar,zr,bo,mn,bn,ai,Xr,hi,Es,Zr.vertical?qo.horizontal:qo.horizontalOnly,Ro?c1(Zr.horizontal):[lo],Fs,Ls,dn,zn,An,us),Ro)break}Zr.vertical&&(Wn+=Yv(Yr,Ar,zr,Zr.vertical,mn,bn,ai,Xr,hi,Es,qo.vertical,["vertical"],Fs,Ws,dn,zn,An,us));let yo=-1;const $o=(oo,lo)=>oo?Math.max(oo,lo):lo;yo=$o(Ms,yo),yo=$o(ds,yo),yo=$o(Pn,yo);const ol=yo>-1?1:0;Yr.glyphOffsetArray.length>=65535&&yn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xr.sortKey!==void 0&&Yr.addToSortKeyRanges(Yr.symbolInstances.length,Xr.sortKey),Yr.symbolInstances.emplaceBack(zr.x,zr.y,gs.x,gs.y,gs.z,Fs.right>=0?Fs.right:-1,Fs.center>=0?Fs.center:-1,Fs.left>=0?Fs.left:-1,Fs.vertical>=0?Fs.vertical:-1,Ls,Ws,so,as!==void 0?as:Yr.collisionBoxArray.length,as!==void 0?as+1:Yr.collisionBoxArray.length,Rs!==void 0?Rs:Yr.collisionBoxArray.length,Rs!==void 0?Rs+1:Yr.collisionBoxArray.length,Xs!==void 0?Xs:Yr.collisionBoxArray.length,Xs!==void 0?Xs+1:Yr.collisionBoxArray.length,vs||Yr.collisionBoxArray.length,vs?vs+1:Yr.collisionBoxArray.length,Mn,un,Wn,ms,$s,ol,0,Vo,xo,yo,0,ro?1:0,Vs)})(u,Cr,an,er,c,g,T,y,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,Vi,Kt,X,0,Qi,hr,zt,s,E,ae,ce,fe,_t,St,Pt,yr)};if(Qt==="line")for(const er of qp(s.geometry,0,0,Fr,Fr)){const Cr=s1(er,Di,br,c.vertical||ti,g,ki,Ci,u.overscaling,Fr);for(const Lr of Cr)ti&&m1(u,ti.text,xr,Lr)||Yi(er,Lr,fe)}else if(Qt==="line-center"){for(const er of s.geometry)if(er.length>1){const Cr=n1(er,br,c.vertical||ti,g,ki,Ci);Cr&&Yi(er,Cr,fe)}}else if(s.type==="Polygon")for(const er of $p(s.geometry,0)){const Cr=a1(er,16);Yi(er[0],new Ll(Cr.x,Cr.y,0,0,void 0),fe)}else if(s.type==="LineString")for(const er of s.geometry)Yi(er,new Ll(er[0].x,er[0].y,0,0,void 0),fe);else if(s.type==="Point")for(const er of s.geometry)for(const Cr of er)Yi([Cr],new Ll(Cr.x,Cr.y,0,0,void 0),fe)}const yd=255,yc=yd*sl;function Yv(u,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt,zt){const Kt=function(Wt,ti,ci,ki,Ci,Di,Vi,Qi){const br=[];if(ti.positionedLines.length===0)return br;const hr=ki.layout.get("text-rotate").evaluate(Di,{})*Math.PI/180,xr=function(er){const Cr=er[0],Lr=er[1],an=Cr*Lr;return an>0?[Cr,-Lr]:an<0?[-Cr,Lr]:Cr===0?[Lr,Cr]:[Lr,-Cr]}(ci);let Sr=Math.abs(ti.top-ti.bottom);for(const er of ti.positionedLines)Sr-=er.lineOffset;const tr=ti.positionedLines.length,yr=Sr/tr;let Yi=ti.top-ci[1];for(let er=0;er<tr;++er){const Cr=ti.positionedLines[er];Yi=o1(ti,yr,Yi,er);for(const Lr of Cr.positionedGlyphs){if(!Lr.rect)continue;const an=Lr.rect||{};let Yr=e1+1,zr=!0,Ar=1,vn=0;if(Lr.image){const Xr=Vi.get(Lr.image.toString());if(!Xr)continue;if(Xr.sdf){yn("SDF images are not supported in formatted text and will be ignored.");continue}zr=!1,Ar=Xr.pixelRatio,Yr=Su/Ar}const Zr=(Ci||Qi)&&Lr.vertical,Kr=Lr.metrics.advance*Lr.scale/2,mn=Lr.metrics,Tn=Lr.rect;if(Tn===null)continue;Qi&&ti.verticalizable&&(vn=Lr.image?Kr-Lr.metrics.width*Lr.scale/2:0);const bn=Ci?[Lr.x+Kr,Lr.y]:[0,0];let Rn=[0,0],Mn=[0,0],Ln=!1;Ci||(Zr?(Mn=[Lr.x+Kr+xr[0],Lr.y+xr[1]-vn],Ln=!0):Rn=[Lr.x+Kr+ci[0],Lr.y+ci[1]-vn]);const os=Tn.w*Lr.scale/(Ar*(Lr.localGlyph?Da:1)),Ts=Tn.h*Lr.scale/(Ar*(Lr.localGlyph?Da:1));let ai,hi,sr,Dr;if(Zr){const Xr=Lr.y-Yi,dn=new rr(-Kr,Kr-Xr),On=-Math.PI/2,zn=new rr(...Mn);ai=new rr(-Kr+Rn[0],Rn[1]),ai._rotateAround(On,dn)._add(zn),ai.x+=-Xr+Kr,ai.y-=(mn.left-Yr)*Lr.scale;const An=Lr.image?mn.advance*Lr.scale:fo*Lr.scale,us=String.fromCodePoint(Lr.glyph);Xb(us)?ai.x+=(1-Yr)*Lr.scale:Zb(us)?ai.x+=An-mn.height*Lr.scale+(-Yr-1)*Lr.scale:ai.x+=Lr.image||mn.width+2*Yr===Tn.w&&mn.height+2*Yr===Tn.h?(An-Ts)/2:(An-(mn.height+2*Yr)*Lr.scale)/2,hi=new rr(ai.x,ai.y-os),sr=new rr(ai.x+Ts,ai.y),Dr=new rr(ai.x+Ts,ai.y-os)}else{const Xr=(mn.left-Yr)*Lr.scale-Kr+Rn[0],dn=(-mn.top-Yr)*Lr.scale+Rn[1],On=Xr+os,zn=dn+Ts;ai=new rr(Xr,dn),hi=new rr(On,dn),sr=new rr(Xr,zn),Dr=new rr(On,zn)}if(hr){let Xr;Xr=Ci?new rr(0,0):Ln?new rr(xr[0],xr[1]):new rr(ci[0],ci[1]),ai._rotateAround(hr,Xr),hi._rotateAround(hr,Xr),sr._rotateAround(hr,Xr),Dr._rotateAround(hr,Xr)}const Br=new rr(0,0),Or=new rr(0,0);br.push({tl:ai,tr:hi,bl:sr,br:Dr,texPrimary:an,texSecondary:void 0,writingMode:ti.writingMode,glyphOffset:bn,sectionIndex:Lr.sectionIndex,isSDF:zr,pixelOffsetTL:Br,pixelOffsetBR:Or,minFontScaleX:0,minFontScaleY:0})}}return br}(0,g,W,T,E,D,y,u.allowVerticalPlacement),Qt=u.textSizeData;let Tt=null;Qt.kind==="source"?(Tt=[sl*T.layout.get("text-size").evaluate(D,{},Pt)*_t.textScaleFactor],Tt[0]>yc&&yn(`${u.layerIds[0]}: Value for "text-size" is >= ${yd}. Reduce your "text-size".`)):Qt.kind==="composite"&&(Tt=[sl*_t.compositeTextSizes[0].evaluate(D,{},Pt)*_t.textScaleFactor,sl*_t.compositeTextSizes[1].evaluate(D,{},Pt)*_t.textScaleFactor],(Tt[0]>yc||Tt[1]>yc)&&yn(`${u.layerIds[0]}: Value for "text-size" is >= ${yd}. Reduce your "text-size".`)),u.addSymbols(u.text,Kt,Tt,W,E,D,ae,s,c,X.lineStartIndex,X.lineLength,ye,St,Pt,zt,!1);for(const Wt of ce)fe[Wt]=u.text.placedSymbolArray.length-1;return 4*Kt.length}function Jg(u){for(const s in u)return u[s];return null}function nm(u,s,c,g,y,T,E,D,W,X){let ae=E.top,ce=E.bottom,fe=E.left,ye=E.right;if(Av(E)&&E.collisionPadding){const _t=E.collisionPadding;fe-=_t[0],ae-=_t[1],ye+=_t[2],ce+=_t[3]}if(W){const _t=new rr(fe,ae),St=new rr(ye,ae),Pt=new rr(fe,ce),zt=new rr(ye,ce),Kt=Ai(W);let Qt=new rr(0,0);X&&(Qt=new rr(X[0],X[1])),_t._rotateAround(Kt,Qt),St._rotateAround(Kt,Qt),Pt._rotateAround(Kt,Qt),zt._rotateAround(Kt,Qt),fe=Math.min(_t.x,St.x,Pt.x,zt.x),ye=Math.max(_t.x,St.x,Pt.x,zt.x),ae=Math.min(_t.y,St.y,Pt.y,zt.y),ce=Math.max(_t.y,St.y,Pt.y,zt.y)}return u.emplaceBack(s.x,s.y,s.z,c.x,c.y,fe,ae,ye,ce,D,g,y,T),u.length-1}function Qg(u){Av(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const s=u.bottom-u.top;return s>0?Math.max(10,s):null}function m1(u,s,c,g){const y=u.compareText;if(s in y){const T=y[s];for(let E=T.length-1;E>=0;E--)if(g.dist(T[E])<c)return!0}else y[s]=[];return y[s].push(g),!1}function Kv(u,s){const c=u.fovAboveCenter,g=u.elevation?u.elevation.getMinElevationBelowMSL()*s:0,y=(u._camera.position[2]*u.worldSize-g)/Math.cos(u._pitch),T=Math.sin(c)*y/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let E=Math.sin(u._pitch)*T+y;const D=y*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let W=Math.max(u.zoom-17,0);u.isOrthographic&&(W/=10),E*=1+W}return Math.min(1.01*E,D)}function vd(u,s){if(!s.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:s};const c=Math.pow(2,-u.z),g=u.x*c,y=(u.x+1)*c,T=u.y*c,E=(u.y+1)*c,D=Pi(g),W=Pi(y),X=ji(T),ae=ji(E),ce=s.project(D,X),fe=s.project(W,X),ye=s.project(W,ae),_t=s.project(D,ae);let St=Math.min(ce.x,fe.x,ye.x,_t.x),Pt=Math.min(ce.y,fe.y,ye.y,_t.y),zt=Math.max(ce.x,fe.x,ye.x,_t.x),Kt=Math.max(ce.y,fe.y,ye.y,_t.y);const Qt=c/16;function Tt(ti,ci,ki,Ci,Di,Vi){const Qi=(ki+Di)/2,br=(Ci+Vi)/2,hr=s.project(Pi(Qi),ji(br)),xr=Math.max(0,St-hr.x,Pt-hr.y,hr.x-zt,hr.y-Kt);St=Math.min(St,hr.x),zt=Math.max(zt,hr.x),Pt=Math.min(Pt,hr.y),Kt=Math.max(Kt,hr.y),xr>Qt&&(Tt(ti,hr,ki,Ci,Qi,br),Tt(hr,ci,Qi,br,Di,Vi))}Tt(ce,fe,g,T,y,T),Tt(fe,ye,y,T,y,E),Tt(ye,_t,y,E,g,E),Tt(_t,ce,g,E,g,T),St-=Qt,Pt-=Qt,zt+=Qt,Kt+=Qt;const Wt=1/Math.max(zt-St,Kt-Pt);return{scale:Wt,x:St*Wt,y:Pt*Wt,x2:zt*Wt,y2:Kt*Wt,projection:s}}function Jv(u,{x:s,y:c},g=0){return new rr(((s-g)*u.scale-u.x)*Fr,(c*u.scale-u.y)*Fr)}const g1=ie(new Float32Array(16));class vc{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,c){return{x:0,y:0,z:0}}unproject(s,c){return new qt(0,0)}projectTilePoint(s,c,g){return{x:s,y:c,z:0}}locationPoint(s,c,g,y=!0){return s._coordinatePoint(s.locationCoordinate(c,g),y)}pixelsPerMeter(s,c){return Ei(1,s)*c}pixelSpaceConversion(s,c,g){return 1}farthestPixelDistance(s){return Kv(s,s.pixelsPerMeter)}pointCoordinate(s,c,g,y){const T=s.horizonLineFromTop(!1),E=new rr(c,Math.max(T,g));return s.rayIntersectionCoordinate(s.pointRayIntersection(E,y))}pointCoordinate3D(s,c,g){const y=new rr(c,g);if(s.elevation)return s.elevation.pointCoordinate(y);{const T=this.pointCoordinate(s,y.x,y.y,0);return[T.x,T.y,T.z]}}isPointAboveHorizon(s,c){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,c.x,c.y);const g=s.horizonLineFromTop();return c.y<g}createInversionMatrix(s,c){return g1}createTileMatrix(s,c,g){let y,T,E;const D=g.canonical,W=ie(new Float64Array(16));if(this.isReprojectedInTileSpace){const X=vd(D,this);y=1,T=X.x+g.wrap*X.scale,E=X.y,le(W,W,[y/X.scale,y/X.scale,s.pixelsPerMeter/c])}else y=c/s.zoomScale(D.z),T=(D.x+Math.pow(2,D.z)*g.wrap)*y,E=D.y*y;return se(W,W,[T,E,0]),le(W,W,[y/Fr,y/Fr,1]),W}upVector(s,c,g){return[0,0,1]}upVectorScale(s,c,g){return{metersToTile:1}}}class _1 extends vc{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[c,g]=this.parallels=s.parallels||[29.5,45.5],y=Math.sin(Ai(c));this.n=(y+Math.sin(Ai(g)))/2,this.c=1+y*(2*this.n-y),this.r0=Math.sqrt(this.c)/this.n}project(s,c){const{n:g,c:y,r0:T}=this,E=Ai(s-this.center[0]),D=Ai(c),W=Math.sqrt(y-2*g*Math.sin(D))/g;return{x:W*Math.sin(E*g),y:W*Math.cos(E*g)-T,z:0}}unproject(s,c){const{n:g,c:y,r0:T}=this,E=T+c;let D=Math.atan2(s,Math.abs(E))*Math.sign(E);E*g<0&&(D-=Math.PI*Math.sign(s)*Math.sign(E));const W=Ai(this.center[0])*g;D=Fi(D,-Math.PI-W,Math.PI-W);const X=Jt(ii(D/g)+this.center[0],-180,180),ae=Math.asin(Jt((y-(s*s+E*E)*g*g)/(2*g),-1,1)),ce=Jt(ii(ae),-85.051129,or);return new qt(X,ce)}}const xd=1.340264,bd=-.081106,wd=893e-6,Sd=.003796,sm=Math.sqrt(3)/2;class y1 extends vc{project(s,c){c=c/180*Math.PI,s=s/180*Math.PI;const g=Math.asin(sm*Math.sin(c)),y=g*g,T=y*y*y;return{x:.5*(s*Math.cos(g)/(sm*(xd+3*bd*y+T*(7*wd+9*Sd*y)))/Math.PI+.5),y:1-.5*(g*(xd+bd*y+T*(wd+Sd*y))/Math.PI+1),z:0}}unproject(s,c){s=(2*s-.5)*Math.PI;let g=c=(2*(1-c)-1)*Math.PI,y=g*g,T=y*y*y;for(let ae,ce,fe,ye=0;ye<12&&(ce=g*(xd+bd*y+T*(wd+Sd*y))-c,fe=xd+3*bd*y+T*(7*wd+9*Sd*y),ae=ce/fe,g=Jt(g-ae,-Math.PI/3,Math.PI/3),y=g*g,T=y*y*y,!(Math.abs(ae)<1e-12));++ye);const E=sm*s*(xd+3*bd*y+T*(7*wd+9*Sd*y))/Math.cos(g),D=Math.asin(Math.sin(g)/sm),W=Jt(180*E/Math.PI,-180,180),X=Jt(180*D/Math.PI,-85.051129,or);return new qt(W,X)}}class v1 extends vc{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,c){return{x:.5+s/360,y:.5-c/360,z:0}}unproject(s,c){const g=360*(s-.5),y=Jt(360*(.5-c),-85.051129,or);return new qt(g,y)}}const Nh=Math.PI/2;function om(u){return Math.tan((Nh+u)/2)}class x1 extends vc{constructor(s){super(s),this.center=s.center||[0,30];const[c,g]=this.parallels=s.parallels||[30,30];let y=Ai(c),T=Ai(g);this.southernCenter=y+T<0,this.southernCenter&&(y=-y,T=-T);const E=Math.cos(y),D=om(y);this.n=y===T?Math.sin(y):Math.log(E/Math.cos(T))/Math.log(om(T)/D),this.f=E*Math.pow(om(y),this.n)/this.n}project(s,c){c=Ai(c),this.southernCenter&&(c=-c),s=Ai(s-this.center[0]);const g=1e-6,{n:y,f:T}=this;T>0?c<-Nh+g&&(c=-Nh+g):c>Nh-g&&(c=Nh-g);const E=T/Math.pow(om(c),y);let D=E*Math.sin(y*s),W=T-E*Math.cos(y*s);return D=.5*(D/Math.PI+.5),W=.5*(W/Math.PI+.5),{x:D,y:this.southernCenter?W:1-W,z:0}}unproject(s,c){s=(2*s-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:g,f:y}=this,T=y-c,E=Math.sign(T),D=Math.sign(g)*Math.sqrt(s*s+T*T);let W=Math.atan2(s,Math.abs(T))*E;T*g<0&&(W-=Math.PI*Math.sign(s)*E);const X=Jt(ii(W/g)+this.center[0],-180,180),ae=Jt(ii(2*Math.atan(Math.pow(y/D,1/g))-Nh),-85.051129,or);return new qt(X,this.southernCenter?-ae:ae)}}class Qv extends vc{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,c){return{x:vi(s),y:di(c),z:0}}unproject(s,c){const g=Pi(s),y=ji(c);return new qt(g,y)}}const e0=Ai(or);class b1 extends vc{project(s,c){const g=(c=Ai(c))*c,y=g*g;return{x:.5*((s=Ai(s))*(.8707-.131979*g+y*(y*(.003971*g-.001529*y)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+g*(.015085+y*(.028874*g-.044475-.005916*y)))/Math.PI+1),z:0}}unproject(s,c){s=(2*s-.5)*Math.PI;let g=c=(2*(1-c)-1)*Math.PI,y=25,T=0,E=g*g;do{E=g*g;const X=E*E;T=(g*(1.007226+E*(.015085+X*(.028874*E-.044475-.005916*X)))-c)/(1.007226+E*(.045255+X*(.259866*E-.311325-.005916*11*X))),g=Jt(g-T,-e0,e0)}while(Math.abs(T)>1e-6&&--y>0);E=g*g;const D=Jt(ii(s/(.8707+E*(E*(E*E*E*(.003971-.001529*E)-.013791)-.131979))),-180,180),W=ii(g);return new qt(D,W)}}const t0=Ai(or);class w1 extends vc{project(s,c){c=Ai(c),s=Ai(s);const g=Math.cos(c),y=2/Math.PI,T=Math.acos(g*Math.cos(s/2)),E=Math.sin(T)/T,D=.5*(s*y+2*g*Math.sin(s/2)/E)||0,W=.5*(c+Math.sin(c)/E)||0;return{x:.5*(D/Math.PI+.5),y:1-.5*(W/Math.PI+1),z:0}}unproject(s,c){let g=s=(2*s-.5)*Math.PI,y=c=(2*(1-c)-1)*Math.PI,T=25;const E=1e-6;let D=0,W=0;do{const X=Math.cos(y),ae=Math.sin(y),ce=2*ae*X,fe=ae*ae,ye=X*X,_t=Math.cos(g/2),St=Math.sin(g/2),Pt=2*_t*St,zt=St*St,Kt=1-ye*_t*_t,Qt=Kt?1/Kt:0,Tt=Kt?Math.acos(X*_t)*Math.sqrt(1/Kt):0,Wt=.5*(2*Tt*X*St+2*g/Math.PI)-s,ti=.5*(Tt*ae+y)-c,ci=.5*Qt*(ye*zt+Tt*X*_t*fe)+1/Math.PI,ki=Qt*(Pt*ce/4-Tt*ae*St),Ci=.125*Qt*(ce*St-Tt*ae*ye*Pt),Di=.5*Qt*(fe*_t+Tt*zt*X)+.5,Vi=ki*Ci-Di*ci;D=(ti*ki-Wt*Di)/Vi,W=(Wt*Ci-ti*ci)/Vi,g=Jt(g-D,-Math.PI,Math.PI),y=Jt(y-W,-t0,t0)}while((Math.abs(D)>E||Math.abs(W)>E)&&--T>0);return new qt(ii(g),ii(y))}}class i0 extends vc{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ai(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,c){const{scale:g,cosPhi:y}=this;return{x:Ai(s)*y*g+.5,y:-Math.sin(Ai(c))/y*g+.5,z:0}}unproject(s,c){const{scale:g,cosPhi:y}=this,T=-(c-.5)/g,E=Jt(ii((s-.5)/g)/y,-180,180),D=Math.asin(Jt(T*y,-1,1)),W=Jt(ii(D),-85.051129,or);return new qt(E,W)}}class S1 extends Qv{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,c,g){const y=Jf(s,c,g);return oi(y,y,Bp(rl(g))),{x:y[0],y:y[1],z:y[2]}}locationPoint(s,c,g){const y=At(c.lat,c.lng),T=nr([],y),E=g?s._centerAltitude+g:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(c),s._centerAltitude):s._centerAltitude;mi(y,y,T,Ei(1,0)*Fr*E);const D=ie(new Float64Array(16));return ne(D,s.pixelMatrix,s.globeMatrix),oi(y,y,D),new rr(y[0],y[1])}pixelsPerMeter(s,c){return Ei(1,0)*c}pixelSpaceConversion(s,c,g){const y=Ei(1,s)*c,T=pn(Ei(1,45)*c,y,g);return this.pixelsPerMeter(s,c)/T}createTileMatrix(s,c,g){const y=gg(rl(g.canonical));return ne(new Float64Array(16),s.globeMatrix,y)}createInversionMatrix(s,c){const{center:g}=s,y=Bp(rl(c));return me(y,y,Ai(g.lng)),he(y,y,Ai(g.lat)),le(y,y,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(y)}pointCoordinate(s,c,g,y){return O_(s,c,g,!0)||new zi(0,0)}pointCoordinate3D(s,c,g){const y=this.pointCoordinate(s,c,g,0);return[y.x,y.y,y.z]}isPointAboveHorizon(s,c){return!O_(s,c.x,c.y,!1)}farthestPixelDistance(s){const c=function(y,T){const E=y.cameraToCenterDistance,D=y._centerAltitude*T,W=y._camera,X=y._camera.forward(),ae=ei([],jt([],X,-E),[0,0,D]),ce=y.worldSize/(2*Math.PI),fe=[0,0,-ce],ye=y.width/y.height,_t=Math.tan(y.fovAboveCenter),St=jt([],W.up(),_t),Pt=jt([],W.right(),_t*ye),zt=nr([],ei([],ei([],X,St),Pt)),Kt=[];let Qt;if(new Ps(ae,zt).closestPointOnSphere(fe,ce,Kt)){const Tt=ei([],Kt,fe),Wt=kt([],Tt,ae);Qt=Math.cos(y.fovAboveCenter)*Yt(Wt)}else{const Tt=kt([],ae,fe),Wt=kt([],fe,ae);nr(Wt,Wt);const ti=Yt(Tt)-ce;Qt=Math.sqrt(ti*(ti+2*ce));const ci=Math.acos(Qt/(ce+ti))-Math.acos(si(X,Wt));Qt*=Math.cos(ci)}return 1.01*Qt}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),g=mc(s.zoom);if(g>0){const y=Kv(s,Ei(1,s.center.lat)*s.worldSize),T=s.worldSize/(2*Math.PI),E=Math.max(s.width,s.height)/s.worldSize*Math.PI;return pn(c,y+T*(1-Math.cos(E)),Math.pow(g,10))}return c}upVector(s,c,g){return Jf(c,g,s,1)}upVectorScale(s){return{metersToTile:Fp(zp(rl(s)))}}}function r0(u){const s=u.parallels,c=!!s&&Math.abs(s[0]+s[1])<.01;switch(u.name){case"mercator":return new Qv(u);case"equirectangular":return new v1(u);case"naturalEarth":return new b1(u);case"equalEarth":return new y1(u);case"winkelTripel":return new w1(u);case"albers":return c?new i0(u):new _1(u);case"lambertConformalConic":return c?new i0(u):new x1(u);case"globe":return new S1(u)}throw new Error(`Invalid projection name: ${u.name}`)}const T1=Cn.VectorTileFeature.types,E1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function am(u,s,c,g,y,T,E,D,W,X,ae,ce,fe){const ye=D?Math.min(yc,Math.round(D[0])):0,_t=D?Math.min(yc,Math.round(D[1])):0;u.emplaceBack(s,c,Math.round(32*g),Math.round(32*y),T,E,(ye<<1)+(W?1:0),_t,16*X,16*ae,256*ce,256*fe)}function lm(u,s,c){u.emplaceBack(s,c)}function cm(u,s,c,g,y,T,E){u.emplaceBack(s,c,g,y,T,E)}const um=(u,s,c,g)=>{for(let y=0;y<s;y++)u.emplaceBack(c[0],c[1],c[2],g[0],g[1],g[2])};function hm(u,s,c,g,y){u.emplaceBack(s,c,g,y),u.emplaceBack(s,c,g,y),u.emplaceBack(s,c,g,y),u.emplaceBack(s,c,g,y)}function M1(u){for(const s of u.sections)if(sg(s.text))return!0;return!1}class e_{constructor(s){this.layoutVertexArray=new oc,this.indexArray=new go,this.programConfigurations=s,this.segments=new Hs,this.dynamicLayoutVertexArray=new mo,this.opacityVertexArray=new lc,this.placedSymbolArray=new bp,this.iconTransitioningVertexArray=new Ja,this.globeExtVertexArray=new ac,this.zOffsetVertexArray=new Ya,this.orientationVertexArray=new $f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(s,c,g,y,T){this.isEmpty()||(g&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Bb.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Vb.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,E1,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,Gb.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,Nb.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||T)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,$b.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=s.createVertexBuffer(this.orientationVertexArray,Ub.members,!0)),this.opacityVertexBuffer.itemSize=1),(g||y)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}jr(e_,"SymbolBuffers");class t_{constructor(s,c,g){this.layoutVertexArray=new s,this.layoutAttributes=c,this.indexArray=new g,this.segments=new Hs,this.collisionVertexArray=new ou,this.collisionVertexArrayExt=new mo}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Hb.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,jb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jr(t_,"CollisionBuffers");class fm{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.lut=s.lut,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(E=>E.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ie([]),this.placementViewportMatrix=ie([]);const c=this.layers[0]._unevaluatedLayout._values;this.worldview=s.worldview,this.textSizeData=Lv(this.zoom,c["text-size"],this.worldview),this.iconSizeData=Lv(this.zoom,c["icon-size"],this.worldview);const g=this.layers[0].layout,y=g.get("symbol-sort-key"),T=g.get("symbol-z-order");this.canOverlap=g.get("text-allow-overlap")||g.get("icon-allow-overlap")||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&y.constantOr(1)!==void 0,this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=g.get("text-writing-mode").map(E=>qo[E]),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new e_(new b(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new e_(new b(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new jf,this.lineVertexArray=new Tp,this.symbolInstances=new Sp}calculateGlyphDependencies(s,c,g,y,T){for(const E of s){const D=E.codePointAt(0);if(D===void 0)break;if(c[D]=!0,y&&T&&D<=65535){const W=pd[E];W&&(c[W.charCodeAt(0)]=!0)}}}updateFootprints(s,c){}updateReplacement(s,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!Pg(this.activeReplacements,g)&&(this.activeReplacements=g,!0)}populate(s,c,g,y){const T=this.layers[0],E=T.layout,D=this.projection.name==="globe",W=E.get("text-font"),X=E.get("text-field"),ae=E.get("icon-image"),[ce,fe]=E.get("icon-size-scale-range"),ye=Jt(c.scaleFactor||1,ce,fe),_t=(X.value.kind!=="constant"||X.value.value instanceof Ao&&!X.value.value.isEmpty()||X.value.value.toString().length>0)&&(W.value.kind!=="constant"||W.value.value.length>0),St=ae.value.kind!=="constant"||!!ae.value.value||Object.keys(ae.parameters).length>0,Pt=E.get("symbol-sort-key");if(this.features=[],!_t&&!St)return;const zt=c.iconDependencies,Kt=c.glyphDependencies,Qt=c.availableImages,Tt=new ps(this.zoom,{worldview:this.worldview});for(const{feature:Wt,id:ti,index:ci,sourceLayerIndex:ki}of s){const Ci=T._featureFilter.needGeometry,Di=Ur(Wt,Ci);if(!T._featureFilter.filter(Tt,Di,g))continue;if(Ci||(Di.geometry=qr(Wt,g,y)),D&&Wt.type!==1&&g.z<=5){const xr=Di.geometry,Sr=.98078528056,tr=(yr,Yi)=>si(Jf(yr.x,yr.y,g,1),Jf(Yi.x,Yi.y,g,1))<Sr;for(let yr=0;yr<xr.length;yr++)xr[yr]=kr(xr[yr],tr)}let Vi,Qi;if(_t){const xr=T.getValueAndResolveTokens("text-field",Di,g,Qt),Sr=Ao.factory(xr);M1(Sr)&&(this.hasRTLText=!0),(!this.hasRTLText||tc()==="unavailable"||this.hasRTLText&&Pa.isParsed())&&(Vi=qb(Sr,T,Di))}if(St){const xr=T.getValueAndResolveTokens("icon-image",Di,g,Qt);Qi=typeof xr=="string"?ko.build(xr):xr}if(!Vi&&!Qi)continue;const br=this.sortFeaturesByKey?Pt.evaluate(Di,{},g):void 0,hr={id:ti,text:Vi,icon:Qi,index:ci,sourceLayerIndex:ki,geometry:Di.geometry,properties:Wt.properties,type:T1[Wt.type],sortKey:br};if(this.features.push(hr),Qi){const xr=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Sr,iconSecondary:tr}=qv(Qi,this.iconSizeData,xr["icon-size"],g,this.zoom,hr,this.pixelRatio,ye,this.worldview),yr=Sr.id.toString();if(zt.has(yr)?zt.get(yr).push(Sr):zt.set(yr,[Sr]),tr){const Yi=tr.id.toString();zt.has(Yi)?zt.get(Yi).push(tr):zt.set(Yi,[tr])}}if(Vi){const xr=W.evaluate(Di,{},g).join(","),Sr=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(qo.vertical)>=0;for(const tr of Vi.sections)if(tr.image){const yr=tr.image.getPrimary().scaleSelf(this.pixelRatio),Yi=yr.id.toString(),er=zt.get(Yi)||[];er.push(yr),zt.set(Yi,er)}else{const yr=eu(Vi.toString()),Yi=tr.fontStack||xr,er=Kt[Yi]=Kt[Yi]||{};this.calculateGlyphDependencies(tr.text,er,Sr,this.allowVerticalPlacement,yr)}}}if(E.get("symbol-placement")==="line"&&(this.features=function(Wt){const ti={},ci={},ki=[];let Ci=0;function Di(hr){ki.push(Wt[hr]),Ci++}function Vi(hr,xr,Sr){const tr=ci[hr];return delete ci[hr],ci[xr]=tr,ki[tr].geometry[0].pop(),ki[tr].geometry[0]=ki[tr].geometry[0].concat(Sr[0]),tr}function Qi(hr,xr,Sr){const tr=ti[xr];return delete ti[xr],ti[hr]=tr,ki[tr].geometry[0].shift(),ki[tr].geometry[0]=Sr[0].concat(ki[tr].geometry[0]),tr}function br(hr,xr,Sr){const tr=Sr?xr[0][xr[0].length-1]:xr[0][0];return`${hr}:${tr.x}:${tr.y}`}for(let hr=0;hr<Wt.length;hr++){const xr=Wt[hr],Sr=xr.geometry,tr=xr.text?xr.text.toString():null;if(!tr){Di(hr);continue}const yr=br(tr,Sr),Yi=br(tr,Sr,!0);if(yr in ci&&Yi in ti&&ci[yr]!==ti[Yi]){const er=Qi(yr,Yi,Sr),Cr=Vi(yr,Yi,ki[er].geometry);delete ti[yr],delete ci[Yi],ci[br(tr,ki[Cr].geometry,!0)]=Cr,ki[er].geometry=null}else yr in ci?Vi(yr,Yi,Sr):Yi in ti?Qi(yr,Yi,Sr):(Di(hr),ti[yr]=Ci-1,ci[Yi]=Ci-1)}return ki.filter(hr=>hr.geometry)}(this.features)),E.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Wt of c.elevationFeatures)this.elevationFeatureIdToIndex.set(Wt.id,this.elevationFeatures.length),this.elevationFeatures.push(Wt)}}else E.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Wt,ti)=>Wt.sortKey-ti.sortKey)}update(s,c,g,y,T,E,D){this.text.programConfigurations.updatePaintArrays(s,c,T,g,y,E,D,this.worldview),this.icon.programConfigurations.updatePaintArrays(s,c,T,g,y,E,D,this.worldview)}updateRoadElevation(s){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let c=!1;const g=Ji(s),y=1/g;let T=!1,E=!1;for(let D=0;D<this.symbolInstances.length;D++){const W=this.symbolInstances.get(D),X=ri(1,0,0),ae=ri(0,1,0),{numHorizontalGlyphVertices:ce,numVerticalGlyphVertices:fe,numIconVertices:ye,numVerticalIconVertices:_t}=W,St=ce>0||fe>0,Pt=ye>0,zt=this.elevationFeatures[W.elevationFeatureIndex];if(zt){const Kt=new rr(W.tileAnchorX,W.tileAnchorY),Qt=.075+zt.pointElevation(Kt);W.zOffset!==Qt&&(c=!0,W.zOffset=Qt);const Tt=zt.computeSlopeNormal(Kt,y),Wt=mr(Ni(),ri(0,0,1),Tt);Li(X,X,Wt),Li(ae,ae,Wt),X[2]*=g,ae[2]*=g,X[0]===1&&X[1]===0&&X[2]===0&&ae[0]===0&&ae[1]===1&&ae[2]===0||(T=T||St,E=E||Pt)}if(St&&(um(this.text.orientationVertexArray,ce,X,ae),um(this.text.orientationVertexArray,fe,X,ae)),Pt){const{placedIconSymbolIndex:Kt,verticalPlacedIconSymbolIndex:Qt}=W;Kt>=0&&um(this.icon.orientationVertexArray,ye,X,ae),Qt>=0&&um(this.icon.orientationVertexArray,_t,X,ae)}}T||(this.text.orientationVertexArray=void 0),E||(this.icon.orientationVertexArray=void 0),c&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(T,E,D)=>{g+=E,g>T.length&&T.resize(g);for(let W=-E;W<0;W++)T.emplace(W+g,D)},c=(T,E,D)=>{y+=E,y>T.length&&T.resize(y);for(let W=-E;W<0;W++)T.emplace(W+y,D)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let g=0,y=0;for(let T=0;T<this.symbolInstances.length;T++){const E=this.symbolInstances.get(T),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:W,numIconVertices:X}=E,ae=E.zOffset,ce=X>0;if((D>0||W>0)&&(s(this.text.zOffsetVertexArray,D,ae),s(this.text.zOffsetVertexArray,W,ae)),ce){const{placedIconSymbolIndex:fe,verticalPlacedIconSymbolIndex:ye}=E;fe>=0&&c(this.icon.zOffsetVertexArray,X,ae),ye>=0&&c(this.icon.zOffsetVertexArray,E.numVerticalIconVertices,ae)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=r0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,c){const g=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:y,y:T}of c)this.lineVertexArray.emplaceBack(y,T);return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St,Pt){const zt=s.indexArray,Kt=s.layoutVertexArray,Qt=s.globeExtVertexArray,Tt=s.segments.prepareSegment(4*c.length,Kt,zt,this.canOverlap?E.sortKey:void 0),Wt=this.glyphOffsetArray.length,ti=Tt.vertexLength,ci=this.allowVerticalPlacement&&D===qo.vertical?Math.PI/2:0,ki=E.text&&E.text.sections;for(let Di=0;Di<c.length;Di++){const{tl:Vi,tr:Qi,bl:br,br:hr,texPrimary:xr,texSecondary:Sr,pixelOffsetTL:tr,pixelOffsetBR:yr,minFontScaleX:Yi,minFontScaleY:er,glyphOffset:Cr,isSDF:Lr,sectionIndex:an}=c[Di],Yr=Tt.vertexLength,zr=Cr[1];if(am(Kt,X.x,X.y,Vi.x,zr+Vi.y,xr.x,xr.y,g,Lr,tr.x,tr.y,Yi,er),am(Kt,X.x,X.y,Qi.x,zr+Qi.y,xr.x+xr.w,xr.y,g,Lr,yr.x,tr.y,Yi,er),am(Kt,X.x,X.y,br.x,zr+br.y,xr.x,xr.y+xr.h,g,Lr,tr.x,yr.y,Yi,er),am(Kt,X.x,X.y,hr.x,zr+hr.y,xr.x+xr.w,xr.y+xr.h,g,Lr,yr.x,yr.y,Yi,er),W){const{x:Ar,y:vn,z:Zr}=W.anchor,[Kr,mn,Tn]=W.up;cm(Qt,Ar,vn,Zr,Kr,mn,Tn),cm(Qt,Ar,vn,Zr,Kr,mn,Tn),cm(Qt,Ar,vn,Zr,Kr,mn,Tn),cm(Qt,Ar,vn,Zr,Kr,mn,Tn),hm(s.dynamicLayoutVertexArray,Ar,vn,Zr,ci)}else hm(s.dynamicLayoutVertexArray,X.x,X.y,X.z,ci);if(Pt){const Ar=Sr||xr;lm(s.iconTransitioningVertexArray,Ar.x,Ar.y),lm(s.iconTransitioningVertexArray,Ar.x+Ar.w,Ar.y),lm(s.iconTransitioningVertexArray,Ar.x,Ar.y+Ar.h),lm(s.iconTransitioningVertexArray,Ar.x+Ar.w,Ar.y+Ar.h)}zt.emplaceBack(Yr,Yr+1,Yr+2),zt.emplaceBack(Yr+1,Yr+2,Yr+3),Tt.vertexLength+=4,Tt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Cr[0]),Di!==c.length-1&&an===c[Di+1].sectionIndex||s.programConfigurations.populatePaintArrays(Kt.length,E,E.index,{},ye,_t,St,ki&&ki[an],this.worldview)}const Ci=W?W.anchor:X;s.placedSymbolArray.emplaceBack(Ci.x,Ci.y,Ci.z,X.x,X.y,Wt,this.glyphOffsetArray.length-Wt,ti,ae,ce,X.segment,g?g[0]:0,g?g[1]:0,y[0],y[1],D,0,0,0,fe,0)}_commitLayoutVertex(s,c,g,y,T,E,D){s.emplaceBack(c,g,y,T,E,Math.round(D.x),Math.round(D.y))}_addCollisionDebugVertices(s,c,g,y,T,E,D){const W=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),X=W.vertexLength,ae=D.tileAnchorX,ce=D.tileAnchorY;for(let ye=0;ye<4;ye++)g.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(g.collisionVertexArrayExt,c,s.padding,D.zOffset),this._commitLayoutVertex(g.layoutVertexArray,y,T,E,ae,ce,new rr(s.x1,s.y1)),this._commitLayoutVertex(g.layoutVertexArray,y,T,E,ae,ce,new rr(s.x2,s.y1)),this._commitLayoutVertex(g.layoutVertexArray,y,T,E,ae,ce,new rr(s.x2,s.y2)),this._commitLayoutVertex(g.layoutVertexArray,y,T,E,ae,ce,new rr(s.x1,s.y2)),W.vertexLength+=4;const fe=g.indexArray;fe.emplaceBack(X,X+1),fe.emplaceBack(X+1,X+2),fe.emplaceBack(X+2,X+3),fe.emplaceBack(X+3,X),W.primitiveLength+=4}_addTextDebugCollisionBoxes(s,c,g,y,T,E){for(let D=y;D<T;D++){const W=g.get(D),X=this.getSymbolInstanceTextSize(s,E,c,D);this._addCollisionDebugVertices(W,X,this.textCollisionBox,W.projectedAnchorX,W.projectedAnchorY,W.projectedAnchorZ,E)}}_addIconDebugCollisionBoxes(s,c,g,y,T,E){for(let D=y;D<T;D++){const W=g.get(D),X=this.getSymbolInstanceIconSize(s,c,E.placedIconSymbolIndex);this._addCollisionDebugVertices(W,X,this.iconCollisionBox,W.projectedAnchorX,W.projectedAnchorY,W.projectedAnchorZ,E)}}generateCollisionDebugBuffers(s,c,g){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new t_(yh,yv.members,Ja),this.iconCollisionBox=new t_(yh,yv.members,Ja);const y=gd(this.iconSizeData,s),T=gd(this.textSizeData,s,g);for(let E=0;E<this.symbolInstances.length;E++){const D=this.symbolInstances.get(E);this._addTextDebugCollisionBoxes(T,s,c,D.textBoxStartIndex,D.textBoxEndIndex,D),this._addTextDebugCollisionBoxes(T,s,c,D.verticalTextBoxStartIndex,D.verticalTextBoxEndIndex,D),this._addIconDebugCollisionBoxes(y,s,c,D.iconBoxStartIndex,D.iconBoxEndIndex,D),this._addIconDebugCollisionBoxes(y,s,c,D.verticalIconBoxStartIndex,D.verticalIconBoxEndIndex,D)}}getSymbolInstanceTextSize(s,c,g,y){const T=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:y),E=qg(this.textSizeData,s,T)/fo;return this.tilePixelRatio*E}getSymbolInstanceIconSize(s,c,g){const y=this.icon.placedSymbolArray.get(g),T=qg(this.iconSizeData,s,y);return this.tilePixelRatio*T}_commitDebugCollisionVertexUpdate(s,c,g,y){s.emplaceBack(c,-g,-g,y),s.emplaceBack(c,g,-g,y),s.emplaceBack(c,g,g,y),s.emplaceBack(c,-g,g,y)}_updateTextDebugCollisionBoxes(s,c,g,y,T,E,D){for(let W=y;W<T;W++){const X=g.get(W),ae=this.getSymbolInstanceTextSize(s,E,c,W);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,ae,X.padding,E.zOffset)}}_updateIconDebugCollisionBoxes(s,c,g,y,T,E,D){for(let W=y;W<T;W++){const X=g.get(W),ae=this.getSymbolInstanceIconSize(s,c,E.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,ae,X.padding,E.zOffset)}}updateCollisionDebugBuffers(s,c,g,y){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const T=gd(this.iconSizeData,s,y),E=gd(this.textSizeData,s,g);for(let D=0;D<this.symbolInstances.length;D++){const W=this.symbolInstances.get(D);this._updateTextDebugCollisionBoxes(E,s,c,W.textBoxStartIndex,W.textBoxEndIndex,W,g),this._updateTextDebugCollisionBoxes(E,s,c,W.verticalTextBoxStartIndex,W.verticalTextBoxEndIndex,W,g),this._updateIconDebugCollisionBoxes(T,s,c,W.iconBoxStartIndex,W.iconBoxEndIndex,W,y),this._updateIconDebugCollisionBoxes(T,s,c,W.verticalIconBoxStartIndex,W.verticalIconBoxEndIndex,W,y)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,c,g,y,T,E,D,W,X){const ae={};if(c<g){const{x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt,featureIndex:Wt}=s.get(c);ae.textBox={x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt},ae.textFeatureIndex=Wt}if(y<T){const{x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt,featureIndex:Wt}=s.get(y);ae.verticalTextBox={x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt},ae.verticalTextFeatureIndex=Wt}if(E<D){const{x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt,featureIndex:Wt}=s.get(E);ae.iconBox={x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt},ae.iconFeatureIndex=Wt}if(W<X){const{x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt,featureIndex:Wt}=s.get(W);ae.verticalIconBox={x1:ce,y1:fe,x2:ye,y2:_t,padding:St,projectedAnchorX:Pt,projectedAnchorY:zt,projectedAnchorZ:Kt,tileAnchorX:Qt,tileAnchorY:Tt},ae.verticalIconFeatureIndex=Wt}return ae}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const g=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,c){const g=s.placedSymbolArray.get(c),y=g.vertexStartIndex+4*g.numGlyphs;for(let T=g.vertexStartIndex;T<y;T+=4)s.indexArray.emplaceBack(T,T+1,T+2),s.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(s),g=Math.cos(s),y=[],T=[],E=[];for(let D=0;D<this.symbolInstances.length;++D){E.push(D);const W=this.symbolInstances.get(D);y.push(0|Math.round(c*W.tileAnchorX+g*W.tileAnchorY)),T.push(W.featureIndex)}return E.sort((D,W)=>y[D]-y[W]||T[W]-T[D]),E}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,c){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===c?g.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const g=this.symbolInstances.get(c);this.featureSortOrder.push(g.featureIndex);const{rightJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:T,leftJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:D,placedIconSymbolIndex:W,verticalPlacedIconSymbolIndex:X}=g;y>=0&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&T!==y&&this.addIndicesForPlacedSymbol(this.text,T),E>=0&&E!==T&&E!==y&&this.addIndicesForPlacedSymbol(this.text,E),D>=0&&this.addIndicesForPlacedSymbol(this.text,D),W>=0&&this.addIndicesForPlacedSymbol(this.icon,W),X>=0&&this.addIndicesForPlacedSymbol(this.icon,X)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n0,s0,i_;jr(fm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fm.addDynamicAttributes=hm;class o0{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:zl,this.defaultValue=s}evaluate(s){if(s.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(s.formattedSection))return c.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jr(o0,"FormatSectionOverride",{omit:["defaultValue"]});const r_=()=>i_||(i_={layout:n0||(n0=new Us({"symbol-placement":new Mr(Gi.layout_symbol["symbol-placement"]),"symbol-spacing":new Mr(Gi.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mr(Gi.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $r(Gi.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mr(Gi.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mr(Gi.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mr(Gi.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mr(Gi.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mr(Gi.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mr(Gi.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mr(Gi.layout_symbol["icon-rotation-alignment"]),"icon-size":new $r(Gi.layout_symbol["icon-size"]),"icon-size-scale-range":new Mr(Gi.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new $r(Gi.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $r(Gi.layout_symbol["icon-text-fit-padding"]),"icon-image":new $r(Gi.layout_symbol["icon-image"]),"icon-rotate":new $r(Gi.layout_symbol["icon-rotate"]),"icon-padding":new Mr(Gi.layout_symbol["icon-padding"]),"icon-keep-upright":new Mr(Gi.layout_symbol["icon-keep-upright"]),"icon-offset":new $r(Gi.layout_symbol["icon-offset"]),"icon-anchor":new $r(Gi.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mr(Gi.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mr(Gi.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mr(Gi.layout_symbol["text-rotation-alignment"]),"text-field":new $r(Gi.layout_symbol["text-field"]),"text-font":new $r(Gi.layout_symbol["text-font"]),"text-size":new $r(Gi.layout_symbol["text-size"]),"text-size-scale-range":new Mr(Gi.layout_symbol["text-size-scale-range"]),"text-max-width":new $r(Gi.layout_symbol["text-max-width"]),"text-line-height":new $r(Gi.layout_symbol["text-line-height"]),"text-letter-spacing":new $r(Gi.layout_symbol["text-letter-spacing"]),"text-justify":new $r(Gi.layout_symbol["text-justify"]),"text-radial-offset":new $r(Gi.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mr(Gi.layout_symbol["text-variable-anchor"]),"text-anchor":new $r(Gi.layout_symbol["text-anchor"]),"text-max-angle":new Mr(Gi.layout_symbol["text-max-angle"]),"text-writing-mode":new Mr(Gi.layout_symbol["text-writing-mode"]),"text-rotate":new $r(Gi.layout_symbol["text-rotate"]),"text-padding":new Mr(Gi.layout_symbol["text-padding"]),"text-keep-upright":new Mr(Gi.layout_symbol["text-keep-upright"]),"text-transform":new $r(Gi.layout_symbol["text-transform"]),"text-offset":new $r(Gi.layout_symbol["text-offset"]),"text-allow-overlap":new Mr(Gi.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mr(Gi.layout_symbol["text-ignore-placement"]),"text-optional":new Mr(Gi.layout_symbol["text-optional"]),visibility:new Mr(Gi.layout_symbol.visibility)})),paint:s0||(s0=new Us({"icon-opacity":new $r(Gi.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new $r(Gi.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new $r(Gi.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $r(Gi.paint_symbol["text-emissive-strength"]),"icon-color":new $r(Gi.paint_symbol["icon-color"]),"icon-halo-color":new $r(Gi.paint_symbol["icon-halo-color"]),"icon-halo-width":new $r(Gi.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $r(Gi.paint_symbol["icon-halo-blur"]),"icon-translate":new Mr(Gi.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mr(Gi.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mr(Gi.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $r(Gi.paint_symbol["text-opacity"]),"text-occlusion-opacity":new $r(Gi.paint_symbol["text-occlusion-opacity"]),"text-color":new $r(Gi.paint_symbol["text-color"],{runtimeType:zo,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new $r(Gi.paint_symbol["text-halo-color"]),"text-halo-width":new $r(Gi.paint_symbol["text-halo-width"]),"text-halo-blur":new $r(Gi.paint_symbol["text-halo-blur"]),"text-translate":new Mr(Gi.paint_symbol["text-translate"]),"text-translate-anchor":new Mr(Gi.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mr(Gi.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mr(Gi.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mr(Gi.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mr(Gi.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new $r(Gi.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},i_);class dm extends To{constructor(s,c,g,y){super(s,r_(),c,g,y),this._colorAdjustmentMatrix=ie([]),this.hasInitialOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}recalculate(s,c){super.recalculate(s,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const g=this.layout.get("text-writing-mode");if(g){const y=[];for(const T of g)y.indexOf(T)<0&&y.push(T);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,c,g,y){return this._saturation===s&&this._contrast===c&&this._brightnessMin===g&&this._brightnessMax===y||(this._colorAdjustmentMatrix=function(T,E,D,W){T=Qs(T),E=uo(E);const X=Y(),ae=T/3,ce=1-2*ae,fe=[ce,ae,ae,0,ae,ce,ae,0,ae,ae,ce,0,0,0,0,1],ye=.5-.5*E,_t=W-D;return ne(X,[_t,0,0,0,0,_t,0,0,0,0,_t,0,D,D,D,1],[E,0,0,0,0,E,0,0,0,0,E,0,ye,ye,ye,1]),ne(X,X,fe),X}(s,c,g,y),this._saturation=s,this._contrast=c,this._brightnessMin=g,this._brightnessMax=y),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,c,g,y){const T=this.layout.get(s).evaluate(c,{},g,y),E=this._unevaluatedLayout._values[s];return E.isDataDriven()||lh(E.value)||!T?T:function(D,W){return W.replace(/{([^{}]+)}/g,(X,ae)=>ae in D?String(D[ae]):"")}(c.properties,T)}createBucket(s){return new fm(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of r_().paint.overridableProperties){if(!dm.hasPaintOverride(this.layout,s))continue;const c=this.paint.get(s),g=new o0(c),y=new Jl(g,c.property.specification,this.scope,this.options);let T=null;T=c.value.kind==="constant"||c.value.kind==="source"?new Jc("source",y):new Qc("composite",y,c.value.zoomStops,c.value.interpolationType),this.paint._values[s]=new ic(c.property,T,c.parameters)}}_handleOverridablePaintPropertyUpdate(s,c,g){return!(!this.layout||c.isDataDriven()||g.isDataDriven())&&dm.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,c){const g=s.get("text-field"),y=r_().paint.properties[c];let T=!1;const E=D=>{for(const W of D)if(y.overrides&&y.overrides.hasOverride(W))return void(T=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Ao)E(g.value.value.sections);else if(g.value.kind==="source"){const D=X=>{T||(X instanceof _n&&Hr(X.value)===Fc?E(X.value.sections):X instanceof Nl?E(X.sections):X.eachChild(D))},W=g.value;W._styleExpression&&D(W._styleExpression.expression)}return T}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,c,g){return{config:new fc(this,{zoom:c,lut:g}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let a0,l0,c0,u0;var n_=Zn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function s_(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function o_(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class a_{constructor(s,c,g,y){this.context=s,this.format=g,this.useMipmap=y&&y.useMipmap,this.texture=s.gl.createTexture(),this.update(c,{premultiply:y&&y.premultiply})}update(s,c){const g=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,y=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:T}=this,{gl:E}=T,{x:D,y:W}=c&&c.position?c.position:{x:0,y:0},X=D+g,ae=W+y;!this.size||this.size[0]===X&&this.size[1]===ae||(E.bindTexture(E.TEXTURE_2D,null),E.deleteTexture(this.texture),this.texture=E.createTexture(),this.size=null),E.bindTexture(E.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA8&&(!c||c.premultiply!==!1));const ce=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&X>0&&ae>0){const fe=this.useMipmap?Math.floor(Math.log2(Math.max(X,ae)))+1:1;E.texStorage2D(E.TEXTURE_2D,fe,this.format,X,ae),this.size=[X,ae]}if(this.size)if(ce)E.texSubImage2D(E.TEXTURE_2D,0,D,W,s_(this.format),o_(this.format),s);else{const fe=s.data;fe&&E.texSubImage2D(E.TEXTURE_2D,0,D,W,g,y,s_(this.format),o_(this.format),fe)}this.useMipmap&&E.generateMipmap(E.TEXTURE_2D)}bind(s,c,g=!1){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),s!==this.minFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,s),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap&&!g?s===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),c!==this.wrapS&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,c),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(s,c,g,y,T){const{context:E}=this,{gl:D}=E;D.bindTexture(D.TEXTURE_2D,this.texture),c!==this.magFilter&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,c),this.magFilter=c),s!==this.minFilter&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,this.useMipmap?s===D.NEAREST?D.NEAREST_MIPMAP_NEAREST:D.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),g!==this.wrapS&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,g),this.wrapS=g),y!==this.wrapT&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,y),this.wrapT=y),T!==this.compareMode&&(T?(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_COMPARE_MODE,D.COMPARE_REF_TO_TEXTURE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_COMPARE_FUNC,T)):D.texParameteri(D.TEXTURE_2D,D.TEXTURE_COMPARE_MODE,D.NONE),this.compareMode=T)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class pm{constructor(s,c){this.context=s,this.texture=c}bind(s,c){const{context:g}=this,{gl:y}=g;y.bindTexture(y.TEXTURE_2D,this.texture),s!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,s),this.minFilter=s),c!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,c),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,c),this.wrapS=c)}}function mm(u,s,c,g,y,T,E,D){const W=[u,s,1,c,g,1,y,T,1],X=[E,D,1],ae=$([],W),[ce,fe,ye]=Si(X,X,ae);return k(W,W,[ce,0,0,0,fe,0,0,0,ye])}function h0(u,s,c,g,y,T,E,D){const W=function(X,ae,ce,fe,ye,_t,St,Pt){const zt=mm(0,0,1,0,1,1,0,1),Kt=mm(X,ae,ce,fe,ye,_t,St,Pt);return k(Kt,Kt,$([],zt))}(u,s,c,g,y,T,E,D);return[W[2]/W[8]/Fr,W[5]/W[8]/Fr]}function gm(u){return[u[0],Math.min(Math.max(u[1],-85.051129),or)]}class f0 extends dl{constructor(s,c,g,y){super(),this.id=s,this.dispatcher=g,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(y),this.options=c,this._dirty=!1}load(s,c){if(this._loaded=c||!1,this.fire(new fl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=Xh(this.map._requestManager.transformRequest(this.url,Ic.Image),(g,y)=>{this._imageRequest=null,this._loaded=!0,g?this.fire(new Fu(g)):y&&(this.image=y instanceof HTMLImageElement?ia.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pm(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new fl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=s[0][1],g=s[0][1];for(const T of s)T[1]>g&&(g=T[1]),T[1]<c&&(c=T[1]);const y=(g+c)/2;if(y>or?this.onNorthPole=!0:y<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const T=s.map(zi.fromLngLat);this.tileID=function(E){let D=1/0,W=1/0,X=-1/0,ae=-1/0;for(const St of E)D=Math.min(D,St.x),W=Math.min(W,St.y),X=Math.max(X,St.x),ae=Math.max(ae,St.y);const ce=Math.max(X-D,ae-W),fe=Math.max(0,Math.floor(-Math.log(ce)/Math.LN2)),ye=Math.pow(2,fe);let _t=Math.floor((D+X)/2*ye);return _t>1&&(_t-=1),new yu(fe,_t,Math.floor((W+ae)/2*ye))}(T),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new fl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const zt in this.tiles){const Kt=this.tiles[zt];Kt.state!=="loaded"&&(Kt.state="loaded",Kt.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=vd(new yu(0,0,0),this.map.transform.projection),g=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(zt){const Kt=zt[1].x-zt[0].x,Qt=zt[1].y-zt[0].y,Tt=zt[2].x-zt[1].x,Wt=zt[2].y-zt[1].y,ti=zt[3].x-zt[2].x,ci=zt[3].y-zt[2].y,ki=zt[0].x-zt[3].x,Ci=zt[0].y-zt[3].y,Di=Kt*Wt-Tt*Qt,Vi=Tt*ci-ti*Wt,Qi=ti*Ci-ki*ci,br=ki*Qt-Kt*Ci;return Di>0&&Vi>0&&Qi>0&&br>0||Di<0&&Vi<0&&Qi<0&&br<0}(g))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const y=vd(this.tileID,this.map.transform.projection),[T,E,D,W]=this.coordinates.map(zt=>{const Kt=y.projection.project(zt[0],zt[1]);return Jv(y,Kt)._round()});this.perspectiveTransform=h0(T.x,T.y,E.x,E.y,D.x,D.y,W.x,W.y);const X=this._boundsArray=new nc;X.emplaceBack(T.x,T.y,0,0),X.emplaceBack(E.x,E.y,Fr,0),X.emplaceBack(W.x,W.y,0,Fr),X.emplaceBack(D.x,D.y,Fr,Fr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(X,n_.members),this.boundsSegments=Hs.simpleSegment(0,0,4,2);const ae=[],ce=[gm((fe=this.coordinates)[0]),gm(fe[1]),gm(fe[2]),gm(fe[3])];var fe;const[ye,_t,St,Pt]=function(zt){let Kt=zt[0][0],Qt=Kt,Tt=zt[0][1],Wt=Tt;for(let ti=1;ti<zt.length;ti++)zt[ti][0]<Kt?Kt=zt[ti][0]:zt[ti][0]>Qt&&(Qt=zt[ti][0]),zt[ti][1]<Tt?Tt=zt[ti][1]:zt[ti][1]>Wt&&(Wt=zt[ti][1]);return[Kt,Tt,Qt-Kt,Wt-Tt]}(ce);{const zt=new nc,[Kt,Qt,Tt,Wt]=function(tr){let yr=tr[0].x,Yi=yr,er=tr[0].y,Cr=er;for(let Lr=1;Lr<tr.length;Lr++)tr[Lr].x<yr?yr=tr[Lr].x:tr[Lr].x>Yi&&(Yi=tr[Lr].x),tr[Lr].y<er?er=tr[Lr].y:tr[Lr].y>Cr&&(Cr=tr[Lr].y);return[yr,er,Yi-yr,Cr-er]}(g),ti=tr=>[(tr.x-Kt)/Tt,(tr.y-Qt)/Wt],[ci,ki,Ci,Di]=g.map(ti),Vi=function(tr,yr,Yi,er,Cr,Lr,an,Yr){const zr=mm(0,0,1,0,1,1,0,1);return k(zr,zr,$([],mm(tr,yr,Yi,er,Cr,Lr,an,Yr)))}(ci[0],ci[1],ki[0],ki[1],Ci[0],Ci[1],Di[0],Di[1]);this.elevatedGlobePerspectiveTransform=h0(ci[0],ci[1],ki[0],ki[1],Ci[0],Ci[1],Di[0],Di[1]);const Qi=(tr,yr)=>{ae.push(tr.lng);const Yi=Math.round((tr.lng-ye)/St*Fr),er=Math.round((tr.lat-_t)/Pt*Fr),Cr=ti(yr),Lr=Si([],[Cr[0],Cr[1],1],Vi),an=Math.round(Lr[0]/Lr[2]*Fr),Yr=Math.round(Lr[1]/Lr[2]*Fr);zt.emplaceBack(Yi,er,an,Yr)},br=g[3].x-g[0].x,hr=g[3].y-g[0].y,xr=g[2].x-g[1].x,Sr=g[2].y-g[1].y;for(let tr=0;tr<65;tr++){const yr=tr/64,Yi=[g[0].x+yr*br,g[0].y+yr*hr],er=[g[1].x+yr*xr,g[1].y+yr*Sr],Cr=er[0]-Yi[0],Lr=er[1]-Yi[1];for(let an=0;an<65;an++){const Yr=an/64,zr={x:Yi[0]+Cr*Yr,y:Yi[1]+Lr*Yr};Qi(c.projection.unproject(zr.x,zr.y),zr)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(zt,n_.members)}{this.maxLongitudeTriangleSize=0;let zt=[],Kt=new go;const Qt=(Tt,Wt,ti)=>{Kt.emplaceBack(Tt,Wt,ti);const ci=ae[Tt],ki=ae[Wt],Ci=ae[ti],Di=Math.min(Math.min(ci,ki),Ci),Vi=Math.max(Math.max(ci,ki),Ci)-Di;Vi>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Vi),zt.push(Di+Vi/2)};for(let Tt=0;Tt<64;Tt++)for(let Wt=0;Wt<64;Wt++){const ti=65*Tt+Wt,ci=ti+1,ki=ti+65,Ci=ki+1;Qt(ti,ki,ci),Qt(ci,ki,Ci)}[zt,Kt]=function(Tt,Wt){const ti=Array.from({length:Tt.length},(Ci,Di)=>Di);ti.sort((Ci,Di)=>Tt[Ci]-Tt[Di]);const ci=[],ki=new go;for(let Ci=0;Ci<ti.length;Ci++){const Di=ti[Ci];ci.push(Tt[Di]);const Vi=3*Di,Qi=Vi+1;ki.emplaceBack(Wt.uint16[Vi],Wt.uint16[Qi],Wt.uint16[Qi+1])}return[ci,ki]}(zt,Kt),this.elevatedGlobeTrianglesCenterLongitudes=zt,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(Kt)}this.elevatedGlobeSegments=Hs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,St/Fr,0,Pt/Fr,0,0,_t,ye,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const c=this.map.painter.context,g=c.gl;!this._dirty||this.texture instanceof pm||(this.texture?this.texture.update(this.image):(this.texture=new a_(c,this.image,g.RGBA8),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(c)}loadTile(s,c){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},c(null)):(s.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const g=this.elevatedGlobeTrianglesCenterLongitudes;let y=(T=s+180)+360*Math.round((g[0]-T)/360);var T;const E=new Hs,D=(ce,fe)=>{E.segments.push({vertexOffset:0,primitiveOffset:ce,vertexLength:c.segments[0].vertexLength,primitiveLength:fe,sortKey:void 0,vaos:{}})},W=.51*this.maxLongitudeTriangleSize;if(Math.abs(g[0]-y)<=W){const ce=Js(g,0,g.length,y+W);return ce===g.length||D(ce,ls(g,ce+1,g.length,y+360-W)-ce),E}y<g[0]&&(y+=360);const X=ls(g,0,g.length,y-W);if(X===g.length)return D(0,g.length),E;D(0,X-0);const ae=Js(g,X+1,g.length,y+W);return ae!==g.length&&D(ae,g.length-ae),E}}const A1=(Math.pow(256,2)-1)/16907520;class d0 extends To{constructor(s,c,g,y){super(s,{layout:c0||(c0=new Us({visibility:new Mr(Gi.layout_raster.visibility)})),paint:u0||(u0=new Us({"raster-opacity":new Mr(Gi.paint_raster["raster-opacity"]),"raster-color":new Al(Gi.paint_raster["raster-color"]),"raster-color-mix":new Mr(Gi.paint_raster["raster-color-mix"]),"raster-color-range":new Mr(Gi.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mr(Gi.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mr(Gi.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mr(Gi.paint_raster["raster-brightness-max"]),"raster-saturation":new Mr(Gi.paint_raster["raster-saturation"]),"raster-contrast":new Mr(Gi.paint_raster["raster-contrast"]),"raster-resampling":new Mr(Gi.paint_raster["raster-resampling"]),"raster-fade-duration":new Mr(Gi.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mr(Gi.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mr(Gi.paint_raster["raster-array-band"]),"raster-elevation":new Mr(Gi.paint_raster["raster-elevation"]),"raster-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},c,g,y),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof f0&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[g,y]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(g)&&isNaN(y)||g===this._curRampRange[0]&&y===this._curRampRange[1]||(this.colorRamp=Qf({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:g,end:y}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[g,y])}}let p0,m0,g0,_0,y0;class v0 extends To{constructor(s,c,g,y){super(s,{layout:p0||(p0=new Us({visibility:new Mr(Gi["layout_raster-particle"].visibility)})),paint:m0||(m0=new Us({"raster-particle-array-band":new Mr(Gi["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mr(Gi["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Al(Gi["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mr(Gi["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mr(Gi["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mr(Gi["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mr(Gi["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mr(Gi["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},c,g,y),this._updateColorRamp(),this.lastInvalidatedAt=ia.now()}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Qf({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ia.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class C1 extends To{constructor(s,c){super(s,{},c,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function l_(u,s,c){const g=[0,0,1],y=xi([]);return fr(y,y,c?-Ai(u)+Math.PI:Ai(u)),$i(y,y,-Ai(s)),Li(g,g,y),nr(g,g)}function x0(u,s){const c=_m(u.projection,u.zoom,u.width,u.height),g=function(T,E,D,W,X){const ae=new qt(D.lng-180*xc,D.lat),ce=new qt(D.lng+180*xc,D.lat),fe=T.project(ae.lng,ae.lat),ye=T.project(ce.lng,ce.lat),_t=-Math.atan2(ye.y-fe.y,ye.x-fe.x),St=zi.fromLngLat(D);St.y=Jt(St.y,-1+xc,1-xc);const Pt=St.toLngLat(),zt=T.project(Pt.lng,Pt.lat),Kt=zi.fromLngLat(Pt);Kt.x+=xc;const Qt=Kt.toLngLat(),Tt=T.project(Qt.lng,Qt.lat),Wt=w0(Tt.x-zt.x,Tt.y-zt.y,_t),ti=zi.fromLngLat(Pt);ti.y+=xc;const ci=ti.toLngLat(),ki=T.project(ci.lng,ci.lat),Ci=w0(ki.x-zt.x,ki.y-zt.y,_t),Di=Math.abs(Wt.x)/Math.abs(Ci.y),Vi=ie([]);ge(Vi,Vi,-_t*(1-(X?0:W)));const Qi=ie([]);return le(Qi,Qi,[1,1-(1-Di)*W,1]),Qi[4]=-Ci.x/Ci.y*W,ge(Qi,Qi,_t),ne(Qi,Vi,Qi),Qi}(u.projection,0,u.center,c,s),y=b0(u);return le(g,g,[y,y,1]),g}function b0(u){const s=u.projection,c=_m(u.projection,u.zoom,u.width,u.height),g=c_(s,u.center),y=c_(s,qt.convert(s.center));return Math.pow(2,g*c+(1-c)*y)}function _m(u,s,c,g,y=1/0){const T=u.range;if(!T)return 0;const E=Math.min(y,Math.max(c,g)),D=Math.log(E/1024)/Math.LN2;return yi(T[0]+D,T[1]+D,s)}const xc=1/4e4;function c_(u,s){const c=Jt(s.lat,-85.051129,or),g=new qt(s.lng-180*xc,c),y=new qt(s.lng+180*xc,c),T=u.project(g.lng,c),E=u.project(y.lng,c),D=zi.fromLngLat(g),W=zi.fromLngLat(y),X=E.x-T.x,ae=E.y-T.y,ce=W.x-D.x,fe=W.y-D.y,ye=Math.sqrt((ce*ce+fe*fe)/(X*X+ae*ae));return Math.log(ye)/Math.LN2}function w0(u,s,c){const g=Math.cos(c),y=Math.sin(c);return{x:u*g-s*y,y:u*y+s*g}}function S0(u,s,c){ie(u),ge(u,u,Ai(s[2])),he(u,u,Ai(s[0])),me(u,u,Ai(s[1])),le(u,u,c),ne(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ym(u,s,c,g,y,T,E,D){const W=[c[0]-s[0],c[1]-s[1],0],X=[g[0]-s[0],g[1]-s[1],0];if(Yt(W)<1e-12||Yt(X)<1e-12)return xi(u);const ae=Gt([],W,X);nr(ae,ae),Ct(X,g,s),W[2]=(T-y)*D,X[2]=(E-y)*D;const ce=W;return Gt(ce,W,X),nr(ce,ce),mr(u,ae,ce)}function u_(u,s,c=!1){const g=mc(s.zoom),y=function(T,E,D){const W=E.worldSize,X=[T[12],T[13],T[14]],ae=ji(X[1]/W),ce=Pi(X[0]/W),fe=ie([]),ye=Ei(1,ae)*W,_t=Ei(1,0)*W*vr(ae,E.zoom),St=1/_g(W);let Pt=_t*St;if(D){const Tt=_m(E.projection,E.zoom,E.width,E.height,1024);Pt=St*E.projection.pixelSpaceConversion(E.center.lat,W,Tt)}const zt=At(ae,ce);ei(zt,zt,jt([],nr([],zt),ye*Pt*X[2]));const Kt=function(Tt){const Wt=[Tt[0],Tt[1],Tt[2]];let ti=[0,1,0];const ci=Gt([],ti,Wt);return Gt(ti,Wt,ci),Er(ti)===0&&(ti=[0,1,0],Gt(ci,Wt,ti)),nr(ci,ci),nr(ti,ti),nr(Wt,Wt),[ci[0],ci[1],ci[2],0,ti[0],ti[1],ti[2],0,Wt[0],Wt[1],Wt[2],0,Tt[0],Tt[1],Tt[2],1]}(zt);le(fe,fe,[Pt,Pt,Pt*ye]),se(fe,fe,[-X[0],-X[1],-X[2]]);const Qt=ne([],E.globeMatrix,Kt);return ne(Qt,Qt,fe),ne(Qt,Qt,T),Qt}(u,s,c);if(g>0){const T=function(E,D){const W=D.worldSize,X=Ei(1,0)*W*vr(D.center.lat,D.zoom)/_g(W),ae=Ei(1,D.center.lat)*W,ce=ie([]);return me(ce,ce,Ai(D.center.lng)),he(ce,ce,Ai(D.center.lat)),se(ce,ce,[0,0,H]),le(ce,ce,[X,X,X*ae]),se(ce,ce,[D.point.x-.5*W,D.point.y-.5*W,0]),ne(ce,ce,E),ne(ce,D.globeMatrix,ce)}(u,s);return function(E,D,W){const X=(_t,St,Pt)=>{const zt=Yt(_t),Kt=Yt(St),Qt=Rl(_t,St,Pt);return jt(Qt,Qt,1/Yt(Qt)*pn(zt,Kt,Pt))},ae=X([E[0],E[1],E[2]],[D[0],D[1],D[2]],W),ce=X([E[4],E[5],E[6]],[D[4],D[5],D[6]],W),fe=X([E[8],E[9],E[10]],[D[8],D[9],D[10]],W),ye=Rl([E[12],E[13],E[14]],[D[12],D[13],D[14]],W);return[ae[0],ae[1],ae[2],0,ce[0],ce[1],ce[2],0,fe[0],fe[1],fe[2],0,ye[0],ye[1],ye[2],1]}(y,T,g)}return y}function T0(u,s,c,g){const y=Yn.projectAabbCorners(g,c);let T=Number.MAX_VALUE,E=-1;for(let X=0;X<y.length;++X){const ae=y[X];ae[0]=(.5*ae[0]+.5)*s.width,ae[1]=(.5-.5*ae[1])*s.height,ae[2]<T&&(E=X,T=ae[2])}const D=X=>new rr(y[X][0],y[X][1]);let W;switch(E){case 0:case 6:W=[D(1),D(5),D(4),D(7),D(3),D(2),D(1)];break;case 1:case 7:W=[D(0),D(4),D(5),D(6),D(2),D(3),D(0)];break;case 3:case 5:W=[D(1),D(0),D(4),D(7),D(6),D(2),D(1)];break;default:W=[D(1),D(5),D(6),D(7),D(3),D(0),D(1)]}if(Fo(u,W))return T}const P1=Zn([{name:"a_pos_3f",components:3,type:"Float32"}]),I1=Zn([{name:"a_color_3f",components:3,type:"Float32"}]),R1=Zn([{name:"a_color_4f",components:4,type:"Float32"}]),L1=Zn([{name:"a_uv_2f",components:2,type:"Float32"}]),k1=Zn([{name:"a_normal_3f",components:3,type:"Float32"}]),D1=Zn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),F1=Zn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),E0={None:0,Model:1,Symbol:2,FillExtrusion:4};class vm{constructor(s,c,g,y){this.message=(s?`${s}: `:"")+g,y&&(this.identifier=y),c!=null&&c.__line__&&(this.line=c.__line__)}}function h_(u,s){const c=u.indexOf("://")===-1;try{return new URL(u,c&&s?"http://example.com":void 0),!0}catch{return!1}}class M0{constructor(s,c){this.feature=s,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class A0{constructor(){this.instancedDataArray=new cc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class f_{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=s.projection,this.index=s.index,this.worldview=s.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs}updateFootprints(s,c){}populate(s,c,g,y){this.tileToMeter=Ji(g);const T=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:E,id:D,index:W,sourceLayerIndex:X}of s){const ae=D??(E.properties&&E.properties.hasOwnProperty("id")?E.properties.id:void 0),ce=Ur(E,T);if(!this.layers[0]._featureFilter.filter(new ps(this.zoom,{worldview:this.worldview}),ce,g))continue;const fe={id:ae,sourceLayerIndex:X,index:W,geometry:T?ce.geometry:qr(E,g,y),properties:E.properties,type:E.type,patterns:{}},ye=this.addFeature(fe,fe.geometry,ce);ye&&c.featureIndex.insert(E,fe.geometry,W,X,this.index,this.instancesPerModel[ye].instancedDataArray.length,Fr/32)}this.lookup=null}update(s,c,g,y){for(const T in this.instancesPerModel){const E=this.instancesPerModel[T];for(const D in s)E.idToFeaturesIndex.hasOwnProperty(D)&&(this.evaluate(E.features[E.idToFeaturesIndex[D]],s[D],E,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const c in this.instancesPerModel){const g=this.instancesPerModel[c];for(const y of g.features){const T=this.layers[0],E=y.feature,D=this.canonical,W=T.paint.get("model-rotation").evaluate(E,{},D),X=T.paint.get("model-scale").evaluate(E,{},D),ae=T.paint.get("model-translation").evaluate(E,{},D);Mi(y.rotation,W)&&Mi(y.scale,X)&&Mi(y.translation,ae)||(this.evaluate(y,y.featureStates,g,!0),s=!0)}}return s}updateReplacement(s,c,g,y){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const T=c.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(Pg(this.activeReplacements,T))return!1;this.activeReplacements=T;let E=!1;for(const D in this.instancesPerModel){const W=this.instancesPerModel[D],X=W.instancedDataArray;for(const ae of W.features){const ce=ae.instancedDataOffset,fe=ae.instancedDataCount;for(let ye=0;ye<fe;ye++){const _t=16*(ye+ce);let St=X.float32[_t+0];const Pt=St>Fr;St=Pt?St-Fr:St;const zt=Math.floor(St),Kt=X.float32[_t+1];let Qt=!1;for(const Tt of this.activeReplacements)if(!vy(Tt,g,E0.Model,y)&&!(Tt.min.x>zt||zt>Tt.max.x||Tt.min.y>Kt||Kt>Tt.max.y)&&(Qt=Ey(Ty(zt,Kt,s.canonical,Tt.footprintTileId.canonical),Tt.footprint),Qt))break;X.float32[_t]=Qt?St+Fr:St,E=E||Qt!==Pt}}}return E}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const c in this.instancesPerModel){const g=this.instancesPerModel[c];g.instancedDataArray.length<0||g.instancedDataArray.length===0||(g.instancedDataBuffer?g.instancedDataBuffer.updateData(g.instancedDataArray):g.instancedDataBuffer=s.createVertexBuffer(g.instancedDataArray,D1.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const g=this.instancesPerModel[c];g.instancedDataArray.length!==0&&g.instancedDataBuffer&&g.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(s&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)s.removeModel(c,"",!0)}addFeature(s,c,g){const y=this.layers[0],T=y.layout.get("model-id").evaluate(g,{},this.canonical);if(!T)return yn(`modelId is not evaluated for layer ${y.id} and it is not going to get rendered.`),T;(h_(T,!1)||this.styleDefinedModelURLs[T]!==void 0)&&(this.modelUris.includes(T)||this.modelUris.push(T)),this.instancesPerModel[T]||(this.instancesPerModel[T]=new A0);const E=this.instancesPerModel[T],D=E.instancedDataArray,W=new M0(g,D.length);for(const X of c)for(const ae of X){if(ae.x<0||ae.x>=Fr||ae.y<0||ae.y>=Fr)continue;const ce=(this.lookupDim-1)/Fr,fe=this.lookupDim*(ae.y*ce|0)+ae.x*ce|0;if(this.lookup){if(this.lookup[fe]!==0)continue;this.lookup[fe]=1}this.instanceCount++;const ye=D.length;D.resize(ye+1),E.instancesEvaluatedElevation.push(0),D.float32[16*ye]=ae.x,D.float32[16*ye+1]=ae.y}return W.instancedDataCount=E.instancedDataArray.length-W.instancedDataOffset,W.instancedDataCount>0&&(s.id&&(E.idToFeaturesIndex[s.id]=E.features.length),E.features.push(W),this.evaluate(W,{},E,!1)),T}getModelUris(){return this.modelUris}evaluate(s,c,g,y){const T=this.layers[0],E=s.feature,D=this.canonical,W=s.rotation=T.paint.get("model-rotation").evaluate(E,c,D),X=s.scale=T.paint.get("model-scale").evaluate(E,c,D),ae=s.translation=T.paint.get("model-translation").evaluate(E,c,D),ce=T.paint.get("model-color").evaluate(E,c,D);ce.a=T.paint.get("model-color-mix-intensity").evaluate(E,c,D);const fe=[];this.maxVerticalOffset<ae[2]&&(this.maxVerticalOffset=ae[2]),this.maxScale=Math.max(Math.max(this.maxScale,X[0]),Math.max(X[1],X[2])),S0(fe,W,X);const ye=Math.round(100*ce.a)+ce.b/1.05;for(let _t=0;_t<s.instancedDataCount;++_t){const St=s.instancedDataOffset+_t,Pt=16*St,zt=g.instancedDataArray.float32;let Kt=0;y&&(Kt=zt[Pt+6]-g.instancesEvaluatedElevation[St]);const Qt=0|zt[Pt+1];zt[Pt]=(0|zt[Pt])+ce.r/1.05,zt[Pt+1]=Qt+ce.g/1.05,zt[Pt+2]=ye,zt[Pt+3]=1/(D.z>10?this.tileToMeter:Ji(D,Qt)),zt[Pt+4]=ae[0],zt[Pt+5]=ae[1],zt[Pt+6]=ae[2]+Kt,zt[Pt+7]=fe[0],zt[Pt+8]=fe[1],zt[Pt+9]=fe[2],zt[Pt+10]=fe[4],zt[Pt+11]=fe[5],zt[Pt+12]=fe[6],zt[Pt+13]=fe[8],zt[Pt+14]=fe[9],zt[Pt+15]=fe[10],g.instancesEvaluatedElevation[St]=ae[2]}}}let C0,P0;jr(f_,"ModelBucket",{omit:["layers"]}),jr(A0,"PerModelAttributes"),jr(M0,"ModelFeature");const Eu=64,Vh={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function I0(u,s,c,g,y,T,E,D,W,X=!1){const ae=c.zoom,ce=c.project(g),fe=vr(g.lat,ae),ye=1/fe;ie(u),se(u,u,[ce.x+E[0]*ye,ce.y+E[1]*ye,E[2]]);let _t=1,St=1;const Pt=c.worldSize;if(X){if(c.projection.name==="mercator"){let Tt=0;c.elevation&&(Tt=c.elevation.getAtPointOrZero(new zi(ce.x/Pt,ce.y/Pt),0));const Wt=Hi([],[ce.x,ce.y,Tt,1],c.projMatrix)[3]/c.cameraToCenterDistance;_t=Wt,St=Wt*vr(c.center.lat,ae)}else if(c.projection.name==="globe"){const Tt=u_(u,c),Wt=[0,0,0,1];Hi(Wt,Wt,ne([],c.projMatrix,Tt));const ti=Wt[3]/c.cameraToCenterDistance,ci=mc(ae),ki=c.projection.pixelsPerMeter(g.lat,Pt)*vr(g.lat,ae),Ci=c.projection.pixelsPerMeter(c.center.lat,Pt)*vr(c.center.lat,ae);_t=ti/pn(ki,ar(c.center.lat),ci),St=ti*fe/ki,_t*=Ci,St*=Ci}}else _t=ye;le(u,u,[_t,_t,St]);const zt=[...u],Kt=s.orientation,Qt=[];if(S0(Qt,[Kt[0]+y[0],Kt[1]+y[1],Kt[2]+y[2]],T),ne(u,zt,Qt),D&&c.elevation){let Tt=0;const Wt=[];if(W&&c.elevation){Tt=function(ci,ki,Ci,Di,Vi){const Qi=ki.elevation;if(!Qi)return 0;const br=Yn.projectAabbCorners(Ci,Di),hr=Ei(1,Vi.lat)*ki.worldSize,xr=function(Ar,vn){const Zr=[0,0,1],Kr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mn of Kr){const Tn=Ar[mn.corners[0]],bn=Ar[mn.corners[1]],Rn=Ar[mn.corners[2]],Mn=[bn[0]-Tn[0],bn[1]-Tn[1],vn*(bn[2]-Tn[2])],Ln=Gt(Mn,Mn,[Rn[0]-Tn[0],Rn[1]-Tn[1],vn*(Rn[2]-Tn[2])]);nr(Ln,Ln),mn.dotProductWithUp=si(Ln,Zr)}return Kr.sort((mn,Tn)=>mn.dotProductWithUp-Tn.dotProductWithUp),Kr[0].corners}(br,hr),Sr=br[xr[0]],tr=br[xr[1]],yr=br[xr[2]],Yi=br[xr[3]],er=Qi.getAtPointOrZero(new zi(Sr[0]/ki.worldSize,Sr[1]/ki.worldSize),0),Cr=Qi.getAtPointOrZero(new zi(tr[0]/ki.worldSize,tr[1]/ki.worldSize),0),Lr=Qi.getAtPointOrZero(new zi(yr[0]/ki.worldSize,yr[1]/ki.worldSize),0),an=Qi.getAtPointOrZero(new zi(Yi[0]/ki.worldSize,Yi[1]/ki.worldSize),0),Yr=(er+an)/2,zr=(Cr+Lr)/2;return Yr>zr?Cr<Lr?ym(ci,tr,Yi,Sr,Cr,an,er,hr):ym(ci,yr,Sr,Yi,Lr,er,an,hr):er<an?ym(ci,Sr,tr,yr,er,Cr,Lr,hr):ym(ci,Yi,yr,tr,an,Lr,Cr,hr),Math.max(Yr,zr)}(Wt,c,s.aabb,u,g);const ti=ne([],Lt([],Wt),Qt);ne(u,zt,ti)}else Tt=c.elevation.getAtPointOrZero(new zi(ce.x/Pt,ce.y/Pt),0);Tt!==0&&(u[14]+=Tt)}}function Td(u,s,c=!1){u.uploaded||(u.gfxTexture=new a_(s,u.image,c?s.gl.R8:s.gl.RGBA8,{useMipmap:u.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function O1(u,s,c){u.indexBuffer=s.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=s.createVertexBuffer(u.vertexArray,P1.members,!1,!0),u.normalArray&&(u.normalBuffer=s.createVertexBuffer(u.normalArray,k1.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=s.createVertexBuffer(u.texcoordArray,L1.members,!1,!0)),u.colorArray&&(u.colorBuffer=s.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?I1:R1).members,!1,!0)),u.featureArray&&(u.pbrBuffer=s.createVertexBuffer(u.featureArray,F1.members,!0)),u.segments=Hs.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const g=u.material;g.pbrMetallicRoughness.baseColorTexture&&Td(g.pbrMetallicRoughness.baseColorTexture,s),g.pbrMetallicRoughness.metallicRoughnessTexture&&Td(g.pbrMetallicRoughness.metallicRoughnessTexture,s),g.normalTexture&&Td(g.normalTexture,s),g.occlusionTexture&&Td(g.occlusionTexture,s,c),g.emissionTexture&&Td(g.emissionTexture,s)}function d_(u,s,c){if(u.meshes)for(const g of u.meshes)O1(g,s,c);if(u.children)for(const g of u.children)d_(g,s,c)}function xm(u){if(u.meshes)for(const s of u.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(u.children)for(const s of u.children)xm(s)}function p_(u){if(u.meshes)for(const c of u.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((s=c.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(u.children)for(const c of u.children)p_(c)}class $h{constructor(s,c,g){this._demTile=s,this._dem=this._demTile.dem,this._scale=c,this._offset=g}static create(s,c,g){const y=g||s.findDEMTileFor(c);if(!y||!y.dem)return;const T=y.dem,E=y.tileID,D=1<<c.canonical.z-E.canonical.z;return new $h(y,T.dim/Fr/D,[(c.canonical.x/D-E.canonical.x)*T.dim,(c.canonical.y/D-E.canonical.y)*T.dim])}tileCoordToPixel(s,c){const g=c*this._scale+this._offset[1],y=Math.floor(s*this._scale+this._offset[0]),T=Math.floor(g);return new rr(y,T)}getElevationAt(s,c,g,y){const T=s*this._scale+this._offset[0],E=c*this._scale+this._offset[1],D=Math.floor(T),W=Math.floor(E),X=this._dem;return y=!!y,g?pn(pn(X.get(D,W,y),X.get(D,W+1,y),E-W),pn(X.get(D+1,W,y),X.get(D+1,W+1,y),E-W),T-D):X.get(D,W,y)}getElevationAtPixel(s,c,g){return this._dem.get(s,c,!!g)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*Ei(1,s)*this._dem.stride}}const m_=new Float32Array(262144),Mu=new Uint8Array(262144);function R0(u){let s=0;if(u.meshes)for(const c of u.meshes)s=Math.max(s,c.aabb.max[2]);if(u.children)for(const c of u.children)s=Math.max(s,R0(c));return s}function L0(u,s,c){if(u.meshes)for(const g of u.meshes){if(g.aabb.min[0]===1/0)continue;const y=Yn.applyTransform(g.aabb,u.matrix);c.insert(s,y.min[0],y.min[1],y.max[0],y.max[1])}if(u.children)for(const g of u.children)L0(g,s,c)}const k0=["","wall","door","roof","window","lamp","logo"];class D0{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:R0(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const c=new Yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const g of this.node.meshes)this.node.lightMeshIndex!==s&&(g.transformedAabb=Yn.applyTransformFast(g.aabb,this.node.matrix),c.encapsulate(g.transformedAabb)),s++;this.aabb=c}return this.aabb}}class bm{constructor(s,c,g,y,T,E,D,W){this.id=g,this.layers=s,this.layerIds=this.layers.map(X=>X.fqid),this.stateDependentLayerIds=this.layers.filter(X=>X.isStateDependent()).map(X=>X.id),this.modelTraits|=Vh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,y&&(this.modelTraits|=Vh.HasMapboxMeshFeatures),T&&(this.modelTraits|=Vh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=E,this.worldview=W,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const X of c)this.nodesInfo.push(new D0(X)),L0(X,D.featureIndexArray.length,D.grid),D.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,D.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(s,c){for(const g of this.getNodesInfo()){const y=g.node;y.footprint&&c.push({footprint:y.footprint,id:s})}}update(s){const c=Object.keys(s).length!==0;if(c&&!this.stateDependentLayers.length)return;const g=c?this.stateDependentLayers:this.layers;if(!Ki(s,this.states))for(const y of g)this.evaluate(y,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const g of c){const y=g.node;this.uploaded?this.updatePbrBuffer(y):d_(y,s,!0)}for(const g of c)xm(g.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let c=!1;if(!s.meshes)return c;for(const g of s.meshes)g.pbrBuffer&&(g.pbrBuffer.updateData(g.featureArray),c=!0);return c}needsReEvaluation(s,c,g){const y=s.transform.projectionOptions,T=s.style.getBrightness(),E=this.brightness!==T;if(!this.uploaded||this.dirty||y.name!==this.projection.name||Ed(g.paint.get("model-color").value,E)||Ed(g.paint.get("model-color-mix-intensity").value,E)||Ed(g.paint.get("model-roughness").value,E)||Ed(g.paint.get("model-emissive-strength").value,E)||Ed(g.paint.get("model-height-based-emissive-strength-multiplier").value,E)){this.projection=y,this.brightness=T;const D=this.getNodesInfo();for(const W of D)W.state=null;return!0}return!1}evaluateTransform(s,c){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const g=this.getNodesInfo(),y=this.id.canonical;for(const T of g){const E=T.feature;T.evaluatedTranslation=c.paint.get("model-translation").evaluate(E,{},y),T.evaluatedScale=c.paint.get("model-scale").evaluate(E,{},y)}}evaluate(s,c){const g=this.getNodesInfo();for(const y of g){if(!y.node.meshes)continue;const T=y.feature,E=c&&c[T.id];if(Ki(E,y.state))continue;y.state=structuredClone(E);const D=y.node.meshes&&y.node.meshes[0].featureData,W=y.evaluatedColor[2],X=y.evaluatedRMEA[2],ae=this.id.canonical;if(y.hasTranslucentParts=!1,D){for(let ce=0;ce<k0.length;ce++){const fe=k0[ce];fe.length&&(T.properties.part=fe);const ye=s.paint.get("model-color").evaluate(T,E,ae).toPremultipliedRenderColor(null),_t=s.paint.get("model-color-mix-intensity").evaluate(T,E,ae);y.evaluatedColor[ce]=[ye.r,ye.g,ye.b,_t],y.evaluatedRMEA[ce][0]=s.paint.get("model-roughness").evaluate(T,E,ae),y.evaluatedRMEA[ce][2]=s.paint.get("model-emissive-strength").evaluate(T,E,ae),y.evaluatedRMEA[ce][3]=ye.a,y.emissionHeightBasedParams[ce]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(T,E,ae),!y.hasTranslucentParts&&ye.a<1&&(y.hasTranslucentParts=!0)}delete T.properties.part,B1(y,W!==y.evaluatedColor[2]||X!==y.evaluatedRMEA[2],this.modelTraits)}else y.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(T,E,ae);y.evaluatedTranslation=s.paint.get("model-translation").evaluate(T,E,ae),y.evaluatedScale=s.paint.get("model-scale").evaluate(T,E,ae),this.updatePbrBuffer(y.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,c,g,y){const T=s.findDEMTileFor(g);if(T&&(T.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(T.dem&&T.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=T.tileID.overscaledZ;const E=$h.create(s,g,T);if(!E)return;this.modelTraits&Vh.HasMapboxMeshFeatures&&this.updateDEM(s,E,g,y);for(const D of this.getNodesInfo()){const W=D.node;if(!W.footprint||!W.footprint.vertices||!W.footprint.vertices.length)continue;const X=W.footprint.vertices;let ae=E.getElevationAt(X[0].x,X[0].y,!0,!0);for(let ce=1;ce<X.length;ce++)ae=Math.min(ae,E.getElevationAt(X[ce].x,X[ce].y,!0,!0));W.elevation=ae}}this.terrainTile=T.tileID.canonical,this.terrainExaggeration=c}}updateDEM(s,c,g,y){let T=c._dem._modifiedForSources[y];if(T===void 0&&(c._dem._modifiedForSources[y]=[],T=c._dem._modifiedForSources[y]),T.includes(g.canonical))return;const E=c._dem.dim;T.push(g.canonical);let D=!1;for(const W of this.getNodesInfo()){const X=W.node;if(!X.footprint||!X.footprint.grid)continue;const ae=X.footprint.grid,ce=c.tileCoordToPixel(ae.min.x,ae.min.y),fe=c.tileCoordToPixel(ae.max.x,ae.max.y),ye=Math.min(Math.min(E-fe.y,ce.x),Math.min(ce.y,E-fe.x));if(ye<0)continue;const _t=Jt(ye,2,5);let St=Math.max(0,ce.x-_t),Pt=Math.max(0,ce.y-_t),zt=Math.min(fe.x+_t,E-1),Kt=Math.min(fe.y+_t,E-1);for(let ti=Pt;ti<=Kt;++ti)for(let ci=St;ci<=zt;++ci)Mu[ti*E+ci]=255;let Qt=0,Tt=0;for(let ti=0;ti<ae.cellsY;++ti)for(let ci=0;ci<ae.cellsX;++ci){if(!ae.cells[ti*ae.cellsX+ci])continue;const ki=c.tileCoordToPixel(ae.min.x+ci/ae.xScale,ae.min.y+ti/ae.yScale),Ci=c.tileCoordToPixel(ae.min.x+(ci+1)/ae.xScale,ae.min.y+(ti+1)/ae.yScale);for(let Di=ki.y;Di<=Math.min(Ci.y+1,E-1);++Di)for(let Vi=ki.x;Vi<=Math.min(Ci.x+1,E-1);++Vi)Mu[Di*E+Vi]===255&&(Mu[Di*E+Vi]=0,Qt+=c.getElevationAtPixel(Vi,Di),Tt++)}const Wt=Qt/Tt;St=Math.max(1,ce.x-_t),Pt=Math.max(1,ce.y-_t),zt=Math.min(fe.x+_t,E-2),Kt=Math.min(fe.y+_t,E-2),D=!0;for(let ti=Pt;ti<=Kt;++ti)for(let ci=St;ci<=zt;++ci)Mu[ti*E+ci]===0&&(m_[ti*E+ci]=c._dem.set(ci,ti,Wt));for(let ti=1;ti<_t;++ti){St=Math.max(1,ce.x-ti),Pt=Math.max(1,ce.y-ti),zt=Math.min(fe.x+ti,E-2),Kt=Math.min(fe.y+ti,E-2);for(let ci=Pt;ci<=Kt;++ci)for(let ki=St;ki<=zt;++ki){const Ci=ci*E+ki;if(Mu[Ci]===255){let Di=0,Vi=0,Qi=-1,br=-1;for(let hr=-1;hr<=1;++hr)for(let xr=-1;xr<=1;++xr){const Sr=(ci+hr)*E+ki+xr;if(Mu[Sr]>=ti)continue;const tr=m_[Sr],yr=Math.abs(tr);yr>Vi&&(Di=tr,Vi=yr,Qi=xr,br=hr)}if(Vi>.1){const hr=1-(ti+.5*Math.abs(Qi*br))/_t;let xr=c._dem.get(ki,ci)+Di*hr;const Sr=c._dem.get(ki+Qi,ci+br),tr=c._dem.get(ki-Qi,ci-br,!0);(xr-Sr)*(xr-tr)>0&&(xr=(Sr+tr)/2),m_[Ci]=c._dem.set(ki,ci,xr),Mu[Ci]=ti}}}}}D&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=ia.now())}setFilter(s){this.filter=s?Rf(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new ps(this.id.overscaledZ,{worldview:this.worldview}),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const c of s)xm(c.node),p_(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(s.toUnwrapped());for(const y of this.getNodesInfo()){const T=y.node.footprint;y.hiddenByReplacement=!!T&&!g.find(E=>E.footprint===T)}}getHeightAtTileCoord(s,c){const g=[],y=[0,0,0],T=ie([]);for(const E of this.getNodesInfo()){const D=E.node.meshes[0],W=D.transformedAabb;if(s<W.min[0]||c<W.min[1]||s>W.max[0]||c>W.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};ue(T,E.node.matrix),y[0]=s,y[1]=c,oi(y,y,T);const X=(y[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*Eu|0,ae=Math.min(63,(y[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*Eu|0)*Eu+Math.min(63,X),ce=D.heightmap[ae];if(!(ce<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:ce,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new rr(s,c),new rr(s,c),g),g.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function Ed(u,s){return u instanceof Jc&&!u.isLightConstant&&s}function z1(u,s,c,g,y,T,E,D){let W=(61440&s|(61440&s)>>4)>>8,X=(3840&s|(3840&s)>>4)>>4,ae=240&s|(240&s)>>4;c[3]>0&&(W=pn(W,255*c[0],c[3]),X=pn(X,255*c[1],c[3]),ae=pn(ae,255*c[2],c[3]));const ce=W<<8|X,fe=ae<<8|Math.floor(255*g[3]),ye=function(ti){const ci=Jt(ti,0,2);return Math.min(Math.round(.5*ci*255),255)}(g[2])<<8|15*g[0]<<4|15*g[1],_t=Jt(y[0],0,1),St=Jt(y[1],0,1),Pt=Jt(y[2],0,1),zt=Jt(y[3],0,1);let Kt,Qt,Tt,Wt;if(_t!==St&&E!==T&&St!==_t){const ti=E-T;Qt=1/(ti*(St-_t)),Tt=-(T+ti*_t)/(ti*(St-_t));const ci=Jt(y[4],-1,1);Wt=Math.pow(10,ci),Kt=255*Pt<<8|255*zt}else Kt=65535,Qt=0,Tt=1,Wt=1;if(u.emplaceBack(ce,fe,ye,Kt,Qt,Tt,Wt),D){const ti=D.length;D.clear();for(let ci=0;ci<ti;ci++)D.emplaceBack(ce,fe,ye,Kt,Qt,Tt,Wt)}}function B1(u,s,c){const g=u.node;let y=0;const T=c&Vh.HasMeshoptCompression;for(const E of g.meshes){if(g.lights&&g.lightMeshIndex===y||!E.featureData)continue;E.featureArray=new uu,E.featureArray.reserve(E.featureData.length);let D=s;for(const W of E.featureData){const X=T?65535&W:W>>16&65535,ae=T?W>>16&65535:65535&W,ce=(15&ae)<8?15&ae:0,fe=u.evaluatedRMEA[ce],ye=u.evaluatedColor[ce],_t=u.emissionHeightBasedParams[ce];let St;if(D&&ce===2&&g.lights&&(St=new uu,St.resize(10*g.lights.length)),z1(E.featureArray,X,ye,fe,_t,E.aabb.min[2],E.aabb.max[2],St),St&&D){D=!1;const Pt=g.meshes[g.lightMeshIndex];Pt.featureArray=St,Pt.featureArray._trim()}}E.featureArray._trim(),y++}}function F0(u,s,c,g){const y=1<<u.z;s.lat=ji((g/Fr+u.y)/y),s.lng=Pi((c/Fr+u.x)/y)}function N1(u,s,c,g){const y=u.getNodesInfo()[s];if(!y||y.hiddenByReplacement||!y.node.meshes)return;let T=Number.MAX_VALUE;const E=y.node,D=c.tile,W=g.calculatePosMatrix(D.tileID.toUnwrapped(),g.worldSize),X=y.evaluatedScale;let ae=0;g.elevation&&E.elevation&&(ae=E.elevation*g.elevation.exaggeration()),se(W,W,[(E.anchor?E.anchor[0]:0)*(X[0]-1),(E.anchor?E.anchor[1]:0)*(X[1]-1),ae]),le(W,W,X);const ce=c.queryGeometry,fe=ce.isPointQuery()?ce.screenBounds:ce.screenGeometry,ye=function(St){const Pt=ne([],W,St.matrix);ne(Pt,g.expandedFarZProjMatrix,Pt);for(let zt=0;zt<St.meshes.length;++zt){const Kt=St.meshes[zt];if(zt===St.lightMeshIndex)continue;const Qt=T0(fe,g,Pt,Kt.aabb);Qt!=null&&(T=Math.min(Qt,T))}if(St.children)for(const zt of St.children)ye(zt)};if(ye(E),T===Number.MAX_VALUE)return;const _t=new qt(0,0);return F0(D.tileID.canonical,_t,y.node.anchor[0],y.node.anchor[1]),{intersectionZ:T,position:_t,feature:y.feature}}jr(bm,"Tiled3dModelBucket",{omit:["layers"]}),jr(D0,"Tiled3dModelFeature");const V1={circle:class extends To{constructor(u,s,c,g){super(u,{layout:R_||(R_=new Us({"circle-sort-key":new $r(Gi.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Mr(Gi.layout_circle["circle-elevation-reference"]),visibility:new Mr(Gi.layout_circle.visibility)})),paint:L_||(L_=new Us({"circle-radius":new $r(Gi.paint_circle["circle-radius"]),"circle-color":new $r(Gi.paint_circle["circle-color"]),"circle-blur":new $r(Gi.paint_circle["circle-blur"]),"circle-opacity":new $r(Gi.paint_circle["circle-opacity"]),"circle-translate":new Mr(Gi.paint_circle["circle-translate"]),"circle-translate-anchor":new Mr(Gi.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mr(Gi.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mr(Gi.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $r(Gi.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $r(Gi.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $r(Gi.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mr(Gi.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g)}createBucket(u){return new ea(u)}queryRadius(u){const s=u;return Ph("circle-radius",this,s)+Ph("circle-stroke-width",this,s)+kp(this.paint.get("circle-translate"))}queryIntersectsFeature(u,s,c,g,y,T,E,D){const W=I_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,u.pixelToTileUnitsFactor),X=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c);return j_(u,g,T,E,D,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",W,X)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,s,c){const g=H_(this);return{config:new fc(this,{zoom:s,lut:c}),defines:g,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends To{createBucket(u){return new q_(u)}constructor(u,s,c,g){super(u,{layout:X_||(X_=new Us({visibility:new Mr(Gi.layout_heatmap.visibility)})),paint:Z_||(Z_=new Us({"heatmap-radius":new $r(Gi.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $r(Gi.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mr(Gi.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Al(Gi.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mr(Gi.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return Ph("heatmap-radius",this,u)}queryIntersectsFeature(u,s,c,g,y,T,E,D){const W=this.paint.get("heatmap-radius").evaluate(s,c);return j_(u,g,T,E,D,!0,!0,new rr(0,0),W)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,s,c){return u==="heatmap"?{config:new fc(this,{zoom:s,lut:c}),overrideFog:!1}:{}}},hillshade:class extends To{constructor(u,s,c,g){super(u,{layout:Y_||(Y_=new Us({visibility:new Mr(Gi.layout_hillshade.visibility)})),paint:K_||(K_=new Us({"hillshade-illumination-direction":new Mr(Gi.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mr(Gi.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mr(Gi.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mr(Gi.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mr(Gi.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mr(Gi.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mr(Gi.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,s,c){return{overrideFog:!1}}},fill:class extends To{constructor(u,s,c,g){super(u,{layout:fy||(fy=new Us({"fill-sort-key":new $r(Gi.layout_fill["fill-sort-key"]),visibility:new Mr(Gi.layout_fill.visibility),"fill-elevation-reference":new Mr(Gi.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new $r(Gi.layout_fill["fill-construct-bridge-guard-rail"])})),paint:dy||(dy=new Us({"fill-antialias":new Mr(Gi.paint_fill["fill-antialias"]),"fill-opacity":new $r(Gi.paint_fill["fill-opacity"]),"fill-color":new $r(Gi.paint_fill["fill-color"]),"fill-outline-color":new $r(Gi.paint_fill["fill-outline-color"]),"fill-translate":new Mr(Gi.paint_fill["fill-translate"]),"fill-translate-anchor":new Mr(Gi.paint_fill["fill-translate-anchor"]),"fill-pattern":new $r(Gi.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Mr(Gi.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Mr(Gi.paint_fill["fill-emissive-strength"]),"fill-z-offset":new $r(Gi.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new $r(Gi.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new $r(Gi.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g)}getProgramIds(){const u=this.paint.get("fill-pattern"),s=u&&u.constantOr(1),c=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,s,c){return{config:new fc(this,{zoom:s,lut:c}),overrideFog:!1}}recalculate(u,s){super.recalculate(u,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Mg(u)}queryRadius(){return kp(this.paint.get("fill-translate"))}queryIntersectsFeature(u,s,c,g,y,T){return!u.queryGeometry.isAboveHorizon&&ca(P_(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,u.pixelToTileUnitsFactor),g)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?s&&!u:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends To{constructor(u,s,c,g){super(u,{layout:Vy||(Vy=new Us({visibility:new Mr(Gi["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mr(Gi["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:$y||($y=new Us({"fill-extrusion-opacity":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new $r(Gi["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mr(Gi["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Wp(u)}queryRadius(){return kp(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,s,c,g,y,T,E,D,W){const X=I_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,u.pixelToTileUnitsFactor),ae=this.paint.get("fill-extrusion-height").evaluate(s,c),ce=this.paint.get("fill-extrusion-base").evaluate(s,c),fe=[0,0],ye=D&&T.elevation,_t=T.elevation?T.elevation.exaggeration():1,St=u.tile.getBucket(this);if(ye&&St instanceof Wp){const Tt=St.centroidVertexArray,Wt=W+1;Wt<Tt.length&&(fe[0]=Tt.geta_centroid_pos0(Wt),fe[1]=Tt.geta_centroid_pos1(Wt))}if(fe[0]===0&&fe[1]===1)return!1;T.projection.name==="globe"&&(g=Ny([g],[new rr(0,0),new rr(Fr,Fr)],u.tileID.canonical).map(Tt=>Tt.polygon).flat());const Pt=ye?D:null,[zt,Kt]=function(Tt,Wt,ti,ci,ki,Ci,Di,Vi,Qi,br,hr){return Tt.projection.name==="globe"?function(xr,Sr,tr,yr,Yi,er,Cr,Lr,an,Yr,zr){const Ar=[],vn=[],Zr=xr.projection.upVectorScale(zr,xr.center.lat,xr.worldSize).metersToTile,Kr=[0,0,0,1],mn=[0,0,0,1],Tn=(Rn,Mn,Ln,os)=>{Rn[0]=Mn,Rn[1]=Ln,Rn[2]=os,Rn[3]=1},bn=By();tr>0&&(tr+=bn),yr+=bn;for(const Rn of Sr){const Mn=[],Ln=[];for(const os of Rn){const Ts=os.x+Yi.x,ai=os.y+Yi.y,hi=xr.projection.projectTilePoint(Ts,ai,zr),sr=xr.projection.upVector(zr,os.x,os.y);let Dr=tr,Br=yr;if(Cr){const Or=qy(Ts,ai,tr,yr,Cr,Lr,an,Yr);Dr+=Or.base,Br+=Or.top}tr!==0?Tn(Kr,hi.x+sr[0]*Zr*Dr,hi.y+sr[1]*Zr*Dr,hi.z+sr[2]*Zr*Dr):Tn(Kr,hi.x,hi.y,hi.z),Tn(mn,hi.x+sr[0]*Zr*Br,hi.y+sr[1]*Zr*Br,hi.z+sr[2]*Zr*Br),oi(Kr,Kr,er),oi(mn,mn,er),Mn.push(new bu(Kr[0],Kr[1],Kr[2])),Ln.push(new bu(mn[0],mn[1],mn[2]))}Ar.push(Mn),vn.push(Ln)}return[Ar,vn]}(Tt,Wt,ti,ci,ki,Ci,Di,Vi,Qi,br,hr):Di?function(xr,Sr,tr,yr,Yi,er,Cr,Lr,an){const Yr=[],zr=[],Ar=[0,0,0,1];for(const vn of xr){const Zr=[],Kr=[];for(const mn of vn){const Tn=mn.x+yr.x,bn=mn.y+yr.y,Rn=qy(Tn,bn,Sr,tr,er,Cr,Lr,an);Ar[0]=Tn,Ar[1]=bn,Ar[2]=Rn.base,Ar[3]=1,Hi(Ar,Ar,Yi),Ar[3]=Math.max(Ar[3],1e-5);const Mn=new bu(Ar[0]/Ar[3],Ar[1]/Ar[3],Ar[2]/Ar[3]);Ar[0]=Tn,Ar[1]=bn,Ar[2]=Rn.top,Ar[3]=1,Hi(Ar,Ar,Yi),Ar[3]=Math.max(Ar[3],1e-5);const Ln=new bu(Ar[0]/Ar[3],Ar[1]/Ar[3],Ar[2]/Ar[3]);Zr.push(Mn),Kr.push(Ln)}Yr.push(Zr),zr.push(Kr)}return[Yr,zr]}(Wt,ti,ci,ki,Ci,Di,Vi,Qi,br):function(xr,Sr,tr,yr,Yi){const er=[],Cr=[],Lr=Yi[8]*Sr,an=Yi[9]*Sr,Yr=Yi[10]*Sr,zr=Yi[11]*Sr,Ar=Yi[8]*tr,vn=Yi[9]*tr,Zr=Yi[10]*tr,Kr=Yi[11]*tr;for(const mn of xr){const Tn=[],bn=[];for(const Rn of mn){const Mn=Rn.x+yr.x,Ln=Rn.y+yr.y,os=Yi[0]*Mn+Yi[4]*Ln+Yi[12],Ts=Yi[1]*Mn+Yi[5]*Ln+Yi[13],ai=Yi[2]*Mn+Yi[6]*Ln+Yi[14],hi=Yi[3]*Mn+Yi[7]*Ln+Yi[15],sr=os+Lr,Dr=Ts+an,Br=ai+Yr,Or=Math.max(hi+zr,1e-5),Xr=os+Ar,dn=Ts+vn,On=ai+Zr,zn=Math.max(hi+Kr,1e-5);Tn.push(new bu(sr/Or,Dr/Or,Br/Or)),bn.push(new bu(Xr/zn,dn/zn,On/zn))}er.push(Tn),Cr.push(bn)}return[er,Cr]}(Wt,ti,ci,ki,Ci)}(T,g,ce,ae,X,E,Pt,fe,_t,T.center.lat,u.tileID.canonical),Qt=u.queryGeometry;return function(Tt,Wt,ti){let ci=1/0;ca(ti,Wt)&&(ci=Wy(ti,Wt[0]));for(let ki=0;ki<Wt.length;ki++){const Ci=Wt[ki],Di=Tt[ki];for(let Vi=0;Vi<Ci.length-1;Vi++){const Qi=Ci[Vi],br=[Qi,Ci[Vi+1],Di[Vi+1],Di[Vi],Qi];Fo(ti,br)&&(ci=Math.min(ci,Wy(ti,br)))}}return ci!==1/0&&ci}(zt,Kt,Qt.isPointQuery()?Qt.screenBounds:Qt.screenGeometry)}},building:class extends To{constructor(u,s,c,g){super(u,{layout:sv||(sv=new Us({visibility:new Mr(Gi.layout_building.visibility),"building-roof-shape":new $r(Gi.layout_building["building-roof-shape"]),"building-height":new $r(Gi.layout_building["building-height"]),"building-base":new $r(Gi.layout_building["building-base"])})),paint:ov||(ov=new Us({"building-opacity":new Mr(Gi.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Mr(Gi.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Mr(Gi.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Mr(Gi.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Mr(Gi.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Mr(Gi.paint_building["building-vertical-scale"]),"building-cast-shadows":new Mr(Gi.paint_building["building-cast-shadows"]),"building-color":new $r(Gi.paint_building["building-color"]),"building-emissive-strength":new $r(Gi.paint_building["building-emissive-strength"]),"building-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new nv(u)}},line:class extends To{constructor(u,s,c,g){const y=gv();super(u,y,s,c,g),y.layout&&(this.layout=new Ml(y.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof jc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,s){super.recalculate(u,s),this.paint._values["line-floorwidth"]=(()=>{if(dd)return dd;const c=gv();return dd=new zb(c.paint.properties["line-width"].specification),dd.useIntegerZoom=!0,dd})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Ng(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,s,c){const g=pv(this);return{config:new fc(this,{zoom:s,lut:c}),defines:g,overrideFog:!1}}queryRadius(u){const s=u,c=_v(Ph("line-width",this,s),Ph("line-gap-width",this,s)),g=Ph("line-offset",this,s);return c/2+Math.abs(g)+kp(this.paint.get("line-translate"))}queryIntersectsFeature(u,s,c,g,y,T){if(u.queryGeometry.isAboveHorizon)return!1;const E=P_(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,u.pixelToTileUnitsFactor),D=u.pixelToTileUnitsFactor/2*_v(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),W=this.paint.get("line-offset").evaluate(s,c);return W&&(g=function(X,ae){const ce=[],fe=new rr(0,0);for(let ye=0;ye<X.length;ye++){const _t=X[ye],St=[];for(let Pt=0;Pt<_t.length;Pt++){const zt=_t[Pt],Kt=_t[Pt+1],Qt=Pt===0?fe:zt.sub(_t[Pt-1])._unit()._perp(),Tt=Pt===_t.length-1?fe:Kt.sub(zt)._unit()._perp(),Wt=Qt._add(Tt)._unit();Wt._mult(1/(Wt.x*Tt.x+Wt.y*Tt.y)),St.push(Wt._mult(ae)._add(zt))}ce.push(St)}return ce}(g,W*u.pixelToTileUnitsFactor)),function(X,ae,ce){for(let fe=0;fe<ae.length;fe++){const ye=ae[fe];if(X.length>=3){for(let _t=0;_t<ye.length;_t++)if(_a(X,ye[_t]))return!0}if(tl(X,ye,ce))return!0}return!1}(E,g,D)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:dm,background:class extends To{constructor(u,s,c,g){super(u,{layout:a0||(a0=new Us({visibility:new Mr(Gi.layout_background.visibility)})),paint:l0||(l0=new Us({"background-pitch-alignment":new Mr(Gi.paint_background["background-pitch-alignment"]),"background-color":new Mr(Gi.paint_background["background-color"]),"background-pattern":new Mr(Gi.paint_background["background-pattern"]),"background-opacity":new Mr(Gi.paint_background["background-opacity"]),"background-emissive-strength":new Mr(Gi.paint_background["background-emissive-strength"]),"background-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,s,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:d0,"raster-particle":v0,sky:class extends To{constructor(u,s,c,g){super(u,{layout:g0||(g0=new Us({visibility:new Mr(Gi.layout_sky.visibility)})),paint:_0||(_0=new Us({"sky-type":new Mr(Gi.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mr(Gi.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mr(Gi.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mr(Gi.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mr(Gi.paint_sky["sky-gradient-radius"]),"sky-gradient":new Al(Gi.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mr(Gi.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mr(Gi.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mr(Gi.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(u,s){if(this.paint.get("sky-type")==="atmosphere"){const g=this.paint.get("sky-atmosphere-sun"),y=!g,T=u.style.light,E=T.properties.get("position");return y&&T.properties.get("anchor")==="viewport"&&yn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),y?l_(E.azimuthal,90-E.polar,s):l_(g[0],90-g[1],s)}const c=this.paint.get("sky-gradient-center");return l_(c[0],90-c[1],s)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends To{constructor(u,s,c,g){super(u,{paint:y0||(y0=new Us({}))},s,null)}},model:class extends To{constructor(u,s,c,g){super(u,{layout:C0||(C0=new Us({visibility:new Mr(Gi.layout_model.visibility),"model-id":new $r(Gi.layout_model["model-id"])})),paint:P0||(P0=new Us({"model-opacity":new $r(Gi.paint_model["model-opacity"]),"model-rotation":new $r(Gi.paint_model["model-rotation"]),"model-scale":new $r(Gi.paint_model["model-scale"]),"model-translation":new $r(Gi.paint_model["model-translation"]),"model-color":new $r(Gi.paint_model["model-color"]),"model-color-mix-intensity":new $r(Gi.paint_model["model-color-mix-intensity"]),"model-type":new Mr(Gi.paint_model["model-type"]),"model-cast-shadows":new Mr(Gi.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mr(Gi.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mr(Gi.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $r(Gi.paint_model["model-emissive-strength"]),"model-roughness":new $r(Gi.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $r(Gi.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mr(Gi.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mr(Gi.paint_model["model-front-cutoff"]),"model-color-use-theme":new $r({type:"string",default:"default","property-type":"data-driven"})}))},s,c,g),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new f_(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof bm?Fr-1:0}queryIntersectsFeature(u,s,c,g,y,T){if(!this.modelManager)return!1;const E=this.modelManager,D=u.tile.getBucket(this);if(!(D&&D instanceof f_))return!1;for(const W in D.instancesPerModel){const X=D.instancesPerModel[W],ae=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(X.idToFeaturesIndex.hasOwnProperty(ae)){const ce=X.features[X.idToFeaturesIndex[ae]],fe=E.getModel(W,this.scope);if(!fe)return!1;let ye=Y();const _t=new qt(0,0),St=D.canonical;let Pt=Number.MAX_VALUE;for(let zt=0;zt<ce.instancedDataCount;++zt){const Kt=16*(ce.instancedDataOffset+zt),Qt=X.instancedDataArray.float32,Tt=[Qt[Kt+4],Qt[Kt+5],Qt[Kt+6]];F0(St,_t,Qt[Kt],0|Qt[Kt+1]),I0(ye,fe,T,_t,ce.rotation,ce.scale,Tt,!1,!1,!1),T.projection.name==="globe"&&(ye=u_(ye,T));const Wt=ne([],T.projMatrix,ye),ti=u.queryGeometry,ci=T0(ti.isPointQuery()?ti.screenBounds:ti.screenGeometry,T,Wt,fe.aabb);ci!=null&&(Pt=Math.min(ci,Pt))}return Pt!==Number.MAX_VALUE&&Pt}}return!1}_handleOverridablePaintPropertyUpdate(u,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const s=this._transitionablePaint._values[u];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof Qc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends To{constructor(u,s,c,g){super(u,{layout:my||(my=new Us({"clip-layer-types":new Mr(Gi.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mr(Gi.layout_clip["clip-layer-scope"])})),paint:gy||(gy=new Us({}))},s,c,g)}recalculate(u,s){super.recalculate(u,s)}createBucket(u){return new yy(u)}is3D(u){return!0}}},g_=new rs(0,0,0),__={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},y_={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},wm={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},$1={PAINT_ORDER_FILL_AND_STROKE:1},Md={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},O0={MASK_TYPE_LUMINANCE:1};function U1(u,s,c){u===1&&s.icons.push(function(g,y){return function(T){if(T.usvg_tree.height||(T.usvg_tree.height=T.usvg_tree.width),!T.metadata)return T;const{metadata:E}=T;if(E.content_area){const{content_area:D}=E;D.top==null&&(D.top=D.left),D.width==null&&(D.width=T.usvg_tree.width),D.height==null&&(D.height=D.width)}return E.stretch_x&&E.stretch_x.length&&z0(E,"x"),E.stretch_y&&E.stretch_y.length&&z0(E,"y"),T}(g.readFields(G1,{name:void 0},y))}(c,c.readVarint()+c.pos))}function z0(u,s){const c=[],g=u[`stretch_${s}`];let y=null;for(let T=0;T<g.length;T++)y===null?y=c.length===0?g[0]:c[c.length-1][1]+g[T]:(c.push([y,y+g[T]]),y=null);u[`stretch_${s}_areas`]=c}function G1(u,s,c){u===1?s.name=c.readString():u===2?s.metadata=function(g,y){return g.readFields(H1,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},y)}(c,c.readVarint()+c.pos):u===3&&(s.usvg_tree=function(g,y){return g.readFields(q1,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},y)}(c,c.readVarint()+c.pos),s.data="usvg_tree")}function H1(u,s,c){u===1?s.stretch_x=c.readPackedVarint():u===2?s.stretch_y=c.readPackedVarint():u===3?s.content_area=function(g,y){return g.readFields(j1,{left:0},y)}(c,c.readVarint()+c.pos):u===4&&s.variables.push(function(g,y){return g.readFields(W1,{name:void 0},y)}(c,c.readVarint()+c.pos))}function j1(u,s,c){u===1?s.left=c.readVarint():u===2?s.width=c.readVarint():u===3?s.top=c.readVarint():u===4&&(s.height=c.readVarint())}function W1(u,s,c){u===1?s.name=c.readString():u===2&&(s.rgb_color=Em(c.readVarint()),s.value="rgb_color")}function q1(u,s,c){u===1?s.width=s.height=c.readVarint():u===2?s.height=c.readVarint():u===3?s.children.push(Sm(c,c.readVarint()+c.pos)):u===4?s.linear_gradients.push(function(g,y){return g.readFields(ew,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},y)}(c,c.readVarint()+c.pos)):u===5?s.radial_gradients.push(function(g,y){return g.readFields(iw,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},y)}(c,c.readVarint()+c.pos)):u===7?s.clip_paths.push(function(g,y){return g.readFields(rw,{children:[]},y)}(c,c.readVarint()+c.pos)):u===8&&s.masks.push(function(g,y){const T=g.readFields(nw,{left:0,width:20,mask_type:O0.MASK_TYPE_LUMINANCE,children:[]},y);return T.height==null&&(T.height=T.width),T.top==null&&(T.top=T.left),T}(c,c.readVarint()+c.pos))}function Sm(u,s){return u.readFields(X1,{},s)}function X1(u,s,c){u===1?(s.group=function(g,y){return g.readFields(Z1,{opacity:255,children:[]},y)}(c,c.readVarint()+c.pos),s.node="group"):u===2&&(s.path=function(g,y){return g.readFields(K1,{paint_order:1,commands:[],step:1,diffs:[],rule:__.PATH_RULE_NON_ZERO},y)}(c,c.readVarint()+c.pos),s.node="path")}function Z1(u,s,c){u===1?s.transform=Tm(c,c.readVarint()+c.pos):u===2?s.opacity=c.readVarint():u===5?s.clip_path_idx=c.readVarint():u===6?s.mask_idx=c.readVarint():u===7&&s.children.push(Sm(c,c.readVarint()+c.pos))}function Tm(u,s){return u.readFields(Y1,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function Y1(u,s,c){u===1?s.sx=c.readFloat():u===2?s.ky=c.readFloat():u===3?s.kx=c.readFloat():u===4?s.sy=c.readFloat():u===5?s.tx=c.readFloat():u===6&&(s.ty=c.readFloat())}function K1(u,s,c){u===1?s.fill=function(g,y){return g.readFields(J1,{rgb_color:g_,paint:"rgb_color",opacity:255},y)}(c,c.readVarint()+c.pos):u===2?s.stroke=function(g,y){return g.readFields(Q1,{rgb_color:g_,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},y)}(c,c.readVarint()+c.pos):u===3?s.paint_order=c.readVarint():u===5?c.readPackedVarint(s.commands):u===6?s.step=c.readFloat():u===7?c.readPackedSVarint(s.diffs):u===8&&(s.rule=c.readVarint())}function J1(u,s,c){u===1?(s.rgb_color=Em(c.readVarint()),s.paint="rgb_color"):u===2?(s.linear_gradient_idx=c.readVarint(),s.paint="linear_gradient_idx"):u===3?(s.radial_gradient_idx=c.readVarint(),s.paint="radial_gradient_idx"):u===5&&(s.opacity=c.readVarint())}function Em(u){return new rs((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function Q1(u,s,c){u===1?(s.rgb_color=Em(c.readVarint()),s.paint="rgb_color"):u===2?(s.linear_gradient_idx=c.readVarint(),s.paint="linear_gradient_idx"):u===3?(s.radial_gradient_idx=c.readVarint(),s.paint="radial_gradient_idx"):u===5?c.readPackedFloat(s.dasharray):u===6?s.dashoffset=c.readFloat():u===7?s.miterlimit=c.readFloat():u===8?s.opacity=c.readVarint():u===9?s.width=c.readFloat():u===10?s.linecap=c.readVarint():u===11&&(s.linejoin=c.readVarint())}function ew(u,s,c){u===1?s.transform=Tm(c,c.readVarint()+c.pos):u===2?s.spread_method=c.readVarint():u===3?s.stops.push(B0(c,c.readVarint()+c.pos)):u===4?s.x1=c.readFloat():u===5?s.y1=c.readFloat():u===6?s.x2=c.readFloat():u===7&&(s.y2=c.readFloat())}function B0(u,s){return u.readFields(tw,{offset:0,opacity:255,rgb_color:g_},s)}function tw(u,s,c){u===1?s.offset=c.readFloat():u===2?s.opacity=c.readVarint():u===3&&(s.rgb_color=Em(c.readVarint()))}function iw(u,s,c){u===1?s.transform=Tm(c,c.readVarint()+c.pos):u===2?s.spread_method=c.readVarint():u===3?s.stops.push(B0(c,c.readVarint()+c.pos)):u===4?s.cx=c.readFloat():u===5?s.cy=c.readFloat():u===6?s.r=c.readFloat():u===7?s.fx=c.readFloat():u===8?s.fy=c.readFloat():u===9&&(s.fr=c.readFloat())}function rw(u,s,c){u===1?s.transform=Tm(c,c.readVarint()+c.pos):u===2?s.clip_path_idx=c.readVarint():u===3&&s.children.push(Sm(c,c.readVarint()+c.pos))}function nw(u,s,c){u===1?s.left=s.top=c.readFloat():u===2?s.width=s.height=c.readFloat():u===3?s.top=c.readFloat():u===4?s.height=c.readFloat():u===5?s.mask_type=c.readVarint():u===6?s.mask_idx=c.readVarint():u===7&&s.children.push(Sm(c,c.readVarint()+c.pos))}class sw{static calculate(s={},c=[]){const g=new Map,y=new Map;if(Object.keys(s).length===0)return g;c.forEach(T=>{y.set(T.name,T.rgb_color||new rs(0,0,0))});for(const[T,E]of Object.entries(s))y.has(T)?g.set(y.get(T).toString(),E):console.warn(`Ignoring unknown image variable "${T}"`);return g}}function Uh(u,s=255,c){const g=s/255,y=u.toString(),T=c.has(y)?c.get(y).clone():u.clone();return T.a*=g,T.toString()}function Ad(u,s){if(!Ru()){const c=document.createElement("canvas");return c.width=u,c.height=s,c}return new OffscreenCanvas(u,s)}function ow(u,s){const c=sw.calculate(s.params,u.metadata?u.metadata.variables:[]),g=u.usvg_tree,y=g.width,T=g.height,E=s.transform?s.transform:new DOMMatrix,D=Math.max(1,Math.round(y*E.a)),W=Math.max(1,Math.round(T*E.d)),X=new DOMMatrix([D/y,0,0,W/T,0,0]),ae=Ad(D,W).getContext("2d");return v_(ae,X,g,g,c),ae.getImageData(0,0,D,W)}function v_(u,s,c,g,y){for(const T of g.children)N0(u,s,c,T,y)}function N0(u,s,c,g,y){g.group?(u.save(),function(T,E,D,W,X){const ae=W.mask_idx!=null?D.masks[W.mask_idx]:null,ce=W.clip_path_idx!=null?D.clip_paths[W.clip_path_idx]:null;if(W.transform&&(E=Gh(W.transform).preMultiplySelf(E)),!function(_t,St,Pt){return _t.opacity!==255||St||Pt}(W,ce!=null,ae!=null))return void v_(T,E,D,W,X);const fe=Ad(T.canvas.width,T.canvas.height),ye=fe.getContext("2d");v_(ye,E,D,W,X),ce&&W0(ye,E,D,ce),ae&&q0(ye,E,D,ae,X),T.globalAlpha=W.opacity/255,T.drawImage(fe,0,0)}(u,s,c,g.group,y),u.restore()):g.path&&(u.save(),function(T,E,D,W,X){T.setTransform(E),W.paint_order===$1.PAINT_ORDER_FILL_AND_STROKE?(V0(T,D,W,X),U0(T,D,W,X)):(U0(T,D,W,X),V0(T,D,W,X))}(u,s,c,g.path,y),u.restore())}function V0(u,s,c,g){const y=c.fill;if(!y)return;const T=y.opacity/255;switch(u.save(),u.beginPath(),X0(c,u),y.paint){case"rgb_color":u.fillStyle=Uh(y.rgb_color,y.opacity,g);break;case"linear_gradient_idx":{const E=s.linear_gradients[y.linear_gradient_idx];E.transform&&u.setTransform(Gh(E.transform).preMultiplySelf(u.getTransform())),u.fillStyle=G0(u,E,T,g);break}case"radial_gradient_idx":{const E=s.radial_gradients[y.radial_gradient_idx];E.transform&&u.setTransform(Gh(E.transform).preMultiplySelf(u.getTransform())),u.fillStyle=H0(u,E,T,g)}}u.fill($0(c)),u.restore()}function $0(u){return u.rule===__.PATH_RULE_NON_ZERO?"nonzero":u.rule===__.PATH_RULE_EVEN_ODD?"evenodd":void 0}function U0(u,s,c,g){const y=c.stroke;if(!y)return;const T=Z0(c);u.lineWidth=y.width,u.miterLimit=y.miterlimit,u.setLineDash(y.dasharray),u.lineDashOffset=y.dashoffset;const E=y.opacity/255;switch(y.paint){case"rgb_color":u.strokeStyle=Uh(y.rgb_color,y.opacity,g);break;case"linear_gradient_idx":u.strokeStyle=G0(u,s.linear_gradients[y.linear_gradient_idx],E,g,!0);break;case"radial_gradient_idx":u.strokeStyle=H0(u,s.radial_gradients[y.radial_gradient_idx],E,g,!0)}switch(y.linejoin){case wm.LINE_JOIN_MITER_CLIP:case wm.LINE_JOIN_MITER:u.lineJoin="miter";break;case wm.LINE_JOIN_ROUND:u.lineJoin="round";break;case wm.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(y.linecap){case y_.LINE_CAP_BUTT:u.lineCap="butt";break;case y_.LINE_CAP_ROUND:u.lineCap="round";break;case y_.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(T)}function G0(u,s,c,g,y=!1){if(s.stops.length===1){const fe=s.stops[0];return Uh(fe.rgb_color,fe.opacity*c,g)}const{x1:T,y1:E,x2:D,y2:W}=s;let X=new DOMPoint(T,E),ae=new DOMPoint(D,W);if(y){const fe=Gh(s.transform);X=fe.transformPoint(X),ae=fe.transformPoint(ae)}const ce=u.createLinearGradient(X.x,X.y,ae.x,ae.y);for(const fe of s.stops)ce.addColorStop(fe.offset,Uh(fe.rgb_color,fe.opacity*c,g));return ce}function H0(u,s,c,g,y=!1){if(s.stops.length===1){const zt=s.stops[0];return Uh(zt.rgb_color,zt.opacity*c,g)}const T=Gh(s.transform),{fx:E,fy:D,fr:W,cx:X,cy:ae,r:ce}=s;let fe=new DOMPoint(E,D),ye=new DOMPoint(X,ae),_t=W,St=ce;if(y){fe=T.transformPoint(fe),ye=T.transformPoint(ye);const zt=(T.a+T.d)/2;_t=W*zt,St=s.r*zt}const Pt=u.createRadialGradient(fe.x,fe.y,_t,ye.x,ye.y,St);for(const zt of s.stops)Pt.addColorStop(zt.offset,Uh(zt.rgb_color,zt.opacity*c,g));return Pt}function j0(u,s,c,g){const y=g.transform?Gh(g.transform).preMultiplySelf(s):s,T=Ad(u.canvas.width,u.canvas.height),E=T.getContext("2d");for(const W of g.children)if(W.group)j0(E,y,c,W.group);else if(W.path){const X=W.path,ae=new Path2D;ae.addPath(Z0(X),y),E.fill(ae,$0(X))}const D=g.clip_path_idx!=null?c.clip_paths[g.clip_path_idx]:null;D&&W0(E,y,c,D),u.globalCompositeOperation="source-over",u.drawImage(T,0,0)}function W0(u,s,c,g){const y=Ad(u.canvas.width,u.canvas.height);j0(y.getContext("2d"),s,c,g),u.globalCompositeOperation="destination-in",u.drawImage(y,0,0)}function q0(u,s,c,g,y){if(g.children.length===0)return;const T=g.mask_idx!=null?c.masks[g.mask_idx]:null;T&&q0(u,s,c,T,y);const E=u.canvas.width,D=u.canvas.height,W=Ad(E,D),X=W.getContext("2d"),ae=g.width,ce=g.height,fe=g.left,ye=g.top,_t=new Path2D,St=new Path2D;St.rect(fe,ye,ae,ce),_t.addPath(St,s),X.clip(_t);for(const Kt of g.children)N0(X,s,c,Kt,y);const Pt=X.getImageData(0,0,E,D),zt=Pt.data;if(g.mask_type===O0.MASK_TYPE_LUMINANCE)for(let Kt=0;Kt<zt.length;Kt+=4)zt[Kt+3]=zt[Kt+3]/255*(.2126*zt[Kt]+.7152*zt[Kt+1]+.0722*zt[Kt+2]);X.putImageData(Pt,0,0),u.globalCompositeOperation="destination-in",u.drawImage(W,0,0)}function Gh(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function X0(u,s){const c=u.step;let g=u.diffs[0]*c,y=u.diffs[1]*c;s.moveTo(g,y);for(let T=0,E=2;T<u.commands.length;T++)switch(u.commands[T]){case Md.PATH_COMMAND_MOVE:g+=u.diffs[E++]*c,y+=u.diffs[E++]*c,s.moveTo(g,y);break;case Md.PATH_COMMAND_LINE:g+=u.diffs[E++]*c,y+=u.diffs[E++]*c,s.lineTo(g,y);break;case Md.PATH_COMMAND_QUAD:{const D=g+u.diffs[E++]*c,W=y+u.diffs[E++]*c;g=D+u.diffs[E++]*c,y=W+u.diffs[E++]*c,s.quadraticCurveTo(D,W,g,y);break}case Md.PATH_COMMAND_CUBIC:{const D=g+u.diffs[E++]*c,W=y+u.diffs[E++]*c,X=D+u.diffs[E++]*c,ae=W+u.diffs[E++]*c;g=X+u.diffs[E++]*c,y=ae+u.diffs[E++]*c,s.bezierCurveTo(D,W,X,ae,g,y);break}case Md.PATH_COMMAND_CLOSE:s.closePath()}return s}function Z0(u){return X0(u,new Path2D)}class Mm{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const c=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,c),c}put(s,c){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,c)}delete(s){this.cache.delete(s)}}jr(Mm,"LRUCache");class x_{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new vo(s,s.data)}getFromCache(s,c,g){return this.cacheMap.has(g)||this.cacheMap.set(g,new Mm(150)),this.cacheMap.get(g).get(Cl(s.toString(),c))}setInCache(s,c,g,y){this.cacheDependenciesMap.has(y)||this.cacheDependenciesMap.set(y,new Map),this.cacheMap.has(y)||this.cacheMap.set(y,new Mm(150));const T=this.cacheDependenciesMap.get(y),E=Cl(s.id.toString(),g);T.get(E)||T.set(E,new Set);const D=this.cacheMap.get(y),W=s.toString();T.get(E).add(W),D.put(Cl(s.toString(),g),c)}removeImagesFromCacheByIds(s,c,g=0){if(!this.cacheMap.has(g)||!this.cacheDependenciesMap.has(g))return;const y=this.cacheMap.get(g),T=this.cacheDependenciesMap.get(g);for(const E of s){const D=Cl(E.toString(),c);if(T.has(D)){for(const W of T.get(D))y.delete(W);T.delete(D)}}}rasterize(s,c,g,y,T=ow){const E=this.getFromCache(s,g,y);if(E)return E.clone();const D=T(c.icon,s.options),W=x_._getImage(D);return this.setInCache(s,W,g,y),W.clone()}}class Y0{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,c){const g=this.toIdx(s,c);return{min:this.minimums[g],max:this.maximums[g]}}isLeaf(s,c){return this.leaves[this.toIdx(s,c)]}toIdx(s,c){return c*this.size+s}}function K0(u,s,c,g){let y=0,T=Number.MAX_VALUE;for(let E=0;E<3;E++)if(Math.abs(g[E])<1e-15){if(c[E]<u[E]||c[E]>s[E])return null}else{const D=1/g[E];let W=(u[E]-c[E])*D,X=(s[E]-c[E])*D;if(W>X){const ae=W;W=X,X=ae}if(W>y&&(y=W),X<T&&(T=X),y>T)return null}return y}function J0(u,s,c,g,y,T,E,D,W,X,ae){const ce=g-u,fe=y-s,ye=T-c,_t=E-u,St=D-s,Pt=W-c,zt=ae[1]*Pt-ae[2]*St,Kt=ae[2]*_t-ae[0]*Pt,Qt=ae[0]*St-ae[1]*_t,Tt=ce*zt+fe*Kt+ye*Qt;if(Math.abs(Tt)<1e-15)return null;const Wt=1/Tt,ti=X[0]-u,ci=X[1]-s,ki=X[2]-c,Ci=(ti*zt+ci*Kt+ki*Qt)*Wt;if(Ci<0||Ci>1)return null;const Di=ci*ye-ki*fe,Vi=ki*ce-ti*ye,Qi=ti*fe-ci*ce,br=(ae[0]*Di+ae[1]*Vi+ae[2]*Qi)*Wt;return br<0||Ci+br>1?null:(_t*Di+St*Vi+Pt*Qi)*Wt}function Q0(u,s,c){return(u-s)/(c-s)}function ex(u,s,c,g,y,T,E,D,W){const X=1<<c,ae=T-g,ce=E-y,fe=(u+1)/X*ae+g,ye=(s+0)/X*ce+y,_t=(s+1)/X*ce+y;D[0]=(u+0)/X*ae+g,D[1]=ye,W[0]=fe,W[1]=_t}class tx{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(T){const E=Math.ceil(Math.log2(T.dim/8)),D=[];let W=Math.ceil(Math.pow(2,E));const X=1/W,ae=(ye,_t,St,Pt,zt)=>{const Kt=Pt?1:0,Qt=(ye+1)*St-Kt,Tt=_t*St,Wt=(_t+1)*St-Kt;zt[0]=ye*St,zt[1]=Tt,zt[2]=Qt,zt[3]=Wt};let ce=new Y0(W);const fe=[];for(let ye=0;ye<W*W;ye++){ae(ye%W,Math.floor(ye/W),X,!1,fe);const _t=bc(fe[0],fe[1],T),St=bc(fe[2],fe[1],T),Pt=bc(fe[2],fe[3],T),zt=bc(fe[0],fe[3],T);ce.minimums.push(Math.min(_t,St,Pt,zt)),ce.maximums.push(Math.max(_t,St,Pt,zt)),ce.leaves.push(1)}for(D.push(ce),W/=2;W>=1;W/=2){const ye=D[D.length-1];ce=new Y0(W);for(let _t=0;_t<W*W;_t++){ae(_t%W,Math.floor(_t/W),2,!0,fe);const St=ye.getElevation(fe[0],fe[1]),Pt=ye.getElevation(fe[2],fe[1]),zt=ye.getElevation(fe[2],fe[3]),Kt=ye.getElevation(fe[0],fe[3]),Qt=ye.isLeaf(fe[0],fe[1]),Tt=ye.isLeaf(fe[2],fe[1]),Wt=ye.isLeaf(fe[2],fe[3]),ti=ye.isLeaf(fe[0],fe[3]),ci=Math.min(St.min,Pt.min,zt.min,Kt.min),ki=Math.max(St.max,Pt.max,zt.max,Kt.max),Ci=Qt&&Tt&&Wt&&ti;ce.maximums.push(ki),ce.minimums.push(ci),ce.leaves.push(ki-ci<=5&&Ci?1:0)}D.push(ce)}return D}(this.dem),g=c.length-1,y=c[g];this._addNode(y.minimums[0],y.maximums[0],y.leaves[0]),this._construct(c,0,0,g,0)}raycastRoot(s,c,g,y,T,E,D=1){return K0([s,c,-100],[g,y,this.maximums[0]*D],T,E)}raycast(s,c,g,y,T,E,D=1){if(!this.nodeCount)return null;const W=this.raycastRoot(s,c,g,y,T,E,D);if(W==null)return null;const X=[],ae=[],ce=[],fe=[],ye=[{idx:0,t:W,nodex:0,nodey:0,depth:0}];for(;ye.length>0;){const{idx:_t,t:St,nodex:Pt,nodey:zt,depth:Kt}=ye.pop();if(this.leaves[_t]){ex(Pt,zt,Kt,s,c,g,y,ce,fe);const Tt=1<<Kt,Wt=(Pt+0)/Tt,ti=(Pt+1)/Tt,ci=(zt+0)/Tt,ki=(zt+1)/Tt,Ci=bc(Wt,ci,this.dem)*D,Di=bc(ti,ci,this.dem)*D,Vi=bc(ti,ki,this.dem)*D,Qi=bc(Wt,ki,this.dem)*D,br=J0(ce[0],ce[1],Ci,fe[0],ce[1],Di,fe[0],fe[1],Vi,T,E),hr=J0(fe[0],fe[1],Vi,ce[0],fe[1],Qi,ce[0],ce[1],Ci,T,E),xr=Math.min(br!==null?br:Number.MAX_VALUE,hr!==null?hr:Number.MAX_VALUE);if(xr!==Number.MAX_VALUE)return xr;{const Sr=mi([],T,E,St);if(ix(Ci,Di,Qi,Vi,Q0(Sr[0],ce[0],fe[0]),Q0(Sr[1],ce[1],fe[1]))>=Sr[2])return St}continue}let Qt=0;for(let Tt=0;Tt<this._siblingOffset.length;Tt++){ex((Pt<<1)+this._siblingOffset[Tt][0],(zt<<1)+this._siblingOffset[Tt][1],Kt+1,s,c,g,y,ce,fe),ce[2]=-100,fe[2]=this.maximums[this.childOffsets[_t]+Tt]*D;const Wt=K0(ce,fe,T,E);if(Wt!=null){const ti=Wt;X[Tt]=ti;let ci=!1;for(let ki=0;ki<Qt&&!ci;ki++)ti>=X[ae[ki]]&&(ae.splice(ki,0,Tt),ci=!0);ci||(ae[Qt]=Tt),Qt++}}for(let Tt=0;Tt<Qt;Tt++){const Wt=ae[Tt];ye.push({idx:this.childOffsets[_t]+Wt,t:X[Wt],nodex:(Pt<<1)+this._siblingOffset[Wt][0],nodey:(zt<<1)+this._siblingOffset[Wt][1],depth:Kt+1})}}return null}_addNode(s,c,g){return this.minimums.push(s),this.maximums.push(c),this.leaves.push(g),this.childOffsets.push(0),this.nodeCount++}_construct(s,c,g,y,T){if(s[y].isLeaf(c,g)===1)return;this.childOffsets[T]||(this.childOffsets[T]=this.nodeCount);const E=y-1,D=s[E];let W=0,X=0;for(let ae=0;ae<this._siblingOffset.length;ae++){const ce=2*c+this._siblingOffset[ae][0],fe=2*g+this._siblingOffset[ae][1],ye=D.getElevation(ce,fe),_t=D.isLeaf(ce,fe),St=this._addNode(ye.min,ye.max,_t);_t&&(W|=1<<ae),X||(X=St)}for(let ae=0;ae<this._siblingOffset.length;ae++)W&1<<ae||this._construct(s,2*c+this._siblingOffset[ae][0],2*g+this._siblingOffset[ae][1],E,X+ae)}}function ix(u,s,c,g,y,T){return pn(pn(u,c,T),pn(s,g,T),y)}function bc(u,s,c){const g=c.dim,y=Jt(u*g-.5,0,g-1),T=Jt(s*g-.5,0,g-1),E=Math.floor(y),D=Math.floor(T),W=Math.min(E+1,g-1),X=Math.min(D+1,g-1);return ix(c.get(E,D),c.get(W,D),c.get(E,X),c.get(W,X),y-E,T-D)}const aw={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lw(u,s,c){return(256*u*256+256*s+c)/10-1e4}function cw(u,s,c){return 256*u+s+c/256-32768}class Am{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,c,g,y=!1){if(this.uid=s,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(g&&g!=="mapbox"&&g!=="terrarium")return void yn(`"${g}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const T=this.dim=c.height-2,E=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=y,this._modifiedForSources={},!y){for(let W=0;W<T;W++)E[this._idx(-1,W)]=E[this._idx(0,W)],E[this._idx(T,W)]=E[this._idx(T-1,W)],E[this._idx(W,-1)]=E[this._idx(W,0)],E[this._idx(W,T)]=E[this._idx(W,T-1)];E[this._idx(-1,-1)]=E[this._idx(0,0)],E[this._idx(T,-1)]=E[this._idx(T-1,0)],E[this._idx(-1,T)]=E[this._idx(0,T-1)],E[this._idx(T,T)]=E[this._idx(T-1,T-1)]}const D=g==="terrarium"?cw:lw;for(let W=0;W<E.length;++W){const X=4*W;this.floatView[W]=D(this.pixels[X],this.pixels[X+1],this.pixels[X+2])}this._timestamp=ia.now()}_buildQuadTree(){this._tree=new tx(this)}get(s,c,g=!1){g&&(s=Jt(s,-1,this.dim),c=Jt(c,-1,this.dim));const y=this._idx(s,c);return this.floatView[y]}set(s,c,g){const y=this._idx(s,c),T=this.floatView[y];return this.floatView[y]=g,g-T}static getUnpackVector(s){return aw[s]}_idx(s,c){if(s<-1||s>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(s+1)}static pack(s,c){const g=[0,0,0,0],y=Am.getUnpackVector(c);let T=Math.floor((s+y[3])/y[2]);return g[2]=T%256,T=Math.floor(T/256),g[1]=T%256,T=Math.floor(T/256),g[0]=T,g}getPixels(){return new ey({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,c,g){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let y=c*this.dim,T=c*this.dim+this.dim,E=g*this.dim,D=g*this.dim+this.dim;switch(c){case-1:y=T-1;break;case 1:T=y+1}switch(g){case-1:E=D-1;break;case 1:D=E+1}const W=-c*this.dim,X=-g*this.dim;for(let ae=E;ae<D;ae++)for(let ce=y;ce<T;ce++){const fe=4*this._idx(ce,ae),ye=4*this._idx(ce+W,ae+X);this.pixels[fe+0]=s.pixels[ye+0],this.pixels[fe+1]=s.pixels[ye+1],this.pixels[fe+2]=s.pixels[ye+2],this.pixels[fe+3]=s.pixels[ye+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function uw(u,s,c){u===1?s.headerLength=c.readFixed32():u===2?s.x=c.readVarint():u===3?s.y=c.readVarint():u===4?s.z=c.readVarint():u===5&&s.layers.push(function(g,y){return g.readFields(mw,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},y)}(c,c.readVarint()+c.pos))}function hw(u,s,c){u===1?(s.delta_filter=function(g,y){return g.readFields(fw,{blockSize:0},y)}(c,c.readVarint()+c.pos),s.filter="delta_filter"):u===2?(c.readVarint(),s.filter="zigzag_filter"):u===3?(c.readVarint(),s.filter="bitshuffle_filter"):u===4&&(c.readVarint(),s.filter="byteshuffle_filter")}function fw(u,s,c){u===1&&(s.blockSize=c.readVarint())}function dw(u,s,c){u===1?(c.readVarint(),s.codec="gzip_data"):u===2?(c.readVarint(),s.codec="jpeg_image"):u===3?(c.readVarint(),s.codec="webp_image"):u===4&&(c.readVarint(),s.codec="png_image")}function pw(u,s,c){let g=0,y=0;u===1?s.firstByte=c.readFixed64():u===2?s.lastByte=c.readFixed64():u===3?s.filters.push(function(T,E){return T.readFields(hw,{},E)}(c,c.readVarint()+c.pos)):u===4?s.codec=function(T,E){return T.readFields(dw,{},E)}(c,c.readVarint()+c.pos):u===5?y=c.readFloat():u===6?g=c.readFloat():u===7?s.bands.push(c.readString()):u===8?s.offset=c.readDouble():u===9&&(s.scale=c.readDouble()),s.offset===0&&(s.offset=y),s.scale===0&&(s.scale=g)}function mw(u,s,c){u===1?s.version=c.readVarint():u===2?s.name=c.readString():u===3?s.units=c.readString():u===4?s.tileSize=c.readVarint():u===5?s.buffer=c.readVarint():u===6?s.pixelFormat=c.readVarint():u===7&&s.dataIndex.push(function(g,y){return g.readFields(pw,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},y)}(c,c.readVarint()+c.pos))}function gw(u,s,c){if(u===2)(function(g,y,T){g.readFields(_w,T,y)})(c,c.readVarint()+c.pos,s);else if(u===3)throw new Error("Not implemented")}function _w(u,s,c){if(u===1){let g=0;const y=c.readVarint()+c.pos;for(;c.pos<y;)s[g++]=c.readVarint()}}function yw(u,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let c=s[3];for(let g=2;g>=1;g--){const y=g===1?1:0,T=g===2?1:0;for(let E=0;E<s[0];E++){const D=s[1]*E;for(let W=y;W<s[1];W++){const X=s[2]*(W+D);for(let ae=T;ae<s[2];ae++){const ce=s[3]*(ae+X);for(let fe=0;fe<s[3];fe++){const ye=ce+fe;u[ye]+=u[ye-c]}}}}c*=s[g]}return u}function vw(u){for(let s=0,c=u.length;s<c;s++)u[s]=u[s]>>>1^-(1&u[s]);return u}function xw(u,s){switch(s){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const g=u[c],y=u[c+1];u[c]=(240&g)>>4|(61440&g)>>8|(240&y)<<4|61440&y,u[c+1]=15&g|(3840&g)>>4|(15&y)<<8|(3840&y)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const g=u[c],y=u[c+1],T=u[c+2],E=u[c+3];u[c+0]=(192&g)>>6|(192&y)>>4|(192&T)>>2|192&E,u[c+1]=(48&g)>>4|(48&y)>>2|48&T|(48&E)<<2,u[c+2]=(12&g)>>2|12&y|(12&T)<<2|(12&E)<<4,u[c+3]=3&g|(3&y)<<2|(3&T)<<4|(3&E)<<6}return u;default:throw new Error(`Invalid pixel format, "${s}"`)}}jr(Am,"DEMData"),jr(tx,"DemMinMaxQuadTree",{omit:["dem"]});var ua=Uint8Array,Cd=Uint16Array,bw=Int32Array,rx=new ua([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nx=new ua([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ww=new ua([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sx=function(u,s){for(var c=new Cd(31),g=0;g<31;++g)c[g]=s+=1<<u[g-1];var y=new bw(c[30]);for(g=1;g<30;++g)for(var T=c[g];T<c[g+1];++T)y[T]=T-c[g]<<5|g;return{b:c,r:y}},ox=sx(rx,2),ax=ox.b,Sw=ox.r;ax[28]=258,Sw[258]=28;for(var Tw=sx(nx,0).b,lx=new Cd(32768),ao=0;ao<32768;++ao){var Hh=(43690&ao)>>1|(21845&ao)<<1;lx[ao]=((65280&(Hh=(61680&(Hh=(52428&Hh)>>2|(13107&Hh)<<2))>>4|(3855&Hh)<<4))>>8|(255&Hh)<<8)>>1}var Pd=function(u,s,c){for(var g=u.length,y=0,T=new Cd(s);y<g;++y)u[y]&&++T[u[y]-1];var E,D=new Cd(s);for(y=1;y<s;++y)D[y]=D[y-1]+T[y-1]<<1;E=new Cd(1<<s);var W=15-s;for(y=0;y<g;++y)if(u[y])for(var X=y<<4|u[y],ae=s-u[y],ce=D[u[y]-1]++<<ae,fe=ce|(1<<ae)-1;ce<=fe;++ce)E[lx[ce]>>W]=X;return E},Id=new ua(288);for(ao=0;ao<144;++ao)Id[ao]=8;for(ao=144;ao<256;++ao)Id[ao]=9;for(ao=256;ao<280;++ao)Id[ao]=7;for(ao=280;ao<288;++ao)Id[ao]=8;var cx=new ua(32);for(ao=0;ao<32;++ao)cx[ao]=5;var Ew=Pd(Id,9),Mw=Pd(cx,5),b_=function(u){for(var s=u[0],c=1;c<u.length;++c)u[c]>s&&(s=u[c]);return s},Fa=function(u,s,c){var g=s/8|0;return(u[g]|u[g+1]<<8)>>(7&s)&c},w_=function(u,s){var c=s/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&s)},Aw=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oa=function(u,s,c){var g=new Error(s||Aw[u]);if(g.code=u,Error.captureStackTrace&&Error.captureStackTrace(g,Oa),!c)throw g;return g},Cw=new ua(0),Pw=typeof TextDecoder<"u"&&new TextDecoder;try{Pw.decode(Cw,{stream:!0})}catch{}const Iw={gzip_data:"gzip"};class ya extends Error{constructor(s){super(s),this.name="MRTError"}}const Rw={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ux={uint32:1,uint16:2,uint8:4},Lw={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let S_;class Cm{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const c=this.layers[s];if(!c)throw new ya(`Layer '${s}' not found`);return c}getHeaderLength(s){const c=new Uint8Array(s),g=new DataView(s);if(c[0]!==13)throw new ya("File is not a valid MRT.");return g.getUint32(1,!0)}parseHeader(s){const c=new Uint8Array(s),g=this.getHeaderLength(s);if(c.length<g)throw new ya(`Expected header with length >= ${g} but got buffer of length ${c.length}`);const y=function(T,E){return T.readFields(uw,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new S_(c.subarray(0,g)));if(!isNaN(this.x)&&(this.x!==y.x||this.y!==y.y||this.z!==y.z))throw new ya(`Invalid attempt to parse header ${y.z}/${y.x}/${y.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=y.x,this.y=y.y,this.z=y.z;for(const T of y.layers)this.layers[T.name]=new hx(T,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const c=[],g=this.getLayer(s.layerName);for(let y of s.blockIndices){const T=g.dataIndex[y],E=T.firstByte-s.firstByte,D=T.lastByte-s.firstByte;if(g._blocksInProgress.has(y))continue;const W={layerName:g.name,firstByte:E,lastByte:D,pixelFormat:g.pixelFormat,blockIndex:y,blockShape:[T.bands.length].concat(g.bandShape),buffer:g.buffer,codec:T.codec.codec,filters:T.filters.map(X=>X.filter)};g._blocksInProgress.add(y),c.push(W)}return new fx(c,()=>{c.forEach(y=>g._blocksInProgress.delete(y.blockIndex))},(y,T)=>{if(c.forEach(E=>g._blocksInProgress.delete(E.blockIndex)),y)throw y;T.forEach(E=>{this.getLayer(E.layerName).processDecodedData(E)})})}}class hx{constructor({version:s,name:c,units:g,tileSize:y,pixelFormat:T,buffer:E,dataIndex:D},W){if(this.version=s,this.version!==1)throw new ya(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=c,this.units=g,this.tileSize=y,this.buffer=E,this.pixelFormat=Rw[T],this.dataIndex=D,this.bandShape=[y+2*E,y+2*E,ux[this.pixelFormat]],this._decodedBlocks=new Mm(W?W.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ux[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const c=s.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,s.data)}getBlockForBand(s){let c=0;switch(typeof s){case"string":for(const[g,y]of this.dataIndex.entries()){for(const[T,E]of y.bands.entries())if(E===s)return{bandIndex:c+T,blockIndex:g,blockBandIndex:T};c+=y.bands.length}break;case"number":for(const[g,y]of this.dataIndex.entries()){if(s>=c&&s<c+y.bands.length)return{bandIndex:s,blockIndex:g,blockBandIndex:s-c};c+=y.bands.length}break;default:throw new ya(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let c=1/0,g=-1/0;const y=[],T=new Set;for(const E of s){const{blockIndex:D}=this.getBlockForBand(E);if(D<0)throw new ya(`Invalid band: ${JSON.stringify(E)}`);const W=this.dataIndex[D];y.includes(D)||y.push(D),T.add(D),c=Math.min(c,W.firstByte),g=Math.max(g,W.lastByte)}if(T.size>this.cacheSize)throw new ya(`Number of blocks to decode (${T.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:g,blockIndices:y}}hasBand(s){const{blockIndex:c}=this.getBlockForBand(s);return c>=0}hasDataForBand(s){const{blockIndex:c}=this.getBlockForBand(s);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(s){const{blockIndex:c,blockBandIndex:g}=this.getBlockForBand(s);if(c<0)throw new ya(`Band not found: ${JSON.stringify(s)}`);const y=this._decodedBlocks.get(c.toString());if(!y)throw new ya(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const T=this.dataIndex[c],E=this.bandShape.reduce((X,ae)=>X*ae,1),D=g*E,W=y.subarray(D,D+E);return{data:W,bytes:new Uint8Array(W.buffer).subarray(W.byteOffset,W.byteOffset+W.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:T.offset,scale:T.scale}}}Cm.setPbf=function(u){S_=u};class fx{constructor(s,c,g){this.tasks=s,this._onCancel=c,this._onComplete=g,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,c){this._finalized||(this._onComplete(s,c),this._finalized=!0)}}function Au(u,s){const c=u.json.bufferViews[s.bufferView],g=Zp[s.componentType];return new g(u.buffers[c.buffer],(s.byteOffset||0)+(c.byteOffset||0),s.count*(c.byteStride&&c.byteStride!==fd[s.type]*g.BYTES_PER_ELEMENT?c.byteStride/g.BYTES_PER_ELEMENT:fd[s.type]))}function T_(u,s,c,g){const y=Zp[s.componentType],T=function(ae){switch(ae){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(y),E=u.json.bufferViews[s.bufferView],D=E.byteStride?E.byteStride/y.BYTES_PER_ELEMENT:fd[s.type],W=c.float32,X=W.length/c.capacity;for(let ae=0,ce=0;ae<s.count*D;ae+=D,ce+=X)for(let fe=0;fe<X;fe++)W[ce+fe]=g[ae+fe]*T;c._trim()}function kw(u,s,c){const g=u.indices,y=u.attributes,T={};T.indexArray=new go;const E=s.json.accessors[g],D=E.count/3;T.indexArray.reserve(D);const W=Au(s,E);for(let fe=0;fe<D;fe++)T.indexArray.emplaceBack(W[3*fe],W[3*fe+1],W[3*fe+2]);T.indexArray._trim(),T.vertexArray=new pa;const X=s.json.accessors[y.POSITION];T.vertexArray.reserve(X.count);const ae=Au(s,X);for(let fe=0;fe<X.count;fe++)T.vertexArray.emplaceBack(ae[3*fe],ae[3*fe+1],ae[3*fe+2]);if(T.vertexArray._trim(),T.aabb=new Yn(X.min,X.max),T.centroid=function(fe,ye){const _t=[0,0,0],St=fe.length;if(St>0){for(let Pt=0;Pt<St;Pt++){const zt=3*fe[Pt];_t[0]+=ye[zt],_t[1]+=ye[zt+1],_t[2]+=ye[zt+2]}_t[0]/=St,_t[1]/=St,_t[2]/=St}return _t}(W,ae),y.COLOR_0!==void 0){const fe=s.json.accessors[y.COLOR_0],ye=fd[fe.type],_t=Au(s,fe);T.colorArray=ye===3?new pa:new mo,T.colorArray.resize(fe.count),T_(s,fe,T.colorArray,_t)}if(y.NORMAL!==void 0){T.normalArray=new pa;const fe=s.json.accessors[y.NORMAL];T.normalArray.resize(fe.count);const ye=Au(s,fe);T_(s,fe,T.normalArray,ye)}if(y.TEXCOORD_0!==void 0&&c.length>0){T.texcoordArray=new Pl;const fe=s.json.accessors[y.TEXCOORD_0];T.texcoordArray.resize(fe.count);const ye=Au(s,fe);T_(s,fe,T.texcoordArray,ye)}if(y._FEATURE_ID_RGBA4444!==void 0){const fe=s.json.accessors[y._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(T.featureData=Au(s,fe))}y._FEATURE_RGBA4444!==void 0&&(T.featureData=new Uint32Array(Au(s,s.json.accessors[y._FEATURE_RGBA4444]).buffer));const ce=u.material;return T.material=function(fe,ye){const{emissiveFactor:_t=[0,0,0],alphaMode:St="OPAQUE",alphaCutoff:Pt=.5,normalTexture:zt,occlusionTexture:Kt,emissiveTexture:Qt,doubleSided:Tt}=fe,{baseColorFactor:Wt=[1,1,1,1],metallicFactor:ti=1,roughnessFactor:ci=1,baseColorTexture:ki,metallicRoughnessTexture:Ci}=fe.pbrMetallicRoughness||{},Di=Kt?ye[Kt.index]:void 0;if(Kt&&Kt.extensions&&Kt.extensions.KHR_texture_transform&&Di){const Vi=Kt.extensions.KHR_texture_transform;Di.offsetScale=[Vi.offset[0],Vi.offset[1],Vi.scale[0],Vi.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new rs(...Wt),metallicFactor:ti,roughnessFactor:ci,baseColorTexture:ki?ye[ki.index]:void 0,metallicRoughnessTexture:Ci?ye[Ci.index]:void 0},doubleSided:Tt,emissiveFactor:new rs(..._t),alphaMode:St,alphaCutoff:Pt,normalTexture:zt?ye[zt.index]:void 0,occlusionTexture:Di,emissionTexture:Qt?ye[Qt.index]:void 0,defined:fe.defined===void 0}}(ce!==void 0?s.json.materials[ce]:{defined:!1},c),T}function dx(u,s,c){const{matrix:g,rotation:y,translation:T,scale:E,mesh:D,extras:W,children:X}=u,ae={};if(ae.matrix=g||function(ce,fe,ye,_t){var St=fe[0],Pt=fe[1],zt=fe[2],Kt=fe[3],Qt=St+St,Tt=Pt+Pt,Wt=zt+zt,ti=St*Qt,ci=St*Tt,ki=St*Wt,Ci=Pt*Tt,Di=Pt*Wt,Vi=zt*Wt,Qi=Kt*Qt,br=Kt*Tt,hr=Kt*Wt,xr=_t[0],Sr=_t[1],tr=_t[2];return ce[0]=(1-(Ci+Vi))*xr,ce[1]=(ci+hr)*xr,ce[2]=(ki-br)*xr,ce[3]=0,ce[4]=(ci-hr)*Sr,ce[5]=(1-(ti+Vi))*Sr,ce[6]=(Di+Qi)*Sr,ce[7]=0,ce[8]=(ki+br)*tr,ce[9]=(Di-Qi)*tr,ce[10]=(1-(ti+Ci))*tr,ce[11]=0,ce[12]=ye[0],ce[13]=ye[1],ce[14]=ye[2],ce[15]=1,ce}([],y||[0,0,0,1],T||[0,0,0],E||[1,1,1]),D!==void 0){ae.meshes=c[D];const ce=ae.anchor=[0,0];for(const fe of ae.meshes){const{min:ye,max:_t}=fe.aabb;ce[0]+=ye[0]+_t[0],ce[1]+=ye[1]+_t[1]}ce[0]=Math.floor(ce[0]/ae.meshes.length/2),ce[1]=Math.floor(ce[1]/ae.meshes.length/2)}if(W&&(W.id&&(ae.id=W.id),W.lights&&(ae.lights=function(ce){if(!ce.length)return[];const fe=function(zt){const Kt=atob(zt),Qt=new Uint8Array(Kt.length);for(let Tt=0;Tt<Kt.length;Tt++)Qt[Tt]=Kt.codePointAt(Tt);return Qt}(ce),ye=[],_t=fe.length/24,St=new Uint16Array(fe.buffer),Pt=new Float32Array(fe.buffer);for(let zt=0;zt<_t;zt++){const Kt=St[2*zt*6]/30,Qt=St[2*zt*6+1]/30,Tt=St[2*zt*6+10]/100,Wt=Pt[6*zt+1],ti=Pt[6*zt+2],ci=Pt[6*zt+3],ki=Pt[6*zt+4],Ci=ci-Wt,Di=ki-ti,Vi=Math.hypot(Ci,Di);ye.push({pos:[Wt+.5*Ci,ti+.5*Di,Qt],normal:[Di/Vi,-Ci/Vi,0],width:Vi,height:Kt,depth:Tt,points:[Wt,ti,ci,ki]})}return ye}(W.lights))),X){const ce=[];for(const fe of X)ce.push(dx(s.json.nodes[fe],s,c));ae.children=ce}return ae}function Dw(u){if(u.vertices.length===0||u.indices.length===0)return null;const s=new Ag(u.vertices,u.indices,8,256),[c,g]=[s.min.clone(),s.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:s,min:c,max:g}}function Fw(u){if(!u.extras||!u.extras.ground)return null;const s=u.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const c=s[0];if(!c||!Array.isArray(c)||c.length===0)return null;const g=[];for(const E of c){if(!Array.isArray(E)||E.length!==2)continue;const D=E[0],W=E[1];typeof D=="number"&&typeof W=="number"&&g.push(new rr(D,W))}if(g.length<3)return null;g.length>1&&g[g.length-1].equals(g[0])&&g.pop();let y=0;for(let E=0;E<g.length;E++){const D=g[E],W=g[(E+1)%g.length],X=g[(E+2)%g.length];y+=(D.x-W.x)*(X.y-W.y)-(X.x-W.x)*(D.y-W.y)}y>0&&g.reverse();const T=ed(g.flatMap(E=>[E.x,E.y]),[]);return T.length===0?null:{vertices:g,indices:T}}function Ow(u,s){const c=[],g=[];let y=0;const T=[];for(const E of u){y=c.length;const D=E.vertexArray.float32,W=E.indexArray.uint16;for(let X=0;X<E.vertexArray.length;X++)T[0]=D[3*X+0],T[1]=D[3*X+1],T[2]=D[3*X+2],oi(T,T,s),c.push(new rr(T[0],T[1]));for(let X=0;X<3*E.indexArray.length;X++)g.push(W[X]+y)}if(g.length%3!=0)return null;for(let E=0;E<g.length;E+=3){const D=c[g[E+0]],W=c[g[E+1]],X=c[g[E+2]];(D.x-W.x)*(X.y-W.y)-(X.x-W.x)*(D.y-W.y)>0&&([g[E+1],g[E+2]]=[g[E+2],g[E+1]])}return{vertices:c,indices:g}}function mx(u){const s=function(W,X){const ae=[],ce=WebGL2RenderingContext;if(W.json.textures)for(const fe of W.json.textures){const ye={magFilter:ce.LINEAR,minFilter:ce.NEAREST,wrapS:ce.REPEAT,wrapT:ce.REPEAT};fe.sampler!==void 0&&Object.assign(ye,W.json.samplers[fe.sampler]),ae.push({image:X[fe.source],sampler:ye,uploaded:!1})}return ae}(u,u.images),c=function(W,X){const ae=[];for(const ce of W.json.meshes){const fe=[];for(const ye of ce.primitives)fe.push(kw(ye,W,X));ae.push(fe)}return ae}(u,s),{scenes:g,scene:y,nodes:T}=u.json,E=g?g[y||0].nodes:T,D=[];for(const W of E)D.push(dx(T[W],u,c));return function(W,X,ae){const ce={},fe=new Set;for(let ye=0;ye<W.length;ye++){const _t=ae[X[ye]];if(!_t.extras)continue;const St=_t.extras["mapbox:footprint:version"],Pt=_t.extras["mapbox:footprint:id"];(St||Pt)&&fe.add(ye),St==="1.0.0"&&Pt&&(ce[Pt]=ye)}for(let ye=0;ye<W.length;ye++){if(fe.has(ye))continue;const _t=W[ye],St=ae[X[ye]];if(!St.extras)continue;let Pt=null;_t.id in ce&&(Pt=Ow(W[ce[_t.id]].meshes,_t.matrix)),Pt||(Pt=Fw(St)),Pt&&(_t.footprint=Dw(Pt))}if(fe.size>0){const ye=Array.from(fe.values()).sort((_t,St)=>_t-St);for(let _t=ye.length-1;_t>=0;_t--)W.splice(ye[_t],1)}}(D,E,u.json.nodes),D}function zw(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const s=u.vertexArray.float32,c=u.aabb.min[0]-1,g=u.aabb.min[1]-1,y=Eu/(u.aabb.max[0]-c+2),T=Eu/(u.aabb.max[1]-g+2);for(let E=0;E<s.length;E+=3){const D=s[E+2],W=(s[E+0]-c)*y|0,X=(s[E+1]-g)*T|0;D>u.heightmap[X*Eu+W]&&(u.heightmap[X*Eu+W]=D)}}function Bw(u,s){const c={};c.indexArray=new go,c.indexArray.reserve(4*u.length),c.vertexArray=new pa,c.vertexArray.reserve(10*u.length),c.colorArray=new mo,c.vertexArray.reserve(10*u.length);let g=0;for(const E of u){const D=Math.min(10,Math.max(4,1.3*E.height))*s,W=[-E.normal[1],E.normal[0],0],X=Math.min(.29,.1*E.width/E.depth),ae=E.width-2*E.depth*s*(X+.01),ce=mi([],E.pos,W,ae/2),fe=mi([],E.pos,W,-ae/2),ye=[ce[0],ce[1],ce[2]+E.height],_t=[fe[0],fe[1],fe[2]+E.height],St=mi([],E.normal,W,X);jt(St,St,D);const Pt=mi([],E.normal,W,-X);jt(Pt,Pt,D),ei(St,ce,St),ei(Pt,fe,Pt),ce[2]+=.1,fe[2]+=.1,c.vertexArray.emplaceBack(St[0],St[1],St[2]),c.vertexArray.emplaceBack(Pt[0],Pt[1],Pt[2]),c.vertexArray.emplaceBack(ce[0],ce[1],ce[2]),c.vertexArray.emplaceBack(fe[0],fe[1],fe[2]),c.vertexArray.emplaceBack(ye[0],ye[1],ye[2]),c.vertexArray.emplaceBack(_t[0],_t[1],_t[2]),c.vertexArray.emplaceBack(ce[0],ce[1],ce[2]),c.vertexArray.emplaceBack(fe[0],fe[1],fe[2]),c.vertexArray.emplaceBack(St[0],St[1],St[2]),c.vertexArray.emplaceBack(Pt[0],Pt[1],Pt[2]);const zt=ae/D/2;c.colorArray.emplaceBack(-zt-X,-1,zt,.8),c.colorArray.emplaceBack(zt+X,-1,zt,.8),c.colorArray.emplaceBack(-zt,0,zt,1.3),c.colorArray.emplaceBack(zt,0,zt,1.3),c.colorArray.emplaceBack(zt+X,-.8,zt,.7),c.colorArray.emplaceBack(zt+X,-.8,zt,.7),c.colorArray.emplaceBack(0,0,zt,1.3),c.colorArray.emplaceBack(0,0,zt,1.3),c.colorArray.emplaceBack(zt+X,-1.2,zt,.8),c.colorArray.emplaceBack(zt+X,-1.2,zt,.8),c.indexArray.emplaceBack(6+g,4+g,8+g),c.indexArray.emplaceBack(7+g,9+g,5+g),c.indexArray.emplaceBack(0+g,1+g,2+g),c.indexArray.emplaceBack(1+g,3+g,2+g),g+=10}const y={defined:!0};y.emissiveFactor=rs.black;const T={};return T.baseColorFactor=rs.white,y.pbrMetallicRoughness=T,c.material=y,c.aabb=new Yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}Cm.performDecoding=function(u,s){const c=new Uint8Array(u);return Promise.all(s.tasks.map(g=>{const{layerName:y,firstByte:T,lastByte:E,pixelFormat:D,blockShape:W,blockIndex:X,filters:ae,codec:ce}=g,fe=c.subarray(T,E+1),ye=new Uint32Array(W[0]*W[1]*W[2]);let _t;if(ce!=="gzip_data")throw new ya(`Unhandled codec: ${ce}`);return _t=function(St,Pt){if(!globalThis.DecompressionStream&&Pt==="gzip_data")return Promise.resolve(((Tt=function(ci){ci[0]==31&&ci[1]==139&&ci[2]==8||Oa(6,"invalid gzip data");var ki=ci[3],Ci=10;4&ki&&(Ci+=2+(ci[10]|ci[11]<<8));for(var Di=(ki>>3&1)+(ki>>4&1);Di>0;Di-=!ci[Ci++]);return Ci+(2&ki)}(Qt=St))+8>Qt.length&&Oa(6,"invalid gzip data"),function(ci,ki,Ci,Di){var Vi=ci.length;if(!Vi||ki.f&&!ki.l)return Ci||new ua(0);var Qi=!Ci,br=Qi||ki.i!=2,hr=ki.i;Qi&&(Ci=new ua(3*Vi));var xr,Sr,tr=function(Xs){var Rs=Ci.length;if(Xs>Rs){var vs=new ua(Math.max(2*Rs,Xs));vs.set(Ci),Ci=vs}},yr=ki.f||0,Yi=ki.p||0,er=ki.b||0,Cr=ki.l,Lr=ki.d,an=ki.m,Yr=ki.n,zr=8*Vi;do{if(!Cr){yr=Fa(ci,Yi,1);var Ar=Fa(ci,Yi+1,3);if(Yi+=3,!Ar){var vn=ci[(ai=4+((Yi+7)/8|0))-4]|ci[ai-3]<<8,Zr=ai+vn;if(Zr>Vi){hr&&Oa(0);break}br&&tr(er+vn),Ci.set(ci.subarray(ai,Zr),er),ki.b=er+=vn,ki.p=Yi=8*Zr,ki.f=yr;continue}if(Ar==1)Cr=Ew,Lr=Mw,an=9,Yr=5;else if(Ar==2){var Kr=Fa(ci,Yi,31)+257,mn=Fa(ci,Yi+10,15)+4,Tn=Kr+Fa(ci,Yi+5,31)+1;Yi+=14;for(var bn=new ua(Tn),Rn=new ua(19),Mn=0;Mn<mn;++Mn)Rn[ww[Mn]]=Fa(ci,Yi+3*Mn,7);Yi+=3*mn;var Ln=b_(Rn),os=(1<<Ln)-1,Ts=Pd(Rn,Ln);for(Mn=0;Mn<Tn;){var ai,hi=Ts[Fa(ci,Yi,os)];if(Yi+=15&hi,(ai=hi>>4)<16)bn[Mn++]=ai;else{var sr=0,Dr=0;for(ai==16?(Dr=3+Fa(ci,Yi,3),Yi+=2,sr=bn[Mn-1]):ai==17?(Dr=3+Fa(ci,Yi,7),Yi+=3):ai==18&&(Dr=11+Fa(ci,Yi,127),Yi+=7);Dr--;)bn[Mn++]=sr}}var Br=bn.subarray(0,Kr),Or=bn.subarray(Kr);an=b_(Br),Yr=b_(Or),Cr=Pd(Br,an),Lr=Pd(Or,Yr)}else Oa(1);if(Yi>zr){hr&&Oa(0);break}}br&&tr(er+131072);for(var Xr=(1<<an)-1,dn=(1<<Yr)-1,On=Yi;;On=Yi){var zn=(sr=Cr[w_(ci,Yi)&Xr])>>4;if((Yi+=15&sr)>zr){hr&&Oa(0);break}if(sr||Oa(2),zn<256)Ci[er++]=zn;else{if(zn==256){On=Yi,Cr=null;break}var An=zn-254;zn>264&&(An=Fa(ci,Yi,(1<<(Bn=rx[Mn=zn-257]))-1)+ax[Mn],Yi+=Bn);var us=Lr[w_(ci,Yi)&dn],ys=us>>4;if(us||Oa(3),Yi+=15&us,Or=Tw[ys],ys>3){var Bn=nx[ys];Or+=w_(ci,Yi)&(1<<Bn)-1,Yi+=Bn}if(Yi>zr){hr&&Oa(0);break}br&&tr(er+131072);var Vs=er+An;if(er<Or){var Es=0-Or,as=Math.min(Or,Vs);for(Es+er<0&&Oa(3);er<as;++er)Ci[er]=(void 0)[Es+er]}for(;er<Vs;++er)Ci[er]=Ci[er-Or]}}ki.l=Cr,ki.p=On,ki.b=er,ki.f=yr,Cr&&(yr=1,ki.m=an,ki.d=Lr,ki.n=Yr)}while(!yr);return er!=Ci.length&&Qi?(xr=Ci,((Sr=er)==null||Sr>xr.length)&&(Sr=xr.length),new ua(xr.subarray(0,Sr))):Ci.subarray(0,er)}(Qt.subarray(Tt,-8),{i:2},new ua(((zt=Qt)[(Kt=zt.length)-4]|zt[Kt-3]<<8|zt[Kt-2]<<16|zt[Kt-1]<<24)>>>0))));var zt,Kt,Qt,Tt;const Wt=Iw[Pt];if(!Wt)throw new Error(`Unhandled codec: ${Pt}`);const ti=new globalThis.DecompressionStream(Wt);return new Response(new Blob([St]).stream().pipeThrough(ti)).arrayBuffer().then(ci=>new Uint8Array(ci))}(fe,ce).then(St=>(function(Pt,zt){Pt.readFields(gw,zt)}(new S_(St),ye),new Lw[D](ye.buffer))),_t.then(St=>{for(let Pt=ae.length-1;Pt>=0;Pt--)switch(ae[Pt]){case"delta_filter":yw(St,W);break;case"zigzag_filter":vw(St);break;case"bitshuffle_filter":xw(St,D);break;default:throw new ya(`Unhandled filter "${ae[Pt]}"`)}return{layerName:y,blockIndex:X,data:St}}).catch(St=>{throw St})}))},jr(fx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),jr(Cm,"MapboxRasterTile"),jr(hx,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class gx{constructor(s){this._stringToNumber={},this._numberToString=[];for(let c=0;c<s.length;c++){const g=s[c];this._stringToNumber[g]=c,this._numberToString[c]=g}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}const Nw=["id","tile","layer","source","sourceLayer","state"];class jh{constructor(s,c,g,y,T){this.type="Feature",this._vectorTileFeature=s,this._z=c,this._x=g,this._y=y,this.properties=s.properties,this.id=T}clone(){const s=new jh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Nw)this[c]!==void 0&&(s[c]=this[c]);return s}}class yx{constructor(s,c){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Ma(Fr,16,0),this.featureIndexArray=new Mp,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,c,g,y,T,E=0,D=0){const W=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,y,T,E);const X=this.grid;for(let ae=0;ae<c.length;ae++){const ce=c[ae],fe=[1/0,1/0,-1/0,-1/0];for(let ye=0;ye<ce.length;ye++){const _t=ce[ye];fe[0]=Math.min(fe[0],_t.x),fe[1]=Math.min(fe[1],_t.y),fe[2]=Math.max(fe[2],_t.x),fe[3]=Math.max(fe[3],_t.y)}D!==0&&(fe[0]-=D,fe[1]-=D,fe[2]+=D,fe[3]+=D),fe[0]<Fr&&fe[1]<Fr&&fe[2]>=0&&fe[3]>=0&&X.insert(W,fe[0],fe[1],fe[2],fe[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Cn.VectorTile(new Kp(this.rawTileData)).layers,this.sourceLayerCoder=new gx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,c){const{tilespaceGeometry:g,transform:y,tileTransform:T,pixelPosMatrix:E,availableImages:D,worldview:W}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const X=g.bufferedTilespaceBounds,ae=this.grid.query(X.min.x,X.min.y,X.max.x,X.max.y,(_t,St,Pt,zt)=>pc(g.bufferedTilespaceGeometry,_t,St,Pt,zt));ae.sort(Vw);let ce=null;y.elevation&&ae.length>0&&(ce=$h.create(y.elevation,this.tileID));const fe={};let ye;for(let _t=0;_t<ae.length;_t++){const St=ae[_t];if(St===ye)continue;ye=St;const Pt=this.featureIndexArray.get(St);let zt=null;this.is3DTile?this.loadMatchingModelFeature(fe,Pt,s,g,y,W):this.loadMatchingFeature(fe,Pt,s,D,W,(Kt,Qt,Tt,Wt=0)=>(zt||(zt=qr(Kt,this.tileID.canonical,T)),Qt.queryIntersectsFeature(g,Kt,Tt,zt,this.z,y,E,ce,Wt)))}return fe}loadMatchingFeature(s,c,g,y,T,E){const{featureIndex:D,bucketIndex:W,sourceLayerIndex:X,layoutVertexArrayOffset:ae}=c,ce=this.bucketLayerIDs[W],fe=g.layers,ye=Object.keys(fe);if(ye.length&&!sn(ye,ce))return;const _t=g.sourceCache,St=this.sourceLayerCoder.decode(X),Pt=this.vtLayers[St].feature(D),zt=this.getId(Pt,St);for(let Kt=0;Kt<ce.length;Kt++){const Qt=ce[Kt];if(!fe[Qt])continue;const{styleLayer:Tt,targets:Wt}=fe[Qt];let ti={};zt!==void 0&&(ti=_t.getFeatureState(Tt.sourceLayer,zt));const ci=!E||E(Pt,Tt,ti,ae);if(!ci)continue;const ki=new jh(Pt,this.z,this.x,this.y,zt);ki.tile=this.tileID.canonical,ki.state=ti;let Ci=this.serializedLayersCache.get(Qt);Ci||(Ci=Tt.serialize(),Ci.id=Qt,this.serializedLayersCache.set(Qt,Ci)),ki.source=Ci.source,ki.sourceLayer=Ci["source-layer"],ki.layer=Oi({},Ci),ki.layer.paint=vx(Ci.paint,Tt.paint,Pt,ti,y),ki.layer.layout=vx(Ci.layout,Tt.layout,Pt,ti,y);let Di=!1;for(const Vi of Wt){this.updateFeatureProperties(ki,Vi);const{filter:Qi}=Vi;if(Qi){if(Pt.properties=ki.properties,Qi.needGeometry){const br=Ur(Pt,!0);if(!Qi.filter(new ps(this.tileID.overscaledZ,{worldview:T}),br,this.tileID.canonical))continue}else if(!Qi.filter(new ps(this.tileID.overscaledZ,{worldview:T}),Pt))continue}Di=!0,Vi.targetId&&this.addFeatureVariant(ki,Vi)}Di&&this.appendToResult(s,Qt,D,ki,ci)}}loadMatchingModelFeature(s,c,g,y,T,E){const{featureIndex:D,bucketIndex:W}=c,X=this.bucketLayerIDs[W],ae=g.layers,ce=Object.keys(ae);if(!ce.length||sn(ce,X))for(let fe=0;fe<X.length;fe++){const ye=X[fe],{styleLayer:_t,targets:St}=ae[ye];if(_t.type!=="model")continue;const Pt=y.tile,zt=Pt.getBucket(_t);if(!(zt&&zt instanceof bm))continue;const Kt=N1(zt,D,y,T);if(!Kt)continue;const{z:Qt,x:Tt,y:Wt}=Pt.tileID.canonical,{feature:ti,intersectionZ:ci,position:ki}=Kt;let Ci={};ti.id!==void 0&&(Ci=g.sourceCache.getFeatureState(_t.sourceLayer,ti.id));const Di=new jh({},Qt,Tt,Wt,ti.id);Di.tile=this.tileID.canonical,Di.state=Ci,Di.properties=ti.properties,Di.geometry={type:"Point",coordinates:[ki.lng,ki.lat]};let Vi=this.serializedLayersCache.get(ye);Vi||(Vi=_t.serialize(),Vi.id=ye,this.serializedLayersCache.set(ye,Vi)),Di.source=Vi.source,Di.sourceLayer=Vi["source-layer"],Di.layer=Oi({},Vi);let Qi=!1;for(const br of St){this.updateFeatureProperties(Di,br);const{filter:hr}=br;if(hr){if(ti.properties=Di.properties,hr.needGeometry){if(!hr.filter(new ps(this.tileID.overscaledZ,{worldview:E}),ti,this.tileID.canonical))continue}else if(!hr.filter(new ps(this.tileID.overscaledZ,{worldview:E}),ti))continue}Qi=!0,br.targetId&&this.addFeatureVariant(Di,br)}Qi&&this.appendToResult(s,ye,D,Di,ci)}}updateFeatureProperties(s,c,g){if(c.properties){const y={};for(const T in c.properties){const E=c.properties[T].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,g);E!=null&&(y[T]=E)}s.properties=y}}addFeatureVariant(s,c,g){const y={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(y.properties=s.properties),s.variants=s.variants||{},s.variants[c.targetId]=s.variants[c.targetId]||[],s.variants[c.targetId].push(y)}appendToResult(s,c,g,y,T){let E=s[c];E===void 0&&(E=s[c]=[]),E.push({featureIndex:g,feature:y,intersectionZ:T})}lookupSymbolFeatures(s,c,g,y,T,E){const D={};this.loadVTLayers();for(const W of s)this.loadMatchingFeature(D,{bucketIndex:c,sourceLayerIndex:g,featureIndex:W,layoutVertexArrayOffset:0},y,T,E);return D}loadFeature(s){const{featureIndex:c,sourceLayerIndex:g}=s;this.loadVTLayers();const y=this.sourceLayerCoder.decode(g),T=this.vtFeatures[y];if(T[c])return T[c];const E=this.vtLayers[y].feature(c);return T[c]=E,E}hasLayer(s){for(const c of this.bucketLayerIDs)for(const g of c)if(s===g)return!0;return!1}getId(s,c){let g=s.id;if(this.promoteId){const y=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(y!=null)if(Array.isArray(y)){if(!this.promoteIdExpression){const T=Ea(y);if(T.result!=="success"){const E=T.value.map(D=>`${D.key}: ${D.message}`).join(", ");return void yn(`Failed to create expression for promoteId: ${E}`)}this.promoteIdExpression=T.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Vc),g=this.promoteIdExpression.evaluate({zoom:0},s)}else g=s.properties[y];typeof g=="boolean"&&(g=Number(g))}return g}}function vx(u,s,c,g,y){return Nr(u,(T,E)=>{const D=s instanceof Ml?s.get(E):null;return D&&D.evaluate?D.evaluate(c,g,void 0,y):D})}function Vw(u,s){return s-u}jr(yx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const xx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class E_{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,g]=new Uint8Array(s,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=g>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const T=xx[15&g];if(!T)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(s,2,1),[D]=new Uint32Array(s,4,1);return new E_(D,E,T,s)}constructor(s,c=64,g=Float64Array,y){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=g,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const T=xx.indexOf(this.ArrayType),E=2*s*this.ArrayType.BYTES_PER_ELEMENT,D=s*this.IndexArrayType.BYTES_PER_ELEMENT,W=(8-D%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${g}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+D+W,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+E+D+W),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+D+W,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=s)}add(s,c){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=s,this.coords[this._pos++]=c,g}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return M_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,c,g,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:E,nodeSize:D}=this,W=[0,T.length-1,0],X=[];for(;W.length;){const ae=W.pop()||0,ce=W.pop()||0,fe=W.pop()||0;if(ce-fe<=D){for(let Pt=fe;Pt<=ce;Pt++){const zt=E[2*Pt],Kt=E[2*Pt+1];zt>=s&&zt<=g&&Kt>=c&&Kt<=y&&X.push(T[Pt])}continue}const ye=fe+ce>>1,_t=E[2*ye],St=E[2*ye+1];_t>=s&&_t<=g&&St>=c&&St<=y&&X.push(T[ye]),(ae===0?s<=_t:c<=St)&&(W.push(fe),W.push(ye-1),W.push(1-ae)),(ae===0?g>=_t:y>=St)&&(W.push(ye+1),W.push(ce),W.push(1-ae))}return X}within(s,c,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:T,nodeSize:E}=this,D=[0,y.length-1,0],W=[],X=g*g;for(;D.length;){const ae=D.pop()||0,ce=D.pop()||0,fe=D.pop()||0;if(ce-fe<=E){for(let Pt=fe;Pt<=ce;Pt++)wx(T[2*Pt],T[2*Pt+1],s,c)<=X&&W.push(y[Pt]);continue}const ye=fe+ce>>1,_t=T[2*ye],St=T[2*ye+1];wx(_t,St,s,c)<=X&&W.push(y[ye]),(ae===0?s-g<=_t:c-g<=St)&&(D.push(fe),D.push(ye-1),D.push(1-ae)),(ae===0?s+g>=_t:c+g>=St)&&(D.push(ye+1),D.push(ce),D.push(1-ae))}return W}}function M_(u,s,c,g,y,T){if(y-g<=c)return;const E=g+y>>1;bx(u,s,E,g,y,T),M_(u,s,c,g,E-1,1-T),M_(u,s,c,E+1,y,1-T)}function bx(u,s,c,g,y,T){for(;y>g;){if(y-g>600){const X=y-g+1,ae=c-g+1,ce=Math.log(X),fe=.5*Math.exp(2*ce/3),ye=.5*Math.sqrt(ce*fe*(X-fe)/X)*(ae-X/2<0?-1:1);bx(u,s,c,Math.max(g,Math.floor(c-ae*fe/X+ye)),Math.min(y,Math.floor(c+(X-ae)*fe/X+ye)),T)}const E=s[2*c+T];let D=g,W=y;for(Rd(u,s,g,c),s[2*y+T]>E&&Rd(u,s,g,y);D<W;){for(Rd(u,s,D,W),D++,W--;s[2*D+T]<E;)D++;for(;s[2*W+T]>E;)W--}s[2*g+T]===E?Rd(u,s,g,W):(W++,Rd(u,s,W,y)),W<=c&&(g=W+1),c<=W&&(y=W-1)}}function Rd(u,s,c,g){A_(u,c,g),A_(s,2*c,2*g),A_(s,2*c+1,2*g+1)}function A_(u,s,c){const g=u[s];u[s]=u[c],u[c]=g}function wx(u,s,c,g){const y=u-c,T=s-g;return y*y+T*T}n.$=ho,n.A=fl,n.B=Sa,n.C=Cl,n.D=Lh,n.E=dl,n.F=2,n.G=_d,n.H=Bv,n.I=Oo,n.J=Va,n.K=class extends vm{},n.L=ml,n.M=oa,n.N=Yc,n.O=Zc,n.P=rr,n.Q=Ef,n.R=Ic,n.S=lh,n.T=a_,n.U=fh,n.V=vm,n.W=op,n.X=Ea,n.Y=Zu,n.Z=Zl,n._=Xl,n.a=function(u){return po.API_CDN_URL_REGEX.test(u)},n.a$=Bi,n.a0=pl,n.a1=dh,n.a2=Kc,n.a3=Tf,n.a4=function(u){const s=u.value;let c=[];if(!s)return c;const g=Va(s);return g!=="string"?(c=c.concat([new vm(u.key,s,`string expected, "${g}" found`)]),c):(h_(s,!0)||(c=c.concat([new vm(u.key,s,`invalid url "${s}"`)])),c)},n.a5=Gi,n.a6=fp,n.a7=Us,n.a8=Mr,n.a9=class{constructor(u){this.specification=u}possiblyEvaluate(u,s){return Vn(u.expression.evaluate(s))}interpolate(u,s,c){return{x:pn(u.x,s.x,c),y:pn(u.y,s.y,c),z:pn(u.z,s.z,c),azimuthal:pn(u.azimuthal,s.azimuthal,c),polar:pn(u.polar,s.polar,c)}}},n.aA=Hi,n.aB=H,n.aC=_a,n.aD=vi,n.aE=Zi,n.aF=function(u,s){const c={};for(let g=0;g<s.length;g++){const y=s[g];y in u&&(c[y]=u[y])}return c},n.aG=li,n.aH=di,n.aI=class{constructor(u){this.entries={},this.scheduler=u}request(u,s,c,g){const y=this.entries[u]=this.entries[u]||{callbacks:[]};if(y.result){const[T,E]=y.result;return this.scheduler?this.scheduler.add(()=>{g(T,E)},s):g(T,E),()=>{}}return y.callbacks.push(g),y.cancel||(y.cancel=c((T,E)=>{y.result=[T,E];for(const D of y.callbacks)this.scheduler?this.scheduler.add(()=>{D(T,E)},s):D(T,E);setTimeout(()=>delete this.entries[u],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(T=>T!==g),y.callbacks.length||(y.cancel(),delete this.entries[u]))}}},n.aJ=function(u,s,c){const g=JSON.stringify(u.request);return u.data&&(this.deduped.entries[g]={result:[null,u.data]}),this.deduped.request(g,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},y=>{const T=Rc(u.request,(E,D,W,X)=>{E?y(E):D&&y(null,{vectorTile:c?void 0:new Cn.VectorTile(new Kp(D)),rawData:D,cacheControl:W,expires:X})});return()=>{T.cancel(),y()}},s)},n.aK=function(u){Wh++,Wh>xa&&(u.getActor().send("enforceCacheSizeLimit",ra),Wh=0)},n.aL=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},n.aM=Io,n.aN=d0,n.aO=v0,n.aP=f0,n.aQ=function(u,s){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){s(null,c)};for(let g=0;g<u.length;g++){const y=document.createElement("source");Pm(u[g])||(c.crossOrigin="Anonymous"),y.src=u[g],c.appendChild(y)}return{cancel:()=>{}}},n.aR=pm,n.aS=function(u){return fetch(u).then(s=>s.arrayBuffer()).then(s=>rv(s,0,u))},n.aT=mx,n.aU=class{constructor(u,s,c,g){this.id=u,this.position=s!=null?new qt(s[0],s[1]):new qt(0,0),this.orientation=c??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new Yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(u,s){if(ne(u.matrix,s,u.matrix),u.meshes)for(const c of u.meshes){const g=Yn.applyTransformFast(c.aabb,u.matrix);this.aabb.encapsulate(g)}if(u.children)for(const c of u.children)this._applyTransformations(c,u.matrix)}computeBoundsAndApplyParent(){const u=ie([]);for(const s of this.nodes)this._applyTransformations(s,u)}computeModelMatrix(u,s,c,g,y,T,E=!1){I0(this.matrix,this,u.transform,this.position,s,c,g,y,T,E)}upload(u){if(!this.uploaded){for(const s of this.nodes)d_(s,u);for(const s of this.nodes)xm(s);this.uploaded=!0}}destroy(){for(const u of this.nodes)p_(u)}},n.aV=pr,n.aW=vd,n.aX=Pi,n.aY=ji,n.aZ=nc,n.a_=go,n.aa=ps,n.ab=Qc,n.ac=zi,n.ad=oi,n.ae=Yt,n.af=yi,n.ag=Ml,n.ah=mc,n.ai=pn,n.aj=Fr,n.ak=zu,n.al=Ai,n.am=rs,n.an=class{constructor(u){this.specification=u}possiblyEvaluate(u,s){return function([c,g]){const y=Vn([1,c,g]);return{x:y.x,y:y.y,z:y.z}}(u.expression.evaluate(s))}interpolate(u,s,c){return{x:pn(u.x,s.x,c),y:pn(u.y,s.y,c),z:pn(u.z,s.z,c)}}},n.ao=function(u,s,c=0,g=!0){const y=new rr(c,c),T=u.sub(y),E=s.add(y),D=[T,new rr(E.x,T.y),E,new rr(T.x,E.y)];return g&&D.push(T.clone()),D},n.ap=function(u,s){const c=[];for(let g=0;g<u.length;g++){const y=Fi(g-1,-1,u.length-1),T=Fi(g+1,-1,u.length-1),E=u[g],D=u[T],W=u[y].sub(E).unit(),X=D.sub(E).unit(),ae=X.angleWithSep(W.x,W.y),ce=W.add(X).unit().mult(-1*s/Math.sin(ae/2));c.push(E.add(ce))}return c},n.aq=Jv,n.ar=pc,n.as=function(u,s,c=0){return ri(((s.x-c)*u.scale-u.x)*Fr,(s.y*u.scale-u.y)*Fr,Wi(s.z,s.y))},n.at=kt,n.au=nr,n.av=Ps,n.aw=uv,n.ax=function(u){let s=1/0,c=1/0,g=-1/0,y=-1/0;for(const T of u)s=Math.min(s,T.x),c=Math.min(c,T.y),g=Math.max(g,T.x),y=Math.max(y,T.y);return{min:new rr(s,c),max:new rr(g,y)}},n.ay=Jt,n.az=ne,n.b=function(u){return po.API_FONTS_REGEX.test(u)},n.b$=function(u,s,c){c*=.5;var g=s[0],y=s[1],T=s[2],E=s[3],D=Math.sin(c),W=Math.cos(c);return u[0]=g*W+y*D,u[1]=y*W-g*D,u[2]=T*W+E*D,u[3]=E*W-T*D,u},n.b0=bh,n.b1=fm,n.b2=function(){Pa.isLoading()||Pa.isLoaded()||tc()!=="deferred"||hp()},n.b3=Rf,n.b4=Ur,n.b5=jh,n.b6=qn,n.b7=Ng,n.b8=Mg,n.b9=qr,n.bA=function(u,s){const{x:c,y:g}=u.point,y=$_(c,g,u.worldSize/u._pixelsPerMercatorPixel,0,0);return ne(y,y,gg(rl(s)))},n.bB=I,n.bC=function(u){return u[0]=0,u[1]=0,u[2]=0,u},n.bD=function(u,s){return Math.hypot(s[0]-u[0],s[1]-u[1],s[2]-u[2])},n.bE=mi,n.bF=Gt,n.bG=si,n.bH=gd,n.bI=qo,n.bJ=qg,n.bK=function(u,s,c,g,y){const T=5*s+2;u.float32[T+0]=c,u.float32[T+1]=g,u.float32[T+2]=y},n.bL=hm,n.bM=qp,n.bN=Fo,n.bO=fo,n.bP=vy,n.bQ=E0,n.bR=Ty,n.bS=Ey,n.bT=Wg,n.bU=jv,n.bV=Kg,n.bW=E_,n.bX=Fi,n.bY=jt,n.bZ=gi,n.b_=xi,n.ba=Ia,n.bb=cu,n.bc=F_,n.bd=Hs,n.be=ed,n.bf=n_,n.bg=function(u,s){const c=mc(s.zoom);if(c===0)return rl(u);const g=Op(u),y=mg(g),T=vi(g.getWest())*s.worldSize,E=vi(g.getEast())*s.worldSize,D=di(g.getNorth())*s.worldSize,W=di(g.getSouth())*s.worldSize,X=[T,D,0],ae=[E,D,0],ce=[T,W,0],fe=[E,W,0],ye=ue([],s.globeMatrix);return oi(X,X,ye),oi(ae,ae,ye),oi(ce,ce,ye),oi(fe,fe,ye),y[0]=Rl(y[0],ce,c),y[1]=Rl(y[1],fe,c),y[2]=Rl(y[2],ae,c),y[3]=Rl(y[3],X,c),Yn.fromPoints(y)},n.bh=Bp,n.bi=ue,n.bj=Jf,n.bk=Rl,n.bl=nu,n.bm=Px,n.bn=xt,n.bo=se,n.bp=Cm,n.bq=Kp,n.br=Rc,n.bs=function(u,s){const c=[];for(const g in u)g in s||c.push(g);return c},n.bt=bi,n.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bv=Ki,n.bw=function(u){var s=new C(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},n.bx=ie,n.by=ge,n.bz=Y,n.c=Cu,n.c$=Xp,n.c0=$i,n.c1=bs,n.c2=function(u,s){return u[0]=-s[0],u[1]=-s[1],u[2]=-s[2],u[3]=s[3],u},n.c3=Lt,n.c4=function(u,s,c,g,y){var T,E=1/Math.tan(s/2);return u[0]=E/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=E,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,y!=null&&y!==1/0?(u[10]=(y+g)*(T=1/(g-y)),u[14]=2*y*g*T):(u[10]=-1,u[14]=-2*g),u},n.c5=function(u,s,c,g,y,T,E){var D=1/(s-c),W=1/(g-y),X=1/(T-E);return u[0]=-2*D,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*W,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*X,u[11]=0,u[12]=(s+c)*D,u[13]=(y+g)*W,u[14]=(E+T)*X,u[15]=1,u},n.c6=Ei,n.c7=function(u,s,c){u[4*s+0]=c[0],u[4*s+1]=c[1],u[4*s+2]=c[2],u[4*s+3]=c[3]},n.c8=Eh,n.c9=du,n.cA=_m,n.cB=Zt,n.cC=x0,n.cD=function(u){const s=x0(u,!0);return I([],[s[0],s[1],s[4],s[5]])},n.cE=le,n.cF=_s,n.cG=he,n.cH=function(u){const{x:s,y:c}=u.point,{lng:g,lat:y}=u._center;return $_(s,c,u.worldSize,g,y)},n.cI=Ut,n.cJ=ii,n.cK=Ih,n.cL=Q,n.cM=function(u,s,c){let g=0;for(let y=0;y<2;++y)u[y]>0&&(g+=(u[y]-0)*(u[y]-0)),s[y]<0&&(g+=(0-s[y])*(0-s[y]));return g},n.cN=function(u){return u*u*u*u*u},n.cO=wi,n.cP=45,n.cQ=Mh,n.cR=function(u,s,c){const g=Math.sqrt(u*u+s*s+c*c),y=g>0?Math.acos(c/g)*Ii:0;let T=u!==0||s!==0?Math.atan2(-s,-u)*Ii+90:0;return T<0&&(T+=360),[g,T,y]},n.cS=ri,n.cT=Vn,n.cU=Ji,n.cV=ei,n.cW=Yn,n.cX=Ct,n.cY=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},n.cZ=h_,n.c_=function(u,s){return u.readFields(U1,{icons:[]},s)},n.ca=Zs,n.cb=ma,n.cc=uc,n.cd=qt,n.ce=r0,n.cf=function(){var u=new C(4);return C!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},n.cg=function(u,s,c){var g=s[0],y=s[1],T=s[2],E=s[3],D=Math.sin(c),W=Math.cos(c);return u[0]=g*W+T*D,u[1]=y*W+E*D,u[2]=g*-D+T*W,u[3]=y*-D+E*W,u},n.ch=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]},n.ci=Mi,n.cj=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},n.ck=_r,n.cl=Li,n.cm=D_,n.cn=Ds,n.co=b0,n.cp=yu,n.cq=B_,n.cr=function(u,s,c,g,y,T,E,D,W){if(W.name==="globe")return B_(u,s,new yu(c,g,y),!1);const X=vd({z:c,x:g,y},W);return new Yn([(T+X.x/X.scale)*s,s*(X.y/X.scale),E],[(T+X.x2/X.scale)*s,s*(X.y2/X.scale),D])},n.cs=function(u,s,c){return u[0]=Math.min(s[0],c[0]),u[1]=Math.min(s[1],c[1]),u[2]=Math.min(s[2],c[2]),u[3]=Math.min(s[3],c[3]),u},n.ct=function(u,s,c){return u[0]=Math.max(s[0],c[0]),u[1]=Math.max(s[1],c[1]),u[2]=Math.max(s[2],c[2]),u[3]=Math.max(s[3],c[3]),u},n.cu=function(u){const s=Math.round((u+45+360)%360/90)%4;return wt[s]},n.cv=or,n.cw=Rt,n.cx=oe,n.cy=function(u){const s=ie(new Float64Array(16));ne(s,u.pixelMatrix,u.globeMatrix);const c=[0,pt,0],g=[0,vt,0];return oi(c,c,s),oi(g,g,s),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!yg(u,new qt(u.center.lat,90)),g[0]>0&&g[0]<=u.width&&g[1]>0&&g[1]<=u.height&&!yg(u,new qt(u.center.lat,-90))]},n.cz=function(u,s){const{scale:c}=u.tileTransform,g=c*Fr/(u.tileSize*Math.pow(2,s.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(y,T,E){var D=T[1],W=T[2],X=T[3],ae=E[0],ce=E[1];return y[0]=T[0]*ae,y[1]=D*ae,y[2]=W*ce,y[3]=X*ce,y}(new Float32Array(4),s.inverseAdjustmentMatrix,[g,g])},n.d=function(u){return po.API_TILEJSON_REGEX.test(u)},n.d$=Hf,n.d0=zh,n.d1=Zg,n.d2=Lu,n.d3=El,n.d4=Xo,n.d5=kc,n.d6=rn,n.d7=function(u){const s=u.indexOf(iu);return s>=0?u.slice(0,s):u},n.d8=function(u){return u.indexOf(iu)>=0},n.d9=function(u){const s=u.lastIndexOf(iu);return s>=0?u.slice(s+1):""},n.dA=V_,n.dB=uo,n.dC=Qs,n.dD=256,n.dE=function(u,s){const c=[0,0,0];return oi(c,c,Bp(rl(s.canonical))),oi(c,c,u),c},n.dF=u=>({u_matrix:new uc(u),u_texsize:new ma(u),u_pixels_to_tile_units:new pu(u),u_device_pixel_ratio:new Zs(u),u_width_scale:new Zs(u),u_floor_width_scale:new Zs(u),u_image:new Eh(u),u_units_to_pixels:new ma(u),u_tile_units_to_pixels:new Zs(u),u_alpha_discard_threshold:new Zs(u),u_trim_offset:new ma(u),u_trim_fade_range:new ma(u),u_trim_color:new Mh(u),u_emissive_strength:new Zs(u),u_zbias_factor:new Zs(u),u_tile_to_meter:new Zs(u),u_ground_shadow_factor:new du(u),u_pattern_transition:new Zs(u)}),n.dG=u=>({u_matrix:new uc(u),u_pixels_to_tile_units:new pu(u),u_device_pixel_ratio:new Zs(u),u_width_scale:new Zs(u),u_floor_width_scale:new Zs(u),u_units_to_pixels:new ma(u),u_dash_image:new Eh(u),u_gradient_image:new Eh(u),u_image_height:new Zs(u),u_texsize:new ma(u),u_tile_units_to_pixels:new Zs(u),u_alpha_discard_threshold:new Zs(u),u_trim_offset:new ma(u),u_trim_fade_range:new ma(u),u_trim_color:new Mh(u),u_emissive_strength:new Zs(u),u_zbias_factor:new Zs(u),u_tile_to_meter:new Zs(u),u_ground_shadow_factor:new du(u)}),n.dH=u=>({u_camera_to_center_distance:new Zs(u),u_extrude_scale:new pu(u),u_device_pixel_ratio:new Zs(u),u_matrix:new uc(u),u_inv_rot_matrix:new uc(u),u_merc_center:new ma(u),u_tile_id:new du(u),u_zoom_transition:new Zs(u),u_up_dir:new du(u),u_emissive_strength:new Zs(u)}),n.dI=Nf,n.dJ=Wb,n.dK=H_,n.dL=(u,s,c,g,y,T)=>{const E=u.transform,D=E.projection.name==="globe";let W;if(T.paint.get("circle-pitch-alignment")==="map")if(D){const ae=V_(E.zoom,s.canonical)*E._pixelsPerMercatorPixel;W=Float32Array.from([ae,0,0,ae])}else W=E.calculatePixelsToTileUnitsMatrix(c);else W=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const X={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(E.projection),u_matrix:u.translatePosMatrix(s.projMatrix,c,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ia.devicePixelRatio,u_extrude_scale:W,u_inv_rot_matrix:Dx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:T.paint.get("circle-emissive-strength")};if(D){X.u_inv_rot_matrix=g,X.u_merc_center=y,X.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],X.u_zoom_transition=mc(E.zoom);const ae=y[0]*Fr,ce=y[1]*Fr;X.u_up_dir=E.projection.upVector(new yu(0,0,0),ae,ce)}return X},n.dM=pv,n.dN=ko,n.dO=(u,s,c,g,y,T,E,D,W,X)=>{const ae=u.transform,ce=ae.pitch<15?hv(.07,.7,Jt((14-ae.zoom)/5,0,1)):.07,fe=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:dv(u,s,c,g),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:ae.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:y,u_width_scale:T,u_floor_width_scale:E,u_image:0,u_tile_units_to_pixels:fv(s,ae),u_units_to_pixels:[1/ae.pixelsToGLUnits[0],1/ae.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:D,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(fe?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:ce,u_tile_to_meter:Ji(s.tileID.canonical,0),u_ground_shadow_factor:W,u_pattern_transition:X}},n.dP=(u,s,c,g,y,T,E,D,W,X)=>{const ae=u.transform,ce=ae.calculatePixelsToTileUnitsMatrix(s),fe=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",ye=ae.pitch<15?hv(.07,.7,Jt((14-ae.zoom)/5,0,1)):.07;return{u_matrix:dv(u,s,c,g),u_pixels_to_tile_units:ce,u_device_pixel_ratio:T,u_width_scale:E,u_floor_width_scale:D,u_units_to_pixels:[1/ae.pixelsToGLUnits[0],1/ae.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:mv(c)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fv(s,u.transform),u_alpha_discard_threshold:0,u_trim_offset:W,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(fe?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:ye,u_tile_to_meter:Ji(s.tileID.canonical,0),u_ground_shadow_factor:X}},n.dQ=dr,n.dR=Qf,n.dS=Wi,n.dT=Ax,n.dU=Wp,n.dV=By,n.dW=_c,n.dX=450,n.dY=7,n.dZ=A1,n.d_=Zn,n.da=function(u){const s=[],c=u.id;return c===void 0&&s.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),s},n.db=function(u,s,c,g){return u.type==="custom"?new C1(u,s):new V1[u.type](u,s,c,g)},n.dc=Gr,n.dd=function(u){const s=u.indexOf(iu);return s>=0?u.slice(s+1):""},n.de=class extends jh{constructor(u,s){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},n.df=hh,n.dg=Fl,n.dh=function(u){return u({pluginStatus:Po,pluginURL:Ca}),hh.on("pluginStateChange",u),u},n.di=Lp,n.dj=class extends Ra{constructor(u){super(u),this.current=Xf}set(u,s,c){if(this.fetchUniformLocation(u,s)){for(let g=0;g<9;g++)if(c[g]!==this.current[g]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},n.dk=Ft,n.dl=function(u,s,c){const g=mc(c.zoom),y=u.style.map._antialias,T=u.terrain&&u.terrain.exaggeration()>0;return g===0&&!y&&!T},n.dm=function(u){const s=u.pixelsPerMeter,c=s/Ei(1,u.center.lat),g=ie(new Float64Array(16));return se(g,g,[u.point.x,u.point.y,0]),le(g,g,[c,c,s]),Float32Array.from(g)},n.dn=Op,n.dp=function(u){const s=or-5;u=Jt(u,-80.051129,s)/s*90;const c=Math.pow(Math.abs(Math.sin(Ai(u))),3);return Math.round(c*(yt.length-1))},n.dq=function(u,s,c,g){const y=s.getNorth(),T=s.getSouth(),E=s.getWest(),D=s.getEast(),W=1<<u.z,X=D-E,ae=y-T,ce=X/pe,fe=-ae/yt[c],ye=[0,ce,0,fe,0,0,y,E,0];if(u.z>0){const _t=180/g;k(ye,ye,[_t/X+1,0,0,0,_t/ae+1,0,-.5*_t/ce,.5*_t/fe,1])}return ye[2]=W,ye[5]=u.x,ye[8]=u.y,ye},n.dr=rl,n.ds=function(u,s,c){const g=ie(new Float64Array(16)),y=(s/(1<<u)-.5)*Math.PI*2;return me(g,c.globeMatrix,y),Float32Array.from(g)},n.dt=class{isDataAvailableAtPoint(u){const s=this._source();if(this.isUsingMockSource()||!s||u.y<0||u.y>1)return!1;const c=s.getSource().maxzoom,g=1<<c,y=Math.floor(u.x),T=Math.floor((u.x-y)*g),E=Math.floor(u.y*g),D=this.findDEMTileFor(new Io(c,y,c,T,E));return!(!D||!D.dem)}getAtPointOrZero(u,s=0){return this.getAtPoint(u,s)||0}getAtPoint(u,s,c=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const g=this._source();if(!g||u.y<0||u.y>1)return s;const y=g.getSource().maxzoom,T=1<<y,E=Math.floor(u.x),D=u.x-E,W=new Io(y,E,y,Math.floor(D*T),Math.floor(u.y*T)),X=this.findDEMTileFor(W);if(!X||!X.dem)return s;const ae=X.dem,ce=1<<X.tileID.canonical.z,fe=(D*ce-X.tileID.canonical.x)*ae.dim,ye=(u.y*ce-X.tileID.canonical.y)*ae.dim,_t=Math.floor(fe),St=Math.floor(ye);return(c?this.exaggeration():1)*pn(pn(ae.get(_t,St),ae.get(_t,St+1),ye-St),pn(ae.get(_t+1,St),ae.get(_t+1,St+1),ye-St),fe-_t)}getAtTileOffset(u,s,c){const g=1<<u.canonical.z;return this.getAtPointOrZero(new zi(u.wrap+(u.canonical.x+s/Fr)/g,(u.canonical.y+c/Fr)/g))}getAtTileOffsetFunc(u,s,c,g){return y=>{const T=this.getAtTileOffset(u,y.x,y.y),E=g.upVector(u.canonical,y.x,y.y);return jt(E,E,T*g.upVectorScale(u.canonical,s,c).metersToTile),E}}getForTilePoints(u,s,c,g){if(this.isUsingMockSource())return!1;const y=$h.create(this,u,g);return!!y&&(s.forEach(T=>{T[2]=this.exaggeration()*y.getElevationAt(T[0],T[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(u);if(!s||!s.dem)return null;const c=s.dem.tree,g=s.tileID,y=1<<u.canonical.z-g.canonical.z;let T=u.canonical.x/y-g.canonical.x,E=u.canonical.y/y-g.canonical.y,D=0;for(let W=0;W<u.canonical.z-g.canonical.z&&!c.leaves[D];W++){T*=2,E*=2;const X=2*Math.floor(E)+Math.floor(T);D=c.childOffsets[D]+X,T%=1,E%=1}return{min:this.exaggeration()*c.minimums[D],max:this.exaggeration()*c.maximums[D]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,s,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let s=!1,c=Number.MAX_VALUE,g=Number.MIN_VALUE;for(const y of u){const T=this.getMinMaxForTile(y.tileID);T&&(c=Math.min(c,T.min),g=Math.max(g,T.max),s=!0)}return s?{min:c,max:g}:null}},n.du=ey,n.dv=Fp,n.dw=function(u,s){return[Math.pow(u[0],2.2)*s,Math.pow(u[1],2.2)*s,Math.pow(u[2],2.2)*s]},n.dx=z,n.dy=function(u,s){var c=Math.sin(s),g=Math.cos(s);return u[0]=g,u[1]=c,u[2]=0,u[3]=-c,u[4]=g,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},n.dz=Si,n.e=po,n.e$=gx,n.e0=256,n.e1=gg,n.e2=pa,n.e3=me,n.e4=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[4],u[4]=s[5],u[5]=s[6],u[6]=s[8],u[7]=s[9],u[8]=s[10],u},n.e5=Qa,n.e6=lu,n.e7=tp,n.e8=function(u,s,c,g,y){return Jt((u-s)/(c-s)*(y-g)+g,g,y)},n.e9=fr,n.eA=function(u,s,c){return u[0]=s[0]/c[0],u[1]=s[1]/c[1],u[2]=s[2]/c[2],u},n.eB=Nt,n.eC=At,n.eD=Er,n.eE=function(u,s,c,g){return u[0]=s,u[1]=c,u[2]=g,u},n.eF=function([u,s,c]){const g=Math.hypot(u,s,c),y=Math.atan2(u,c),T=.5*Math.PI-Math.acos(-s/g);return new qt(ii(y),ii(T))},n.eG=Xt,n.eH=c_,n.eI=function(u){const s=u.navigator?u.navigator.userAgent:null;return!!function(c){if(Bs==null){const g=c.navigator?c.navigator.userAgent:null;Bs=!!c.safari||!(!g||!(/\b(iPad|iPhone|iPod)\b/.test(g)||g.match("Safari")&&!g.match("Chrome")))}return Bs}(u)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.eJ=function(u,s){ra=u,xa=s},n.eK=yg,n.eL=U_,n.eM=function(u){const s=[0,0,0],c=ie(new Float64Array(16));return ne(c,u.pixelMatrix,u.globeMatrix),oi(s,s,c),new rr(s[0],s[1])},n.eN=function(){const u=ud;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(kg),ud=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.eO=function(){Xp().acquire(kg)},n.eP=tc,n.eQ=function(u,s,c=!1){if(Po===Bo.deferred||Po===Bo.loading||Po===Bo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ca=ia.resolveURL(u),Po=Bo.deferred,If=s,uh(),c||hp()},n.eR=function(u){kh=ia.resolveURL(u),Dh||(Dh=new Lh(Xp(),new dl)),Dh.broadcast("setMeshoptUrl",kh)},n.eS=Ky,n.eT=function(u){Fg=ia.resolveURL(u),Dh||(Dh=new Lh(Xp(),new dl)),Dh.broadcast("setDracoUrl",Fg)},n.eU=Yy,n.eV=cd,n.eW=function(u){const s=ll();if(!s)return;const c=s.delete(va);u&&c.then(()=>u()).catch(u)},n.eX=wu,n.eY=jr,n.eZ=gc,n.e_=Da,n.ea=function(u,s){var c=s[0],g=s[1],y=s[2],T=s[3],E=s[4],D=s[5],W=s[6],X=s[7],ae=s[8],ce=ae*E-D*X,fe=-ae*T+D*W,ye=X*T-E*W,_t=c*ce+g*fe+y*ye;return _t?(u[0]=ce*(_t=1/_t),u[1]=(-ae*g+y*X)*_t,u[2]=(D*g-y*E)*_t,u[3]=fe*_t,u[4]=(ae*c-y*W)*_t,u[5]=(-D*c+y*T)*_t,u[6]=ye*_t,u[7]=(-X*c+g*W)*_t,u[8]=(E*c-g*T)*_t,u):null},n.eb=Ir,n.ec=vr,n.ed=u_,n.ee=function(u,s){if(u===s){var c=s[1],g=s[2],y=s[3],T=s[6],E=s[7],D=s[11];u[1]=s[4],u[2]=s[8],u[3]=s[12],u[4]=c,u[6]=s[9],u[7]=s[13],u[8]=g,u[9]=T,u[11]=s[14],u[12]=y,u[13]=E,u[14]=D}else u[0]=s[0],u[1]=s[4],u[2]=s[8],u[3]=s[12],u[4]=s[1],u[5]=s[5],u[6]=s[9],u[7]=s[13],u[8]=s[2],u[9]=s[6],u[10]=s[10],u[11]=s[14],u[12]=s[3],u[13]=s[7],u[14]=s[11],u[15]=s[15];return u},n.ef=Ht,n.eg=[1,1,1],n.eh=class{constructor(u,s,c,g){this.context=u,this.format=g,this.size=c,this.texture=u.gl.createTexture();const[y,T,E]=this.size,{gl:D}=u;D.bindTexture(D.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),D.texImage3D(D.TEXTURE_3D,0,this.format,y,T,E,0,s_(this.format),o_(this.format),s.data)}bind(u,s){const{context:c}=this,{gl:g}=c;g.bindTexture(g.TEXTURE_3D,this.texture),u!==this.minFilter&&(g.texParameteri(g.TEXTURE_3D,g.TEXTURE_MAG_FILTER,u),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_MIN_FILTER,u),this.minFilter=u),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_3D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},n.ei=$h,n.ej=function(u,s,c,g){var y=new C(4);return y[0]=u,y[1]=s,y[2]=c,y[3]=g,y},n.ek=Ri,n.el=function(u,s,c,g){var y=s[0],T=s[1],E=s[2],D=s[3];return u[0]=y+g*(c[0]-y),u[1]=T+g*(c[1]-T),u[2]=E+g*(c[2]-E),u[3]=D+g*(c[3]-D),u},n.em=Vh,n.en=Ja,n.eo=Pl,n.ep=function(u,s,c,g,y,T,E,D,W,X,ae,ce,fe,ye,_t,St){var Pt=new C(16);return Pt[0]=u,Pt[1]=s,Pt[2]=c,Pt[3]=g,Pt[4]=y,Pt[5]=T,Pt[6]=E,Pt[7]=D,Pt[8]=W,Pt[9]=X,Pt[10]=ae,Pt[11]=ce,Pt[12]=fe,Pt[13]=ye,Pt[14]=_t,Pt[15]=St,Pt},n.eq=Ot,n.er=vh,n.es=Uf,n.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new rr(1/0,1/0),max:new rr(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,s=!1){const c=by(new rr(0,0),new rr(Fr,Fr),u),g=[];if(s&&!Cg(c,this._globalClipBounds))return g;for(const y of this._activeRegions){if(y.hiddenByOverlap||!Cg(c,y))continue;const T=cb(y.min,y.max,u);g.push({min:T.min,max:T.max,sourceId:this._sourceIds[y.priority],footprint:y.footprint,footprintTileId:y.tileId,order:y.order,clipMask:y.clipMask,clipScope:y.clipScope})}return g}setSources(u){this._setSources(u.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const c=[];for(const g of s.cache.getVisibleCoordinates()){const y=s.cache.getTile(g).buckets[s.layer];y&&y.updateFootprints(g.toUnwrapped(),c)}return c},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(u){const s=u.getFootprints();if(s.length===0)return;const c=u.getOrder(),g=u.getClipMask(),y=u.getClipScope();for(const T of s){if(!T.footprint)continue;const E=by(T.footprint.min,T.footprint.max,T.id);this._activeRegions.push({min:E.min,max:E.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:T.id,footprint:T.footprint,order:c,clipMask:g,clipScope:y})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,c)=>s.priority-c.priority||Hp(s.min,c.min)||Hp(s.max,c.max)||s.order-c.order||s.clipMask-c.clipMask||function(g,y){const T=(E,D)=>E+D;return g.length-y.length||g.reduce(T,"").localeCompare(y.reduce(T,""))}(s.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let s=0;for(;!u&&s!==this._activeRegions.length;){const c=this._activeRegions[s],g=this._prevRegions[s];u=c.priority!==g.priority||!xy(c,g)||c.order!==g.order||c.clipMask!==g.clipMask||!Ki(c.clipScope,g.clipScope),++s}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==Gp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const s=c=>{const g=this._activeRegions;if(c>=g.length)return c;const y=g[c].priority;for(;c<g.length&&g[c].priority===y;)++c;return c};if(this._sourceIds.length>1){let c=0,g=s(c);for(;c!==g;){let y=c;const T=c;for(;y!==g;){const E=this._activeRegions[y];E.hiddenByOverlap=!1;for(let D=0;D<T;D++){const W=this._activeRegions[D];if(!W.hiddenByOverlap&&E.order===Gp&&Cg(E,W)&&(E.hiddenByOverlap=Sy(E.footprint,E.tileId,W.footprint,W.tileId),E.hiddenByOverlap))break}++y}c=g,g=s(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=u.length-1;s>=0;s--)this._addSource(u[s]);this._computeReplacement()}},n.eu=Gp,n.ev=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,s){const c=new Ia,g=new go,y=[],T=u+1+2,E=s[0]+1,D=s[0]+1+(1+s.length),W=(X,ae,ce)=>{let fe=X===T-1?X-2:X===0?X:X-1;return fe+=ce?24575:0,[fe,ae]};for(let X=0;X<T;++X)c.emplaceBack(...W(X,0,!0));for(let X=0;X<E;++X)for(let ae=0;ae<T;++ae)c.emplaceBack(...W(ae,X,(ae===0||ae===T-1)&&!0));for(let X=0;X<s.length;++X){const ae=s[X];for(let ce=0;ce<T;++ce)c.emplaceBack(...W(ce,ae,!0))}for(let X=0;X<s.length;++X){const ae=g.length,ce=s[X]+1+2,fe=new go;for(let St=0;St<ce-1;St++){const Pt=St===ce-2,zt=Pt?T*(D-s.length+X-St):T;for(let Kt=0;Kt<T-1;Kt++){const Qt=St*T+Kt;St===0||Pt||Kt===0||Kt===T-2?(fe.emplaceBack(Qt+1,Qt,Qt+zt),fe.emplaceBack(Qt+zt,Qt+zt+1,Qt+1)):(g.emplaceBack(Qt+1,Qt,Qt+zt),g.emplaceBack(Qt+zt,Qt+zt+1,Qt+1))}}const ye=Hs.simpleSegment(0,ae,c.length,g.length-ae);for(let St=0;St<fe.uint16.length;St+=3)g.emplaceBack(fe.uint16[St],fe.uint16[St+1],fe.uint16[St+2]);const _t=Hs.simpleSegment(0,ae,c.length,g.length-ae);y.push({withoutSkirts:ye,withSkirts:_t})}return{vertices:c,indices:g,segments:y}}_createGrid(u){const s=this._fillGridMeshWithLods(pe,yt);this._gridSegments=s.segments,this._gridBuffer=u.createVertexBuffer(s.vertices,F_.members),this._gridIndexBuffer=u.createIndexBuffer(s.indices,!0)}_createPoles(u){const s=new go;for(let E=0;E<=pe;E++)s.emplaceBack(0,E+1,E+2);this._poleIndexBuffer=u.createIndexBuffer(s,!0);const c=new Qa,g=new Qa,y=new Qa,T=new Qa;this._poleSegments=[];for(let E=0,D=0;E<Q;E++){const W=360/(1<<E);c.emplaceBack(0,-H,0,.5,0),g.emplaceBack(0,-H,0,.5,1),y.emplaceBack(0,-H,0,.5,.5),T.emplaceBack(0,-H,0,.5,.5);for(let X=0;X<=pe;X++){let ae=X/pe,ce=0;const fe=pn(0,W,ae),[ye,_t,St]=Dt(Lx,kx,fe,H);c.emplaceBack(ye,_t,St,ae,ce),g.emplaceBack(ye,_t,St,ae,1-ce);const Pt=Ai(fe);ae=.5+.5*Math.sin(Pt),ce=.5+.5*Math.cos(Pt),y.emplaceBack(ye,_t,St,ae,ce),T.emplaceBack(ye,_t,St,ae,1-ce)}this._poleSegments.push(Hs.simpleSegment(D,0,66,64)),D+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,Dp,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(g,Dp,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(y,Dp,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(T,Dp,!1)}getGridBuffers(u,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},n.ew=Vt,n.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.ey=ni,n.ez=Ui,n.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(s,c)=>String.fromCharCode(+("0x"+c))))},n.f0=yx,n.f1=av,n.f2=Fn,n.f3="hd_road_elevation",n.f4=Wo,n.f5=Nr,n.f6=xu,n.f7=Xg,n.f8=Su,n.f9=function(u,s,c,g,y,T,E,D=1,W,X,ae){u.createArrays(),u.tilePixelRatio=Fr/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const ce=u.layers[0].layout,fe=u.layers[0]._unevaluatedLayout._values,ye={};ye.scaleFactor=D,ye.textSizeScaleRange=ce.get("text-size-scale-range"),ye.iconSizeScaleRange=ce.get("icon-size-scale-range");const[_t,St]=ye.textSizeScaleRange,[Pt,zt]=ye.iconSizeScaleRange;ye.textScaleFactor=Jt(ye.scaleFactor,_t,St),ye.iconScaleFactor=Jt(ye.scaleFactor,Pt,zt);const Kt=fe["text-size"],Qt=fe["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:Ci,maxZoom:Di}=u.textSizeData;ye.compositeTextSizes=[Kt.possiblyEvaluate(new ps(Ci,{worldview:ae}),T),Kt.possiblyEvaluate(new ps(Di,{worldview:ae}),T)]}if(u.iconSizeData.kind==="composite"){const{minZoom:Ci,maxZoom:Di}=u.iconSizeData;ye.compositeIconSizes=[Qt.possiblyEvaluate(new ps(Ci,{worldview:ae}),T),Qt.possiblyEvaluate(new ps(Di,{worldview:ae}),T)]}ye.layoutTextSize=Kt.possiblyEvaluate(new ps(E+1,{worldview:ae}),T),ye.layoutIconSize=Qt.possiblyEvaluate(new ps(E+1,{worldview:ae}),T),ye.textMaxSize=Kt.possiblyEvaluate(new ps(18,{worldview:ae}),T);const Tt=ce.get("symbol-placement"),Wt=ce.get("text-rotation-alignment")==="map"&&Tt!=="point",ti=ce.get("text-size");let ci=!1;const ki=[];for(const Ci of u.features){const Di=ce.get("text-font").evaluate(Ci,{},T).join(","),Vi=ti.evaluate(Ci,{},T)*ye.textScaleFactor,Qi=ye.layoutTextSize.evaluate(Ci,{},T)*ye.textScaleFactor,br=ye.layoutIconSize.evaluate(Ci,{},T)*ye.iconScaleFactor,hr={horizontal:{},vertical:void 0},xr=Ci.text;let Sr,tr=[0,0];if(xr){const mn=xr.toString(),Tn=ce.get("text-letter-spacing").evaluate(Ci,{},T)*fo,bn=ce.get("text-line-height").evaluate(Ci,{},T)*fo,Rn=tg(mn)?Tn:0,Mn=ce.get("text-anchor").evaluate(Ci,{},T),Ln=ce.get("text-variable-anchor");if(!Ln){const sr=ce.get("text-radial-offset").evaluate(Ci,{},T);if(sr)tr=jv(Mn,[sr*fo,Yg]);else{const Dr=ce.get("text-offset").evaluate(Ci,{},T);tr=[Dr[0]*fo,Dr[1]*fo]}}let os=Wt?"center":ce.get("text-justify").evaluate(Ci,{},T);const Ts=Tt==="point",ai=Ts?ce.get("text-max-width").evaluate(Ci,{},T)*fo:1/0,hi=sr=>{u.allowVerticalPlacement&&eu(mn)&&(hr.vertical=jg(xr,s,c,y,Di,ai,bn,Mn,sr,Rn,tr,qo.vertical,!0,Qi,Vi,W))};if(!Wt&&Ln){const sr=os==="auto"?Ln.map(Br=>Kg(Br)):[os];let Dr=!1;for(let Br=0;Br<sr.length;Br++){const Or=sr[Br];if(!hr.horizontal[Or])if(Dr)hr.horizontal[Or]=hr.horizontal[0];else{const Xr=jg(xr,s,c,y,Di,ai,bn,"center",Or,Rn,tr,qo.horizontal,!1,Qi,Vi,W);Xr&&(hr.horizontal[Or]=Xr,Dr=Xr.positionedLines.length===1)}}hi("left")}else{if(os==="auto"&&(os=Kg(Mn)),Ts||ce.get("text-writing-mode").indexOf("horizontal")>=0||!eu(mn)){const sr=jg(xr,s,c,y,Di,ai,bn,Mn,os,Rn,tr,qo.horizontal,!1,Qi,Vi,W);sr&&(hr.horizontal[os]=sr)}hi(Ts?"left":os)}}let yr,Yi,er,Cr,Lr,an,Yr=!1;const zr=ce.get("icon-text-fit").evaluate(Ci,{},T);if(Ci.icon&&Ci.icon.hasPrimary()){const mn=qv(Ci.icon,u.iconSizeData,fe["icon-size"],T,u.zoom,Ci,W,ye.iconScaleFactor,ae);yr=mn.iconPrimary,er=mn.iconSecondary;const Tn=yr.toString();if(Yi=g.get(Tn),Yi&&(Lr=ce.get("icon-offset").evaluate(Ci,{},T),an=ce.get("icon-anchor").evaluate(Ci,{},T),Sr=r1(y.get(Tn),er?y.get(er.toString()):void 0,Lr,an),Yr=Yi.sdf,u.sdfIcons===void 0?u.sdfIcons=Yi.sdf:u.sdfIcons!==Yi.sdf&&yn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Yi.pixelRatio!==u.pixelRatio||ce.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),er){const bn=er.toString();Cr=g.get(bn)}}ci=ci||!(!Ci.icon||!Ci.icon.hasSecondary());const Ar=Jg(hr.horizontal)||hr.vertical;u.iconsInText||(u.iconsInText=!!Ar&&Ar.iconsInText);const vn=Qi*ye.textScaleFactor/fo,{defaultShapedIcon:Zr,verticallyShapedIcon:Kr}=d1(u,Sr,ce,Ci,T,hr,vn,Lr,zr);zr!=="none"&&Sr&&(Pv(Sr)||Iv(Sr))&&(rm(0,Yi,yr,Sr,Zr,zr,X,g,y),rm(0,Cr,er,Sr,Zr,zr,X,g,y),Kr&&(rm(0,Yi,yr,Sr,Kr,zr,X,g,y),rm(0,Cr,er,Sr,Kr,zr,X,g,y))),Sr=Zr,ki.push({feature:Ci,shapedTextOrientations:hr,shapedText:Ar,shapedIcon:Sr,iconPrimary:yr,iconSecondary:er,iconOffset:Lr,iconAnchor:an,verticallyShapedIcon:Kr,layoutTextSize:Qi,layoutIconSize:br,textOffset:tr,isSDFIcon:Yr,iconTextFit:zr})}return{featureData:ki,sizes:ye,hasAnySecondaryIcon:ci,textAlongLine:Wt,symbolPlacement:Tt}},n.fa=Nv,n.fb=function(u,s,c,g,y,T,E,D,W,X){const{featureData:ae,hasAnySecondaryIcon:ce,sizes:fe,textAlongLine:ye,symbolPlacement:_t}=s;for(const St of ae){const{shapedIcon:Pt,verticallyShapedIcon:zt,feature:Kt,shapedTextOrientations:Qt,shapedText:Tt,layoutTextSize:Wt,textOffset:ti,isSDFIcon:ci,iconPrimary:ki,iconSecondary:Ci,iconTextFit:Di,iconOffset:Vi}=St;Xv(Pt,X.iconPositions,ki,Ci),Xv(zt,X.iconPositions,ki,Ci),f1(Qt,X.iconPositions),h1(ki,Ci,X.iconPositions),(Tt||Pt)&&p1(u,Kt,Qt,Pt,zt,W,fe,Wt,0,ti,ci,g,y,E,D,ce,Di,Vi,ye,_t)}c&&u.generateCollisionDebugBuffers(T,u.collisionBoxArray,fe.textScaleFactor)},n.fc=Cn,n.fd=Am,n.fe=eo,n.ff=xn,n.fg=bv,n.fh=Sn,n.fi=function(u){let s=0;if(new Uint32Array(u,0,1)[0]!==Qy){const c=new Uint32Array(u,0,7),[,,g,y,T,E]=c;s=c.byteLength+y+T+E+T,(g!==u.byteLength||s>=u.byteLength)&&yn("Invalid b3dm header information.")}return rv(u,s)},n.fj=function(u,s){const c=mx(u);for(const g of c){for(const y of g.meshes)zw(y);g.lights&&(g.lightMeshIndex=g.meshes.length,g.meshes.push(Bw(g.lights,s)))}return c},n.fk=bm,n.fl=Gn,n.fm=Xy,n.fn=Pa,n.fo=Bo,n.fp=function(u){kl(),ha!=null&&ha.then(s=>{s.keys().then(c=>{for(let g=0;g<c.length-u;g++)s.delete(c[g]).catch(y=>yn(y.message))}).catch(c=>yn(c.message))}).catch(s=>yn(s.message))},n.g=function(u,s){return Fl(Oi(u,{method:"GET"}),s)},n.h=Oi,n.i=function(u){return po.API_STYLE_REGEX.test(u)&&!Cu(u)},n.j=function(u){return u.indexOf("mapbox:")===0},n.k=za,n.l=qh,n.m=function(u){return decodeURIComponent(atob(u).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.n=function(u,s){return Fl(Oi(u,{type:"json"}),s)},n.o=Xh,n.p=function(u,s){return Fl(Oi(u,{method:"POST"}),s)},n.q=ia,n.r=vo,n.s=function(u){try{const s=self[u];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Ru,n.u=function(){return function u(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},n.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},n.w=yn,n.x=function(){return Dg||(Dg=new wu),Dg},n.y=x_,n.z=Fu}),l(["./shared"],function(n){function S(ii){const wt=ii?ii.url.toString():void 0;return wt?performance.getEntriesByName(wt):[]}function C(ii){if(typeof ii=="number"||typeof ii=="boolean"||typeof ii=="string"||ii==null)return JSON.stringify(ii);if(Array.isArray(ii)){let Ft="[";for(const Vt of ii)Ft+=`${C(Vt)},`;return`${Ft}]`}let wt="{";for(const Ft of Object.keys(ii).sort())wt+=`${Ft}:${C(ii[Ft])},`;return`${wt}}`}function I(ii){let wt="";for(const Ft of n.bu)wt+=`/${C(ii[Ft])}`;return wt}class z{constructor(wt){this.keyCache={},this._layers={},this._layerConfigs={},wt&&this.replace(wt)}replace(wt,Ft){this._layerConfigs={},this._layers={},this.update(wt,[],Ft)}update(wt,Ft,Vt){this._options=Vt;for(const Jt of wt)this._layerConfigs[Jt.id]=Jt,(this._layers[Jt.id]=n.db(Jt,this.scope,null,this._options)).compileFilter(Vt),this.keyCache[Jt.id]&&delete this.keyCache[Jt.id];for(const Jt of Ft)delete this.keyCache[Jt],delete this._layerConfigs[Jt],delete this._layers[Jt];this.familiesBySource={};const ni=function(Jt,yi){const Fi={};for(let Oi=0;Oi<Jt.length;Oi++){const qi=Jt[Oi];let Bi=yi&&yi[qi.id];Bi||(qi.type==="symbol"?Bi=qi.id:(Bi=I(qi),qi.type==="line"&&qi.paint&&function pr(Nr){return typeof Nr=="string"&&Nr==="line-progress"||(Array.isArray(Nr)?Nr.some(pr):!(!Nr||typeof Nr!="object")&&Object.values(Nr).some(pr))}(qi.paint["line-width"])&&(Bi+=`/${C(qi.paint["line-width"])}`))),yi&&(yi[qi.id]=Bi);let dr=Fi[Bi];dr||(dr=Fi[Bi]=[]),dr.push(qi)}const bi=[];for(const Oi in Fi)bi.push(Fi[Oi]);return bi}(Object.values(this._layerConfigs),this.keyCache);for(const Jt of ni){const yi=Jt.map(dr=>this._layers[dr.id]),Fi=yi[0];if(Fi.visibility==="none")continue;const bi=Fi.source||"";let Oi=this.familiesBySource[bi];Oi||(Oi=this.familiesBySource[bi]={});const qi=Fi.sourceLayer||"_geojsonTileLayer";let Bi=Oi[qi];Bi||(Bi=Oi[qi]=[]),Bi.push(yi)}}}const $=1*n.e_;class k{constructor(wt){const Ft={},Vt=[];for(const Fi in wt){const bi=wt[Fi],Oi=Ft[Fi]={};for(const qi in bi.glyphs){const Bi=bi.glyphs[+qi];if(!Bi||Bi.bitmap.width===0||Bi.bitmap.height===0)continue;const dr=Bi.metrics.localGlyph?$:1,pr={x:0,y:0,w:Bi.bitmap.width+2*dr,h:Bi.bitmap.height+2*dr};Vt.push(pr),Oi[qi]=pr}}const{w:ni,h:Jt}=n.H(Vt),yi=new n.eZ({width:ni||1,height:Jt||1});for(const Fi in wt){const bi=wt[Fi];for(const Oi in bi.glyphs){const qi=bi.glyphs[+Oi];if(!qi||qi.bitmap.width===0||qi.bitmap.height===0)continue;const Bi=Ft[Fi][Oi],dr=qi.metrics.localGlyph?$:1;n.eZ.copy(qi.bitmap,yi,{x:0,y:0},{x:Bi.x+dr,y:Bi.y+dr},qi.bitmap)}}this.image=yi,this.positions=Ft}}n.eY(k,"GlyphAtlas");class Y{constructor(wt){this.tileID=new n.aM(wt.tileID.overscaledZ,wt.tileID.wrap,wt.tileID.canonical.z,wt.tileID.canonical.x,wt.tileID.canonical.y),this.tileZoom=wt.tileZoom,this.uid=wt.uid,this.zoom=wt.zoom,this.lut=wt.lut,this.canonical=wt.tileID.canonical,this.pixelRatio=wt.pixelRatio,this.tileSize=wt.tileSize,this.source=wt.source,this.scope=wt.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=wt.showCollisionBoxes,this.collectResourceTiming=!!wt.request&&wt.request.collectResourceTiming,this.promoteId=wt.promoteId,this.isSymbolTile=wt.isSymbolTile,this.tileTransform=n.aW(wt.tileID.canonical,wt.projection),this.projection=wt.projection,this.worldview=wt.worldview,this.localizableLayerIds=wt.localizableLayerIds,this.brightness=wt.brightness,this.extraShadowCaster=!!wt.extraShadowCaster,this.tessellationStep=wt.tessellationStep,this.scaleFactor=wt.scaleFactor,this.worldview=wt.worldview}parse(wt,Ft,Vt,ni,Jt,yi){this.status="parsing",this.data=wt,this.collisionBoxArray=new n.b0;const Fi=new n.e$(Object.keys(wt.layers).sort()),bi=new n.f0(this.tileID,this.promoteId);bi.bucketLayerIDs=[];const Oi={},qi=new n.f1(256,256),Bi={featureIndex:bi,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:qi,availableImages:Vt,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},dr=[],pr=Ft.familiesBySource[this.source];for(const Gr in pr){const rn=wt.layers[Gr];if(!rn)continue;let sn=!1,hn=!1,yn=!1;for(const Gn of pr[Gr])Gn[0].type==="symbol"?sn=!0:hn=!0,Gn[0].is3D()&&Gn[0].type!=="model"&&(yn=!0);if(this.extraShadowCaster&&!yn||this.isSymbolTile===!0&&!sn||this.isSymbolTile===!1&&!hn)continue;rn.version===1&&n.w(`Vector tile source "${this.source}" layer "${Gr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ts=Fi.encode(Gr),Hn=[];let Vn=!1;for(let Gn=0,qn=0;Gn<rn.length;Gn++){const Bs=rn.feature(Gn),bs=bi.getId(Bs,Gr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Gr)){const ls=Bs.properties?Bs.properties.worldview:null;if(this.worldview&&typeof ls=="string")if(ls==="all")Bs.properties.$localized=!0;else{if(!ls.split(",").includes(this.worldview))continue;Bs.properties.$localized=!0,Bs.properties.worldview=this.worldview}}!Vn&&Bs.properties&&Bs.properties.hasOwnProperty(n.f2)&&(Vn=!0),Hn.push({feature:Bs,id:bs,index:qn,sourceLayerIndex:ts}),qn++}Vn&&!Bi.elevationFeatures&&wt.layers.hasOwnProperty(n.f3)&&(Bi.elevationFeatures=n.f4.parseFrom(wt.layers[n.f3],this.canonical));for(const Gn of pr[Gr]){const qn=Gn[0];if(this.extraShadowCaster&&(!qn.is3D()||qn.type==="model")||this.isSymbolTile!==void 0&&qn.type==="symbol"!==this.isSymbolTile||qn.minzoom&&this.zoom<Math.floor(qn.minzoom)||qn.maxzoom&&this.zoom>=qn.maxzoom||qn.visibility==="none")continue;ie(Gn,this.zoom,Bi.brightness,Vt,this.worldview);const Bs=Oi[qn.id]=qn.createBucket({index:bi.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ts,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ni,worldview:this.worldview});bi.bucketLayerIDs.push(Gn.map(ls=>n.C(ls.id,ls.scope)));let bs=Bs.prepare?Bs.prepare():null;bs!=null?(bs=bs.then(()=>Bs.populate(Hn,Bi,this.tileID.canonical,this.tileTransform)),dr.push(bs)):Bs.populate(Hn,Bi,this.tileID.canonical,this.tileTransform)}}const Nr=()=>{let Gr,rn,sn,hn,yn,ts;qi.trim();const Hn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Vn=()=>{if(Gr)return this.status="done",yi(Gr);if(this.extraShadowCaster)this.status="done",yi(null,{buckets:Object.values(Oi).filter(qn=>!qn.isEmpty()),featureIndex:bi,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Bi.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(rn&&sn&&hn){const qn=new k(rn),Bs=new Map;for(const[Js,uo]of sn.entries()){const{imagePosition:Qs}=n.f7(Js,uo,n.f8);Bs.set(Js,Qs)}const bs={};for(const Js in Oi){const uo=Oi[Js];uo instanceof n.b1&&(ie(uo.layers,this.zoom,Bi.brightness,Vt,this.worldview),bs[Js]=n.f9(uo,rn,qn.positions,sn,Bs,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,yn,this.worldview))}const ls={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Jt,sn,yn,()=>{ls.iconsPending=!1,Gn(bs,qn,ls)}),this.rasterizeIfNeeded(Jt,hn,ts,()=>{ls.patternsPending=!1,Gn(bs,qn,ls)})}},Gn=(qn,Bs,bs,ls)=>{if(bs.iconsPending||bs.patternsPending)return;const Js=new n.fa(sn,hn,this.lut);for(const uo in Oi){const Qs=Oi[uo];if(uo in qn)n.fb(Qs,qn[uo],this.showCollisionBoxes,Vt,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,sn,Js);else if(Qs.hasPattern&&(Qs instanceof n.b7||Qs instanceof n.b8||Qs instanceof n.dU)){ie(Qs.layers,this.zoom,Bi.brightness,Vt,this.worldview);const Sc=Object.fromEntries(Js.patternPositions);Qs.addFeatures(Bi,this.tileID.canonical,Sc,Vt,this.tileTransform,this.brightness)}}this.status="done",yi(null,{buckets:Object.values(Oi).filter(uo=>!uo.isEmpty()),featureIndex:bi,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bs.image,lineAtlas:qi,imageAtlas:Js,brightness:Bi.brightness})};if(!this.extraShadowCaster){const qn=n.f5(Bi.glyphDependencies,ls=>Object.keys(ls).map(Number));Object.keys(qn).length?Jt.send("getGlyphs",{uid:this.uid,stacks:qn,scope:this.scope},(ls,Js)=>{Gr||(Gr=ls,rn=Js,Vn())},void 0,!1,Hn):rn={};const Bs=Array.from(Bi.iconDependencies.keys()).map(ls=>n.I.parse(ls));Bs.length?Jt.send("getImages",{images:Bs,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ls,Js)=>{Gr||(Gr=ls,sn=new Map,yn=this.updateImageMapAndGetImageTaskQueue(sn,Js,Bi.iconDependencies),Vn())},void 0,!1,Hn):(sn=new Map,yn=new Map);const bs=Array.from(Bi.patternDependencies.keys()).map(ls=>n.I.parse(ls));bs.length?Jt.send("getImages",{images:bs,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ls,Js)=>{Gr||(Gr=ls,hn=new Map,ts=this.updateImageMapAndGetImageTaskQueue(hn,Js,Bi.patternDependencies),Vn())},void 0,!1,Hn):(hn=new Map,ts=new Map)}if(Bi.elevationFeatures&&Bi.elevationFeatures.length>0){const qn=[];for(const bs of Object.values(Oi))if(bs instanceof n.b8){const ls=bs.getUnevaluatedPortalGraph();ls&&qn.push(ls)}const Bs=n.f6.evaluate(qn);for(const bs of Object.values(Oi))if(bs instanceof n.b8){const ls=wt.layers[Fi.decode(bs.sourceLayerIndex)];bs.setEvaluatedPortalGraph(Bs,ls,this.tileID.canonical,Bi.availableImages,Bi.brightness)}}Vn()};dr.length>0?Promise.allSettled(dr).then(Nr).catch(yi):Nr()}rasterizeIfNeeded(wt,Ft,Vt,ni){Array.from(Ft.values()).some(Jt=>Jt.usvg)?this.rasterize(wt,Ft,Vt,ni):ni()}updateImageMapAndGetImageTaskQueue(wt,Ft,Vt){const ni=new Map;for(const Jt of Ft.keys()){const yi=Vt.get(Jt)||[];for(const Fi of yi){const bi=Fi.toString(),Oi=Ft.get(Fi.id.toString());Oi.usvg?ni.has(bi)||(ni.set(bi,Fi),wt.set(bi,Object.assign({},Oi))):wt.set(bi,Oi)}}return ni}rasterize(wt,Ft,Vt,ni){this.rasterizeTask=wt.send("rasterizeImages",{scope:this.scope,tasks:Vt},(Jt,yi)=>{if(!Jt)for(const[Fi,bi]of yi.entries()){const Oi=Object.assign(Ft.get(Fi),{data:bi});Ft.set(Fi,Oi)}ni()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ie(ii,wt,Ft,Vt,ni){const Jt=new n.aa(wt,{brightness:Ft,worldview:ni});for(const yi of ii)yi.recalculate(Jt,Vt)}class ue extends n.E{constructor(wt,Ft,Vt,ni,Jt,yi,Fi){super(),this.actor=wt,this.layerIndex=Ft,this.availableImages=Vt,this.availableModels=ni,this.loadVectorData=yi||n.aJ,this.loading={},this.loaded={},this.deduped=new n.aI(wt.scheduler),this.isSpriteLoaded=Jt,this.scheduler=wt.scheduler,this.brightness=Fi}loadTile(wt,Ft){const Vt=wt.uid,ni=wt&&wt.request,Jt=ni&&ni.collectResourceTiming,yi=this.loading[Vt]=new Y(wt);yi.abort=this.loadVectorData(wt,(Fi,bi)=>{const Oi=!this.loading[Vt];if(delete this.loading[Vt],yi.cancelRasterize(),Oi||Fi||!bi)return yi.status="done",Oi||(this.loaded[Vt]=yi),Ft(Fi);const qi=bi.rawData,Bi={};bi.expires&&(Bi.expires=bi.expires),bi.cacheControl&&(Bi.cacheControl=bi.cacheControl),yi.vectorTile=bi.vectorTile||new n.fc.VectorTile(new n.bq(qi));const dr=()=>{yi.parse(yi.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(pr,Nr)=>{if(pr||!Nr)return Ft(pr);const Gr={};if(Jt){const rn=S(ni);rn.length>0&&(Gr.resourceTiming=JSON.parse(JSON.stringify(rn)))}Ft(null,n.h({rawTileData:qi.slice(0)},Nr,Bi,Gr))})};this.isSpriteLoaded?dr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(dr,{type:"parseTile",isSymbolTile:wt.isSymbolTile,zoom:wt.tileZoom}):dr()}),this.loaded=this.loaded||{},this.loaded[Vt]=yi})}reloadTile(wt,Ft){const Vt=this.loaded,ni=wt.uid;if(Vt&&Vt[ni]){const Jt=Vt[ni];Jt.scaleFactor=wt.scaleFactor,Jt.showCollisionBoxes=wt.showCollisionBoxes,Jt.projection=wt.projection,Jt.brightness=wt.brightness,Jt.tileTransform=n.aW(wt.tileID.canonical,wt.projection),Jt.extraShadowCaster=wt.extraShadowCaster,Jt.lut=wt.lut,Jt.worldview=wt.worldview;const yi=(Fi,bi)=>{const Oi=Jt.reloadCallback;Oi&&(delete Jt.reloadCallback,Jt.parse(Jt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Oi)),Ft(Fi,bi)};Jt.status==="parsing"?Jt.reloadCallback=yi:Jt.status==="done"&&(Jt.vectorTile?Jt.parse(Jt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,yi):yi())}else Ft(null,void 0)}abortTile(wt,Ft){const Vt=wt.uid,ni=this.loading[Vt];ni&&(ni.abort&&ni.abort(),delete this.loading[Vt]),Ft()}removeTile(wt,Ft){const Vt=this.loaded,ni=wt.uid;Vt&&Vt[ni]&&delete Vt[ni],Ft()}}class ne{loadTile(wt,Ft){const{uid:Vt,encoding:ni,rawImageData:Jt,padding:yi}=wt,Fi=ImageBitmap&&Jt instanceof ImageBitmap?this.getImageData(Jt,yi):Jt;Ft(null,new n.fd(Vt,Fi,ni,yi<1))}reloadTile(wt,Ft){Ft(null,null)}abortTile(wt,Ft){Ft()}removeTile(wt,Ft){Ft()}getImageData(wt,Ft){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(wt.width,wt.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=wt.width,this.offscreenCanvas.height=wt.height,this.offscreenCanvasContext.drawImage(wt,0,0,wt.width,wt.height);const Vt=this.offscreenCanvasContext.getImageData(-Ft,-Ft,wt.width+2*Ft,wt.height+2*Ft);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Vt}}n.bp.setPbf(n.bq);class se{constructor(wt){this._mrt=new n.bp(wt.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=wt.uid,this.tileID=wt.tileID,this.source=wt.source}parse(wt,Ft){const Vt=this._mrt;this.status="parsing",this._entireBuffer=wt;try{Vt.parseHeader(wt),this._isHeaderLoaded=!0;const ni=[];for(const Jt in Vt.layers){const yi=Vt.getLayer(Jt),Fi=yi.getDataRange(yi.getBandList()),bi=Vt.createDecodingTask(Fi),Oi=wt.slice(Fi.firstByte,Fi.lastByte+1),qi=n.bp.performDecoding(Oi,bi).then(Bi=>bi.complete(null,Bi)).catch(Bi=>bi.complete(Bi,null));ni.push(qi)}Promise.allSettled(ni).then(()=>Ft(null,Vt)).catch(Jt=>Ft(Jt))}catch(ni){Ft(ni)}}}class le{constructor(wt){this.actor=wt,this.loading={},this.loaded={}}loadTile(wt,Ft){const Vt=wt.uid,ni=wt.request,Jt=this.loading[Vt]=new se(wt),{cancel:yi}=n.br(ni,(Fi,bi,Oi,qi)=>{const Bi=!this.loading[Vt];if(delete this.loading[Vt],Bi||Fi||!bi)return Jt.status="done",Bi||(this.loaded[Vt]=Jt),Ft(Fi);Jt.parse(bi,(dr,pr)=>{if(dr||!pr)return Ft(dr);Ft(null,pr,Oi,qi)}),this.loaded[Vt]=Jt});Jt.abort=yi}reloadTile(wt,Ft){Ft(null,void 0)}abortTile(wt,Ft){const Vt=wt.uid,ni=this.loading[Vt];ni&&(ni.abort&&ni.abort(),delete this.loading[Vt]),Ft()}removeTile(wt,Ft){const Vt=wt.uid;this.loaded[Vt]&&delete this.loaded[Vt],Ft()}decodeRasterArray(wt,Ft){n.bp.performDecoding(wt.buffer,wt.task).then(Vt=>Ft(null,Vt)).catch(Vt=>Ft(Vt))}}const he=n.fc.VectorTileFeature.prototype.toGeoJSON;class me{constructor(wt){this._feature=wt,this.extent=n.aj,this.type=wt.type,this.properties=wt.tags,"id"in wt&&!isNaN(wt.id)&&(this.id=parseInt(wt.id,10))}loadGeometry(){if(this._feature.type===1){const wt=[];for(const Ft of this._feature.geometry)wt.push([new n.P(Ft[0],Ft[1])]);return wt}{const wt=[];for(const Ft of this._feature.geometry){const Vt=[];for(const ni of Ft)Vt.push(new n.P(ni[0],ni[1]));wt.push(Vt)}return wt}}toGeoJSON(wt,Ft,Vt){return he.call(this,wt,Ft,Vt)}}class ge{constructor(wt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.aj,this.length=wt.length,this._features=wt}feature(wt){return new me(this._features[wt])}}class xt{constructor(wt,Ft){this.name=wt,this.extent=n.aj,this.length=Ft.length,this._features=Ft}feature(wt){return new me(this._features[wt])}}class Et extends ge{constructor(wt){super([]),this.layers={};for(const Ft in wt)this.layers[Ft]=new xt(Ft,wt[Ft])}}const Lt=64/4096,Zt=128;class Ht{constructor(){this.features=new Map}clear(){this.features.clear()}load(wt=[],Ft){for(const Vt of wt){const ni=Vt.id;if(ni==null)continue;let Jt=this.features.get(ni);Jt&&this.updateCache(Jt,Ft),Vt.geometry?(Jt=Yt(Vt),this.updateCache(Jt,Ft),this.features.set(ni,Jt)):this.features.delete(ni),this.updateCache(Jt,Ft)}}updateCache(wt,Ft){for(const{canonical:Vt,uid:ni}of Object.values(Ft)){const{z:Jt,x:yi,y:Fi}=Vt;It(wt,Math.pow(2,Jt),yi,Fi)&&delete Ft[ni]}}getTile(wt,Ft,Vt){const ni=Math.pow(2,wt),Jt=[];for(const yi of this.features.values())It(yi,ni,Ft,Vt)&&Jt.push(Ut(yi,ni,Ft,Vt));return{features:Jt}}getFeatures(){return[...this.features.values()]}}function It({minX:ii,minY:wt,maxX:Ft,maxY:Vt},ni,Jt,yi){return ii<(Jt+1+Lt)/ni&&wt<(yi+1+Lt)/ni&&Ft>(Jt-Lt)/ni&&Vt>(yi-Lt)/ni}function Yt(ii){const{id:wt,geometry:Ft,properties:Vt}=ii;if(!Ft)return;if(Ft.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ni,coordinates:Jt}=Ft,yi={id:wt,type:1,geometry:[],tags:Vt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Fi=yi.geometry;if(ni==="Point")ri(Jt,Fi,yi);else if(ni==="MultiPoint")for(const bi of Jt)ri(bi,Fi,yi);else if(ni==="LineString")yi.type=2,ei(Jt,Fi,yi);else if(ni==="MultiLineString")yi.type=2,Ct(Jt,Fi,yi);else if(ni==="Polygon")yi.type=3,Ct(Jt,Fi,yi,!0);else{if(ni!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");yi.type=3;for(const bi of Jt)Ct(bi,Fi,yi,!0)}return yi}function ri([ii,wt],Ft,Vt){const ni=n.aD(ii);let Jt=n.aH(wt);Jt=Jt<0?0:Jt>1?1:Jt,Ft.push(ni,Jt),Vt.minX=Math.min(Vt.minX,ni),Vt.minY=Math.min(Vt.minY,Jt),Vt.maxX=Math.max(Vt.maxX,ni),Vt.maxY=Math.max(Vt.maxY,Jt)}function ei(ii,wt,Ft,Vt=!1,ni=!1){const Jt=[];for(const yi of ii)ri(yi,Jt,Ft);wt.push(Jt),Vt&&function(yi,Fi){let bi=0;for(let Oi=0,qi=yi.length,Bi=qi-2;Oi<qi;Bi=Oi,Oi+=2)bi+=(yi[Oi]-yi[Bi])*(yi[Oi+1]+yi[Bi+1]);if(bi>0===Fi)for(let Oi=0,qi=yi.length;Oi<qi/2;Oi+=2){const Bi=yi[Oi],dr=yi[Oi+1];yi[Oi]=yi[qi-2-Oi],yi[Oi+1]=yi[qi-1-Oi],yi[qi-2-Oi]=Bi,yi[qi-1-Oi]=dr}}(Jt,ni)}function Ct(ii,wt,Ft,Vt=!1){for(let ni=0;ni<ii.length;ni++)ei(ii[ni],wt,Ft,Vt,ni===0)}function Ut(ii,wt,Ft,Vt){const{id:ni,type:Jt,geometry:yi,tags:Fi}=ii,bi=[];if(Jt===1)(function(Oi,qi,Bi,dr,pr){for(let Nr=0;Nr<Oi.length;Nr+=2){const Gr=Math.round(n.aj*(Oi[Nr+0]*qi-Bi)),rn=Math.round(n.aj*(Oi[Nr+1]*qi-dr));pr.push([Gr,rn])}})(yi,wt,Ft,Vt,bi);else for(const Oi of yi)Mt(Oi,wt,Ft,Vt,bi);return{id:ni,type:Jt,geometry:bi,tags:Fi}}function Mt(ii,wt,Ft,Vt,ni){const yi=n.aj+Zt;let Fi;for(let bi=0;bi<ii.length-2;bi+=2){let Oi=Math.round(n.aj*(ii[bi+0]*wt-Ft)),qi=Math.round(n.aj*(ii[bi+1]*wt-Vt)),Bi=Math.round(n.aj*(ii[bi+2]*wt-Ft)),dr=Math.round(n.aj*(ii[bi+3]*wt-Vt));const pr=Bi-Oi,Nr=dr-qi;Oi<-128&&Bi<-128||(Oi<-128?(qi+=Math.round(Nr*((-128-Oi)/pr)),Oi=-128):Bi<-128&&(dr=qi+Math.round(Nr*((-128-Oi)/pr)),Bi=-128),qi<-128&&dr<-128||(qi<-128?(Oi+=Math.round(pr*((-128-qi)/Nr)),qi=-128):dr<-128&&(Bi=Oi+Math.round(pr*((-128-qi)/Nr)),dr=-128),Oi>=yi&&Bi>=yi||(Oi>=yi?(qi+=Math.round(Nr*((yi-Oi)/pr)),Oi=yi):Bi>=yi&&(dr=qi+Math.round(Nr*((yi-Oi)/pr)),Bi=yi),qi>=yi&&dr>=yi||(qi>=yi?(Oi+=Math.round(pr*((yi-qi)/Nr)),qi=yi):dr>=yi&&(Bi=Oi+Math.round(pr*((yi-qi)/Nr)),dr=yi),Fi&&Oi===Fi[Fi.length-1][0]&&qi===Fi[Fi.length-1][1]||(Fi=[[Oi,qi]],ni.push(Fi)),Fi.push([Bi,dr])))))}}var $t,jt,mi,Xi={exports:{}},Er=function(){if(mi)return Xi.exports;mi=1;var ii=n.fg(),wt=function(){if(jt)return $t;jt=1;var qi=n.fe(),Bi=n.ff().VectorTileFeature;function dr(Nr,Gr){this.options=Gr||{},this.features=Nr,this.length=Nr.length}function pr(Nr,Gr){this.id=typeof Nr.id=="number"?Nr.id:void 0,this.type=Nr.type,this.rawGeometry=Nr.type===1?[Nr.geometry]:Nr.geometry,this.properties=Nr.tags,this.extent=Gr||4096}return $t=dr,dr.prototype.feature=function(Nr){return new pr(this.features[Nr],this.options.extent)},pr.prototype.loadGeometry=function(){var Nr=this.rawGeometry;this.geometry=[];for(var Gr=0;Gr<Nr.length;Gr++){for(var rn=Nr[Gr],sn=[],hn=0;hn<rn.length;hn++)sn.push(new qi(rn[hn][0],rn[hn][1]));this.geometry.push(sn)}return this.geometry},pr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Nr=this.geometry,Gr=1/0,rn=-1/0,sn=1/0,hn=-1/0,yn=0;yn<Nr.length;yn++)for(var ts=Nr[yn],Hn=0;Hn<ts.length;Hn++){var Vn=ts[Hn];Gr=Math.min(Gr,Vn.x),rn=Math.max(rn,Vn.x),sn=Math.min(sn,Vn.y),hn=Math.max(hn,Vn.y)}return[Gr,sn,rn,hn]},pr.prototype.toGeoJSON=Bi.prototype.toGeoJSON,$t}();function Ft(qi){var Bi=new ii;return function(dr,pr){for(var Nr in dr.layers)pr.writeMessage(3,Vt,dr.layers[Nr])}(qi,Bi),Bi.finish()}function Vt(qi,Bi){var dr;Bi.writeVarintField(15,qi.version||1),Bi.writeStringField(1,qi.name||""),Bi.writeVarintField(5,qi.extent||4096);var pr={keys:[],values:[],keycache:{},valuecache:{}};for(dr=0;dr<qi.length;dr++)pr.feature=qi.feature(dr),Bi.writeMessage(2,ni,pr);var Nr=pr.keys;for(dr=0;dr<Nr.length;dr++)Bi.writeStringField(3,Nr[dr]);var Gr=pr.values;for(dr=0;dr<Gr.length;dr++)Bi.writeMessage(4,Oi,Gr[dr])}function ni(qi,Bi){var dr=qi.feature;dr.id!==void 0&&Bi.writeVarintField(1,dr.id),Bi.writeMessage(2,Jt,qi),Bi.writeVarintField(3,dr.type),Bi.writeMessage(4,bi,dr)}function Jt(qi,Bi){var dr=qi.feature,pr=qi.keys,Nr=qi.values,Gr=qi.keycache,rn=qi.valuecache;for(var sn in dr.properties){var hn=dr.properties[sn],yn=Gr[sn];if(hn!==null){yn===void 0&&(pr.push(sn),Gr[sn]=yn=pr.length-1),Bi.writeVarint(yn);var ts=typeof hn;ts!=="string"&&ts!=="boolean"&&ts!=="number"&&(hn=JSON.stringify(hn));var Hn=ts+":"+hn,Vn=rn[Hn];Vn===void 0&&(Nr.push(hn),rn[Hn]=Vn=Nr.length-1),Bi.writeVarint(Vn)}}}function yi(qi,Bi){return(Bi<<3)+(7&qi)}function Fi(qi){return qi<<1^qi>>31}function bi(qi,Bi){for(var dr=qi.loadGeometry(),pr=qi.type,Nr=0,Gr=0,rn=dr.length,sn=0;sn<rn;sn++){var hn=dr[sn],yn=1;pr===1&&(yn=hn.length),Bi.writeVarint(yi(1,yn));for(var ts=pr===3?hn.length-1:hn.length,Hn=0;Hn<ts;Hn++){Hn===1&&pr!==1&&Bi.writeVarint(yi(2,ts-1));var Vn=hn[Hn].x-Nr,Gn=hn[Hn].y-Gr;Bi.writeVarint(Fi(Vn)),Bi.writeVarint(Fi(Gn)),Nr+=Vn,Gr+=Gn}pr===3&&Bi.writeVarint(yi(7,1))}}function Oi(qi,Bi){var dr=typeof qi;dr==="string"?Bi.writeStringField(1,qi):dr==="boolean"?Bi.writeBooleanField(7,qi):dr==="number"&&(qi%1!=0?Bi.writeDoubleField(3,qi):qi<0?Bi.writeSVarintField(6,qi):Bi.writeVarintField(5,qi))}return Xi.exports=Ft,Xi.exports.fromVectorTileJs=Ft,Xi.exports.fromGeojsonVt=function(qi,Bi){Bi=Bi||{};var dr={};for(var pr in qi)dr[pr]=new wt(qi[pr].features,Bi),dr[pr].name=pr,dr[pr].version=Bi.version,dr[pr].extent=Bi.extent;return Ft({layers:dr})},Xi.exports.GeoJSONWrapper=wt,Xi.exports}(),Ir=n.fh(Er);const nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ii=>ii},si=Math.fround||(Gt=new Float32Array(1),ii=>(Gt[0]=+ii,Gt[0]));var Gt;const ui=3,oi=5,Si=6;class Li{constructor(wt){this.options=Object.assign(Object.create(nr),wt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(wt){const{log:Ft,minZoom:Vt,maxZoom:ni}=this.options;Ft&&console.time("total time");const Jt=`prepare ${wt.length} points`;Ft&&console.time(Jt),this.points=wt;const yi=[];for(let bi=0;bi<wt.length;bi++){const Oi=wt[bi];if(!Oi.geometry)continue;const[qi,Bi]=Oi.geometry.coordinates,dr=si(Nt(qi)),pr=si(gi(Bi));yi.push(dr,pr,1/0,bi,-1,1),this.options.reduce&&yi.push(0)}let Fi=this.trees[ni+1]=this._createTree(yi);Ft&&console.timeEnd(Jt);for(let bi=ni;bi>=Vt;bi--){const Oi=+Date.now();Fi=this.trees[bi]=this._createTree(this._cluster(Fi,bi)),Ft&&console.log("z%d: %d clusters in %dms",bi,Fi.numItems,+Date.now()-Oi)}return Ft&&console.timeEnd("total time"),this}getClusters(wt,Ft){let Vt=((wt[0]+180)%360+360)%360-180;const ni=Math.max(-90,Math.min(90,wt[1]));let Jt=wt[2]===180?180:((wt[2]+180)%360+360)%360-180;const yi=Math.max(-90,Math.min(90,wt[3]));if(wt[2]-wt[0]>=360)Vt=-180,Jt=180;else if(Vt>Jt){const Bi=this.getClusters([Vt,ni,180,yi],Ft),dr=this.getClusters([-180,ni,Jt,yi],Ft);return Bi.concat(dr)}const Fi=this.trees[this._limitZoom(Ft)],bi=Fi.range(Nt(Vt),gi(yi),Nt(Jt),gi(ni)),Oi=Fi.data,qi=[];for(const Bi of bi){const dr=this.stride*Bi;qi.push(Oi[dr+oi]>1?Mi(Oi,dr,this.clusterProps):this.points[Oi[dr+ui]])}return qi}getChildren(wt){const Ft=this._getOriginId(wt),Vt=this._getOriginZoom(wt),ni="No cluster with the specified id.",Jt=this.trees[Vt];if(!Jt)throw new Error(ni);const yi=Jt.data;if(Ft*this.stride>=yi.length)throw new Error(ni);const Fi=this.options.radius/(this.options.extent*Math.pow(2,Vt-1)),bi=Jt.within(yi[Ft*this.stride],yi[Ft*this.stride+1],Fi),Oi=[];for(const qi of bi){const Bi=qi*this.stride;yi[Bi+4]===wt&&Oi.push(yi[Bi+oi]>1?Mi(yi,Bi,this.clusterProps):this.points[yi[Bi+ui]])}if(Oi.length===0)throw new Error(ni);return Oi}getLeaves(wt,Ft,Vt){const ni=[];return this._appendLeaves(ni,wt,Ft=Ft||10,Vt=Vt||0,0),ni}getTile(wt,Ft,Vt){const ni=this.trees[this._limitZoom(wt)],Jt=Math.pow(2,wt),{extent:yi,radius:Fi}=this.options,bi=Fi/yi,Oi=(Vt-bi)/Jt,qi=(Vt+1+bi)/Jt,Bi={features:[]};return this._addTileFeatures(ni.range((Ft-bi)/Jt,Oi,(Ft+1+bi)/Jt,qi),ni.data,Ft,Vt,Jt,Bi),Ft===0&&this._addTileFeatures(ni.range(1-bi/Jt,Oi,1,qi),ni.data,Jt,Vt,Jt,Bi),Ft===Jt-1&&this._addTileFeatures(ni.range(0,Oi,bi/Jt,qi),ni.data,-1,Vt,Jt,Bi),Bi.features.length?Bi:null}getClusterExpansionZoom(wt){let Ft=this._getOriginZoom(wt)-1;for(;Ft<=this.options.maxZoom;){const Vt=this.getChildren(wt);if(Ft++,Vt.length!==1)break;wt=Vt[0].properties.cluster_id}return Ft}_appendLeaves(wt,Ft,Vt,ni,Jt){const yi=this.getChildren(Ft);for(const Fi of yi){const bi=Fi.properties;if(bi&&bi.cluster?Jt+bi.point_count<=ni?Jt+=bi.point_count:Jt=this._appendLeaves(wt,bi.cluster_id,Vt,ni,Jt):Jt<ni?Jt++:wt.push(Fi),wt.length===Vt)break}return Jt}_createTree(wt){const Ft=new n.bW(wt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Vt=0;Vt<wt.length;Vt+=this.stride)Ft.add(wt[Vt],wt[Vt+1]);return Ft.finish(),Ft.data=wt,Ft}_addTileFeatures(wt,Ft,Vt,ni,Jt,yi){for(const Fi of wt){const bi=Fi*this.stride,Oi=Ft[bi+oi]>1;let qi,Bi,dr;if(Oi)qi=kt(Ft,bi,this.clusterProps),Bi=Ft[bi],dr=Ft[bi+1];else{const Gr=this.points[Ft[bi+ui]];qi=Gr.properties;const[rn,sn]=Gr.geometry.coordinates;Bi=Nt(rn),dr=gi(sn)}const pr={type:1,geometry:[[Math.round(this.options.extent*(Bi*Jt-Vt)),Math.round(this.options.extent*(dr*Jt-ni))]],tags:qi};let Nr;Nr=Oi||this.options.generateId?Ft[bi+ui]:this.points[Ft[bi+ui]].id,Nr!==void 0&&(pr.id=Nr),yi.features.push(pr)}}_limitZoom(wt){return Math.max(this.options.minZoom,Math.min(Math.floor(+wt),this.options.maxZoom+1))}_cluster(wt,Ft){const{radius:Vt,extent:ni,reduce:Jt,minPoints:yi}=this.options,Fi=Vt/(ni*Math.pow(2,Ft)),bi=wt.data,Oi=[],qi=this.stride;for(let Bi=0;Bi<bi.length;Bi+=qi){if(bi[Bi+2]<=Ft)continue;bi[Bi+2]=Ft;const dr=bi[Bi],pr=bi[Bi+1],Nr=wt.within(bi[Bi],bi[Bi+1],Fi),Gr=bi[Bi+oi];let rn=Gr;for(const sn of Nr){const hn=sn*qi;bi[hn+2]>Ft&&(rn+=bi[hn+oi])}if(rn>Gr&&rn>=yi){let sn,hn=dr*Gr,yn=pr*Gr,ts=-1;const Hn=(Bi/qi<<5)+(Ft+1)+this.points.length;for(const Vn of Nr){const Gn=Vn*qi;if(bi[Gn+2]<=Ft)continue;bi[Gn+2]=Ft;const qn=bi[Gn+oi];hn+=bi[Gn]*qn,yn+=bi[Gn+1]*qn,bi[Gn+4]=Hn,Jt&&(sn||(sn=this._map(bi,Bi,!0),ts=this.clusterProps.length,this.clusterProps.push(sn)),Jt(sn,this._map(bi,Gn)))}bi[Bi+4]=Hn,Oi.push(hn/rn,yn/rn,1/0,Hn,-1,rn),Jt&&Oi.push(ts)}else{for(let sn=0;sn<qi;sn++)Oi.push(bi[Bi+sn]);if(rn>1)for(const sn of Nr){const hn=sn*qi;if(!(bi[hn+2]<=Ft)){bi[hn+2]=Ft;for(let yn=0;yn<qi;yn++)Oi.push(bi[hn+yn])}}}}return Oi}_getOriginId(wt){return wt-this.points.length>>5}_getOriginZoom(wt){return(wt-this.points.length)%32}_map(wt,Ft,Vt){if(wt[Ft+oi]>1){const yi=this.clusterProps[wt[Ft+Si]];return Vt?Object.assign({},yi):yi}const ni=this.points[wt[Ft+ui]].properties,Jt=this.options.map(ni);return Vt&&Jt===ni?Object.assign({},Jt):Jt}}function Mi(ii,wt,Ft){return{type:"Feature",id:ii[wt+ui],properties:kt(ii,wt,Ft),geometry:{type:"Point",coordinates:[(Vt=ii[wt],360*(Vt-.5)),Ri(ii[wt+1])]}};var Vt}function kt(ii,wt,Ft){const Vt=ii[wt+oi],ni=Vt>=1e4?`${Math.round(Vt/1e3)}k`:Vt>=1e3?Math.round(Vt/100)/10+"k":Vt,Jt=ii[wt+Si],yi=Jt===-1?{}:Object.assign({},Ft[Jt]);return Object.assign(yi,{cluster:!0,cluster_id:ii[wt+ui],point_count:Vt,point_count_abbreviated:ni})}function Nt(ii){return ii/360+.5}function gi(ii){const wt=Math.sin(ii*Math.PI/180),Ft=.5-.25*Math.log((1+wt)/(1-wt))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function Ri(ii){const wt=(180-360*ii)*Math.PI/180;return 360*Math.atan(Math.exp(wt))/Math.PI-90}function Rt(ii,wt,Ft,Vt){let ni=Vt;const Jt=wt+(Ft-wt>>1);let yi,Fi=Ft-wt;const bi=ii[wt],Oi=ii[wt+1],qi=ii[Ft],Bi=ii[Ft+1];for(let dr=wt+3;dr<Ft;dr+=3){const pr=Xt(ii[dr],ii[dr+1],bi,Oi,qi,Bi);if(pr>ni)yi=dr,ni=pr;else if(pr===ni){const Nr=Math.abs(dr-Jt);Nr<Fi&&(yi=dr,Fi=Nr)}}ni>Vt&&(yi-wt>3&&Rt(ii,wt,yi,Vt),ii[yi+2]=ni,Ft-yi>3&&Rt(ii,yi,Ft,Vt))}function Xt(ii,wt,Ft,Vt,ni,Jt){let yi=ni-Ft,Fi=Jt-Vt;if(yi!==0||Fi!==0){const bi=((ii-Ft)*yi+(wt-Vt)*Fi)/(yi*yi+Fi*Fi);bi>1?(Ft=ni,Vt=Jt):bi>0&&(Ft+=yi*bi,Vt+=Fi*bi)}return yi=ii-Ft,Fi=wt-Vt,yi*yi+Fi*Fi}function Hi(ii,wt,Ft,Vt){const ni={id:ii??null,type:wt,geometry:Ft,tags:Vt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(wt==="Point"||wt==="MultiPoint"||wt==="LineString")Ni(ni,Ft);else if(wt==="Polygon")Ni(ni,Ft[0]);else if(wt==="MultiLineString")for(const Jt of Ft)Ni(ni,Jt);else if(wt==="MultiPolygon")for(const Jt of Ft)Ni(ni,Jt[0]);return ni}function Ni(ii,wt){for(let Ft=0;Ft<wt.length;Ft+=3)ii.minX=Math.min(ii.minX,wt[Ft]),ii.minY=Math.min(ii.minY,wt[Ft+1]),ii.maxX=Math.max(ii.maxX,wt[Ft]),ii.maxY=Math.max(ii.maxY,wt[Ft+1])}function xi(ii,wt,Ft,Vt){if(!wt.geometry)return;const ni=wt.geometry.coordinates;if(ni&&ni.length===0)return;const Jt=wt.geometry.type,yi=Math.pow(Ft.tolerance/((1<<Ft.maxZoom)*Ft.extent),2);let Fi=[],bi=wt.id;if(Ft.promoteId?bi=wt.properties[Ft.promoteId]:Ft.generateId&&(bi=Vt||0),Jt==="Point")$i(ni,Fi);else if(Jt==="MultiPoint")for(const Oi of ni)$i(Oi,Fi);else if(Jt==="LineString")fr(ni,Fi,yi,!1);else if(Jt==="MultiLineString"){if(Ft.lineMetrics){for(const Oi of ni)Fi=[],fr(Oi,Fi,yi,!1),ii.push(Hi(bi,"LineString",Fi,wt.properties));return}ir(ni,Fi,yi,!1)}else if(Jt==="Polygon")ir(ni,Fi,yi,!0);else{if(Jt!=="MultiPolygon"){if(Jt==="GeometryCollection"){for(const Oi of wt.geometry.geometries)xi(ii,{id:bi,geometry:Oi,properties:wt.properties},Ft,Vt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oi of ni){const qi=[];ir(Oi,qi,yi,!0),Fi.push(qi)}}ii.push(Hi(bi,Jt,Fi,wt.properties))}function $i(ii,wt){wt.push(lr(ii[0]),Tr(ii[1]),0)}function fr(ii,wt,Ft,Vt){let ni,Jt,yi=0;for(let bi=0;bi<ii.length;bi++){const Oi=lr(ii[bi][0]),qi=Tr(ii[bi][1]);wt.push(Oi,qi,0),bi>0&&(yi+=Vt?(ni*qi-Oi*Jt)/2:Math.sqrt(Math.pow(Oi-ni,2)+Math.pow(qi-Jt,2))),ni=Oi,Jt=qi}const Fi=wt.length-3;wt[2]=1,Rt(wt,0,Fi,Ft),wt[Fi+2]=1,wt.size=Math.abs(yi),wt.start=0,wt.end=wt.size}function ir(ii,wt,Ft,Vt){for(let ni=0;ni<ii.length;ni++){const Jt=[];fr(ii[ni],Jt,Ft,Vt),wt.push(Jt)}}function lr(ii){return ii/360+.5}function Tr(ii){const wt=Math.sin(ii*Math.PI/180),Ft=.5-.25*Math.log((1+wt)/(1-wt))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function Rr(ii,wt,Ft,Vt,ni,Jt,yi,Fi){if(Vt/=wt,Jt>=(Ft/=wt)&&yi<Vt)return ii;if(yi<Ft||Jt>=Vt)return null;const bi=[];for(const Oi of ii){const qi=Oi.geometry;let Bi=Oi.type;const dr=ni===0?Oi.minX:Oi.minY,pr=ni===0?Oi.maxX:Oi.maxY;if(dr>=Ft&&pr<Vt){bi.push(Oi);continue}if(pr<Ft||dr>=Vt)continue;let Nr=[];if(Bi==="Point"||Bi==="MultiPoint")Jr(qi,Nr,Ft,Vt,ni);else if(Bi==="LineString")_r(qi,Nr,Ft,Vt,ni,!1,Fi.lineMetrics);else if(Bi==="MultiLineString")wr(qi,Nr,Ft,Vt,ni,!1);else if(Bi==="Polygon")wr(qi,Nr,Ft,Vt,ni,!0);else if(Bi==="MultiPolygon")for(const Gr of qi){const rn=[];wr(Gr,rn,Ft,Vt,ni,!0),rn.length&&Nr.push(rn)}if(Nr.length){if(Fi.lineMetrics&&Bi==="LineString"){for(const Gr of Nr)bi.push(Hi(Oi.id,Bi,Gr,Oi.tags));continue}Bi!=="LineString"&&Bi!=="MultiLineString"||(Nr.length===1?(Bi="LineString",Nr=Nr[0]):Bi="MultiLineString"),Bi!=="Point"&&Bi!=="MultiPoint"||(Bi=Nr.length===3?"Point":"MultiPoint"),bi.push(Hi(Oi.id,Bi,Nr,Oi.tags))}}return bi.length?bi:null}function Jr(ii,wt,Ft,Vt,ni){for(let Jt=0;Jt<ii.length;Jt+=3){const yi=ii[Jt+ni];yi>=Ft&&yi<=Vt&&Vr(wt,ii[Jt],ii[Jt+1],ii[Jt+2])}}function _r(ii,wt,Ft,Vt,ni,Jt,yi){let Fi=mr(ii);const bi=ni===0?wn:Nn;let Oi,qi,Bi=ii.start;for(let rn=0;rn<ii.length-3;rn+=3){const sn=ii[rn],hn=ii[rn+1],yn=ii[rn+2],ts=ii[rn+3],Hn=ii[rn+4],Vn=ni===0?sn:hn,Gn=ni===0?ts:Hn;let qn=!1;yi&&(Oi=Math.sqrt(Math.pow(sn-ts,2)+Math.pow(hn-Hn,2))),Vn<Ft?Gn>Ft&&(qi=bi(Fi,sn,hn,ts,Hn,Ft),yi&&(Fi.start=Bi+Oi*qi)):Vn>Vt?Gn<Vt&&(qi=bi(Fi,sn,hn,ts,Hn,Vt),yi&&(Fi.start=Bi+Oi*qi)):Vr(Fi,sn,hn,yn),Gn<Ft&&Vn>=Ft&&(qi=bi(Fi,sn,hn,ts,Hn,Ft),qn=!0),Gn>Vt&&Vn<=Vt&&(qi=bi(Fi,sn,hn,ts,Hn,Vt),qn=!0),!Jt&&qn&&(yi&&(Fi.end=Bi+Oi*qi),wt.push(Fi),Fi=mr(ii)),yi&&(Bi+=Oi)}let dr=ii.length-3;const pr=ii[dr],Nr=ii[dr+1],Gr=ni===0?pr:Nr;Gr>=Ft&&Gr<=Vt&&Vr(Fi,pr,Nr,ii[dr+2]),dr=Fi.length-3,Jt&&dr>=3&&(Fi[dr]!==Fi[0]||Fi[dr+1]!==Fi[1])&&Vr(Fi,Fi[0],Fi[1],Fi[2]),Fi.length&&wt.push(Fi)}function mr(ii){const wt=[];return wt.size=ii.size,wt.start=ii.start,wt.end=ii.end,wt}function wr(ii,wt,Ft,Vt,ni,Jt){for(const yi of ii)_r(yi,wt,Ft,Vt,ni,Jt,!1)}function Vr(ii,wt,Ft,Vt){ii.push(wt,Ft,Vt)}function wn(ii,wt,Ft,Vt,ni,Jt){const yi=(Jt-wt)/(Vt-wt);return Vr(ii,Jt,Ft+(ni-Ft)*yi,1),yi}function Nn(ii,wt,Ft,Vt,ni,Jt){const yi=(Jt-Ft)/(ni-Ft);return Vr(ii,wt+(Vt-wt)*yi,Jt,1),yi}function zs(ii,wt){const Ft=[];for(let Vt=0;Vt<ii.length;Vt++){const ni=ii[Vt],Jt=ni.type;let yi;if(Jt==="Point"||Jt==="MultiPoint"||Jt==="LineString")yi=es(ni.geometry,wt);else if(Jt==="MultiLineString"||Jt==="Polygon"){yi=[];for(const Fi of ni.geometry)yi.push(es(Fi,wt))}else if(Jt==="MultiPolygon"){yi=[];for(const Fi of ni.geometry){const bi=[];for(const Oi of Fi)bi.push(es(Oi,wt));yi.push(bi)}}Ft.push(Hi(ni.id,Jt,yi,ni.tags))}return Ft}function es(ii,wt){const Ft=[];Ft.size=ii.size,ii.start!==void 0&&(Ft.start=ii.start,Ft.end=ii.end);for(let Vt=0;Vt<ii.length;Vt+=3)Ft.push(ii[Vt]+wt,ii[Vt+1],ii[Vt+2]);return Ft}function As(ii,wt){if(ii.transformed)return ii;const Ft=1<<ii.z,Vt=ii.x,ni=ii.y;for(const Jt of ii.features){const yi=Jt.geometry,Fi=Jt.type;if(Jt.geometry=[],Fi===1)for(let bi=0;bi<yi.length;bi+=2)Jt.geometry.push(Dn(yi[bi],yi[bi+1],wt,Ft,Vt,ni));else for(let bi=0;bi<yi.length;bi++){const Oi=[];for(let qi=0;qi<yi[bi].length;qi+=2)Oi.push(Dn(yi[bi][qi],yi[bi][qi+1],wt,Ft,Vt,ni));Jt.geometry.push(Oi)}}return ii.transformed=!0,ii}function Dn(ii,wt,Ft,Vt,ni,Jt){return[Math.round(Ft*(ii*Vt-ni)),Math.round(Ft*(wt*Vt-Jt))]}function Sn(ii,wt,Ft,Vt,ni){const Jt=wt===ni.maxZoom?0:ni.tolerance/((1<<wt)*ni.extent),yi={features:[],numPoints:0,numSimplified:0,numFeatures:ii.length,source:null,x:Ft,y:Vt,z:wt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fi of ii)Os(yi,Fi,Jt,ni);return yi}function Os(ii,wt,Ft,Vt){const ni=wt.geometry,Jt=wt.type,yi=[];if(ii.minX=Math.min(ii.minX,wt.minX),ii.minY=Math.min(ii.minY,wt.minY),ii.maxX=Math.max(ii.maxX,wt.maxX),ii.maxY=Math.max(ii.maxY,wt.maxY),Jt==="Point"||Jt==="MultiPoint")for(let Fi=0;Fi<ni.length;Fi+=3)yi.push(ni[Fi],ni[Fi+1]),ii.numPoints++,ii.numSimplified++;else if(Jt==="LineString")Un(yi,ni,ii,Ft,!1,!1);else if(Jt==="MultiLineString"||Jt==="Polygon")for(let Fi=0;Fi<ni.length;Fi++)Un(yi,ni[Fi],ii,Ft,Jt==="Polygon",Fi===0);else if(Jt==="MultiPolygon")for(let Fi=0;Fi<ni.length;Fi++){const bi=ni[Fi];for(let Oi=0;Oi<bi.length;Oi++)Un(yi,bi[Oi],ii,Ft,!0,Oi===0)}if(yi.length){let Fi=wt.tags||null;if(Jt==="LineString"&&Vt.lineMetrics){Fi={};for(const Oi in wt.tags)Fi[Oi]=wt.tags[Oi];Fi.mapbox_clip_start=ni.start/ni.size,Fi.mapbox_clip_end=ni.end/ni.size}const bi={geometry:yi,type:Jt==="Polygon"||Jt==="MultiPolygon"?3:Jt==="LineString"||Jt==="MultiLineString"?2:1,tags:Fi};wt.id!==null&&(bi.id=wt.id),ii.features.push(bi)}}function Un(ii,wt,Ft,Vt,ni,Jt){const yi=Vt*Vt;if(Vt>0&&wt.size<(ni?yi:Vt))return void(Ft.numPoints+=wt.length/3);const Fi=[];for(let bi=0;bi<wt.length;bi+=3)(Vt===0||wt[bi+2]>yi)&&(Ft.numSimplified++,Fi.push(wt[bi],wt[bi+1])),Ft.numPoints++;ni&&function(bi,Oi){let qi=0;for(let Bi=0,dr=bi.length,pr=dr-2;Bi<dr;pr=Bi,Bi+=2)qi+=(bi[Bi]-bi[pr])*(bi[Bi+1]+bi[pr+1]);if(qi>0===Oi)for(let Bi=0,dr=bi.length;Bi<dr/2;Bi+=2){const pr=bi[Bi],Nr=bi[Bi+1];bi[Bi]=bi[dr-2-Bi],bi[Bi+1]=bi[dr-1-Bi],bi[dr-2-Bi]=pr,bi[dr-1-Bi]=Nr}}(Fi,Jt),ii.push(Fi)}const Ks={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xs{constructor(wt,Ft){const Vt=(Ft=this.options=function(Jt,yi){for(const Fi in yi)Jt[Fi]=yi[Fi];return Jt}(Object.create(Ks),Ft)).debug;if(Vt&&console.time("preprocess data"),Ft.maxZoom<0||Ft.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ft.promoteId&&Ft.generateId)throw new Error("promoteId and generateId cannot be used together.");let ni=function(Jt,yi){const Fi=[];if(Jt.type==="FeatureCollection")for(let bi=0;bi<Jt.features.length;bi++)xi(Fi,Jt.features[bi],yi,bi);else xi(Fi,Jt.type==="Feature"?Jt:{geometry:Jt},yi);return Fi}(wt,Ft);this.tiles={},this.tileCoords=[],Vt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ft.indexMaxZoom,Ft.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ni=function(Jt,yi){const Fi=yi.buffer/yi.extent;let bi=Jt;const Oi=Rr(Jt,1,-1-Fi,Fi,0,-1,2,yi),qi=Rr(Jt,1,1-Fi,2+Fi,0,-1,2,yi);return(Oi||qi)&&(bi=Rr(Jt,1,-Fi,1+Fi,0,-1,2,yi)||[],Oi&&(bi=zs(Oi,1).concat(bi)),qi&&(bi=bi.concat(zs(qi,-1)))),bi}(ni,Ft),ni.length&&this.splitTile(ni,0,0,0),Vt&&(ni.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(wt,Ft,Vt,ni,Jt,yi,Fi){const bi=[wt,Ft,Vt,ni],Oi=this.options,qi=Oi.debug;for(;bi.length;){ni=bi.pop(),Vt=bi.pop(),Ft=bi.pop(),wt=bi.pop();const Bi=1<<Ft,dr=eo(Ft,Vt,ni);let pr=this.tiles[dr];if(!pr&&(qi>1&&console.time("creation"),pr=this.tiles[dr]=Sn(wt,Ft,Vt,ni,Oi),this.tileCoords.push({z:Ft,x:Vt,y:ni}),qi)){qi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ft,Vt,ni,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));const qn=`z${Ft}`;this.stats[qn]=(this.stats[qn]||0)+1,this.total++}if(pr.source=wt,Jt==null){if(Ft===Oi.indexMaxZoom||pr.numPoints<=Oi.indexMaxPoints)continue}else{if(Ft===Oi.maxZoom||Ft===Jt)continue;if(Jt!=null){const qn=Jt-Ft;if(Vt!==yi>>qn||ni!==Fi>>qn)continue}}if(pr.source=null,wt.length===0)continue;qi>1&&console.time("clipping");const Nr=.5*Oi.buffer/Oi.extent,Gr=.5-Nr,rn=.5+Nr,sn=1+Nr;let hn=null,yn=null,ts=null,Hn=null,Vn=Rr(wt,Bi,Vt-Nr,Vt+rn,0,pr.minX,pr.maxX,Oi),Gn=Rr(wt,Bi,Vt+Gr,Vt+sn,0,pr.minX,pr.maxX,Oi);wt=null,Vn&&(hn=Rr(Vn,Bi,ni-Nr,ni+rn,1,pr.minY,pr.maxY,Oi),yn=Rr(Vn,Bi,ni+Gr,ni+sn,1,pr.minY,pr.maxY,Oi),Vn=null),Gn&&(ts=Rr(Gn,Bi,ni-Nr,ni+rn,1,pr.minY,pr.maxY,Oi),Hn=Rr(Gn,Bi,ni+Gr,ni+sn,1,pr.minY,pr.maxY,Oi),Gn=null),qi>1&&console.timeEnd("clipping"),bi.push(hn||[],Ft+1,2*Vt,2*ni),bi.push(yn||[],Ft+1,2*Vt,2*ni+1),bi.push(ts||[],Ft+1,2*Vt+1,2*ni),bi.push(Hn||[],Ft+1,2*Vt+1,2*ni+1)}}getTile(wt,Ft,Vt){wt=+wt,Ft=+Ft,Vt=+Vt;const ni=this.options,{extent:Jt,debug:yi}=ni;if(wt<0||wt>24)return null;const Fi=1<<wt,bi=eo(wt,Ft=Ft+Fi&Fi-1,Vt);if(this.tiles[bi])return As(this.tiles[bi],Jt);yi>1&&console.log("drilling down to z%d-%d-%d",wt,Ft,Vt);let Oi,qi=wt,Bi=Ft,dr=Vt;for(;!Oi&&qi>0;)qi--,Bi>>=1,dr>>=1,Oi=this.tiles[eo(qi,Bi,dr)];return Oi&&Oi.source?(yi>1&&(console.log("found parent tile z%d-%d-%d",qi,Bi,dr),console.time("drilling down")),this.splitTile(Oi.source,qi,Bi,dr,wt,Ft,Vt),yi>1&&console.timeEnd("drilling down"),this.tiles[bi]?As(this.tiles[bi],Jt):null):null}}function eo(ii,wt,Ft){return 32*((1<<ii)*Ft+wt)+ii}function rr(ii,wt){const Ft=ii.tileID.canonical;if(!this._geoJSONIndex)return void wt(null,null);const Vt=this._geoJSONIndex.getTile(Ft.z,Ft.x,Ft.y);if(!Vt)return void wt(null,null);const ni=bi=>bi.tags&&"3d_elevation_id"in bi.tags&&"source"in bi.tags&&bi.tags.source==="elevation",Jt=Vt.features.filter(bi=>ni(bi));let yi;if(Jt.length>0){const bi=Vt.features.filter(Oi=>!ni(Oi));yi=new Et({_geojsonTileLayer:bi,hd_road_elevation:Jt})}else yi=new ge(Vt.features);let Fi=Ir(yi);Fi.byteOffset===0&&Fi.byteLength===Fi.buffer.byteLength||(Fi=new Uint8Array(Fi)),wt(null,{vectorTile:yi,rawData:Fi.buffer})}class Ki extends ue{constructor(wt,Ft,Vt,ni,Jt,yi,Fi){super(wt,Ft,Vt,ni,Jt,rr,Fi),yi&&(this.loadGeoJSON=yi),this._dynamicIndex=new Ht}loadData(wt,Ft){const Vt=wt&&wt.request,ni=Vt&&Vt.collectResourceTiming;this.loadGeoJSON(wt,(Jt,yi)=>{if(Jt||!yi)return Ft(Jt);if(typeof yi!="object")return Ft(new Error(`Input data given to '${wt.source}' is not a valid GeoJSON object.`));{try{if(wt.filter){const bi=n.X(wt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(bi.result==="error")throw new Error(bi.value.map(Oi=>`${Oi.key}: ${Oi.message}`).join(", "));yi.features=yi.features.filter(Oi=>bi.value.evaluate({zoom:0},Oi))}wt.dynamic?(yi.type==="Feature"&&(yi={type:"FeatureCollection",features:[yi]}),wt.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(yi.features,this.loaded),wt.cluster&&(yi.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=wt.cluster?new Li(function({superclusterOptions:bi,clusterProperties:Oi}){if(!Oi||!bi)return bi;const qi={},Bi={},dr={accumulated:null,zoom:0},pr={properties:null},Nr=Object.keys(Oi);for(const Gr of Nr){const[rn,sn]=Oi[Gr],hn=n.X(sn),yn=n.X(typeof rn=="string"?[rn,["accumulated"],["get",Gr]]:rn);qi[Gr]=hn.value,Bi[Gr]=yn.value}return bi.map=Gr=>{pr.properties=Gr;const rn={};for(const sn of Nr)rn[sn]=qi[sn].evaluate(dr,pr);return rn},bi.reduce=(Gr,rn)=>{pr.properties=rn;for(const sn of Nr)dr.accumulated=Gr[sn],Gr[sn]=Bi[sn].evaluate(dr,pr)},bi}(wt)).load(yi.features):wt.dynamic?this._dynamicIndex:function(bi,Oi){return new xs(bi,Oi)}(yi,wt.geojsonVtOptions)}catch(bi){return Ft(bi)}const Fi={};if(ni){const bi=S(Vt);bi&&(Fi.resourceTiming={},Fi.resourceTiming[wt.source]=JSON.parse(JSON.stringify(bi)))}Ft(null,Fi)}})}reloadTile(wt,Ft){const Vt=this.loaded;return Vt&&Vt[wt.uid]?wt.partial?Ft(null,void 0):super.reloadTile(wt,Ft):this.loadTile(wt,Ft)}loadGeoJSON(wt,Ft){if(wt.request)n.n(wt.request,Ft);else{if(typeof wt.data!="string")return Ft(new Error(`Input data given to '${wt.source}' is not a valid GeoJSON object.`));try{return Ft(null,JSON.parse(wt.data))}catch{return Ft(new Error(`Input data given to '${wt.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(wt,Ft){try{Ft(null,this._geoJSONIndex.getClusterExpansionZoom(wt.clusterId))}catch(Vt){Ft(Vt)}}getClusterChildren(wt,Ft){try{Ft(null,this._geoJSONIndex.getChildren(wt.clusterId))}catch(Vt){Ft(Vt)}}getClusterLeaves(wt,Ft){try{Ft(null,this._geoJSONIndex.getLeaves(wt.clusterId,wt.limit,wt.offset))}catch(Vt){Ft(Vt)}}}class pi{constructor(wt,Ft,Vt){this.tileID=new n.aM(wt.tileID.overscaledZ,wt.tileID.wrap,wt.tileID.canonical.z,wt.tileID.canonical.x,wt.tileID.canonical.y),this.tileZoom=wt.tileZoom,this.uid=wt.uid,this.zoom=wt.zoom,this.canonical=wt.tileID.canonical,this.pixelRatio=wt.pixelRatio,this.tileSize=wt.tileSize,this.source=wt.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=wt.projection,this.brightness=Ft,this.worldview=Vt}parse(wt,Ft,Vt,ni){this.status="parsing";const Jt=new n.aM(Vt.tileID.overscaledZ,Vt.tileID.wrap,Vt.tileID.canonical.z,Vt.tileID.canonical.x,Vt.tileID.canonical.y),yi=[],Fi=Ft.familiesBySource[Vt.source],bi=new n.f0(Jt,Vt.promoteId);bi.bucketLayerIDs=[],bi.is3DTile=!0,n.fi(wt).then(Oi=>{if(!Oi)return ni(new Error("Could not parse tile"));const qi=Oi.json.extensionsUsed&&Oi.json.extensionsUsed.includes("MAPBOX_mesh_features")||Oi.json.asset.extras&&Oi.json.asset.extras.MAPBOX_mesh_features,Bi=Oi.json.extensionsUsed&&Oi.json.extensionsUsed.includes("EXT_meshopt_compression"),dr=new n.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const pr in Fi)for(const Nr of Fi[pr]){const Gr=Nr[0];bi.bucketLayerIDs.push(Nr.map(hn=>n.C(hn.id,hn.scope))),Gr.recalculate(dr,[]);const rn=n.fj(Oi,1/n.cU(Vt.tileID.canonical)),sn=new n.fk(Nr,rn,Jt,qi,Bi,this.brightness,bi,this.worldview);qi||(sn.needsUpload=!0),yi.push(sn),sn.evaluate(Gr)}this.status="done",ni(null,{buckets:yi,featureIndex:bi,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Oi=>ni(new Error(Oi.message)))}}class Ii{constructor(wt,Ft,Vt,ni,Jt,yi,Fi,bi){this.actor=wt,this.layerIndex=Ft,this.availableImages=Vt,this.availableModels=ni,this.brightness=Fi,this.loading={},this.loaded={},this.worldview=bi}loadTile(wt,Ft){const Vt=wt.uid,ni=this.loading[Vt]=new pi(wt,this.brightness,this.worldview);n.br(wt.request,(Jt,yi)=>{const Fi=!this.loading[Vt];return delete this.loading[Vt],Fi||Jt?(ni.status="done",Fi||(this.loaded[Vt]=ni),Ft(Jt)):yi&&yi.byteLength!==0?void ni.parse(yi,this.layerIndex,wt,(bi,Oi)=>{ni.status="done",this.loaded=this.loaded||{},this.loaded[Vt]=ni,bi||!Oi?Ft(bi):Ft(null,Oi)}):(ni.status="done",this.loaded[Vt]=ni,Ft())})}reloadTile(wt,Ft){const Vt=this.loaded,ni=wt.uid;if(Vt&&Vt[ni]){const Jt=Vt[ni];Jt.projection=wt.projection,Jt.brightness=wt.brightness;const yi=(Fi,bi)=>{Jt.reloadCallback&&(delete Jt.reloadCallback,this.loadTile(wt,Ft)),Ft(Fi,bi)};Jt.status==="parsing"?Jt.reloadCallback=yi:Jt.status==="done"&&this.loadTile(wt,Ft)}}abortTile(wt,Ft){const Vt=wt.uid;this.loading[Vt]&&delete this.loading[Vt],Ft()}removeTile(wt,Ft){const Vt=this.loaded,ni=wt.uid;Vt&&Vt[ni]&&delete Vt[ni],Ft()}}class Ai{constructor(wt){this.self=wt,this.actor=new n.fm(wt,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.ce({name:"mercator"}),this.workerSourceTypes={vector:ue,geojson:Ki,"raster-dem":ne,"raster-array":le,"batched-model":Ii},this.workerSources={},this.self.registerWorkerSource=(Ft,Vt)=>{if(this.workerSourceTypes[Ft])throw new Error(`Worker source with name "${Ft}" already registered.`);this.workerSourceTypes[Ft]=Vt},this.self.registerRTLTextPlugin=Ft=>{if(n.fn.isParsed())throw new Error("RTL text plugin already registered.");n.fn.setState({pluginStatus:n.fo.parsed,pluginURL:n.fn.getPluginURL()}),n.fn.applyArabicShaping=Ft.applyArabicShaping,n.fn.processBidirectionalText=Ft.processBidirectionalText,n.fn.processStyledBidirectionalText=Ft.processStyledBidirectionalText;for(const Vt of this.rtlPluginParsingListeners)Vt(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(wt,Ft,Vt){delete this.layerIndexes[wt],delete this.availableImages[wt],delete this.availableModels[wt],delete this.workerSources[wt],Vt()}checkIfReady(wt,Ft,Vt){Vt()}setReferrer(wt,Ft){this.referrer=Ft}spriteLoaded(wt,Ft){this.isSpriteLoaded[wt]||(this.isSpriteLoaded[wt]={});const{scope:Vt,isLoaded:ni}=Ft;if(this.isSpriteLoaded[wt][Vt]=ni,this.workerSources[wt]&&this.workerSources[wt][Vt])for(const Jt in this.workerSources[wt][Vt]){const yi=this.workerSources[wt][Vt][Jt];for(const Fi in yi){const bi=yi[Fi];bi instanceof ue&&(bi.isSpriteLoaded=ni,bi.fire(new n.A("isSpriteLoaded")))}}}setImages(wt,Ft,Vt){this.availableImages[wt]||(this.availableImages[wt]={});const{scope:ni,images:Jt}=Ft;if(this.availableImages[wt][ni]=Jt,this.workerSources[wt]&&this.workerSources[wt][ni]){for(const yi in this.workerSources[wt][ni]){const Fi=this.workerSources[wt][ni][yi];for(const bi in Fi)Fi[bi].availableImages=Jt}Vt()}else Vt()}setModels(wt,{scope:Ft,models:Vt},ni){if(this.availableModels[wt]||(this.availableModels[wt]={}),this.availableModels[wt][Ft]=Vt,this.workerSources[wt]&&this.workerSources[wt][Ft]){for(const Jt in this.workerSources[wt][Ft]){const yi=this.workerSources[wt][Ft][Jt];for(const Fi in yi)yi[Fi].availableModels=Vt}ni()}else ni()}setProjection(wt,Ft){this.projections[wt]=n.ce(Ft)}setBrightness(wt,Ft,Vt){this.brightness=Ft,Vt()}setWorldview(wt,Ft,Vt){this.worldview=Ft,Vt()}setLayers(wt,Ft,Vt){this.getLayerIndex(wt,Ft.scope).replace(Ft.layers,Ft.options),Vt()}updateLayers(wt,Ft,Vt){this.getLayerIndex(wt,Ft.scope).update(Ft.layers,Ft.removedIds,Ft.options),Vt()}loadTile(wt,Ft,Vt){Ft.projection=this.projections[wt]||this.defaultProjection,this.getWorkerSource(wt,Ft.type,Ft.source,Ft.scope).loadTile(Ft,Vt)}decodeRasterArray(wt,Ft,Vt){this.getWorkerSource(wt,Ft.type,Ft.source,Ft.scope).decodeRasterArray(Ft,Vt)}reloadTile(wt,Ft,Vt){Ft.projection=this.projections[wt]||this.defaultProjection,this.getWorkerSource(wt,Ft.type,Ft.source,Ft.scope).reloadTile(Ft,Vt)}abortTile(wt,Ft,Vt){this.getWorkerSource(wt,Ft.type,Ft.source,Ft.scope).abortTile(Ft,Vt)}removeTile(wt,Ft,Vt){this.getWorkerSource(wt,Ft.type,Ft.source,Ft.scope).removeTile(Ft,Vt)}removeSource(wt,Ft,Vt){if(!(this.workerSources[wt]&&this.workerSources[wt][Ft.scope]&&this.workerSources[wt][Ft.scope][Ft.type]&&this.workerSources[wt][Ft.scope][Ft.type][Ft.source]))return;const ni=this.workerSources[wt][Ft.scope][Ft.type][Ft.source];delete this.workerSources[wt][Ft.scope][Ft.type][Ft.source],ni.removeSource!==void 0?ni.removeSource(Ft,Vt):Vt()}loadWorkerSource(wt,Ft,Vt){try{this.self.importScripts(Ft.url),Vt()}catch(ni){Vt(ni.toString())}}syncRTLPluginState(wt,Ft,Vt){if(n.fn.isParsed())Vt(null,!0);else if(n.fn.isParsing())this.rtlPluginParsingListeners.push(Vt);else try{n.fn.setState(Ft);const ni=n.fn.getPluginURL();!n.fn.isLoaded()||n.fn.isParsed()||n.fn.isParsing()||ni==null||(n.fn.setState({pluginStatus:n.fo.parsing,pluginURL:n.fn.getPluginURL()}),this.self.importScripts(ni),n.fn.isParsed()?Vt(null,!0):this.rtlPluginParsingListeners.push(Vt))}catch(ni){Vt(ni.toString())}}setDracoUrl(wt,Ft){this.dracoUrl=Ft}getAvailableImages(wt,Ft){this.availableImages[wt]||(this.availableImages[wt]={});let Vt=this.availableImages[wt][Ft];return Vt||(Vt=[]),Vt}getAvailableModels(wt,Ft){this.availableModels[wt]||(this.availableModels[wt]={});let Vt=this.availableModels[wt][Ft];return Vt||(Vt={}),Vt}getLayerIndex(wt,Ft){this.layerIndexes[wt]||(this.layerIndexes[wt]={});let Vt=this.layerIndexes[wt][Ft];return Vt||(Vt=this.layerIndexes[wt][Ft]=new z,Vt.scope=Ft),Vt}getWorkerSource(wt,Ft,Vt,ni){const Jt=this.workerSources;return Jt[wt]||(Jt[wt]={}),Jt[wt][ni]||(Jt[wt][ni]={}),Jt[wt][ni][Ft]||(Jt[wt][ni][Ft]={}),this.isSpriteLoaded[wt]||(this.isSpriteLoaded[wt]={}),Jt[wt][ni][Ft][Vt]||(Jt[wt][ni][Ft][Vt]=new this.workerSourceTypes[Ft]({send:(yi,Fi,bi,Oi,qi,Bi)=>this.actor.send(yi,Fi,bi,wt,qi,Bi),scheduler:this.actor.scheduler},this.getLayerIndex(wt,ni),this.getAvailableImages(wt,ni),this.getAvailableModels(wt,ni),this.isSpriteLoaded[wt][ni],void 0,this.brightness,this.worldview)),Jt[wt][ni][Ft][Vt]}rasterizeImagesWorker(wt,Ft,Vt){const ni=new Map;for(const[Jt,{image:yi,imageVariant:Fi}]of Ft.tasks.entries()){const bi=this.imageRasterizer.rasterize(Fi,yi,Ft.scope,wt);ni.set(Jt,bi)}Vt(void 0,ni)}removeRasterizedImages(wt,Ft,Vt){this.imageRasterizer.removeImagesFromCacheByIds(Ft.imageIds,Ft.scope,wt),Vt()}enforceCacheSizeLimit(wt,Ft){n.fp(Ft)}getWorkerPerformanceMetrics(wt,Ft,Vt){Vt(void 0,void 0)}}return n.fl(self)&&(self.worker=new Ai(self)),Ai}),l(["./shared"],function(n){var S="3.13.0";const C={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(b){performance.mark(b)},measure(b,a,f){performance.measure(b,a,f)}};function z(b){const a=b.name.split("?")[0];return n.a(a)&&a.includes("mapbox-gl.js")?"javascript":n.a(a)&&a.includes("mapbox-gl.css")?"css":n.b(a)?"fontRange":n.c(a)?"sprite":n.i(a)?"style":n.d(a)?"tilejson":"other"}var $,k={},Y=function(){if($)return k;function b(w){return!a(w)}function a(w){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,H,Q=new Blob([""],{type:"text/javascript"}),oe=URL.createObjectURL(Q);try{H=new Worker(oe),R=!0}catch{R=!1}return H&&H.terminate(),URL.revokeObjectURL(oe),R}()?function(){var R=document.createElement("canvas");R.width=R.height=1;var H=R.getContext("2d");if(!H)return!1;var Q=H.getImageData(0,0,1,1);return Q&&Q.width===R.width}()?(f[P=w&&w.failIfMajorPerformanceCaveat]===void 0&&(f[P]=function(R){var H,Q=function(oe){var de=document.createElement("canvas"),pe=Object.create(b.webGLContextAttributes);return pe.failIfMajorPerformanceCaveat=oe,de.getContext("webgl2",pe)}(R);if(!Q)return!1;try{H=Q.createShader(Q.VERTEX_SHADER)}catch{return!1}return!(!H||Q.isContextLost())&&(Q.shaderSource(H,"void main() {}"),Q.compileShader(H),Q.getShaderParameter(H,Q.COMPILE_STATUS)===!0)}(P)),f[P]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var P}$=1,k.supported=b,k.notSupportedReason=a;var f={};return b.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},k}();function ie(b,a,f){const w=document.createElement(b);return a!=null&&(w.className=a),f&&f.appendChild(w),w}function ue(b,a,f){const w=document.createElementNS("http://www.w3.org/2000/svg",b);for(const P of Object.keys(a))w.setAttributeNS(null,P,String(a[P]));return f&&f.appendChild(w),w}const ne=typeof document<"u"?document.documentElement&&document.documentElement.style:null,se=ne&&ne.userSelect!==void 0?"userSelect":"WebkitUserSelect";let le;function he(){ne&&se&&(le=ne[se],ne[se]="none")}function me(){ne&&se&&(ne[se]=le)}function ge(b){b.preventDefault(),b.stopPropagation(),window.removeEventListener("click",ge,!0)}function xt(){window.addEventListener("click",ge,!0),window.setTimeout(()=>{window.removeEventListener("click",ge,!0)},0)}function Et(b,a){const f=b.getBoundingClientRect();return Ht(b,f,a)}function Lt(b,a){const f=b.getBoundingClientRect(),w=[];for(let P=0;P<a.length;P++)w.push(Ht(b,f,a[P]));return w}function Zt(b){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&b.button===2&&b.ctrlKey?0:b.button}function Ht(b,a,f){const w=b.offsetWidth===a.width?1:b.offsetWidth/a.width;return new n.P((f.clientX-a.left)*w,(f.clientY-a.top)*w)}const It="01",Yt="NO_ACCESS_TOKEN";class ri{constructor(a,f,w){this._transformRequestFn=a,this._customAccessToken=f,this._silenceAuthErrors=!!w,this._createSkuToken()}_createSkuToken(){const a=function(){let f="";for(let w=0;w<10;w++)f+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",It,f].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,f){return this._transformRequestFn&&this._transformRequestFn(a,f)||{url:a}}normalizeStyleURL(a,f){if(!n.j(a))return a;const w=Ct(a);return w.params.push(`sdk=js-${S}`),w.path=`/styles/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||f)}normalizeGlyphsURL(a,f){if(!n.j(a))return a;const w=Ct(a);return w.path=`/fonts/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||f)}normalizeModelURL(a,f){if(!n.j(a))return a;const w=Ct(a);return w.path=`/models/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||f)}normalizeSourceURL(a,f,w,P){if(!n.j(a))return a;const R=Ct(a);return R.path=`/v4/${R.authority}.json`,R.params.push("secure"),w&&R.params.push(`language=${w}`),P&&R.params.push(`worldview=${P}`),this._makeAPIURL(R,this._customAccessToken||f)}normalizeIconsetURL(a,f){const w=Ct(a);return n.j(a)?(w.path=`/styles/v1${w.path}/iconset.pbf`,this._makeAPIURL(w,this._customAccessToken||f)):Ut(w)}normalizeSpriteURL(a,f,w,P){const R=Ct(a);return n.j(a)?(R.path=`/styles/v1${R.path}/sprite${f}${w}`,this._makeAPIURL(R,this._customAccessToken||P)):(R.path+=`${f}${w}`,Ut(R))}normalizeTileURL(a,f,w){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!n.j(a))return a;const P=Ct(a);P.path=P.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${f||w&&P.authority!=="raster"&&w===512?"@2x":""}${n.l.supported?".webp":"$1"}`),P.authority==="raster"?P.path=`/${n.e.RASTER_URL_PREFIX}${P.path}`:P.authority==="rasterarrays"?P.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${P.path}`:P.authority==="3dtiles"?P.path=`/${n.e.TILES3D_URL_PREFIX}${P.path}`:(P.path=P.path.replace(/^.+\/v4\//,"/"),P.path=`/${n.e.TILE_URL_VERSION}${P.path}`);const R=this._customAccessToken||function(H){for(const Q of H){const oe=Q.match(/^access_token=(.*)$/);if(oe)return oe[1]}return null}(P.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&R&&this._skuToken&&P.params.push(`sku=${this._skuToken}`),this._makeAPIURL(P,R)}canonicalizeTileURL(a,f){const w=Ct(a);if(!w.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!w.path.match(/\.[\w]+$/))return a;let P="mapbox://";w.path.match(/^\/raster\/v1\//)?P+=`raster/${w.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:w.path.match(/^\/rasterarrays\/v1\//)?P+=`rasterarrays/${w.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:P+=`tiles/${w.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let R=w.params;return f&&(R=R.filter(H=>!H.match(/^access_token=/))),R.length&&(P+=`?${R.join("&")}`),P}canonicalizeTileset(a,f){const w=!!f&&n.j(f),P=[];for(const R of a.tiles||[])n.k(R)?P.push(this.canonicalizeTileURL(R,w)):P.push(R);return P}_makeAPIURL(a,f){const w="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",P=Ct(n.e.API_URL);if(a.protocol=P.protocol,a.authority=P.authority,a.protocol==="http"){const R=a.params.indexOf("secure");R>=0&&a.params.splice(R,1)}if(P.path!=="/"&&(a.path=`${P.path}${a.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Ut(a);if(f=f||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!f)throw new Error(`An API access token is required to use Mapbox GL. ${w}`);if(f[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${w}`)}return a.params=a.params.filter(R=>R.indexOf("access_token")===-1),a.params.push(`access_token=${f||""}`),Ut(a)}}const ei=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ct(b){const a=b.match(ei);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Ut(b){const a=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${a}`}const Mt="mapbox.eventData";function $t(b){if(!b)return null;const a=b.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(n.m(a[1]))}catch{return null}}class jt{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const f=$t(n.e.ACCESS_TOKEN);let w="";return w=f&&f.u?n.f(f.u):n.e.ACCESS_TOKEN||"",a?`${Mt}.${a}:${w}`:`${Mt}:${w}`}fetchEventData(){const a=n.s("localStorage"),f=this.getStorageKey(),w=this.getStorageKey("uuid");if(a)try{const P=localStorage.getItem(f);P&&(this.eventData=JSON.parse(P));const R=localStorage.getItem(w);R&&(this.anonId=R)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const a=n.s("localStorage"),f=this.getStorageKey(),w=this.getStorageKey("uuid"),P=this.anonId;if(a&&P)try{localStorage.setItem(w,P),Object.keys(this.eventData).length>=1&&localStorage.setItem(f,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,f,w,P){if(!n.e.EVENTS_URL)return;const R=Ct(n.e.EVENTS_URL);R.params.push(`access_token=${P||n.e.ACCESS_TOKEN||""}`);const H={event:this.type,created:new Date(a).toISOString()},Q=f?n.h(H,f):H,oe={url:Ut(R),headers:{"Content-Type":"text/plain"},body:JSON.stringify([Q])};this.pendingRequest=n.p(oe,de=>{this.pendingRequest=null,w(de),this.saveEventData(),this.processRequests(P)})}queueRequest(a,f){this.queue.push(a),this.processRequests(f)}}const mi=new class extends jt{constructor(b){super("appUserTurnstile"),this._customAccessToken=b}postTurnstileEvent(b,a){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(b)&&b.some(f=>n.j(f)||n.k(f))&&this.queueRequest(Date.now(),a)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=$t(n.e.ACCESS_TOKEN),f=a?a.u:n.e.ACCESS_TOKEN;let w=f!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),w=!0);const P=this.queue.shift();if(this.eventData.lastSuccess){const R=new Date(this.eventData.lastSuccess),H=new Date(P),Q=(P-this.eventData.lastSuccess)/864e5;w=w||Q>=1||Q<-1||R.getDate()!==H.getDate()}else w=!0;w?this.postEvent(P,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:It,"enabled.telemetry":!1,userId:this.anonId},R=>{R||(this.eventData.lastSuccess=P,this.eventData.tokenU=f)},b):this.processRequests()}},Xi=mi.postTurnstileEvent.bind(mi),Er=new class extends jt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(b,a,f,w){this.skuToken=a,this.errorCb=w,n.e.EVENTS_URL&&(f||n.e.ACCESS_TOKEN?this.queueRequest({id:b,timestamp:Date.now()},f):this.errorCb(new Error(Yt)))}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:f}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:It,skuToken:this.skuToken,userId:this.anonId},w=>{w?this.errorCb(w):a&&(this.success[a]=!0)},b))}remove(){this.errorCb=null}},Ir=Er.postMapLoadEvent.bind(Er),nr=new class extends jt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(b){let a=this.mapInstanceIdMap.get(b);return a||(a=n.u(),this.mapInstanceIdMap.set(b,a)),a}getEventId(b){const a=this.eventIdPerMapInstanceMap.get(b)||0;return this.eventIdPerMapInstanceMap.set(b,a+1),a}postStyleLoadEvent(b,a){const{map:f,style:w,importedStyles:P}=a;if(!n.e.EVENTS_URL||!b&&!n.e.ACCESS_TOKEN)return;const R=this.getMapInstanceId(f),H={mapInstanceId:R,eventId:this.getEventId(R),style:w};P.length&&(H.importedStyles=P),this.queueRequest({timestamp:Date.now(),payload:H},b)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:f}=this.queue.shift();this.postEvent(a,f,()=>{},b)}},si=nr.postStyleLoadEvent.bind(nr),Gt=new class extends jt{constructor(){super("gljs.performance")}postPerformanceEvent(b,a){n.e.EVENTS_URL&&(b||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},b)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:f}=this.queue.shift(),w=function(P){const R=performance.getEntriesByType("resource"),H=performance.getEntriesByType("mark"),Q=function(vt){const Dt={};if(vt){for(const At in vt)if(At!=="other")for(const Ot of vt[At]){const Bt=`${At}ResolveRangeMin`,qt=`${At}ResolveRangeMax`,li=`${At}RequestCount`,fi=`${At}RequestCachedCount`;Dt[Bt]=Math.min(Dt[Bt]||1/0,Ot.startTime),Dt[qt]=Math.max(Dt[qt]||-1/0,Ot.responseEnd);const Ti=wi=>{Dt[wi]===void 0&&(Dt[wi]=0),++Dt[wi]};Ot.transferSize!==void 0&&Ot.transferSize===0&&Ti(fi),Ti(li)}}return Dt}(function(vt,Dt){const At={};if(vt)for(const Ot of vt){const Bt=Dt(Ot);At[Bt]===void 0&&(At[Bt]=[]),At[Bt].push(Ot)}return At}(R,z)),oe=window.devicePixelRatio,de=navigator.connection||navigator.mozConnection||navigator.webkitConnection,pe=de?de.effectiveType:void 0,yt={counters:[],metadata:[],attributes:[]},pt=(vt,Dt,At)=>{At!=null&&vt.push({name:Dt,value:At.toString()})};for(const vt in Q)pt(yt.counters,vt,Q[vt]);if(P.interactionRange[0]!==1/0&&P.interactionRange[1]!==-1/0&&(pt(yt.counters,"interactionRangeMin",P.interactionRange[0]),pt(yt.counters,"interactionRangeMax",P.interactionRange[1])),H)for(const vt of Object.keys(C)){const Dt=C[vt],At=H.find(Ot=>Ot.name===Dt);At&&pt(yt.counters,Dt,At.startTime)}return pt(yt.counters,"visibilityHidden",P.visibilityHidden),pt(yt.attributes,"style",function(vt){if(vt)for(const Dt of vt){const At=Dt.name.split("?")[0];if(n.i(At)){const Ot=At.split("/").slice(-2);if(Ot.length===2)return`mapbox://styles/${Ot[0]}/${Ot[1]}`}}}(R)),pt(yt.attributes,"terrainEnabled",P.terrainEnabled?"true":"false"),pt(yt.attributes,"fogEnabled",P.fogEnabled?"true":"false"),pt(yt.attributes,"projection",P.projection),pt(yt.attributes,"zoom",P.zoom),pt(yt.metadata,"devicePixelRatio",oe),pt(yt.metadata,"connectionEffectiveType",pe),pt(yt.metadata,"navigatorUserAgent",navigator.userAgent),pt(yt.metadata,"screenWidth",window.screen.width),pt(yt.metadata,"screenHeight",window.screen.height),pt(yt.metadata,"windowWidth",window.innerWidth),pt(yt.metadata,"windowHeight",window.innerHeight),pt(yt.metadata,"mapWidth",P.width/oe),pt(yt.metadata,"mapHeight",P.height/oe),pt(yt.metadata,"webglRenderer",P.renderer),pt(yt.metadata,"webglVendor",P.vendor),pt(yt.metadata,"sdkVersion",S),pt(yt.metadata,"sdkIdentifier","mapbox-gl-js"),yt}(f);for(const P of w.metadata);for(const P of w.counters);for(const P of w.attributes);this.postEvent(a,w,()=>{},b)}},ui=Gt.postPerformanceEvent.bind(Gt),oi=new class extends jt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(b,a,f,w){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const P=Ct(n.e.API_URL+n.e.SESSION_PATH);P.params.push(`sku=${a||""}`),P.params.push(`access_token=${w||n.e.ACCESS_TOKEN||""}`);const R={url:Ut(P),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(R,H=>{this.pendingRequest=null,f(H),this.saveEventData(),this.processRequests(w)})}getSessionAPI(b,a,f,w){this.skuToken=a,this.errorCb=w,n.e.SESSION_PATH&&n.e.API_URL&&(f||n.e.ACCESS_TOKEN?this.queueRequest({id:b,timestamp:Date.now()},f):this.errorCb(new Error(Yt)))}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:f}=this.queue.shift();a&&this.success[a]||this.getSession(f,this.skuToken,w=>{w?this.errorCb(w):a&&(this.success[a]=!0)},b)}remove(){this.errorCb=null}},Si=oi.getSessionAPI.bind(oi),Li=new Set;function Mi(b,a){a?Li.add(b):Li.delete(b)}class kt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,f){this._updatedSourceCaches[a]=f,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const f=a.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(a.id),this.setDirty()}removeLayer(a){const f=a.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][a.id]=a,this._updatedLayers[f].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const f in this._updatedLayers)a[f]=a[f]||{},a[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)a[f]=a[f]||{},a[f].removedIds=Object.keys(this._removedLayers[f]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,f){this._updatedImages[f]=this._updatedImages[f]||new Set,this._updatedImages[f].add(n.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Nt(b){const{userImage:a}=b;return!!(a&&a.render&&a.render())&&(b.data.replace(new Uint8Array(a.data.buffer)),!0)}class gi extends n.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,a!=="raster"&&n.t()&&(this.imageRasterizerDispatcher=new n.D(n.x(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new n.r({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const f=this.atlasTexture.get(a);f&&(f.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,f){this.imageProviders.has(f)||this.imageProviders.set(f,new Map),this.imageProviders.get(f).set(a.id,a)}removeImageProvider(a,f){this.imageProviders.has(f)&&this.imageProviders.get(f).delete(a)}getPendingImageProviders(){const a=[];for(const f of this.imageProviders.values())for(const w of f.values())w.hasPendingRequests()&&a.push(w);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.y),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,f){if(this.loaded.get(f)!==a&&(this.loaded.set(f,a),a)){for(const{ids:w,callback:P}of this.requestors)this._notify(w,f,P);this.requestors=[]}}hasImage(a,f){return!!this.getImage(a,f)}getImage(a,f){return this.images.get(f).get(a.toString())}addImage(a,f,w){this._validate(a,w)&&this.images.get(f).set(a.toString(),w)}_validate(a,f){let w=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new n.z(new Error(`Image "${a.name}" has invalid "stretchX" value`))),w=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new n.z(new Error(`Image "${a.name}" has invalid "stretchY" value`))),w=!1),this._validateContent(f.content,f)||(this.fire(new n.z(new Error(`Image "${a.name}" has invalid "content" value`))),w=!1),w}_validateStretch(a,f){if(!a)return!0;let w=0;for(const P of a){if(P[0]<w||P[1]<P[0]||f<P[1])return!1;w=P[1]}return!0}_validateContent(a,f){return a?a.length!==4||!f.usvg&&(a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3])?!1:!(a[2]<a[0]||a[3]<a[1]):!0}updateImage(a,f,w){const P=this.images.get(f).get(a.toString());w.version=P.version+1,this.images.get(f).set(a.toString(),w),this.updatedImages.get(f).add(a),this.removeFromImageRasterizerCache(a,f)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,f){this.spriteFormat!=="raster"&&(n.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[a],scope:f}):this.imageRasterizer.removeImagesFromCacheByIds([a],f))}removeImage(a,f){const w=this.images.get(f),P=w.get(a.toString());w.delete(a.toString()),this.patterns.get(f).delete(a.toString()),this.removeFromImageRasterizerCache(a,f),P.userImage&&P.userImage.onRemove&&P.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(f=>n.I.from(f))}getImages(a,f,w){const P=[],R=[],H=this.imageProviders.get(f);for(const pe of a){if(!pe.iconsetId){P.push(pe);continue}const yt=H.get(pe.iconsetId);yt&&(this.getImage(pe,f)?R.push(pe):yt.addPendingRequest(pe))}if(P.length===0)return void this._notify(R,f,w);let Q=!0;const oe=!!this.loaded.get(f),de=this.images.get(f);if(!oe)for(const pe of P)de.has(pe.toString())||(Q=!1);oe||Q?this._notify(P,f,w):this.requestors.push({ids:P,scope:f,callback:w})}rasterizeImages(a,f){const w=new Map,{tasks:P,scope:R}=a;for(const[H,Q]of P.entries()){const oe=this.getImage(Q.id,R);oe&&w.set(H,{image:oe,imageVariant:Q})}this._rasterizeImages(R,w,f)}_rasterizeImages(a,f,w){if(n.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:f,scope:a},w);else{const P=new Map;for(const[R,{image:H,imageVariant:Q}]of f.entries())P.set(R,this.imageRasterizer.rasterize(Q,H,a,0));w(void 0,P)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,f,w){const P=this.images.get(f),R=new Map;for(const H of a){if(!P.get(H.toString())){if(H.iconsetId)continue;this.fire(new n.A("styleimagemissing",{id:H.name}))}const Q=P.get(H.toString());if(!Q){n.w(`Image "${H.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const oe={data:Q.usvg?null:Q.data.clone(),pixelRatio:Q.pixelRatio,sdf:Q.sdf,usvg:Q.usvg,version:Q.version,stretchX:Q.stretchX,stretchY:Q.stretchY,content:Q.content,hasRenderCallback:!!(Q.userImage&&Q.userImage.render)};Q.usvg&&Object.assign(oe,{width:Q.icon.usvg_tree.width,height:Q.icon.usvg_tree.height}),R.set(n.I.toString(H),oe)}w(null,R)}getPixelSize(a){const{width:f,height:w}=this.atlasImage.get(a);return{width:f,height:w}}getPattern(a,f,w){const P=a.toString(),R=this.patterns.get(f),H=R.get(P),Q=this.getImage(a,f);if(!Q)return null;if(H){if(H.position.version===Q.version)return H.position;H.position.version=Q.version}else{if(Q.usvg&&!Q.data){const oe=this.getPatternInFlightId(P,f);if(this.patternsInFlight.has(oe))return null;this.patternsInFlight.add(oe);const de=new n.B(a).scaleSelf(n.q.devicePixelRatio),pe=new Map([[de.toString(),{image:Q,imageVariant:de}]]);return this._rasterizeImages(f,pe,(yt,pt)=>this.storePatternImage(de,f,Q,w,pt)),null}this.storePattern(a,f,Q)}return this._updatePatternAtlas(f,w),R.get(P).position}getPatternInFlightId(a,f){return n.C(a,f)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(a,f,w,P,R){const H=a.toString(),Q=R?R.get(H):void 0;Q&&(w.data=Q,this.storePattern(a.id,f,w),this._updatePatternAtlas(f,P),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),f)))}storePattern(a,f,w){const P={w:w.data.width+2*n.F,h:w.data.height+2*n.F,x:0,y:0},R=new n.G(P,w,n.F);this.patterns.get(f).set(a.toString(),{bin:P,position:R})}bind(a,f){const w=a.gl;let P=this.atlasTexture.get(f);P?this.dirty&&(P.update(this.atlasImage.get(f)),this.dirty=!1):(P=new n.T(a,this.atlasImage.get(f),w.RGBA8),this.atlasTexture.set(f,P)),P.bind(w.LINEAR,w.CLAMP_TO_EDGE)}_updatePatternAtlas(a,f){const w=this.patterns.get(a),P=Array.from(w.values()).map(({bin:de})=>de),{w:R,h:H}=n.H(P),Q=this.atlasImage.get(a);Q.resize({width:R||1,height:H||1});const oe=this.images.get(a);for(const[de,{bin:pe,position:yt}]of w.entries()){let pt=yt.padding;const vt=pe.x+pt,Dt=pe.y+pt,At=oe.get(de).data,Ot=At.width,Bt=At.height;pt=pt>1?pt-1:pt,n.r.copy(At,Q,{x:0,y:0},{x:vt,y:Dt},{width:Ot,height:Bt},f),n.r.copy(At,Q,{x:0,y:Bt-pt},{x:vt,y:Dt-pt},{width:Ot,height:pt},f),n.r.copy(At,Q,{x:0,y:0},{x:vt,y:Dt+Bt},{width:Ot,height:pt},f),n.r.copy(At,Q,{x:Ot-pt,y:0},{x:vt-pt,y:Dt},{width:pt,height:Bt},f),n.r.copy(At,Q,{x:0,y:0},{x:vt+Ot,y:Dt},{width:pt,height:Bt},f),n.r.copy(At,Q,{x:Ot-pt,y:Bt-pt},{x:vt-pt,y:Dt-pt},{width:pt,height:pt},f),n.r.copy(At,Q,{x:0,y:Bt-pt},{x:vt+Ot,y:Dt-pt},{width:pt,height:pt},f),n.r.copy(At,Q,{x:0,y:0},{x:vt+Ot,y:Dt+Bt},{width:pt,height:pt},f),n.r.copy(At,Q,{x:Ot-pt,y:0},{x:vt-pt,y:Dt+Bt},{width:pt,height:pt},f)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,f){const w=this.images.get(f);for(const P of a){if(this.callbackDispatchedThisFrame.get(f).has(P.toString()))continue;this.callbackDispatchedThisFrame.get(f).add(P.toString());const R=w.get(P.toString());Nt(R)&&this.updateImage(P,f,R)}}}function Ri(b){const a=b.key,f=b.value,w=b.valueSpec||{},P=b.objectElementValidators||{},R=b.style,H=b.styleSpec;let Q=[];const oe=n.J(f);if(oe!=="object")return[new n.V(a,f,`object expected, ${oe} found`)];for(const de in f){const pe=de.split(".")[0];let yt;P[pe]?yt=P[pe]:w[pe]?yt=Dn:P["*"]?yt=P["*"]:w["*"]&&(yt=Dn),yt?Q=Q.concat(yt({key:(a&&`${a}.`)+de,value:f[de],valueSpec:w[pe]||w["*"],style:R,styleSpec:H,object:f,objectKey:de},f)):Q.push(new n.K(a,f[de],`unknown property "${de}"`))}for(const de in w)P[de]||w[de].required&&w[de].default===void 0&&f[de]===void 0&&Q.push(new n.V(a,f,`missing required property "${de}"`));return Q}function Rt(b){const a=b.value,f=b.valueSpec,w=b.style,P=b.styleSpec,R=b.key,H=b.arrayElementValidator||Dn;if(n.J(a)!=="array")return[new n.V(R,a,`array expected, ${n.J(a)} found`)];if(f.length&&a.length!==f.length)return[new n.V(R,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new n.V(R,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let Q={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};P.$version<7&&(Q.function=f.function),n.J(f.value)==="object"&&(Q=f.value);let oe=[];for(let de=0;de<a.length;de++)oe=oe.concat(H({array:a,arrayIndex:de,value:a[de],valueSpec:Q,style:w,styleSpec:P,key:`${R}[${de}]`},!0));return oe}function Xt(b){const a=b.key,f=b.value,w=b.valueSpec;let P=n.J(f);if(P==="number"&&f!=f&&(P="NaN"),P!=="number")return[new n.V(a,f,`number expected, ${P} found`)];if("minimum"in w){let R=w.minimum;if(n.J(w.minimum)==="array"&&(R=w.minimum[b.arrayIndex]),f<R)return[new n.V(a,f,`${f} is less than the minimum value ${R}`)]}if("maximum"in w){let R=w.maximum;if(n.J(w.maximum)==="array"&&(R=w.maximum[b.arrayIndex]),f>R)return[new n.V(a,f,`${f} is greater than the maximum value ${R}`)]}return[]}function Hi(b){const a=b.valueSpec,f=n.M(b.value.type);let w,P,R,H={};const Q=f!=="categorical"&&b.value.property===void 0,oe=!Q,de=n.J(b.value.stops)==="array"&&n.J(b.value.stops[0])==="array"&&n.J(b.value.stops[0][0])==="object",pe=Ri({key:b.key,value:b.value,valueSpec:b.styleSpec.function,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{stops:function(vt){if(f==="identity")return[new n.V(vt.key,vt.value,'identity function may not have a "stops" property')];let Dt=[];const At=vt.value;return Dt=Dt.concat(Rt({key:vt.key,value:At,valueSpec:vt.valueSpec,style:vt.style,styleSpec:vt.styleSpec,arrayElementValidator:yt})),n.J(At)==="array"&&At.length===0&&Dt.push(new n.V(vt.key,At,"array must have at least one stop")),Dt},default:function(vt){return Dn({key:vt.key,value:vt.value,valueSpec:a,style:vt.style,styleSpec:vt.styleSpec})}}});return f==="identity"&&Q&&pe.push(new n.V(b.key,b.value,'missing required property "property"')),f==="identity"||b.value.stops||pe.push(new n.V(b.key,b.value,'missing required property "stops"')),f==="exponential"&&b.valueSpec.expression&&!n.N(b.valueSpec)&&pe.push(new n.V(b.key,b.value,"exponential functions not supported")),b.styleSpec.$version>=8&&(oe&&!n.O(b.valueSpec)?pe.push(new n.V(b.key,b.value,"property functions not supported")):Q&&!n.Q(b.valueSpec)&&pe.push(new n.V(b.key,b.value,"zoom functions not supported"))),f!=="categorical"&&!de||b.value.property!==void 0||pe.push(new n.V(b.key,b.value,'"property" property is required')),pe;function yt(vt){let Dt=[];const At=vt.value,Ot=vt.key;if(n.J(At)!=="array")return[new n.V(Ot,At,`array expected, ${n.J(At)} found`)];if(At.length!==2)return[new n.V(Ot,At,`array length 2 expected, length ${At.length} found`)];if(de){if(n.J(At[0])!=="object")return[new n.V(Ot,At,`object expected, ${n.J(At[0])} found`)];if(At[0].zoom===void 0)return[new n.V(Ot,At,"object stop key must have zoom")];if(At[0].value===void 0)return[new n.V(Ot,At,"object stop key must have value")];const Bt=n.M(At[0].zoom);if(typeof Bt!="number")return[new n.V(Ot,At[0].zoom,"stop zoom values must be numbers")];if(R&&R>Bt)return[new n.V(Ot,At[0].zoom,"stop zoom values must appear in ascending order")];Bt!==R&&(R=Bt,P=void 0,H={}),Dt=Dt.concat(Ri({key:`${Ot}[0]`,value:At[0],valueSpec:{zoom:{}},style:vt.style,styleSpec:vt.styleSpec,objectElementValidators:{zoom:Xt,value:pt}}))}else Dt=Dt.concat(pt({key:`${Ot}[0]`,value:At[0],style:vt.style,styleSpec:vt.styleSpec},At));return n.S(n.U(At[1]))?Dt.concat([new n.V(`${Ot}[1]`,At[1],"expressions are not allowed in function stops.")]):Dt.concat(Dn({key:`${Ot}[1]`,value:At[1],valueSpec:a,style:vt.style,styleSpec:vt.styleSpec}))}function pt(vt,Dt){const At=n.J(vt.value),Ot=n.M(vt.value),Bt=vt.value!==null?vt.value:Dt;if(w){if(At!==w)return[new n.V(vt.key,Bt,`${At} stop domain type must match previous stop domain type ${w}`)]}else w=At;if(At!=="number"&&At!=="string"&&At!=="boolean"&&typeof Ot!="number"&&typeof Ot!="string"&&typeof Ot!="boolean")return[new n.V(vt.key,Bt,"stop domain value must be a number, string, or boolean")];if(At!=="number"&&f!=="categorical"){let qt=`number expected, ${At} found`;return n.O(a)&&f===void 0&&(qt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(vt.key,Bt,qt)]}return f!=="categorical"||At!=="number"||typeof Ot=="number"&&isFinite(Ot)&&Math.floor(Ot)===Ot?f!=="categorical"&&At==="number"&&typeof Ot=="number"&&typeof P=="number"&&P!==void 0&&Ot<P?[new n.V(vt.key,Bt,"stop domain values must appear in ascending order")]:(P=Ot,f==="categorical"&&Ot in H?[new n.V(vt.key,Bt,"stop domain values must be unique")]:(H[Ot]=!0,[])):[new n.V(vt.key,Bt,`integer expected, found ${String(Ot)}`)]}}function Ni(b){const a=(b.expressionContext==="property"?n.W:n.X)(n.U(b.value),b.valueSpec);if(a.result==="error")return a.value.map(w=>new n.V(`${b.key}${w.key}`,b.value,w.message));const f=a.value.expression||a.value._styleExpression.expression;if(b.expressionContext==="property"&&b.propertyKey==="text-font"&&!f.outputDefined())return[new n.V(b.key,b.value,`Invalid data expression for "${b.propertyKey}". Output values must be contained as literals within the expression.`)];if(b.expressionContext==="property"&&b.propertyType==="layout"&&!n.Y(f))return[new n.V(b.key,b.value,'"feature-state" data expressions are not supported with layout properties.')];if(b.expressionContext==="filter")return xi(f,b);if(b.expressionContext&&b.expressionContext.indexOf("cluster")===0){if(!n.Z(f,["zoom","feature-state"]))return[new n.V(b.key,b.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(b.expressionContext==="cluster-initial"&&!n._(f))return[new n.V(b.key,b.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xi(b,a){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const P of a.valueSpec.expression.parameters)f.delete(P);if(f.size===0)return[];const w=[];return b instanceof n.$&&f.has(b.name)?[new n.V(a.key,a.value,`["${b.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(b.eachChild(P=>{w.push(...xi(P,a))}),w)}function $i(b){const a=b.key,f=b.value,w=b.valueSpec,P=[];return Array.isArray(w.values)?w.values.indexOf(n.M(f))===-1&&P.push(new n.V(a,f,`expected one of [${w.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(w.values).indexOf(n.M(f))===-1&&P.push(new n.V(a,f,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(f)} found`)),P}function fr(b){return n.a1(n.U(b.value))?Ni(n.L({},b,{expressionContext:"filter",valueSpec:b.styleSpec[`filter_${b.layerType||"fill"}`]})):ir(b)}function ir(b){const a=b.value,f=b.key;if(n.J(a)!=="array")return[new n.V(f,a,`array expected, ${n.J(a)} found`)];const w=b.styleSpec;let P,R=[];if(a.length<1)return[new n.V(f,a,"filter array must have at least 1 element")];switch(R=R.concat($i({key:`${f}[0]`,value:a[0],valueSpec:w.filter_operator,style:b.style,styleSpec:b.styleSpec})),n.M(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&n.M(a[1])==="$type"&&R.push(new n.V(f,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&R.push(new n.V(f,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(P=n.J(a[1]),P!=="string"&&R.push(new n.V(`${f}[1]`,a[1],`string expected, ${P} found`)));for(let H=2;H<a.length;H++)P=n.J(a[H]),n.M(a[1])==="$type"?R=R.concat($i({key:`${f}[${H}]`,value:a[H],valueSpec:w.geometry_type,style:b.style,styleSpec:b.styleSpec})):P!=="string"&&P!=="number"&&P!=="boolean"&&R.push(new n.V(`${f}[${H}]`,a[H],`string, number, or boolean expected, ${P} found`));break;case"any":case"all":case"none":for(let H=1;H<a.length;H++)R=R.concat(ir({key:`${f}[${H}]`,value:a[H],style:b.style,styleSpec:b.styleSpec}));break;case"has":case"!has":P=n.J(a[1]),a.length!==2?R.push(new n.V(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):P!=="string"&&R.push(new n.V(`${f}[1]`,a[1],`string expected, ${P} found`))}return R}function lr(b,a){const f=b.key,w=b.style,P=b.layer,R=b.styleSpec,H=b.value,Q=b.objectKey,oe=R[`${a}_${b.layerType}`];if(!oe)return[];const de=Q.match(/^(.*)-use-theme$/);if(a==="paint"&&de&&oe[de[1]])return n.S(H)?[].concat(Dn({key:b.key,value:H,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:w,styleSpec:R,expressionContext:"property",propertyType:a,propertyKey:Q})):Dn({key:f,value:H,valueSpec:{type:"string"},style:w,styleSpec:R});const pe=Q.match(/^(.*)-transition$/);if(a==="paint"&&pe&&oe[pe[1]]&&oe[pe[1]].transition)return Dn({key:f,value:H,valueSpec:R.transition,style:w,styleSpec:R});const yt=b.valueSpec||oe[Q];if(!yt)return[new n.K(f,H,`unknown property "${Q}"`)];let pt;if(n.J(H)==="string"&&n.O(yt)&&!yt.tokens&&(pt=/^{([^}]+)}$/.exec(H))){const Dt=`\`{ "type": "identity", "property": ${pt?JSON.stringify(pt[1]):'"_"'} }\``;return[new n.V(f,H,`"${Q}" does not support interpolation syntax
Use an identity property function instead: ${Dt}.`)]}const vt=[];if(b.layerType==="symbol")Q!=="text-field"||!w||w.glyphs||w.imports||vt.push(new n.V(f,H,'use of "text-field" requires a style "glyphs" property')),Q==="text-font"&&n.a2(n.U(H))&&n.M(H.type)==="identity"&&vt.push(new n.V(f,H,'"text-font" does not support identity functions'));else if(b.layerType==="model"&&a==="paint"&&P&&P.layout&&P.layout.hasOwnProperty("model-id")&&n.O(yt)&&(n.a3(yt)||n.Q(yt))){const Dt=n.W(n.U(H),yt),At=Dt.value.expression||Dt.value._styleExpression.expression;At&&!n.Z(At,["measure-light"])&&(Q==="model-emissive-strength"&&n._(At)&&n.Y(At)||vt.push(new n.V(f,H,`${Q} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return vt.concat(Dn({key:b.key,value:H,valueSpec:yt,style:w,styleSpec:R,expressionContext:"property",propertyType:a,propertyKey:Q}))}function Tr(b){return lr(b,"paint")}function Rr(b){return lr(b,"layout")}function Jr(b){let a=[];const f=b.value,w=b.key,P=b.style,R=b.styleSpec;f.type||f.ref||a.push(new n.V(w,f,'either "type" or "ref" is required'));let H=n.M(f.type);const Q=n.M(f.ref);if(f.id){const oe=n.M(f.id);for(let de=0;de<b.arrayIndex;de++){const pe=P.layers[de];n.M(pe.id)===oe&&a.push(new n.V(w,f.id,`duplicate layer id "${f.id}", previously used at line ${pe.id.__line__}`))}}if("ref"in f){let oe;["type","source","source-layer","filter","layout"].forEach(de=>{de in f&&a.push(new n.V(w,f[de],`"${de}" is prohibited for ref layers`))}),P.layers.forEach(de=>{n.M(de.id)===Q&&(oe=de)}),oe?oe.ref?a.push(new n.V(w,f.ref,"ref cannot reference another ref layer")):H=n.M(oe.type):typeof Q=="string"&&a.push(new n.V(w,f.ref,`ref layer "${Q}" not found`))}else if(H!=="background"&&H!=="sky"&&H!=="slot")if(f.source){const oe=P.sources&&P.sources[f.source],de=oe&&n.M(oe.type);oe?de==="vector"&&H==="raster"?a.push(new n.V(w,f.source,`layer "${f.id}" requires a raster source`)):de==="raster"&&H!=="raster"?a.push(new n.V(w,f.source,`layer "${f.id}" requires a vector source`)):de!=="vector"||f["source-layer"]?de==="raster-dem"&&H!=="hillshade"?a.push(new n.V(w,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):de!=="raster-array"||["raster","raster-particle"].includes(H)?H==="line"&&f.paint&&(f.paint["line-gradient"]||f.paint["line-trim-offset"])&&de==="geojson"&&!oe.lineMetrics?a.push(new n.V(w,f,`layer "${f.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):H==="raster-particle"&&de!=="raster-array"&&a.push(new n.V(w,f.source,`layer "${f.id}" requires a 'raster-array' source.`)):a.push(new n.V(w,f.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new n.V(w,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new n.V(w,f.source,`source "${f.source}" not found`))}else a.push(new n.V(w,f,'missing required property "source"'));return a=a.concat(Ri({key:w,value:f,valueSpec:R.layer,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Dn({key:`${w}.type`,value:f.type,valueSpec:R.layer.type,style:b.style,styleSpec:b.styleSpec,object:f,objectKey:"type"}),filter:oe=>fr(n.L({layerType:H},oe)),layout:oe=>Ri({layer:f,key:oe.key,value:oe.value,valueSpec:{},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{"*":de=>Rr(n.L({layerType:H},de))}}),paint:oe=>Ri({layer:f,key:oe.key,value:oe.value,valueSpec:{},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{"*":de=>Tr(n.L({layerType:H,layer:f},de))}})}})),a}function _r(b){const a=b.value,f=b.key,w=n.J(a);return w!=="string"?[new n.V(f,a,`string expected, ${w} found`)]:[]}const mr={promoteId:function b({key:a,value:f}){if(n.J(f)==="string")return _r({key:a,value:f});if(Array.isArray(f)){const w=[],P=n.U(f),R=n.X(P);return R.result==="error"&&R.value.forEach(H=>{w.push(new n.V(`${a}${H.key}`,null,`${H.message}`))}),n.Z(R.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||w.push(new n.V(`${a}`,null,"promoteId expression should be only feature dependent")),w}{const w=[];for(const P in f)w.push(...b({key:`${a}.${P}`,value:f[P]}));return w}}};function wr(b){const a=b.value,f=b.key,w=b.styleSpec,P=b.style;if(!a.type)return[new n.V(f,a,'"type" is required')];const R=n.M(a.type);let H=[];switch(["vector","raster","raster-dem","raster-array"].includes(R)&&(a.url||a.tiles||H.push(new n.K(f,a,'Either "url" or "tiles" is required.'))),R){case"vector":case"raster":case"raster-dem":case"raster-array":return H=H.concat(Ri({key:f,value:a,valueSpec:w[`source_${R.replace("-","_")}`],style:b.style,styleSpec:w,objectElementValidators:mr})),H;case"geojson":if(H=Ri({key:f,value:a,valueSpec:w.source_geojson,style:P,styleSpec:w,objectElementValidators:mr}),a.cluster)for(const Q in a.clusterProperties){const[oe,de]=a.clusterProperties[Q],pe=typeof oe=="string"?[oe,["accumulated"],["get",Q]]:oe;H.push(...Ni({key:`${f}.${Q}.map`,value:de,expressionContext:"cluster-map"})),H.push(...Ni({key:`${f}.${Q}.reduce`,value:pe,expressionContext:"cluster-reduce"}))}return H;case"video":return Ri({key:f,value:a,valueSpec:w.source_video,style:P,styleSpec:w});case"image":return Ri({key:f,value:a,valueSpec:w.source_image,style:P,styleSpec:w});case"canvas":return[new n.V(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $i({key:`${f}.type`,value:a.type,valueSpec:{values:Vr(w)}})}}function Vr(b){return b.source.reduce((a,f)=>{const w=b[f];return w.type.type==="enum"&&(a=a.concat(Object.keys(w.type.values))),a},[])}function wn(b){const a=b.value,f=b.styleSpec,w=f.light,P=b.style;let R=[];const H=n.J(a);if(a===void 0)return R;if(H!=="object")return R=R.concat([new n.V("light",a,`object expected, ${H} found`)]),R;for(const Q in a){const oe=Q.match(/^(.*)-transition$/),de=Q.match(/^(.*)-use-theme$/);R=R.concat(de&&w[de[1]]?Dn({key:Q,value:a[Q],valueSpec:{type:"string"},style:P,styleSpec:f}):oe&&w[oe[1]]&&w[oe[1]].transition?Dn({key:Q,value:a[Q],valueSpec:f.transition,style:P,styleSpec:f}):w[Q]?Dn({key:Q,value:a[Q],valueSpec:w[Q],style:P,styleSpec:f}):[new n.V(Q,a[Q],`unknown property "${Q}"`)])}return R}function Nn(b){const a=b.value;let f=[];if(!a)return f;const w=n.J(a);if(w!=="object")return f=f.concat([new n.V("light-3d",a,`object expected, ${w} found`)]),f;const P=b.styleSpec,R=P["light-3d"],H=b.key,Q=b.style,oe=b.style.lights;for(const yt of["type","id"])if(!(yt in a))return f=f.concat([new n.V("light-3d",a,`missing property ${yt} on light`)]),f;if(a.type&&oe)for(let yt=0;yt<b.arrayIndex;yt++){const pt=n.M(a.type),vt=oe[yt];n.M(vt.type)===pt&&f.push(new n.V(H,a.id,`duplicate light type "${a.type}", previously defined at line ${vt.id.__line__}`))}const de=`properties_light_${a.type}`;if(!(de in P))return f=f.concat([new n.V("light-3d",a,`Invalid light type ${a.type}`)]),f;const pe=P[de];for(const yt in a)if(yt==="properties"){const pt=a[yt],vt=n.J(pt);if(vt!=="object")return f=f.concat([new n.V("properties",pt,`object expected, ${vt} found`)]),f;for(const Dt in pt){const At=Dt.match(/^(.*)-transition$/),Ot=Dt.match(/^(.*)-use-theme$/);f=f.concat(Ot&&pe[Ot[1]]?Dn({key:yt,value:pt[Dt],valueSpec:{type:"string"},style:Q,styleSpec:P}):At&&pe[At[1]]&&pe[At[1]].transition?Dn({key:yt,value:a[yt],valueSpec:P.transition,style:Q,styleSpec:P}):pe[Dt]?Dn({key:Dt,value:pt[Dt],valueSpec:pe[Dt],style:Q,styleSpec:P}):[new n.K(b.key,pt[Dt],`unknown property "${Dt}"`)])}}else f=f.concat(R[yt]?Dn({key:yt,value:a[yt],valueSpec:R[yt],style:Q,styleSpec:P}):[new n.K(yt,a[yt],`unknown property "${yt}"`)]);return f}function zs(b){const a=b.value,f=b.key,w=b.style,P=b.styleSpec,R=P.terrain;let H=[];const Q=n.J(a);if(a===void 0||Q==="null")return H;if(Q!=="object")return H=H.concat([new n.V("terrain",a,`object expected, ${Q} found`)]),H;for(const oe in a){const de=oe.match(/^(.*)-transition$/),pe=oe.match(/^(.*)-use-theme$/);H=H.concat(pe&&R[pe[1]]?Dn({key:oe,value:a[oe],valueSpec:{type:"string"},style:w,styleSpec:P}):de&&R[de[1]]&&R[de[1]].transition?Dn({key:oe,value:a[oe],valueSpec:P.transition,style:w,styleSpec:P}):R[oe]?Dn({key:oe,value:a[oe],valueSpec:R[oe],style:w,styleSpec:P}):[new n.K(oe,a[oe],`unknown property "${oe}"`)])}if(a.source){const oe=w.sources&&w.sources[a.source],de=oe&&n.M(oe.type);oe?de!=="raster-dem"&&H.push(new n.V(f,a.source,`terrain cannot be used with a source of type ${String(de)}, it only be used with a "raster-dem" source type`)):H.push(new n.V(f,a.source,`source "${a.source}" not found`))}else H.push(new n.V(f,a,'terrain is missing required property "source"'));return H}function es(b){const a=b.value,f=b.style,w=b.styleSpec,P=w.fog;let R=[];const H=n.J(a);if(a===void 0)return R;if(H!=="object")return R=R.concat([new n.V("fog",a,`object expected, ${H} found`)]),R;for(const Q in a){const oe=Q.match(/^(.*)-transition$/),de=Q.match(/^(.*)-use-theme$/);R=R.concat(de&&P[de[1]]?Dn({key:Q,value:a[Q],valueSpec:{type:"string"},style:f,styleSpec:w}):oe&&P[oe[1]]&&P[oe[1]].transition?Dn({key:Q,value:a[Q],valueSpec:w.transition,style:f,styleSpec:w}):P[Q]?Dn({key:Q,value:a[Q],valueSpec:P[Q],style:f,styleSpec:w}):[new n.K(Q,a[Q],`unknown property "${Q}"`)])}return R}const As={"*":()=>[],array:Rt,boolean:function(b){const a=b.value,f=b.key,w=n.J(a);return w!=="boolean"?[new n.V(f,a,`boolean expected, ${w} found`)]:[]},number:Xt,color:function(b){const a=b.key,f=b.value,w=n.J(f);return w!=="string"?[new n.V(a,f,`color expected, ${w} found`)]:n.a0.parseCSSColor(f)===null?[new n.V(a,f,`color expected, "${f}" found`)]:[]},enum:$i,filter:fr,function:Hi,layer:Jr,object:Ri,source:wr,model:n.a4,light:wn,"light-3d":Nn,terrain:zs,fog:es,string:_r,formatted:function(b){return _r(b).length===0?[]:Ni(b)},resolvedImage:function(b){return _r(b).length===0?[]:Ni(b)},projection:function(b){const a=b.value,f=b.styleSpec,w=f.projection,P=b.style;let R=[];const H=n.J(a);if(H==="object")for(const Q in a)R=R.concat(Dn({key:Q,value:a[Q],valueSpec:w[Q],style:P,styleSpec:f}));else H!=="string"&&(R=R.concat([new n.V("projection",a,`object or string expected, ${H} found`)]));return R},import:function(b){const{value:a,styleSpec:f}=b,{data:w,...P}=a;Object.defineProperty(P,"__line__",{value:a.__line__,enumerable:!1});let R=Ri(n.L({},b,{value:P,valueSpec:f.import}));return n.M(P.id)===""&&R.push(new n.V(`${b.key}.id`,P,"import id can't be an empty string")),w&&(R=R.concat(Os(w,f,{key:`${b.key}.data`}))),R},iconset:function(b){const a=b.value,f=b.key,w=b.styleSpec,P=b.style;if(!a.type)return[new n.V(f,a,'"type" is required')];const R=n.M(a.type);let H=[];if(H=H.concat(Ri({key:f,value:a,valueSpec:w[`iconset_${R}`],style:P,styleSpec:w})),R==="source"&&a.source){const Q=P.sources&&P.sources[a.source],oe=Q&&n.M(Q.type);Q?oe!=="raster-array"&&H.push(new n.V(f,a.source,`iconset cannot be used with a source of type ${String(oe)}, it only be used with a "raster-array" source type`)):H.push(new n.V(f,a.source,`source "${a.source}" not found`))}return H}};function Dn(b,a=!1){const f=b.value,w=b.valueSpec,P=b.styleSpec;if(w.expression&&n.a2(n.M(f)))return Hi(b);if(w.expression&&n.S(n.U(f)))return Ni(b);if(w.type&&As[w.type]){const R=As[w.type](b);return a===!0&&R.length>0&&n.J(b.value)==="array"?Ni(b):R}return Ri(n.L({},b,{valueSpec:w.type?P[w.type]:w}))}function Sn(b){const a=b.value,f=b.key,w=_r(b);return w.length||(a.indexOf("{fontstack}")===-1&&w.push(new n.V(f,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&w.push(new n.V(f,a,'"glyphs" url must include a "{range}" token'))),w}function Os(b,a=n.a5,f={}){return Dn({key:f.key||"",value:b,valueSpec:a.$root,styleSpec:a,style:b,objectElementValidators:{glyphs:Sn,"*":()=>[]}})}function Un(b,a=n.a5){return ni(Os(b,a))}const Ks=b=>ni(wr(b)),xs=b=>ni(wn(b)),eo=b=>ni(Nn(b)),rr=b=>ni(zs(b)),Ki=b=>ni(es(b)),pi=b=>ni(function(a){const f=a.value,w=a.style,P=a.styleSpec,R=P.snow;let H=[];const Q=n.J(f);if(f===void 0)return H;if(Q!=="object")return H=H.concat([new n.V("snow",f,`object expected, ${Q} found`)]),H;for(const oe in f){const de=oe.match(/^(.*)-transition$/);H=H.concat(de&&R[de[1]]&&R[de[1]].transition?Dn({key:oe,value:f[oe],valueSpec:P.transition,style:w,styleSpec:P}):R[oe]?Dn({key:oe,value:f[oe],valueSpec:R[oe],style:w,styleSpec:P}):[new n.K(oe,f[oe],`unknown property "${oe}"`)])}return H}(b)),Ii=b=>ni(function(a){const f=a.value,w=a.style,P=a.styleSpec,R=P.rain;let H=[];const Q=n.J(f);if(f===void 0)return H;if(Q!=="object")return H=H.concat([new n.V("rain",f,`object expected, ${Q} found`)]),H;for(const oe in f){const de=oe.match(/^(.*)-transition$/);H=H.concat(de&&R[de[1]]&&R[de[1]].transition?Dn({key:oe,value:f[oe],valueSpec:P.transition,style:w,styleSpec:P}):R[oe]?Dn({key:oe,value:f[oe],valueSpec:R[oe],style:w,styleSpec:P}):[new n.K(oe,f[oe],`unknown property "${oe}"`)])}return H}(b)),Ai=b=>ni(Jr(b)),ii=b=>ni(fr(b)),wt=b=>ni(Tr(b)),Ft=b=>ni(Rr(b)),Vt=b=>ni(n.a4(b));function ni(b){return b.slice().sort((a,f)=>a.line&&f.line?a.line-f.line:0)}function Jt(b,a){let f=!1;if(a&&a.length)for(const w of a)w instanceof n.K?n.w(w.message):(b.fire(new n.z(new Error(w.message))),f=!0);return f}let yi;class Fi extends n.E{constructor(a,f="flat"){super(),this._transitionable=new n.a6(yi||(yi=new n.a7({anchor:new n.a8(n.a5.light.anchor),position:new n.a9(n.a5.light.position),color:new n.a8(n.a5.light.color),intensity:new n.a8(n.a5.light.intensity)}))),this.setLight(a,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f,w={}){this._validate(xs,a,w)||(this._transitionable.setTransitionOrValue(a),this.id=f)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,w){return(!w||w.validate!==!1)&&Jt(this,a.call(Un,n.h({value:f,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}}let bi=class extends n.E{constructor(b,a,f,w,P){super(),this.scope=f,this._transitionable=new n.a6(new n.a7({source:new n.a8(n.a5.terrain.source),exaggeration:new n.a8(n.a5.terrain.exaggeration)}),f,w),this._transitionable.setTransitionOrValue(b,w),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a,this.worldview=P}get(){return this._transitionable.serialize()}set(b,a){this._transitionable.setTransitionOrValue(b,a)}updateTransitions(b){this._transitioning=this._transitionable.transitioned(b,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(b){this.properties=this._transitioning.possiblyEvaluate(b)}getExaggeration(b){return this._transitioning.possiblyEvaluate(new n.aa(b,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const b=this._transitionable._values.exaggeration;if(!b)return null;const a=b.value.expression;if(!a)return null;let f=-1,w=-1,P=1;for(const R of a.zoomStops)P=a.evaluate(new n.aa(R,{worldview:this.worldview})),P>.01?(f=R,w=-1):w=R;return P<.01&&f>0&&w>f?[f,w]:null}isZoomDependent(){const b=this._transitionable._values.exaggeration;return b!=null&&b.value!=null&&b.value.expression!=null&&b.value.expression instanceof n.ab}};const Oi=45,qi=65,Bi=.05;function dr(b,a,f,w){const P=n.af(Oi,qi,f),[R,H]=pr(b,w);let Q=1-Math.min(1,Math.exp((a-R)/(H-R)*-6));return Q*=Q*Q,Q=Math.min(1,1.00747*Q),Q*P*b.alpha}function pr(b,a){const f=.5/Math.tan(.5*a);return[b.range[0]+f,b.range[1]+f]}function Nr(b,a,f,w,P){const R=n.ad([],[a,f,w],P.mercatorFogMatrix);return dr(b,n.ae(R),P.pitch,P._fov)}function Gr(b,a,f,w,P,R,H){const Q=[[f,w,0],[P,w,0],[P,R,0],[f,R,0]];let oe=Number.MAX_VALUE,de=-Number.MAX_VALUE;for(const pe of Q){const yt=n.ad([],pe,a),pt=n.ae(yt);oe=Math.min(oe,pt),de=Math.max(de,pt)}return[dr(b,oe,H.pitch,H._fov),dr(b,de,H.pitch,H._fov)]}class rn extends n.E{constructor(a,f,w,P){super();const R=new n.a7({range:new n.a8(n.a5.fog.range),color:new n.a8(n.a5.fog.color),"color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.a8(n.a5.fog["high-color"]),"high-color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.a8(n.a5.fog["space-color"]),"space-color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.a8(n.a5.fog["horizon-blend"]),"star-intensity":new n.a8(n.a5.fog["star-intensity"]),"vertical-range":new n.a8(n.a5.fog["vertical-range"])});this._transitionable=new n.a6(R,w,new Map(P)),this.set(a,P),this._transitioning=this._transitionable.untransitioned(),this._transform=f,this.properties=new n.ag(R),this.scope=w}get state(){const a=this._transform,f=a.projection.name==="globe",w=n.ah(a.zoom),P=this.properties.get("range"),R=[.5,3];return{range:f?[n.ai(R[0],P[0],w),n.ai(R[1],P[1],w)]:P,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f,w={}){if(this._validate(Ki,a,w))return;const P=n.h({},a);for(const R of Object.keys(n.a5.fog))P[R]===void 0&&(P[R]=n.a5.fog[R].default);this._options=P,this._transitionable.setTransitionOrValue(this._options,f)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.af(Oi,qi,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?function(w,P,R){const H=n.ac.fromLngLat(P),Q=R.elevation?R.elevation.getAtPointOrZero(H):0;return Nr(w,H.x,H.y,Q,R)}(this.state,a,f):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Gr(this.state,f,0,0,n.aj,n.aj,this._transform)}getOpacityForBounds(a,f,w,P,R){return this._transform.projection.supportsFog?Gr(this.state,a,f,w,P,R,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?pr(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const w of f){const P=a.points[w];let R;if(P[2]>=0)R=P;else{const H=a.points[w-4];R=n.ak(H,P,H[2]/(H[2]-P[2]))}if(Nr(this.state,R[0],R[1],0,this._transform)>=Bi)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,w){return(!w||w.validate!==!1)&&Jt(this,a.call(Un,n.h({value:f,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}}let sn,hn,yn,ts,Hn=class extends n.E{constructor(b,a,f,w){super();const P=sn||(sn=new n.a7({density:new n.a8(n.a5.snow.density),intensity:new n.a8(n.a5.snow.intensity),color:new n.a8(n.a5.snow.color),opacity:new n.a8(n.a5.snow.opacity),vignette:new n.a8(n.a5.snow.vignette),"vignette-color":new n.a8(n.a5.snow["vignette-color"]),"center-thinning":new n.a8(n.a5.snow["center-thinning"]),direction:new n.a8(n.a5.snow.direction),"flake-size":new n.a8(n.a5.snow["flake-size"])}));this._transitionable=new n.a6(P,f,new Map(w)),this.set(b,w),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ag(P),this.scope=f}get state(){const b=this.properties.get("opacity"),a=this.properties.get("color"),f=this.properties.get("direction"),w=n.al(f[0]),P=-Math.max(n.al(f[1]),.01),R=[Math.cos(w)*Math.cos(P),Math.sin(w)*Math.cos(P),Math.sin(P)],H=this.properties.get("vignette"),Q=this.properties.get("vignette-color");return Q.a=H,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.am(a.r,a.g,a.b,a.a*b),direction:R,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:Q}}get(){return this._transitionable.serialize()}set(b,a,f={}){if(this._validate(pi,b,f))return;const w=n.h({},b);for(const P of Object.keys(n.a5.snow))w[P]===void 0&&(w[P]=n.a5.snow[P].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(b){this._transitionable.setTransitionOrValue(this._options,new Map(b))}updateTransitions(b){this._transitioning=this._transitionable.transitioned(b,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(b){this.properties=this._transitioning.possiblyEvaluate(b)}_validate(b,a,f){return(!f||f.validate!==!1)&&Jt(this,b.call(Un,n.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}},Vn=class extends n.E{constructor(b,a,f,w){super();const P=hn||(hn=new n.a7({density:new n.a8(n.a5.rain.density),intensity:new n.a8(n.a5.rain.intensity),color:new n.a8(n.a5.rain.color),opacity:new n.a8(n.a5.rain.opacity),vignette:new n.a8(n.a5.rain.vignette),"vignette-color":new n.a8(n.a5.rain["vignette-color"]),"center-thinning":new n.a8(n.a5.rain["center-thinning"]),direction:new n.a8(n.a5.rain.direction),"droplet-size":new n.a8(n.a5.rain["droplet-size"]),"distortion-strength":new n.a8(n.a5.rain["distortion-strength"])}));this._transitionable=new n.a6(P,f,new Map(w)),this.set(b,w),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ag(P),this.scope=f}get state(){const b=this.properties.get("opacity"),a=this.properties.get("color"),f=this.properties.get("direction"),w=n.al(f[0]),P=-Math.max(n.al(f[1]),.01),R=[Math.cos(w)*Math.cos(P),Math.sin(w)*Math.cos(P),Math.sin(P)],H=this.properties.get("vignette-color");return H.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.am(a.r,a.g,a.b,a.a*b),direction:R,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:H}}get(){return this._transitionable.serialize()}set(b,a,f={}){if(this._validate(Ii,b,f))return;const w=n.h({},b);for(const P of Object.keys(n.a5.rain))w[P]===void 0&&(w[P]=n.a5.rain[P].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(b){this._transitionable.setTransitionOrValue(this._options,new Map(b))}updateTransitions(b){this._transitioning=this._transitionable.transitioned(b,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(b){this.properties=this._transitioning.possiblyEvaluate(b)}_validate(b,a,f){return(!f||f.validate!==!1)&&Jt(this,b.call(Un,n.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}};class Gn extends n.E{constructor(a,f,w,P){super(),this.scope=w,this._options=a,this.properties=new n.ag(f),this._transitionable=new n.a6(f,w,new Map(P)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,f){this._options=a,this._transitionable.setTransitionOrValue(a.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class qn{constructor(a,f,w,P){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=w,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,P)}static createFromScreenPoints(a,f){let w,P;if(a instanceof n.P||typeof a[0]=="number"){const R=n.P.convert(a);w=[R],P=f.isPointAboveHorizon(R)}else{const R=n.P.convert(a[0]),H=n.P.convert(a[1]),Q=R.add(H)._div(2);w=[R,H],P=n.ao(R,H).every(oe=>f.isPointAboveHorizon(oe))&&f.isPointAboveHorizon(Q)}return new qn(w,f.getCameraPoint(),P,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return n.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],P=n.ao(f,w,0,!1);return this.cameraPoint.y>w.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<w.x?P.splice(3,0,this.cameraPoint):this.cameraPoint.x>=w.x?P[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(P[3]=this.cameraPoint)),n.ap(P,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],P=n.ao(f,w,a),R=this.cameraPoint.clone();switch(3*((R.y>f.y)+(R.y>w.y))+((R.x>f.x)+(R.x>w.x))){case 0:P[0]=R,P[4]=R.clone();break;case 1:P.splice(1,0,R);break;case 2:P[1]=R;break;case 3:P.splice(4,0,R);break;case 5:P.splice(2,0,R);break;case 6:P[3]=R;break;case 7:P.splice(3,0,R);break;case 8:P[2]=R}return P}containsTile(a,f,w,P=0){const R=a.queryPadding/f._pixelsPerMercatorPixel+1,H=w?this._bufferedCameraMercator(R,f):this._bufferedScreenMercator(R,f);let Q=a.tileID.wrap+(H.unwrapped?P:0);const oe=H.polygon.map(Ot=>n.aq(a.tileTransform,Ot,Q));if(!n.ar(oe,0,0,n.aj,n.aj))return;Q=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?P:0);const de=this.screenGeometryMercator.polygon.map(Ot=>n.as(a.tileTransform,Ot,Q)),pe=de.map(Ot=>new n.P(Ot[0],Ot[1])),yt=f.getFreeCameraOptions().position||new n.ac(0,0,0),pt=n.as(a.tileTransform,yt,Q),vt=de.map(Ot=>{const Bt=n.at(Ot,Ot,pt);return n.au(Bt,Bt),new n.av(pt,Bt)}),Dt=n.aw(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:pe,tilespaceRays:vt,bufferedTilespaceGeometry:oe,bufferedTilespaceBounds:(At=n.ax(oe),At.min.x=n.ay(At.min.x,0,n.aj),At.min.y=n.ay(At.min.y,0,n.aj),At.max.x=n.ay(At.max.x,0,n.aj),At.max.y=n.ay(At.max.y,0,n.aj),At),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Dt};var At}_bufferedScreenMercator(a,f){const w=ls(a);if(this._screenRaycastCache[w])return this._screenRaycastCache[w];{let P;return P=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map(R=>f.pointCoordinate3D(R)),unwrapped:!0},this._screenRaycastCache[w]=P,P}}_bufferedCameraMercator(a,f){const w=ls(a);if(this._cameraRaycastCache[w])return this._cameraRaycastCache[w];{let P;return P=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map(R=>f.pointCoordinate3D(R)),unwrapped:!0},this._cameraRaycastCache[w]=P,P}}_projectAndResample(a,f){const w=function(R,H){const Q=n.az([],H.pixelMatrix,H.globeMatrix),oe=[0,-n.aB,0,1],de=[0,n.aB,0,1],pe=[0,0,0,1];n.aA(oe,oe,Q),n.aA(de,de,Q),n.aA(pe,pe,Q);const yt=new n.P(oe[0]/oe[3],oe[1]/oe[3]),pt=new n.P(de[0]/de[3],de[1]/de[3]),vt=n.aC(R,yt)&&oe[3]<pe[3],Dt=n.aC(R,pt)&&de[3]<pe[3];if(!vt&&!Dt)return null;const At=function(vi,di,Ei){for(let Pi=1;Pi<vi.length;Pi++){const ji=bs(di.pointCoordinate3D(vi[Pi-1]).x),Wi=bs(di.pointCoordinate3D(vi[Pi]).x);if(Ei<0){if(ji<Wi)return{idx:Pi,t:-ji/(Wi-1-ji)}}else if(Wi<ji)return{idx:Pi,t:(1-ji)/(Wi+1-ji)}}return null}(R,H,vt?-1:1);if(!At)return null;const{idx:Ot,t:Bt}=At;let qt=Ot>1?Bs(R.slice(0,Ot),H):[],li=Ot<R.length?Bs(R.slice(Ot),H):[];qt=qt.map(vi=>new n.P(bs(vi.x),vi.y)),li=li.map(vi=>new n.P(bs(vi.x),vi.y));const fi=[...qt];fi.length===0&&fi.push(li[li.length-1]);const Ti=n.ai(fi[fi.length-1].y,(li.length===0?qt[0]:li[0]).y,Bt);let wi;return wi=vt?[new n.P(0,Ti),new n.P(0,0),new n.P(1,0),new n.P(1,Ti)]:[new n.P(1,Ti),new n.P(1,1),new n.P(0,1),new n.P(0,Ti)],fi.push(...wi),li.length===0?fi.push(qt[0]):fi.push(...li),{polygon:fi.map(vi=>new n.ac(vi.x,vi.y)),unwrapped:!1}}(a,f);if(w)return w;const P=function(R,H){let Q=!1,oe=-1/0,de=0;for(let yt=0;yt<R.length-1;yt++)R[yt].x>oe&&(oe=R[yt].x,de=yt);for(let yt=0;yt<R.length-1;yt++){const pt=(de+yt)%(R.length-1),vt=R[pt],Dt=R[pt+1];Math.abs(vt.x-Dt.x)>.5&&(vt.x<Dt.x?(vt.x+=1,pt===0&&(R[R.length-1].x+=1)):(Dt.x+=1,pt+1===R.length-1&&(R[0].x+=1)),Q=!0)}const pe=n.aD(H.center.lng);return Q&&pe<Math.abs(pe-1)&&R.forEach(yt=>{yt.x-=1}),{polygon:R,unwrapped:Q}}(Bs(a,f).map(R=>new n.P(bs(R.x),R.y)),f);return{polygon:P.polygon.map(R=>new n.ac(R.x,R.y)),unwrapped:P.unwrapped}}}function Bs(b,a){return n.aE(b,f=>{const w=a.pointCoordinate3D(f);f.x=w.x,f.y=w.y},1/256)}function bs(b){return b<0?1+b%1:b%1}function ls(b){return 100*b|0}function Js(b,a,f,w,P){const R=function(Q,oe){if(Q)return P(Q);if(oe){if(b.url&&oe.tiles&&b.tiles&&delete b.tiles,oe.variants){if(!Array.isArray(oe.variants))return P(new Error("variants must be an array"));for(const pe of oe.variants){if(pe==null||typeof pe!="object"||pe.constructor!==Object)return P(new Error("variant must be an object"));if(!Array.isArray(pe.capabilities))return P(new Error("capabilities must be an array"));if(pe.capabilities.length===1&&pe.capabilities[0]==="meshopt"){oe=n.h(oe,pe);break}}}const de=n.aF(n.h({},oe,b),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);de.tiles=a.canonicalizeTileset(de,b.url),P(null,de)}},H=function(Q,oe,de){if(!Q)return null;if(!oe&&!de)return Q;de=de||Q.worldview_default;const pe=Object.values(Q.language||{});if(pe.length===0)return null;const yt=Object.values(Q.worldview||{});if(yt.length===0)return null;const pt=pe.every(Dt=>Dt===oe),vt=yt.every(Dt=>Dt===de);return pt&&vt?Q:oe in(Q.language_options||{})||de in(Q.worldview_options||{})?null:Q.language_options&&Q.worldview_options?Q:null}(b.data,f,w);return H?n.q.frame(()=>R(null,H)):b.url?n.n(a.transformRequest(a.normalizeSourceURL(b.url,null,f,w),n.R.Source),R):n.q.frame(()=>{const{data:Q,...oe}=b;R(null,oe)})}function uo(b,a){const f=Math.pow(2,a.z),w=Math.floor(n.aD(b.getWest())*f),P=Math.floor(n.aH(b.getNorth())*f),R=Math.ceil(n.aD(b.getEast())*f),H=Math.ceil(n.aH(b.getSouth())*f);return a.x>=w&&a.x<R&&a.y>=P&&a.y<H}class Qs{constructor(a,f,w){this.bounds=a?n.aG.convert(this.validateBounds(a)):null,this.minzoom=f||0,this.maxzoom=w||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}addExtraBounds(a){if(a){this.extraBounds||(this.extraBounds=[]);for(const f of a)this.extraBounds.push(n.aG.convert(this.validateBounds(f)))}}contains(a){if(a.z>this.maxzoom||a.z<this.minzoom||this.bounds&&!uo(this.bounds,a))return!1;if(!this.extraBounds)return!0;for(const f of this.extraBounds)if(uo(f,a))return!0;return!1}static fromTileJSON(a){if(!a.bounds&&!a.extra_bounds)return null;const f=new Qs(a.bounds,a.minzoom,a.maxzoom);return f.addExtraBounds(a.extra_bounds),f}}class Sc extends n.E{constructor(a,f,w,P){if(super(),this.id=a,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.h(this,n.aF(f,["url","scheme","tileSize","promoteId"])),this._options=n.h({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P),this._tileWorkers={},this._deduped=new n.aI}load(a){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,w=this.map.getWorldview();this._tileJSONRequest=Js(this._options,this.map._requestManager,f,w,(P,R)=>{if(this._tileJSONRequest=null,this._loaded=!0,P)f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),w&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${w}`),this.fire(new n.z(P));else if(R){if(n.h(this,R),this.hasWorldviews=!!R.worldview_options,R.worldview_default&&(this.worldviewDefault=R.worldview_default),R.vector_layers){this.vectorLayers=R.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const H of R.vector_layers)this.vectorLayerIds.push(H.id),R.worldview&&R.worldview[H.source]&&this.localizableLayerIds.add(H.id)}this.tileBounds=Qs.fromTileJSON(R),Xi(R.tiles,this.map._requestManager._customAccessToken),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}a&&a(P)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return n.h({},this._options)}loadTile(a,f){const w=a.tileID.canonical.url(this.tiles,this.scheme),P=this.map._requestManager.normalizeTileURL(w),R=this.map._requestManager.transformRequest(P,n.R.Tile),H=this.map.style?this.map.style.getLut(this.scope):null,Q=H?{image:H.image.clone()}:null,oe={request:R,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:Q,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&n.j(w)&&(oe.localizableLayerIds=this.localizableLayerIds),oe.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=f:a.request=a.actor.send("reloadTile",oe,de.bind(this));else if(a.actor=this._tileWorkers[P]=this._tileWorkers[P]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",oe,de.bind(this),void 0,!0);else{const pe=n.aJ.call({deduped:this._deduped},oe,(yt,pt)=>{yt||!pt?de.call(this,yt):(oe.data={cacheControl:pt.cacheControl,expires:pt.expires,rawData:pt.rawData.slice(0)},a.actor&&a.actor.send("loadTile",oe,de.bind(this),void 0,!0))},!0);a.request={cancel:pe}}function de(pe,yt){return delete a.request,a.aborted?f(null):pe&&pe.status!==404?f(pe):(yt&&yt.resourceTiming&&(a.resourceTiming=yt.resourceTiming),this.map._refreshExpiredTiles&&yt&&a.setExpiryData(yt),a.loadVectorData(yt,this.map.painter),n.aK(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,f){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class po extends n.E{constructor(a,f,w,P){super(),this.id=a,this.dispatcher=w,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.h({type:"raster"},f),n.h(this,n.aF(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const f=this.map.getWorldview();this._tileJSONRequest=Js(this._options,this.map._requestManager,null,f,(w,P)=>{this._tileJSONRequest=null,this._loaded=!0,w?this.fire(new n.z(w)):P&&(n.h(this,P),P.raster_layers&&(this.rasterLayers=P.raster_layers,this.rasterLayerIds=this.rasterLayers.map(R=>R.id)),this.tileBounds=Qs.fromTileJSON(P),Xi(P.tiles),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))),a&&a(w)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return n.h({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const w=n.q.devicePixelRatio>=2,P=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),w,this.tileSize);a.request=n.o(this.map._requestManager.transformRequest(P,n.R.Tile),(R,H,Q,oe)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):R?(a.state="errored",f(R)):H?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:Q,expires:oe}),a.setTexture(H,this.map.painter),a.state="loaded",n.aK(this.dispatcher),void f(null)):f(null)))}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f&&f()}unloadTile(a,f){a.texture&&a.texture instanceof n.T?(a.destroy(!0),a.texture&&a.texture instanceof n.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),f&&f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class za extends po{constructor(a,f,w,P){super(a,f,w,P),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=n.h({type:"raster-array"},f)}triggerRepaint(a){const f=this.map.painter._terrain,w=this.map.style.getSourceCache(this.id);f&&f.enabled&&w&&f._clearRenderCacheForTile(w.id,a.tileID),this.map.triggerRepaint()}loadTile(a,f){const w=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),P=this.map._requestManager.transformRequest(w,n.R.Tile),R={request:P,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=P,a.actor||(a.actor=this.dispatcher.getActor());const H=(Q,oe,de,pe)=>{if(delete a.request,a.aborted)return a.state="unloaded",f(null);if(Q)return Q.name==="AbortError"?void 0:(a.state="errored",f(Q));if(this.map._refreshExpiredTiles&&oe&&a.setExpiryData({cacheControl:de,expires:pe}),this.partial)a.state="empty";else{if(!oe)return f(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=oe}f(null)};a.request=this.partial?a.fetchHeader(void 0,H.bind(this)):a.actor.send("loadTile",R,H.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,f){const w=a.texture;w&&w instanceof n.T?(a.destroy(!0),this.map.painter.saveTileTexture(w)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,f,w){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(f,w,(P,R)=>{if(P)return a.state="errored",this.fire(new n.z(P)),void this.triggerRepaint(a);R&&(a._isHeaderLoaded=!0,a.setTexture(R,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const f=this.rasterLayers.find(({id:R})=>R===a),w=f&&f.fields,P=w&&w.bands&&w.bands;return P?P[0]:0}getTextureDescriptor(a,f,w){if(!a)return;const P=f.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!P)return;let R=null;f instanceof n.aN?R=f.paint.get("raster-array-band"):f instanceof n.aO&&(R=f.paint.get("raster-particle-array-band"));const H=R||this.getInitialBand(P);if(H!=null)if(a.textureDescriptor){if(!a.updateNeeded(P,H)||w)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,P,H)}getImages(a,f){const w=new Map;for(const P of a)for(const R of f){const[H,Q]=R.split("/"),oe=P.getLayer(H);if(!oe||!oe.hasBand(Q)||!oe.hasDataForBand(Q))continue;const{bytes:de,tileSize:pe,buffer:yt}=oe.getBandView(Q),pt=pe+2*yt,vt={data:new n.r({width:pt,height:pt},de),pixelRatio:2,sdf:!1,usvg:!1,version:0};w.set(R,vt)}return w}}const Cu={vector:Sc,raster:po,"raster-dem":class extends po{constructor(b,a,f,w){super(b,a,f,w),this.type="raster-dem",this.maxzoom=22,this._options=n.h({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(b,a){const f=this.map._requestManager.normalizeTileURL(b.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function w(P,R){P&&(b.state="errored",a(P)),R&&(b.dem=R,b.dem.onDeserialize(),b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0,b.state="loaded",a(null))}b.request=n.o(this.map._requestManager.transformRequest(f,n.R.Tile),(function(P,R,H,Q){if(delete b.request,b.aborted)b.state="unloaded",a(null);else if(P)b.state="errored",a(P);else if(R){this.map._refreshExpiredTiles&&b.setExpiryData({cacheControl:H,expires:Q});const oe=ImageBitmap&&R instanceof ImageBitmap&&n.t(),de=1-(R.width-n.aL(R.width))/2;de<1||b.neighboringTiles||(b.neighboringTiles=this._getNeighboringTiles(b.tileID));const pe=oe?R:n.q.getImageData(R,de),yt={uid:b.uid,tileID:b.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:pe,encoding:this.encoding,padding:de};b.actor&&b.state!=="expired"||(b.actor=this.dispatcher.getActor(),b.actor.send("loadTile",yt,w.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(b){const a=b.canonical,f=Math.pow(2,a.z),w=(a.x-1+f)%f,P=a.x===0?b.wrap-1:b.wrap,R=(a.x+1+f)%f,H=a.x+1===f?b.wrap+1:b.wrap,Q={};return Q[new n.aM(b.overscaledZ,P,a.z,w,a.y).key]={backfilled:!1},Q[new n.aM(b.overscaledZ,H,a.z,R,a.y).key]={backfilled:!1},a.y>0&&(Q[new n.aM(b.overscaledZ,P,a.z,w,a.y-1).key]={backfilled:!1},Q[new n.aM(b.overscaledZ,b.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},Q[new n.aM(b.overscaledZ,H,a.z,R,a.y-1).key]={backfilled:!1}),a.y+1<f&&(Q[new n.aM(b.overscaledZ,P,a.z,w,a.y+1).key]={backfilled:!1},Q[new n.aM(b.overscaledZ,b.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},Q[new n.aM(b.overscaledZ,H,a.z,R,a.y+1).key]={backfilled:!1}),Q}},"raster-array":za,geojson:class extends n.E{constructor(b,a,f,w){super(),this.id=b,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(w),this._data=a.data,this._options=n.h({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const P=n.aj/this.tileSize;this.workerOptions=n.h({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*P,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*P,extent:n.aj,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:n.aj,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*P,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(b){this.map=b,this.setData(this._data)}setData(b){return this._data=b,this._updateWorkerData(),this}updateData(b){if(!this._options.dynamic)return this.fire(new n.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof b!="string"&&(b.type==="Feature"&&(b={type:"FeatureCollection",features:[b]}),b.type!=="FeatureCollection"))return this.fire(new n.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof b!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const a=new Map;for(const f of this._data.features)a.set(f.id,f);for(const f of b.features)a.set(f.id,f);this._data.features=[...a.values()]}else this._data=b;return this._updateWorkerData(!0),this}getClusterExpansionZoom(b,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:b,source:this.id,scope:this.scope},a),this}getClusterChildren(b,a){return this.actor.send("geojson.getClusterChildren",{clusterId:b,source:this.id,scope:this.scope},a),this}getClusterLeaves(b,a,f,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:b,limit:a,offset:f},w),this}_updateWorkerData(b=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.A("dataloading",{dataType:"source"})),this._loaded=!1;const a=n.h({append:b},this.workerOptions);a.scope=this.scope;const f=this._data;typeof f=="string"?(a.request=this.map._requestManager.transformRequest(n.q.resolveURL(f),n.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(w,P)=>{if(this._loaded=!0,this._pendingLoad=null,w)this.fire(new n.z(w));else{const R={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&P&&P.resourceTiming&&P.resourceTiming[this.id]&&(R.resourceTiming=P.resourceTiming[this.id]),b&&(this._partialReload=!0),this.fire(new n.A("data",R)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(b),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const b=n.C(this.id,this.scope);this.map.style.clearSource(b),this._updateWorkerData()}loadTile(b,a){const f=b.actor?"reloadTile":"loadTile";b.actor=this.actor;const w=this.map.style?this.map.style.getLut(this.scope):null,P=w?{image:w.image.clone()}:null,R=this._partialReload,H={type:this.type,uid:b.uid,tileID:b.tileID,tileZoom:b.tileZoom,zoom:b.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:P,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:b.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:R,worldview:this.map.getWorldview()};b.request=this.actor.send(f,H,(Q,oe)=>R&&!oe?(b.state="loaded",a(null)):(delete b.request,b.destroy(),b.aborted?a(null):Q?a(Q):(b.loadVectorData(oe,this.map.painter,f==="reloadTile"),a(null))),void 0,f==="loadTile")}abortTile(b){b.request&&(b.request.cancel(),delete b.request),b.aborted=!0}unloadTile(b,a){this.actor.send("removeTile",{uid:b.uid,type:this.type,source:this.id,scope:this.scope}),b.destroy()}onRemove(b){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aP{constructor(b,a,f,w){super(b,a,f,w),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const b=this.options;this.urls=[];for(const a of b.urls)this.urls.push(this.map._requestManager.transformRequest(a,n.R.Source).url);n.aQ(this.urls,(a,f)=>{this._loaded=!0,a?this.fire(new n.z(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(b){if(this.video){const a=this.video.seekable;b<a.start(0)||b>a.end(0)?this.fire(new n.z(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=b}}getVideo(){return this.video}onAdd(b){this.map||(this.map=b,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const b=this.map.painter.context,a=b.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(b,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(b)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aP,model:class extends n.E{constructor(b,a,f,w){super(),this.id=b,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){const b=[];for(const a in this._options.models){const f=this._options.models[a],w=n.aS(this.map._requestManager.transformRequest(f.uri,n.R.Model).url).then(P=>{if(!P)return;const R=n.aT(P),H=new n.aU(a,f.position,f.orientation,R);H.computeBoundsAndApplyParent(),this.models.push(H)}).catch(P=>{this.fire(new n.z(new Error(`Could not load model ${a} from ${f.uri}: ${P.message}`)))});b.push(w)}Promise.allSettled(b).then(()=>{this._loaded=!0,this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new n.z(new Error(`Could not load models: ${a.message}`)))})}onAdd(b){this.map=b,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(b,a){}serialize(){return this._options}},"batched-model":class extends n.E{constructor(b,a,f,w){super(),this.type="batched-model",this.id=b,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(w)}onAdd(b){this.map=b,this.load()}reload(){this.cancelTileJSONRequest();const b=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(b))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(b){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Js(this._options,this.map._requestManager,a,f,(w,P)=>{this._tileJSONRequest=null,this._loaded=!0,w?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new n.z(w))):P&&(n.h(this,P),P.bounds&&(this.tileBounds=new Qs(P.bounds,this.minzoom,this.maxzoom)),Xi(P.tiles,this.map._requestManager._customAccessToken),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))),b&&b(w)})}hasTransition(){return!1}hasTile(b){return!this.tileBounds||this.tileBounds.contains(b.canonical)}loaded(){return this._loaded}loadTile(b,a){const f=this.map._requestManager.normalizeTileURL(b.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(f,n.R.Tile),data:void 0,uid:b.uid,tileID:b.tileID,tileZoom:b.tileZoom,zoom:b.tileID.overscaledZ,tileSize:this.tileSize*b.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:b.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.q.devicePixelRatio,promoteId:this.promoteId};if(b.actor&&b.state!=="expired")if(b.state==="loading")b.reloadCallback=a;else{if(b.buckets){const R=Object.values(b.buckets);for(const H of R)H.dirty=!0;return void(b.state="loaded")}b.request=b.actor.send("reloadTile",w,P.bind(this))}else b.actor=this.dispatcher.getActor(),b.request=b.actor.send("loadTile",w,P.bind(this),void 0,!0);function P(R,H){return b.aborted?a(null):R&&R.status!==404?a(R):(this.map._refreshExpiredTiles&&H&&b.setExpiryData(H),b.loadModelData(H,this.map.painter),b.state="loaded",void a(null))}}serialize(){return n.h({},this._options)}},canvas:class extends n.aP{constructor(b,a,f,w){super(b,a,f,w),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(P=>!Array.isArray(P)||P.length!==2||P.some(R=>typeof R!="number"))||this.fire(new n.z(new n.V(`sources.${b}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.z(new n.V(`sources.${b}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new n.z(new n.V(`sources.${b}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new n.z(new n.V(`sources.${b}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.z(new n.V(`sources.${b}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(b){this.map=b,this.load(),this.canvas&&this.animate&&this.play()}onRemove(b){this.pause()}prepare(){let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!b&&!this._playing||this.texture instanceof n.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const b of[this.canvas.width,this.canvas.height])if(isNaN(b)||b<=0)return!0;return!1}},custom:class extends n.E{constructor(b,a,f,w){super(),this.id=b,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(w),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Qs(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),n.h(this,n.aF(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(b){this.map=b,this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(b),this.load()}onRemove(b){this._implementation.onRemove&&this._implementation.onRemove(b)}hasTile(b){if(this._implementation.hasTile){const{x:a,y:f,z:w}=b.canonical;return this._implementation.hasTile({x:a,y:f,z:w})}return!this.tileBounds||this.tileBounds.contains(b.canonical)}loadTile(b,a){const{x:f,y:w,z:P}=b.tileID.canonical,R=new AbortController;b.request=Promise.resolve(this._implementation.loadTile({x:f,y:w,z:P},{signal:R.signal})).then((function(H){return delete b.request,b.aborted?(b.state="unloaded",a(null)):H===void 0?(b.state="errored",a(null)):H===null?(this.loadTileData(b,{width:this.tileSize,height:this.tileSize,data:null}),b.state="loaded",a(null)):function(Q){return Q instanceof ImageData||Q instanceof HTMLCanvasElement||Q instanceof ImageBitmap||Q instanceof HTMLImageElement}(H)?(this.loadTileData(b,H),b.state="loaded",void a(null)):(b.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(H=>{H.name!=="AbortError"&&(b.state="errored",a(H))}),b.request.cancel=()=>R.abort()}loadTileData(b,a){b.setTexture(a,this.map.painter)}unloadTile(b,a){if(b.texture&&b.texture instanceof n.T?(b.destroy(!0),b.texture&&b.texture instanceof n.T&&this.map.painter.saveTileTexture(b.texture)):b.destroy(),this._implementation.unloadTile){const{x:f,y:w,z:P}=b.tileID.canonical;this._implementation.unloadTile({x:f,y:w,z:P})}a&&a()}abortTile(b,a){b.request&&b.request.cancel&&(b.request.cancel(),delete b.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(b=>({x:b.canonical.x,y:b.canonical.y,z:b.canonical.z}))}_clearTiles(){const b=n.C(this.id,this.scope);this.map.style.clearSource(b)}_update(){this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}}},Tc=function(b,a,f,w){const P=new Cu[a.type](b,a,f,w);if(P.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${P.id}`);return n.aV(["load","abort","unload","serialize","prepare"],P),P};function Ec(b,a,f=""){return`${f}:${a.id||""}:${a.layer.id}:${function(w){if("layerId"in w)return`layer:${w.layerId}`;{const{featuresetId:P,importId:R}=w;return`featureset:${P}${R?`:import:${R}`:""}`}}(b.target)}`}function Pu(b,a,f,w=""){if(b.uniqueFeatureID){const P=Ec(b,a,w);if(f.has(P))return!0;f.add(P)}return!1}function Iu(b,a,f,w,P=!1){const R=a.sourceCache.transform,H=a.sourceCache.tilesIn(b,a.has3DLayers,P);H.sort(Ru);const Q=[];for(const oe of H){const de=oe.tile.queryRenderedFeatures(a,oe,f,w,R,P);Object.keys(de).length&&Q.push({wrappedTileID:oe.tile.tileID.wrapped().key,queryResults:de})}return Q.length===0?{}:function(oe){const de={},pe={};for(const yt of oe){const pt=yt.queryResults,vt=yt.wrappedTileID,Dt=pe[vt]=pe[vt]||{};for(const At in pt){const Ot=pt[At],Bt=Dt[At]=Dt[At]||{},qt=de[At]=de[At]||[];for(const li of Ot)Bt[li.featureIndex]||(Bt[li.featureIndex]=!0,qt.push(li))}}return de}(Q)}function al(b,a,f,w,P,R){const H={},Q=w.queryRenderedSymbols(b),oe=[];for(const de of Object.keys(Q).map(Number))oe.push(P[de]);oe.sort(Ru);for(const de of oe){const pe=de.featureIndex.lookupSymbolFeatures(Q[de.bucketInstanceId],de.bucketIndex,de.sourceLayerIndex,a,f,R);for(const yt in pe){const pt=H[yt]=H[yt]||[],vt=pe[yt];vt.sort((Dt,At)=>{const Ot=de.featureSortOrder;if(Ot){const Bt=Ot.indexOf(Dt.featureIndex);return Ot.indexOf(At.featureIndex)-Bt}return At.featureIndex-Dt.featureIndex});for(const Dt of vt)pt.push(Dt)}}return H}function Mc(b,a){const f=b.getRenderableIds().map(R=>b.getTileByID(R)),w=[],P={};for(let R=0;R<f.length;R++){const H=f[R],Q=H.tileID.canonical.key;P[Q]||(P[Q]=!0,H.querySourceFeatures(w,a))}return w}function Ru(b,a){const f=b.tileID,w=a.tileID;return f.overscaledZ-w.overscaledZ||f.canonical.y-w.canonical.y||f.wrap-w.wrap||f.canonical.x-w.canonical.x}function ia(b,a){const f={};if(!a)return f;for(const w of b){const P=w.layerIds.map(R=>a.getLayer(R)).filter(Boolean);if(P.length!==0){w.layers=P,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(R=>P.filter(H=>H.id===R)[0]));for(const R of P)f[R.fqid]=w}}return f}const Uo=32,Xo=33,va=new Uint16Array(8184);for(let b=0;b<2046;b++){let a=b+2,f=0,w=0,P=0,R=0,H=0,Q=0;for(1&a?P=R=H=Uo:f=w=Q=Uo;(a>>=1)>1;){const de=f+P>>1,pe=w+R>>1;1&a?(P=f,R=w,f=H,w=Q):(f=P,w=R,P=H,R=Q),H=de,Q=pe}const oe=4*b;va[oe+0]=f,va[oe+1]=w,va[oe+2]=P,va[oe+3]=R}const ra=new Uint16Array(2178),xa=new Uint8Array(1089),Ac=new Uint16Array(1089);function ha(b){return b===0?-.03125:b===32?.03125:0}const Cc={type:2,extent:n.aj,loadGeometry:()=>[[new n.P(0,0),new n.P(n.aj+1,0),new n.P(n.aj+1,n.aj+1),new n.P(0,n.aj+1),new n.P(0,0)]]};class ll{constructor(a,f,w,P,R,H){this.tileID=a,this.uid=n.a$(),this.uses=0,this.tileSize=f,this.tileZoom=w,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=R,P&&P.style&&(this._lastUpdatedBrightness=P.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",P&&P.transform&&(this.projection=P.transform.projection),this.worldview=H}registerFadeDuration(a){const f=a+this.timeAdded;f<n.q.now()||this.fadeEndTime&&f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,f,w){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=ia(a.buckets,f.style),this.hasSymbolBuckets=!1;for(const P in this.buckets){const R=this.buckets[P];if(R instanceof n.b1){if(this.hasSymbolBuckets=!0,!w)break;R.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const P in this.buckets){const R=this.buckets[P];if(R instanceof n.b1&&R.hasRTLText){this.hasRTLText=!0,n.b2();break}}this.queryPadding=0;for(const P in this.buckets){const R=this.buckets[P],H=f.style.getOwnLayer(P);if(!H)continue;const Q=H.queryRadius(R);this.queryPadding=Math.max(this.queryPadding,Q)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new n.b0}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,f,w){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,ia(a.buckets,f.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a){for(const P in this.buckets){const R=this.buckets[P];R.uploadPending()&&R.upload(a)}const f=a.gl,w=this.imageAtlas;w&&!w.uploaded&&(this.imageAtlasTexture=new n.T(a,w.image,f.RGBA8,{useMipmap:!!w.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(a,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(a,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(a,f,w){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,w),!f||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const P=f.style.getBrightness();(this._lastUpdatedBrightness||P)&&(this._lastUpdatedBrightness&&P&&Math.abs(this._lastUpdatedBrightness-P)<.001||(this.updateBuckets(f,this._lastUpdatedBrightness!==P),this._lastUpdatedBrightness=P))}queryRenderedFeatures(a,f,w,P,R,H){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const Q=function(oe,de){const pe=n.bn([],[.5*oe.width,.5*-oe.height,1]);return n.bo(pe,pe,[1,-1,0]),n.az(pe,pe,oe.calculateProjMatrix(de.toUnwrapped())),Float32Array.from(pe)}(R,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:f,pixelPosMatrix:Q,transform:P,availableImages:w,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(a,f){const w=this.latestFeatureIndex;if(!w||!w.rawTileData)return;const P=w.loadVTLayers(),R=f?f.sourceLayer:"",H=P._geojsonTileLayer||P[R];if(!H)return;const Q=n.b3(f&&f.filter),{z:oe,x:de,y:pe}=this.tileID.canonical,yt={z:oe,x:de,y:pe};for(let pt=0;pt<H.length;pt++){const vt=H.feature(pt);if(Q.needGeometry){const Ot=n.b4(vt,!0);if(!Q.filter(new n.aa(this.tileID.overscaledZ,{worldview:this.worldview}),Ot,this.tileID.canonical))continue}else if(!Q.filter(new n.aa(this.tileID.overscaledZ,{worldview:this.worldview}),vt))continue;const Dt=w.getId(vt,R),At=new n.b5(vt,oe,de,pe,Dt);At.tile=yt,a.push(At)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const f=this.expirationTime;if(a.cacheControl){const w=n.b6(a.cacheControl);w["max-age"]&&(this.expirationTime=Date.now()+1e3*w["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const w=Date.now();let P=!1;if(this.expirationTime>w)P=!1;else if(f)if(this.expirationTime<f)P=!0;else{const R=this.expirationTime-f;R?this.expirationTime=w+Math.max(R,3e4):P=!0}else P=!0;P?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}updateBuckets(a,f){if(!this.latestFeatureIndex||!a.style)return;const w=this.latestFeatureIndex.loadVTLayers(),P=a.style.listImages(),R=a.style.getBrightness();for(const H in this.buckets){if(!a.style.hasLayer(H))continue;const Q=this.buckets[H],oe=Q.layers[0],de=oe.sourceLayer||"_geojsonTileLayer",pe=w[de],yt=a.style.getLayerSourceCache(oe);let pt={};yt&&(pt=yt._state.getState(de,void 0));const vt=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Dt=Object.keys(pt).length>0&&!f;Dt&&!Q.stateDependentLayers.length&&!f||Q.update(pt,pe,P,vt,Dt?Q.stateDependentLayers:Q.layers,f,R),(Q instanceof n.b7||Q instanceof n.b8)&&a._terrain&&a._terrain.enabled&&yt&&Q.uploadPending()&&a._terrain._clearRenderCacheForTile(yt.id,this.tileID);const At=a&&a.style&&a.style.getOwnLayer(H);At&&(this.queryPadding=Math.max(this.queryPadding,At.queryRadius(Q)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=n.q.now()+a}setTexture(a,f){const w=f.context,P=w.gl;this.texture=this.texture||f.getTileTexture(a.width),this.texture&&this.texture instanceof n.T?this.texture.update(a):(this.texture=new n.T(w,a,P.RGBA8,{useMipmap:!0}),this.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE))}setDependencies(a,f){const w={};for(const P of f)w[P]=!0;this.dependencies[a]=w}hasDependency(a,f){for(const w of a){const P=this.dependencies[w];if(P){for(const R of f)if(P[R])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,f){if(!f||f.name==="mercator"||this._tileDebugBuffer)return;const w=n.b9(Cc,this.tileID.canonical,this.tileTransform)[0],P=new n.ba,R=new n.bb;for(let H=0;H<w.length;H++){const{x:Q,y:oe}=w[H];P.emplaceBack(Q,oe),R.emplaceBack(H)}R.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(R),this._tileDebugBuffer=a.createVertexBuffer(P,n.bc.members),this._tileDebugSegments=n.bd.simpleSegment(0,0,P.length,R.length)}_makeTileBoundsBuffers(a,f){if(this._tileBoundsBuffer||!f||f.name==="mercator")return;const w=n.b9(Cc,this.tileID.canonical,this.tileTransform)[0];let P,R;if(this.isRaster){const H=function(Q,oe){const de=n.aW(Q,oe),pe=Math.pow(2,Q.z);for(let Ot=0;Ot<Xo;Ot++)for(let Bt=0;Bt<Xo;Bt++){const qt=n.aX((Q.x+(Bt+ha(Bt))/Uo)/pe),li=n.aY((Q.y+(Ot+ha(Ot))/Uo)/pe),fi=oe.project(qt,li),Ti=Ot*Xo+Bt;ra[2*Ti+0]=Math.round((fi.x*de.scale-de.x)*n.aj),ra[2*Ti+1]=Math.round((fi.y*de.scale-de.y)*n.aj)}xa.fill(0),Ac.fill(0);for(let Ot=2045;Ot>=0;Ot--){const Bt=4*Ot,qt=va[Bt+0],li=va[Bt+1],fi=va[Bt+2],Ti=va[Bt+3],wi=qt+fi>>1,vi=li+Ti>>1,di=wi+vi-li,Ei=vi+qt-wi,Pi=li*Xo+qt,ji=Ti*Xo+fi,Wi=vi*Xo+wi,or=Math.hypot((ra[2*Pi+0]+ra[2*ji+0])/2-ra[2*Wi+0],(ra[2*Pi+1]+ra[2*ji+1])/2-ra[2*Wi+1])>=16;xa[Wi]=xa[Wi]||(or?1:0),Ot<1022&&(xa[Wi]=xa[Wi]||xa[(li+Ei>>1)*Xo+(qt+di>>1)]||xa[(Ti+Ei>>1)*Xo+(fi+di>>1)])}const yt=new n.aZ,pt=new n.a_;let vt=0;function Dt(Ot,Bt){const qt=Bt*Xo+Ot;return Ac[qt]===0&&(yt.emplaceBack(ra[2*qt+0],ra[2*qt+1],Ot*n.aj/Uo,Bt*n.aj/Uo),Ac[qt]=++vt),Ac[qt]-1}function At(Ot,Bt,qt,li,fi,Ti){const wi=Ot+qt>>1,vi=Bt+li>>1;if(Math.abs(Ot-fi)+Math.abs(Bt-Ti)>1&&xa[vi*Xo+wi])At(fi,Ti,Ot,Bt,wi,vi),At(qt,li,fi,Ti,wi,vi);else{const di=Dt(Ot,Bt),Ei=Dt(qt,li),Pi=Dt(fi,Ti);pt.emplaceBack(di,Ei,Pi)}}return At(0,0,Uo,Uo,Uo,0),At(Uo,Uo,0,0,0,Uo),{vertices:yt,indices:pt}}(this.tileID.canonical,f);P=H.vertices,R=H.indices}else{P=new n.aZ,R=new n.a_;for(const{x:Q,y:oe}of w)P.emplaceBack(Q,oe,0,0);const H=n.be(P.int16.subarray(0,4*P.length),void 0,4);for(let Q=0;Q<H.length;Q+=3)R.emplaceBack(H[Q],H[Q+1],H[Q+2])}this._tileBoundsBuffer=a.createVertexBuffer(P,n.bf.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(R),this._tileBoundsSegments=n.bd.simpleSegment(0,0,P.length,R.length)}_makeGlobeTileDebugBuffers(a,f){const w=f.projection;if(!w||w.name!=="globe"||f.freezeTileCoverage)return;const P=this.tileID.canonical,R=n.bg(P,f),H=n.bh(R),Q=n.ah(f.zoom);let oe;Q>0&&(oe=n.bi(new Float64Array(16),f.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,P,f,H,oe,Q),this._makeGlobeTileDebugTextBuffer(a,P,f,H,oe,Q)}_globePoint(a,f,w,P,R,H,Q){let oe=n.bj(a,f,w);if(H){const de=1<<w.z,pe=n.aD(P.center.lng),yt=n.aH(P.center.lat),pt=(w.x+.5)/de-pe;let vt=0;pt>.5?vt=-1:pt<-.5&&(vt=1);let Dt=(a/n.aj+w.x)/de+vt,At=(f/n.aj+w.y)/de;Dt=(Dt-pe)*P._pixelsPerMercatorPixel+pe,At=(At-yt)*P._pixelsPerMercatorPixel+yt;const Ot=[Dt*P.worldSize,At*P.worldSize,0];n.ad(Ot,Ot,H),oe=n.bk(oe,Ot,Q)}return n.ad(oe,oe,R)}_makeGlobeTileDebugBorderBuffer(a,f,w,P,R,H){const Q=new n.ba,oe=new n.bb,de=new n.bl,pe=(pt,vt,Dt,At,Ot)=>{const Bt=(Dt-pt)/(Ot-1),qt=(At-vt)/(Ot-1),li=Q.length;for(let fi=0;fi<Ot;fi++){const Ti=pt+fi*Bt,wi=vt+fi*qt;Q.emplaceBack(Ti,wi);const vi=this._globePoint(Ti,wi,f,w,P,R,H);de.emplaceBack(vi[0],vi[1],vi[2]),oe.emplaceBack(li+fi)}},yt=n.aj;pe(0,0,yt,0,16),pe(yt,0,yt,yt,16),pe(yt,yt,0,yt,16),pe(0,yt,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(oe),this._tileDebugBuffer=a.createVertexBuffer(Q,n.bc.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(de,n.bm.members),this._tileDebugSegments=n.bd.simpleSegment(0,0,Q.length,oe.length)}_makeGlobeTileDebugTextBuffer(a,f,w,P,R,H){const Q=n.aj/4,oe=new n.ba,de=new n.a_,pe=new n.bl,yt=25;de.reserve(32),oe.reserve(yt),pe.reserve(yt);const pt=(vt,Dt)=>yt*vt+Dt;for(let vt=0;vt<yt;vt++){const Dt=vt*Q;for(let At=0;At<yt;At++){const Ot=At*Q;oe.emplaceBack(Ot,Dt);const Bt=this._globePoint(Ot,Dt,f,w,P,R,H);pe.emplaceBack(Bt[0],Bt[1],Bt[2])}}for(let vt=0;vt<4;vt++)for(let Dt=0;Dt<4;Dt++){const At=pt(vt,Dt),Ot=pt(vt,Dt+1),Bt=pt(vt+1,Dt),qt=pt(vt+1,Dt+1);de.emplaceBack(At,Ot,Bt),de.emplaceBack(Bt,Ot,qt)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(de),this._tileDebugTextBuffer=a.createVertexBuffer(oe,n.bc.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(pe,n.bm.members),this._tileDebugTextSegments=n.bd.simpleSegment(0,0,yt,32)}destroy(a=!1){for(const f in this.buckets)this.buckets[f].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bp.setPbf(n.bq);class kl extends ll{constructor(a,f,w,P,R){super(a,f,w,P,R),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexture(a,f){const w=f.context,P=w.gl;this.texture=this.texture||f.getTileTexture(a.width),this.texture&&this.texture instanceof n.T?this.texture.update(a,{premultiply:!1}):this.texture=new n.T(w,a,P.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(a=16384,f){const w=this._mrt=new n.bp(30),P=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=n.br(P,(R,H,Q,oe)=>{if(R)f(R);else try{const de=w.getHeaderLength(H);if(de>a)return void(this.request=this.fetchHeader(de,f));w.parseHeader(H),this._isHeaderLoaded=!0;let pe=0;for(const yt of Object.values(w.layers))pe=Math.max(pe,yt.dataIndex[yt.dataIndex.length-1].lastByte);H.byteLength>=pe&&(this.entireBuffer=H),f(null,this.entireBuffer||H,Q,oe)}catch(de){f(de)}}),this.request}fetchBand(a,f,w){const P=this._mrt;if(!this._isHeaderLoaded||!P)return void w(new Error("Tile header is not ready"));const R=this.actor;if(!R)return void w(new Error("Can't fetch tile band without an actor"));let H;const Q=(yt,pt)=>{H.complete(yt,pt),yt?w(yt):(this.updateTextureDescriptor(a,f),w(null,this.textureDescriptor&&this.textureDescriptor.img))},oe=(yt,pt)=>{if(yt)return w(yt);const vt=R.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:pt,task:H},Q,void 0,!0);this._workQueue.push(()=>{vt&&vt.cancel(),H.cancel()})},de=P.getLayer(a);if(!de)return void w(new Error(`Unknown sourceLayer "${a}"`));if(de.hasDataForBand(f))return this.updateTextureDescriptor(a,f),void w(null,this.textureDescriptor?this.textureDescriptor.img:null);const pe=de.getDataRange([f]);if(H=P.createDecodingTask(pe),!H||H.tasks.length)if(this.flushQueues(),this.entireBuffer)oe(null,this.entireBuffer.slice(pe.firstByte,pe.lastByte+1));else{const yt=Object.assign({},this.requestParams,{headers:{Range:`bytes=${pe.firstByte}-${pe.lastByte}`}}),pt=n.br(yt,oe);this._fetchQueue.push(()=>{pt.cancel(),H.cancel()})}else w(null)}updateNeeded(a,f){return(!this.textureDescriptor||this.textureDescriptor.band!==f||this.textureDescriptor.layer!==a)&&this.state!=="errored"}updateTextureDescriptor(a,f){if(!this._mrt)return;const w=this._mrt.getLayer(a);if(!w||!w.hasBand(f)||!w.hasDataForBand(f))return;const{bytes:P,tileSize:R,buffer:H,offset:Q,scale:oe}=w.getBandView(f),de=R+2*H,pe=new n.r({width:de,height:de},P),yt=this.texture;yt&&yt instanceof n.T&&yt.update(pe,{premultiply:!1}),this.textureDescriptor={layer:a,band:f,img:pe,buffer:H,offset:Q,tileSize:R,format:w.pixelFormat,mix:[oe,256*oe,65536*oe,16777216*oe]}}}class Wh{constructor(a,f){this.max=a,this.onRemove=f,this.reset()}reset(){for(const a in this.data)for(const f of this.data[a])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(a,f,w){const P=a.wrapped().key;this.data[P]===void 0&&(this.data[P]=[]);const R={value:f,timeout:void 0};if(w!==void 0&&(R.timeout=setTimeout(()=>{this.remove(a,R)},w)),this.data[P].push(R),this.order.push(P),this.order.length>this.max){const H=this._getAndRemoveByKey(this.order[0]);H&&this.onRemove(H)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const f=this.data[a].shift();return f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),f.value}getByKey(a){const f=this.data[a];return f?f[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,f){if(!this.has(a))return this;const w=a.wrapped().key,P=f===void 0?0:this.data[w].indexOf(f),R=this.data[w][P];return this.data[w].splice(P,1),R.timeout&&clearTimeout(R.timeout),this.data[w].length===0&&delete this.data[w],this.onRemove(R.value),this.order.splice(this.order.indexOf(w),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(a){const f=[];for(const w in this.data)for(const P of this.data[w])a(P.value)||f.push(P);for(const w of f)this.remove(w.value.tileID,w)}}class qh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,f,w){const P=String(f);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][P]=this.stateChanges[a][P]||{},n.h(this.stateChanges[a][P],w),this.deletedStates[a]===null){this.deletedStates[a]={};for(const R in this.state[a])R!==P&&(this.deletedStates[a][R]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][P]===null){this.deletedStates[a][P]={};for(const R in this.state[a][P])w[R]||(this.deletedStates[a][P][R]=null)}else for(const R in w)this.deletedStates[a]&&this.deletedStates[a][P]&&this.deletedStates[a][P][R]===null&&delete this.deletedStates[a][P][R]}removeFeatureState(a,f,w){if(this.deletedStates[a]===null)return;const P=String(f);if(this.deletedStates[a]=this.deletedStates[a]||{},w&&f!==void 0)this.deletedStates[a][P]!==null&&(this.deletedStates[a][P]=this.deletedStates[a][P]||{},this.deletedStates[a][P][w]=null);else if(f!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][P])for(w in this.deletedStates[a][P]={},this.stateChanges[a][P])this.deletedStates[a][P][w]=null;else this.deletedStates[a][P]=null;else this.deletedStates[a]=null}getState(a,f){const w=this.state[a]||{},P=this.stateChanges[a]||{},R=this.deletedStates[a];if(R===null)return{};if(f!==void 0){const Q=String(f),oe=n.h({},w[Q],P[Q]);if(R){const de=R[f];if(de===null)return{};for(const pe in de)delete oe[pe]}return oe}const H=n.h({},w,P);if(R)for(const Q in R)delete H[Q];return H}initializeTileState(a,f){a.refreshFeatureState(f)}coalesceChanges(a,f){const w={};for(const P in this.stateChanges){this.state[P]=this.state[P]||{};const R={};for(const H in this.stateChanges[P])this.state[P][H]||(this.state[P][H]={}),n.h(this.state[P][H],this.stateChanges[P][H]),R[H]=this.state[P][H];w[P]=R}for(const P in this.deletedStates){this.state[P]=this.state[P]||{};const R={};if(this.deletedStates[P]===null)for(const H in this.state[P])R[H]={},this.state[P][H]={};else for(const H in this.deletedStates[P]){if(this.deletedStates[P][H]===null)this.state[P][H]={};else if(this.state[P][H])for(const Q of Object.keys(this.deletedStates[P][H]))delete this.state[P][H][Q];R[H]=this.state[P][H]}w[P]=w[P]||{},n.h(w[P],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(w).length!==0)for(const P in a)a[P].refreshFeatureState(f)}}class Lo extends n.E{constructor(a,f,w){super(),this.id=a,this._onlySymbols=w,f.on("data",P=>{P.dataType==="source"&&P.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),f.on("error",()=>{this._sourceErrored=!0}),this._source=f,this._tiles={},this._cache=new Wh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new qh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,f){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,f)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const w=this._tiles[f];w.upload(a),w.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(cl).map(a=>a.key)}getRenderableIds(a,f){const w=[];for(const P in this._tiles)this._isIdRenderable(+P,a,f)&&w.push(this._tiles[P]);return a?w.sort((P,R)=>{const H=P.tileID,Q=R.tileID,oe=new n.P(H.canonical.x,H.canonical.y)._rotate(this.transform.angle),de=new n.P(Q.canonical.x,Q.canonical.y)._rotate(this.transform.angle);return H.overscaledZ-Q.overscaledZ||de.y-oe.y||de.x-oe.x}).map(P=>P.tileID.key):w.map(P=>P.tileID).sort(cl).map(P=>P.key)}hasRenderableParent(a){const f=this.findLoadedParent(a,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(a,f,w){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(f||!this._tiles[a].holdingForFade())&&(w||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,f){const w=this._tiles[a];w&&(w.state!=="loading"&&(w.state=f),this._loadTile(w,this._tileLoaded.bind(this,w,a,f)))}_tileLoaded(a,f,w,P){if(P)if(a.state="errored",P.status!==404)this._source.fire(new n.z(P,{tile:a}));else{if(this._source.fire(new n.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const R=this.map.painter.terrain;this.update(this.transform,R.getScaledDemTileSize(),!0),R.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=n.q.now(),w==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(f,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new n.A("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const f=this.getRenderableIds();for(let P=0;P<f.length;P++){const R=f[P];if(a.neighboringTiles&&a.neighboringTiles[R]){const H=this.getTileByID(R);w(a,H),w(H,a)}}function w(P,R){if(!P.dem||P.dem.borderReady)return;P.needsHillshadePrepare=!0,P.needsDEMTextureUpload=!0;let H=R.tileID.canonical.x-P.tileID.canonical.x;const Q=R.tileID.canonical.y-P.tileID.canonical.y,oe=Math.pow(2,P.tileID.canonical.z),de=R.tileID.key;H===0&&Q===0||Math.abs(Q)>1||(Math.abs(H)>1&&(Math.abs(H+oe)===1?H+=oe:Math.abs(H-oe)===1&&(H-=oe)),R.dem&&P.dem&&(P.dem.backfillBorder(R.dem,H,Q),P.neighboringTiles&&P.neighboringTiles[de]&&(P.neighboringTiles[de].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,f,w,P){for(const R in this._tiles){let H=this._tiles[R];if(P[R]||!H.hasData()||H.tileID.overscaledZ<=f||H.tileID.overscaledZ>w)continue;let Q=H.tileID;for(;H&&H.tileID.overscaledZ>f+1;){const de=H.tileID.scaledTo(H.tileID.overscaledZ-1);H=this._tiles[de.key],H&&H.hasData()&&(Q=de)}let oe=Q;for(;oe.overscaledZ>f;)if(oe=oe.scaledTo(oe.overscaledZ-1),a[oe.key]){P[Q.key]=Q;break}}}findLoadedParent(a,f){if(a.key in this._loadedParentTiles){const w=this._loadedParentTiles[a.key];return w&&w.tileID.overscaledZ>=f?w:null}for(let w=a.overscaledZ-1;w>=f;w--){const P=a.scaledTo(w),R=this._getLoadedTile(P);if(R)return R}}_getLoadedTile(a){const f=this._tiles[a.key];return f&&f.hasData()?f:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,f){f=f||this._source.tileSize;const w=Math.ceil(a.width/f)+1,P=Math.ceil(a.height/f)+1,R=Math.floor(w*P*5),H=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,R):R,Q=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,H):H;this._cache.setMaxSize(Q)}handleWrapJump(a){const f=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,f){const w={};for(const P in this._tiles){const R=this._tiles[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+f),w[R.tileID.key]=R}this._tiles=w;for(const P in this._timers)clearTimeout(this._timers[P]),delete this._timers[P];for(const P in this._tiles)this._setTileReloadTimer(+P,this._tiles[P])}}update(a,f,w,P,R){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!w)return;this.updateCacheSize(a,f),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const H=this._source.type==="batched-model";let Q,oe=this._source.maxzoom;const de=this.map&&this.map.painter?this.map.painter._terrain:null;if(de&&de.sourceCache===this&&de.attenuationRange()){const pt=de.attenuationRange()[0],vt=Math.floor(pt)-Math.log2(de.getDemUpscale());oe>vt&&(oe=vt)}if(this.used||this.usedForTerrain){if(this._source.tileID)Q=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(pt=>new n.aM(pt.canonical.z,pt.wrap,pt.canonical.z,pt.canonical.x,pt.canonical.y));else if(this.tileCoverLift!==0){const pt=a.clone();pt.tileCoverLift=this.tileCoverLift,Q=pt.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:oe,roundZoom:this._source.roundZoom&&!w,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:H}),this._source.minzoom<=1&&a.projection.name==="globe"&&(Q.push(new n.aM(1,0,1,0,0)),Q.push(new n.aM(1,0,1,1,0)),Q.push(new n.aM(1,0,1,0,1)),Q.push(new n.aM(1,0,1,1,1)))}else if(Q=a.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:oe,roundZoom:this._source.roundZoom&&!w,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:H}),this._source.hasTile){const pt=this._source.hasTile.bind(this._source);Q=Q.filter(vt=>pt(vt))}}else Q=[];if(Q.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Pc(this._source.type)){const pt=a.coveringZoomLevel({tileSize:f||this._source.tileSize,roundZoom:this._source.roundZoom&&!w}),vt=Math.min(pt,this._source.maxzoom);if(H){const Dt=a.extendTileCover(Q,vt);for(const At of Dt)Q.push(At)}else if(R){const Dt=a.extendTileCover(Q,vt,this.transform._camera.forward());for(const At of Dt)Q.push(At)}else if(this.castsShadows&&P){const Dt=a.extendTileCover(Q,vt,P);for(const At of Dt)this._shadowCasterTiles[At.key]=!0,Q.push(At)}}const pe=this._updateRetainedTiles(Q);if(Pc(this._source.type)&&Q.length!==0){const pt={},vt={},Dt=Object.keys(pe);for(const Ot of Dt){const Bt=pe[Ot],qt=this._tiles[Ot];if(!qt||qt.fadeEndTime&&qt.fadeEndTime<=n.q.now())continue;const li=this.findLoadedParent(Bt,Math.max(Bt.overscaledZ-Lo.maxOverzooming,this._source.minzoom));li&&(this._addTile(li.tileID),pt[li.tileID.key]=li.tileID),vt[Ot]=Bt}const At=Q[Q.length-1].overscaledZ;for(const Ot in this._tiles){const Bt=this._tiles[Ot];if(pe[Ot]||!Bt.hasData())continue;let qt=Bt.tileID;for(;qt.overscaledZ>At;){qt=qt.scaledTo(qt.overscaledZ-1);const li=this._tiles[qt.key];if(li&&li.hasData()&&vt[qt.key]){pe[Ot]=Bt.tileID;break}}}for(const Ot in pt)pe[Ot]||(this._coveredTiles[Ot]=!0,pe[Ot]=pt[Ot])}for(const pt in pe)this._tiles[pt].clearFadeHold();const yt=n.bs(this._tiles,pe);for(const pt of yt){const vt=this._tiles[pt];vt.hasSymbolBuckets&&!vt.holdingForFade()?vt.setHoldDuration(this.map._fadeDuration):vt.hasSymbolBuckets&&!vt.symbolFadeFinished()||this._removeTile(+pt)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const f={};if(a.length===0)return f;const w={},P=a.reduce((de,pe)=>Math.min(de,pe.overscaledZ),1/0),R=a[0].overscaledZ,H=Math.max(R-Lo.maxOverzooming,this._source.minzoom),Q=Math.max(R+Lo.maxUnderzooming,this._source.minzoom),oe={};for(const de of a){const pe=this._addTile(de);f[de.key]=de,pe.hasData()||P<this._source.maxzoom&&(oe[de.key]=de)}this._retainLoadedChildren(oe,P,Q,f);for(const de of a){let pe=this._tiles[de.key];if(pe.hasData())continue;if(de.canonical.z>=this._source.maxzoom){const pt=de.children(this._source.maxzoom)[0],vt=this.getTile(pt);if(vt&&vt.hasData()){f[pt.key]=pt;continue}}else{const pt=de.children(this._source.maxzoom);if(f[pt[0].key]&&f[pt[1].key]&&f[pt[2].key]&&f[pt[3].key])continue}let yt=pe.wasRequested();for(let pt=de.overscaledZ-1;pt>=H;--pt){const vt=de.scaledTo(pt);if(w[vt.key]||(w[vt.key]=!0,pe=this.getTile(vt),!pe&&yt&&(pe=this._addTile(vt)),pe&&(f[vt.key]=vt,yt=pe.wasRequested(),pe.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const f=[];let w,P=this._tiles[a].tileID;for(;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){w=this._loadedParentTiles[P.key];break}f.push(P.key);const R=P.scaledTo(P.overscaledZ-1);if(w=this._getLoadedTile(R),w)break;P=R}for(const R of f)this._loadedParentTiles[R]=w}}_addTile(a){let f=this._tiles[a.key];if(f)return f.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),f;f=this._cache.getAndRemove(a),f&&(this._setTileReloadTimer(a.key,f),f.tileID=a,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,f)));const w=!!f;if(!w){const P=this.map?this.map.painter:null,R=this._source.tileSize*a.overscaleFactor();f=this._source.type==="raster-array"?new kl(a,R,this.transform.tileZoom,P,this._isRaster):new ll(a,R,this.transform.tileZoom,P,this._isRaster,this._source.worldview),this._loadTile(f,this._tileLoaded.bind(this,f,a.key,f.state))}return f.uses++,this._tiles[a.key]=f,w||this._source.fire(new n.A("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(a,f){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const w=f.getExpiryTimeout();w&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},w))}_removeTile(a){const f=this._tiles[a];f&&(f.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),f.uses>0||(f.hasData()&&f.state!=="reloading"||f.state==="empty"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,f,w){const P=[],R=this.transform;if(!R)return P;const H=R.projection.name==="globe",Q=n.aD(R.center.lng);for(const oe in this._tiles){const de=this._tiles[oe];if(w&&de.clearQueryDebugViz(),de.holdingForFade())continue;let pe;if(H){const yt=de.tileID.canonical;if(yt.z===0){const pt=[Math.abs(n.ay(Q,...Dl(yt,-1))-Q),Math.abs(n.ay(Q,...Dl(yt,1))-Q)];pe=[0,2*pt.indexOf(Math.min(...pt))-1]}else{const pt=[Math.abs(n.ay(Q,...Dl(yt,-1))-Q),Math.abs(n.ay(Q,...Dl(yt,0))-Q),Math.abs(n.ay(Q,...Dl(yt,1))-Q)];pe=[pt.indexOf(Math.min(...pt))-1]}}else pe=[0];for(const yt of pe){const pt=a.containsTile(de,R,f,yt);pt&&P.push(pt)}}return P}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,f){const w=this.getRenderableIds(a,f).map(R=>this._tiles[R].tileID),P=this.transform.projection.name==="globe";for(const R of w)R.projMatrix=this.transform.calculateProjMatrix(R.toUnwrapped()),R.expandedProjMatrix=P?this.transform.calculateProjMatrix(R.toUnwrapped(),!1,!0):R.projMatrix;return w}sortCoordinatesByDistance(a){const f=a.slice(),w=this.transform._camera.position,P=this.transform._camera.forward(),R={};for(const H of f){const Q=1/(1<<H.canonical.z);R[H.key]=((H.canonical.x+.5)*Q+H.wrap-w[0])*P[0]+((H.canonical.y+.5)*Q-w[1])*P[1]-w[2]*P[2]}return f.sort((H,Q)=>R[H.key]-R[Q.key]),f}hasTransition(){if(this._source.hasTransition())return!0;if(Pc(this._source.type))for(const a in this._tiles){const f=this._tiles[a];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(a,f,w){this._state.updateState(a=a||"_geojsonTileLayer",f,w)}removeFeatureState(a,f,w){this._state.removeFeatureState(a=a||"_geojsonTileLayer",f,w)}getFeatureState(a,f){return this._state.getState(a=a||"_geojsonTileLayer",f)}setDependencies(a,f,w){const P=this._tiles[a];P&&P.setDependencies(f,w)}reloadTilesForDependencies(a,f){for(const w in this._tiles)this._tiles[w].hasDependency(a,f)&&this._reloadTile(+w,"reloading");this._cache.filter(w=>!w.hasDependency(a,f))}_preloadTiles(a,f){if(!this._sourceLoaded){const oe=()=>{this._sourceLoaded&&(this._source.off("data",oe),this._preloadTiles(a,f))};return void this._source.on("data",oe)}const w=new Map,P=Array.isArray(a)?a:[a],R=this.map.painter.terrain,H=this.usedForTerrain&&R?R.getScaledDemTileSize():this._source.tileSize;for(const oe of P){const de=oe.coveringTiles({tileSize:H,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const pe of de)w.set(pe.key,pe);this.usedForTerrain&&oe.updateElevation(!1)}const Q=Array.from(w.values());n.bt(Q,(oe,de)=>{const pe=new ll(oe,this._source.tileSize*oe.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(pe,yt=>{this._source.type==="raster-dem"&&pe.dem&&this._backfillDEM(pe),de(yt,pe)})},f)}}function cl(b,a){const f=Math.abs(2*b.wrap)-+(b.wrap<0),w=Math.abs(2*a.wrap)-+(a.wrap<0);return b.overscaledZ-a.overscaledZ||w-f||a.canonical.y-b.canonical.y||a.canonical.x-b.canonical.x}function Pc(b){return b==="raster"||b==="image"||b==="video"||b==="custom"}function Dl(b,a){const f=1<<b.z;return[b.x/f+a,(b.x+1)/f+a]}Lo.maxOverzooming=10,Lo.maxUnderzooming=3;class kd{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,f=!1;for(const w in this.style._mergedLayers){const P=this.style._mergedLayers[w];if(P.type==="fill-extrusion"||P.type==="building")this.layers.push({layer:P,visible:a,visibilityChanged:f});else if(P.type==="model"){const R=this.style.getLayerSource(P);R&&R.type==="batched-model"&&this.layers.push({layer:P,visible:a,visibilityChanged:f})}}}onNewFrame(a){this.layersGotHidden=!1;for(const f of this.layers){const w=f.layer;let P=!1;w.type==="fill-extrusion"?P=!w.isHidden(a)&&w.paint.get("fill-extrusion-opacity")>0:w.type==="building"?P=!w.isHidden(a)&&w.paint.get("building-opacity")>0:w.type==="model"&&(P=!w.isHidden(a)&&w.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!P&&f.visible,f.visible=P}}updateZOffset(a,f){this.currentBuildingBuckets=[];for(const P of this.layers){const R=P.layer,H=this.style.getLayerSourceCache(R);let Q=1;R.type==="fill-extrusion"?Q=P.visible?R.paint.get("fill-extrusion-vertical-scale"):0:R.type==="building"&&(Q=P.visible?R.paint.get("building-vertical-scale"):0);let oe=H?H.getTile(f):null;if(!oe&&H&&f.canonical.z>H.getSource().minzoom){let de=f.scaledTo(Math.min(H.getSource().maxzoom,f.overscaledZ-1));for(;de.overscaledZ>=H.getSource().minzoom&&(oe=H.getTile(de),!oe&&de.overscaledZ!==0);)de=de.scaledTo(de.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:oe?oe.getBucket(R):null,tileID:oe?oe.tileID:f,verticalScale:Q})}a.hasAnyZOffset=!1;let w=!1;for(let P=0;P<a.symbolInstances.length;P++){const R=a.symbolInstances.get(P),H=R.zOffset,Q=this._getHeightAtTileOffset(f,R.tileAnchorX,R.tileAnchorY);R.zOffset=Q!==Number.NEGATIVE_INFINITY?Q:H,w||H===R.zOffset||(w=!0),a.hasAnyZOffset||R.zOffset===0||(a.hasAnyZOffset=!0)}w&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,f,w,P){let R=f,H=w;if(a.canonical.z!==P.canonical.z){const Q=P.canonical,oe=1/(1<<a.canonical.z-Q.z);R=(f+a.canonical.x*n.aj)*oe-Q.x*n.aj|0,H=(w+a.canonical.y*n.aj)*oe-Q.y*n.aj|0}return{tileX:R,tileY:H}}_getHeightAtTileOffset(a,f,w){let P,R;for(let H=0;H<this.layers.length;++H){const Q=this.layers[H].layer;if(Q.type!=="fill-extrusion"&&Q.type!=="building")continue;const{bucket:oe,tileID:de,verticalScale:pe}=this.currentBuildingBuckets[H];if(!oe)continue;const{tileX:yt,tileY:pt}=this._mapCoordToOverlappingTile(a,f,w,de),vt=oe.getHeightAtTileCoord(yt,pt);vt&&vt.height!==void 0&&(vt.hidden?P=vt.height:R=Math.max(vt.height*pe,R||0))}if(R!==void 0)return R;for(let H=0;H<this.layers.length;++H){const Q=this.layers[H];if(Q.layer.type!=="model"||!Q.visible)continue;const{bucket:oe,tileID:de}=this.currentBuildingBuckets[H];if(!oe)continue;const{tileX:pe,tileY:yt}=this._mapCoordToOverlappingTile(a,f,w,de),pt=oe.getHeightAtTileCoord(pe,yt);if(pt&&!pt.hidden)return pt.height===void 0&&P!==void 0?Math.min(pt.maxHeight,P)*pt.verticalScale:pt.height?pt.height*pt.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Dd(b,a){const f={};for(const w in b)w!=="ref"&&(f[w]=b[w]);return n.bu.forEach(w=>{w in a&&(f[w]=a[w])}),f}function Ic(b){b=b.slice();const a=Object.create(null);for(let f=0;f<b.length;f++)a[b[f].id]=b[f];for(let f=0;f<b.length;f++)"ref"in b[f]&&(b[f]=Dd(b[f],a[b[f].ref]));return b}const Xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Lu(b,a,f){f.push({command:Xn.addSource,args:[b,a[b]]})}function Fl(b,a,f){a.push({command:Xn.removeSource,args:[b]}),f[b]=!0}function Rc(b,a,f,w){Fl(b,f,w),Lu(b,a,f)}function Pm(b,a,f){let w;for(w in b[f])if(b[f].hasOwnProperty(w)&&w!=="data"&&!n.bv(b[f][w],a[f][w]))return!1;for(w in a[f])if(a[f].hasOwnProperty(w)&&w!=="data"&&!n.bv(b[f][w],a[f][w]))return!1;return!0}function Lc(b,a,f,w,P,R){let H;for(H in a=a||{},b=b||{})b.hasOwnProperty(H)&&(n.bv(b[H],a[H])||f.push({command:R,args:[w,H,a[H],P]}));for(H in a)a.hasOwnProperty(H)&&!b.hasOwnProperty(H)&&(n.bv(b[H],a[H])||f.push({command:R,args:[w,H,a[H],P]}))}function ul(b){return b.id}function Ba(b,a){return b[a.id]=a,b}class Xh{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let w=1;w<this.points.length;w++)this._distances[w]=this._distances[w-1]+this.points[w].dist(this.points[w-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=n.ay(a,0,1);let f=1,w=this._distances[f];const P=a*this.paddedLength+this.padding;for(;w<P&&f<this._distances.length;)w=this._distances[++f];const R=f-1,H=this._distances[R],Q=w-H,oe=Q>0?(P-H)/Q:0;return this.points[R].mult(1-oe).add(this.points[f].mult(oe))}}class Zh{constructor(a,f,w){const P=this.boxCells=[],R=this.circleCells=[];this.xCellCount=Math.ceil(a/w),this.yCellCount=Math.ceil(f/w);for(let H=0;H<this.xCellCount*this.yCellCount;H++)P.push([]),R.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,w,P,R){this._forEachCell(f,w,P,R,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(w),this.bboxes.push(P),this.bboxes.push(R)}insertCircle(a,f,w,P){this._forEachCell(f-P,w-P,f+P,w+P,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(w),this.circles.push(P)}_insertBoxCell(a,f,w,P,R,H){this.boxCells[R].push(H)}_insertCircleCell(a,f,w,P,R,H){this.circleCells[R].push(H)}_query(a,f,w,P,R,H){if(w<0||a>this.width||P<0||f>this.height)return!R&&[];const Q=[];if(a<=0&&f<=0&&this.width<=w&&this.height<=P){if(R)return!0;for(let oe=0;oe<this.boxKeys.length;oe++)Q.push({key:this.boxKeys[oe],x1:this.bboxes[4*oe],y1:this.bboxes[4*oe+1],x2:this.bboxes[4*oe+2],y2:this.bboxes[4*oe+3]});for(let oe=0;oe<this.circleKeys.length;oe++){const de=this.circles[3*oe],pe=this.circles[3*oe+1],yt=this.circles[3*oe+2];Q.push({key:this.circleKeys[oe],x1:de-yt,y1:pe-yt,x2:de+yt,y2:pe+yt})}return H?Q.filter(H):Q}return this._forEachCell(a,f,w,P,this._queryCell,Q,{hitTest:R,seenUids:{box:{},circle:{}}},H),R?Q.length>0:Q}_queryCircle(a,f,w,P,R){const H=a-w,Q=a+w,oe=f-w,de=f+w;if(Q<0||H>this.width||de<0||oe>this.height)return!P&&[];const pe=[];return this._forEachCell(H,oe,Q,de,this._queryCellCircle,pe,{hitTest:P,circle:{x:a,y:f,radius:w},seenUids:{box:{},circle:{}}},R),P?pe.length>0:pe}query(a,f,w,P,R){return this._query(a,f,w,P,!1,R)}hitTest(a,f,w,P,R){return this._query(a,f,w,P,!0,R)}hitTestCircle(a,f,w,P){return this._queryCircle(a,f,w,!0,P)}_queryCell(a,f,w,P,R,H,Q,oe){const de=Q.seenUids,pe=this.boxCells[R];if(pe!==null){const pt=this.bboxes;for(const vt of pe)if(!de.box[vt]){de.box[vt]=!0;const Dt=4*vt;if(a<=pt[Dt+2]&&f<=pt[Dt+3]&&w>=pt[Dt+0]&&P>=pt[Dt+1]&&(!oe||oe(this.boxKeys[vt]))){if(Q.hitTest)return H.push(!0),!0;H.push({key:this.boxKeys[vt],x1:pt[Dt],y1:pt[Dt+1],x2:pt[Dt+2],y2:pt[Dt+3]})}}}const yt=this.circleCells[R];if(yt!==null){const pt=this.circles;for(const vt of yt)if(!de.circle[vt]){de.circle[vt]=!0;const Dt=3*vt;if(this._circleAndRectCollide(pt[Dt],pt[Dt+1],pt[Dt+2],a,f,w,P)&&(!oe||oe(this.circleKeys[vt]))){if(Q.hitTest)return H.push(!0),!0;{const At=pt[Dt],Ot=pt[Dt+1],Bt=pt[Dt+2];H.push({key:this.circleKeys[vt],x1:At-Bt,y1:Ot-Bt,x2:At+Bt,y2:Ot+Bt})}}}}}_queryCellCircle(a,f,w,P,R,H,Q,oe){const de=Q.circle,pe=Q.seenUids,yt=this.boxCells[R];if(yt!==null){const vt=this.bboxes;for(const Dt of yt)if(!pe.box[Dt]){pe.box[Dt]=!0;const At=4*Dt;if(this._circleAndRectCollide(de.x,de.y,de.radius,vt[At+0],vt[At+1],vt[At+2],vt[At+3])&&(!oe||oe(this.boxKeys[Dt])))return H.push(!0),!0}}const pt=this.circleCells[R];if(pt!==null){const vt=this.circles;for(const Dt of pt)if(!pe.circle[Dt]){pe.circle[Dt]=!0;const At=3*Dt;if(this._circlesCollide(vt[At],vt[At+1],vt[At+2],de.x,de.y,de.radius)&&(!oe||oe(this.circleKeys[Dt])))return H.push(!0),!0}}}_forEachCell(a,f,w,P,R,H,Q,oe){const de=this._convertToXCellCoord(a),pe=this._convertToYCellCoord(f),yt=this._convertToXCellCoord(w),pt=this._convertToYCellCoord(P);for(let vt=de;vt<=yt;vt++)for(let Dt=pe;Dt<=pt;Dt++)if(R.call(this,a,f,w,P,this.xCellCount*Dt+vt,H,Q,oe))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,w,P,R,H){const Q=P-a,oe=R-f,de=w+H;return de*de>Q*Q+oe*oe}_circleAndRectCollide(a,f,w,P,R,H,Q){const oe=(H-P)/2,de=Math.abs(a-(P+oe));if(de>oe+w)return!1;const pe=(Q-R)/2,yt=Math.abs(f-(R+pe));if(yt>pe+w)return!1;if(de<=oe||yt<=pe)return!0;const pt=de-oe,vt=yt-pe;return pt*pt+vt*vt<=w*w}}const hl={unknown:0,flipRequired:1,flipNotRequired:2},Fd=Math.tan(85*Math.PI/180);function ba(b,a,f,w,P,R,H){const Q=n.bz();if(f)if(R.name==="globe"){const oe=n.bA(P,a);n.az(Q,Q,oe)}else{const oe=n.bB([],H);Q[0]=oe[0],Q[1]=oe[1],Q[4]=oe[2],Q[5]=oe[3],w||n.by(Q,Q,P.angle)}else n.az(Q,P.labelPlaneMatrix,b);return Q}function ku(b,a,f,w,P,R,H){const Q=ba(b,a,f,w,P,R,H);return R.name==="globe"&&f||(Q[2]=Q[6]=Q[10]=Q[14]=0),Q}function Du(b,a,f,w,P,R,H){if(f){if(R.name==="globe"){const Q=ba(b,a,f,w,P,R,H);return n.bi(Q,Q),n.az(Q,b,Q),Q}{const Q=n.bw(b),oe=n.bx([]);return oe[0]=H[0],oe[1]=H[1],oe[4]=H[2],oe[5]=H[3],n.az(Q,Q,oe),w||n.by(Q,Q,-P.angle),Q}}return P.glCoordMatrix}function na(b,a,f,w){const P=[b,a,f,1];f?n.aA(P,P,w):rs(P,P,w);const R=P[3];return P[0]/=R,P[1]/=R,P[2]/=R,P}function kc(b,a){return Math.min(.5+b/a*.5,1.5)}function fl(b,a){const f=b[0]/b[3],w=b[1]/b[3];return f>=-a[0]&&f<=a[0]&&w>=-a[1]&&w<=a[1]}function Fu(b,a,f,w,P,R,H,Q,oe,de){const pe=f.transform,yt=w?b.textSizeData:b.iconSizeData,pt=n.bH(yt,f.transform.zoom),vt=pe.projection.name==="globe",Dt=[256/f.width*2+1,256/f.height*2+1],At=w?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;At.clear();let Ot=null;vt&&(Ot=w?b.text.globeExtVertexArray:b.icon.globeExtVertexArray);const Bt=b.lineVertexArray,qt=w?b.text.placedSymbolArray:b.icon.placedSymbolArray,li=f.transform.width/f.transform.height;let fi,Ti=!1;for(let wi=0;wi<qt.length;wi++){const vi=qt.get(wi),{numGlyphs:di,writingMode:Ei}=vi;if(Ei!==n.bI.vertical||Ti||fi===n.bI.horizontal||(Ti=!0),fi=Ei,(vi.hidden||Ei===n.bI.vertical)&&!Ti){pl(di,At);continue}Ti=!1;const Pi=new n.P(vi.tileAnchorX,vi.tileAnchorY);let{x:ji,y:Wi,z:or}=pe.projection.projectTilePoint(Pi.x,Pi.y,de.canonical);if(oe){const[Wr,qr,Ur]=oe(Pi);ji+=Wr,Wi+=qr,or+=Ur}const ar=[ji,Wi,or,1];if(n.aA(ar,ar,a),!fl(ar,Dt)){pl(di,At);continue}const vr=ar[3],Ui=kc(f.transform.getCameraToCenterDistance(pe.projection),vr),Ji=n.bJ(yt,pt,vi),zi=H?Ji/Ui:Ji*Ui,ur=na(ji,Wi,or,P);if(ur[3]<=0){pl(di,At);continue}let Zi={};const gr=n.al(b.layers[0].layout.get("text-max-angle")),kr=Math.cos(gr),cr=H?null:oe,Pr=dl(vi,zi,!1,Q,a,P,R,b.glyphOffsetArray,Bt,At,Ot,ur,Pi,Zi,li,cr,pe.projection,de,H,kr);Ti=Pr.useVertical,cr&&Pr.needsFlipping&&(Zi={}),(Pr.notEnoughRoom||Ti||Pr.needsFlipping&&dl(vi,zi,!0,Q,a,P,R,b.glyphOffsetArray,Bt,At,Ot,ur,Pi,Zi,li,cr,pe.projection,de,H,kr).notEnoughRoom)&&pl(di,At)}w?(b.text.dynamicLayoutVertexBuffer.updateData(At),Ot&&b.text.globeExtVertexBuffer&&b.text.globeExtVertexBuffer.updateData(Ot)):(b.icon.dynamicLayoutVertexBuffer.updateData(At),Ot&&b.icon.globeExtVertexBuffer&&b.icon.globeExtVertexBuffer.updateData(Ot))}function Yh(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot){const{lineStartIndex:Bt,glyphStartIndex:qt,segment:li}=Q,fi=qt+Q.numGlyphs,Ti=Bt+Q.lineLength,wi=a.getoffsetX(qt),vi=a.getoffsetX(fi-1),di=Ol(b*wi,f,w,P,R,H,li,Bt,Ti,oe,de,pe,yt,pt,!0,vt,Dt,At,Ot);if(!di)return null;const Ei=Ol(b*vi,f,w,P,R,H,li,Bt,Ti,oe,de,pe,yt,pt,!0,vt,Dt,At,Ot);return Ei?{first:di,last:Ei}:null}function Ou(b,a,f,w){return b===n.bI.horizontal&&Math.abs(w)>Math.abs(f)?{useVertical:!0}:b===n.bI.vertical?w>0?{needsFlipping:!0}:null:a!==hl.unknown&&function(P,R){return P===0||Math.abs(R/P)>Fd}(f,w)?a===hl.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function dl(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt,li){const fi=a/24,Ti=b.lineOffsetX*fi,wi=b.lineOffsetY*fi,{lineStartIndex:vi,glyphStartIndex:di,numGlyphs:Ei,segment:Pi,writingMode:ji,flipState:Wi}=b,or=vi+b.lineLength,ar=vr=>{if(pe){const[ur,Zi,gr]=vr.up,kr=de.length;n.bK(pe,kr+0,ur,Zi,gr),n.bK(pe,kr+1,ur,Zi,gr),n.bK(pe,kr+2,ur,Zi,gr),n.bK(pe,kr+3,ur,Zi,gr)}const[Ui,Ji,zi]=vr.point;n.bL(de,Ui,Ji,zi,vr.angle)};if(Ei>1){const vr=Yh(fi,Q,Ti,wi,f,yt,pt,b,oe,R,vt,At,!1,Ot,Bt,qt,li);if(!vr)return{notEnoughRoom:!0};if(w&&!f){let[Ui,Ji,zi]=vr.first.point,[ur,Zi,gr]=vr.last.point;[Ui,Ji]=na(Ui,Ji,zi,H),[ur,Zi]=na(ur,Zi,gr,H);const kr=Ou(ji,Wi,(ur-Ui)*Dt,Zi-Ji);if(b.flipState=kr&&kr.needsFlipping?hl.flipRequired:hl.flipNotRequired,kr)return kr}ar(vr.first);for(let Ui=di+1;Ui<di+Ei-1;Ui++){const Ji=Ol(fi*Q.getoffsetX(Ui),Ti,wi,f,yt,pt,Pi,vi,or,oe,R,vt,At,!1,!1,Ot,Bt,qt,li);if(!Ji)return de.length-=4*(Ui-di),{notEnoughRoom:!0};ar(Ji)}ar(vr.last)}else{if(w&&!f){const Ui=na(pt.x,pt.y,0,P),Ji=vi+Pi+1,zi=new n.P(oe.getx(Ji),oe.gety(Ji)),ur=na(zi.x,zi.y,0,P),Zi=ur[3]>0?ur:Kh(pt,zi,Ui,1,P,void 0,Ot,Bt.canonical),gr=Ou(ji,Wi,(Zi[0]-Ui[0])*Dt,Zi[1]-Ui[1]);if(b.flipState=gr&&gr.needsFlipping?hl.flipRequired:hl.flipNotRequired,gr)return gr}const vr=Ol(fi*Q.getoffsetX(di),Ti,wi,f,yt,pt,Pi,vi,or,oe,R,vt,At,!1,!1,Ot,Bt,qt,li);if(!vr)return{notEnoughRoom:!0};ar(vr)}return{}}function Oo(b,a,f,w,P){const{x:R,y:H,z:Q}=w.projectTilePoint(b.x,b.y,a);if(!P)return na(R,H,Q,f);const[oe,de,pe]=P(b);return na(R+oe,H+de,Q+pe,f)}function Kh(b,a,f,w,P,R,H,Q){const oe=Oo(b.sub(a)._unit()._add(b),Q,P,H,R);return n.at(oe,f,oe),n.au(oe,oe),n.bE(oe,f,oe,w)}function Ol(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt){const li=w?b-a:b+a;let fi=li>0?1:-1,Ti=0;w&&(fi*=-1,Ti=Math.PI),fi<0&&(Ti+=Math.PI);let wi=Q+H+(fi>0?0:1)|0,vi=P,di=P,Ei=0,Pi=0;const ji=Math.abs(li),Wi=[],or=[];let ar=R,vr=ar,Ui=n.bC([]);const Ji=()=>Kh(vr,ar,di,ji-Ei+1,pe,pt,At,Ot.canonical);for(;Ei+Pi<=ji;){if(wi+=fi,wi<Q||wi>=oe)return null;if(di=vi,vr=ar,Wi.push(di),vt&&or.push(vr),ar=new n.P(de.getx(wi),de.gety(wi)),vi=yt[wi],!vi){const Ur=Oo(ar,Ot.canonical,pe,At,pt);vi=Ur[3]>0?yt[wi]=Ur:Ji()}Ei+=Pi;const Wr=n.at([],vi,di),qr=n.bD(di,vi);if(f&&qr>0&&Pi>0&&n.bG(Ui,Wr)/(Pi*qr)<qt)return null;Pi=qr,Ui=Wr}Dt&&pt&&(yt[wi]&&(vi=Ji(),Pi=n.bD(di,vi),Ui=n.at([],vi,di)),yt[wi]=vi);const zi=(ji-Ei)/Pi,ur=ar.sub(vr)._mult(zi)._add(vr),Zi=n.bE([],di,Ui,zi);let gr=[0,0,1],kr=Ui[0],cr=Ui[1];if(Bt&&(gr=At.upVector(Ot.canonical,ur.x,ur.y),gr[0]!==0||gr[1]!==0||gr[2]!==1)){const Wr=[gr[2],0,-gr[0]],qr=n.bF([],gr,Wr);n.au(Wr,Wr),n.au(qr,qr),kr=n.bG(Ui,Wr),cr=n.bG(Ui,qr)}if(f){const Wr=n.bF([],gr,Ui);n.au(Wr,Wr),n.bE(Zi,Zi,Wr,f*fi)}const Pr=Ti+Math.atan2(cr,kr);return Wi.push(Zi),vt&&or.push(ur),{point:Zi,angle:Pr,path:Wi,tilePath:or,up:gr}}function pl(b,a){const f=a.length,w=f+4*b;a.resize(w),a.float32.fill(-1/0,4*f,4*w)}function rs(b,a,f){const w=a[0],P=a[1];return b[0]=f[0]*w+f[4]*P+f[12],b[1]=f[1]*w+f[5]*P+f[13],b[3]=f[3]*w+f[7]*P+f[15],b}const sa=100;class Im{constructor(a,f,w=new Zh(a.width+200,a.height+200,25),P=new Zh(a.width+200,a.height+200,25)){this.transform=a,this.grid=w,this.ignoredGrid=P,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+sa,this.screenBottomBoundary=a.height+sa,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,w,P,R,H,Q,oe){let de=w.projectedAnchorX,pe=w.projectedAnchorY,yt=w.projectedAnchorZ;const pt=w.elevation,vt=w.tileID,Dt=a.getProjection();if(pt&&vt){const[wi,vi,di]=Dt.upVector(vt.canonical,w.tileAnchorX,w.tileAnchorY),Ei=Dt.upVectorScale(vt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;de+=wi*pt*Ei,pe+=vi*pt*Ei,yt+=di*pt*Ei}const At=this.projectAndGetPerspectiveRatio(Q,de,pe,yt,w.tileID,Dt.name==="globe"||!!pt||this.transform.pitch>0,Dt),Ot=H*At.perspectiveRatio,Bt=(w.x1*f+P.x-w.padding)*Ot+At.point.x,qt=(w.y1*f+P.y-w.padding)*Ot+At.point.y,li=(w.x2*f+P.x+w.padding)*Ot+At.point.x,fi=(w.y2*f+P.y+w.padding)*Ot+At.point.y,Ti=At.perspectiveRatio<=.55||At.occluded;return!this.isInsideGrid(Bt,qt,li,fi)||!R&&this.grid.hitTest(Bt,qt,li,fi,oe)||Ti?{box:[],offscreen:!1,occluded:At.occluded}:{box:[Bt,qt,li,fi],offscreen:this.isOffscreen(Bt,qt,li,fi),occluded:!1}}placeCollisionCircles(a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At){const Ot=[],Bt=this.transform.elevation,qt=a.getProjection(),li=Bt?Bt.getAtTileOffsetFunc(At,this.transform.center.lat,this.transform.worldSize,qt):null,fi=new n.P(w.tileAnchorX,w.tileAnchorY);let{x:Ti,y:wi,z:vi}=qt.projectTilePoint(fi.x,fi.y,At.canonical);if(li){const[gr,kr,cr]=li(fi);Ti+=gr,wi+=kr,vi+=cr}const di=qt.name==="globe",Ei=this.projectAndGetPerspectiveRatio(Q,Ti,wi,vi,At,di||!!Bt||this.transform.pitch>0,qt),{perspectiveRatio:Pi}=Ei,ji=(yt?H/Pi:H*Pi)/n.bO,Wi=na(Ti,wi,vi,oe),or=w.lineOffsetX*ji,ar=w.lineOffsetY*ji,vr=n.al(a.layers[0].layout.get("text-max-angle")),Ui=Math.cos(vr),Ji=Ei.signedDistanceFromCamera>0?Yh(ji,R,or,ar,!1,Wi,fi,w,P,oe,{},Bt&&!yt?li:null,yt&&!!Bt,qt,At,yt,Ui):null;let zi=!1,ur=!1,Zi=!0;if(Ji&&!Ei.occluded){const gr=.5*vt*Pi+Dt,kr=new n.P(-100,-100),cr=new n.P(this.screenRightBoundary,this.screenBottomBoundary),Pr=new Xh,{first:Wr,last:qr}=Ji,Ur=Wr.path.length;let Qr=[];for(let gn=Ur-1;gn>=1;gn--)Qr.push(Wr.path[gn]);for(let gn=1;gn<qr.path.length;gn++)Qr.push(qr.path[gn]);const nn=2.5*gr;de&&(Qr=Qr.map(([gn,En,ss],ws)=>(li&&!di&&(ss=li(ws<Ur-1?Wr.tilePath[Ur-1-ws]:qr.tilePath[ws-Ur+2])[2]),na(gn,En,ss,de))),Qr.some(gn=>gn[3]<=0)&&(Qr=[]));let ln=[];if(Qr.length>0){let gn=1/0,En=-1/0,ss=1/0,ws=-1/0;for(const cs of Qr)gn=Math.min(gn,cs[0]),ss=Math.min(ss,cs[1]),En=Math.max(En,cs[0]),ws=Math.max(ws,cs[1]);En>=kr.x&&gn<=cr.x&&ws>=kr.y&&ss<=cr.y&&(ln=[Qr.map(cs=>new n.P(cs[0],cs[1]))],(gn<kr.x||En>cr.x||ss<kr.y||ws>cr.y)&&(ln=n.bM(ln,kr.x,kr.y,cr.x,cr.y)))}for(const gn of ln){Pr.reset(gn,.25*gr);let En=0;En=Pr.length<=.5*gr?1:Math.ceil(Pr.paddedLength/nn)+1;for(let ss=0;ss<En;ss++){const ws=ss/Math.max(En-1,1),cs=Pr.lerp(ws),fs=cs.x+sa,qs=cs.y+sa;Ot.push(fs,qs,gr,0);const xn=fs-gr,Cn=qs-gr,Fn=fs+gr,Cs=qs+gr;if(Zi=Zi&&this.isOffscreen(xn,Cn,Fn,Cs),ur=ur||this.isInsideGrid(xn,Cn,Fn,Cs),!f&&this.grid.hitTestCircle(fs,qs,gr,pt)&&(zi=!0,!pe))return{circles:[],offscreen:!1,collisionDetected:zi,occluded:!1}}}}return{circles:!pe&&zi||!ur?[]:Ot,offscreen:Zi,collisionDetected:zi,occluded:Ei.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let w=1/0,P=1/0,R=-1/0,H=-1/0;for(const pe of a){const yt=new n.P(pe.x+sa,pe.y+sa);w=Math.min(w,yt.x),P=Math.min(P,yt.y),R=Math.max(R,yt.x),H=Math.max(H,yt.y),f.push(yt)}const Q=this.grid.query(w,P,R,H).concat(this.ignoredGrid.query(w,P,R,H)),oe={},de={};for(const pe of Q){const yt=pe.key;if(oe[yt.bucketInstanceId]===void 0&&(oe[yt.bucketInstanceId]={}),oe[yt.bucketInstanceId][yt.featureIndex])continue;const pt=[new n.P(pe.x1,pe.y1),new n.P(pe.x2,pe.y1),new n.P(pe.x2,pe.y2),new n.P(pe.x1,pe.y2)];n.bN(f,pt)&&(oe[yt.bucketInstanceId][yt.featureIndex]=!0,de[yt.bucketInstanceId]===void 0&&(de[yt.bucketInstanceId]=[]),de[yt.bucketInstanceId].push(yt.featureIndex))}return de}insertCollisionBox(a,f,w,P,R){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:P,collisionGroupID:R},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,w,P,R){const H=f?this.ignoredGrid:this.grid,Q={bucketInstanceId:w,featureIndex:P,collisionGroupID:R};for(let oe=0;oe<a.length;oe+=4)H.insertCircle(Q,a[oe],a[oe+1],a[oe+2])}projectAndGetPerspectiveRatio(a,f,w,P,R,H,Q){const oe=[f,w,P,1];let de=!1;P||this.transform.pitch>0?(n.aA(oe,oe,a),this.fogState&&R&&Q.name!=="globe"&&(de=function(pt,vt,Dt,At,Ot,Bt){const qt=Bt.calculateFogTileMatrix(Ot),li=[vt,Dt,At];return n.ad(li,li,qt),dr(pt,n.ae(li),Bt.pitch,Bt._fov)}(this.fogState,f,w,P,R.toUnwrapped(),this.transform)>.9)):rs(oe,oe,a);const pe=oe[3];return{point:new n.P((oe[0]/pe+1)/2*this.transform.width+sa,(-oe[1]/pe+1)/2*this.transform.height+sa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(Q)/pe*.5,1.5),signedDistanceFromCamera:pe,occluded:H&&oe[2]>pe||de}}isOffscreen(a,f,w,P){return w<sa||a>=this.screenRightBoundary||P<sa||f>this.screenBottomBoundary}isInsideGrid(a,f,w,P){return w>=0&&a<this.gridRightBoundary&&P>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=n.bx([]);return n.bo(a,a,[-100,-100,0]),a}}function Jh(b,a,f){const w=a.createTileMatrix(b,b.worldSize,f.toUnwrapped());return n.az(new Float32Array(16),b.projMatrix,w)}function pn(b,a,f){if(a.projection.name===f.projection.name)return b.projMatrix;const w=f.clone();return w.setProjection(a.projection),Jh(w,a.getProjection(),b)}function zu(b,a,f){return a.name===f.projection.name?b.projMatrix:Jh(f,a,b)}class Dc{constructor(a,f,w,P){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):P&&w?1:0,this.placed=w}isHidden(){return this.opacity===0&&!this.placed}}class ml{constructor(a,f,w,P,R,H=!1){this.text=new Dc(a?a.text:null,f,w,R),this.icon=new Dc(a?a.icon:null,f,P,R),this.clipped=H}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Go{constructor(a,f,w,P=!1){this.text=a,this.icon=f,this.skipFade=w,this.clipped=P}}class Qh{constructor(){this.invProjMatrix=n.bz(),this.viewportMatrix=n.bz(),this.circles=[]}}class zl{constructor(a,f,w,P,R){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=w,this.bucketIndex=P,this.tileID=R}}class tn{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:w=>w.collisionGroupID===f}}return this.collisionGroups[a]}}function hs(b,a,f,w,P){const{horizontalAlign:R,verticalAlign:H}=n.bT(b),Q=-(R-.5)*a,oe=-(H-.5)*f,de=n.bU(b,w);return new n.P(Q+de[0]*P,oe+de[1]*P)}function Jn(b,a,f,w,P){const R=new n.P(b,a);return f&&R._rotate(w?P:-P),R}class zo{constructor(a,f,w,P,R,H){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Im(this.transform,R),this.buildingIndex=H,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new tn(w),this.collisionCircleArrays={},this.prevPlacement=P,P&&(P.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,w,P,R=1){const H=w.getBucket(f),Q=w.latestFeatureIndex;if(!H||!Q||f.fqid!==H.layerIds[0])return;const oe=H.layers[0].layout,de=H.layers[0].paint,pe=w.collisionBoxArray,yt=Math.pow(2,this.transform.zoom-w.tileID.overscaledZ),pt=w.tileSize/n.aj,vt=w.tileID.toUnwrapped();this.transform.setProjection(H.projection);const Dt=(At=w.tileID,Ot=H.getProjection(),Bt=this.transform,Ot.name===this.projection?Bt.calculateProjMatrix(At.toUnwrapped()):Jh(Bt,Ot,At));var At,Ot,Bt;const qt=oe.get("text-pitch-alignment")==="map",li=oe.get("text-rotation-alignment")==="map";f.compileFilter(f.options);const fi=f.dynamicFilter(),Ti=f.dynamicFilterNeedsFeature(),wi=this.transform.calculatePixelsToTileUnitsMatrix(w),vi=ku(Dt,w.tileID.canonical,qt,li,this.transform,H.getProjection(),wi);let di=null;if(qt){const Ji=Du(Dt,w.tileID.canonical,qt,li,this.transform,H.getProjection(),wi);di=n.az([],this.transform.labelPlaneMatrix,Ji)}let Ei=null;fi&&w.latestFeatureIndex&&(Ei={unwrappedTileID:vt,dynamicFilter:fi,dynamicFilterNeedsFeature:Ti}),this.retainedQueryData[H.bucketInstanceId]=new zl(H.bucketInstanceId,Q,H.sourceLayerIndex,H.index,w.tileID);const[Pi,ji]=H.layers[0].layout.get("text-size-scale-range"),Wi=n.ay(R,Pi,ji),[or,ar]=oe.get("icon-size-scale-range"),vr=n.ay(R,or,ar),Ui={bucket:H,layout:oe,paint:de,posMatrix:Dt,textLabelPlaneMatrix:vi,labelToScreenMatrix:di,clippingData:Ei,scale:yt,textPixelRatio:pt,holdingForFade:w.holdingForFade(),collisionBoxArray:pe,partiallyEvaluatedTextSize:n.bH(H.textSizeData,this.transform.zoom,Wi),partiallyEvaluatedIconSize:n.bH(H.iconSizeData,this.transform.zoom,vr),collisionGroup:this.collisionGroups.get(H.sourceID),latestFeatureIndex:w.latestFeatureIndex};if(P)for(const Ji of H.sortKeyRanges){const{sortKey:zi,symbolInstanceStart:ur,symbolInstanceEnd:Zi}=Ji;a.push({sortKey:zi,symbolInstanceStart:ur,symbolInstanceEnd:Zi,parameters:Ui})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:H.symbolInstances.length,parameters:Ui})}attemptAnchorPlacement(a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt){const{textOffset0:li,textOffset1:fi,crossTileID:Ti}=pt,wi=[li,fi],vi=hs(a,w,P,wi,R),di=this.collisionIndex.placeCollisionBox(Dt,R,f,Jn(vi.x,vi.y,H,Q,this.transform.angle),yt,oe,de,pe.predicate);if(Ot){const Ei=Dt.getSymbolInstanceIconSize(qt,this.transform.zoom,pt.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Dt,Ei,Ot,Jn(vi.x,vi.y,H,Q,this.transform.angle),yt,oe,de,pe.predicate).box.length===0)return}if(di.box.length>0){let Ei;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ti]&&this.prevPlacement.placements[Ti]&&this.prevPlacement.placements[Ti].text&&(Ei=this.prevPlacement.variableOffsets[Ti].anchor),this.variableOffsets[Ti]={textOffset:wi,width:w,height:P,anchor:a,textScale:R,prevAnchor:Ei},this.markUsedJustification(Dt,a,pt,At),Dt.allowVerticalPlacement&&(this.markUsedOrientation(Dt,At,pt),this.placedOrientations[Ti]=At),{shift:vi,placedGlyphBoxes:di}}}placeLayerBucketPart(a,f,w,P,R=1){const{bucket:H,layout:Q,paint:oe,posMatrix:de,textLabelPlaneMatrix:pe,labelToScreenMatrix:yt,clippingData:pt,textPixelRatio:vt,holdingForFade:Dt,collisionBoxArray:At,partiallyEvaluatedTextSize:Ot,partiallyEvaluatedIconSize:Bt,collisionGroup:qt,latestFeatureIndex:li}=a.parameters,fi=Q.get("text-optional"),Ti=Q.get("icon-optional"),wi=Q.get("text-allow-overlap"),vi=Q.get("icon-allow-overlap"),di=Q.get("text-rotation-alignment")==="map",Ei=Q.get("text-pitch-alignment")==="map",Pi=oe.get("symbol-z-offset"),ji=Q.get("symbol-elevation-reference")==="sea",[Wi,or]=Q.get("text-size-scale-range"),[ar,vr]=Q.get("icon-size-scale-range"),Ui=n.ay(R,Wi,or),Ji=n.ay(R,ar,vr);this.transform.setProjection(H.projection);let zi=wi&&(vi||!H.hasIconData()||Ti),ur=vi&&(wi||!H.hasTextData()||fi);const Zi=!Pi.isConstant();!H.collisionArrays&&At&&H.deserializeCollisionBoxes(At),w&&P&&H.updateCollisionDebugBuffers(this.transform.zoom,At,Ui,Ji);const gr=(cr,Pr,Wr)=>{const{crossTileID:qr,numVerticalGlyphVertices:Ur}=cr;let Qr=null;if(pt&&pt.dynamicFilterNeedsFeature||Zi){const _s=this.retainedQueryData[H.bucketInstanceId];Qr=li.loadFeature({featureIndex:cr.featureIndex,bucketIndex:_s.bucketIndex,sourceLayerIndex:_s.sourceLayerIndex,layoutVertexArrayOffset:0})}if(pt&&!(0,pt.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Qr,this.retainedQueryData[H.bucketInstanceId].tileID.canonical,new n.P(cr.tileAnchorX,cr.tileAnchorY),this.transform.calculateDistanceTileData(pt.unwrappedTileID)))return this.placements[qr]=new Go(!1,!1,!1,!0),void f.add(qr);const nn=Pi.evaluate(Qr,{});if(f.has(qr))return;if(Dt)return void(this.placements[qr]=new Go(!1,!1,!1));let ln=!1,gn=!1,En=!0,ss=!1,ws=!1,cs=null,fs={box:null,offscreen:null,occluded:null},qs={box:null},xn=null,Cn=null,Fn=null,Cs=0,io=0,Ss=0;Wr.textFeatureIndex?Cs=Wr.textFeatureIndex:cr.useRuntimeCollisionCircles&&(Cs=cr.featureIndex),Wr.verticalTextFeatureIndex&&(io=Wr.verticalTextFeatureIndex);const Kn=_s=>{_s.tileID=this.retainedQueryData[H.bucketInstanceId].tileID;const Is=this.transform.elevation;_s.elevation=ji?nn:nn+(Is?Is.getAtTileOffset(_s.tileID,_s.tileAnchorX,_s.tileAnchorY):0),_s.elevation+=cr.zOffset},Gs=Wr.textBox;if(Gs){Kn(Gs);const _s=Qn=>{let js=n.bI.horizontal;if(H.allowVerticalPlacement&&!Qn&&this.prevPlacement){const _o=this.prevPlacement.placedOrientations[qr];_o&&(this.placedOrientations[qr]=_o,js=_o,this.markUsedOrientation(H,js,cr))}return js},Is=(Qn,js)=>{if(H.allowVerticalPlacement&&Ur>0&&Wr.verticalTextBox){for(const _o of H.writingModes)if(_o===n.bI.vertical?(fs=js(),qs=fs):fs=Qn(),fs&&fs.box&&fs.box.length)break}else fs=Qn()};if(Q.get("text-variable-anchor")){let Qn=Q.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qr]){const Ds=this.prevPlacement.variableOffsets[qr];Qn.indexOf(Ds.anchor)>0&&(Qn=Qn.filter(Yn=>Yn!==Ds.anchor),Qn.unshift(Ds.anchor))}const js=(Ds,Yn,No)=>{const Do=H.getSymbolInstanceTextSize(Ot,cr,this.transform.zoom,Pr),Wo=(Ds.x2-Ds.x1)*Do+2*Ds.padding,la=(Ds.y2-Ds.y1)*Do+2*Ds.padding,ea=cr.hasIconTextFit&&!vi?Yn:null;ea&&Kn(ea);let Fo={box:[],offscreen:!1,occluded:!1};const el=wi?2*Qn.length:Qn.length;for(let ca=0;ca<el;++ca){const tl=this.attemptAnchorPlacement(Qn[ca%Qn.length],Ds,Wo,la,Do,di,Ei,vt,de,qt,ca>=Qn.length,cr,Pr,H,No,ea,Ot,Bt);if(tl&&(Fo=tl.placedGlyphBoxes,Fo&&Fo.box&&Fo.box.length)){ln=!0,cs=tl.shift;break}}return Fo};Is(()=>js(Gs,Wr.iconBox,n.bI.horizontal),()=>{const Ds=Wr.verticalTextBox;return Ds&&Kn(Ds),H.allowVerticalPlacement&&!(fs&&fs.box&&fs.box.length)&&Ur>0&&Ds?js(Ds,Wr.verticalIconBox,n.bI.vertical):{box:null,offscreen:null,occluded:null}}),fs&&(ln=fs.box,En=fs.offscreen,ss=fs.occluded);const _o=_s(!(!fs||!fs.box));if(!ln&&this.prevPlacement){const Ds=this.prevPlacement.variableOffsets[qr];Ds&&(this.variableOffsets[qr]=Ds,this.markUsedJustification(H,Ds.anchor,cr,_o))}}else{const Qn=(js,_o)=>{const Ds=H.getSymbolInstanceTextSize(Ot,cr,this.transform.zoom,Pr,R),Yn=this.collisionIndex.placeCollisionBox(H,Ds,js,new n.P(0,0),wi,vt,de,qt.predicate);return Yn&&Yn.box&&Yn.box.length&&(this.markUsedOrientation(H,_o,cr),this.placedOrientations[qr]=_o),Yn};Is(()=>Qn(Gs,n.bI.horizontal),()=>{const js=Wr.verticalTextBox;return H.allowVerticalPlacement&&Ur>0&&js?(Kn(js),Qn(js,n.bI.vertical)):{box:null,offscreen:null,occluded:null}}),_s(!!(fs&&fs.box&&fs.box.length))}}if(xn=fs,ln=xn&&xn.box&&xn.box.length>0,En=xn&&xn.offscreen,ss=xn&&xn.occluded,cr.useRuntimeCollisionCircles){const _s=H.text.placedSymbolArray.get(cr.centerJustifiedTextSymbolIndex>=0?cr.centerJustifiedTextSymbolIndex:cr.verticalPlacedTextSymbolIndex),Is=n.bJ(H.textSizeData,Ot,_s),Qn=Q.get("text-padding");Cn=this.collisionIndex.placeCollisionCircles(H,wi,_s,H.lineVertexArray,H.glyphOffsetArray,Is,de,pe,yt,w,Ei,qt.predicate,cr.collisionCircleDiameter*Is/n.bO,Qn,this.retainedQueryData[H.bucketInstanceId].tileID),ln=wi||Cn.circles.length>0&&!Cn.collisionDetected,En=En&&Cn.offscreen,ss=Cn.occluded}if(Wr.iconFeatureIndex&&(Ss=Wr.iconFeatureIndex),Wr.iconBox){const _s=Is=>{Kn(Is);const Qn=cr.hasIconTextFit&&cs?Jn(cs.x,cs.y,di,Ei,this.transform.angle):new n.P(0,0),js=H.getSymbolInstanceIconSize(Bt,this.transform.zoom,cr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(H,js,Is,Qn,vi,vt,de,qt.predicate)};qs&&qs.box&&qs.box.length&&Wr.verticalIconBox?(Fn=_s(Wr.verticalIconBox),gn=Fn.box.length>0):(Fn=_s(Wr.iconBox),gn=Fn.box.length>0),En=En&&Fn.offscreen,ws=Fn.occluded}const jn=fi||cr.numHorizontalGlyphVertices===0&&Ur===0,Ys=Ti||cr.numIconVertices===0;if(jn||Ys?Ys?jn||(gn=gn&&ln):ln=gn&&ln:gn=ln=gn&&ln,ln&&xn&&xn.box&&this.collisionIndex.insertCollisionBox(xn.box,Q.get("text-ignore-placement"),H.bucketInstanceId,qs&&qs.box&&io?io:Cs,qt.ID),gn&&Fn&&this.collisionIndex.insertCollisionBox(Fn.box,Q.get("icon-ignore-placement"),H.bucketInstanceId,Ss,qt.ID),Cn&&(ln&&this.collisionIndex.insertCollisionCircles(Cn.circles,Q.get("text-ignore-placement"),H.bucketInstanceId,Cs,qt.ID),w)){const _s=H.bucketInstanceId;let Is=this.collisionCircleArrays[_s];Is===void 0&&(Is=this.collisionCircleArrays[_s]=new Qh);for(let Qn=0;Qn<Cn.circles.length;Qn+=4)Is.circles.push(Cn.circles[Qn+0]),Is.circles.push(Cn.circles[Qn+1]),Is.circles.push(Cn.circles[Qn+2]),Is.circles.push(Cn.collisionDetected?1:0)}const Ps=H.projection.name!=="globe";zi=zi&&(Ps||!ss),ur=ur&&(Ps||!ws),this.placements[qr]=new Go(ln||zi,gn||ur,En||H.justReloaded),f.add(qr)},kr=this.retainedQueryData[H.bucketInstanceId].tileID;if(H.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(H,kr),H.elevationType==="road"&&H.updateRoadElevation(kr.canonical),H.updateZOffset(),H.sortFeaturesByY){const cr=H.getSortedSymbolIndexes(this.transform.angle);for(let Pr=cr.length-1;Pr>=0;--Pr){const Wr=cr[Pr];gr(H.symbolInstances.get(Wr),Wr,H.collisionArrays[Wr])}H.hasAnyZOffset&&n.w(`${H.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(H.hasAnyZOffset){const cr=H.getSortedIndexesByZOffset();for(let Pr=0;Pr<cr.length;++Pr){const Wr=cr[Pr];gr(H.symbolInstances.get(Wr),Wr,H.collisionArrays[Wr])}}else for(let cr=a.symbolInstanceStart;cr<a.symbolInstanceEnd;cr++)gr(H.symbolInstances.get(cr),cr,H.collisionArrays[cr]);if(w&&H.bucketInstanceId in this.collisionCircleArrays){const cr=this.collisionCircleArrays[H.bucketInstanceId];n.bi(cr.invProjMatrix,de),cr.viewportMatrix=this.collisionIndex.getViewportMatrix()}H.justReloaded=!1}markUsedJustification(a,f,w,P){const{leftJustifiedTextSymbolIndex:R,centerJustifiedTextSymbolIndex:H,rightJustifiedTextSymbolIndex:Q,verticalPlacedTextSymbolIndex:oe,crossTileID:de}=w,pe=n.bV(f),yt=P===n.bI.vertical?oe:pe==="left"?R:pe==="center"?H:pe==="right"?Q:-1;R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=yt>=0&&R!==yt?0:de),H>=0&&(a.text.placedSymbolArray.get(H).crossTileID=yt>=0&&H!==yt?0:de),Q>=0&&(a.text.placedSymbolArray.get(Q).crossTileID=yt>=0&&Q!==yt?0:de),oe>=0&&(a.text.placedSymbolArray.get(oe).crossTileID=yt>=0&&oe!==yt?0:de)}markUsedOrientation(a,f,w){const P=f===n.bI.horizontal||f===n.bI.horizontalOnly?f:0,R=f===n.bI.vertical?f:0,{leftJustifiedTextSymbolIndex:H,centerJustifiedTextSymbolIndex:Q,rightJustifiedTextSymbolIndex:oe,verticalPlacedTextSymbolIndex:de}=w,pe=a.text.placedSymbolArray;H>=0&&(pe.get(H).placedOrientation=P),Q>=0&&(pe.get(Q).placedOrientation=P),oe>=0&&(pe.get(oe).placedOrientation=P),de>=0&&(pe.get(de).placedOrientation=R)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let w=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const P=f?f.symbolFadeChange(a):1,R=f?f.opacities:{},H=f?f.variableOffsets:{},Q=f?f.placedOrientations:{};for(const oe in this.placements){const de=this.placements[oe],pe=R[oe];pe?(this.opacities[oe]=new ml(pe,P,de.text,de.icon,null,de.clipped),w=w||de.text!==pe.text.placed||de.icon!==pe.icon.placed):(this.opacities[oe]=new ml(null,P,de.text,de.icon,de.skipFade,de.clipped),w=w||de.text||de.icon)}for(const oe in R){const de=R[oe];if(!this.opacities[oe]){const pe=new ml(de,P,!1,!1);pe.isHidden()||(this.opacities[oe]=pe,w=w||de.text.placed||de.icon.placed)}}for(const oe in H)this.variableOffsets[oe]||!this.opacities[oe]||this.opacities[oe].isHidden()||(this.variableOffsets[oe]=H[oe]);for(const oe in Q)this.placedOrientations[oe]||!this.opacities[oe]||this.opacities[oe].isHidden()||(this.placedOrientations[oe]=Q[oe]);w?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f,w,P){const R=new Set;for(const H of f){const Q=H.getBucket(a);Q&&H.latestFeatureIndex&&a.fqid===Q.layerIds[0]&&(this.updateBucketOpacities(Q,R,H,H.collisionBoxArray,w,P,H.tileID,a.scope),Q.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(Q,H.tileID),Q.elevationType==="road"&&Q.updateRoadElevation(H.tileID.canonical),Q.updateZOffset())}}updateBucketOpacities(a,f,w,P,R,H,Q,oe){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const de=a.layers[0].layout,pe=a.layers[0].paint,yt=!!a.layers[0].dynamicFilter(),pt=new ml(null,0,!1,!1,!0),vt=de.get("text-allow-overlap"),Dt=de.get("icon-allow-overlap"),At=de.get("text-variable-anchor"),Ot=de.get("text-rotation-alignment")==="map",Bt=de.get("text-pitch-alignment")==="map",qt=pe.get("symbol-z-offset"),li=de.get("symbol-elevation-reference")==="sea",fi=!qt.isConstant(),Ti=new ml(null,0,vt&&(Dt||!a.hasIconData()||de.get("icon-optional")),Dt&&(vt||!a.hasTextData()||de.get("text-optional")),!0);!a.collisionArrays&&P&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(P);const wi=(di,Ei,Pi)=>{for(let ji=0;ji<Ei/4;ji++)di.opacityVertexArray.emplaceBack(Pi)};let vi=0;H&&a.updateReplacement(Q,H);for(let di=0;di<a.symbolInstances.length;di++){const Ei=a.symbolInstances.get(di),{numHorizontalGlyphVertices:Pi,numVerticalGlyphVertices:ji,crossTileID:Wi,numIconVertices:or,tileAnchorX:ar,tileAnchorY:vr}=Ei;let Ui=null;const Ji=this.retainedQueryData[a.bucketInstanceId];fi&&Ei&&Ji&&(Ui=w.latestFeatureIndex.loadFeature({featureIndex:Ei.featureIndex,bucketIndex:Ji.bucketIndex,sourceLayerIndex:Ji.sourceLayerIndex,layoutVertexArrayOffset:0}));const zi=qt.evaluate(Ui,{}),ur=f.has(Wi);let Zi=this.opacities[Wi];ur?Zi=pt:Zi||(Zi=Ti,this.opacities[Wi]=Zi),f.add(Wi);const gr=Pi>0||ji>0,kr=or>0,cr=this.placedOrientations[Wi],Pr=cr===n.bI.vertical,Wr=cr===n.bI.horizontal||cr===n.bI.horizontalOnly;!gr&&!kr||Zi.isHidden()||vi++;let qr=!1;if((gr||kr)&&H)for(const Ur of a.activeReplacements){if(n.bP(Ur,R,n.bQ.Symbol,oe)||Ur.min.x>ar||ar>Ur.max.x||Ur.min.y>vr||vr>Ur.max.y)continue;const Qr=n.bR(ar,vr,Q.canonical,Ur.footprintTileId.canonical);if(qr=n.bS(Qr,Ur.footprint),qr)break}if(gr){const Ur=qr?Na:Bl(Zi.text);wi(a.text,Pi,Pr?Na:Ur),wi(a.text,ji,Wr?Na:Ur);const Qr=Zi.text.isHidden(),{leftJustifiedTextSymbolIndex:nn,centerJustifiedTextSymbolIndex:ln,rightJustifiedTextSymbolIndex:gn,verticalPlacedTextSymbolIndex:En}=Ei,ss=a.text.placedSymbolArray,ws=Qr||Pr?1:0;nn>=0&&(ss.get(nn).hidden=ws),ln>=0&&(ss.get(ln).hidden=ws),gn>=0&&(ss.get(gn).hidden=ws),En>=0&&(ss.get(En).hidden=Qr||Wr?1:0);const cs=this.variableOffsets[Wi];cs&&this.markUsedJustification(a,cs.anchor,Ei,cr);const fs=this.placedOrientations[Wi];fs&&(this.markUsedJustification(a,"left",Ei,fs),this.markUsedOrientation(a,fs,Ei))}if(kr){const Ur=qr?Na:Bl(Zi.icon),{placedIconSymbolIndex:Qr,verticalPlacedIconSymbolIndex:nn}=Ei,ln=a.icon.placedSymbolArray,gn=Zi.icon.isHidden()?1:0;Qr>=0&&(wi(a.icon,or,Pr?Na:Ur),ln.get(Qr).hidden=gn),nn>=0&&(wi(a.icon,Ei.numVerticalIconVertices,Wr?Na:Ur),ln.get(nn).hidden=gn)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Ur=a.collisionArrays[di];if(Ur){let Qr=new n.P(0,0),nn=!0;if(Ur.textBox||Ur.verticalTextBox){if(At){const gn=this.variableOffsets[Wi];gn?(Qr=hs(gn.anchor,gn.width,gn.height,gn.textOffset,gn.textScale),Ot&&Qr._rotate(Bt?this.transform.angle:-this.transform.angle)):nn=!1}yt&&(nn=!Zi.clipped),Ur.textBox&&wa(a.textCollisionBox.collisionVertexArray,Zi.text.placed,!nn||Pr,zi,li,Qr.x,Qr.y),Ur.verticalTextBox&&wa(a.textCollisionBox.collisionVertexArray,Zi.text.placed,!nn||Wr,zi,li,Qr.x,Qr.y)}const ln=nn&&!!(!Wr&&Ur.verticalIconBox);Ur.iconBox&&wa(a.iconCollisionBox.collisionVertexArray,Zi.icon.placed,ln,zi,li,Ei.hasIconTextFit?Qr.x:0,Ei.hasIconTextFit?Qr.y:0),Ur.verticalIconBox&&wa(a.iconCollisionBox.collisionVertexArray,Zi.icon.placed,!ln,zi,li,Ei.hasIconTextFit?Qr.x:0,Ei.hasIconTextFit?Qr.y:0)}}}if(a.fullyClipped=vi===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const di=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=di.invProjMatrix,a.placementViewportMatrix=di.viewportMatrix,a.collisionCircleArray=di.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const w=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*w>a}setStale(){this.stale=!0}}function wa(b,a,f,w,P,R,H){b.emplaceBack(a?1:0,f?1:0,R||0,H||0,w,P?1:0),b.emplaceBack(a?1:0,f?1:0,R||0,H||0,w,P?1:0),b.emplaceBack(a?1:0,f?1:0,R||0,H||0,w,P?1:0),b.emplaceBack(a?1:0,f?1:0,R||0,H||0,w,P?1:0)}const ns=Math.pow(2,25),Bu=Math.pow(2,24),Fc=Math.pow(2,17),Oc=Math.pow(2,16),Mo=Math.pow(2,9),no=Math.pow(2,8),Rm=Math.pow(2,1);function Bl(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const a=b.placed?1:0,f=Math.floor(127*b.opacity);return f*ns+a*Bu+f*Fc+a*Oc+f*Mo+a*no+f*Rm+a}const Na=0;class zc{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,w,P,R,H){const Q=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(Q,P,a[this._currentTileIndex],this._sortAcrossTiles,H),this._currentTileIndex++,R())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Q.sort((oe,de)=>oe.sortKey-de.sortKey));this._currentPartIndex<Q.length;){const oe=Q[this._currentPartIndex];if(f.placeLayerBucketPart(oe,this._seenCrossTileIDs,w,oe.symbolInstanceStart===0,H),this._currentPartIndex++,R())return!0}return!1}}class Nu{constructor(a,f,w,P,R,H,Q,oe,de){this.placement=new zo(a,R,H,Q,oe,de),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=P,this._done=!1}isDone(){return this._done}continuePlacement(a,f,w,P,R){const H=n.q.now(),Q=()=>{const oe=n.q.now()-H;return!this._forceFullPlacement&&oe>2};for(;this._currentPlacementIndex>=0;){const oe=f[a[this._currentPlacementIndex]],de=this.placement.collisionIndex.transform.zoom;if(oe.type==="symbol"&&(!oe.minzoom||oe.minzoom<=de)&&(!oe.maxzoom||oe.maxzoom>de)){const pe=oe,yt=pe.layout.get("symbol-z-elevate"),pt=pe.layout.get("symbol-sort-key").constantOr(1)!==void 0,vt=pe.layout.get("symbol-z-order"),Dt=vt==="viewport-y"||vt==="auto"&&!(vt!=="viewport-y"&&pt),At=pe.layout.get("text-allow-overlap")||pe.layout.get("icon-allow-overlap")||pe.layout.get("text-ignore-placement")||pe.layout.get("icon-ignore-placement"),Ot=Dt&&At,Bt=this._inProgressLayer=this._inProgressLayer||new zc(pe),qt=n.C(oe.source,oe.scope);if(Bt.continuePlacement(yt||Ot?P[qt]:w[qt],this.placement,this._showCollisionBoxes,oe,Q,R))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Bc=512/n.aj/2;class Vu{constructor(a,f,w){this.tileID=a,this.bucketInstanceId=w,this.index=new n.bW(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const P=a.canonical.x*n.aj,R=a.canonical.y*n.aj;for(let H=0;H<f.length;H++){const{key:Q,crossTileID:oe,tileAnchorX:de,tileAnchorY:pe}=f.get(H),yt=Math.floor((P+de)*Bc),pt=Math.floor((R+pe)*Bc);this.index.add(yt,pt),this.keys.push(Q),this.crossTileIDs.push(oe)}this.index.finish()}findMatches(a,f,w){const P=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),R=Bc/Math.pow(2,f.canonical.z-this.tileID.canonical.z),H=f.canonical.x*n.aj,Q=f.canonical.y*n.aj;for(let oe=0;oe<a.length;oe++){const de=a.get(oe);if(de.crossTileID)continue;const{key:pe,tileAnchorX:yt,tileAnchorY:pt}=de,vt=Math.floor((H+yt)*R),Dt=Math.floor((Q+pt)*R),At=this.index.range(vt-P,Dt-P,vt+P,Dt+P).sort((Ot,Bt)=>Ot-Bt);for(const Ot of At){const Bt=this.crossTileIDs[Ot];if(this.keys[Ot]===pe&&!w.has(Bt)){w.add(Bt),de.crossTileID=Bt;break}}}}}class Ao{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const w in this.indexes){const P=this.indexes[w],R={};for(const H in P){const Q=P[H];Q.tileID=Q.tileID.unwrapTo(Q.tileID.wrap+f),R[Q.tileID.key]=Q}this.indexes[w]=R}this.lng=a}addBucket(a,f,w){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let R=0;R<f.symbolInstances.length;R++)f.symbolInstances.get(R).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const P=this.usedCrossTileIDs[a.overscaledZ];for(const R in this.indexes){const H=this.indexes[R];if(Number(R)>a.overscaledZ)for(const Q in H){const oe=H[Q];oe.tileID.isChildOf(a)&&oe.findMatches(f.symbolInstances,a,P)}else{const Q=H[a.scaledTo(Number(R)).key];Q&&Q.findMatches(f.symbolInstances,a,P)}}for(let R=0;R<f.symbolInstances.length;R++){const H=f.symbolInstances.get(R);H.crossTileID||(H.crossTileID=w.generate(),P.add(H.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Vu(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const w of f.crossTileIDs)this.usedCrossTileIDs[a].delete(w)}removeStaleBuckets(a){let f=!1;for(const w in this.indexes){const P=this.indexes[w];for(const R in P)a[P[R].bucketInstanceId]||(this.removeBucketCrossTileIDs(w,P[R]),delete P[R],f=!0)}return f}}class ko{constructor(){this.layerIndexes={},this.crossTileIDs=new Ao,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,w,P){let R=this.layerIndexes[a.fqid];R===void 0&&(R=this.layerIndexes[a.fqid]=new Sa);let H=!1;const Q={};P.name!=="globe"&&R.handleWrapJump(w);for(const oe of f){const de=oe.getBucket(a);de&&a.fqid===de.layerIds[0]&&(de.bucketInstanceId||(de.bucketInstanceId=++this.maxBucketInstanceId),R.addBucket(oe.tileID,de,this.crossTileIDs)&&(H=!0),Q[de.bucketInstanceId]=!0)}return R.removeStaleBuckets(Q)&&(H=!0),H}pruneUnusedLayers(a){const f={};a.forEach(w=>{f[w]=!0});for(const w in this.layerIndexes)f[w]||delete this.layerIndexes[w]}}const gl=771;class In{constructor(a,f,w,P){this.blendFunction=a,this.blendColor=f.toNonPremultipliedRenderColor(null),this.mask=w,this.blendEquation=P}}In.Replace=[1,0,1,0],In.disabled=new In(In.Replace,n.am.transparent,[!1,!1,!1,!1]),In.unblended=new In(In.Replace,n.am.transparent,[!0,!0,!0,!0]),In.alphaBlended=new In([1,gl,1,gl],n.am.transparent,[!0,!0,!0,!0]),In.alphaBlendedNonPremultiplied=new In([770,gl,770,gl],n.am.transparent,[!0,!0,!0,!0]),In.multiply=new In([774,0,774,0],n.am.transparent,[!0,!0,!0,!0]);class Hr{constructor(a,f,w){this.func=a,this.mask=f,this.range=w}}Hr.ReadOnly=!1,Hr.ReadWrite=!0,Hr.disabled=new Hr(519,Hr.ReadOnly,[0,1]);const Zo=7680;class _n{constructor(a,f,w,P,R,H){this.test=a,this.ref=f,this.mask=w,this.fail=P,this.depthFail=R,this.pass=H}}_n.disabled=new _n({func:519,mask:0},0,0,Zo,Zo,Zo);const to=1029,Nc=2305;class fn{constructor(a,f,w){this.enable=a,this.mode=f,this.frontFace=w}}function Nl(b,a){const f=n.c1(b,3);n.c3(b,a),n.c7(b,3,f)}function Vl(b,a){const f=n.b_([]);return n.b$(f,f,-a),n.c0(f,f,-b),f}function Va(b,a){const f=[b[0],b[1],0],w=[a[0],a[1],0];if(n.ae(f)>=1e-15){const H=n.au([],f);n.bY(w,H,n.bG(w,H)),a[0]=w[0],a[1]=w[1]}const P=n.bF([],a,b);if(n.bZ(P)<1e-15)return null;const R=Math.atan2(-P[1],P[0]);return Vl(Math.atan2(Math.sqrt(b[0]*b[0]+b[1]*b[1]),-b[2]),R)}fn.disabled=new fn(!1,to,Nc),fn.backCCW=new fn(!0,to,Nc),fn.backCW=new fn(!0,to,2304),fn.frontCW=new fn(!0,1028,2304),fn.frontCCW=new fn(!0,1028,Nc);class Od{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof n.ac?a:new n.ac(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=n.bX(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const w=this.position,P=this._elevation?this._elevation.getAtPointOrZero(n.ac.fromLngLat(a)):0,R=n.ac.fromLngLat(a,P),H=[R.x-w.x,R.y-w.y,R.z-w.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Va(H,f)}setPitchBearing(a,f){this.orientation=Vl(n.al(a),n.al(-f))}}class Yo{constructor(a,f){this._transform=n.bx([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new n.ac(a[0],a[1],a[2])}get position(){const a=n.c1(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&n.c7(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||n.b_([]),a&&Nl(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=Vl(a,f),Nl(this._transform,this._orientation)}forward(){const a=n.c1(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=n.c1(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=n.c1(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const w=new Float64Array(16);return n.bi(w,this.getWorldToCamera(a,f)),w}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,f,w){const P=this.position;n.bY(P,P,-a);const R=new Float64Array(16);return n.bn(R,[w,w,w]),n.bo(R,R,P),R[10]*=f,R}getWorldToCamera(a,f){const w=new Float64Array(16),P=new Float64Array(4),R=this.position;return n.c2(P,this._orientation),n.bY(R,R,-a),n.c3(w,P),n.bo(w,w,R),w[1]*=-1,w[5]*=-1,w[9]*=-1,w[13]*=-1,w[8]*=f,w[9]*=f,w[10]*=f,w[11]*=f,w}getCameraToClipPerspective(a,f,w,P){const R=new Float64Array(16);return n.c4(R,a,f,w,P),R}getCameraToClipOrthographic(a,f,w,P,R,H){const Q=new Float64Array(16);return n.c5(Q,a,f,w,P,R,H),Q}getDistanceToElevation(a,f=!1){const w=a===0?0:n.c6(a,f?n.aY(this.position[1]):this.position[1]),P=this.forward();return(w-this.position[2])/P[2]}clone(){return new Yo([...this.position],[...this.orientation])}}const Co={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Vc{constructor(a=0,f=0,w=0,P=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(w)||w<0||isNaN(P)||P<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=w,this.right=P}interpolate(a,f,w){return f.top!=null&&a.top!=null&&(this.top=n.ai(a.top,f.top,w)),f.bottom!=null&&a.bottom!=null&&(this.bottom=n.ai(a.bottom,f.bottom,w)),f.left!=null&&a.left!=null&&(this.left=n.ai(a.left,f.left,w)),f.right!=null&&a.right!=null&&(this.right=n.ai(a.right,f.right,w)),this}getCenter(a,f){const w=n.ay((this.left+a-this.right)/2,0,a),P=n.ay((this.top+f-this.bottom)/2,0,f);return new n.P(w,P)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Vc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ho=15;class ef{constructor(a,f,w,P,R,H,Q){this.tileSize=512,this._renderWorldCopies=R===void 0||R,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=w??0,this._maxPitch=P??60,this.setProjection(H),this.setMaxBounds(Q),this.width=0,this.height=0,this._center=new n.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Vc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Yo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new ef(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ho}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,f=!1){const w=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||w)&&this._updateCameraOnTerrain(),(a||w)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return n.aF(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=n.ce(this.projectionOptions);const w=this.getProjection(),P=!n.bv(f,w);return P&&this._calcMatrices(),this.mercatorFromTransition=!1,P}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.ce({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bX(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=n.cf(),n.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=n.ay(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=n.al(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const w=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&w.exaggeration()&&this._centerAltitudeValidForExaggeration!==w.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*w.exaggeration(),this._centerAltitudeValidForExaggeration=w.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=w.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const a=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(a)}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],w=this.horizonLineFromTop();let P=0,R=0;for(let H=0;H<f.length;H++){const Q=new n.P(f[H][0]*this.width,w+f[H][1]*(this.height-w)),oe=a.pointCoordinate(Q);if(!oe)continue;const de=1/Math.hypot(oe[0]-this._camera.position[0],oe[1]-this._camera.position[1]);P+=oe[3]*de,R+=de}return R===0?NaN:P/R}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),w=this.pixelsPerMeter/this.worldSize*f,P=this._mercatorZfromZoom(a),R=this._mercatorZfromZoom(this._maxZoom),H=Math.max(P-w,R);this._setZoom(this._zoomFromMercatorZ(H))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let w;w=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const P=n.ae(n.at([],this._camera.position,w));return n.ay(this._zoomFromMercatorZ(P),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!n.ch(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const w=[a.position.x,a.position.y,a.position.z];n.ci(w,this._camera.position)||(this._setCameraPosition(w),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new Od;return f.position=new n.ac(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!n.cj(a))return!1;n.ck(a,a);const f=n.cl([],[0,0,-1],a),w=n.cl([],[0,-1,0],a);if(w[2]<0)return!1;const P=Va(f,w);return!!P&&(this._camera.orientation=P,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,w=this.zoomScale(this.maxZoom)*this.tileSize,P=this.cameraToCenterDistance;a[2]=n.ay(a[2],P/w,P/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,w){this._unmodified=!1,this._edgeInsets.interpolate(a,f,w),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new n.cm(0,a)];if(this.renderWorldCopies){const w=this.pointCoordinate(new n.P(0,0)),P=this.pointCoordinate(new n.P(this.width,0)),R=this.pointCoordinate(new n.P(this.width,this.height)),H=this.pointCoordinate(new n.P(0,this.height)),Q=Math.floor(Math.min(w.x,P.x,R.x,H.x)),oe=Math.floor(Math.max(w.x,P.x,R.x,H.x)),de=1;for(let pe=Q-de;pe<=oe+de;pe++)pe!==0&&f.push(new n.cm(pe,a))}return f}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,f,w){let P=[];const R=w!=null,H=!R;if(H&&this.zoom<f||R&&w[0]===0&&w[1]===0)return P;const Q=new Set,oe=(pe,yt,pt,vt,Dt)=>{const At=n.cK(yt,pe,pt,vt,Dt);Q.has(At)||(P.push(new n.aM(pe,yt,pt,vt,Dt)),Q.add(At))};for(let pe=0;pe<a.length;pe++){const yt=a[pe];if(H&&yt.canonical.z!==f)continue;const pt=yt.canonical,vt=yt.overscaledZ,Dt=yt.wrap,At=1<<pt.z,Ot=pt.x+1<At,Bt=pt.x>0,qt=pt.y+1<At,li=pt.y>0,fi=yt.wrap-(Bt?0:1),Ti=yt.wrap+(Ot?0:1),wi=Bt?pt.x-1:At-1,vi=Ot?pt.x+1:0;if(R)w[0]<0?(oe(vt,Ti,pt.z,vi,pt.y),w[1]<0&&qt&&(oe(vt,Dt,pt.z,pt.x,pt.y+1),oe(vt,Ti,pt.z,vi,pt.y+1)),w[1]>0&&li&&(oe(vt,Dt,pt.z,pt.x,pt.y-1),oe(vt,Ti,pt.z,vi,pt.y-1))):w[0]>0?(oe(vt,fi,pt.z,wi,pt.y),w[1]<0&&qt&&(oe(vt,Dt,pt.z,pt.x,pt.y+1),oe(vt,fi,pt.z,wi,pt.y+1)),w[1]>0&&li&&(oe(vt,Dt,pt.z,pt.x,pt.y-1),oe(vt,fi,pt.z,wi,pt.y-1))):w[1]<0&&qt?oe(vt,Dt,pt.z,pt.x,pt.y+1):li&&oe(vt,Dt,pt.z,pt.x,pt.y-1);else{const di=yt.visibleQuadrants;1&di&&(oe(vt,fi,pt.z,wi,pt.y),li&&(oe(vt,Dt,pt.z,pt.x,pt.y-1),oe(vt,fi,pt.z,wi,pt.y-1))),2&di&&(oe(vt,Ti,pt.z,vi,pt.y),li&&(oe(vt,Dt,pt.z,pt.x,pt.y-1),oe(vt,Ti,pt.z,vi,pt.y-1))),4&di&&(oe(vt,fi,pt.z,wi,pt.y),qt&&(oe(vt,Dt,pt.z,pt.x,pt.y+1),oe(vt,fi,pt.z,wi,pt.y+1))),8&di&&(oe(vt,Ti,pt.z,vi,pt.y),qt&&(oe(vt,Dt,pt.z,pt.x,pt.y+1),oe(vt,Ti,pt.z,vi,pt.y+1)))}}const de=[];for(const pe of P)P.some(yt=>pe.isChildOf(yt))||de.push(pe);if(P=de.filter(pe=>!a.some(yt=>!!(pe.overscaledZ<f&&yt.isChildOf(pe))||pe.equals(yt)||pe.isChildOf(yt))),H){const pe=1<<f,yt=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),pt=[pe*yt.x,pe*yt.y],vt=4,Dt=vt*vt;P=P.filter(At=>{const Ot=At.canonical.x+.5-pt[0],Bt=At.canonical.y+.5-pt[1];return Ot*Ot+Bt*Bt<Dt})}return P}coveringTiles(a){let f=this.coveringZoomLevel(a);const w=f,P=this.elevation&&this.elevation.exaggeration(),R=P&&!a.isTerrainDEM,H=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const Q=this.locationCoordinate(this.center),oe=this.center.lat,de=1<<f,pe=[de*Q.x,de*Q.y,0],yt=this.projection.name==="globe",pt=!yt,vt=n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,pt),Dt=yt?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),At=de*n.c6(1,this.center.lat),Ot=this._camera.position[2]/n.c6(1,this.center.lat),Bt=[de*Dt.x,de*Dt.y,Ot*(pt?1:At)],qt=yt||P,li=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),fi=this.isLODDisabled(!0)?f:0;let Ti;if(this._elevation&&a.isTerrainDEM)Ti=1e4*this._elevation.exaggeration();else if(this._elevation){const zi=this._elevation.getMinMaxForVisibleTiles();Ti=zi?zi.max:this._centerAltitude}else Ti=this._centerAltitude;const wi=a.isTerrainDEM?-Ti:this._elevation?this._elevation.getMinElevationBelowMSL():0,vi=this.projection.isReprojectedInTileSpace?n.co(this):1,di=zi=>{const Zi=new n.ac(zi.x+25e-6,zi.y,zi.z),gr=new n.ac(zi.x,zi.y+25e-6,zi.z),kr=zi.toLngLat(),cr=Zi.toLngLat(),Pr=gr.toLngLat(),Wr=this.locationCoordinate(kr),qr=this.locationCoordinate(cr),Ur=this.locationCoordinate(Pr),Qr=Math.hypot(qr.x-Wr.x,qr.y-Wr.y),nn=Math.hypot(Ur.x-Wr.x,Ur.y-Wr.y);return Math.sqrt(Qr*nn)*vi/25e-6},Ei=zi=>{const ur=Ti,Zi=wi;return{aabb:n.cr(this,de,0,0,0,zi,Zi,ur,this.projection),zoom:0,x:0,y:0,minZ:Zi,maxZ:ur,wrap:zi,fullyVisible:!1}},Pi=[];let ji=[];const Wi=f,or=a.reparseOverscaled?w:f,ar=(Ot-this._centerAltitude)*At,vr=zi=>{if(!this._elevation||!zi.tileID||!H)return;const ur=this._elevation.getMinMaxForTile(zi.tileID),Zi=zi.aabb;ur?(Zi.min[2]=ur.min,Zi.max[2]=ur.max,Zi.center[2]=(Zi.min[2]+Zi.max[2])/2):(zi.shouldSplit=Ji(zi),zi.shouldSplit||(Zi.min[2]=Zi.max[2]=Zi.center[2]=this._centerAltitude))},Ui=(zi,ur)=>{if(.707*ur<zi)return 1;const Zi=ur/zi;return Zi/(1.4144271570014144+(Math.pow(1.1,Zi-1.4144271570014144+1)-1)/(1.1-1)-1)},Ji=zi=>{if(zi.zoom<fi)return!0;if(zi.zoom===Wi)return!1;if(zi.shouldSplit!=null)return zi.shouldSplit;const ur=zi.aabb.distanceX(Bt),Zi=zi.aabb.distanceY(Bt);let gr=ar,kr=1;if(yt){gr=zi.aabb.distanceZ(Bt);const nn=Math.pow(2,zi.zoom),ln=n.aY((zi.y+1)/nn),gn=n.aY(zi.y/nn),En=Math.min(Math.max(oe,ln),gn),ss=n.cO(En)/n.cO(oe);if(kr=En===oe?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ss/this._mercatorScaleRatio),this.zoom<=n.cL&&zi.zoom===Wi-1&&ss>=.9)return!0}else if(R&&(gr=zi.aabb.distanceZ(Bt)*At),this.projection.isReprojectedInTileSpace&&w<=5){const nn=Math.pow(2,zi.zoom),ln=di(new n.ac((zi.x+.5)/nn,(zi.y+.5)/nn));kr=ln>.85?1:ln}if(!H){const nn=Math.sqrt(ur*ur+Zi*Zi+gr*gr);let ln=(1<<Wi-zi.zoom)*li*kr;return ln*=Ui(Math.max(gr,ar),nn),nn<ln}let cr=Number.MAX_VALUE,Pr=0;const Wr=zi.aabb.getCorners(),qr=[];for(const nn of Wr){n.at(qr,nn,Bt),yt||(R?qr[2]*=At:qr[2]=ar);const ln=n.bG(qr,this._camera.forward());ln<cr&&(cr=ln,Pr=Math.abs(qr[2]))}let Ur=(1<<Wi-zi.zoom)*li*kr;if(Ur*=Ui(Math.max(Pr,ar),cr),cr<Ur)return!0;const Qr=zi.aabb.closestPoint(pe);return Qr[0]===pe[0]&&Qr[1]===pe[1]};if(this.renderWorldCopies)for(let zi=1;zi<=3;zi++)Pi.push(Ei(-zi)),Pi.push(Ei(zi));for(Pi.push(Ei(0));Pi.length>0;){const zi=Pi.pop(),ur=zi.x,Zi=zi.y;let gr=zi.fullyVisible;const kr=()=>this.projection.name==="globe"&&(zi.y===0||zi.y===(1<<zi.zoom)-1);if(!gr){let cr=qt?zi.aabb.intersects(vt):zi.aabb.intersectsFlat(vt);if(cr===0&&kr()){const Pr=new n.cp(zi.zoom,ur,Zi);cr=n.cq(this,de,Pr,!0).intersects(vt)}if(cr===0)continue;gr=cr===2}if(zi.zoom!==Wi&&Ji(zi))for(let cr=0;cr<4;cr++){const Pr=(ur<<1)+cr%2,Wr=(Zi<<1)+(cr>>1),qr={aabb:H?zi.aabb.quadrant(cr):n.cr(this,de,zi.zoom+1,Pr,Wr,zi.wrap,zi.minZ,zi.maxZ,this.projection),zoom:zi.zoom+1,x:Pr,y:Wr,wrap:zi.wrap,fullyVisible:gr,tileID:void 0,shouldSplit:void 0,minZ:zi.minZ,maxZ:zi.maxZ};R&&!yt&&(qr.tileID=new n.aM(zi.zoom+1===Wi?or:zi.zoom+1,zi.wrap,zi.zoom+1,Pr,Wr),vr(qr)),Pi.push(qr)}else{const cr=zi.zoom===Wi?or:zi.zoom;if(a.minzoom&&a.minzoom>cr)continue;let Pr=0;if(!gr){let Qr=qt?zi.aabb.intersectsPrecise(vt):zi.aabb.intersectsPreciseFlat(vt);if(Qr===0&&kr()){const nn=new n.cp(zi.zoom,ur,Zi);Qr=n.cq(this,de,nn,!0).intersectsPrecise(vt)}if(Qr===0)continue;if(a.calculateQuadrantVisibility)if(vt.containsPoint(zi.aabb.center))Pr=15;else for(let nn=0;nn<4;nn++)zi.aabb.quadrant(nn).intersects(vt)!==0&&(Pr|=1<<nn)}const Wr=pe[0]-(.5+ur+(zi.wrap<<zi.zoom))*(1<<f-zi.zoom),qr=pe[1]-.5-Zi,Ur=zi.tileID?zi.tileID:new n.aM(cr,zi.wrap,zi.zoom,ur,Zi);a.calculateQuadrantVisibility&&(Ur.visibleQuadrants=Pr),ji.push({tileID:Ur,distanceSq:Wr*Wr+qr*qr})}}if(this.fogCullDistSq){const zi=this.fogCullDistSq,ur=this.horizonLineFromTop();ji=ji.filter(Zi=>{const gr=[0,0,0,1],kr=[n.aj,n.aj,0,1],cr=this.calculateFogTileMatrix(Zi.tileID.toUnwrapped());n.aA(gr,gr,cr),n.aA(kr,kr,cr);const Pr=n.cs([],gr,kr),Wr=n.ct([],gr,kr),qr=n.cM(Pr,Wr);if(qr===0)return!0;let Ur=!1;const Qr=this._elevation;if(Qr&&qr>zi&&ur!==0){const nn=this.calculateProjMatrix(Zi.tileID.toUnwrapped());let ln;a.isTerrainDEM||(ln=Qr.getMinMaxForTile(Zi.tileID)),ln||(ln={min:wi,max:Ti});const gn=n.cu(this.rotation),En=[gn[0]*n.aj,gn[1]*n.aj,ln.max];n.ad(En,En,nn),Ur=(1-En[1])*this.height*.5<ur}return qr<zi||Ur})}return ji.sort((zi,ur)=>zi.distanceSq-ur.distanceSq).map(zi=>zi.tileID)}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=n.ay(a.lat,-85.051129,n.cv),w=this.projection.project(a.lng,f);return new n.P(w.x*this.worldSize,w.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let w,P;const R=this.centerPoint;if(this.projection.name==="globe"){const Q=this.worldSize;w=(f.x-R.x)/Q,P=(f.y-R.y)/Q}else{const Q=this.pointCoordinate(f),oe=this.pointCoordinate(R);w=Q.x-oe.x,P=Q.y-oe.y}const H=this.locationCoordinate(a);this.setLocation(new n.ac(H.x-w,H.y-P))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,f){return this.projection.locationPoint(this,a,f)}locationPoint3D(a,f){return this.projection.locationPoint(this,a,f,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,f){return this.coordinateLocation(this.pointCoordinate3D(a,f))}locationCoordinate(a,f){const w=f?n.c6(f,a.lat):void 0,P=this.projection.project(a.lng,a.lat);return new n.ac(P.x,P.y,w)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const w=f??this._centerAltitude,P=[a.x,a.y,0,1],R=[a.x,a.y,1,1];n.aA(P,P,this.pixelMatrixInverse),n.aA(R,R,this.pixelMatrixInverse);const H=R[3];n.cw(P,P,1/P[3]),n.cw(R,R,1/H);const Q=P[2],oe=R[2];return{p0:P,p1:R,t:Q===oe?0:(w-Q)/(oe-Q)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],w=[a.x,a.y,1,1];return n.aA(f,f,this.pixelMatrixInverse),n.aA(w,w,this.pixelMatrixInverse),n.cw(f,f,1/f[3]),n.cw(w,w,1/w[3]),f[2]=n.c6(f[2],this._center.lat)*this.worldSize,w[2]=n.c6(w[2],this._center.lat)*this.worldSize,n.cw(f,f,1/this.worldSize),n.cw(w,w,1/this.worldSize),new n.av([f[0],f[1],f[2]],n.au([],n.at([],w,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:w,t:P}=a,R=n.c6(f[2],this._center.lat),H=n.c6(w[2],this._center.lat);return new n.ac(n.ai(f[0],w[0],P)/this.worldSize,n.ai(f[1],w[1],P)/this.worldSize,n.ai(R,H,P))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a,f){if(!this.elevation)return this.pointCoordinate(a,f);let w=this.projection.pointCoordinate3D(this,a.x,a.y);if(w)return new n.ac(w[0],w[1],w[2]);let P=0,R=this.horizonLineFromTop();if(a.y>R)return this.pointCoordinate(a,f);const H=.02*R,Q=a.clone();for(let oe=0;oe<10&&R-P>H;oe++){Q.y=n.ai(P,R,.66);const de=this.projection.pointCoordinate3D(this,Q.x,Q.y);de?(R=Q.y,w=de):P=Q.y}return w?new n.ac(w[0],w[1],w[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=n.cx)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const w=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,P=[a.x*this.worldSize,a.y*this.worldSize,w+a.toAltitude(),1];return n.aA(P,P,this.pixelMatrix),P[3]>0?new n.P(P[0]/P[3],P[1]/P[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,P=this.width-this._edgeInsets.right,R=this.pointLocation3D(new n.P(f,a)),H=this.pointLocation3D(new n.P(P,a)),Q=this.pointLocation3D(new n.P(P,w)),oe=this.pointLocation3D(new n.P(f,w));let de=Math.min(R.lng,H.lng,Q.lng,oe.lng),pe=Math.max(R.lng,H.lng,Q.lng,oe.lng),yt=Math.min(R.lat,H.lat,Q.lat,oe.lat),pt=Math.max(R.lat,H.lat,Q.lat,oe.lat);const vt=Math.pow(2,-this.zoom)/16*270,Dt=this.projection.name==="globe"?1:4,At=(Ot,Bt,qt,li,fi)=>{const Ti=(Ot+qt)/2,wi=(Bt+li)/2,vi=new n.P(Ti,wi),{lng:di,lat:Ei}=this.pointLocation3D(vi),Pi=Math.max(0,de-di,yt-Ei,di-pe,Ei-pt);de=Math.min(de,di),pe=Math.max(pe,di),yt=Math.min(yt,Ei),pt=Math.max(pt,Ei),(fi<Dt||Pi>vt)&&(At(Ot,Bt,Ti,wi,fi+1),At(Ti,wi,qt,li,fi+1))};if(At(f,a,P,a,1),At(P,a,P,w,1),At(P,w,f,w,1),At(f,w,f,a,1),this.projection.name==="globe"){const[Ot,Bt]=n.cy(this);Ot?(pt=90,pe=180,de=-180):Bt&&(yt=-90,pe=180,de=-180)}return new n.aG(new n.cd(de,yt),new n.cd(pe,pt))}_getBoundsRectangular(a,f){const{top:w,left:P}=this._edgeInsets,R=this.height-this._edgeInsets.bottom,H=this.width-this._edgeInsets.right,Q=new n.P(P,w),oe=new n.P(H,w),de=new n.P(H,R),pe=new n.P(P,R);let yt=this.pointCoordinate(Q,a),pt=this.pointCoordinate(oe,a);const vt=this.pointCoordinate(de,f),Dt=this.pointCoordinate(pe,f),At=(Ot,Bt)=>(Bt.y-Ot.y)/(Bt.x-Ot.x);return yt.y>1&&pt.y>=0?yt=new n.ac((1-Dt.y)/At(Dt,yt)+Dt.x,1):yt.y<0&&pt.y<=1&&(yt=new n.ac(-Dt.y/At(Dt,yt)+Dt.x,0)),pt.y>1&&yt.y>=0?pt=new n.ac((1-vt.y)/At(vt,pt)+vt.x,1):pt.y<0&&yt.y<=1&&(pt=new n.ac(-vt.y/At(vt,pt)+vt.x,0)),new n.aG().extend(this.coordinateLocation(yt)).extend(this.coordinateLocation(pt)).extend(this.coordinateLocation(Dt)).extend(this.coordinateLocation(vt))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce((w,P)=>{if(P.dem){const R=P.dem.tree;w.min=Math.min(w.min,R.minimums[0]),w.max=Math.max(w.max,R.maximums[0])}return w},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,w=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,w):w}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-85.051129,this.maxLat=n.cv,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aD(this.minLng)*this.tileSize,this.worldMaxX=n.aD(this.maxLng)*this.tileSize,this.worldMinY=n.aH(this.maxLat)*this.tileSize,this.worldMaxY=n.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,w=this._distanceTileDataCache;if(w[f])return w[f];const P=a.canonical,R=1/this.height,H=this.cameraWorldSize,Q=H/this.zoomScale(P.z),oe=(P.x+Math.pow(2,P.z)*a.wrap)*Q,de=P.y*Q,pe=this.point;pe.x*=H/this.worldSize,pe.y*=H/this.worldSize;const yt=this.angle,pt=Math.sin(-yt),vt=-Math.cos(-yt);return w[f]={bearing:[pt,vt],center:[(pe.x-oe)*R,(pe.y-de)*R],scale:Q/n.aj*R},w[f]}calculateFogTileMatrix(a){const f=a.key,w=this._fogTileMatrixCache;if(w[f])return w[f];const P=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return n.az(P,this.worldToFogMatrix,P),w[f]=new Float32Array(P),w[f]}calculateProjMatrix(a,f=!1,w=!1){const P=a.key;let R;if(R=w?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,R[P])return R[P];const H=this.calculatePosMatrix(a,this.worldSize);let Q;return Q=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:w?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,n.az(H,Q,H),R[P]=new Float32Array(H),R[P]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,w=this._pixelsToTileUnitsCache;if(w[f])return w[f];const P=n.cz(a,this);return w[f]=P,w[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,f=n.bn([],[a,a,a]);return n.az(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const f=n.c6(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(f),P=this._camera.forward(),R=n.c6(1,this._center.lat);w[2]/=R,P[2]/=R,n.au(P,P);const H=a.raycast(w,P,a.exaggeration());if(H){const Q=n.bE([],w,P,H),oe=new n.ac(Q[0],Q[1],n.c6(Q[2],n.aY(Q[1]))),de=(oe.z+n.ae([oe.x-w[0],oe.y-w[1],oe.z-w[2]*R]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(de),this._centerAltitude=oe.toAltitude(),this._center=this.coordinateLocation(oe),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,w=n.c6(1,this._center.lat)*this.worldSize,P=this._computeCameraPosition(w),R=f.getAtPointOrZero(new n.ac(...P)),H=this.pixelsPerMeter/this.worldSize*R,Q=this._minimumHeightOverTerrain(),oe=P[2]-H;if(oe<=Q)if(oe<0||a){const de=this.locationCoordinate(this._center,this._centerAltitude),pe=[P[0],P[1],de.z-P[2]],yt=n.ae(pe);pe[2]-=(Q-oe)/this._pixelsPerMercatorPixel;const pt=n.ae(pe);if(pt===0)return;n.bY(pe,pe,yt/pt*this._pixelsPerMercatorPixel),this._camera.position=[P[0],P[1],de.z*this._pixelsPerMercatorPixel-pe[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const pt=this.center;return pt.lat=n.ay(pt.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(pt.lng=n.ay(pt.lng,this.minLng,this.maxLng)),this.center=pt,void(this._constraining=!1)}const f=this._unmodified,{x:w,y:P}=this.point;let R=0,H=w,Q=P;const oe=this.width/2,de=this.height/2,pe=this.worldMinY*this.scale,yt=this.worldMaxY*this.scale;if(P-de<pe&&(Q=pe+de),P+de>yt&&(Q=yt-de),yt-pe<this.height&&(R=Math.max(R,this.height/(yt-pe)),Q=(yt+pe)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const pt=this.worldMinX*this.scale,vt=this.worldMaxX*this.scale,Dt=this.worldSize/2-(pt+vt)/2;H=(w+Dt+this.worldSize)%this.worldSize-Dt,H-oe<pt&&(H=pt+oe),H+oe>vt&&(H=vt-oe),vt-pt<this.width&&(R=Math.max(R,this.width/(vt-pt)),H=(vt+pt)/2)}H===w&&Q===P||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(H,Q))),R&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(R)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.projection.name==="globe",w=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.c6(1,this.center.lat)/n.c6(1,n.cP));const P=n.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,P),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const R=this.projection.zAxisUnit==="meters"?w:1,H=this._camera.getWorldToCamera(this.worldSize,R);let Q;const oe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(oe[8]=2*-a.x/this.width,oe[9]=2*a.y/this.height,this.isOrthographic){let Ei=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pi=Ei*this.aspect,ji=-Pi,Wi=-Ei;Pi-=a.x,ji-=a.x,Ei+=a.y,Wi+=a.y,Q=this._camera.getCameraToClipOrthographic(ji,Pi,Wi,Ei,this._nearZ,this._farZ),((or,ar,vr,Ui)=>{for(let Ji=0;Ji<16;Ji++)or[Ji]=n.ai(ar[Ji],vr[Ji],Ui)})(Q,Q,oe,n.cN(this.pitch>=ho?1:this.pitch/ho))}else Q=oe;const de=n.cB([],oe,H);let pe=n.cB([],Q,H);if(this.projection.isReprojectedInTileSpace){const Ei=this.locationCoordinate(this.center),Pi=n.bx([]);n.bo(Pi,Pi,[Ei.x*this.worldSize,Ei.y*this.worldSize,0]),n.az(Pi,Pi,n.cC(this)),n.bo(Pi,Pi,[-Ei.x*this.worldSize,-Ei.y*this.worldSize,0]),n.az(pe,pe,Pi),n.az(de,de,Pi),this.inverseAdjustmentMatrix=n.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cE([],pe,[this.worldSize,this.worldSize,this.worldSize/R,1]),this.projMatrix=pe,this.invProjMatrix=n.bi(new Float64Array(16),this.projMatrix),f){const Ei=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ei[8]=2*-a.x/this.width,Ei[9]=2*a.y/this.height,this.expandedFarZProjMatrix=n.cB([],Ei,H)}else this.expandedFarZProjMatrix=this.projMatrix;const yt=n.bi([],Q);this.frustumCorners=n.cF.fromInvProjectionMatrix(yt,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const pt=new Float32Array(16);n.bx(pt),n.cE(pt,pt,[1,-1,1]),n.cG(pt,pt,this._pitch),n.by(pt,pt,this.angle);const vt=n.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.bw(vt);const Dt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;vt[8]=2*-a.x/this.width,vt[9]=2*(a.y+Dt)/this.height,this.skyboxMatrix=n.az(pt,vt,pt);const At=this.point,Ot=At.x,Bt=At.y,qt=this.width%2/2,li=this.height%2/2,fi=Math.cos(this.angle),Ti=Math.sin(this.angle),wi=Ot-Math.round(Ot)+fi*qt+Ti*li,vi=Bt-Math.round(Bt)+fi*li+Ti*qt,di=new Float64Array(pe);if(n.bo(di,di,[wi>.5?wi-1:wi,vi>.5?vi-1:vi,0]),this.alignedProjMatrix=di,pe=n.bz(),n.cE(pe,pe,[this.width/2,-this.height/2,1]),n.bo(pe,pe,[1,-1,0]),this.labelPlaneMatrix=pe,pe=n.bz(),n.cE(pe,pe,[1,-1,1]),n.bo(pe,pe,[-1,-1,0]),n.cE(pe,pe,[2/this.width,2/this.height,1]),this.glCoordMatrix=pe,this.pixelMatrix=n.az(new Float64Array(16),this.labelPlaneMatrix,de),this._calcFogMatrices(),this._distanceTileDataCache={},pe=n.bi(new Float64Array(16),this.pixelMatrix),!pe)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=pe,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cH(this);const Ei=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.ad(Ei,Ei,H),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=pe;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,w=this._camera.position,P=1/this.height/this._pixelsPerMercatorPixel,R=[a,a,f];n.bY(R,R,P),n.bY(w,w,-1),n.cI(w,w,R);const H=n.bz();n.bo(H,H,w),n.cE(H,H,R),this.mercatorFogMatrix=H,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,P)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,w=this._camera.forward(),P=this.point,R=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[P.x/this.worldSize-w[0]*R,P.y/this.worldSize-w[1]*R,a/this.worldSize*this._centerAltitude-w[2]*R]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),w=this._camera.position[2],P=a[2];let R=1;this.projection.wrap&&(this.center=this.center.wrap()),P>0&&(R=Math.min((f-w)/P,1)),this._camera.position=n.bE([],this._camera.position,a,R),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:w,bearing:P}=this._camera.getPitchBearing(),R=n.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,H=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.al(this._maxPitch)),Q=Math.max((a[2]-R)/Math.cos(w),H),oe=this._zoomFromMercatorZ(Q);n.bE(a,a,f,Q),this._pitch=n.ay(w,n.al(this.minPitch),n.al(this.maxPitch)),this.angle=n.bX(P,-Math.PI,Math.PI),this._setZoom(n.ay(oe,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ac(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,a)*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,w=n.cx,P=0,R=1/0;for(;w-f>1e-6&&w>f;){const H=f+.5*(w-f),Q=this.tileSize*Math.pow(2,H),oe=this.getCameraToCenterDistance(this.projection,H,Q),de=this.scaleZoom(oe/(Math.max(0,a)*this.tileSize)),pe=Math.abs(H-de);pe<R&&(R=pe,P=H),H<de?f=H:w=H}return P}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const w=Math.min(a.x,f.x),P=Math.max(a.x,f.x),R=Math.min(a.y,f.y),H=Math.max(a.y,f.y);if(R<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const Q=[new n.P(w,R),new n.P(P,H),new n.P(w,H),new n.P(P,R)],oe=this.renderWorldCopies?-3:0,de=this.renderWorldCopies?4:1;for(const pe of Q){const yt=this.pointRayIntersection(pe);if(yt.t<0)return!0;const pt=this.rayIntersectionCoordinate(yt);if(pt.x<oe||pt.y<0||pt.x>de||pt.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(a,f){const w=n.ae(n.at([],this._camera.position,a)),P=this._zoomFromMercatorZ(w)+f;return w-this._mercatorZfromZoom(P)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([f,w,P],R){const H=[f,w,P,1];n.aA(H,H,R);const Q=H[3]=Math.max(H[3],1e-6);return H[0]/=Q,H[1]/=Q,H[2]/=Q,H}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,a))}}getCameraToCenterDistance(a,f=this.zoom,w=this.worldSize){const P=n.cA(a,f,this.width,this.height,1024),R=a.pixelSpaceConversion(this.center.lat,w,P);let H=.5/Math.tan(.5*this._fov)*this.height*R;return this.isOrthographic&&(H=n.ai(1,H,n.cN(this.pitch>=ho?1:this.pitch/ho))),H}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.az(a,a,this.globeMatrix),a}getFrustum(a){return n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const fa=(b,a)=>{if(a>0&&b.terrain&&n.w("Cutoff is currently disabled on terrain"),a<=0||b.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=b.transform,w=Math.max(Math.abs(f._zoom-(b.minCutoffZoom-1)),1),P=f.isLODDisabled(!1)?n.af(60,45,f.pitch):n.af(30,15,f.pitch),R=f._farZ-f._nearZ,H=a*f.height,Q=((1-(oe=P))*f.cameraToCenterDistance+oe*(f._farZ+H))*w;var oe;return{shouldRenderCutoff:P<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(Q-f._nearZ)/R,(Q-H-f._nearZ)/R]}}},wo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class $c{constructor(a,f){this.aabb=a,this.lastCascade=f}}class Lm{add(a,f){const w=this.receivers[a.key];w!==void 0?(w.aabb.min[0]=Math.min(w.aabb.min[0],f.min[0]),w.aabb.min[1]=Math.min(w.aabb.min[1],f.min[1]),w.aabb.min[2]=Math.min(w.aabb.min[2],f.min[2]),w.aabb.max[0]=Math.max(w.aabb.max[0],f.max[0]),w.aabb.max[1]=Math.max(w.aabb.max[1],f.max[1]),w.aabb.max[2]=Math.max(w.aabb.max[2],f.max[2])):this.receivers[a.key]=new $c(f,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,f,w){const P=n.cW.fromPoints(a.points);let R=0;for(const H in this.receivers){const Q=this.receivers[H];if(!Q||!P.intersectsAabb(Q.aabb))continue;Q.aabb.min=P.closestPoint(Q.aabb.min),Q.aabb.max=P.closestPoint(Q.aabb.max);const oe=Q.aabb.getCorners();for(let de=0;de<w.length;de++){let pe=!0;for(const yt of oe){const pt=[yt[0]*f,yt[1]*f,yt[2]];if(n.ad(pt,pt,w[de].matrix),pt[0]<-1||pt[0]>1||pt[1]<-1||pt[1]>1){pe=!1;break}}if(Q.lastCascade=de,R=Math.max(R,de),pe)break}}return R+1}}class km{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Lm,this._depthMode=new Hr(a.context.gl.LEQUAL,Hr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(wo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(wo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),a.tp.registerParameter(wo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,f){const w=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!f||!f.properties)return;const P=f.properties.get("shadow-intensity");if(!f.shadowsEnabled()||P<=0||(this._shadowLayerCount=w.style.order.reduce((Dt,At)=>{const Ot=w.style._mergedLayers[At];return Dt+(Ot.hasShadowPass()&&!Ot.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const R=w.context,H=wo.shadowMapResolution,Q=wo.shadowMapResolution;if(this._cascades.length===0||wo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Dt=0;Dt<wo.cascadeCount;++Dt){const At=w._shadowMapDebug,Ot=R.gl,Bt=R.createFramebuffer(H,Q,At,"texture"),qt=new n.T(R,{width:H,height:Q,data:null},Ot.DEPTH_COMPONENT16);if(Bt.depthAttachment.set(qt.texture),At){const li=new n.T(R,{width:H,height:Q,data:null},Ot.RGBA8);Bt.colorAttachment.set(li.texture)}this._cascades.push({framebuffer:Bt,texture:qt,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cn,scale:0})}}this.shadowDirection=$l(f);let oe=0;if(a.elevation){const Dt=a.elevation,At=[1e4,-1e4];Dt.visibleDemTiles.filter(Ot=>Ot.dem).forEach(Ot=>{const Bt=Ot.dem.tree;At[0]=Math.min(At[0],Bt.minimums[0]),At[1]=Math.max(At[1],Bt.maximums[0])}),At[0]!==1e4&&(oe=(At[1]-At[0])*Dt.exaggeration())}const de=1.5*a.cameraToCenterDistance,pe=3*de,yt=new Float64Array(16);for(let Dt=0;Dt<this._cascades.length;++Dt){const At=this._cascades[Dt];let Ot=a.height/50,Bt=1;wo.cascadeCount===1?Bt=pe:Dt===0?Bt=de:(Ot=de,Bt=pe);const[qt,li]=Ul(a,this.shadowDirection,Ot,Bt,wo.shadowMapResolution,oe);At.scale=a.scale,At.matrix=qt,At.boundingSphereRadius=li,n.bi(yt,At.matrix),At.frustum=n.cn.fromInvProjectionMatrix(yt,1,0,!0),At.far=Bt}const pt=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[pt].far,this._cascades[pt].far],this._uniformValues.u_shadow_intensity=P,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/wo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=wo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Co.ShadowMap0,this._uniformValues.u_shadowmap_1=Co.ShadowMap0+1,this._groundShadowTiles=w.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const vt=w.transform.elevation;for(const Dt of this._groundShadowTiles){let At={min:0,max:0};if(vt){const Ot=vt.getMinMaxForTile(Dt);Ot&&(At=Ot)}this.addShadowReceiver(Dt.toUnwrapped(),At.min,At.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,f){if(!this.enabled)return;const w=this.painter,P=w.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(w.transform.getFrustum(0),w.transform.worldSize,this._cascades),P.viewport.set([0,0,wo.shadowMapResolution,wo.shadowMapResolution]);for(let R=0;R<this._numCascadesToRender;++R){w.currentShadowCascade=R,P.bindFramebuffer.set(this._cascades[R].framebuffer.framebuffer),P.clear({color:n.am.white,depth:1});for(const H of a.order){const Q=a._mergedLayers[H];if(!Q.hasShadowPass()||Q.isHidden(w.transform.zoom))continue;const oe=a.getLayerSourceCache(Q),de=oe?f[oe.id]:void 0;(Q.type==="model"||de&&de.length)&&w.renderLayer(w,oe,Q,de)}}w.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,f=a.style,w=a.context,P=w.gl,R=f.directionalLight,H=f.ambientLight;if(!R||!H)return;const Q=[],oe=fa(a,a.longestCutoffRange);oe.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),Q.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&Q.push("NORMAL_OFFSET");const de=_l(f,R,H),pe=new Hr(P.LEQUAL,Hr.ReadOnly,a.depthRangeFor3D),yt=new _n({func:P.EQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.KEEP);for(const pt of this._groundShadowTiles){const vt=pt.toUnwrapped(),Dt=a.isTileAffectedByFog(pt),At=a.getOrCreateProgram("groundShadow",{defines:Q,overrideFog:Dt});this.setupShadows(vt,At),a.uploadCommonUniforms(w,At,vt,null,oe);const Ot={u_matrix:a.transform.calculateProjMatrix(vt),u_ground_shadow_factor:de};At.draw(a,P.TRIANGLES,pe,yt,In.multiply,fn.disabled,Ot,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?In.unblended:In.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const f=this.painter.transform,w=f.calculatePosMatrix(a,f.worldSize);return n.az(w,this._cascades[this.painter.currentShadowCascade].matrix,w),Float32Array.from(w)}calculateShadowPassMatrixFromMatrix(a){return n.az(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,f,w,P=0){if(!this.enabled)return;const R=this.painter.transform,H=this.painter.context,Q=H.gl,oe=this._uniformValues,de=new Float64Array(16),pe=R.calculatePosMatrix(a,R.worldSize);for(let yt=0;yt<this._cascades.length;yt++)n.az(de,this._cascades[yt].matrix,pe),oe[yt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(de),H.activeTexture.set(Q.TEXTURE0+Co.ShadowMap0+yt),this._cascades[yt].texture.bindExtraParam(Q.LINEAR,Q.LINEAR,Q.CLAMP_TO_EDGE,Q.CLAMP_TO_EDGE,Q.GREATER);if(this.useNormalOffset=!!w,this.useNormalOffset){const yt=n.cU(a.canonical),pt=2/R.tileSize*n.aj/wo.shadowMapResolution,vt=pt*this._cascades[0].boundingSphereRadius,Dt=pt*this._cascades[this._cascades.length-1].boundingSphereRadius,At=(w==="vector-tile"?1:3)/Math.pow(2,P-a.canonical.z-(1-R.zoom+Math.floor(R.zoom)));oe.u_shadow_normal_offset=[yt,vt*At,Dt*At],oe.u_shadow_bias=[6e-5,.0012,.012]}else oe.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(H,oe)}setupShadowsFromMatrix(a,f,w=!1){if(!this.enabled)return;const P=this.painter.context,R=P.gl,H=this._uniformValues,Q=new Float64Array(16);for(let oe=0;oe<wo.cascadeCount;oe++)n.az(Q,this._cascades[oe].matrix,a),H[oe===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(Q),P.activeTexture.set(R.TEXTURE0+Co.ShadowMap0+oe),this._cascades[oe].texture.bindExtraParam(R.LINEAR,R.LINEAR,R.CLAMP_TO_EDGE,R.CLAMP_TO_EDGE,R.GREATER);if(this.useNormalOffset=w,w){const oe=wo.normalOffset;H.u_shadow_normal_offset=[1,oe,oe],H.u_shadow_bias=[6e-5,.0012,.012]}else H.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(P,H)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,f,w,P){if(P[2]>=0)return{};const R=function(oe,de,pe){const yt=pe/(1<<oe.canonical.z);return new n.cW([oe.canonical.x*yt+oe.wrap*pe,oe.canonical.y*yt+oe.wrap*pe,0],[(oe.canonical.x+1)*yt+oe.wrap*pe,(oe.canonical.y+1)*yt+oe.wrap*pe,de])}(a,f,w).getCorners(),H=f/-P[2];P[0]<0?(n.cV(R[0],R[0],[P[0]*H,0,0]),n.cV(R[3],R[3],[P[0]*H,0,0])):P[0]>0&&(n.cV(R[1],R[1],[P[0]*H,0,0]),n.cV(R[2],R[2],[P[0]*H,0,0])),P[1]<0?(n.cV(R[0],R[0],[0,P[1]*H,0]),n.cV(R[1],R[1],[0,P[1]*H,0])):P[1]>0&&(n.cV(R[2],R[2],[0,P[1]*H,0]),n.cV(R[3],R[3],[0,P[1]*H,0]));const Q={};return Q.vertices=R,Q.planes=[$a(R[1],R[0],R[4]),$a(R[2],R[1],R[5]),$a(R[3],R[2],R[6]),$a(R[0],R[3],R[7])],Q}addShadowReceiver(a,f,w){this._receivers.add(a,n.cW.fromTileIdAndHeight(a,f,w))}getMaxCascadeForTile(a){const f=this._receivers.get(a);return f&&f.lastCascade?f.lastCascade:0}}function $a(b,a,f){const w=n.at([],f,a),P=n.at([],b,a),R=n.bF([],w,P),H=n.ae(R);return H===0?[0,0,1,0]:(n.bY(R,R,1/H),[R[0],R[1],R[2],-n.bG(R,a)])}function $l(b){const a=b.properties.get("direction"),f=n.cR(a.x,a.y,a.z);f[2]=n.ay(f[2],0,75);const w=n.cT([f[0],f[1],f[2]]);return n.cS(w.x,w.y,w.z)}function _l(b,a,f){const w=a.properties.get("color-use-theme")==="none",P=a.properties.get("color"),R=a.properties.get("intensity"),H=a.properties.get("direction"),Q=[H.x,H.y,H.z],oe=f.properties.get("color-use-theme")==="none",de=f.properties.get("color"),pe=f.properties.get("intensity"),yt=Math.max(n.bG([0,0,1],Q),0),pt=[0,0,0];n.bY(pt,de.toPremultipliedRenderColor(oe?null:b.getLut(a.scope)).toArray01Linear().slice(0,3),pe);const vt=[0,0,0];return n.bY(vt,P.toPremultipliedRenderColor(w?null:b.getLut(f.scope)).toArray01Linear().slice(0,3),yt*R),n.cY([pt[0]>0?pt[0]/(pt[0]+vt[0]):0,pt[1]>0?pt[1]/(pt[1]+vt[1]):0,pt[2]>0?pt[2]/(pt[2]+vt[2]):0])}function Ul(b,a,f,w,P,R){const H=b.zoom,Q=b.scale,oe=b.worldSize,de=1/oe,pe=b.aspect,yt=Math.sqrt(1+pe*pe)*Math.tan(.5*b.fovX),pt=yt*yt,vt=w-f,Dt=w+f;let At,Ot;pt>vt/Dt?(At=w,Ot=w*yt):(At=.5*Dt*(1+pt),Ot=.5*Math.sqrt(vt*vt+2*(w*w+f*f)*pt+Dt*Dt*pt*pt));const Bt=b.projection.pixelsPerMeter(b.center.lat,oe),qt=b._camera.getCameraToWorldMercator(),li=[0,0,-At*de];n.ad(li,li,qt);let fi=Ot*de;const Ti=b._edgeInsets;if(!(Ti.left===0&&Ti.top===0&&Ti.right===0&&Ti.bottom===0||Ti.left===Ti.right&&Ti.top===Ti.bottom)){const gr=b._camera.getWorldToCamera(b.worldSize,b.projection.zAxisUnit==="meters"?Bt:1),kr=b._camera.getCameraToClipPerspective(b._fov,b.width/b.height,f,w);kr[8]=2*-b.centerOffset.x/b.width,kr[9]=2*b.centerOffset.y/b.height;const cr=new Float64Array(16);n.cB(cr,kr,gr);const Pr=new Float64Array(16);n.bi(Pr,cr);const Wr=n.cn.fromInvProjectionMatrix(Pr,oe,H,!0);for(const qr of Wr.points){const Ur=((wi=qr)[0]/=Q,wi[1]/=Q,wi[2]=n.c6(wi[2],b._center.lat),wi);fi=Math.max(fi,n.bZ(n.cX([],li,Ur)))}}var wi;fi*=P/(P-1);const vi=Math.acos(a[2]),di=Math.atan2(-a[0],-a[1]),Ei=new Yo;Ei.position=li,Ei.setPitchBearing(vi,di);const Pi=Ei.getWorldToCamera(oe,Bt),ji=fi*oe,Wi=Math.min(b._mercatorZfromZoom(17)*oe*-2,-2*ji),or=Ei.getCameraToClipOrthographic(-ji,ji,-ji,ji,Wi,(ji+R*Bt)/a[2]),ar=new Float64Array(16);n.az(ar,or,Pi);const vr=n.cS(Math.floor(1e6*li[0])/1e6*oe,Math.floor(1e6*li[1])/1e6*oe,0),Ui=.5*P,Ji=[0,0,0];n.ad(Ji,vr,ar),n.bY(Ji,Ji,Ui);const zi=[Math.floor(Ji[0]),Math.floor(Ji[1]),Math.floor(Ji[2])],ur=[0,0,0];n.at(ur,Ji,zi),n.bY(ur,ur,-1/Ui);const Zi=new Float64Array(16);return n.bx(Zi),n.bo(Zi,Zi,ur),n.az(ar,Zi,ar),[ar,ji]}class zd extends n.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(a,f){return n.aS(this.requestManager.transformRequest(f,n.R.Model).url).then(w=>{if(!w)return;const P=n.aT(w),R=new n.aU(a,void 0,void 0,P);return R.computeBoundsAndApplyParent(),R}).catch(w=>{if(w&&w.status===404)return null;this.fire(new n.z(new Error(`Could not load model ${a} from ${f}: ${w.message}`)))})}load(a,f,w={forceReload:!1}){this.models[f]||(this.models[f]={});const P=Object.keys(a),R=[],H=[];for(const Q of P){const oe=a[Q];this.hasURLBeenRequested(oe)&&!w.forceReload||(this.modelByURL[oe]={modelId:Q,scope:f},R.push(this.loadModel(Q,oe)),H.push(Q)),this.models[f][Q]||(this.models[f][Q]={model:null,numReferences:1})}this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+H.length,Promise.allSettled(R).then(Q=>{for(let oe=0;oe<Q.length;oe++){const{status:de}=Q[oe];if(de==="rejected")continue;const{value:pe}=Q[oe];this.models[f][H[oe]]||(this.models[f][H[oe]]={model:null,numReferences:1}),this.models[f][H[oe]].model=pe}this.numModelsLoading[f]-=H.length,this.fire(new n.A("data",{dataType:"style"}))}).catch(Q=>{this.fire(new n.z(new Error(`Could not load models: ${Q.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,f,w={exactIdMatch:!1}){return!!(w.exactIdMatch?this.getModel(a,f):this.getModelByURL(this.modelUris[f][a]))}getModel(a,f){return this.models[f]||(this.models[f]={}),this.models[f][a]?this.models[f][a].model:void 0}getModelByURL(a){if(!a)return null;const f=this.modelByURL[a];return f?this.models[f.scope][f.modelId].model:null}hasModelBeenAdded(a,f){return this.models[f]&&this.models[f][a]!==void 0}getModelURIs(a){return this.modelUris[a]||{}}addModel(a,f,w){this.models[w]||(this.models[w]={}),this.modelUris[w]||(this.modelUris[w]={});const P=this.requestManager.normalizeModelURL(f);if((this.hasModel(a,w,{exactIdMatch:!0})||this.hasModelBeenAdded(a,w))&&this.modelUris[w][a]===P)this.models[w][a].numReferences++;else if(this.hasURLBeenRequested(P)){const{scope:R,modelId:H}=this.modelByURL[P];this.models[R][H].numReferences++}else this.modelUris[w][a]=P,this.load({[a]:this.modelUris[w][a]},w)}addModelURLs(a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const w=this.modelUris[f];for(const P in a)w[P]=this.requestManager.normalizeModelURL(a[P])}reloadModels(a){this.load(this.modelUris[a],a,{forceReload:!0})}addModelsFromBucket(a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const w={};for(const P of a)this.hasModel(P,f,{exactIdMatch:!0})||this.hasURLBeenRequested(P)?this.models[f][P].numReferences++:this.modelUris[f][P]&&!this.hasURLBeenRequested(P)?w[P]=this.modelUris[f][P]:!this.hasURLBeenRequested(P)&&n.cZ(P,!1)&&(this.modelUris[f][P]=this.requestManager.normalizeModelURL(P),w[P]=this.modelUris[f][P]);this.load(w,f)}hasURLBeenRequested(a){return this.modelByURL[a]!==void 0}removeModel(a,f,w=!1){if(this.models[f]&&this.models[f][a]&&(this.models[f][a].numReferences--,this.models[f][a].numReferences===0)){const P=this.modelUris[f][a];w||delete this.modelUris[f][a],delete this.modelByURL[P];const R=this.models[f][a].model;if(!R)return;delete this.models[f][a],R.destroy()}}destroy(){for(const a of Object.keys(this.models))for(const f of Object.keys(this.models[a])){const w=this.models[a][f].model;delete this.models[a][f],w&&w.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,f){this.models[f]||(this.models[f]={});for(const w in this.models[f])this.models[f][w].model&&this.models[f][w].model.upload(a.context)}}const $u=new n.a7({data:new n.a8(n.a5.colorTheme.data)}),tf={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Ta(b){return b=b||{},Object.assign(b,tf)}class Dm extends n.E{constructor(a){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},n.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=a,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(a=>{a.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new n.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=a.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=a.stylesheet.indoor.buildingFeaturesetId,this._scope=a.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:a=>(a.feature&&a.feature.properties.floorplan&&this.selectFloorplan(a.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const a=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new n.A("floorplangone"))};if(this._map.transform.zoom<13)return void a();const f={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},w=this._map.transform.width,P=this._map.transform.height,R=w*(2/3),H=P*(2/3),Q=.5*(w-R),oe=.5*(P-H),de=[new n.P(Q,oe),new n.P(Q+R,oe+H)],pe=this._map.queryRenderedFeatures(de,f);pe.length>0?this._selectedFloorplan&&pe[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=pe[0],this._floorplanSelected()):a()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const a=this._floorplanStates[this._indoorData.id].selectedBuilding,f=a?this._indoorData.buildings.find(Q=>Q.id===a):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,w=this._floorplanStates[this._indoorData.id].selectedLevel,P=this._indoorData.levels.find(Q=>Q.id===w),R=this._indoorData.levels.find(Q=>!(!f||!f.levels)&&Number(Q.levelOrder)===0&&f.levels.includes(Q.id)),H=P?P.id:R?R.id:void 0;this.fire(new n.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:H})),f&&this._buildingSelected(f,!1),H&&this._levelSelected(H)}_buildingSelected(a,f){if(!a||!a.id)return void console.warn("IndoorManager: Building or building id is undefined");f&&a.extent&&this._map.fitBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=a?a.id:void 0;const w=this._indoorData.levels.filter(P=>a.levels.includes(P.id));this.fire(new n.A("buildingselected",{buildingId:a.id,levels:w}))}_levelSelected(a){const f=this._indoorData.levels.find(w=>w.id===a);f?(this._updateLevels(f,!0),this.fire(new n.A("levelselected",{levelId:f.id}))):console.warn(`IndoorManager: Level with ID ${a} not found in the current floorplan.`)}_updateLevels(a,f){if(!a||!a.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function w(de){const pe=de.indexOf("/floor/");if(pe===-1)return de;const yt=pe+7,pt=de.indexOf("/",yt);return pt===-1?de.slice(yt):de.slice(yt,pt)}this._floorplanStates[this._indoorData.id].selectedLevel=a.id;const P=[],R={},H={},Q={},oe={};for(const de of this._indoorData.levels){if(P.push(de.id),R[de.id]=de.levelOrder>=0?3*Math.abs(de.levelOrder+1):3*Math.abs(de.levelOrder),H[de.id]=de.levelOrder>=0?3*de.levelOrder:0,this.mergeFloors){const pe=w(a.id),yt=w(de.id);Q[de.id]=yt===pe?"true":"false"}else Q[de.id]=de.id===a.id?"true":"false";oe[de.id]=de.levelOrder<a.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",P]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",H]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",Q]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",oe]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",a.levelOrder<0)}selectFloorplan(a){const f={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},w=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],P=this._map.queryRenderedFeatures(w,f);if(P.length>0){for(const R of P)if(JSON.parse(R.properties["indoor-data"]).id===a){this._selectedFloorplan=R,this._floorplanSelected();break}}}selectBuilding(a){const f=this._indoorData.buildings.find(w=>w.id===a);this._buildingSelected(f,!0)}selectLevel(a){this._levelSelected(a)}}function Fm(b){if(!b.metadata||!b.metadata.content_area)return;const a=n.q.devicePixelRatio,{left:f,top:w,width:P,height:R}=b.metadata.content_area,H=f*a,Q=w*a;return[H,Q,H+P*a,Q+R*a]}function Bd(b){if(b)return b.map(([a,f])=>[a*n.q.devicePixelRatio,f*n.q.devicePixelRatio])}class Nd{constructor(a,f,w){this.id=a,this.scope=f,this.sourceCache=w,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const f=this.sourceCache.getVisibleCoordinates();if(f.length===0)return a;const w=this.sourceCache.getSource();if(!(w instanceof za))return a;const P=f.map(H=>this.sourceCache.getTile(H)),R=w.getImages(P,Array.from(this.pendingRequests));for(const[H,Q]of R)a.set(n.I.from({name:H,iconsetId:this.id}),Q),this.pendingRequests.delete(H);for(const H of this.pendingRequests)this.missingRequests.add(H);return this.pendingRequests.clear(),a}}const yl=(b,a)=>Jt(b,a&&a.filter(f=>f.identifier!=="source.canvas")),rf=n.aF(Xn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Vd=n.aF(Xn,["setCenter","setZoom","setBearing","setPitch"]),Uu=new Set(["background","sky","slot","custom"]),nf={version:8,layers:[],sources:{}},sf={duration:300,delay:0};class So extends n.E{constructor(a,f={}){super(),this.map=a,this.scope=f.scope||"",this.globalId=null,this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=n.h({},sf),this._buildingIndex=new kd(this),this.crossTileSymbolIndex=new ko,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=f.styleChanges||new kt,this.dispatcher=f.dispatcher?f.dispatcher:new n.D(n.c$(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new gi(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new n.d0(a._requestManager,f.localFontFamily?n.d1.all:f.localIdeographFontFamily?n.d1.ideographs:n.d1.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new zd(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._config=f.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:f.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=f.initialConfig,this.dispatcher.broadcast("setReferrer",n.d2());const w=this;this._rtlTextPluginCallback=So.registerForPluginStateChange(P=>{w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},(R,H)=>{if(n.d3(R),H&&H.every(Q=>Q))for(const Q in w._sourceCaches){const oe=w._sourceCaches[Q],de=oe.getSource().type;de!=="vector"&&de!=="geojson"||oe.reload()}})}),this.on("data",P=>{if(P.dataType!=="source"||P.sourceDataType!=="metadata")return;const R=this.getOwnSource(P.sourceId);if(R&&R.vectorLayerIds)for(const H in this._layers){const Q=this._layers[H];Q.source===R.id&&this._validateLayer(Q)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(n.j(a))return a;const f=n.d4(a);if(!f.startsWith("http"))try{return new URL(f,location.href).toString()}catch{return f}return f}return`json://${n.d5(JSON.stringify(a))}`}_diffStyle(a,f,w){this.globalId=this._getGlobalId(a);const P=(R,H)=>{try{H(null,this.setState(R,w))}catch(Q){H(Q,!1)}};if(typeof a=="string"){const R=this.map._requestManager.normalizeStyleURL(a),H=this.map._requestManager.transformRequest(R,n.R.Style);n.n(H,(Q,oe)=>{Q?this.fire(new n.z(Q)):oe&&P(oe,f)})}else typeof a=="object"&&P(a,f)}loadURL(a,f={}){this.fire(new n.A("dataloading",{dataType:"style"}));const w=typeof f.validate=="boolean"?f.validate:!n.j(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,f.accessToken),this.resolvedImports.add(a);const P=this.importsCache.get(a);if(P)return this._load(P,w);const R=this.map._requestManager.transformRequest(a,n.R.Style);this._request=n.n(R,(H,Q)=>{if(this._request=null,H)this.fire(new n.z(H));else if(Q)return this.importsCache.set(a,Q),this._load(Q,w)})}loadJSON(a,f={}){this.fire(new n.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=n.q.frame(()=>{this._request=null,this._load(a,f.validate!==!1)})}loadEmpty(){this.fire(new n.A("dataloading",{dataType:"style"})),this._load(nf,!1)}_loadImports(a,f,w){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const P=[];for(const R of a){const H=this._createFragmentStyle(R),Q=new Promise(pe=>{H.once("style.import.load",pe),H.once("error",pe)}).then(()=>this.mergeAll());if(P.push(Q),this.resolvedImports.has(R.url)){H.loadEmpty();continue}const oe=R.data||this.importsCache.get(R.url);oe?(H.loadJSON(oe,{validate:f}),this._isInternalStyle(oe)&&(H.globalId=null)):R.url?H.loadURL(R.url,{validate:f}):H.loadEmpty();const de={style:H,id:R.id,config:R.config};if(w){const pe=this.fragments.findIndex(({id:yt})=>yt===w);this.fragments=this.fragments.slice(0,pe).concat(de).concat(this.fragments.slice(pe))}else this.fragments.push(de)}return Promise.allSettled(P)}getImportGlobalIds(a=this,f=new Set){for(const w of a.fragments)w.style.globalId&&f.add(w.style.globalId),this.getImportGlobalIds(w.style,f);return[...f.values()]}_createFragmentStyle(a){const f=this.scope?n.C(a.id,this.scope):a.id;let w;const P=this._initialConfig&&this._initialConfig[f];(a.config||P)&&(w=n.h({},a.config,P));const R=new So(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:w,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers});return R.setEventedParent(this.map,{style:R}),R}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,f){const w=a.indoor?Ta(a.schema):a.schema;if(this._isInternalStyle(a)){const H=n.h({},nf,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(H,f)}if(this.updateConfig(this._config,w),f&&yl(this,Un(a)))return;this._loaded=!0,this.stylesheet=n.d6(a);const P=()=>{for(const de in a.sources)this.addSource(de,a.sources[de],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const de in a.iconsets)this.addIconset(de,a.iconsets[de]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(a.glyphs);const H=Ic(this.stylesheet.layers);if(this._order=H.map(de=>de.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const de=this.stylesheet.lights[0];this.light=new Fi(de.properties,de.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Fi(this.stylesheet.light)),this._layers={};for(const de of H){const pe=n.db(de,this.scope,this._styleColorTheme.lut,this.options);pe.configDependencies.size!==0&&this._configDependentLayers.add(pe.fqid),pe.setEventedParent(this,{layer:{id:pe.id}}),this._layers[pe.id]=pe;const yt=this.getOwnLayerSourceCache(pe),pt=!!this.directionalLight&&this.directionalLight.shadowsEnabled();yt&&pe.canCastShadows()&&pt&&(yt.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const Q=this.stylesheet.terrain;Q&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(Q,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.A("data",{dataType:"style"}));const oe=this.isRootStyle();a.imports?this._loadImports(a.imports,f).then(()=>{this._reloadImports(),this.fire(new n.A(oe?"style.load":"style.import.load"))}).catch(de=>{this.fire(new n.z(new Error("Failed to load imports",de))),this.fire(new n.A(oe?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.A(oe?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const R=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(R){const H=this._evaluateColorThemeData(R);this._loadColorTheme(H).then(()=>{P()}).catch(Q=>{n.w(`Couldn't load color theme from the stylesheet: ${Q}`),P()})}else this._styleColorTheme.lut=null,P()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,f,w,P,R,H,Q,oe,de,pe;const yt={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(pt=>{if(pt.stylesheet){if(pt.light!=null&&(a=pt.light),pt.stylesheet.lights)for(const vt of pt.stylesheet.lights)vt.type==="ambient"&&pt.ambientLight!=null&&(f=pt.ambientLight),vt.type==="directional"&&pt.directionalLight!=null&&(w=pt.directionalLight);P=this._prioritizeTerrain(P,pt.terrain,pt.stylesheet.terrain),pt.stylesheet.fog&&pt.fog!=null&&(R=pt.fog),pt.stylesheet.snow&&pt.snow!=null&&(H=pt.snow),pt.stylesheet.rain&&pt.rain!=null&&(Q=pt.rain),pt.stylesheet.camera!=null&&(pe=pt.stylesheet.camera),pt.stylesheet.projection!=null&&(oe=pt.stylesheet.projection),pt.stylesheet.transition!=null&&(de=pt.stylesheet.transition),yt[pt.scope]=pt._styleColorTheme}}),this.light=a,this.ambientLight=f,this.directionalLight=w,this.fog=R,this.snow=H,this.rain=Q,this._styleColorThemeForScope=yt,P===null?delete this.terrain:this.terrain=P,this.camera=pe||{"camera-projection":"perspective"},this.projection=oe||{name:"mercator"},this.transition=n.h({},sf,de),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){const f=w=>{for(const P of w.fragments)f(P.style);a(w)};f(this)}_prioritizeTerrain(a,f,w){const P=a&&a.drapeRenderMode===0;return w===null?f&&f.drapeRenderMode===0?f:P?a:null:f!=null&&(!a||P||f&&f.drapeRenderMode===1)?f:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{a=this._prioritizeTerrain(a,f.terrain,f.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(a=f.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},f={},w={};this.forEachFragmentStyle(P=>{for(const R in P._sourceCaches){const H=n.C(R,P.scope);a[H]=P._sourceCaches[R]}for(const R in P._otherSourceCaches){const H=n.C(R,P.scope);f[H]=P._otherSourceCaches[R]}for(const R in P._symbolSourceCaches){const H=n.C(R,P.scope);w[H]=P._symbolSourceCaches[R]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=w}mergeLayers(){const a={},f=[],w={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(R=>{for(const H of R._order){const Q=R._layers[H];if(Q.type==="slot"){const oe=n.d7(H);if(a[oe])continue;a[oe]=[]}Q.slot&&a[Q.slot]?a[Q.slot].push(Q):f.push(Q)}}),this._mergedOrder=[];const P=(R=[])=>{for(const H of R)if(H.type==="slot"){const Q=n.d7(H.id);a[Q]&&P(a[Q]),this._mergedSlots.push(Q)}else{const Q=n.C(H.id,H.scope);this._mergedOrder.push(Q),w[Q]=H,H.is3D(!!this.terrain)&&(this._has3DLayers=!0),H.type==="circle"&&(this._hasCircleLayers=!0),H.type==="symbol"&&(this._hasSymbolLayers=!0),H.type==="clip"&&(this._clipLayerPresent=!0)}};P(f),this._mergedOrder.sort((R,H)=>{const Q=w[R],oe=w[H];return Q.hasInitialOcclusionOpacityProperties?oe.is3D(!!this.terrain)?1:0:Q.is3D(!!this.terrain)&&oe.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=w,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=n.h({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(f,w,P,R){const H=n.h({},w);for(const oe of Object.keys(n.a5.colorTheme))H[oe]===void 0&&(H[oe]=n.a5.colorTheme[oe].default);const Q=new n.a6($u,f,new Map(P));return Q.setTransitionOrValue(H,P),Q.untransitioned().possiblyEvaluate(new n.aa(0,{worldview:void 0}))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const f=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((w,P)=>{const R="data:image/png;base64,";if(!a||a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void w();let H=a;H.startsWith(R)||(H=R+H);const Q=n.I.from("mapbox-reserved-lut"),oe=new Image;oe.src=H,oe.onerror=()=>{this._styleColorTheme.lutLoading=!1,P(new Error("Failed to load image data"))},oe.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==f)return void w();this._styleColorTheme.lutLoading=!1;const{width:de,height:pe,data:yt}=n.q.getImageData(oe);if(pe>32)return void P(new Error("The height of the image must be less than or equal to 32 pixels."));if(de!==pe*pe)return void P(new Error("The width of the image must be equal to the height squared."));this.getImage(Q)&&this.removeImage(Q),this.addImage(Q,{data:new n.r({width:de,height:pe},yt),pixelRatio:1,sdf:!1,usvg:!1,version:0});const pt=this.imageManager.getImage(Q,this.scope);pt?(this._styleColorTheme.lut={image:pt.data,data:a},w()):P(new Error("Missing LUT image."))}})}getLut(a){const f=this._styleColorThemeForScope[a];return f?f.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(f,w,P){let R,H,Q;const oe=n.q.devicePixelRatio>1?"@2x":"";let de=n.n(w.transformRequest(w.normalizeSpriteURL(f,oe,".json"),n.R.SpriteJSON),(pt,vt)=>{de=null,Q||(Q=pt,R=vt,yt())}),pe=n.o(w.transformRequest(w.normalizeSpriteURL(f,oe,".png"),n.R.SpriteImage),(pt,vt)=>{pe=null,Q||(Q=pt,H=vt,yt())});function yt(){if(Q)P(Q);else if(R&&H){const pt=n.q.getImageData(H),vt={};for(const Dt in R){const{width:At,height:Ot,x:Bt,y:qt,sdf:li,pixelRatio:fi,stretchX:Ti,stretchY:wi,content:vi}=R[Dt],di=new n.r({width:At,height:Ot});n.r.copy(pt,di,{x:Bt,y:qt},{x:0,y:0},{width:At,height:Ot},null),vt[Dt]={data:di,pixelRatio:fi,sdf:li,stretchX:Ti,stretchY:wi,content:vi,usvg:!1}}P(null,vt)}}return{cancel(){de&&(de.cancel(),de=null),pe&&(pe.cancel(),pe=null)}}}(a,this.map._requestManager,(f,w)=>{if(this._spriteRequest=null,f)this.fire(new n.z(f));else if(w){const P=new Map;for(const R in w)P.set(n.I.from(R),w[R]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.A("data",{dataType:"style"}))})}addIconset(a,f){if(f.type==="sprite")return void this._loadSprite(f.url);const w=this.getOwnSourceCache(f.source);if(!w)return void this.fire(new n.z(new Error(`Source "${f.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const P=w.getSource();if(P.type!=="raster-array")return void this.fire(new n.z(new Error(`Source "${f.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));P.partial=!1;const R=new Nd(a,this.scope,w);this.imageManager.addImageProvider(R,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!n.j(a)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(a);const f=this.map._spriteFormat==="auto";var w,P;this._spriteRequest=(P=(R,H)=>{if(this._spriteRequest=null,R)f?this._loadSprite(a):this.fire(new n.z(R));else if(H){const Q=new Map;for(const oe in H)Q.set(n.I.from(oe),H[oe]);this.addImages(Q)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.A("data",{dataType:"style"}))},n.br((w=this.map._requestManager).transformRequest(w.normalizeIconsetURL(a),n.R.Iconset),(R,H)=>{if(R)return void P(R);const Q={},oe=n.c_(new n.bq(H));for(const de of oe.icons){const pe={version:1,pixelRatio:n.q.devicePixelRatio,content:Fm(de),stretchX:de.metadata?Bd(de.metadata.stretch_x_areas):void 0,stretchY:de.metadata?Bd(de.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:de};Q[de.name]=pe}P(null,Q)}))}_validateLayer(a){const f=this.getOwnSource(a.source);if(!f)return;const w=a.sourceLayer;w&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(w)===-1)&&this.fire(new n.z(new Error(`Source layer "${w}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,f)=>{const w=this.fragments[f];return w&&w.style&&(a.data=w.style.serialize()),a})}_serializeSources(){const a={};for(const f in this._sourceCaches){const w=this._sourceCaches[f].getSource();a[w.id]||(a[w.id]=w.serialize())}return a}_serializeLayers(a){const f=[];for(const w of a){const P=this._layers[w];P&&P.type!=="custom"&&f.push(P.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const f=this.getOwnLayer(a);if(f)return f;this.fire(new n.z(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const f=this.getOwnSource(a);if(f)return f;this.fire(new n.z(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,f){const w=this.map.painter;if(w)for(let P=a.minzoom||0;P<(a.maxzoom||25.5);P++){const R=a.getProgramIds();if(R)for(const H of R){const Q=a.getDefaultProgramParams(H,f.zoom,this._styleColorTheme.lut);Q&&(w.style=this,this.fog&&(w._fogVisible=!0,Q.overrideFog=!0,w.getOrCreateProgram(H,Q)),w._fogVisible=!1,Q.overrideFog=!1,w.getOrCreateProgram(H,Q),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(Q.overrideRtt=!0,w.getOrCreateProgram(H,Q)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const f=this.calculateLightsBrightness();a.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f)),a.worldview!==this._worldview&&(this._worldview=a.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const w=this._changes.isDirty();let P=!1;if(this._changes.isDirty()){const Q=this._changes.getLayerUpdatesByScope();for(const oe in Q){const{updatedIds:de,removedIds:pe}=Q[oe];(de||pe)&&(this._updateWorkerLayers(oe,de,pe),P=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const R={};for(const Q in this._mergedSourceCaches){const oe=this._mergedSourceCaches[Q];R[Q]=oe.used,oe.used=!1,oe.tileCoverLift=0}for(const Q of this._mergedOrder){const oe=this._mergedLayers[Q];if(oe.recalculate(a,this._availableImages),!oe.isHidden(a.zoom)){const de=this.getLayerSourceCache(oe);de&&(de.used=!0,de.tileCoverLift=Math.max(de.tileCoverLift,oe.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(oe,a)}):this.precompilePrograms(oe,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&P&&this.mergeLayers();const H=this.imageManager.getPendingImageProviders();for(const Q of H)Q.sourceCache.used=!0;for(const Q in R){const oe=this._mergedSourceCaches[Q];R[Q]!==oe.used&&oe.getSource().fire(new n.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:oe.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),w&&this.fire(new n.A("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const f of a){const w=f.resolvePendingRequests(),P=this.getFragmentStyle(f.scope);P&&P.addImages(w)}}_updateTilesForChangedImages(){const a={};for(const f in this._mergedSourceCaches){const w=this._mergedSourceCaches[f].getSource().scope;a[w]=a[w]||this._changes.getUpdatedImages(w),a[w].length!==0&&this._mergedSourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a[w])}for(const f in a)this._changes.resetUpdatedImages(f)}_updateWorkerLayers(a,f,w){const P=this.getFragmentStyle(a);P&&this.dispatcher.broadcast("updateLayers",{layers:f?P._serializeLayers(f):[],scope:a,removedIds:w||[],options:P.options})}setState(a,f){if(this._checkLoaded(),yl(this,Un(a)))return!1;(a=n.d6(a)).layers=Ic(a.layers);const w=function(H,Q){if(!H)return[{command:Xn.setStyle,args:[Q]}];let oe=[];try{if(!n.bv(H.version,Q.version))return[{command:Xn.setStyle,args:[Q]}];if(n.bv(H.center,Q.center)||oe.push({command:Xn.setCenter,args:[Q.center]}),n.bv(H.zoom,Q.zoom)||oe.push({command:Xn.setZoom,args:[Q.zoom]}),n.bv(H.bearing,Q.bearing)||oe.push({command:Xn.setBearing,args:[Q.bearing]}),n.bv(H.pitch,Q.pitch)||oe.push({command:Xn.setPitch,args:[Q.pitch]}),n.bv(H.sprite,Q.sprite)||oe.push({command:Xn.setSprite,args:[Q.sprite]}),n.bv(H.glyphs,Q.glyphs)||oe.push({command:Xn.setGlyphs,args:[Q.glyphs]}),n.bv(H.imports,Q.imports)||function(vt=[],Dt=[],At){Dt=Dt||[];const Ot=(vt=vt||[]).map(ul),Bt=Dt.map(ul),qt=vt.reduce(Ba,{}),li=Dt.reduce(Ba,{}),fi=Ot.slice();let Ti,wi,vi,di;for(Ti=0,wi=0;Ti<Ot.length;Ti++)vi=Ot[Ti],li.hasOwnProperty(vi)?wi++:(At.push({command:Xn.removeImport,args:[vi]}),fi.splice(fi.indexOf(vi,wi),1));for(Ti=0,wi=0;Ti<Bt.length;Ti++)vi=Bt[Bt.length-1-Ti],fi[fi.length-1-Ti]!==vi&&(qt.hasOwnProperty(vi)?(At.push({command:Xn.removeImport,args:[vi]}),fi.splice(fi.lastIndexOf(vi,fi.length-wi),1)):wi++,di=fi[fi.length-Ti],At.push({command:Xn.addImport,args:[li[vi],di]}),fi.splice(fi.length-Ti,0,vi));for(const Ei of Dt){const Pi=qt[Ei.id];Pi&&(delete Pi.data,n.bv(Pi,Ei)||At.push({command:Xn.updateImport,args:[Ei.id,Ei]}))}}(H.imports,Q.imports,oe),n.bv(H.transition,Q.transition)||oe.push({command:Xn.setTransition,args:[Q.transition]}),n.bv(H.light,Q.light)||oe.push({command:Xn.setLight,args:[Q.light]}),n.bv(H.fog,Q.fog)||oe.push({command:Xn.setFog,args:[Q.fog]}),n.bv(H.snow,Q.snow)||oe.push({command:Xn.setSnow,args:[Q.snow]}),n.bv(H.rain,Q.rain)||oe.push({command:Xn.setRain,args:[Q.rain]}),n.bv(H.projection,Q.projection)||oe.push({command:Xn.setProjection,args:[Q.projection]}),n.bv(H.lights,Q.lights)||oe.push({command:Xn.setLights,args:[Q.lights]}),n.bv(H.camera,Q.camera)||oe.push({command:Xn.setCamera,args:[Q.camera]}),n.bv(H.iconsets,Q.iconsets)||function(vt,Dt,At){let Ot;for(Ot in Dt=Dt||{},vt=vt||{})vt.hasOwnProperty(Ot)&&(Dt.hasOwnProperty(Ot)||At.push({command:Xn.removeIconset,args:[Ot]}));for(Ot in Dt){if(!Dt.hasOwnProperty(Ot))continue;const Bt=Dt[Ot];vt.hasOwnProperty(Ot)?n.bv(vt[Ot],Bt)||(At.push({command:Xn.removeIconset,args:[Ot]}),At.push({command:Xn.addIconset,args:[Ot,Bt]})):At.push({command:Xn.addIconset,args:[Ot,Bt]})}}(H.iconsets,Q.iconsets,oe),!n.bv(H["color-theme"],Q["color-theme"]))return[{command:Xn.setStyle,args:[Q]}];const de={},pe=[];(function(vt,Dt,At,Ot){let Bt;for(Bt in Dt=Dt||{},vt=vt||{})vt.hasOwnProperty(Bt)&&(Dt.hasOwnProperty(Bt)||Fl(Bt,At,Ot));for(Bt in Dt){if(!Dt.hasOwnProperty(Bt))continue;const qt=Dt[Bt];vt.hasOwnProperty(Bt)?n.bv(vt[Bt],qt)||(vt[Bt].type==="geojson"&&qt.type==="geojson"&&Pm(vt,Dt,Bt)?At.push({command:Xn.setGeoJSONSourceData,args:[Bt,qt.data]}):Rc(Bt,Dt,At,Ot)):Lu(Bt,Dt,At)}})(H.sources,Q.sources,pe,de);const yt=[];H.layers&&H.layers.forEach(vt=>{vt.source&&de[vt.source]?oe.push({command:Xn.removeLayer,args:[vt.id]}):yt.push(vt)});let pt=H.terrain;pt&&de[pt.source]&&(oe.push({command:Xn.setTerrain,args:[void 0]}),pt=void 0),oe=oe.concat(pe),n.bv(pt,Q.terrain)||oe.push({command:Xn.setTerrain,args:[Q.terrain]}),function(vt,Dt,At){Dt=Dt||[];const Ot=(vt=vt||[]).map(ul),Bt=Dt.map(ul),qt=vt.reduce(Ba,{}),li=Dt.reduce(Ba,{}),fi=Ot.slice(),Ti=Object.create(null);let wi,vi,di,Ei,Pi,ji,Wi;for(wi=0,vi=0;wi<Ot.length;wi++)di=Ot[wi],li.hasOwnProperty(di)?vi++:(At.push({command:Xn.removeLayer,args:[di]}),fi.splice(fi.indexOf(di,vi),1));for(wi=0,vi=0;wi<Bt.length;wi++)di=Bt[Bt.length-1-wi],fi[fi.length-1-wi]!==di&&(qt.hasOwnProperty(di)?(At.push({command:Xn.removeLayer,args:[di]}),fi.splice(fi.lastIndexOf(di,fi.length-vi),1)):vi++,ji=fi[fi.length-wi],At.push({command:Xn.addLayer,args:[li[di],ji]}),fi.splice(fi.length-wi,0,di),Ti[di]=!0);for(wi=0;wi<Bt.length;wi++)if(di=Bt[wi],Ei=qt[di],Pi=li[di],!Ti[di]&&!n.bv(Ei,Pi))if(n.bv(Ei.source,Pi.source)&&n.bv(Ei["source-layer"],Pi["source-layer"])&&n.bv(Ei.type,Pi.type)){for(Wi in Lc(Ei.layout,Pi.layout,At,di,null,Xn.setLayoutProperty),Lc(Ei.paint,Pi.paint,At,di,null,Xn.setPaintProperty),n.bv(Ei.slot,Pi.slot)||At.push({command:Xn.setSlot,args:[di,Pi.slot]}),n.bv(Ei.filter,Pi.filter)||At.push({command:Xn.setFilter,args:[di,Pi.filter]}),n.bv(Ei.minzoom,Pi.minzoom)&&n.bv(Ei.maxzoom,Pi.maxzoom)||At.push({command:Xn.setLayerZoomRange,args:[di,Pi.minzoom,Pi.maxzoom]}),Ei)Ei.hasOwnProperty(Wi)&&Wi!=="layout"&&Wi!=="paint"&&Wi!=="filter"&&Wi!=="metadata"&&Wi!=="minzoom"&&Wi!=="maxzoom"&&Wi!=="slot"&&(Wi.indexOf("paint.")===0?Lc(Ei[Wi],Pi[Wi],At,di,Wi.slice(6),Xn.setPaintProperty):n.bv(Ei[Wi],Pi[Wi])||At.push({command:Xn.setLayerProperty,args:[di,Wi,Pi[Wi]]}));for(Wi in Pi)Pi.hasOwnProperty(Wi)&&!Ei.hasOwnProperty(Wi)&&Wi!=="layout"&&Wi!=="paint"&&Wi!=="filter"&&Wi!=="metadata"&&Wi!=="minzoom"&&Wi!=="maxzoom"&&Wi!=="slot"&&(Wi.indexOf("paint.")===0?Lc(Ei[Wi],Pi[Wi],At,di,Wi.slice(6),Xn.setPaintProperty):n.bv(Ei[Wi],Pi[Wi])||At.push({command:Xn.setLayerProperty,args:[di,Wi,Pi[Wi]]}))}else At.push({command:Xn.removeLayer,args:[di]}),ji=fi[fi.lastIndexOf(di)+1],At.push({command:Xn.addLayer,args:[Pi,ji]})}(yt,Q.layers,oe)}catch(de){console.warn("Unable to compute style diff:",de),oe=[{command:Xn.setStyle,args:[Q]}]}return oe}(this.serialize(),a).filter(H=>!(H.command in Vd));if(w.length===0)return!1;const P=w.filter(H=>!(H.command in rf));if(P.length>0)throw new Error(`Unimplemented: ${P.map(H=>H.command).join(", ")}.`);const R=[];return w.forEach(H=>{R.push(this[H.command](...H.args))}),f&&Promise.all(R).then(f).catch(f),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(a){for(const[f,w]of a.entries()){if(this.getImage(f))return this.fire(new n.z(new Error(`An image with the name "${f.name}" already exists.`)));this.imageManager.addImage(f,this.scope,w),this._changes.updateImage(f,this.scope)}return this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this}addImage(a,f){return this.getImage(a)?this.fire(new n.z(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,this.scope,f),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this)}updateImage(a,f,w=!1){this.imageManager.updateImage(a,this.scope,f),w&&(this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})))}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this):this.fire(new n.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(a){return this.modelManager.addModelURLs(a,this.scope),this._updateWorkerModels(),this.fire(new n.A("data",{dataType:"style"})),this}addModel(a,f,w={}){return this._checkLoaded(),this._validate(Vt,`models.${a}`,f,null,w)||(this.modelManager.addModel(a,f,this.scope),this.fire(new n.A("data",{dataType:"style"}))),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this.fire(new n.A("data",{dataType:"style"})),this):this.fire(new n.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,f,w={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(Ks,`sources.${a}`,f,null,w))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const P=Tc(a,f,this.dispatcher,this);P.scope=this.scope,P.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(P.id),source:P.serialize(),sourceId:P.id}));const R=H=>{const Q=(H?"symbol:":"other:")+P.id,oe=n.C(Q,this.scope),de=this._sourceCaches[Q]=new Lo(oe,P,H);(H?this._symbolSourceCaches:this._otherSourceCaches)[P.id]=de,de.onAdd(this.map)};R(!1),f.type!=="vector"&&f.type!=="geojson"||R(!0),P.onAdd&&P.onAdd(this.map),w.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const f=this.getOwnSource(a);if(!f)throw new Error("There is no source with this ID");for(const P in this._layers)if(this._layers[P].source===a)return this.fire(new n.z(new Error(`Source "${a}" cannot be removed while layer "${P}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new n.z(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const P=Object.entries(this.stylesheet.iconsets).find(([R,H])=>H.type==="source"&&H.source===a);if(P)return this.fire(new n.z(new Error(`Source "${a}" cannot be removed while iconset "${P[0]}" is using it.`)))}const w=this.getOwnSourceCaches(a);for(const P of w){const R=n.d7(P.id);delete this._sourceCaches[R],this._changes.discardSourceCacheUpdate(P.id),P.fire(new n.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:P.getSource().id})),P.setEventedParent(null),P.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getOwnSource(a).setData(f),this._changes.setDirty()}getOwnSource(a){const f=this.getOwnSourceCache(a);return f&&f.getSource()}getOwnSources(){const a=[];for(const f in this._otherSourceCaches){const w=this.getOwnSourceCache(f);w&&a.push(w.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const f in a){const w=a[f]._tiles;for(const P in w){const R=w[P];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const R of a){if(this._validate(eo,"lights",R))return;switch(R.type){case"ambient":if(this.ambientLight){const H=this.ambientLight;H.set(R),H.updateTransitions(f)}else this.ambientLight=new Gn(R,yn||(yn=new n.a7({color:new n.a8(n.a5.properties_light_ambient.color),"color-use-theme":new n.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a8(n.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const H=this.directionalLight;H.set(R),H.updateTransitions(f)}else this.directionalLight=new Gn(R,ts||(ts=new n.a7({direction:new n.an(n.a5.properties_light_directional.direction),color:new n.a8(n.a5.properties_light_directional.color),"color-use-theme":new n.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a8(n.a5.properties_light_directional.intensity),"cast-shadows":new n.a8(n.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new n.a8(n.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.a8(n.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const w=Object.assign(f,{worldview:this.map.getWorldview()}),P=new n.aa(this.z||0,w);this.ambientLight&&this.ambientLight.recalculate(P),this.directionalLight&&this.directionalLight.recalculate(P),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,f=this.ambientLight;if(!a||!f)return;const w=pt=>.2126*(pt[0]<=.03928?pt[0]/12.92:Math.pow((pt[0]+.055)/1.055,2.4))+.7152*(pt[1]<=.03928?pt[1]/12.92:Math.pow((pt[1]+.055)/1.055,2.4))+.0722*(pt[2]<=.03928?pt[2]/12.92:Math.pow((pt[2]+.055)/1.055,2.4)),P=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),R=a.properties.get("intensity"),H=a.properties.get("direction"),Q=1-n.cR(H.x,H.y,H.z)[2]/90,oe=w(P)*R*Q,de=f.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),pe=f.properties.get("intensity"),yt=w(de)*pe;return Number(((oe+yt)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(a==null||a===""&&this.isRootStyle())return this;if(n.d8(a)){const f=n.d9(a),w=this.fragments.find(({id:R})=>R===f);if(!w)return;const P=n.d7(a);return w.style.getFragmentStyle(P)}{const f=this.fragments.find(({id:w})=>w===a);return f?f.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const f={},w=(P,R="")=>`${P}::${R}`;this._featuresetSelectors={};for(const P in a){const R=this._featuresetSelectors[P]=[];for(const H of a[P].selectors){if(H.featureNamespace){const oe=this.getOwnLayer(H.layer);if(!oe){n.w(`Layer is undefined for selector: ${H.layer}`);continue}const de=w(oe.source,oe.sourceLayer);if(de in f&&f[de]!==H.featureNamespace){n.w(`"featureNamespace ${H.featureNamespace} of featureset ${P}'s selector is not associated to the same source, skip this selector`);continue}f[de]=H.featureNamespace}let Q;if(H.properties)for(const oe in H.properties){const de=n.X(H.properties[oe]);de.result==="success"&&(Q=Q||{},Q[oe]=de.value)}R.push({layerId:H.layer,namespace:H.featureNamespace,properties:Q,uniqueFeatureID:H._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const f=this.getFragmentStyle(a);if(!f||!f.stylesheet.featuresets)return[];const w=[];for(const P in f.stylesheet.featuresets)w.push({featuresetId:P,importId:f.scope?f.scope:void 0});return w}getFeaturesetLayers(a,f){const w=this.getFragmentStyle(f),P=w.stylesheet.featuresets;if(!P||!P[a])return this.fire(new n.z(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const R=[];for(const H of P[a].selectors){const Q=w.getOwnLayer(H.layer);Q&&R.push(Q)}return R}getConfigProperty(a,f){const w=this.getFragmentStyle(a);if(!w)return null;const P=n.C(f,w.scope),R=w.options.get(P),H=R?R.value||R.default:null;return H?H.serialize():null}setConfigProperty(a,f,w){const P=this.getFragmentStyle(a);if(!P)return;const R=P.stylesheet.indoor?Ta(P.stylesheet.schema):P.stylesheet.schema;if(!R||!R[f])return;const H=n.X(w);if(H.result!=="success")return void yl(this,H.value);const Q=H.value.expression,oe=n.C(f,P.scope),de=P.options.get(oe);if(!de)return;let pe;const{minValue:yt,maxValue:pt,stepValue:vt,type:Dt,values:At}=R[f],Ot=n.X(R[f].default);Ot.result==="success"&&(pe=Ot.value.expression),pe?(this.options.set(oe,Object.assign({},de,{value:Q,default:pe,minValue:yt,maxValue:pt,stepValue:vt,type:Dt,values:At})),this.updateConfigDependencies(f)):this.fire(new n.z(new Error(`No schema defined for the config option "${f}" in the "${a}" fragment.`)))}getConfig(a){const f=this.getFragmentStyle(a);if(!f)return null;const w=f.stylesheet.schema;if(!w)return null;const P={};for(const R in w){const H=n.C(R,f.scope),Q=f.options.get(H),oe=Q?Q.value||Q.default:null;P[R]=oe?oe.serialize():null}return P}setConfig(a,f){const w=this.getFragmentStyle(a);w&&(w.updateConfig(f,w.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const f=this.getFragmentStyle(a);return f?f.stylesheet.schema:null}setSchema(a,f){const w=this.getFragmentStyle(a);w&&(w.stylesheet.schema=f,w.updateConfig(w._config,f),this.updateConfigDependencies())}updateConfig(a,f){if(this._config=a,a||f)if(f)for(const w in f){let P,R;const H=n.X(f[w].default);if(H.result==="success"&&(P=H.value.expression),a&&a[w]!==void 0){const pt=n.X(a[w]);pt.result==="success"&&(R=pt.value.expression)}const{minValue:Q,maxValue:oe,stepValue:de,type:pe,values:yt}=f[w];if(P){const pt=n.C(w,this.scope);this.options.set(pt,{default:P,value:R,minValue:Q,maxValue:oe,stepValue:de,type:pe,values:yt})}else this.fire(new n.z(new Error(`No schema defined for config option "${w}".`)))}else this.fire(new n.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(a){for(const f of this._configDependentLayers){const w=this.getLayer(f);if(w){if(a&&!w.configDependencies.has(a))continue;w.possiblyEvaluateVisibility(),this._updateLayer(w)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(f=>{const w=f._styleColorTheme.colorThemeOverride?f._styleColorTheme.colorThemeOverride:f._styleColorTheme.colorTheme;if(w){const P=f._evaluateColorThemeData(w);(!f._styleColorTheme.lut&&P!==""||f._styleColorTheme.lut&&P!==f._styleColorTheme.lut.data)&&f.setColorTheme(w)}}),this._changes.setDirty()}addLayer(a,f,w={}){this._checkLoaded();const P=a.id;if(this._layers[P])return void this.fire(new n.z(new Error(`Layer with id "${P}" already exists on this map`)));let R;if(a.type==="custom"){if(yl(this,n.da(a)))return;R=n.db(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(P,a.source),a=n.d6(a),a=n.h(a,{source:P})),this._validate(Ai,`layers.${P}`,a,{arrayIndex:-1},w))return;R=n.db(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(R),R.setEventedParent(this,{layer:{id:P}})}R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid);let H=this._order.length;if(f){const pe=this._order.indexOf(f);if(pe===-1)return void this.fire(new n.z(new Error(`Layer with id "${f}" does not exist on this map.`)));R.slot===this._layers[f].slot?H=pe:n.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(H,0,P),this._layerOrderChanged=!0,this._layers[P]=R;const Q=this.getOwnLayerSourceCache(R),oe=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Q&&R.canCastShadows()&&oe&&(Q.castsShadows=!0);const de=this._changes.getRemovedLayer(R);if(de&&R.source&&Q&&R.type!=="custom"){this._changes.discardLayerRemoval(R);const pe=n.C(R.source,R.scope);de.type!==R.type?this._changes.updateSourceCache(pe,"clear"):(this._changes.updateSourceCache(pe,"reload"),Q.pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map),R.scope=this.scope,this.mergeLayers()}moveLayer(a,f){this._checkLoaded();const w=this._checkLayer(a);if(!w||a===f)return;const P=this._order.indexOf(a);this._order.splice(P,1);let R=this._order.length;if(f){const H=this._order.indexOf(f);if(H===-1)return void this.fire(new n.z(new Error(`Layer with id "${f}" does not exist on this map.`)));w.slot===this._layers[f].slot?R=H:n.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(R,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const f=this._checkLayer(a);if(!f)return;f.setEventedParent(null);const w=this._order.indexOf(a);this._order.splice(w,1),delete this._layers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const P=this.getOwnLayerSourceCache(f);if(P&&P.castsShadows){let R=!1;for(const H in this._layers)if(this._layers[H].source===f.source&&this._layers[H].canCastShadows()){R=!0;break}P.castsShadows=R}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,w){this._checkLoaded();const P=this._checkLayer(a);P&&(P.minzoom===f&&P.maxzoom===w||(f!=null&&(P.minzoom=f),w!=null&&(P.maxzoom=w),this._updateLayer(P)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,f){this._checkLoaded();const w=this._checkLayer(a);w&&w.slot!==f&&(w.slot=f,this._updateLayer(w))}setFilter(a,f,w={}){this._checkLoaded();const P=this._checkLayer(a);if(P&&!n.bv(P.filter,f))return f==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(ii,`layers.${P.id}.filter`,f,{layerType:P.type},w)||(P.filter=n.d6(f),this._updateLayer(P)))}getFilter(a){const f=this._checkLayer(a);if(f)return n.d6(f.filter)}setLayoutProperty(a,f,w,P={}){this._checkLoaded();const R=this._checkLayer(a);if(R&&!n.bv(R.getLayoutProperty(f),w)){if(w!=null&&(!P||P.validate!==!1)&&yl(R,Ft.call(Un,{key:`layers.${a}.layout.${f}`,layerType:R.type,objectKey:f,value:w,styleSpec:n.a5,style:{glyphs:!0,sprite:!0}})))return;R.setLayoutProperty(f,w),R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),this._updateLayer(R)}}getLayoutProperty(a,f){const w=this._checkLayer(a);if(w)return w.getLayoutProperty(f)}setPaintProperty(a,f,w,P={}){this._checkLoaded();const R=this._checkLayer(a);if(!R||n.bv(R.getPaintProperty(f),w)||w!=null&&(!P||P.validate!==!1)&&yl(R,wt.call(Un,{key:`layers.${a}.paint.${f}`,layerType:R.type,objectKey:f,value:w,styleSpec:n.a5})))return;const H=R.setPaintProperty(f,w);R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),H&&this._updateLayer(R),this._changes.updatePaintProperties(R)}getPaintProperty(a,f){const w=this._checkLayer(a);if(w)return w.getPaintProperty(f)}setFeatureState(a,f){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:oe,importId:de}=a.target,pe=this.getFragmentStyle(de),yt=pe.getFeaturesetLayers(oe);for(const{source:pt,sourceLayer:vt}of yt)pe.setFeatureState({id:a.id,source:pt,sourceLayer:vt},f)}else if("layerId"in a.target){const{layerId:oe}=a.target,de=this.getLayer(oe);this.setFeatureState({id:a.id,source:de.source,sourceLayer:de.sourceLayer},f)}return}const w=a.source,P=a.sourceLayer,R=this._checkSource(w);if(!R)return;const H=R.type;if(H==="geojson"&&P)return void this.fire(new n.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(H==="vector"&&!P)return void this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new n.z(new Error("The feature id parameter must be provided.")));const Q=this.getOwnSourceCaches(w);for(const oe of Q)oe.setFeatureState(P,a.id,f)}removeFeatureState(a,f){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:oe,importId:de}=a.target,pe=this.getFragmentStyle(de),yt=pe.getFeaturesetLayers(oe);for(const{source:pt,sourceLayer:vt}of yt)pe.removeFeatureState({id:a.id,source:pt,sourceLayer:vt},f)}else if("layerId"in a.target){const{layerId:oe}=a.target,de=this.getLayer(oe);this.removeFeatureState({id:a.id,source:de.source,sourceLayer:de.sourceLayer},f)}return}const w=a.source,P=this._checkSource(w);if(!P)return;const R=P.type,H=R==="vector"?a.sourceLayer:void 0;if(R==="vector"&&!H)return void this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new n.z(new Error("A feature id is required to remove its specific state property.")));const Q=this.getOwnSourceCaches(w);for(const oe of Q)oe.removeFeatureState(H,a.id,f)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let R;if("featuresetId"in a.target){const{featuresetId:H,importId:Q}=a.target,oe=this.getFragmentStyle(Q),de=oe.getFeaturesetLayers(H);for(const{source:pe,sourceLayer:yt}of de){const pt=oe.getFeatureState({id:a.id,source:pe,sourceLayer:yt});if(pt&&!R)R=pt;else if(!n.bv(R,pt))return void this.fire(new n.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:H}=a.target,Q=this.getLayer(H);R=this.getFeatureState({id:a.id,source:Q.source,sourceLayer:Q.sourceLayer})}return R}const f=a.source,w=a.sourceLayer,P=this._checkSource(f);if(P){if(P.type!=="vector"||w)return a.id===void 0&&this.fire(new n.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(w,a.id);this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=n.h({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return n.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),f=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return n.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},w=>w!==void 0)}_updateFilteredLayers(a){for(const f of Object.values(this._mergedLayers))a(f)&&this._updateLayer(f)}_updateLayer(a){this._changes.updateLayer(a);const f=this.getLayerSourceCache(a),w=n.C(a.source,a.scope),P=this._changes.getUpdatedSourceCaches();a.source&&!P[w]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(w,"reload"),f.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=Q=>this._mergedLayers[Q].is3D(!!this.terrain),w=this.order,P={},R=[];for(let Q=w.length-1;Q>=0;Q--){const oe=w[Q];if(f(oe)){P[oe]=Q;for(const de of a){const pe=de[oe];if(pe)for(const yt of pe)R.push(yt)}}}R.sort((Q,oe)=>oe.intersectionZ-Q.intersectionZ);const H=[];for(let Q=w.length-1;Q>=0;Q--){const oe=w[Q];if(f(oe))for(let de=R.length-1;de>=0;de--){const pe=R[de].feature;if(pe.layer&&P[pe.layer.id]<Q)break;H.push(pe),R.pop()}else for(const de of a){const pe=de[oe];if(pe)for(const yt of pe)H.push(yt.feature)}}return H}queryRenderedFeatures(a,f,w){let P;f&&!Array.isArray(f)&&f.filter&&(this._validate(ii,"queryRenderedFeatures.filter",f.filter,null,f),P=n.b3(f.filter));const R={},H=pe=>{if(Uu.has(pe.type))return;const yt=this.getOwnLayerSourceCache(pe),pt=R[yt.id]=R[yt.id]||{sourceCache:yt,layers:{},has3DLayers:!1};pe.is3D(!!this.terrain)&&(pt.has3DLayers=!0),pt.layers[pe.fqid]=pt.layers[pe.fqid]||{styleLayer:pe,targets:[]},pt.layers[pe.fqid].targets.push({filter:P})};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new n.z(new Error("parameters.layers must be an Array."))),[];for(const pe of f.layers){const yt=this._layers[pe];if(!yt)return this.fire(new n.z(new Error(`The layer '${pe}' does not exist in the map's style and cannot be queried for features.`))),[];H(yt)}}else for(const pe in this._layers)H(this._layers[pe]);const Q=this._queryRenderedFeatures(a,R,w),oe=this._flattenAndSortRenderedFeatures(Q),de=[];for(const pe of oe)n.dd(pe.layer.id)===this.scope&&de.push(pe);return de}queryRenderedFeatureset(a,f,w){let P;f&&!Array.isArray(f)&&f.filter&&(this._validate(ii,"queryRenderedFeatures.filter",f.filter,null,f),P=n.b3(f.filter));const R="mock",H=[];if(f&&f.target)H.push(Object.assign({},f,{targetId:R,filter:P}));else{const pe=this.getFeaturesetDescriptors();for(const yt of pe)H.push({targetId:R,filter:P,target:yt});for(const{style:yt}of this.fragments){const pt=yt.getFeaturesetDescriptors();for(const vt of pt)H.push({targetId:R,filter:P,target:vt})}}const Q=this.queryRenderedTargets(a,H,w),oe=[],de=new Set;for(const pe of Q)for(const yt of pe.variants[R])Pu(yt,pe,de)||oe.push(new n.de(pe,yt));return oe}queryRenderedTargets(a,f,w){const P={},R=(Q,oe,de,pe)=>{const yt=P[oe.id]=P[oe.id]||{sourceCache:oe,layers:{},has3DLayers:!1};if(yt.layers[Q.fqid]=yt.layers[Q.fqid]||{styleLayer:Q,targets:[]},Q.is3D(!!this.terrain)&&(yt.has3DLayers=!0),!pe)return de.uniqueFeatureID=!1,void yt.layers[Q.fqid].targets.push(de);yt.layers[Q.fqid].targets.push(Object.assign({},de,{namespace:pe.namespace,properties:pe.properties,uniqueFeatureID:pe.uniqueFeatureID}))};for(const Q of f)if("featuresetId"in Q.target){const{featuresetId:oe,importId:de}=Q.target,pe=this.getFragmentStyle(de);if(!pe||!pe._featuresetSelectors)continue;const yt=pe._featuresetSelectors[oe];if(!yt){this.fire(new n.z(new Error(`The featureset '${oe}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const pt of yt){const vt=pe.getOwnLayer(pt.layerId);vt&&!Uu.has(vt.type)&&R(vt,pe.getOwnLayerSourceCache(vt),Q,pt)}}else if("layerId"in Q.target){const{layerId:oe}=Q.target,de=this.getLayer(oe);if(!de||Uu.has(de.type))continue;R(de,this.getLayerSourceCache(de),Q)}const H=this._queryRenderedFeatures(a,P,w);return this._flattenAndSortRenderedFeatures(H)}_queryRenderedFeatures(a,f,w){const P=[],R=!!this.map._showQueryGeometry,H=qn.createFromScreenPoints(a,w);for(const Q in f){const oe=Iu(H,f[Q],this._availableImages,w,R);Object.keys(oe).length&&P.push(oe)}if(this.placement)for(const Q in f){if(!f[Q].sourceCache._onlySymbols)continue;const oe=al(H.screenGeometry,f[Q],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(oe).length&&P.push(oe)}return P}querySourceFeatures(a,f){const w=f&&f.filter;w&&this._validate(ii,"querySourceFeatures.filter",w,null,f);let P=[];const R=this.getOwnSourceCaches(a);for(const H of R)P=P.concat(Mc(H,f));return P}addSourceType(a,f,w){return So.getSourceType(a)?w(new Error(`A source type called "${a}" already exists.`)):(So.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},w):w(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,f,w={}){this._checkLoaded();const P=this.light.getLight();let R=!1;for(const Q in a)if(!n.bv(a[Q],P[Q])){R=!0;break}if(!R)return;const H=this._getTransitionParameters();this.light.setLight(a,f,w),this.light.updateTransitions(H)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,f=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),f===0&&delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let w=a;const P=a.source==null;if(f===1){if(this.disableElevatedTerrain)return;if(typeof w.source=="object"){const Q="terrain-dem-src";this.addSource(Q,w.source),w=n.d6(w),w=n.h(w,{source:Q})}const R=n.h({},w),H={};if(this.terrain&&P){R.source=this.terrain.get().source;const Q=this.terrain?this.getFragmentStyle(this.terrain.scope):null;Q&&(H.style=Q.serialize())}if(this._validate(rr,"terrain",R,H))return}if(!this.terrain||this.terrain.scope!==this.scope&&!P||this.terrain&&f!==this.terrain.drapeRenderMode){if(!w)return;this._createTerrain(w,f),this.fire(new n.A("data",{dataType:"style"}))}else{const R=this.terrain,H=R.get();for(const Q of Object.keys(n.a5.terrain))!w.hasOwnProperty(Q)&&n.a5.terrain[Q].default&&(w[Q]=n.a5.terrain[Q].default);for(const Q in a)if(!n.bv(a[Q],H[Q])){R.set(a,this.options),this.stylesheet.terrain=a;const oe=this._getTransitionParameters({duration:0});R.updateTransitions(oe),this.fire(new n.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new rn(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=f.get();const w=this._getTransitionParameters({duration:0});f.updateTransitions(w)}_createSnow(a){const f=this.snow=new Hn(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=f.get();const w=this._getTransitionParameters({duration:0});f.updateTransitions(w)}_createRain(a){const f=this.rain=new Vn(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=f.get();const w=this._getTransitionParameters({duration:0});f.updateTransitions(w)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!n.bv(f.get(),a)){f.set(a,this.options),this.stylesheet.fog=f.get();const w=this._getTransitionParameters({duration:0});f.updateTransitions(w)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const f=this.snow;if(!n.bv(f.get(),a)){f.set(a,this.options),this.stylesheet.snow=f.get();const w=this._getTransitionParameters({duration:0});f.updateTransitions(w)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const f=this.rain;if(!n.bv(f.get(),a)){f.set(a,this.options),this.stylesheet.rain=f.get();const w=this._getTransitionParameters({duration:0});f.updateTransitions(w)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const P in this._layers)this._layers[P].lut=this._styleColorTheme.lut;for(const P in this._sourceCaches)this._sourceCaches[P].clearTiles()},f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!f)return this._styleColorTheme.lut=null,void a();const w=this._evaluateColorThemeData(f);this._loadColorTheme(w).then(()=>{this.fire(new n.A("colorthemeset")),a()}).catch(P=>{n.w(`Couldn't set color theme: ${P}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,f){const w=this.getFragmentStyle(a);w&&(w._styleColorTheme.colorThemeOverride=f,w._reloadColorTheme())}_getTransitionParameters(a){return{now:n.q.now(),transition:n.h(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],f=[];for(const w of this._mergedOrder)this.isLayerDraped(this._mergedLayers[w])?a.push(w):f.push(w);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const w=this.terrain=new bi(a,f,this.scope,this.options,this.map.getWorldview());f===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const P=this._getTransitionParameters({duration:0});w.updateTransitions(P)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,w,P,R={}){if(R&&R.validate===!1)return!1;const H=n.h({},this.serialize());return yl(this,a.call(Un,n.h({key:f,style:H,value:w,styleSpec:n.a5},P)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(a){const f=this.getSourceCaches(a);for(const w of f)w.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){const f=this.getSourceCaches(a);for(const w of f)w.resume(),w.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let f;this.directionalLight&&(f=$l(this.directionalLight));const w=new Set;for(const P in this._mergedLayers){const R=this._mergedLayers[P];R.hasElevation()&&!w.has(R.source)&&w.add(R.source)}for(const P in this._mergedSourceCaches){const R=this._mergedSourceCaches[P],H=w.has(R._source.id);R.update(a,void 0,void 0,f,H)}}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,w,P,R,H,Q=!1){let oe=!1,de=!1;const pe={},yt={};for(const pt of this._mergedOrder){const vt=this._mergedLayers[pt];if(vt.type!=="symbol")continue;const Dt=n.C(vt.source,vt.scope);let At=pe[Dt];if(!At){const Bt=this.getLayerSourceCache(vt);if(!Bt)continue;const qt=Bt.getRenderableIds(!0).map(li=>Bt.getTileByID(li));yt[Dt]=qt.slice(),At=pe[Dt]=qt.sort((li,fi)=>fi.tileID.overscaledZ-li.tileID.overscaledZ||(li.tileID.isLessThan(fi.tileID)?-1:1))}const Ot=this.crossTileSymbolIndex.addLayer(vt,At,f.center.lng,f.projection);oe=oe||Ot}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),Q=Q||this._layerOrderChanged||P===0,this._layerOrderChanged&&this.fire(new n.A("neworder")),(Q||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),f.zoom))&&(this.pauseablePlacement=new Nu(f,this._mergedOrder,Q,w,P,R,this.placement,this.fog&&f.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,pe,yt,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),de=!0),oe&&this.pauseablePlacement.placement.setStale()),de||oe){this._buildingIndex.onNewFrame(f.zoom);for(let pt=0;pt<this._mergedOrder.length;pt++){const vt=this._mergedLayers[this._mergedOrder[pt]];if(vt.type!=="symbol")continue;const Dt=this.isLayerClipped(vt);this.placement.updateLayerOpacities(vt,pe[n.C(vt.source,vt.scope)],pt,Dt?H:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,f){this._checkLoaded();const w=this.stylesheet.imports=this.stylesheet.imports||[];if(w.findIndex(({id:R})=>R===a.id)!==-1)return void this.fire(new n.z(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!f)return w.push(a),this._loadImports([a],!0);const P=w.findIndex(({id:R})=>R===f);return P===-1&&this.fire(new n.z(new Error(`Import with id "${f}" does not exist on this map.`))),this.stylesheet.imports=w.slice(0,P).concat(a).concat(w.slice(P)),this._loadImports([a],!0,f)}updateImport(a,f){this._checkLoaded();const w=this.stylesheet.imports||[],P=this.getImportIndex(a);return P===-1?this:typeof f=="string"?(this.setImportUrl(a,f),this):(f.url&&f.url!==w[P].url&&this.setImportUrl(a,f.url),n.bv(f.config,w[P].config)||this.setImportConfig(a,f.config,f.data.schema),n.bv(f.data,w[P].data)||this.setImportData(a,f.data),this)}moveImport(a,f){this._checkLoaded();let w=this.stylesheet.imports||[];const P=this.getImportIndex(a);if(P===-1)return this;const R=this.getImportIndex(f);if(R===-1)return this;const H=w[P],Q=this.fragments[P];return w=w.filter(({id:oe})=>oe!==a),this.fragments=this.fragments.filter(({id:oe})=>oe!==a),this.stylesheet.imports=w.slice(0,R).concat(H).concat(w.slice(R)),this.fragments=this.fragments.slice(0,R).concat(Q).concat(this.fragments.slice(R)),this.mergeLayers(),this}setImportUrl(a,f){this._checkLoaded();const w=this.stylesheet.imports||[],P=this.getImportIndex(a);if(P===-1)return this;w[P].url=f;const R=this.fragments[P];return R.style=this._createFragmentStyle(w[P]),R.style.on("style.import.load",()=>this.mergeAll()),R.style.loadURL(f),this}setImportData(a,f){this._checkLoaded();const w=this.getImportIndex(a),P=this.stylesheet.imports||[];return w===-1?this:f?(this.fragments[w].style.setState(f),this._reloadImports(),this):(delete P[w].data,this.setImportUrl(a,P[w].url))}setImportConfig(a,f,w){this._checkLoaded();const P=this.getImportIndex(a),R=this.stylesheet.imports||[];if(P===-1)return this;f?R[P].config=f:delete R[P].config;const H=this.fragments[P];w&&H.style.stylesheet&&(H.style.stylesheet.schema=w);const Q=H.style.stylesheet&&H.style.stylesheet.schema;return H.config=f,H.style.updateConfig(f,Q),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const f=this.stylesheet.imports||[],w=this.getImportIndex(a);w!==-1&&(f.splice(w,1),this.fragments[w].style._remove(),this.fragments.splice(w,1),this._reloadImports())}getImportIndex(a){const f=(this.stylesheet.imports||[]).findIndex(w=>w.id===a);return f===-1&&this.fire(new n.z(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),f}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const f in this._mergedOtherSourceCaches){const w=this._mergedOtherSourceCaches[f];w&&a.push(w.getSource())}return a}getSource(a,f){const w=this.getSourceCache(a,f);return w&&w.getSource()}getLayerSource(a){const f=this.getLayerSourceCache(a);return f&&f.getSource()}getSourceCache(a,f){const w=n.C(a,f);return this._mergedOtherSourceCaches[w]}getLayerSourceCache(a){const f=n.C(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const f=[];return this._mergedOtherSourceCaches[a]&&f.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&f.push(this._mergedSymbolSourceCaches[a]),f}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const f in a){const w=a[f];w==="reload"?this.reloadSource(f):w==="clear"&&this.clearSource(f)}}updateLayers(a){const f=this._changes.getUpdatedPaintProperties();for(const w of f){const P=this.getLayer(w);P&&P.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a,this.scope)}getImages(a,f,w){this.imageManager.getImages(f.images,f.scope,w),this._updateTilesForChangedImages();const P=H=>{if(H){const Q=f.images.map(oe=>n.I.toString(oe));H.setDependencies(f.tileID.key,f.type,Q)}},R=n.C(f.source,f.scope);P(this._mergedOtherSourceCaches[R]),P(this._mergedSymbolSourceCaches[R])}rasterizeImages(a,f,w){this.imageManager.rasterizeImages(f,w)}getGlyphs(a,f,w){this.glyphManager.getGlyphs(f.stacks,f.scope,w)}getResource(a,f,w){return n.dg(f,w)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this.getOwnSourceCaches(a);return f.length===0?(this.fire(new n.z(new Error(`There is no source with ID '${a}'`))),!1):f.every(w=>w.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,f){if(!this._clipLayerPresent&&a.type!=="fill-extrusion"&&a.type!=="building")return!1;const w=a.type==="fill-extrusion"&&a.sourceLayer==="building",P=a.type==="building";if(a.is3D(!!this.terrain)){if(w||P||f&&f.type==="batched-model"||a.type==="model")return!0}else if(a.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}So.getSourceType=function(b){return Cu[b]},So.setSourceType=function(b,a){Cu[b]=a},So.registerForPluginStateChange=n.dh;var Uc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,of=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,af=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Gl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Hl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,lf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Gu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ho=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Fr=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,cf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const jl=[];Ko(Uc,jl),Ko(af,jl),Ko(of,jl);const Wl={"_prelude_fog.vertex.glsl":lf,"_prelude_terrain.vertex.glsl":Hl,"_prelude_shadow.vertex.glsl":Fr,"_prelude_fog.fragment.glsl":Gu,"_prelude_shadow.fragment.glsl":cf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ho,"_prelude_raster_particle.glsl":Hu},Gc={};$n("",Hl),$n(Gu,lf),$n(cf,Fr),$n(Ho,""),$n(Hu,"");const Hc=$n(of,af),da=Uc;var ju={background:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:$n(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$n("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$n(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$n(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$n("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$n("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$n("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:$n(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:$n(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:$n(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:$n(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:$n(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:$n(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:$n("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:$n("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$n(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:$n(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:$n("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:$n(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Gl),skyboxGradient:$n(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Gl),skyboxCapture:$n(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$n(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:$n(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:$n(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:$n(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:$n("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:$n("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:$n("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:$n("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ko(b,a){const f=b.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let w of f)if(w=w.trim(),w[0]==="#"&&w.includes("if")&&!w.includes("endif")){w=w.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const P=w.split(" ");for(const R of P)a.includes(R)||a.push(R)}}function $n(b,a){const f=/#include\s+"([^"]+)"/g,w=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let P=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);P&&(P=P.map(de=>{const pe=de.split(" ");return pe[pe.length-1]}),P=[...new Set(P)]);const R={},H=[],Q=[];if(b=b.replace(f,(de,pe)=>(Q.push(pe),"")),(a=a.replace(f,(de,pe)=>(H.push(pe),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let oe=[...jl];Ko(b,oe),Ko(a,oe);for(const de of[...H,...Q])Wl[de]||console.error(`Undefined include: ${de}`),Gc[de]||(Gc[de]=[],Ko(Wl[de],Gc[de])),oe=[...oe,...Gc[de]];return{fragmentSource:b=b.replace(w,(de,pe,yt,pt,vt)=>(R[vt]=!0,pe==="define"?`
#ifndef HAS_UNIFORM_u_${vt}
in ${yt} ${pt} ${vt};
#else
uniform ${yt} ${pt} u_${vt};
#endif
`:pe==="initialize"?`
#ifdef HAS_UNIFORM_u_${vt}
    ${yt} ${pt} ${vt} = u_${vt};
#endif
`:pe==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${vt}
    in ${yt} ${pt} ${vt};
#endif
`:pe==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(w,(de,pe,yt,pt,vt)=>{const Dt=pt==="float"?"vec2":pt,At=vt.match(/color/)?"color":Dt;return pe==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${vt}
in ${yt} ${pt} a_${vt};
#endif
`:R[vt]?pe==="define"?`
#ifndef HAS_UNIFORM_u_${vt}
uniform lowp float u_${vt}_t;
in ${yt} ${Dt} a_${vt};
out ${yt} ${pt} ${vt};
#else
uniform ${yt} ${pt} u_${vt};
#endif
`:pe==="initialize"?At==="vec4"?`
#ifndef HAS_UNIFORM_u_${vt}
    ${vt} = a_${vt};
#else
    ${yt} ${pt} ${vt} = u_${vt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${vt}
    ${vt} = unpack_mix_${At}(a_${vt}, u_${vt}_t);
#else
    ${yt} ${pt} ${vt} = u_${vt};
#endif
`:pe==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${vt}
    in ${yt} ${pt} a_${vt};
    out ${yt} ${pt} ${vt};
#endif
`:pe==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${vt}
    ${vt} = a_${vt};
#endif
`:void 0:pe==="define"?`
#ifndef HAS_UNIFORM_u_${vt}
uniform lowp float u_${vt}_t;
in ${yt} ${Dt} a_${vt};
#else
uniform ${yt} ${pt} u_${vt};
#endif
`:pe==="define-instanced"?At==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${vt}0;
in vec4 a_${vt}1;
in vec4 a_${vt}2;
in vec4 a_${vt}3;
#else
uniform ${yt} ${pt} u_${vt};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${yt} ${Dt} a_${vt};
#else
uniform ${yt} ${pt} u_${vt};
#endif
`:pe==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${vt}
    ${yt} ${pt} ${vt} = a_${vt};
#endif
`:At==="vec4"?`
#ifndef HAS_UNIFORM_u_${vt}
    ${yt} ${pt} ${vt} = a_${vt};
#else
    ${yt} ${pt} ${vt} = u_${vt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${vt}
    ${yt} ${pt} ${vt} = unpack_mix_${At}(a_${vt}, u_${vt}_t);
#else
    ${yt} ${pt} ${vt} = u_${vt};
#endif
`}),staticAttributes:P,usedDefines:oe,vertexIncludes:H,fragmentIncludes:Q}}class ql{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,w,P,R,H,Q,oe){this.context=a;let de=this.boundPaintVertexBuffers.length!==P.length;for(let yt=0;!de&&yt<P.length;yt++)this.boundPaintVertexBuffers[yt]!==P[yt]&&(de=!0);let pe=this.boundDynamicVertexBuffers.length!==Q.length;for(let yt=0;!pe&&yt<Q.length;yt++)this.boundDynamicVertexBuffers[yt]!==Q[yt]&&(pe=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==w||de||pe||this.boundIndexBuffer!==R||this.boundVertexOffset!==H)this.freshBind(f,w,P,R,H,Q,oe);else{a.bindVertexArrayOES.set(this.vao);for(const yt of Q)yt&&(yt.bind(),oe&&yt.instanceCount&&yt.setVertexAttribDivisor(a.gl,f,oe));R&&R.dynamicDraw&&R.bind()}}freshBind(a,f,w,P,R,H,Q){const oe=a.numAttributes,de=this.context,pe=de.gl;this.vao&&this.destroy(),this.vao=de.gl.createVertexArray(),de.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=w,this.boundIndexBuffer=P,this.boundVertexOffset=R,this.boundDynamicVertexBuffers=H,f.enableAttributes(pe,a),f.bind(),f.setVertexAttribPointers(pe,a,R);for(const yt of w)yt.enableAttributes(pe,a),yt.bind(),yt.setVertexAttribPointers(pe,a,R);for(const yt of H)yt&&(yt.enableAttributes(pe,a),yt.bind(),yt.setVertexAttribPointers(pe,a,R),Q&&yt.instanceCount&&yt.setVertexAttribDivisor(pe,a,Q));P&&P.bind(),de.currentNumAttributes=oe}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Om(b,a){const f=Math.pow(2,a.canonical.z),w=a.canonical.y;return[new n.ac(0,w/f).toLngLat().lat,new n.ac(0,(w+1)/f).toLngLat().lat]}function zm(b,a,f,w,P,R,H){const Q=b.context,oe=Q.gl,de=f.hillshadeFBO;if(!de)return;b.prepareDrawTile();const pe=b.isTileAffectedByFog(a),yt=b.getOrCreateProgram("hillshade",{overrideFog:pe});Q.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,de.colorAttachment.get());const pt=((Ot,Bt,qt,li)=>{const fi=qt.paint.get("hillshade-shadow-color"),Ti=qt.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",wi=qt.paint.get("hillshade-highlight-color"),vi=qt.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",di=qt.paint.get("hillshade-accent-color"),Ei=qt.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Pi=qt.paint.get("hillshade-emissive-strength");let ji=n.al(qt.paint.get("hillshade-illumination-direction"));if(qt.paint.get("hillshade-illumination-anchor")==="viewport")ji-=Ot.transform.angle;else if(Ot.style&&Ot.style.enable3dLights()&&Ot.style.directionalLight){const or=Ot.style.directionalLight.properties.get("direction"),ar=n.cR(or.x,or.y,or.z);ji=n.al(ar[1])}const Wi=!Ot.options.moving;return{u_matrix:li||Ot.transform.calculateProjMatrix(Bt.tileID.toUnwrapped(),Wi),u_image:0,u_latrange:Om(0,Bt.tileID),u_light:[qt.paint.get("hillshade-exaggeration"),ji],u_shadow:fi.toPremultipliedRenderColor(Ti?null:qt.lut),u_highlight:wi.toPremultipliedRenderColor(vi?null:qt.lut),u_emissive_strength:Pi,u_accent:di.toPremultipliedRenderColor(Ei?null:qt.lut)}})(b,f,w,b.terrain?a.projMatrix:null);b.uploadCommonUniforms(Q,yt,a.toUnwrapped());const{tileBoundsBuffer:vt,tileBoundsIndexBuffer:Dt,tileBoundsSegments:At}=b.getTileBoundsBuffers(f);yt.draw(b,oe.TRIANGLES,P,R,H,fn.disabled,pt,w.id,vt,Dt,At)}function Wu(b,a,f){if(!a.needsDEMTextureUpload)return;const w=b.context,P=w.gl;w.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||b.getTileTexture(f.stride);const R=f.getPixels();a.demTexture?a.demTexture.update(R,{premultiply:!1}):a.demTexture=new n.T(w,R,P.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Bm(b,a,f){const w=b.context,P=w.gl;if(!a.dem)return;const R=a.dem;if(w.activeTexture.set(P.TEXTURE1),Wu(b,a,R),!a.demTexture)return;a.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);const H=R.dim;w.activeTexture.set(P.TEXTURE0);let Q=a.hillshadeFBO;if(!Q){const pt=new n.T(w,{width:H,height:H,data:null},P.RGBA8);pt.bind(P.LINEAR,P.CLAMP_TO_EDGE),Q=a.hillshadeFBO=w.createFramebuffer(H,H,!0,"renderbuffer"),Q.colorAttachment.set(pt.texture)}w.bindFramebuffer.set(Q.framebuffer),w.viewport.set([0,0,H,H]);const{tileBoundsBuffer:oe,tileBoundsIndexBuffer:de,tileBoundsSegments:pe}=b.getMercatorTileBoundsBuffers(),yt=[];b.linearFloatFilteringSupported()&&yt.push("TERRAIN_DEM_FLOAT_FORMAT"),b.getOrCreateProgram("hillshadePrepare",{defines:yt}).draw(b,P.TRIANGLES,Hr.disabled,_n.disabled,In.unblended,fn.disabled,((pt,vt)=>{const Dt=vt.stride,At=n.bz();return n.c5(At,0,n.aj,-8192,0,0,1),n.bo(At,At,[0,-8192,0]),{u_matrix:At,u_image:1,u_dimension:[Dt,Dt],u_zoom:pt.overscaledZ}})(a.tileID,R),f.id,oe,de,pe),a.needsHillshadePrepare=!1}class Ns{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $d extends Ns{getDefault(){return n.am.transparent.toNonPremultipliedRenderColor(null)}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class uf extends Ns{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Nm extends Ns{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Vm extends Ns{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class $m extends Ns{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Um extends Ns{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Ud extends Ns{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Gm extends Ns{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class qu extends Ns{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class Hm extends Ns{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Gd extends Ns{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class hf extends Ns{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Xu extends Ns{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class ff extends Ns{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class vl extends Ns{getDefault(){return n.am.transparent.toNonPremultipliedRenderColor(null)}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Xl extends Ns{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class Zu extends Ns{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Yu extends Ns{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Zl extends Ns{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Hd=class extends Ns{getDefault(){return null}set(b){(b!==this.current||this.dirty)&&(this.gl.useProgram(b),this.current=b,this.dirty=!1)}};class df extends Ns{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class jd extends Ns{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Yl extends Ns{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Ku extends Ns{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ju extends Ns{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class pf extends Ns{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Qu extends Ns{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class jc extends Ns{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class Wd extends Ns{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class qd extends Ns{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Xd extends Ns{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Ua extends Ns{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Zd extends Ua{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Yd extends Ua{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class jm extends Ua{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Wm extends Yd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const mf=(b,a,f)=>({u_matrix:b,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:f}),eh=(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At)=>({u_proj_matrix:Float32Array.from(b),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(w),u_merc_matrix:f,u_zoom_transition:P,u_merc_center:R,u_image0:0,u_frustum_tl:H,u_frustum_tr:Q,u_frustum_br:oe,u_frustum_bl:de,u_globe_pos:pe,u_globe_radius:yt,u_viewport:pt,u_grid_matrix:At?Float32Array.from(At):new Float32Array(9),u_skirt_height:vt,u_far_z_cutoff:Dt});function th(b,a){return b!=null&&a!=null&&!(!b.hasData()||!a.hasData())&&b.demTexture!=null&&a.demTexture!=null&&b.tileID.key!==a.tileID.key}const Ga=new class{constructor(){this.operations={}}newMorphing(b,a,f,w,P){if(b in this.operations){const R=this.operations[b];R.to.tileID.key!==f.tileID.key&&(R.queued=f)}else this.operations[b]={startTime:w,phase:0,duration:P,from:a,to:f,queued:null}}getMorphValuesForProxy(b){if(!(b in this.operations))return null;const a=this.operations[b];return{from:a.from,to:a.to,phase:a.phase}}update(b){for(const a in this.operations){const f=this.operations[a];for(f.phase=(b-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,b)){delete this.operations[a];break}}}_nextOp(b,a){return!!b.queued&&(b.from=b.to,b.to=b.queued,b.queued=null,b.phase=0,b.startTime=a,!0)}_validOp(b){return b.from.hasData()&&b.to.hasData()}},gf={0:null,1:"TERRAIN_VERTEX_MORPHING"};function _f(b,a,f){if(a===0)return 0;const w=a<1&&f===514?.25/a:1;return 6*Math.pow(1.5,22-b)*Math.max(a,1)*w}function qm(b,a){const f=1<<b.z;return!a&&(b.x===0||b.x===f-1)||b.y===0||b.y===f-1}const xl=b=>({u_matrix:b});function bl(b,a,f,w,P){if(P>0){const R=n.q.now(),H=(R-b.timeAdded)/P,Q=a?(R-a.timeAdded)/P:-1,oe=f.getSource(),de=w.coveringZoomLevel({tileSize:oe.tileSize,roundZoom:oe.roundZoom}),pe=!a||Math.abs(a.tileID.overscaledZ-de)>Math.abs(b.tileID.overscaledZ-de),yt=pe&&b.refreshedUponExpiration?1:n.ay(pe?H:1-Q,0,1);return b.refreshedUponExpiration&&H>=1&&(b.refreshedUponExpiration=!1),a?{opacity:1,mix:1-yt}:{opacity:yt,mix:0}}return{opacity:1,mix:0}}class Kd extends Lo{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},w=new n.D(n.c$(),null),P=Tc("mock-dem",f,w,a.style);super("mock-dem",P,!1),P.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class jo extends Lo{constructor(a){const f=Tc("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new n.D(n.c$(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,w){if(a.freezeTileCoverage)return;this.transform=a;const P=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((R,H)=>{if(R[H.key]="",!this._tiles[H.key]){const Q=new ll(H,this._source.tileSize*H.overscaleFactor(),a.tileZoom,void 0,void 0,this._source.worldview);Q.state="loaded",this._tiles[H.key]=Q}return R},{});for(const R in this._tiles)R in P||(this.freeFBO(R),this._tiles[R].unloadVectorData(),delete this._tiles[R])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const w=Object.values(f);this.renderCachePool.push(...w),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ih extends n.aM{constructor(a,f,w){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=w}}class Wc extends n.dt{constructor(a,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[w,P,R]=function(oe){const de=new n.ba,pe=new n.a_,yt=131;de.reserve(17161),pe.reserve(33800);const pt=n.aj/128,vt=n.aj+pt/2,Dt=vt+pt;for(let Ot=-64;Ot<Dt;Ot+=pt)for(let Bt=-64;Bt<Dt;Bt+=pt){const qt=Bt<0||Bt>vt||Ot<0||Ot>vt?24575:0,li=n.ay(Math.round(Bt),0,n.aj),fi=n.ay(Math.round(Ot),0,n.aj);de.emplaceBack(li+qt,fi)}const At=(Ot,Bt)=>{const qt=Bt*yt+Ot;pe.emplaceBack(qt+1,qt,qt+yt),pe.emplaceBack(qt+yt,qt+yt+1,qt+1)};for(let Ot=1;Ot<129;Ot++)for(let Bt=1;Bt<129;Bt++)At(Bt,Ot);return[0,129].forEach(Ot=>{for(let Bt=0;Bt<130;Bt++)At(Bt,Ot),At(Ot,Bt)}),[de,pe,32768]}(),H=a.context;this.gridBuffer=H.createVertexBuffer(w,n.bc.members),this.gridIndexBuffer=H.createIndexBuffer(P),this.gridSegments=n.bd.simpleSegment(0,0,w.length,P.length),this.gridNoSkirtSegments=n.bd.simpleSegment(0,0,w.length,R),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jo(f.map),this.orthoMatrix=n.bz(),n.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.aj,0,n.aj,0,1);const Q=H.gl;this._overlapStencilMode=new _n({func:Q.GEQUAL,mask:255},0,255,Q.KEEP,Q.KEEP,Q.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Kd(f.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,f,w){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const P=a.terrain.properties,R=a.terrain.drapeRenderMode===0,H=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const Q=a.terrain&&a.terrain.scope,oe=P.get("source"),de=R?this._mockSourceCache:a.getSourceCache(oe,Q);if(!de)return void n.w(`Couldn't find terrain source "${oe}".`);if(this.sourceCache=de,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=H?this.calculateExaggeration(f):P.get("exaggeration"),!f.projection.requiresDraping&&H&&this._exaggeration===0)return void this._disable();this.enabled=!0;const pe=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const yt=this.getScaledDemTileSize();this.sourceCache.update(f,yt,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,pe(),this._initializing=!0),pe(),f.updateElevation(!0,w),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const f=this._previousCameraAltitude,w=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=w;const P=f!=null?w-f:Number.MAX_VALUE;if(Math.abs(P)<2)return this._exaggeration;const R=a.zoom,H=this._style.terrain;if(!this._previousUpdateTimestamp)return H.getExaggeration(R);let Q=R-this._previousZoom;const oe=this._previousUpdateTimestamp;let de=R;this._evaluationZoom!=null&&(de=this._evaluationZoom,Math.abs(R-de)>.5&&(Q=.5*(R-de+Q)),Q*P<0&&(de+=Q)),this._evaluationZoom=de;const pe=H.getExaggeration(de),yt=pe===H.getExaggeration(Math.max(0,de-.1));if(yt&&Math.abs(pe-this._exaggeration)<.01)return pe;let pt=Math.min(.1,.00375*(this._updateTimestamp-oe));return(yt||pe<.1||Math.abs(Q)<1e-4)&&(pt=Math.min(.2,4*pt)),n.ai(this._exaggeration,pe,pt)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,w=this.painter.transform;this._initializing&&(this._initializing=w._centerAltitude===0&&this.getAtPointOrZero(n.ac.fromLngLat(w.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const P=this.proxyCoords=f.getIds().map(oe=>{const de=f.getTileByID(oe).tileID;return de.projMatrix=w.calculateProjMatrix(de.toUnwrapped()),de});(function(oe,de){const pe=de.transform.pointCoordinate(de.transform.getCameraPoint()),yt=new n.P(pe.x,pe.y);oe.sort((pt,vt)=>{if(vt.overscaledZ-pt.overscaledZ)return vt.overscaledZ-pt.overscaledZ;const Dt=new n.P(pt.canonical.x+(1<<pt.canonical.z)*pt.wrap,pt.canonical.y),At=new n.P(vt.canonical.x+(1<<vt.canonical.z)*vt.wrap,vt.canonical.y),Ot=yt.mult(1<<pt.canonical.z);return Ot.x-=.5,Ot.y-=.5,Ot.distSqr(Dt)-Ot.distSqr(At)})})(P,this.painter);const R=this.proxyToSource||{};this.proxyToSource={},P.forEach(oe=>{this.proxyToSource[oe.key]={}}),this.terrainTileForTile={};const H=this._style._mergedSourceCaches;for(const oe in H){const de=H[oe];if(!de.used||(de!==this.sourceCache&&this.resetTileLookupCache(de.id),this._setupProxiedCoordsForOrtho(de,a[oe],R),de.usedForTerrain))continue;const pe=a[oe];de.getSource().reparseOverscaled&&this._assignTerrainTiles(pe)}this.proxiedCoords[f.id]=P.map(oe=>new ih(oe,oe.key,this.orthoMatrix)),this._assignTerrainTiles(P),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(R),this.renderingToTexture=!1;const Q={};this._visibleDemTiles=[];for(const oe of this.proxyCoords){const de=this.terrainTileForTile[oe.key];if(!de)continue;const pe=de.tileID.key;pe in Q||(this._visibleDemTiles.push(de),Q[pe]=pe)}}_assignTerrainTiles(a){this._initializing||a.forEach(f=>{if(this.terrainTileForTile[f.key])return;const w=this._findTileCoveringTileID(f,this.sourceCache);w&&(this.terrainTileForTile[f.key]=w)})}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const w in this.terrainTileForTile){const P=this.terrainTileForTile[w],R=P.dem;!R||P.demTexture&&!P.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),Wu(this.painter,P,R))}}_prepareDemTileUniforms(a,f,w,P){if(!f||f.demTexture==null)return!1;const R=a.tileID.canonical,H=Math.pow(2,f.tileID.canonical.z-R.z),Q=P||"";return w[`u_dem_tl${Q}`]=[R.x*H%1,R.y*H%1],w[`u_dem_scale${Q}`]=H,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const f=this._visibleDemTiles.reduce((w,P)=>{if(!P.dem)return w;const R=P.dem.tree.minimums[0];return R>0&&a++,w+R},0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const w=this._getLoadedAreaMinimum(),P=new n.du({width:1,height:1},new Float32Array([w]));this._emptyDEMTextureDirty=!1;let R=this._emptyDEMTexture;return R?R.update(P,{premultiply:!1}):R=this._emptyDEMTexture=new n.T(a,P,f.R32F,{premultiply:!1}),R}setupElevationDraw(a,f,w){const P=this.painter.context,R=P.gl,H={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};H.u_exaggeration=this.exaggeration();let Q=null,oe=null,de=1;if(w&&w.morphing&&this._useVertexMorphing){const vt=w.morphing.srcDemTile,Dt=w.morphing.dstDemTile;de=w.morphing.phase,vt&&Dt&&(this._prepareDemTileUniforms(a,vt,H,"_prev")&&(oe=vt),this._prepareDemTileUniforms(a,Dt,H)&&(Q=Dt))}const pe=vt=>vt&&vt.demTexture&&this.painter.linearFloatFilteringSupported()?R.LINEAR:R.NEAREST;let yt=null;var pt;if(this.enabled?oe&&Q?(yt=Q.demTexture,P.activeTexture.set(R.TEXTURE4),oe.demTexture.bind(pe(oe),R.CLAMP_TO_EDGE),H.u_dem_lerp=de):(Q=this.terrainTileForTile[a.tileID.key],yt=this._prepareDemTileUniforms(a,Q,H)?Q.demTexture:this.emptyDEMTexture):yt=this.emptyDEMTexture,P.activeTexture.set(R.TEXTURE2),yt&&(H.u_dem_size=(pt=yt).size[0]===1?1:pt.size[0]-2,yt.bind(pe(Q),R.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(w&&w.useDepthForOcclusion,f,H),w&&w.useMeterToDem&&Q){const vt=(1<<Q.tileID.canonical.z)*n.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;H.u_meter_to_dem=vt}if(w&&w.labelPlaneMatrixInv&&(H.u_label_plane_matrix_inv=w.labelPlaneMatrixInv),f.setTerrainUniformValues(P,H),this.painter.transform.projection.name==="globe"){const vt=this.globeUniformValues(this.painter.transform,a.tileID.canonical,w&&w.useDenormalizedUpVectorScale);f.setGlobeUniformValues(P,vt)}}globeUniformValues(a,f,w){const P=a.projection;return{u_tile_tl_up:P.upVector(f,0,0),u_tile_tr_up:P.upVector(f,n.aj,0),u_tile_br_up:P.upVector(f,n.aj,n.aj),u_tile_bl_up:P.upVector(f,0,n.aj),u_tile_up_scale:w?n.dv(1):P.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,w=this.painter.context;a.length!==0&&(w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(P,R,H,Q,oe){if(P.transform.projection.name==="globe")(function(de,pe,yt,pt,vt){const Dt=de.context,At=Dt.gl;let Ot,Bt;const qt=de.transform,li=n.dl(de,Dt,qt),fi=(or,ar)=>{if(Bt===ar)return;const vr=[gf[ar],"PROJECTION_GLOBE_VIEW"];li&&vr.push("CUSTOM_ANTIALIASING");const Ui=de.isTileAffectedByFog(or);Ot=de.getOrCreateProgram("globeRaster",{defines:vr,overrideFog:Ui}),Bt=ar},Ti=de.colorModeForRenderPass(),wi=new Hr(At.LEQUAL,Hr.ReadWrite,de.depthRangeFor3D);Ga.update(vt);const vi=n.dm(qt),di=[n.aD(qt.center.lng),n.aH(qt.center.lat)],Ei=de.globeSharedBuffers,Pi=[qt.width*n.q.devicePixelRatio,qt.height*n.q.devicePixelRatio],ji=Float32Array.from(qt.globeMatrix),Wi={useDenormalizedUpVectorScale:!0};{const or=de.transform,ar=_f(or.zoom,pe.exaggeration(),pe.sourceCache._source.tileSize);Bt=-1;const vr=At.TRIANGLES;for(const Ui of pt){const Ji=yt.getTile(Ui),zi=_n.disabled,ur=pe.prevTerrainTileForTile[Ui.key],Zi=pe.terrainTileForTile[Ui.key];th(ur,Zi)&&Ga.newMorphing(Ui.key,ur,Zi,vt,250),Dt.activeTexture.set(At.TEXTURE0),Ji.texture&&Ji.texture.bind(At.LINEAR,At.CLAMP_TO_EDGE);const gr=Ga.getMorphValuesForProxy(Ui.key),kr=gr?1:0;gr&&n.L(Wi,{morphing:{srcDemTile:gr.from,dstDemTile:gr.to,phase:n.dk(gr.phase)}});const cr=n.dn(Ui.canonical),Pr=n.dp(cr.getCenter().lat),Wr=n.dq(Ui.canonical,cr,Pr,or.worldSize/or._pixelsPerMercatorPixel),qr=n.bh(n.dr(Ui.canonical)),Ur=eh(or.expandedFarZProjMatrix,ji,vi,qr,n.ah(or.zoom),di,or.frustumCorners.TL,or.frustumCorners.TR,or.frustumCorners.BR,or.frustumCorners.BL,or.globeCenterInViewSpace,or.globeRadius,Pi,ar,or._farZ,Wr);if(fi(Ui,kr),Ot&&(pe.setupElevationDraw(Ji,Ot,Wi),de.uploadCommonUniforms(Dt,Ot,Ui.toUnwrapped()),Ei)){const[Qr,nn,ln]=Ei.getGridBuffers(Pr,ar!==0);Ot.draw(de,vr,wi,zi,Ti,fn.backCCW,Ur,"globe_raster",Qr,nn,ln)}}}if(Ei&&(de.renderDefaultNorthPole||de.renderDefaultSouthPole)){const or=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];li&&or.push("CUSTOM_ANTIALIASING"),Ot=de.getOrCreateProgram("globeRaster",{defines:or});for(const ar of pt){const{x:vr,y:Ui,z:Ji}=ar.canonical,zi=Ui===0,ur=Ui===(1<<Ji)-1,[Zi,gr,kr,cr]=Ei.getPoleBuffers(Ji,!1);if(cr&&(zi||ur)){const Pr=yt.getTile(ar);Dt.activeTexture.set(At.TEXTURE0),Pr.texture&&Pr.texture.bind(At.LINEAR,At.CLAMP_TO_EDGE);let Wr=n.ds(Ji,vr,qt);const qr=n.bh(n.dr(ar.canonical)),Ur=(Qr,nn)=>Qr.draw(de,At.TRIANGLES,wi,_n.disabled,Ti,fn.disabled,eh(qt.expandedFarZProjMatrix,Wr,Wr,qr,0,di,qt.frustumCorners.TL,qt.frustumCorners.TR,qt.frustumCorners.BR,qt.frustumCorners.BL,qt.globeCenterInViewSpace,qt.globeRadius,Pi,0,qt._farZ),"globe_pole_raster",nn,kr,cr);pe.setupElevationDraw(Pr,Ot,Wi),de.uploadCommonUniforms(Dt,Ot,ar.toUnwrapped()),zi&&de.renderDefaultNorthPole&&Ur(Ot,Zi),ur&&de.renderDefaultSouthPole&&(Wr=n.cE(n.bz(),Wr,[1,-1,1]),Ur(Ot,gr))}}}})(P,R,H,Q,oe);else{const de=P.context,pe=de.gl;let yt,pt;const vt=P.shadowRenderer,Dt=fa(P,P.longestCutoffRange),At=Ti=>{if(pt===Ti)return;const wi=[];wi.push(gf[Ti]),Dt.shouldRenderCutoff&&wi.push("RENDER_CUTOFF"),vt&&(wi.push("RENDER_SHADOWS","DEPTH_TEXTURE"),vt.useNormalOffset&&wi.push("NORMAL_OFFSET")),yt=P.getOrCreateProgram("terrainRaster",{defines:wi}),pt=Ti},Ot=P.colorModeForRenderPass(),Bt=new Hr(pe.LEQUAL,Hr.ReadWrite,P.depthRangeFor3D);Ga.update(oe);const qt=P.transform,li=_f(qt.zoom,R.exaggeration(),R.sourceCache._source.tileSize);let fi=[0,0,0];if(vt){const Ti=P.style.directionalLight,wi=P.style.ambientLight;Ti&&wi&&(fi=_l(P.style,Ti,wi))}{pt=-1;const Ti=pe.TRIANGLES,[wi,vi]=[R.gridIndexBuffer,R.gridSegments];for(const di of Q){const Ei=H.getTile(di),Pi=_n.disabled,ji=R.prevTerrainTileForTile[di.key],Wi=R.terrainTileForTile[di.key];th(ji,Wi)&&Ga.newMorphing(di.key,ji,Wi,oe,250),de.activeTexture.set(pe.TEXTURE0),Ei.texture&&Ei.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);const or=Ga.getMorphValuesForProxy(di.key),ar=or?1:0;let vr;or&&(vr={morphing:{srcDemTile:or.from,dstDemTile:or.to,phase:n.dk(or.phase)}});const Ui=mf(di.projMatrix,qm(di.canonical,qt.renderWorldCopies)?li/10:li,fi);if(At(ar),!yt)continue;R.setupElevationDraw(Ei,yt,vr);const Ji=di.toUnwrapped();vt&&vt.setupShadows(Ji,yt),P.uploadCommonUniforms(de,yt,Ji,null,Dt),yt.draw(P,Ti,Bt,Pi,Ot,fn.backCCW,Ui,"terrain_raster",R.gridBuffer,wi,vi)}}}}(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,w=this.painter.context,P=this.proxySourceCache,R=this.proxiedCoords[P.id],H=this._drapedRenderBatches.shift(),Q=f.style.order,oe=[];let de=0;for(const pe of R){const yt=P.getTileByID(pe.proxyTileKey),pt=P.proxyCachedFBO[pe.key]?P.proxyCachedFBO[pe.key][a]:void 0,vt=pt!==void 0?P.renderCache[pt]:this.pool[de++],Dt=pt!==void 0;if(yt.texture=vt.tex,Dt&&!vt.dirty){oe.push(yt.tileID);continue}let At;w.bindFramebuffer.set(vt.fb.framebuffer),this.renderedToTile=!1,vt.dirty&&(w.clear({color:n.am.transparent,stencil:0}),vt.dirty=!1);for(let Ot=H.start;Ot<=H.end;++Ot){const Bt=f.style._mergedLayers[Q[Ot]];if(Bt.isHidden(f.transform.zoom))continue;const qt=f.style.getLayerSourceCache(Bt),li=qt?this.proxyToSource[pe.key][qt.id]:[pe];if(!li)continue;const fi=li;w.viewport.set([0,0,vt.fb.width,vt.fb.height]),At!==(qt?qt.id:null)&&(this._setupStencil(vt,li,Bt,qt),At=qt?qt.id:null),f.renderLayer(f,qt,Bt,fi)}if(this._drapedRenderBatches.length===0)for(const Ot of this._pendingGroundEffectLayers){const Bt=f.style._mergedLayers[Q[Ot]];if(Bt.isHidden(f.transform.zoom))continue;const qt=f.style.getLayerSourceCache(Bt),li=qt?this.proxyToSource[pe.key][qt.id]:[pe];if(!li)continue;const fi=li;w.viewport.set([0,0,vt.fb.width,vt.fb.height]),At!==(qt?qt.id:null)&&(this._setupStencil(vt,li,Bt,qt),At=qt?qt.id:null),f.renderLayer(f,qt,Bt,fi)}this.renderedToTile?(vt.dirty=!0,oe.push(yt.tileID)):Dt||--de,de===5&&(de=0,this.renderToBackBuffer(oe))}return this.renderToBackBuffer(oe),this.renderingToTexture=!1,w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height]),H.end+1}postRender(){}isLayerOrderingCorrect(a){const f=a.order.length;let w=-1,P=f;for(let R=0;R<f;++R)this._style.isLayerDraped(a._mergedLayers[a.order[R]])?w=Math.max(w,R):P=Math.min(P,R);return P>w}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{a=Math.min(a,f.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,f,w){if(!this._visibleDemTiles)return null;const P=this._visibleDemTiles.filter(R=>R.dem).map(R=>{const H=R.tileID,Q=1<<H.overscaledZ,{x:oe,y:de}=H.canonical,pe=oe/Q,yt=(oe+1)/Q,pt=de/Q,vt=(de+1)/Q;return{minx:pe,miny:pt,maxx:yt,maxy:vt,t:R.dem.tree.raycastRoot(pe,pt,yt,vt,a,f,w),tile:R}});P.sort((R,H)=>(R.t!==null?R.t:Number.MAX_VALUE)-(H.t!==null?H.t:Number.MAX_VALUE));for(const R of P){if(R.t==null)return null;const H=R.tile.dem.tree.raycast(R.minx,R.miny,R.maxx,R.maxy,a,f,w);if(H!=null)return H}return null}_createFBO(){const a=this.painter.context,f=a.gl,w=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const P=new n.T(a,{width:w[0],height:w[1],data:null},f.RGBA8);P.bind(f.LINEAR,f.CLAMP_TO_EDGE);const R=a.createFramebuffer(w[0],w[1],!0,null);return R.colorAttachment.set(P.texture),R.depthAttachment=new Wm(a,R.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,w[0],w[1]),this._stencilRef=0,R.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):R.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:R,tex:P,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const f=this._style._mergedLayers[a],w=f.isHidden(this.painter.transform.zoom);return f.type==="hillshade"||f.type==="custom"?!w&&f.shouldRedrape():!w&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const w of this._style.getSources())if(w instanceof Sc){a=!0;break}if(!a)return;const f={};for(let w=0;w<this._style.order.length;++w){const P=this._style._mergedLayers[this._style.order[w]],R=this._style.getLayerSourceCache(P);if(R&&!f[R.id]&&!P.isHidden(this.painter.transform.zoom)&&P.type==="line"&&P.widthExpression()instanceof n.ab){f[R.id]=!0;for(const H of this.proxyCoords){const Q=this.proxyToSource[H.key][R.id];if(Q)for(const oe of Q)this._clearRenderCacheForTile(R.id,oe)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const w in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[w]._source instanceof po){a=!0;break}if(!a)return;const f={};for(let w=0;w<this._style.order.length;++w){const P=this._style._mergedLayers[this._style.order[w]],R=this._style.getLayerSourceCache(P);if(!R||f[R.id]||P.isHidden(this.painter.transform.zoom)||P.type!=="raster")continue;const H=P.paint.get("raster-fade-duration");for(const Q of this.proxyCoords){const oe=this.proxyToSource[Q.key][R.id];if(oe)for(const de of oe){const pe=bl(R.getTile(de),R.findLoadedParent(de,0),R,this.painter.transform,H);(pe.opacity!==1||pe.mix!==0)&&this._clearRenderCacheForTile(R.id,de)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,f=a.length;if(f===0)return;const w=[];this._pendingGroundEffectLayers=[];let P,R=0,H=this._style._mergedLayers[a[R]];for(;!this._style.isLayerDraped(H)&&H.isHidden(this.painter.transform.zoom)&&++R<f;)H=this._style._mergedLayers[a[R]];for(;R<f;++R){const Q=this._style._mergedLayers[a[R]];Q.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Q)?P===void 0&&(P=R):(Q.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(R),P!==void 0&&(w.push({start:P,end:R-1}),P=void 0)))}if(P!==void 0&&w.push({start:P,end:R-1}),w.length!==0){const Q=w[w.length-1];this._pendingGroundEffectLayers.every(oe=>oe>Q.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=w}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const H=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let Q=0;Q<H.length;++Q){const oe=Object.values(H[Q]);f.renderCachePool.push(...oe)}}return}this._clearRasterLayersFromRenderCache();const w=this.proxyCoords,P=this._tilesDirty;for(let H=w.length-1;H>=0;H--){const Q=w[H];if(f.getTileByID(Q.key),f.proxyCachedFBO[Q.key]!==void 0){const oe=a[Q.key],de=this.proxyToSource[Q.key];let pe=0;for(const yt in de){const pt=de[yt],vt=oe[yt];if(!vt||vt.length!==pt.length||pt.some((Dt,At)=>Dt!==vt[At]||P[yt]&&P[yt].hasOwnProperty(Dt.key))){pe=-1;break}++pe}for(const yt in f.proxyCachedFBO[Q.key])f.renderCache[f.proxyCachedFBO[Q.key][yt]].dirty=pe<0||pe!==Object.values(oe).length}}const R=[...this._drapedRenderBatches];R.sort((H,Q)=>Q.end-Q.start-(H.end-H.start));for(const H of R)for(const Q of w){if(f.proxyCachedFBO[Q.key])continue;let oe=f.renderCachePool.pop();oe===void 0&&f.renderCache.length<50&&(oe=f.renderCache.length,f.renderCache.push(this._createFBO())),oe!==void 0&&(f.proxyCachedFBO[Q.key]={},f.proxyCachedFBO[Q.key][H.start]=oe,f.renderCache[oe].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,w,P){if(!P||!this._sourceTilesOverlap[P.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const R=this.painter.context,H=R.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let Q;if(w.isTileClipped())Q=f.length,this._overlapStencilMode.test={func:H.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);Q=1,this._overlapStencilMode.test={func:H.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+Q>255&&(R.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=Q,this._overlapStencilMode.ref=this._stencilRef,w.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):_n.disabled}_renderTileClippingMasks(a,f){const w=this.painter,P=this.painter.context,R=P.gl;w._tileClippingMaskIDs={},P.setColorMode(In.disabled),P.setDepthMode(Hr.disabled);const H=w.getOrCreateProgram("clippingMask");for(const Q of a){const oe=w._tileClippingMaskIDs[Q.key]=--f;H.draw(w,R.TRIANGLES,Hr.disabled,new _n({func:R.ALWAYS,mask:0},oe,255,R.KEEP,R.KEEP,R.REPLACE),In.disabled,fn.disabled,xl(Q.projMatrix),"$clipping",w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const w=[a.x,a.y,1,1];n.aA(w,w,f.pixelMatrixInverse),n.cw(w,w,1/w[3]),w[0]/=f.worldSize,w[1]/=f.worldSize;const P=f._camera.position,R=n.c6(1,f.center.lat),H=[P[0],P[1],P[2]/R,0],Q=n.cX([],w.slice(0,3),H);n.au(Q,Q);const oe=this.raycast(H,Q,this._exaggeration);return oe!==null&&oe?(n.bE(H,H,Q,oe),H[3]=H[2],H[2]*=R,H):null}_setupProxiedCoordsForOrtho(a,f,w){if(a.getSource()instanceof n.aP)return this._setupProxiedCoordsForImageSource(a,f,w);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const P=this.proxiedCoords[a.id]=[],R=this.proxyCoords;for(let oe=0;oe<R.length;oe++){const de=R[oe],pe=this._findTileCoveringTileID(de,a);if(pe){const yt=this._createProxiedId(de,pe,w[de.key]&&w[de.key][a.id]);P.push(yt),this.proxyToSource[de.key][a.id]=[yt]}}let H=!1;const Q=new Set;for(let oe=0;oe<f.length;oe++){const de=a.getTile(f[oe]);if(!de||!de.hasData())continue;const pe=this._findTileCoveringTileID(de.tileID,this.proxySourceCache);if(pe&&pe.tileID.canonical.z!==de.tileID.canonical.z){const yt=this.proxyToSource[pe.tileID.key][a.id],pt=this._createProxiedId(pe.tileID,de,w[pe.tileID.key]&&w[pe.tileID.key][a.id]);yt?yt.splice(yt.length-1,0,pt):this.proxyToSource[pe.tileID.key][a.id]=[pt];const vt=this.proxyToSource[pe.tileID.key][a.id];Q.has(vt)||Q.add(vt),P.push(pt),H=!0}}if(this._sourceTilesOverlap[a.id]=H,H&&this._debugParams.sortTilesHiZFirst)for(const oe of Q)oe.sort((de,pe)=>pe.overscaledZ-de.overscaledZ)}_setupProxiedCoordsForImageSource(a,f,w){if(!a.getSource().loaded())return;const P=this.proxiedCoords[a.id]=[],R=this.proxyCoords,H=a.getSource(),Q=H.tileID;if(!Q)return;const oe=new n.P(Q.x,Q.y)._div(1<<Q.z),de=H.coordinates.map(n.ac.fromLngLat).reduce((yt,pt)=>(yt.min.x=Math.min(yt.min.x,pt.x-oe.x),yt.min.y=Math.min(yt.min.y,pt.y-oe.y),yt.max.x=Math.max(yt.max.x,pt.x-oe.x),yt.max.y=Math.max(yt.max.y,pt.y-oe.y),yt),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),pe=(yt,pt)=>{const vt=yt.wrap+yt.canonical.x/(1<<yt.canonical.z),Dt=yt.canonical.y/(1<<yt.canonical.z),At=n.aj/(1<<yt.canonical.z),Ot=pt.wrap+pt.canonical.x/(1<<pt.canonical.z),Bt=pt.canonical.y/(1<<pt.canonical.z);return vt+At<Ot+de.min.x||vt>Ot+de.max.x||Dt+At<Bt+de.min.y||Dt>Bt+de.max.y};for(let yt=0;yt<R.length;yt++){const pt=R[yt];for(let vt=0;vt<f.length;vt++){const Dt=a.getTile(f[vt]);if(!Dt||!Dt.hasData()||pe(pt,Dt.tileID))continue;const At=this._createProxiedId(pt,Dt,w[pt.key]&&w[pt.key][a.id]),Ot=this.proxyToSource[pt.key][a.id];Ot?Ot.push(At):this.proxyToSource[pt.key][a.id]=[At],P.push(At)}}}_createProxiedId(a,f,w){let P=this.orthoMatrix;if(w){const R=w.find(H=>H.key===f.tileID.key);if(R)return R}if(f.tileID.key!==a.key){const R=a.canonical.z-f.tileID.canonical.z;let H,Q,oe;P=n.bz();const de=f.tileID.wrap-a.wrap<<a.overscaledZ;R>0?(H=n.aj>>R,Q=H*((f.tileID.canonical.x<<R)-a.canonical.x+de),oe=H*((f.tileID.canonical.y<<R)-a.canonical.y)):(H=n.aj<<-R,Q=n.aj*(f.tileID.canonical.x-(a.canonical.x+de<<-R)),oe=n.aj*(f.tileID.canonical.y-(a.canonical.y<<-R))),n.c5(P,0,H,0,H,0,1),n.bo(P,P,[Q,oe,0])}return new ih(f.tileID,a.key,P)}_findTileCoveringTileID(a,f){let w=f.getTile(a);if(w&&w.hasData())return w;const P=this._findCoveringTileCache[f.id],R=P[a.key];if(w=R?f.getTileByID(R):null,w&&w.hasData()||R===null)return w;let H=w?w.tileID:a,Q=H.overscaledZ;const oe=f.getSource().minzoom,de=[];if(!R){const yt=f.getSource().maxzoom;if(a.canonical.z>=yt){const pt=a.canonical.z-yt;f.getSource().reparseOverscaled?(Q=Math.max(a.canonical.z+2,f.transform.tileZoom),H=new n.aM(Q,a.wrap,yt,a.canonical.x>>pt,a.canonical.y>>pt)):pt!==0&&(Q=yt,H=new n.aM(Q,a.wrap,yt,a.canonical.x>>pt,a.canonical.y>>pt))}H.key!==a.key&&(de.push(H.key),w=f.getTile(H))}const pe=yt=>{de.forEach(pt=>{P[pt]=yt}),de.length=0};for(Q-=1;Q>=oe&&(!w||!w.hasData());Q--){w&&pe(w.tileID.key);const yt=H.calculateScaledKey(Q);if(w=f.getTileByID(yt),w&&w.hasData())break;const pt=P[yt];if(pt===null)break;pt===void 0?de.push(yt):w=f.getTileByID(pt)}return pe(w?w.tileID.key:null),w&&w.hasData()?w:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let w=this._tilesDirty[a];w||(w=this._tilesDirty[a]={}),w[f.key]=!0}}function rh(b,a,f){const w=function(Q,oe,de){const pe=n.bG(oe,Q),yt=n.bG(de,[.2126,.7152,.0722]),pt=(Dt,At,Ot)=>(1-Ot)*Dt+Ot*At,vt=pt(1-.3*Math.min(yt,1),1,Math.min(pe+1,1));return pt(.92,1,Math.asin(n.ay(oe[2],-1,1))/Math.PI+.5)*vt}(b,[0,0,1],a),P=[0,0,0];n.bY(P,f.slice(0,3),w);const R=[0,0,0];n.bY(R,a.slice(0,3),b[2]);const H=[0,0,0];return n.cV(H,P,R),n.cY(H)}const yf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],vf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class nh{static cacheKey(a,f,w,P){let R=`${f}${P?P.cacheKey:""}`;for(const H of w)a.usedDefines.includes(H)&&(R+=`/${H}`);return R}constructor(a,f,w,P,R,H){const Q=a.gl;this.program=Q.createProgram(),this.configuration=P,this.name=f,this.fixedDefines=[...H];const oe=P?P.getBinderAttributes():[],de=(w.staticAttributes||[]).concat(oe);let pe=P?P.defines():[];pe=pe.concat(H.map(Ot=>`#define ${Ot}`));const yt=`#version 300 es
`;let pt=yt+pe.concat("precision mediump float;",da,Hc.fragmentSource).join(`
`);for(const Ot of w.fragmentIncludes)pt+=`
${Wl[Ot]}`;pt+=`
${w.fragmentSource}`;let vt=yt+pe.concat("precision highp float;",da,Hc.vertexSource).join(`
`);for(const Ot of w.vertexIncludes)vt+=`
${Wl[Ot]}`;this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&w.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(vt+=`
uniform int u_instanceID;
`),vt+=`
${w.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(vt=vt.replaceAll("gl_InstanceID","u_instanceID"));const Dt=Q.createShader(Q.FRAGMENT_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);Q.shaderSource(Dt,pt),Q.compileShader(Dt),Q.attachShader(this.program,Dt);const At=Q.createShader(Q.VERTEX_SHADER);if(Q.isContextLost())this.failedToCreate=!0;else{Q.shaderSource(At,vt),Q.compileShader(At),Q.attachShader(this.program,At),this.attributes={},this.numAttributes=de.length;for(let Ot=0;Ot<this.numAttributes;Ot++)if(de[Ot]){const Bt=de[Ot].startsWith("a_")?de[Ot]:`a_${de[Ot]}`;Q.bindAttribLocation(this.program,Ot,Bt),this.attributes[Bt]=Ot}Q.linkProgram(this.program),Q.deleteShader(At),Q.deleteShader(Dt),this.fixedUniforms=R(a),this.binderUniforms=P?P.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Ot=>({u_instanceID:new n.c8(Ot)}))(a)),(H.includes("TERRAIN")||f.indexOf("symbol")!==-1||f.indexOf("circle")!==-1)&&(this.terrainUniforms=(Ot=>({u_dem:new n.c8(Ot),u_dem_prev:new n.c8(Ot),u_dem_tl:new n.cb(Ot),u_dem_scale:new n.ca(Ot),u_dem_tl_prev:new n.cb(Ot),u_dem_scale_prev:new n.ca(Ot),u_dem_size:new n.ca(Ot),u_dem_lerp:new n.ca(Ot),u_exaggeration:new n.ca(Ot),u_depth:new n.c8(Ot),u_depth_size_inv:new n.cb(Ot),u_depth_range_unpack:new n.cb(Ot),u_occluder_half_size:new n.ca(Ot),u_occlusion_depth_offset:new n.ca(Ot),u_meter_to_dem:new n.ca(Ot),u_label_plane_matrix_inv:new n.cc(Ot)}))(a)),H.includes("GLOBE")&&(this.globeUniforms=(Ot=>({u_tile_tl_up:new n.c9(Ot),u_tile_tr_up:new n.c9(Ot),u_tile_br_up:new n.c9(Ot),u_tile_bl_up:new n.c9(Ot),u_tile_up_scale:new n.ca(Ot)}))(a)),H.includes("FOG")&&(this.fogUniforms=(Ot=>({u_fog_matrix:new n.cc(Ot),u_fog_range:new n.cb(Ot),u_fog_color:new n.cQ(Ot),u_fog_horizon_blend:new n.ca(Ot),u_fog_vertical_limit:new n.cb(Ot),u_fog_temporal_offset:new n.ca(Ot),u_frustum_tl:new n.c9(Ot),u_frustum_tr:new n.c9(Ot),u_frustum_br:new n.c9(Ot),u_frustum_bl:new n.c9(Ot),u_globe_pos:new n.c9(Ot),u_globe_radius:new n.ca(Ot),u_globe_transition:new n.ca(Ot),u_is_globe:new n.c8(Ot),u_viewport:new n.cb(Ot)}))(a)),H.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Ot=>({u_cutoff_params:new n.cQ(Ot)}))(a)),H.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Ot=>({u_lighting_ambient_color:new n.c9(Ot),u_lighting_directional_dir:new n.c9(Ot),u_lighting_directional_color:new n.c9(Ot),u_ground_radiance:new n.c9(Ot)}))(a)),H.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Ot=>({u_light_matrix_0:new n.cc(Ot),u_light_matrix_1:new n.cc(Ot),u_fade_range:new n.cb(Ot),u_shadow_normal_offset:new n.c9(Ot),u_shadow_intensity:new n.ca(Ot),u_shadow_texel_size:new n.ca(Ot),u_shadow_map_resolution:new n.ca(Ot),u_shadow_direction:new n.c9(Ot),u_shadow_bias:new n.c9(Ot),u_shadowmap_0:new n.c8(Ot),u_shadowmap_1:new n.c8(Ot)}))(a))}}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const w=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const P in f)w[P]&&w[P].set(this.program,P,f[P])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const w=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const P in f)w[P]&&w[P].set(this.program,P,f[P])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const w=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const P in f)w[P].set(this.program,P,f[P])}}setCutoffUniformValues(a,f){if(!this.cutoffUniforms)return;const w=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const P in f)w[P].set(this.program,P,f[P])}}setLightsUniformValues(a,f){if(!this.lightsUniforms)return;const w=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const P in f)w[P].set(this.program,P,f[P])}}setShadowUniformValues(a,f){if(this.failedToCreate||!this.shadowUniforms)return;const w=this.shadowUniforms;a.program.set(this.program);for(const P in f)w[P].set(this.program,P,f[P])}_drawDebugWireframe(a,f,w,P,R,H,Q,oe,de,pe){const yt=a.options.wireframe;if(yt.terrain===!1&&yt.layers2D===!1&&yt.layers3D===!1)return;const pt=a.context;if(!(!(!yt.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!yt.layers2D||a._terrain&&a._terrain.renderingToTexture||!yf.includes(this.name))||!(!yt.layers3D||!vf.includes(this.name))))return;const vt=pt.gl,Dt=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,R,pt);if(!Dt)return;const At=[...this.fixedDefines];At.push("DEBUG_WIREFRAME");const Ot=a.getOrCreateProgram(this.name,{config:this.configuration,defines:At});pt.program.set(Ot.program);const Bt=(fi,Ti,wi)=>{if(Ti[fi]&&wi[fi])for(const vi in Ti[fi])wi[fi][vi]&&wi[fi][vi].set(wi.program,vi,Ti[fi][vi].current)};de&&de.setUniforms(Ot.program,pt,Ot.binderUniforms,Q,{zoom:oe}),Bt("fixedUniforms",this,Ot),Bt("terrainUniforms",this,Ot),Bt("globeUniforms",this,Ot),Bt("fogUniforms",this,Ot),Bt("lightsUniforms",this,Ot),Bt("shadowUniforms",this,Ot),Dt.bind(),pt.setColorMode(new In([vt.ONE,vt.ONE_MINUS_SRC_ALPHA,vt.ZERO,vt.ONE],n.am.transparent,[!0,!0,!0,!1])),pt.setDepthMode(new Hr(f.func===vt.LESS?vt.LEQUAL:f.func,Hr.ReadOnly,f.range)),pt.setStencilMode(_n.disabled);const qt=3*H.primitiveLength*2,li=3*H.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fi=pe||1;for(let Ti=0;Ti<fi;++Ti)Ot.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ti),vt.drawElements(vt.LINES,qt,vt.UNSIGNED_SHORT,li)}else pe&&pe>1?vt.drawElementsInstanced(vt.LINES,qt,vt.UNSIGNED_SHORT,li,pe):vt.drawElements(vt.LINES,qt,vt.UNSIGNED_SHORT,li);R.bind(),pt.program.set(this.program),pt.setDepthMode(f),pt.setStencilMode(w),pt.setColorMode(P)}checkUniforms(a,f,w){if(this.fixedDefines.includes(f)){for(const P of Object.keys(w))if(!w[P].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${P} not set but required by ${f} being defined`)}}draw(a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot){const Bt=a.context,qt=Bt.gl;if(this.failedToCreate)return;Bt.program.set(this.program),Bt.setDepthMode(w),Bt.setStencilMode(P),Bt.setColorMode(R),Bt.setCullFace(H);for(const Ti of Object.keys(this.fixedUniforms))this.fixedUniforms[Ti].set(this.program,Ti,Q[Ti]);Dt&&Dt.setUniforms(this.program,Bt,this.binderUniforms,pt,{zoom:vt});const li={[qt.POINTS]:1,[qt.LINES]:2,[qt.TRIANGLES]:3,[qt.LINE_STRIP]:1}[f];this.checkUniforms(oe,"RENDER_SHADOWS",this.shadowUniforms);const fi=Ot&&Ot>0?1:void 0;for(const Ti of yt.get()){const wi=Ti.vaos||(Ti.vaos={});if((wi[oe]||(wi[oe]=new ql)).bind(Bt,this,de,Dt?Dt.getPaintVertexBuffers():[],pe,Ti.vertexOffset,At||[],fi),this.forceManualRenderingForInstanceIDShaders){const vi=Ot||1;for(let di=0;di<vi;++di)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",di),pe?qt.drawElements(f,Ti.primitiveLength*li,qt.UNSIGNED_SHORT,Ti.primitiveOffset*li*2):qt.drawArrays(f,Ti.vertexOffset,Ti.vertexLength)}else Ot&&Ot>1?qt.drawElementsInstanced(f,Ti.primitiveLength*li,qt.UNSIGNED_SHORT,Ti.primitiveOffset*li*2,Ot):pe?qt.drawElements(f,Ti.primitiveLength*li,qt.UNSIGNED_SHORT,Ti.primitiveOffset*li*2):qt.drawArrays(f,Ti.vertexOffset,Ti.vertexLength);f===qt.TRIANGLES&&pe&&this._drawDebugWireframe(a,w,P,R,pe,Ti,pt,vt,Dt,Ot)}}}function qc(b,a,f=0){const w=Math.pow(2,a.tileID.overscaledZ),P=a.tileSize*Math.pow(2,b.transform.tileZoom)/w,R=P*(a.tileID.canonical.x+a.tileID.wrap*w),H=P*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.aw(a,1,b.transform.tileZoom),u_pixel_coord_upper:[R>>16,H>>16],u_pixel_coord_lower:[65535&R,65535&H],u_pattern_transition:f}}const Kl={terrain:0,flat:1},xf=n.bz(),Xc=(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt)=>{const qt=a.style.light,li=qt.properties.get("position"),fi=[li.x,li.y,li.z],Ti=n.dx();qt.properties.get("anchor")==="viewport"&&(n.dy(Ti,-a.transform.angle),n.dz(fi,fi,Ti));const wi=qt.properties.get("color").toPremultipliedRenderColor(null),vi=a.transform,di={u_matrix:b,u_lightpos:fi,u_lightintensity:qt.properties.get("intensity"),u_lightcolor:[wi.r,wi.g,wi.b],u_vertical_gradient:+f,u_opacity:w,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Kl[de],u_base_type:Kl[pe],u_ao:P,u_edge_radius:R,u_width_scale:H,u_flood_light_color:Dt,u_vertical_scale:At,u_flood_light_intensity:Ot,u_ground_shadow_factor:Bt};return vi.projection.name==="globe"&&(di.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],di.u_zoom_transition=yt,di.u_inv_rot_matrix=vt,di.u_merc_center=pt,di.u_up_dir=vi.projection.upVector(new n.cp(0,0,0),pt[0]*n.aj,pt[1]*n.aj),di.u_height_lift=oe),di},Jd=(b,a,f,w,P,R)=>({u_matrix:b,u_edge_radius:a,u_width_scale:f,u_vertical_scale:w,u_height_type:Kl[P],u_base_type:Kl[R]}),Qd=(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt)=>{const qt=Xc(b,a,f,w,P,R,H,Q,de,pe,yt,pt,vt,Dt,At,Ot,1,[0,0,0]),li={u_height_factor:-Math.pow(2,Q.overscaledZ)/oe.tileSize/8};return n.h(qt,qc(a,oe,Bt),li)},wl=(b,a,f)=>({u_matrix:b,u_emissive_strength:a,u_ground_shadow_factor:f}),ep=(b,a,f,w,P,R=0)=>n.h(wl(b,a,P),qc(f,w,R)),Xm=(b,a,f,w)=>({u_matrix:b,u_world:f,u_emissive_strength:a,u_ground_shadow_factor:w}),Zm=(b,a,f,w,P,R,H=0)=>n.h(ep(b,a,f,w,R,H),{u_world:P}),Ym=(b,a)=>({u_matrix:b,u_ground_shadow_factor:a}),sh=(b,a,f,w,P)=>({u_matrix:b,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:f,u_height_scale:w,u_reset_depth:P}),Km=(b,a,f,w)=>{const P=n.aj/f.tileSize;return{u_matrix:b,u_camera_to_center_distance:a.getCameraToCenterDistance(w),u_extrude_scale:[a.pixelsToGLUnits[0]/P,a.pixelsToGLUnits[1]/P]}},oh=(b,a,f=1)=>({u_matrix:b,u_color:a,u_overlay:0,u_overlay_scale:f}),bf=n.bz(),tp=(b,a,f,w,P,R,H)=>{const Q=b.transform,oe=Q.projection.name==="globe",de=oe?n.dA(Q.zoom,a.canonical)*Q._pixelsPerMercatorPixel:n.aw(f,1,R),pe={u_matrix:a.projMatrix,u_extrude_scale:de,u_intensity:H,u_inv_rot_matrix:bf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(oe){pe.u_inv_rot_matrix=w,pe.u_merc_center=P,pe.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],pe.u_zoom_transition=n.ah(Q.zoom);const yt=P[0]*n.aj,pt=P[1]*n.aj;pe.u_up_dir=Q.projection.upVector(new n.cp(0,0,0),yt,pt)}return pe};function Sl(b,[a,f,w,P],[R,H]){if(R===H)return[0,0,0,0];const Q=255*(b-1)/(b*(H-R));return[a*Q,f*Q,w*Q,P*Q]}function wf(b,a,[f,w]){return f===w?0:.5/b+(a-f)*(b-1)/(b*(w-f))}const Sf=(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt,li,fi)=>({u_matrix:b,u_normalize_matrix:a,u_globe_matrix:f,u_merc_matrix:w,u_grid_matrix:P,u_tl_parent:R,u_scale_parent:de,u_fade_t:pe.mix,u_opacity:pe.opacity*yt.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:yt.paint.get("raster-brightness-min"),u_brightness_high:yt.paint.get("raster-brightness-max"),u_saturation_factor:n.dC(yt.paint.get("raster-saturation")),u_contrast_factor:n.dB(yt.paint.get("raster-contrast")),u_spin_weights:ip(yt.paint.get("raster-hue-rotate")),u_perspective_transform:pt,u_raster_elevation:vt,u_zoom_transition:H,u_merc_center:Q,u_cutoff_params:oe,u_colorization_mix:Sl(n.dD,At,Bt),u_colorization_offset:wf(n.dD,Ot,Bt),u_color_ramp:Dt,u_texture_offset:[li/(qt+2*li),qt/(qt+2*li)],u_texture_res:[qt+2*li,qt+2*li],u_emissive_strength:fi});function ip(b){b*=Math.PI/180;const a=Math.sin(b),f=Math.cos(b);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Ha=.05,Tl=(b,a,f,w,P,R,H,Q,oe,de,pe,yt)=>({u_matrix:b,u_normalize_matrix:a,u_globe_matrix:f,u_merc_matrix:w,u_grid_matrix:P,u_tl_parent:R,u_scale_parent:de,u_fade_t:pe.mix,u_opacity:pe.opacity,u_image0:0,u_image1:1,u_raster_elevation:yt,u_zoom_transition:H,u_merc_center:Q,u_cutoff_params:oe}),rp=(b,a,f,w,P,R,H,Q,oe,de)=>({u_particle_texture:b,u_particle_texture_side_len:a,u_tile_offset:f,u_velocity:w,u_color_ramp:R,u_velocity_res:P,u_max_speed:H,u_uv_offset:Q,u_data_scale:[255*oe[0],255*oe[1]],u_data_offset:de,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ha,Ha]}),ja=(b,a,f,w,P,R,H,Q,oe,de)=>({u_particle_texture:b,u_particle_texture_side_len:a,u_velocity:f,u_velocity_res:w,u_max_speed:P,u_speed_factor:R,u_reset_rate:H,u_rand_seed:Math.random(),u_uv_offset:Q,u_data_scale:[255*oe[0],255*oe[1]],u_data_offset:de,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ha,Ha]}),ah=n.bz(),Zc=(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt,li,fi,Ti,wi,vi)=>{const di=P.transform,Ei={u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:di.getCameraToCenterDistance(qt),u_rotate_symbol:+f,u_aspect_ratio:di.width/di.height,u_fade_change:P.options.fadeDuration?P.symbolFadeChange:1,u_matrix:R,u_label_plane_matrix:H,u_coord_matrix:Q,u_is_text:+de,u_elevation_from_sea:oe?1:0,u_pitch_with_map:+w,u_texsize:pe,u_texsize_icon:yt,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ah,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ah,u_up_vector:[0,-1,0],u_color_adj_mat:Ti,u_icon_transition:wi||0,u_gamma_scale:w?P.transform.getCameraToCenterDistance(qt)*Math.cos(P.terrain?0:P.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:1,u_scale_factor:vi||1,u_ground_shadow_factor:li,u_inv_matrix:n.bi(n.bz(),H),u_normal_scale:fi};return qt.name==="globe"&&(Ei.u_tile_id=[vt.canonical.x,vt.canonical.y,1<<vt.canonical.z],Ei.u_zoom_transition=Dt,Ei.u_inv_rot_matrix=Ot,Ei.u_merc_center=At,Ei.u_camera_forward=di._camera.forward(),Ei.u_ecef_origin=n.dE(di.globeMatrix,vt.toUnwrapped()),Ei.u_tile_matrix=Float32Array.from(di.globeMatrix),Ei.u_up_vector=Bt),Ei},Tf=(b,a,f,w)=>({u_matrix:b,u_emissive_strength:a,u_opacity:f,u_color:w}),Ef=(b,a,f,w,P,R,H,Q,oe)=>n.h(function(de,pe,yt,pt,vt,Dt){const{width:At,height:Ot}=pt.imageManager.getPixelSize(pe),Bt=Math.pow(2,Dt.tileID.overscaledZ),qt=Dt.tileSize*Math.pow(2,pt.transform.tileZoom)/Bt,li=qt*(Dt.tileID.canonical.x+Dt.tileID.wrap*Bt),fi=qt*Dt.tileID.canonical.y;return{u_image:0,u_pattern_tl:yt.tl,u_pattern_br:yt.br,u_texsize:[At,Ot],u_pattern_size:yt.displaySize,u_pattern_units_to_pixels:vt?[pt.transform.width,-1*pt.transform.height]:[1/n.aw(Dt,1,pt.transform.tileZoom),1/n.aw(Dt,1,pt.transform.tileZoom)],u_pixel_coord_upper:[li>>16,fi>>16],u_pixel_coord_lower:[65535&li,65535&fi]}}(0,R,H,w,Q,oe),{u_matrix:b,u_emissive_strength:a,u_opacity:f}),Yc=new Float32Array(n.bx([])),Kc=(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt=[0,0,0],Dt)=>{const At=P.style.light,Ot=At.properties.get("position"),Bt=[-Ot.x,-Ot.y,Ot.z],qt=n.dx();At.properties.get("anchor")==="viewport"&&(n.dy(qt,-P.transform.angle),n.dz(Bt,Bt,qt));const li=pe.alphaMode==="MASK",fi=At.properties.get("color").toNonPremultipliedRenderColor(null),Ti=pt.paint.get("model-ambient-occlusion-intensity"),wi=pt.paint.get("model-color").constantOr(n.am.white).toNonPremultipliedRenderColor(null);return wi.a=pt.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:b,u_lighting_matrix:a,u_normal_matrix:f,u_node_matrix:w||Yc,u_lightpos:Bt,u_lightintensity:At.properties.get("intensity"),u_lightcolor:[fi.r,fi.g,fi.b],u_camera_pos:vt,u_opacity:R,u_baseTextureIsAlpha:0,u_alphaMask:+li,u_alphaCutoff:pe.alphaCutoff,u_baseColorFactor:H.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:Q.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:oe,u_roughnessFactor:de,u_baseColorTexture:Co.BaseColor,u_metallicRoughnessTexture:Co.MetallicRoughness,u_normalTexture:Co.Normal,u_occlusionTexture:Co.Occlusion,u_emissionTexture:Co.Emission,u_lutTexture:Co.LUT,u_color_mix:wi.toArray01(),u_aoIntensity:Ti,u_emissive_strength:yt,u_occlusionTextureTransform:Dt||[0,0,0,0]}},np=(b,a=Yc,f=Yc)=>({u_matrix:b,u_instance:a,u_node_matrix:f}),sp={fillExtrusion:b=>({u_matrix:new n.cc(b),u_lightpos:new n.c9(b),u_lightintensity:new n.ca(b),u_lightcolor:new n.c9(b),u_vertical_gradient:new n.ca(b),u_opacity:new n.ca(b),u_edge_radius:new n.ca(b),u_width_scale:new n.ca(b),u_ao:new n.cb(b),u_height_type:new n.c8(b),u_base_type:new n.c8(b),u_tile_id:new n.c9(b),u_zoom_transition:new n.ca(b),u_inv_rot_matrix:new n.cc(b),u_merc_center:new n.cb(b),u_up_dir:new n.c9(b),u_height_lift:new n.ca(b),u_flood_light_color:new n.c9(b),u_vertical_scale:new n.ca(b),u_flood_light_intensity:new n.ca(b),u_ground_shadow_factor:new n.c9(b)}),fillExtrusionDepth:b=>({u_matrix:new n.cc(b),u_edge_radius:new n.ca(b),u_width_scale:new n.ca(b),u_vertical_scale:new n.ca(b),u_height_type:new n.c8(b),u_base_type:new n.c8(b)}),fillExtrusionPattern:b=>({u_matrix:new n.cc(b),u_lightpos:new n.c9(b),u_lightintensity:new n.ca(b),u_lightcolor:new n.c9(b),u_vertical_gradient:new n.ca(b),u_height_factor:new n.ca(b),u_edge_radius:new n.ca(b),u_width_scale:new n.ca(b),u_ao:new n.cb(b),u_height_type:new n.c8(b),u_base_type:new n.c8(b),u_tile_id:new n.c9(b),u_zoom_transition:new n.ca(b),u_inv_rot_matrix:new n.cc(b),u_merc_center:new n.cb(b),u_up_dir:new n.c9(b),u_height_lift:new n.ca(b),u_image:new n.c8(b),u_texsize:new n.cb(b),u_pixel_coord_upper:new n.cb(b),u_pixel_coord_lower:new n.cb(b),u_tile_units_to_pixels:new n.ca(b),u_opacity:new n.ca(b),u_pattern_transition:new n.ca(b)}),fillExtrusionGroundEffect:b=>({u_matrix:new n.cc(b),u_opacity:new n.ca(b),u_ao_pass:new n.ca(b),u_meter_to_tile:new n.ca(b),u_ao:new n.cb(b),u_flood_light_intensity:new n.ca(b),u_flood_light_color:new n.c9(b),u_attenuation:new n.ca(b),u_edge_radius:new n.ca(b),u_fb:new n.c8(b),u_fb_size:new n.ca(b),u_dynamic_offset:new n.ca(b)}),fill:b=>({u_matrix:new n.cc(b),u_emissive_strength:new n.ca(b),u_ground_shadow_factor:new n.c9(b)}),fillPattern:b=>({u_matrix:new n.cc(b),u_emissive_strength:new n.ca(b),u_image:new n.c8(b),u_texsize:new n.cb(b),u_pixel_coord_upper:new n.cb(b),u_pixel_coord_lower:new n.cb(b),u_tile_units_to_pixels:new n.ca(b),u_ground_shadow_factor:new n.c9(b),u_pattern_transition:new n.ca(b)}),fillOutline:b=>({u_matrix:new n.cc(b),u_emissive_strength:new n.ca(b),u_world:new n.cb(b),u_ground_shadow_factor:new n.c9(b)}),fillOutlinePattern:b=>({u_matrix:new n.cc(b),u_emissive_strength:new n.ca(b),u_world:new n.cb(b),u_image:new n.c8(b),u_texsize:new n.cb(b),u_pixel_coord_upper:new n.cb(b),u_pixel_coord_lower:new n.cb(b),u_tile_units_to_pixels:new n.ca(b),u_ground_shadow_factor:new n.c9(b),u_pattern_transition:new n.ca(b)}),building:b=>({u_matrix:new n.cc(b),u_normal_matrix:new n.cc(b),u_opacity:new n.ca(b)}),buildingDepth:b=>({u_matrix:new n.cc(b)}),elevatedStructuresDepth:b=>({u_matrix:new n.cc(b),u_depth_bias:new n.ca(b)}),elevatedStructures:b=>({u_matrix:new n.cc(b),u_ground_shadow_factor:new n.c9(b)}),elevatedStructuresDepthReconstruct:b=>({u_matrix:new n.cc(b),u_camera_pos:new n.c9(b),u_depth_bias:new n.ca(b),u_height_scale:new n.ca(b),u_reset_depth:new n.ca(b)}),circle:n.dH,collisionBox:b=>({u_matrix:new n.cc(b),u_camera_to_center_distance:new n.ca(b),u_extrude_scale:new n.cb(b)}),collisionCircle:b=>({u_matrix:new n.cc(b),u_inv_matrix:new n.cc(b),u_camera_to_center_distance:new n.ca(b),u_viewport_size:new n.cb(b)}),debug:b=>({u_color:new n.di(b),u_matrix:new n.cc(b),u_overlay:new n.c8(b),u_overlay_scale:new n.ca(b)}),clippingMask:b=>({u_matrix:new n.cc(b)}),heatmap:b=>({u_extrude_scale:new n.ca(b),u_intensity:new n.ca(b),u_matrix:new n.cc(b),u_inv_rot_matrix:new n.cc(b),u_merc_center:new n.cb(b),u_tile_id:new n.c9(b),u_zoom_transition:new n.ca(b),u_up_dir:new n.c9(b)}),heatmapTexture:b=>({u_image:new n.c8(b),u_color_ramp:new n.c8(b),u_opacity:new n.ca(b)}),hillshade:b=>({u_matrix:new n.cc(b),u_image:new n.c8(b),u_latrange:new n.cb(b),u_light:new n.cb(b),u_shadow:new n.di(b),u_highlight:new n.di(b),u_emissive_strength:new n.ca(b),u_accent:new n.di(b)}),hillshadePrepare:b=>({u_matrix:new n.cc(b),u_image:new n.c8(b),u_dimension:new n.cb(b),u_zoom:new n.ca(b)}),line:n.dG,linePattern:n.dF,raster:b=>({u_matrix:new n.cc(b),u_normalize_matrix:new n.cc(b),u_globe_matrix:new n.cc(b),u_merc_matrix:new n.cc(b),u_grid_matrix:new n.dj(b),u_tl_parent:new n.cb(b),u_scale_parent:new n.ca(b),u_fade_t:new n.ca(b),u_opacity:new n.ca(b),u_image0:new n.c8(b),u_image1:new n.c8(b),u_brightness_low:new n.ca(b),u_brightness_high:new n.ca(b),u_saturation_factor:new n.ca(b),u_contrast_factor:new n.ca(b),u_spin_weights:new n.c9(b),u_perspective_transform:new n.cb(b),u_raster_elevation:new n.ca(b),u_zoom_transition:new n.ca(b),u_merc_center:new n.cb(b),u_cutoff_params:new n.cQ(b),u_colorization_mix:new n.cQ(b),u_colorization_offset:new n.ca(b),u_color_ramp:new n.c8(b),u_texture_offset:new n.cb(b),u_texture_res:new n.cb(b),u_emissive_strength:new n.ca(b)}),rasterParticle:b=>({u_matrix:new n.cc(b),u_normalize_matrix:new n.cc(b),u_globe_matrix:new n.cc(b),u_merc_matrix:new n.cc(b),u_grid_matrix:new n.dj(b),u_tl_parent:new n.cb(b),u_scale_parent:new n.ca(b),u_fade_t:new n.ca(b),u_opacity:new n.ca(b),u_image0:new n.c8(b),u_image1:new n.c8(b),u_raster_elevation:new n.ca(b),u_zoom_transition:new n.ca(b),u_merc_center:new n.cb(b),u_cutoff_params:new n.cQ(b)}),rasterParticleTexture:b=>({u_texture:new n.c8(b),u_opacity:new n.ca(b)}),rasterParticleDraw:b=>({u_particle_texture:new n.c8(b),u_particle_texture_side_len:new n.ca(b),u_tile_offset:new n.cb(b),u_velocity:new n.c8(b),u_color_ramp:new n.c8(b),u_velocity_res:new n.cb(b),u_max_speed:new n.ca(b),u_uv_offset:new n.cb(b),u_data_scale:new n.cb(b),u_data_offset:new n.ca(b),u_particle_pos_scale:new n.ca(b),u_particle_pos_offset:new n.cb(b)}),rasterParticleUpdate:b=>({u_particle_texture:new n.c8(b),u_particle_texture_side_len:new n.ca(b),u_velocity:new n.c8(b),u_velocity_res:new n.cb(b),u_max_speed:new n.ca(b),u_speed_factor:new n.ca(b),u_reset_rate:new n.ca(b),u_rand_seed:new n.ca(b),u_uv_offset:new n.cb(b),u_data_scale:new n.cb(b),u_data_offset:new n.ca(b),u_particle_pos_scale:new n.ca(b),u_particle_pos_offset:new n.cb(b)}),symbol:b=>({u_is_size_zoom_constant:new n.c8(b),u_is_size_feature_constant:new n.c8(b),u_size_t:new n.ca(b),u_size:new n.ca(b),u_camera_to_center_distance:new n.ca(b),u_rotate_symbol:new n.c8(b),u_aspect_ratio:new n.ca(b),u_fade_change:new n.ca(b),u_matrix:new n.cc(b),u_label_plane_matrix:new n.cc(b),u_coord_matrix:new n.cc(b),u_is_text:new n.c8(b),u_elevation_from_sea:new n.c8(b),u_pitch_with_map:new n.c8(b),u_texsize:new n.cb(b),u_texsize_icon:new n.cb(b),u_texture:new n.c8(b),u_texture_icon:new n.c8(b),u_gamma_scale:new n.ca(b),u_device_pixel_ratio:new n.ca(b),u_tile_id:new n.c9(b),u_zoom_transition:new n.ca(b),u_inv_rot_matrix:new n.cc(b),u_merc_center:new n.cb(b),u_camera_forward:new n.c9(b),u_tile_matrix:new n.cc(b),u_up_vector:new n.c9(b),u_ecef_origin:new n.c9(b),u_is_halo:new n.c8(b),u_icon_transition:new n.ca(b),u_color_adj_mat:new n.cc(b),u_scale_factor:new n.ca(b),u_ground_shadow_factor:new n.c9(b),u_inv_matrix:new n.cc(b),u_normal_scale:new n.ca(b)}),background:b=>({u_matrix:new n.cc(b),u_emissive_strength:new n.ca(b),u_opacity:new n.ca(b),u_color:new n.di(b)}),backgroundPattern:b=>({u_matrix:new n.cc(b),u_emissive_strength:new n.ca(b),u_opacity:new n.ca(b),u_image:new n.c8(b),u_pattern_tl:new n.cb(b),u_pattern_br:new n.cb(b),u_texsize:new n.cb(b),u_pattern_size:new n.cb(b),u_pixel_coord_upper:new n.cb(b),u_pixel_coord_lower:new n.cb(b),u_pattern_units_to_pixels:new n.cb(b)}),terrainRaster:b=>({u_matrix:new n.cc(b),u_image0:new n.c8(b),u_skirt_height:new n.ca(b),u_ground_shadow_factor:new n.c9(b)}),skybox:b=>({u_matrix:new n.cc(b),u_sun_direction:new n.c9(b),u_cubemap:new n.c8(b),u_opacity:new n.ca(b),u_temporal_offset:new n.ca(b)}),skyboxGradient:b=>({u_matrix:new n.cc(b),u_color_ramp:new n.c8(b),u_center_direction:new n.c9(b),u_radius:new n.ca(b),u_opacity:new n.ca(b),u_temporal_offset:new n.ca(b)}),skyboxCapture:b=>({u_matrix_3f:new n.dj(b),u_sun_direction:new n.c9(b),u_sun_intensity:new n.ca(b),u_color_tint_r:new n.cQ(b),u_color_tint_m:new n.cQ(b),u_luminance:new n.ca(b)}),globeRaster:b=>({u_proj_matrix:new n.cc(b),u_globe_matrix:new n.cc(b),u_normalize_matrix:new n.cc(b),u_merc_matrix:new n.cc(b),u_zoom_transition:new n.ca(b),u_merc_center:new n.cb(b),u_image0:new n.c8(b),u_grid_matrix:new n.dj(b),u_skirt_height:new n.ca(b),u_far_z_cutoff:new n.ca(b),u_frustum_tl:new n.c9(b),u_frustum_tr:new n.c9(b),u_frustum_br:new n.c9(b),u_frustum_bl:new n.c9(b),u_globe_pos:new n.c9(b),u_globe_radius:new n.ca(b),u_viewport:new n.cb(b)}),globeAtmosphere:b=>({u_frustum_tl:new n.c9(b),u_frustum_tr:new n.c9(b),u_frustum_br:new n.c9(b),u_frustum_bl:new n.c9(b),u_horizon:new n.ca(b),u_transition:new n.ca(b),u_fadeout_range:new n.ca(b),u_color:new n.cQ(b),u_high_color:new n.cQ(b),u_space_color:new n.cQ(b),u_temporal_offset:new n.ca(b),u_horizon_angle:new n.ca(b)}),model:b=>({u_matrix:new n.cc(b),u_lighting_matrix:new n.cc(b),u_normal_matrix:new n.cc(b),u_node_matrix:new n.cc(b),u_lightpos:new n.c9(b),u_lightintensity:new n.ca(b),u_lightcolor:new n.c9(b),u_camera_pos:new n.c9(b),u_opacity:new n.ca(b),u_baseColorFactor:new n.cQ(b),u_emissiveFactor:new n.cQ(b),u_metallicFactor:new n.ca(b),u_roughnessFactor:new n.ca(b),u_baseTextureIsAlpha:new n.c8(b),u_alphaMask:new n.c8(b),u_alphaCutoff:new n.ca(b),u_baseColorTexture:new n.c8(b),u_metallicRoughnessTexture:new n.c8(b),u_normalTexture:new n.c8(b),u_occlusionTexture:new n.c8(b),u_emissionTexture:new n.c8(b),u_lutTexture:new n.c8(b),u_color_mix:new n.cQ(b),u_aoIntensity:new n.ca(b),u_emissive_strength:new n.ca(b),u_occlusionTextureTransform:new n.cQ(b)}),modelDepth:b=>({u_matrix:new n.cc(b),u_instance:new n.cc(b),u_node_matrix:new n.cc(b)}),groundShadow:b=>({u_matrix:new n.cc(b),u_ground_shadow_factor:new n.c9(b)}),stars:b=>({u_matrix:new n.cc(b),u_up:new n.c9(b),u_right:new n.c9(b),u_intensity_multiplier:new n.ca(b)}),snowParticle:b=>({u_modelview:new n.cc(b),u_projection:new n.cc(b),u_time:new n.ca(b),u_cam_pos:new n.c9(b),u_velocityConeAperture:new n.ca(b),u_velocity:new n.ca(b),u_horizontalOscillationRadius:new n.ca(b),u_horizontalOscillationRate:new n.ca(b),u_boxSize:new n.ca(b),u_billboardSize:new n.ca(b),u_simpleShapeParameters:new n.cb(b),u_screenSize:new n.cb(b),u_thinningCenterPos:new n.cb(b),u_thinningShape:new n.c9(b),u_thinningAffectedRatio:new n.ca(b),u_thinningParticleOffset:new n.ca(b),u_particleColor:new n.cQ(b),u_direction:new n.c9(b)}),rainParticle:b=>({u_modelview:new n.cc(b),u_projection:new n.cc(b),u_time:new n.ca(b),u_cam_pos:new n.c9(b),u_texScreen:new n.c8(b),u_velocityConeAperture:new n.ca(b),u_velocity:new n.ca(b),u_boxSize:new n.ca(b),u_rainDropletSize:new n.cb(b),u_distortionStrength:new n.ca(b),u_rainDirection:new n.c9(b),u_color:new n.cQ(b),u_screenSize:new n.cb(b),u_thinningCenterPos:new n.cb(b),u_thinningShape:new n.c9(b),u_thinningAffectedRatio:new n.ca(b),u_thinningParticleOffset:new n.ca(b),u_shapeDirectionalPower:new n.ca(b),u_shapeNormalPower:new n.ca(b),u_mode:new n.ca(b)}),vignette:b=>({u_vignetteShape:new n.c9(b),u_vignetteColor:new n.cQ(b)}),occlusion:b=>({u_matrix:new n.cc(b),u_anchorPos:new n.c9(b),u_screenSizePx:new n.cb(b),u_occluderSizePx:new n.cb(b),u_color:new n.cQ(b)})};class Jo{constructor(a,f,w,P){this.id=Jo.uniqueIdxCounter,Jo.uniqueIdxCounter++,this.context=a;const R=a.gl;this.buffer=R.createBuffer(),this.dynamicDraw=!!w,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),R.bufferData(R.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||P||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=Jo.uniqueIdxCounter,Jo.uniqueIdxCounter++;const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Jo.uniqueIdxCounter=0;const Jm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qm{constructor(a,f,w,P,R,H){this.length=f.length,this.attributes=w,this.itemSize=f.bytesPerElement,this.dynamicDraw=P,this.instanceCount=H,this.context=a;const Q=a.gl;this.buffer=Q.createBuffer(),a.bindVertexBuffer.set(this.buffer),Q.bufferData(Q.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?Q.DYNAMIC_DRAW:Q.STATIC_DRAW),this.dynamicDraw||R||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let w=0;w<this.attributes.length;w++){const P=f.attributes[this.attributes[w].name];P!==void 0&&a.enableVertexAttribArray(P)}}setVertexAttribPointers(a,f,w){for(let P=0;P<this.attributes.length;P++){const R=this.attributes[P],H=f.attributes[R.name];H!==void 0&&a.vertexAttribPointer(H,R.components,a[Jm[R.type]],!1,this.itemSize,R.offset+this.itemSize*(w||0))}}setVertexAttribDivisor(a,f,w){for(let P=0;P<this.attributes.length;P++){const R=f.attributes[this.attributes[P].name];R!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(R,w)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mf{constructor(a,f,w,P,R){this.context=a,this.width=f,this.height=w;const H=this.framebuffer=a.gl.createFramebuffer();P&&(this.colorAttachment=new Zd(a,H)),R&&(this.depthAttachmentType=R,this.depthAttachment=R==="renderbuffer"?new Yd(a,H):new jm(a,H))}destroy(){const a=this.context.gl;if(this.colorAttachment){const f=this.colorAttachment.get();f&&a.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&a.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&a.deleteTexture(f)}a.deleteFramebuffer(this.framebuffer)}}class eg{constructor(a,f){this.gl=a,this.clearColor=new $d(this),this.clearDepth=new uf(this),this.clearStencil=new Nm(this),this.colorMask=new Vm(this),this.depthMask=new $m(this),this.stencilMask=new Um(this),this.stencilFunc=new Ud(this),this.stencilOp=new Gm(this),this.stencilTest=new qu(this),this.depthRange=new Hm(this),this.depthTest=new Gd(this),this.depthFunc=new hf(this),this.blend=new Xu(this),this.blendFunc=new ff(this),this.blendColor=new vl(this),this.blendEquation=new Xl(this),this.cullFace=new Zu(this),this.cullFaceSide=new Yu(this),this.frontFace=new Zl(this),this.program=new Hd(this),this.activeTexture=new df(this),this.viewport=new jd(this),this.bindFramebuffer=new Yl(this),this.bindRenderbuffer=new Ku(this),this.bindTexture=new Ju(this),this.bindVertexBuffer=new pf(this),this.bindElementBuffer=new Qu(this),this.bindVertexArrayOES=new jc(this),this.pixelStoreUnpack=new Wd(this),this.pixelStoreUnpackPremultiplyAlpha=new qd(this),this.pixelStoreUnpackFlipY=new Xd(this),this.options=f?Object.assign({},f):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=f&&!!f.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f,w){return new Jo(this,a,f,w)}createVertexBuffer(a,f,w,P,R){return new Qm(this,a,f,w,P,R)}createRenderbuffer(a,f,w){const P=this.gl,R=P.createRenderbuffer();return this.bindRenderbuffer.set(R),P.renderbufferStorage(P.RENDERBUFFER,a,f,w),this.bindRenderbuffer.set(null),R}createFramebuffer(a,f,w,P){return new Mf(this,a,f,w,P)}clear({color:a,depth:f,stencil:w,colorMask:P}){const R=this.gl;let H=0;a&&(H|=R.COLOR_BUFFER_BIT,this.clearColor.set(a.toNonPremultipliedRenderColor(null)),this.colorMask.set(P||[!0,!0,!0,!0])),f!==void 0&&(H|=R.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),w!==void 0&&(H|=R.STENCIL_BUFFER_BIT,this.clearStencil.set(w),this.stencilMask.set(255)),R.clear(H)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){n.bv(a.blendFunction,In.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Jl;function lh(b,a,f,w,P,R,H){const Q=b.context,oe=Q.gl,de=b.transform,pe=b.getOrCreateProgram("collisionBox"),yt=[];let pt=0,vt=0;for(let fi=0;fi<w.length;fi++){const Ti=w[fi],wi=a.getTile(Ti),vi=wi.getBucket(f);if(!vi)continue;const di=pn(Ti,vi,de);let Ei=di;P[0]===0&&P[1]===0||(Ei=b.translatePosMatrix(di,wi,P,R));const Pi=H?vi.textCollisionBox:vi.iconCollisionBox,ji=vi.collisionCircleArray;if(ji.length>0){const Wi=n.bz(),or=Ei;n.cB(Wi,vi.placementInvProjMatrix,de.glCoordMatrix),n.cB(Wi,Wi,vi.placementViewportMatrix),yt.push({circleArray:ji,circleOffset:vt,transform:or,invTransform:Wi,projection:vi.getProjection()}),pt+=ji.length/4,vt=pt}Pi&&(b.terrain&&b.terrain.setupElevationDraw(wi,pe),pe.draw(b,oe.LINES,Hr.disabled,_n.disabled,b.colorModeForRenderPass(),fn.disabled,Km(Ei,de,wi,vi.getProjection()),f.id,Pi.layoutVertexBuffer,Pi.indexBuffer,Pi.segments,null,de.zoom,null,[Pi.collisionVertexBuffer,Pi.collisionVertexBufferExt]))}if(!H||!yt.length)return;const Dt=b.getOrCreateProgram("collisionCircle"),At=new n.dI;At.resize(4*pt),At._trim();let Ot=0;for(const fi of yt)for(let Ti=0;Ti<fi.circleArray.length/4;Ti++){const wi=4*Ti,vi=fi.circleArray[wi+0],di=fi.circleArray[wi+1],Ei=fi.circleArray[wi+2],Pi=fi.circleArray[wi+3];At.emplace(Ot++,vi,di,Ei,Pi,0),At.emplace(Ot++,vi,di,Ei,Pi,1),At.emplace(Ot++,vi,di,Ei,Pi,2),At.emplace(Ot++,vi,di,Ei,Pi,3)}(!Jl||Jl.length<2*pt)&&(Jl=function(fi){const Ti=2*fi,wi=new n.a_;wi.resize(Ti),wi._trim();for(let vi=0;vi<Ti;vi++){const di=6*vi;wi.uint16[di+0]=4*vi+0,wi.uint16[di+1]=4*vi+1,wi.uint16[di+2]=4*vi+2,wi.uint16[di+3]=4*vi+2,wi.uint16[di+4]=4*vi+3,wi.uint16[di+5]=4*vi+0}return wi}(pt));const Bt=Q.createIndexBuffer(Jl,!0),qt=Q.createVertexBuffer(At,n.dJ.members,!0);for(const fi of yt){const Ti={u_matrix:fi.transform,u_inv_matrix:fi.invTransform,u_camera_to_center_distance:(li=de).getCameraToCenterDistance(fi.projection),u_viewport_size:[li.width,li.height]};Dt.draw(b,oe.TRIANGLES,Hr.disabled,_n.disabled,b.colorModeForRenderPass(),fn.disabled,Ti,f.id,qt,Bt,n.bd.simpleSegment(0,2*fi.circleOffset,fi.circleArray.length,fi.circleArray.length/2),null,de.zoom)}var li;qt.destroy(),Bt.destroy()}const Ea=n.bz();function Jc(b){const a=b._camera.getWorldToCamera(b.worldSize,1),f=n.az([],a,b.globeMatrix);n.bi(f,f);const w=[0,0,0],P=[0,1,0,0];return n.aA(P,P,f),w[0]=P[0],w[1]=P[1],w[2]=P[2],n.au(w,w),w}function Qc({width:b,height:a,anchor:f,textOffset:w,textScale:P},R){const{horizontalAlign:H,verticalAlign:Q}=n.bT(f),oe=-(H-.5)*b,de=-(Q-.5)*a,pe=n.bU(f,w);return new n.P((oe/P+pe[0])*R,(de/P+pe[1])*R)}function op(b,a,f,w,P,R,H,Q,oe,de){const pe=b.text.placedSymbolArray,yt=b.text.dynamicLayoutVertexArray,pt=b.icon.dynamicLayoutVertexArray,vt={},Dt=b.getProjection(),At=zu(H,Dt,P),Ot=P.elevation,Bt=Dt.upVectorScale(H.canonical,P.center.lat,P.worldSize).metersToTile;yt.clear();for(let qt=0;qt<pe.length;qt++){const li=pe.get(qt),{tileAnchorX:fi,tileAnchorY:Ti,numGlyphs:wi}=li,vi=li.hidden||!li.crossTileID||b.allowVerticalPlacement&&!li.placedOrientation?null:w[li.crossTileID];if(vi){let di=0,Ei=0,Pi=0;if(Ot){const ur=Ot?Ot.getAtTileOffset(H,fi,Ti):0,[Zi,gr,kr]=Dt.upVector(H.canonical,fi,Ti);di=ur*Zi*Bt,Ei=ur*gr*Bt,Pi=ur*kr*Bt}let[ji,Wi,or,ar]=na(li.projectedAnchorX+di,li.projectedAnchorY+Ei,li.projectedAnchorZ+Pi,f?At:R);const vr=kc(P.getCameraToCenterDistance(Dt),ar);let Ui=n.bJ(b.textSizeData,oe,li)*vr/n.bO;f&&(Ui*=b.tilePixelRatio/Q);const Ji=Qc(vi,Ui);f?({x:ji,y:Wi,z:or}=Dt.projectTilePoint(fi+Ji.x,Ti+Ji.y,H.canonical),[ji,Wi,or]=na(ji+di,Wi+Ei,or+Pi,R)):(a&&Ji._rotate(-P.angle),ji+=Ji.x,Wi+=Ji.y,or=0);const zi=b.allowVerticalPlacement&&li.placedOrientation===n.bI.vertical?Math.PI/2:0;for(let ur=0;ur<wi;ur++)n.bL(yt,ji,Wi,or,zi);de&&li.associatedIconIndex>=0&&(vt[li.associatedIconIndex]={x:ji,y:Wi,z:or,angle:zi})}else pl(wi,yt)}if(de){pt.clear();const qt=b.icon.placedSymbolArray;for(let li=0;li<qt.length;li++){const fi=qt.get(li),{numGlyphs:Ti}=fi,wi=vt[li];if(fi.hidden||!wi)pl(Ti,pt);else{const{x:vi,y:di,z:Ei,angle:Pi}=wi;for(let ji=0;ji<Ti;ji++)n.bL(pt,vi,di,Ei,Pi)}}b.icon.dynamicLayoutVertexBuffer.updateData(pt)}b.text.dynamicLayoutVertexBuffer.updateData(yt)}function Ql(b,a,f,w,P,R,H={}){const Q=f.paint.get("icon-translate"),oe=f.paint.get("text-translate"),de=f.paint.get("icon-translate-anchor"),pe=f.paint.get("text-translate-anchor"),yt=f.layout.get("icon-rotation-alignment"),pt=f.layout.get("text-rotation-alignment"),vt=f.layout.get("icon-pitch-alignment"),Dt=f.layout.get("text-pitch-alignment"),At=f.layout.get("icon-keep-upright"),Ot=f.layout.get("text-keep-upright"),Bt=f.paint.get("icon-color-saturation"),qt=f.paint.get("icon-color-contrast"),li=f.paint.get("icon-color-brightness-min"),fi=f.paint.get("icon-color-brightness-max"),Ti=f.layout.get("symbol-elevation-reference")==="sea",wi=b.context,vi=wi.gl,di=b.transform,Ei=yt==="map",Pi=pt==="map",ji=vt==="map",Wi=Dt==="map",or=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ar=!1;const vr=b.depthModeForSublayer(0,Hr.ReadOnly),Ui=new Hr(b.context.gl.LEQUAL,Hr.ReadOnly,b.depthRangeFor3D),Ji=[n.aD(di.center.lng),n.aH(di.center.lat)],zi=f.layout.get("text-variable-anchor"),ur=di.projection.name==="globe",Zi=[],gr=[0,-1,0];for(const kr of w){const cr=a.getTile(kr),Pr=cr.getBucket(f);if(!Pr||Pr.projection.name==="mercator"&&ur||Pr.fullyClipped)continue;const Wr=Pr.projection.name==="globe",qr=Wr?n.ah(di.zoom):0,Ur=zu(kr,Pr.getProjection(),di),Qr=di.calculatePixelsToTileUnitsMatrix(cr),nn=zi&&Pr.hasTextData(),ln=Pr.hasIconTextFit()&&nn&&Pr.hasIconData(),gn=Pr.getProjection().createInversionMatrix(di,kr.canonical),En=(1<<cr.tileID.canonical.z)*n.aj/b.transform.worldSize,ss=Ss=>{let Kn=[0,0,0];if(Ss){const Gs=b.style.directionalLight,jn=b.style.ambientLight;Gs&&jn&&(Kn=_l(b.style,Gs,jn))}return Kn},ws=Ss=>{di.depthOcclusionForSymbolsAndCircles&&(f.hasInitialOcclusionOpacityProperties||b.terrain)&&(Ss.push("DEPTH_D24"),Ss.push("DEPTH_OCCLUSION"))},cs=()=>{const Ss=Ei&&f.layout.get("symbol-placement")!=="point",Kn=[];ws(Kn);const Gs=Ss||ln,jn=Pr.elevationType==="road"&&ji,Ys=b.shadowRenderer,Ps=jn&&!!Ys&&Ys.enabled,_s=ss(Ps),Is=jn?Ui:vr,Qn=f.paint.get("icon-image-cross-fade");b.terrainRenderModeElevated()&&ji&&Kn.push("PITCH_WITH_MAP_TERRAIN"),Wr&&(Kn.push("PROJECTION_GLOBE_VIEW"),Gs&&Kn.push("PROJECTED_POS_ON_VIEWPORT")),Qn>0&&Kn.push("ICON_TRANSITION"),Pr.icon.zOffsetVertexBuffer&&Kn.push("Z_OFFSET"),Bt===0&&qt===0&&li===0&&fi===1||Kn.push("COLOR_ADJUSTMENT"),Pr.sdfIcons&&Kn.push("RENDER_SDF"),Ps&&Kn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),jn&&Pr.icon.orientationVertexBuffer&&Kn.push("ELEVATED_ROADS");const js=Pr.icon.programConfigurations.get(f.id),_o=b.getOrCreateProgram("symbol",{config:js,defines:Kn}),Ds=cr.imageAtlasTexture?cr.imageAtlasTexture.size:[0,0],Yn=Pr.iconSizeData,No=n.bH(Yn,di.zoom),Do=ji||!di.isOrthographic,Wo=ba(Ur,cr.tileID.canonical,ji,Ei,di,Pr.getProjection(),Qr),la=Du(Ur,cr.tileID.canonical,ji,Ei,di,Pr.getProjection(),Qr),ea=b.translatePosMatrix(la,cr,Q,de,!0),Fo=b.translatePosMatrix(Ur,cr,Q,de),el=Gs?Ea:Wo,ca=Ei&&!ji&&!Ss;let tl=gr;!ur&&!di.mercatorFromTransition||Ei||(tl=Jc(di));const gu=Wr?tl:gr,Yf=f.getColorAdjustmentMatrix(Bt,qt,li,fi),dc=Zc(Yn.kind,No,ca,ji,b,Fo,el,ea,Ti,!1,Ds,[0,0],0,kr,qr,Ji,gn,gu,Pr.getProjection(),_s,En,Yf,Qn,null),Kf=cr.imageAtlasTexture?cr.imageAtlasTexture:null,_u=f.layout.get("icon-size").constantOr(0)!==1||Pr.iconsNeedLinear,Ah=Pr.sdfIcons||b.options.rotating||b.options.zooming||_u||Do?vi.LINEAR:vi.NEAREST,Ch=Pr.sdfIcons&&f.paint.get("icon-halo-width").constantOr(1)!==0,_a=b.terrain&&ji&&Ss?n.bi(n.bz(),Wo):Ea;if(Ss&&Pr.icon){const pc=di.elevation,Il=pc?pc.getAtTileOffsetFunc(kr,di.center.lat,di.worldSize,Pr.getProjection()):null,il=ku(Ur,cr.tileID.canonical,ji,Ei,di,Pr.getProjection(),Qr);Fu(Pr,Ur,b,!1,il,la,ji,At,Il,kr)}return{program:_o,buffers:Pr.icon,uniformValues:dc,atlasTexture:Kf,atlasTextureIcon:null,atlasInterpolation:Ah,atlasInterpolationIcon:null,isSDF:Pr.sdfIcons,hasHalo:Ch,depthMode:Is,tile:cr,renderWithShadows:Ps,labelPlaneMatrixInv:_a}},fs=()=>{const Ss=Pi&&f.layout.get("symbol-placement")!=="point",Kn=[],Gs=Ss||zi||ln,jn=Pr.elevationType==="road"&&Wi,Ys=b.shadowRenderer,Ps=jn&&!!Ys&&Ys.enabled,_s=ss(Ps),Is=jn?Ui:vr;b.terrainRenderModeElevated()&&Wi&&Kn.push("PITCH_WITH_MAP_TERRAIN"),Wr&&(Kn.push("PROJECTION_GLOBE_VIEW"),Gs&&Kn.push("PROJECTED_POS_ON_VIEWPORT")),Pr.text.zOffsetVertexBuffer&&Kn.push("Z_OFFSET"),Pr.iconsInText&&Kn.push("RENDER_TEXT_AND_SYMBOL"),Kn.push("RENDER_SDF"),Ps&&Kn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),jn&&Pr.text.orientationVertexBuffer&&Kn.push("ELEVATED_ROADS"),ws(Kn);const Qn=Pr.text.programConfigurations.get(f.id),js=b.getOrCreateProgram("symbol",{config:Qn,defines:Kn});let _o,Ds=[0,0],Yn=null;const No=Pr.textSizeData;Pr.iconsInText&&(Ds=cr.imageAtlasTexture?cr.imageAtlasTexture.size:[0,0],Yn=cr.imageAtlasTexture?cr.imageAtlasTexture:null,_o=Wi||!di.isOrthographic||b.options.rotating||b.options.zooming||No.kind==="composite"||No.kind==="camera"?vi.LINEAR:vi.NEAREST);const Do=cr.glyphAtlasTexture?cr.glyphAtlasTexture.size:[0,0],Wo=f.layout.get("text-size-scale-range"),la=n.ay(b.scaleFactor,Wo[0],Wo[1]),ea=n.bH(No,di.zoom,la),Fo=ba(Ur,cr.tileID.canonical,Wi,Pi,di,Pr.getProjection(),Qr),el=Du(Ur,cr.tileID.canonical,Wi,Pi,di,Pr.getProjection(),Qr),ca=b.translatePosMatrix(el,cr,oe,pe,!0),tl=b.translatePosMatrix(Ur,cr,oe,pe),gu=Gs?Ea:Fo,Yf=Pi&&!Wi&&!Ss;let dc=gr;!ur&&!di.mercatorFromTransition||Pi||(dc=Jc(di));const Kf=Zc(No.kind,ea,Yf,Wi,b,tl,gu,ca,Ti,!0,Do,Ds,0,kr,qr,Ji,gn,Wr?dc:gr,Pr.getProjection(),_s,En,null,null,la),_u=cr.glyphAtlasTexture?cr.glyphAtlasTexture:null,Ah=vi.LINEAR,Ch=f.paint.get("text-halo-width").constantOr(1)!==0,_a=b.terrain&&Wi&&Ss?n.bi(n.bz(),Fo):Ea;if(Ss&&Pr.text){const pc=di.elevation,Il=pc?pc.getAtTileOffsetFunc(kr,di.center.lat,di.worldSize,Pr.getProjection()):null,il=ku(Ur,cr.tileID.canonical,Wi,Pi,di,Pr.getProjection(),Qr);Fu(Pr,Ur,b,!0,il,el,Wi,Ot,Il,kr)}return{program:js,buffers:Pr.text,uniformValues:Kf,atlasTexture:_u,atlasTextureIcon:Yn,atlasInterpolation:Ah,atlasInterpolationIcon:_o,isSDF:!0,hasHalo:Ch,depthMode:Is,tile:cr,renderWithShadows:Ps,labelPlaneMatrixInv:_a}},qs=Pr.icon.segments.get().length,xn=Pr.text.segments.get().length,Cn=qs&&!H.onlyText?cs():null,Fn=xn&&!H.onlyIcons?fs():null,Cs=f.paint.get("icon-opacity").constantOr(1),io=f.paint.get("text-opacity").constantOr(1);if(or&&Pr.canOverlap){ar=!0;const Ss=Cs&&!H.onlyText?Pr.icon.segments.get():[],Kn=io&&!H.onlyIcons?Pr.text.segments.get():[];for(const Gs of Ss)Zi.push({segments:new n.bd([Gs]),sortKey:Gs.sortKey,state:Cn});for(const Gs of Kn)Zi.push({segments:new n.bd([Gs]),sortKey:Gs.sortKey,state:Fn})}else H.onlyText||Zi.push({segments:Cs?Pr.icon.segments:new n.bd([]),sortKey:0,state:Cn}),H.onlyIcons||Zi.push({segments:io?Pr.text.segments:new n.bd([]),sortKey:0,state:Fn})}ar&&Zi.sort((kr,cr)=>kr.sortKey-cr.sortKey);for(const kr of Zi){const cr=kr.state;if(cr)if(b.terrain?b.terrain.setupElevationDraw(cr.tile,cr.program,{useDepthForOcclusion:di.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:cr.labelPlaneMatrixInv}):b.setupDepthForOcclusion(di.depthOcclusionForSymbolsAndCircles,cr.program),wi.activeTexture.set(vi.TEXTURE0),cr.atlasTexture&&cr.atlasTexture.bind(cr.atlasInterpolation,vi.CLAMP_TO_EDGE,!0),cr.atlasTextureIcon&&(wi.activeTexture.set(vi.TEXTURE1),cr.atlasTextureIcon&&cr.atlasTextureIcon.bind(cr.atlasInterpolationIcon,vi.CLAMP_TO_EDGE,!0)),cr.renderWithShadows&&b.shadowRenderer.setupShadows(cr.tile.tileID.toUnwrapped(),cr.program,"vector-tile",cr.tile.tileID.overscaledZ),b.uploadCommonLightUniforms(b.context,cr.program),cr.hasHalo){const Pr=cr.uniformValues;Pr.u_is_halo=1,ec(cr.buffers,kr.segments,f,b,cr.program,cr.depthMode,P,R,Pr,2),Pr.u_is_halo=0}else{if(cr.isSDF){const Pr=cr.uniformValues;cr.hasHalo&&(Pr.u_is_halo=1,ec(cr.buffers,kr.segments,f,b,cr.program,cr.depthMode,P,R,Pr,1)),Pr.u_is_halo=0}ec(cr.buffers,kr.segments,f,b,cr.program,cr.depthMode,P,R,cr.uniformValues,1)}}}function ec(b,a,f,w,P,R,H,Q,oe,de){const pe=[b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer,b.iconTransitioningVertexBuffer,b.globeExtVertexBuffer,b.zOffsetVertexBuffer,b.orientationVertexBuffer];P.draw(w,w.context.gl.TRIANGLES,R,H,Q,fn.disabled,oe,f.id,b.layoutVertexBuffer,b.indexBuffer,a,f.paint,w.transform.zoom,b.programConfigurations.get(f.id),pe,de)}function ch(b,a){const f=1<<b.canonical.z,w=(a.x*f-b.canonical.x-b.wrap*f)*n.aj,P=(a.y*f-b.canonical.y)*n.aj,R=n.dS(a.z,a.y);return n.cS(w,P,R)}function Af(b,a,f,w,P){if(!f.layout||f.layout.get("fill-elevation-reference")==="none")return;const R=b.context.gl,H=new Hr(b.context.gl.LEQUAL,Hr.ReadWrite,b.depthRangeFor3D),Q=new Hr(b.context.gl.GREATER,Hr.ReadWrite,b.depthRangeFor3D),oe=function(vt){const Dt=n.cJ(vt.pitch);let At=.01;return vt.isOrthographic&&(At=n.ai(1e-4,At,n.cN(Dt>=ho?1:Dt/ho))),2*At}(b.transform),de=b.transform.getFreeCameraOptions().position,pe="elevatedStructuresDepthReconstruct",yt=b.getOrCreateProgram(pe,{defines:["DEPTH_RECONSTRUCTION"]}),pt=b.getOrCreateProgram(pe);for(const vt of w){const Dt=a.getTile(vt),At=Dt.getBucket(f);if(!At)continue;const Ot=At.elevatedStructures;if(!Ot)continue;const Bt=At.elevationBufferData.heightRange,qt=ch(vt.toUnwrapped(),de),li=b.translatePosMatrix(vt.projMatrix,Dt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));let fi,Ti,wi,vi;if(P==="initialize"){if(!Bt||Bt.min>=1||Ot.depthSegments.segments[0].primitiveLength===0)continue;fi=sh(li,qt,oe,1,0),Ti=H,wi=Ot.depthSegments,vi=yt}else if(P==="reset"){if(!Bt||Bt.min>=0||Ot.maskSegments.segments[0].primitiveLength===0)continue;fi=sh(li,qt,0,0,1),Ti=Q,wi=Ot.maskSegments,vi=yt}else if(P==="geometry"){if(Ot.depthSegments.segments[0].primitiveLength===0)continue;fi=sh(li,qt,oe,1,0),Ti=H,wi=Ot.depthSegments,vi=pt}vi.draw(b,R.TRIANGLES,Ti,_n.disabled,In.disabled,fn.disabled,fi,f.id,Ot.vertexBuffer,Ot.indexBuffer,wi,f.paint,b.transform.zoom)}}function Cf(b,a,f){const{painter:w,sourceCache:P,layer:R,coords:H,colorMode:Q,elevationType:oe,terrainEnabled:de,pass:pe}=b,yt=w.context.gl,pt=R.paint.get("fill-pattern"),vt=R.paint.get("fill-pattern-cross-fade"),Dt=pt.constantOr(null);let At=oe;oe!=="road"||a&&!de||(At="none");const Ot=At==="road",Bt=b.painter.shadowRenderer,qt=Ot&&!!Bt&&Bt.enabled,li=new Hr(w.context.gl.LEQUAL,Hr.ReadOnly,w.depthRangeFor3D);let fi=[0,0,0];if(qt){const vi=w.style.directionalLight,di=w.style.ambientLight;vi&&di&&(fi=_l(w.style,vi,di))}const Ti=pt&&pt.constantOr(1),wi=(vi,di)=>{let Ei,Pi,ji,Wi,or;di?(Ei=Ti&&!R.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ji=yt.LINES):(Ei=Ti?"fillPattern":"fill",ji=yt.TRIANGLES);for(const ar of H){const vr=P.getTile(ar);if(Ti&&!vr.patternsLoaded())continue;const Ui=vr.getBucket(R);if(!Ui)continue;const Ji=a?Ui.elevationBufferData:Ui.bufferData;if(Ji.isEmpty())continue;w.prepareDrawTile();const zi=Ji.programConfigurations.get(R.id),ur=w.isTileAffectedByFog(ar),Zi=[],gr=[];Ot&&(Zi.push("ELEVATED_ROADS"),gr.push(Ji.elevatedLayoutVertexBuffer)),qt&&Zi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ti&&(w.context.activeTexture.set(yt.TEXTURE0),vr.imageAtlasTexture&&vr.imageAtlasTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),zi.updatePaintBuffers());let kr=!1;if(Dt&&vr.imageAtlas){const Ur=vr.imageAtlas,Qr=n.dN.from(Dt),nn=Qr.getPrimary().scaleSelf(n.q.devicePixelRatio).toString(),ln=Qr.getSecondary(),gn=Ur.patternPositions.get(nn),En=ln?Ur.patternPositions.get(ln.scaleSelf(n.q.devicePixelRatio).toString()):null;kr=!!gn&&!!En,gn&&zi.setConstantPatternPositions(gn,En)}vt>0&&(kr||zi.getPatternTransitionVertexBuffer("fill-pattern"))&&Zi.push("FILL_PATTERN_TRANSITION");const cr=w.getOrCreateProgram(Ei,{config:zi,overrideFog:ur,defines:Zi}),Pr=w.translatePosMatrix(ar.projMatrix,vr,R.paint.get("fill-translate"),R.paint.get("fill-translate-anchor"));qt&&Bt.setupShadows(vr.tileID.toUnwrapped(),cr,"vector-tile",vr.tileID.overscaledZ);const Wr=R.paint.get("fill-emissive-strength");if(di){Wi=Ji.lineIndexBuffer,or=Ji.lineSegments;const Ur=w.terrain&&w.terrain.renderingToTexture?w.terrain.drapeBufferSize:[yt.drawingBufferWidth,yt.drawingBufferHeight];Pi=Ei==="fillOutlinePattern"&&Ti?Zm(Pr,Wr,w,vr,Ur,fi,vt):Xm(Pr,Wr,Ur,fi)}else Wi=Ji.indexBuffer,or=Ji.triangleSegments,Pi=Ti?ep(Pr,Wr,w,vr,fi,vt):wl(Pr,Wr,fi);w.uploadCommonUniforms(w.context,cr,ar.toUnwrapped());let qr=vi;(oe==="road"&&!de||oe==="offset")&&(qr=li),cr.draw(w,ji,qr,f||w.stencilModeForClipping(ar),Q,fn.disabled,Pi,R.id,Ji.layoutVertexBuffer,Wi,or,R.paint,w.transform.zoom,zi,gr)}};w.renderPass===pe&&wi(w.depthModeForSublayer(1,w.renderPass==="opaque"?Hr.ReadWrite:Hr.ReadOnly),!1),At==="none"&&w.renderPass==="translucent"&&R.paint.get("fill-antialias")&&wi(w.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,Hr.ReadOnly),!0)}function Ma(b,a,f,w,P,R,H,Q){f.resetLayerRenderingStats(b);const oe=b.context,de=oe.gl,pe=b.transform,yt=f.paint.get("fill-extrusion-pattern"),pt=f.paint.get("fill-extrusion-pattern-cross-fade"),vt=yt.constantOr(null),Dt=yt.constantOr(1),At=f.paint.get("fill-extrusion-opacity"),Ot=b.style.enable3dLights(),Bt=f.paint.get(Ot&&!Dt?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),qt=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),Bt],li=f.layout.get("fill-extrusion-edge-radius"),fi=li>0&&!f.paint.get("fill-extrusion-rounded-roof"),Ti=fi?0:li,wi=pe.projection.name==="globe"?n.dV():0,vi=pe.projection.name==="globe",di=vi?n.ah(pe.zoom):0,Ei=[n.aD(pe.center.lng),n.aH(pe.center.lat)],Pi=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ji=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Pi?null:f.lut).toArray01().slice(0,3),Wi=f.paint.get("fill-extrusion-flood-light-intensity"),or=f.paint.get("fill-extrusion-vertical-scale"),ar=f.paint.get("fill-extrusion-line-width").constantOr(1)!==0,vr=f.paint.get("fill-extrusion-height-alignment"),Ui=f.paint.get("fill-extrusion-base-alignment"),Ji=fa(b,f.paint.get("fill-extrusion-cutoff-fade-range")),zi=[];let ur;vi&&zi.push("PROJECTION_GLOBE_VIEW"),qt[0]>0&&zi.push("FAUX_AO"),fi&&zi.push("ZERO_ROOF_RADIUS"),Q&&zi.push("HAS_CENTROID"),Wi>0&&zi.push("FLOOD_LIGHT"),Ji.shouldRenderCutoff&&zi.push("RENDER_CUTOFF"),ar&&zi.push("RENDER_WALL_MODE");const Zi=b.renderPass==="shadow",gr=b.shadowRenderer,kr=Zi&&!!gr,cr=Zi?fn.disabled:fn.backCCW;b.shadowRenderer&&(b.shadowRenderer.useNormalOffset=!0);let Pr=[0,0,0];if(gr){const Ur=b.style.directionalLight,Qr=b.style.ambientLight;Ur&&Qr&&(Pr=_l(b.style,Ur,Qr)),Zi||(zi.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gr.useNormalOffset&&zi.push("NORMAL_OFFSET")),ur=zi.concat(["SHADOWS_SINGLE_CASCADE"])}const Wr=kr?"fillExtrusionDepth":Dt?"fillExtrusionPattern":"fillExtrusion",qr=f.getLayerRenderingStats();for(const Ur of w){const Qr=a.getTile(Ur),nn=Qr.getBucket(f);if(!nn||nn.projection.name!==pe.projection.name)continue;let ln=!1;gr&&(ln=gr.getMaxCascadeForTile(Ur.toUnwrapped())===0);const gn=b.isTileAffectedByFog(Ur),En=nn.programConfigurations.get(f.id);let ss=!1;if(vt&&Qr.imageAtlas){const Fn=Qr.imageAtlas,Cs=n.dN.from(vt),io=Cs.getPrimary().scaleSelf(n.q.devicePixelRatio).toString(),Ss=Cs.getSecondary(),Kn=Fn.patternPositions.get(io),Gs=Ss?Fn.patternPositions.get(Ss.scaleSelf(n.q.devicePixelRatio).toString()):null;ss=!!Kn&&!!Gs,Kn&&En.setConstantPatternPositions(Kn,Gs)}pt>0&&(ss||En.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&zi.push("FILL_EXTRUSION_PATTERN_TRANSITION");const ws=b.getOrCreateProgram(Wr,{config:En,defines:ln?ur:zi,overrideFog:gn});if(b.terrain&&b.terrain.setupElevationDraw(Qr,ws,{useMeterToDem:!0}),!nn.centroidVertexBuffer){const Fn=ws.attributes.a_centroid_pos;Fn!==void 0&&de.vertexAttrib2f(Fn,0,0)}!Zi&&gr&&gr.setupShadows(Qr.tileID.toUnwrapped(),ws,"vector-tile",Qr.tileID.overscaledZ),Dt&&(b.context.activeTexture.set(de.TEXTURE0),Qr.imageAtlasTexture&&Qr.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),En.updatePaintBuffers());const cs=f.paint.get("fill-extrusion-vertical-gradient"),fs=1/nn.tileToMeter;let qs;if(Zi&&gr){if(qa(Qr.tileID,nn,b))continue;const Fn=gr.calculateShadowPassMatrixFromTile(Qr.tileID.toUnwrapped());qs=Jd(Fn,Ti,fs,or,vr,Ui)}else{const Fn=b.translatePosMatrix(Ur.expandedProjMatrix,Qr,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Cs=pe.projection.createInversionMatrix(pe,Ur.canonical);qs=Dt?Qd(Fn,b,cs,At,qt,Ti,fs,Ur,Qr,wi,vr,Ui,di,Ei,Cs,ji,or,pt):Xc(Fn,b,cs,At,qt,Ti,fs,Ur,wi,vr,Ui,di,Ei,Cs,ji,or,Wi,Pr)}b.uploadCommonUniforms(oe,ws,Ur.toUnwrapped(),null,Ji);let xn=nn.segments;if(pe.projection.name==="mercator"&&!Zi&&(xn=nn.getVisibleSegments(Qr.tileID,b.terrain,b.transform.getFrustum(0)),!xn.get().length))continue;if(qr)if(Zi)for(const Fn of xn.get())qr.numRenderedVerticesInShadowPass+=Fn.primitiveLength;else for(const Fn of xn.get())qr.numRenderedVerticesInTransparentPass+=Fn.primitiveLength;const Cn=[];(b.terrain||Q)&&Cn.push(nn.centroidVertexBuffer),vi&&Cn.push(nn.layoutVertexExtBuffer),ar&&Cn.push(nn.wallVertexBuffer),ws.draw(b,oe.gl.TRIANGLES,P,R,H,cr,qs,f.id,nn.layoutVertexBuffer,nn.indexBuffer,xn,f.paint,b.transform.zoom,En,Cn)}b.shadowRenderer&&(b.shadowRenderer.useNormalOffset=!1)}function Aa(b,a,f,w,P,R,H,Q,oe,de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt){const li=b.context,fi=li.gl,Ti=b.transform,wi=b.transform.zoom,vi=[],di=fa(b,f.paint.get("fill-extrusion-cutoff-fade-range"));de==="clear"?(vi.push("CLEAR_SUBPASS"),qt&&(vi.push("CLEAR_FROM_TEXTURE"),li.activeTexture.set(fi.TEXTURE0),qt.bind(fi.LINEAR,fi.CLAMP_TO_EDGE))):de==="sdf"&&vi.push("SDF_SUBPASS"),Ot&&vi.push("HAS_CENTROID"),di.shouldRenderCutoff&&vi.push("RENDER_CUTOFF");const Ei=f.layout.get("fill-extrusion-edge-radius"),Pi=(ji,Wi,or,ar,vr)=>{const Ui=Wi.programConfigurations.get(f.id),Ji=b.isTileAffectedByFog(ji),zi=b.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ui,defines:vi,overrideFog:Ji}),ur=((gr,kr,cr,Pr,Wr,qr,Ur,Qr,nn,ln,gn)=>({u_matrix:kr,u_opacity:cr,u_ao_pass:Pr?1:0,u_meter_to_tile:Wr,u_ao:qr,u_flood_light_intensity:Ur,u_flood_light_color:Qr,u_attenuation:nn,u_edge_radius:ln,u_fb:0,u_fb_size:gn,u_dynamic_offset:1}))(0,ar,pe,oe,vr,[yt,pt*vr],vt,Dt,At,wi>=17?0:Ei*vr,qt?qt.size[0]:0),Zi=[];Ot&&Zi.push(Wi.hiddenByLandmarkVertexBuffer),b.uploadCommonUniforms(li,zi,ji.toUnwrapped(),null,di),zi.draw(b,li.gl.TRIANGLES,P,R,H,Q,ur,f.id,Wi.vertexBuffer,Wi.indexBuffer,or,f.paint,wi,Ui,Zi)};for(const ji of w){const Wi=a.getTile(ji),or=Wi.getBucket(f);if(!or||or.projection.name!==Ti.projection.name||!or.groundEffect||or.groundEffect&&!or.groundEffect.hasData())continue;const ar=or.groundEffect,vr=1/or.tileToMeter;{const Ui=b.translatePosMatrix(ji.projMatrix,Wi,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ji=ar.getDefaultSegment();Pi(ji,ar,Ji,Ui,vr)}if(Bt)for(let Ui=0;Ui<4;Ui++){const Ji=n.dT[Ui](ji),zi=a.getTile(Ji);if(!zi)continue;const ur=zi.getBucket(f);if(!ur||ur.projection.name!==Ti.projection.name||!ur.groundEffect||ur.groundEffect&&!ur.groundEffect.hasData())continue;const Zi=ur.groundEffect;let gr,kr;Ui===0?(gr=[-8192,0,0],kr=1):Ui===1?(gr=[n.aj,0,0],kr=0):Ui===2?(gr=[0,-8192,0],kr=3):(gr=[0,n.aj,0],kr=2);const cr=Zi.regionSegments[kr];if(!cr)continue;const Pr=new Float32Array(16);n.bo(Pr,ji.projMatrix,gr),Pi(ji,Zi,cr,b.translatePosMatrix(Pr,Wi,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),vr)}}}function jr(b,a,f,w,P,R,H){w.centroidVertexArray.length===0&&w.createCentroidsBuffer();const Q=R?R.findDEMTileFor(f):null;if(!(Q&&Q.dem||H))return;R&&Q&&Q.dem&&w.selfDEMTileTimestamp!==Q.dem._timestamp&&(w.borderDoneWithNeighborZ=[-1,-1,-1,-1],w.selfDEMTileTimestamp=Q.dem._timestamp);const oe=Bt=>new n.P(Math.ceil((Bt+n.dX)*n.dY),0),de=Bt=>{const qt=a.getSource().minzoom,li=Ti=>{const wi=a.getTileByID(Ti);if(wi&&wi.hasData())return wi.getBucket(P)},fi=[0,-1,1];for(const Ti of fi){if(Bt.overscaledZ+Ti<qt)continue;const wi=li(Bt.calculateScaledKey(Bt.overscaledZ+Ti));if(wi)return wi}},pe=[0,0,0],yt=(Bt,qt)=>(pe[0]=Math.min(Bt.min.y,qt.min.y),pe[1]=Math.max(Bt.max.y,qt.max.y),pe[2]=n.aj-qt.min.x>Bt.max.x?qt.min.x-n.aj:Bt.max.x,pe),pt=(Bt,qt)=>(pe[0]=Math.min(Bt.min.x,qt.min.x),pe[1]=Math.max(Bt.max.x,qt.max.x),pe[2]=n.aj-qt.min.y>Bt.max.y?qt.min.y-n.aj:Bt.max.y,pe),vt=[(Bt,qt)=>yt(Bt,qt),(Bt,qt)=>yt(qt,Bt),(Bt,qt)=>pt(Bt,qt),(Bt,qt)=>pt(qt,Bt)],Dt=(Bt,qt,li,fi,Ti,wi,vi)=>{if(!R)return 0;const di=[[wi?li:Bt,wi?Bt:li,0],[wi?li:qt,wi?qt:li,0]],Ei=vi<0?n.aj+vi:vi,Pi=[wi?Ei:(Bt+qt)/2,wi?(Bt+qt)/2:Ei,0];return li===0&&vi<0||li!==0&&vi>0?R.getForTilePoints(Ti,[Pi],!0,fi):di.push(Pi),R.getForTilePoints(f,di,!0,Q),Math.max(di[0][2],di[1][2],Pi[2])/R.exaggeration()};for(let Bt=0;Bt<4;Bt++){const qt=w.borderFeatureIndices[Bt];if(qt.length===0)continue;const li=n.dT[Bt](f),fi=de(li);if(!(fi&&fi instanceof n.dU))continue;const Ti=R?R.findDEMTileFor(li):null;if(!(Ti&&Ti.dem||H)||(R&&Ti&&Ti.dem&&w.borderDEMTileTimestamp[Bt]!==Ti.dem._timestamp&&(w.borderDoneWithNeighborZ[Bt]=-1,w.borderDEMTileTimestamp[Bt]=Ti.dem._timestamp),w.borderDoneWithNeighborZ[Bt]===fi.canonical.z))continue;fi.centroidVertexArray.length===0&&fi.createCentroidsBuffer();const wi=(Bt<2?1:5)-Bt,vi=fi.borderDoneWithNeighborZ[wi]!==w.canonical.z,di=fi.borderFeatureIndices[wi];let Ei=0;if(w.canonical.z!==fi.canonical.z){for(const Pi of qt)w.showCentroid(w.featuresOnBorder[Pi]);if(vi)for(const Pi of di)fi.showCentroid(fi.featuresOnBorder[Pi]);w.borderDoneWithNeighborZ[Bt]=fi.canonical.z,fi.borderDoneWithNeighborZ[wi]=w.canonical.z}for(const Pi of qt){const ji=w.featuresOnBorder[Pi],Wi=w.centroidData[ji.centroidDataIndex],or=ji.borders[Bt];let ar;for(;Ei<di.length;){ar=fi.featuresOnBorder[di[Ei]];const vr=ar.borders[wi];if(vr[1]>or[0]+3||vr[0]>or[0]-3)break;fi.showCentroid(ar),Ei++}if(ar&&Ei<di.length){const vr=Ei;let Ui=0;for(;!(ar.borders[wi][0]>or[1]-3)&&(Ui++,++Ei!==di.length);)ar=fi.featuresOnBorder[di[Ei]];ar=fi.featuresOnBorder[di[vr]];let Ji=!1;if(Ui>=1){const Zi=ar.borders[wi];Math.abs(or[0]-Zi[0])<3&&Math.abs(or[1]-Zi[1])<3&&(Ui=1,Ji=!0,Ei=vr+1)}else if(Ui===0){w.showCentroid(ji);continue}const zi=fi.centroidData[ar.centroidDataIndex];H&&Ji&&(((At=Wi).flags|(Ot=zi).flags)&n.dW?(At.flags|=n.dW,Ot.flags|=n.dW):(At.flags&=2147483647,Ot.flags&=2147483647));const ur=ji.intersectsCount()>1||ar.intersectsCount()>1;if(Ui>1)Ei=vr,Wi.centroidXY=zi.centroidXY=new n.P(0,0);else if(Ti&&Ti.dem&&!ur){const Zi=vt[Bt](Wi,zi),gr=Bt%2?n.aj-1:0,kr=Dt(Zi[0],Math.min(n.aj-1,Zi[1]),gr,Ti,li,Bt<2,Zi[2]);Wi.centroidXY=zi.centroidXY=oe(kr)}else ur?Wi.centroidXY=zi.centroidXY=new n.P(0,0):(Wi.centroidXY=w.encodeBorderCentroid(ji),zi.centroidXY=fi.encodeBorderCentroid(ar));w.writeCentroidToBuffer(Wi),fi.writeCentroidToBuffer(zi)}else w.showCentroid(ji)}w.borderDoneWithNeighborZ[Bt]=fi.canonical.z,fi.borderDoneWithNeighborZ[wi]=w.canonical.z}var At,Ot;(w.needsCentroidUpdate||!w.centroidVertexBuffer&&w.centroidVertexArray.length!==0)&&w.uploadCentroid(b)}const ap=[1,0,0],lp=[0,1,0],Wa=[0,0,1];function qa(b,a,f){const w=f.transform,P=f.shadowRenderer;if(!P)return!0;const R=b.toUnwrapped(),H=w.tileSize*P._cascades[f.currentShadowCascade].scale;let Q=a.maxHeight;if(w.elevation){const At=w.elevation.getMinMaxForTile(b);At&&(Q+=At.max)}const oe=[...P.shadowDirection];oe[2]=-oe[2];const de=P.computeSimplifiedTileShadowVolume(R,Q,H,oe);if(!de)return!1;const pe=[ap,lp,Wa,oe,[oe[0],0,oe[2]],[0,oe[1],oe[2]]],yt=w.projection.name==="globe",pt=w.scaleZoom(H),vt=n.cn.fromInvProjectionMatrix(w.invProjMatrix,w.worldSize,pt,!yt),Dt=P.getCurrentCascadeFrustum();return vt.intersectsPrecise(de.vertices,de.planes,pe)===0||Dt.intersectsPrecise(de.vertices,de.planes,pe)===0}function cn(b){return[b[0]*n.dZ,b[1]*n.dZ,b[2]*n.dZ,0]}function eu(b,a,f,w,P,R,H,Q,oe){const de=w.getSource(),pe=f.globeSharedBuffers;if(!pe)return;let yt,pt,vt;if(a&&(yt=w.getTile(a)),de instanceof n.aP?(pt=de.texture,vt=n.ds(0,0,f.transform)):yt&&a&&(pt=yt.texture,vt=n.ds(a.canonical.z,a.canonical.x,f.transform)),!pt||!vt)return;b||(vt=n.cE(n.bz(),vt,[1,-1,1]));const Dt=f.context,At=Dt.gl,Ot=P.paint.get("raster-resampling")==="nearest"?At.NEAREST:At.LINEAR,Bt=f.colorModeForDrapableLayerRenderPass(R),qt=H.defines;qt.push("GLOBE_POLES");const li=new Hr(At.LEQUAL,Hr.ReadWrite,f.depthRangeFor3D),fi=Float32Array.from(f.transform.expandedFarZProjMatrix),Ti=Float32Array.from(n.bh(n.dr(new n.cp(0,0,0))));f.terrain&&f.terrain.prepareDrawTile(),Dt.activeTexture.set(At.TEXTURE0),pt.bind(Ot,At.CLAMP_TO_EDGE),Dt.activeTexture.set(At.TEXTURE1),pt.bind(Ot,At.CLAMP_TO_EDGE),"useMipmap"in pt&&Dt.extTextureFilterAnisotropic&&f.transform.pitch>20&&At.texParameterf(At.TEXTURE_2D,Dt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Dt.extTextureFilterAnisotropicMax);const[wi,vi,di,Ei]=a?pe.getPoleBuffers(a.canonical.z,!1):pe.getPoleBuffers(0,!0),Pi=P.paint.get("raster-elevation");let ji;b?(ji=wi,f.renderDefaultNorthPole=Pi!==0):(ji=vi,f.renderDefaultSouthPole=Pi!==0);const Wi=cn(H.mix),or=((vr,Ui,Ji,zi,ur,Zi,gr,kr,cr,Pr,Wr,qr,Ur)=>Sf(vr,Ui,Ji,new Float32Array(16),new Float32Array(9),[0,0],zi,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Zi,[0,0],kr,2,Pr,Wr,qr,1,0,Ur))(fi,Ti,vt,n.ah(f.transform.zoom),0,P,0,Pi,0,Wi,H.offset,H.range,R),ar=f.getOrCreateProgram("raster",{defines:qt});f.uploadCommonUniforms(Dt,ar,null),ar.draw(f,At.TRIANGLES,li,oe,Bt,Q,or,P.id,ji,di,Ei)}function tg(b){const a=b._nearZ,f=b.projection.farthestPixelDistance(b),w=f-a,P=.2*b.height,R=a+P;return[a,f,(R-P-a)/w,(R-a)/w]}function ig(b,a,f,w){if(b)return a instanceof za&&b instanceof kl?a.getTextureDescriptor(b,f,!0):{texture:b.texture,mix:cn(w.mix),offset:w.offset,buffer:0,tileSize:1}}var Pf=n.d_([{name:"a_index",type:"Int16",components:1}]);class cp{constructor(a,f,w,P){const R={width:w[0],height:w[1],data:null},H=a.gl;this.targetColorTexture=new n.T(a,R,H.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(a,R,H.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(f,P),this.lastInvalidatedAt=0}updateParticleTexture(a,f){if(this.particleTextureDimension===f.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const w=this.context.gl,P=f.width*f.height;this.particleTexture0=new n.T(this.context,f,w.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,f,w.RGBA8,{premultiply:!1,useMipmap:!1});const R=new n.d$;R.reserve(P);for(let H=0;H<P;H++)R.emplaceBack(H);this.particleIndexBuffer=this.context.createVertexBuffer(R,Pf.members,!0),this.particleSegment=n.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=f.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function rg(b,a,f){if(!b)return null;const w=a.getTextureDescriptor(b,f,!0);if(!w)return null;let{texture:P,mix:R,offset:H,tileSize:Q,buffer:oe,format:de}=w;if(!P||!de)return null;let pe=!1;return de==="uint32"&&(pe=!0,R[3]=0,R=Sl(n.e0,R,[0,f.paint.get("raster-particle-max-speed")]),H=wf(n.e0,H,[0,f.paint.get("raster-particle-max-speed")])),{texture:P,textureOffset:[oe/(Q+2*oe),Q/(Q+2*oe)],tileSize:Q,scalarData:pe,scale:R,offset:H,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[de]]}}function up(b){const a=b._nearZ,f=b.projection.farthestPixelDistance(b),w=f-a,P=.2*b.height,R=a+P;return[a,f,(R-P-a)/w,(R-a)/w]}const ng=new n.am(1,0,0,1),sg=new n.am(0,1,0,1),Bo=new n.am(0,0,1,1),If=new n.am(1,0,1,1),Po=new n.am(0,1,1,1);function Ca(b,a,f,w,P,R){for(let H=0;H<f.length;H++)if(P){const de=new n.am(w.r*.8,w.g*.8,w.b*.8,1);El(b,a,f[H],w,-1,-1,R),El(b,a,f[H],w,-1,1,R),El(b,a,f[H],w,1,1,R),El(b,a,f[H],w,1,-1,R),El(b,a,f[H],de,0,0,R)}else El(b,a,f[H],w,0,0,R)}function El(b,a,f,w,P,R,H){const Q=b.context,oe=b.transform,de=Q.gl,pe=oe.projection.name==="globe",yt=pe?["PROJECTION_GLOBE_VIEW"]:[];let pt=n.bw(f.projMatrix);if(pe&&n.ah(oe.zoom)>0){const Wi=n.bg(f.canonical,oe),or=n.e1(Wi);pt=n.az(new Float32Array(16),oe.globeMatrix,or),n.az(pt,oe.projMatrix,pt)}const vt=n.bz();vt[12]+=2*P/(n.q.devicePixelRatio*oe.width),vt[13]+=2*R/(n.q.devicePixelRatio*oe.height),n.az(pt,vt,pt);const Dt=b.getOrCreateProgram("debug",{defines:yt}),At=a.getTileByID(f.key);b.terrain&&b.terrain.setupElevationDraw(At,Dt);const Ot=Hr.disabled,Bt=_n.disabled,qt=b.colorModeForRenderPass(),li="$debug";Q.activeTexture.set(de.TEXTURE0),b.emptyTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),pe?At._makeGlobeTileDebugBuffers(b.context,oe):At._makeDebugTileBoundsBuffers(b.context,oe.projection);const fi=At._tileDebugBuffer||b.debugBuffer,Ti=At._tileDebugIndexBuffer||b.debugIndexBuffer,wi=At._tileDebugSegments||b.debugSegments;if(Dt.draw(b,de.LINE_STRIP,Ot,Bt,qt,fn.disabled,oh(pt,w.toPremultipliedRenderColor(null)),li,fi,Ti,wi,null,null,null,[At._globeTileDebugBorderBuffer]),H){const Wi=At.latestRawTileData,or=Math.floor((Wi&&Wi.byteLength||0)/1024);let ar=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(ar+=` => ${f.overscaledZ}`),ar+=` ${At.state}`,ar+=` ${or}kb`,function(vr,Ui){vr.initDebugOverlayCanvas();const Ji=vr.debugOverlayCanvas,zi=vr.context.gl,ur=vr.debugOverlayCanvas.getContext("2d");ur.clearRect(0,0,Ji.width,Ji.height),ur.shadowColor="white",ur.shadowBlur=2,ur.lineWidth=1.5,ur.strokeStyle="white",ur.textBaseline="top",ur.font="bold 36px Open Sans, sans-serif",ur.fillText(Ui,5,5),ur.strokeText(Ui,5,5),vr.debugOverlayTexture.update(Ji),vr.debugOverlayTexture.bind(zi.LINEAR,zi.CLAMP_TO_EDGE)}(b,ar)}const vi=a.getTile(f).tileSize,di=512/Math.min(vi,512)*(f.overscaledZ/oe.zoom)*.5,Ei=At._tileDebugTextBuffer||b.debugBuffer,Pi=At._tileDebugTextIndexBuffer||b.quadTriangleIndexBuffer,ji=At._tileDebugTextSegments||b.debugSegments;Dt.draw(b,de.TRIANGLES,Ot,Bt,In.alphaBlended,fn.disabled,oh(pt,n.am.transparent.toPremultipliedRenderColor(null),di),li,Ei,Pi,ji,null,null,null,[At._globeTileDebugTextBuffer])}function uh(b,a,f,w){tc(b,0,a+f/2,b.transform.width,f,w)}function hh(b,a,f,w){tc(b,a-f/2,0,f,b.transform.height,w)}function tc(b,a,f,w,P,R){const H=b.context,Q=H.gl;Q.enable(Q.SCISSOR_TEST),Q.scissor(a*n.q.devicePixelRatio,f*n.q.devicePixelRatio,w*n.q.devicePixelRatio,P*n.q.devicePixelRatio),H.clear({color:R}),Q.disable(Q.SCISSOR_TEST)}const hp=n.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Pa}=hp;function ps(b,a,f,w){b.emplaceBack(a,f,w)}class tu{constructor(a){this.vertexArray=new n.e2,this.indices=new n.a_,ps(this.vertexArray,-1,-1,1),ps(this.vertexArray,1,-1,1),ps(this.vertexArray,-1,1,1),ps(this.vertexArray,1,1,1),ps(this.vertexArray,-1,-1,-1),ps(this.vertexArray,1,-1,-1),ps(this.vertexArray,-1,1,-1),ps(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Pa),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=n.bd.simpleSegment(0,0,36,12)}}function Xa(b,a,f,w,P,R){const H=b.context.gl,Q=a.paint.get("sky-atmosphere-color"),oe=a.paint.get("sky-atmosphere-halo-color"),de=a.paint.get("sky-atmosphere-sun-intensity"),pe=((yt,pt,vt,Dt,At)=>({u_matrix_3f:yt,u_sun_direction:pt,u_sun_intensity:vt,u_color_tint_r:[Dt.r,Dt.g,Dt.b,Dt.a],u_color_tint_m:[At.r,At.g,At.b,At.a],u_luminance:5e-5}))(n.e4(n.dx(),w),P,de,Q.toPremultipliedRenderColor(null),oe.toPremultipliedRenderColor(null));H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_CUBE_MAP_POSITIVE_X+R,a.skyboxTexture,0),f.draw(b,H.TRIANGLES,Hr.disabled,_n.disabled,In.unblended,fn.frontCW,pe,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const fp=n.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dp{constructor(a){const f=new n.e5;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const w=new n.a_;w.emplaceBack(0,1,2),w.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,fp.members),this.indexBuffer=a.createIndexBuffer(w),this.segments=n.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pp=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class og{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ic{constructor(a){this.colorModeAlphaBlendedWriteRGB=new In([1,gl,1,gl],n.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new In([1,0,1,0],n.am.transparent,[!1,!1,!1,!0]),this.params=new og,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const f=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new dp(f);const w=this.params.sizeRange,P=this.params.intensityRange,R=function(pe){const yt=n.e7(30),pt=[];for(let vt=0;vt<pe;++vt){const Dt=2*Math.PI*yt(),At=Math.acos(1-2*yt())-.5*Math.PI;pt.push(n.cS(Math.cos(At)*Math.cos(Dt),Math.cos(At)*Math.sin(Dt),Math.sin(At)))}return pt}(this.params.starsCount),H=n.e7(300),Q=new n.e6,oe=new n.a_;let de=0;for(let pe=0;pe<R.length;++pe){const yt=n.bY([],R[pe],200),pt=Math.max(0,1+.01*w*(1*H()-.5)),vt=Math.max(0,1+.01*P*(1*H()-.5));Q.emplaceBack(yt[0],yt[1],yt[2],-1,-1,pt,vt),Q.emplaceBack(yt[0],yt[1],yt[2],1,-1,pt,vt),Q.emplaceBack(yt[0],yt[1],yt[2],1,1,pt,vt),Q.emplaceBack(yt[0],yt[1],yt[2],-1,1,pt,vt),oe.emplaceBack(de+0,de+1,de+2),oe.emplaceBack(de+0,de+2,de+3),de+=4}this.starsVx=f.createVertexBuffer(Q,pp.members),this.starsIdx=f.createIndexBuffer(oe),this.starsSegments=n.bd.simpleSegment(0,0,Q.length,oe.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,f){const w=a.context,P=w.gl,R=a.transform,H=new Hr(P.LEQUAL,Hr.ReadOnly,[0,1]),Q=n.ah(R.zoom),oe=a.style.getLut(f.scope),de=f.properties.get("color-use-theme")==="none",pe=f.properties.get("color").toNonPremultipliedRenderColor(de?null:oe).toArray01(),yt=f.properties.get("high-color-use-theme")==="none",pt=f.properties.get("high-color").toNonPremultipliedRenderColor(yt?null:oe).toArray01(),vt=f.properties.get("space-color-use-theme")==="none",Dt=f.properties.get("space-color").toNonPremultipliedRenderColor(vt?null:oe).toArray01(),At=5e-4,Ot=n.e8(f.properties.get("horizon-blend"),0,1,At,.25),Bt=n.dl(a,w,R)&&Ot===At?R.worldSize/(2*Math.PI*1.025)-1:R.globeRadius,qt=a.frameCounter/1e3%1,li=n.ae(R.globeCenterInViewSpace),fi=Math.sqrt(Math.pow(li,2)-Math.pow(Bt,2)),Ti=Math.acos(fi/li),wi=vi=>{const di=R.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];vi&&di.push("ALPHA_PASS");const Ei=a.getOrCreateProgram("globeAtmosphere",{defines:di}),Pi=((Wi,or,ar,vr,Ui,Ji,zi,ur,Zi,gr,kr,cr)=>({u_frustum_tl:Wi,u_frustum_tr:or,u_frustum_br:ar,u_frustum_bl:vr,u_horizon:Ui,u_transition:Ji,u_fadeout_range:zi,u_color:ur,u_high_color:Zi,u_space_color:gr,u_temporal_offset:kr,u_horizon_angle:cr}))(R.frustumCorners.TL,R.frustumCorners.TR,R.frustumCorners.BR,R.frustumCorners.BL,R.frustumCorners.horizon,Q,Ot,pe,pt,Dt,qt,Ti);a.uploadCommonUniforms(w,Ei);const ji=this.atmosphereBuffer;ji&&Ei.draw(a,P.TRIANGLES,H,_n.disabled,vi?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fn.backCW,Pi,vi?"atmosphere_glow_alpha":"atmosphere_glow",ji.vertexBuffer,ji.indexBuffer,ji.segments)};wi(!1),wi(!0)}drawStars(a,f){const w=n.ay(f.properties.get("star-intensity"),0,1);if(w===0)return;const P=a.context,R=P.gl,H=a.transform,Q=a.getOrCreateProgram("stars"),oe=n.b_([]);n.c0(oe,oe,-H._pitch),n.b$(oe,oe,-H.angle),n.c0(oe,oe,n.al(H._center.lat)),n.e9(oe,oe,-n.al(H._center.lng));const de=n.c3(new Float32Array(16),oe),pe=n.az([],H.starsProjMatrix,de),yt=n.e4([],de),pt=n.ea([],yt),vt=[0,1,0];n.dz(vt,vt,pt),n.bY(vt,vt,this.params.sizeMultiplier);const Dt=[1,0,0];n.dz(Dt,Dt,pt),n.bY(Dt,Dt,this.params.sizeMultiplier);const At=(Ot=vt,Bt=Dt,qt=w,{u_matrix:Float32Array.from(pe),u_up:Ot,u_right:Bt,u_intensity_multiplier:qt});var Ot,Bt,qt;a.uploadCommonUniforms(P,Q),this.starsVx&&this.starsIdx&&Q.draw(a,R.TRIANGLES,Hr.disabled,_n.disabled,this.colorModeAlphaBlendedWriteRGB,fn.disabled,At,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ml(b,a){const f=[...b],w=a.cameraWorldSizeForFog/a.worldSize,P=n.bx([]);return n.cE(P,P,[w,w,1]),n.az(f,P,f),n.az(f,a.worldToFogMatrix,f),f}function Mr(b,a,f,w,P){const R=f.material,H=w.context,{baseColorTexture:Q,metallicRoughnessTexture:oe}=R.pbrMetallicRoughness,{normalTexture:de,occlusionTexture:pe,emissionTexture:yt}=R;function pt(Dt,At,Ot){if(Dt&&(b.push(At),H.activeTexture.set(H.gl.TEXTURE0+Ot),Dt.gfxTexture)){const{minFilter:Bt,magFilter:qt,wrapS:li,wrapT:fi}=Dt.sampler;Dt.gfxTexture.bindExtraParam(Bt,qt,li,fi)}}pt(Q,"HAS_TEXTURE_u_baseColorTexture",Co.BaseColor),pt(oe,"HAS_TEXTURE_u_metallicRoughnessTexture",Co.MetallicRoughness),pt(de,"HAS_TEXTURE_u_normalTexture",Co.Normal),pt(pe,"HAS_TEXTURE_u_occlusionTexture",Co.Occlusion),pt(yt,"HAS_TEXTURE_u_emissionTexture",Co.Emission),P&&(P.texture||(P.texture=new n.eh(w.context,P.image,[P.image.height,P.image.height,P.image.height],H.gl.RGBA8)),H.activeTexture.set(H.gl.TEXTURE0+Co.LUT),P.texture&&P.texture.bind(H.gl.LINEAR,H.gl.CLAMP_TO_EDGE),b.push("APPLY_LUT_ON_GPU")),f.texcoordBuffer&&(b.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(f.texcoordBuffer)),f.colorBuffer&&(b.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(f.colorBuffer)),f.normalBuffer&&(b.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(f.normalBuffer)),f.pbrBuffer&&(b.push("HAS_ATTRIBUTE_a_pbr"),b.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(f.pbrBuffer)),R.alphaMode!=="OPAQUE"&&R.alphaMode!=="MASK"||b.push("UNPREMULT_TEXTURE_IN_SHADER"),R.defined||b.push("DIFFUSE_SHADED");const vt=w.shadowRenderer;vt&&(b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),vt.useNormalOffset&&b.push("NORMAL_OFFSET"))}function $r(b,a,f,w,P,R){const H=f.paint.get("model-opacity").constantOr(1),Q=a.context,oe=new Hr(a.context.gl.LEQUAL,Hr.ReadWrite,a.depthRangeFor3D),de=a.transform,pe=b.mesh,yt=pe.material,pt=yt.pbrMetallicRoughness,vt=a.style.fog;let Dt;Dt=a.transform.projection.zAxisUnit==="pixels"?[...b.nodeModelMatrix]:n.az([],w.zScaleMatrix,b.nodeModelMatrix),n.az(Dt,w.negCameraPosMatrix,Dt);const At=n.bi([],Dt);n.ee(At,At);const Ot=f.paint.get("model-color-use-theme").constantOr("default")==="none",Bt=f.paint.get("model-emissive-strength").constantOr(0),qt=Kc(new Float32Array(b.worldViewProjection),new Float32Array(Dt),new Float32Array(At),null,a,H,pt.baseColorFactor,yt.emissiveFactor,pt.metallicFactor,pt.roughnessFactor,yt,Bt,f),li={defines:[]},fi=[],Ti=a.shadowRenderer;Ti&&(Ti.useNormalOffset=!1),Mr(li.defines,fi,pe,a,Ot?null:f.lut);let wi=null;if(vt){const Ei=Ml(b.nodeModelMatrix,a.transform);if(wi=new Float32Array(Ei),de.projection.name!=="globe"){const Pi=pe.aabb.min,ji=pe.aabb.max,[Wi,or]=vt.getOpacityForBounds(Ei,Pi[0],Pi[1],ji[0],ji[1]);li.overrideFog=Wi>=Bi||or>=Bi}}const vi=fa(a,f.paint.get("model-cutoff-fade-range"));vi.shouldRenderCutoff&&li.defines.push("RENDER_CUTOFF");const di=a.getOrCreateProgram("model",li);a.uploadCommonUniforms(Q,di,null,wi,vi),a.renderPass!=="shadow"&&Ti&&Ti.setupShadowsFromMatrix(b.nodeModelMatrix,di),di.draw(a,Q.gl.TRIANGLES,oe,P,R,pe.material.doubleSided?fn.disabled:fn.backCCW,qt,f.id,pe.vertexBuffer,pe.indexBuffer,pe.segments,f.paint,a.transform.zoom,void 0,fi)}function Al(b,a,f,w,P,R,H){let Q;Q=b.projection.name==="globe"?n.ed(f,b):[...f],n.az(Q,Q,a.matrix);const oe=n.az([],w,Q);if(a.meshes)for(const de of a.meshes){if(de.material.alphaMode!=="BLEND"){H.push({mesh:de,depth:0,modelIndex:P,worldViewProjection:oe,nodeModelMatrix:Q});continue}const pe=n.ad([],de.centroid,oe);!b.isOrthographic&&pe[2]<=0||R.push({mesh:de,depth:pe[2],modelIndex:P,worldViewProjection:oe,nodeModelMatrix:Q})}if(a.children)for(const de of a.children)Al(b,de,f,w,P,R,H)}function Us(b,a,f,w){const P=f.shadowRenderer;if(!P)return;const R=P.getShadowPassDepthMode(),H=P.getShadowPassColorMode(),Q=P.calculateShadowPassMatrixFromMatrix(a),oe=np(Q);f.getOrCreateProgram("modelDepth",{defines:f._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,R,_n.disabled,H,fn.backCCW,oe,w.id,b.vertexBuffer,b.indexBuffer,b.segments,w.paint,f.transform.zoom,void 0,void 0)}function Gi(b,a,f){const w=a.updateZoomBasedPaintProperties(),P=function(R,H,Q){let oe,de,pe,yt=R.terrain?R.terrain.exaggeration():0;if(R.terrain&&yt>0){const pt=R.terrain,vt=pt.findDEMTileFor(Q);vt&&vt.dem?oe=n.ei.create(pt,Q,vt):yt=0}if(yt===0&&(H.terrainElevationMin=0,H.terrainElevationMax=0),yt===H.validForExaggeration&&(yt===0||oe&&oe._demTile&&oe._demTile.tileID===H.validForDEMTile.id&&oe._dem._timestamp===H.validForDEMTile.timestamp))return!1;for(const pt in H.instancesPerModel){const vt=H.instancesPerModel[pt];for(let Dt=0;Dt<vt.instancedDataArray.length;++Dt){const At=(oe?yt*oe.getElevationAt(0|vt.instancedDataArray.float32[16*Dt],0|vt.instancedDataArray.float32[16*Dt+1],!0,!0):0)+vt.instancesEvaluatedElevation[Dt];vt.instancedDataArray.float32[16*Dt+6]=At,de=de?Math.min(H.terrainElevationMin,At):At,pe=pe?Math.max(H.terrainElevationMax,At):At}}return H.terrainElevationMin=de||0,H.terrainElevationMax=pe||0,H.validForExaggeration=yt,H.validForDEMTile=oe&&oe._demTile?{id:oe._demTile.tileID,timestamp:oe._dem._timestamp}:{id:void 0,timestamp:0},!0}(b,a,f);(w||P)&&(a.uploaded=!1,a.upload(b.context))}const oa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.cW([0,0,0],[n.aj,n.aj,0])};function fh(b,a){const f=1<<b.canonical.z,w=a.getFreeCameraOptions().position,P=a.elevation,R=b.canonical.x/f,H=(b.canonical.x+1)/f,Q=b.canonical.y/f,oe=(b.canonical.y+1)/f;let de=a._centerAltitude;if(P){const vt=P.getMinMaxForTile(b);vt&&vt.max>de&&(de=vt.max)}const pe=n.ay(w.x,R,H)-w.x,yt=n.ay(w.y,Q,oe)-w.y,pt=n.c6(de,a.center.lat)-w.z;return a._zoomFromMercatorZ(Math.sqrt(pe*pe+yt*yt+pt*pt))}function dh(b,a,f,w,P,R,H){const Q=b.context,oe=b.renderPass==="shadow",de=b.shadowRenderer,pe=oe&&de?de.getShadowPassDepthMode():new Hr(Q.gl.LEQUAL,Hr.ReadWrite,b.depthRangeFor3D),yt=b.isTileAffectedByFog(R);if(f.meshes)for(const pt of f.meshes){const vt=["MODEL_POSITION_ON_GPU"],Dt=[];let At,Ot,Bt;w.instancedDataArray.length>20&&vt.push("INSTANCED_ARRAYS");const qt=fa(b,a.paint.get("model-cutoff-fade-range"));if(qt.shouldRenderCutoff&&vt.push("RENDER_CUTOFF"),oe&&de)At=b.getOrCreateProgram("modelDepth",{defines:vt}),Ot=np(H.shadowTileMatrix,H.shadowTileMatrix,Float32Array.from(f.matrix)),Bt=de.getShadowPassColorMode();else{Mr(vt,Dt,pt,b,a.paint.get("model-color-use-theme").constantOr("default")==="none"?null:a.lut),At=b.getOrCreateProgram("model",{defines:vt,overrideFog:yt});const fi=pt.material,Ti=fi.pbrMetallicRoughness,wi=a.paint.get("model-opacity").constantOr(1),vi=a.paint.get("model-emissive-strength").constantOr(0);Ot=Kc(R.expandedProjMatrix,Float32Array.from(f.matrix),new Float32Array(16),null,b,wi,Ti.baseColorFactor,fi.emissiveFactor,Ti.metallicFactor,Ti.roughnessFactor,fi,vi,a,P),de&&(H.shadowUniformsInitialized?At.setShadowUniformValues(Q,de.getShadowUniformValues()):(de.setupShadows(R.toUnwrapped(),At,"model-tile",R.overscaledZ),H.shadowUniformsInitialized=!0)),Bt=qt.shouldRenderCutoff||wi<1||fi.alphaMode!=="OPAQUE"?In.alphaBlended:In.unblended}b.uploadCommonUniforms(Q,At,R.toUnwrapped(),null,qt);const li=pt.material.doubleSided?fn.disabled:fn.backCCW;if(w.instancedDataArray.length>20)Dt.push(w.instancedDataBuffer),At.draw(b,Q.gl.TRIANGLES,pe,_n.disabled,Bt,li,Ot,a.id,pt.vertexBuffer,pt.indexBuffer,pt.segments,a.paint,b.transform.zoom,void 0,Dt,w.instancedDataArray.length);else{const fi=oe?"u_instance":"u_normal_matrix";for(let Ti=0;Ti<w.instancedDataArray.length;++Ti)Ot[fi]=new Float32Array(w.instancedDataArray.arrayBuffer,64*Ti,16),At.draw(b,Q.gl.TRIANGLES,pe,_n.disabled,Bt,li,Ot,a.id,pt.vertexBuffer,pt.indexBuffer,pt.segments,a.paint,b.transform.zoom,void 0,Dt)}}if(f.children)for(const pt of f.children)dh(b,a,pt,w,P,R,H)}const Rf=[1,-1,1];function mp(b,a,f,w){if(!f.modelManager)return!0;const P=f.modelManager;if(!f.shadowRenderer)return!0;const R=f.shadowRenderer,H=a.aabb;let Q=!0,oe=b.maxHeight;if(oe===0){let pe=0;for(const yt in b.instancesPerModel){const pt=P.getModel(yt,w);pt?pe=Math.max(pe,Math.max(Math.max(pt.aabb.max[0],pt.aabb.max[1]),pt.aabb.max[2])):Q=!1}oe=b.maxScale*pe*1.41+b.maxVerticalOffset,Q&&(b.maxHeight=oe)}H.max[2]=oe,H.min[2]+=b.terrainElevationMin,H.max[2]+=b.terrainElevationMax,n.ad(H.min,H.min,a.tileMatrix),n.ad(H.max,H.max,a.tileMatrix);const de=H.intersects(R.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(b.isInsideFirstShadowMapFrustum=de===2),de===0}function gp(b,a){const f=b.uniformValues.u_cutoff_params[0],w=b.uniformValues.u_cutoff_params[1],P=b.uniformValues.u_cutoff_params[2],R=b.uniformValues.u_cutoff_params[3];return w===f||R===P?1:n.ay(((a-f)/(w-f)-P)/(R-P),0,1)}function rc(b,a,f,w){if(a.pitch<20)return 1;const P=a.getWorldToCameraMatrix();n.az(P,P,b);const R=n.ej(f.min[0],f.min[1],f.min[2],1);let H=n.aA(n.ek(),R,P),Q=H,oe=H;R[1]=f.max[1],H=n.aA(n.ek(),R,P),Q=H[1]<Q[1]?H:Q,oe=H[1]>oe[1]?H:oe,R[0]=f.max[0],H=n.aA(n.ek(),R,P),Q=H[1]<Q[1]?H:Q,oe=H[1]>oe[1]?H:oe,R[1]=f.min[1],H=n.aA(n.ek(),R,P),Q=H[1]<Q[1]?H:Q,oe=H[1]>oe[1]?H:oe;const de=n.ay(w[0],0,1),pe=100*a.pixelsPerMeter*n.ay(w[1],0,1),yt=n.ay(w[2],0,1),pt=n.el(n.ek(),Q,oe,de),vt=Math.tan(.5*a.fovX),Dt=-pt[2]*vt;if(pe===0)return pt[1]<-Math.abs(Dt)?yt:1;const At=(-Math.abs(Dt)-pt[1])/pe,Ot=(qt,li,fi)=>(1-fi)*qt+fi*li,Bt=n.ay(Ot(1,yt,At),yt,1);return Ot(1,Bt,n.ay((a.pitch-20)/20,0,1))}class ag{}class lg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,f,w){{const yt=this._storage.get(f.id);if(yt)return yt.lastUsedFrameIdx=a,yt.buf}const P=w.gl,R=P.getBufferParameter(P.ELEMENT_ARRAY_BUFFER,P.BUFFER_SIZE),H=new ArrayBuffer(R),Q=new Int16Array(H);P.getBufferSubData(P.ELEMENT_ARRAY_BUFFER,0,new Int16Array(H));const oe=new n.en;for(let yt=0;yt<R/2;yt+=3){const pt=Q[yt],vt=Q[yt+1],Dt=Q[yt+2];oe.emplaceBack(pt,vt),oe.emplaceBack(vt,Dt),oe.emplaceBack(Dt,pt)}const de=w.bindVertexArrayOES.current,pe=new ag;return pe.buf=new Jo(w,oe),pe.lastUsedFrameIdx=a,this._storage.set(f.id,pe),w.bindVertexArrayOES.set(de),pe.buf}update(a){for(const[f,w]of this._storage)a-w.lastUsedFrameIdx>30&&(w.buf.destroy(),this._storage.delete(f))}destroy(){for(const[a,f]of this._storage)f.buf.destroy(),this._storage.delete(a)}}class _p{constructor(a){this.occluderSize=30,this.depthOffset=-1e-4,a.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ph=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Lf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class kf{constructor(a,f){this.revealStart=11,this.revealRange=2,a.registerParameter(this,[...f,"Reveal"],"revealStart",{min:0,max:17,step:.05}),a.registerParameter(this,[...f,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const yp=n.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class mh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,f){const w=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const H=new n.eo,Q=new n.a_;H.emplaceBack(-1,-1),H.emplaceBack(1,-1),H.emplaceBack(1,1),H.emplaceBack(-1,1),Q.emplaceBack(0,1,2),Q.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(H,yp.members),this.vignetteIdx=a.context.createIndexBuffer(Q)}const P=n.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,w);const H={u_vignetteShape:(R={vignetteShape:[f.start,f.range,Math.pow(10,f.fadePower)],vignetteColor:[f.color.r,f.color.g,f.color.b,f.color.a*f.strength]}).vignetteShape,u_vignetteColor:R.vignetteColor};w.draw(a,a.context.gl.TRIANGLES,Hr.disabled,_n.disabled,In.alphaBlended,fn.disabled,H,"vignette",this.vignetteVx,this.vignetteIdx,P)}var R}}class iu{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,f){const w=a.getFreeCameraOptions().position,P=w.toAltitude(),R=w.toLngLat(),H=n.al(R.lng),Q=n.al(R.lat),oe=a.pixelsPerMeter/f,de=H*n.eq,pe=n.eq*Math.log(Math.tan(Math.PI/4+Q/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const yt=-this._offsetYPrev+pe,pt=-this._elevationPrev+P;this._accumulatedOffsetX+=(-this._offsetXPrev+de)*oe,this._accumulatedOffsetY+=yt*oe,this._accumulatedElevation+=pt*oe,this._offsetXPrev=de,this._offsetYPrev=pe,this._elevationPrev=P}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Cl(b,a){return[-(b[0]-Math.floor(b[0]/a)*a),-(b[1]-Math.floor(b[1]/a)*a),-(b[2]-Math.floor(b[2]/a)*a)]}function Df(b){const a=n.e7(1323123451230),f=[];for(let w=0;w<b;++w){const P=2*a()-1,R=2*a()-1,H=2*a()-1;f.push(n.cS(P,R,H))}return f}function Za(b,a,f,w,P){const R=n.ay((P-f)/(w-f),0,1);return(1-R)*b+R*a}class To{constructor(a){this._movement=new iu,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new mh,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,f){const w=a.transform;this._movement.update(w,this._ppmScaleFactor);const P=w.starsProjMatrix,R=n.b_([]);n.c0(R,R,n.al(90)-w._pitch),n.b$(R,R,-w.angle);const H=n.c3(new Float32Array(16),R),Q=n.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),oe=n.ee([],Q),de=n.az([],oe,H),pe=Date.now()/1e3;return this._accumulatedTimeFromStart+=(pe-this._prevTime)*f,this._prevTime=pe,{projectionMatrix:P,modelviewMatrix:de}}}class cg extends To{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new kf(a.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const f=a.context;if(!this.particlesVx){const w=Df(this.particlesCount),P=new n.er,R=new n.a_;let H=0;const Q=n.e7(1323123451230);for(let oe=0;oe<w.length;++oe){const de=w[oe],pe=[2*Q()-1,Q(),Q(),Q()];P.emplaceBack(de[0],de[1],de[2],-1,-1,...pe),P.emplaceBack(de[0],de[1],de[2],1,-1,...pe),P.emplaceBack(de[0],de[1],de[2],1,1,...pe),P.emplaceBack(de[0],de[1],de[2],-1,1,...pe),R.emplaceBack(H+0,H+1,H+2),R.emplaceBack(H+0,H+2,H+3),H+=4}this.particlesVx=f.createVertexBuffer(P,ph.members),this.particlesIdx=f.createIndexBuffer(R)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const f=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=a.transform.zoom;if(f.revealStart>w)return;const P=Za(0,1,f.revealStart,f.revealStart+f.revealRange,w);if(!this.particlesVx||!this.particlesIdx)return;const R=structuredClone(this._params);let H=[-R.direction.x,R.direction.y,-100];n.au(H,H);const Q=structuredClone(this._vignetteParams);Q.strength*=P,R.overrideStyleParameters||(R.intensity=a.style.rain.state.density,R.timeFactor=a.style.rain.state.intensity,R.color=structuredClone(a.style.rain.state.color),H=structuredClone(a.style.rain.state.direction),R.screenThinning.intensity=a.style.rain.state.centerThinning,R.dropletSizeX=a.style.rain.state.dropletSize[0],R.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],R.distortionStrength=100*a.style.rain.state.distortionStrength,Q.strength=1,Q.color=structuredClone(a.style.rain.state.vignetteColor));const oe=this.updateOnRender(a,R.timeFactor),de=a.context,pe=de.gl,yt=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new n.T(de,{width:a.width,height:a.height,data:null},pe.RGBA8)),R.distortionStrength>0&&(de.activeTexture.set(pe.TEXTURE0),this.screenTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),pe.copyTexSubImage2D(pe.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const pt=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(de,pt),de.activeTexture.set(pe.TEXTURE0),this.screenTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);const vt=[R.color.r,R.color.g,R.color.b,R.color.a],Dt=(At,Ot)=>{const Bt=Cl(this._movement.getPosition(),At),qt=R.dropletSizeX,li=R.dropletSizeX*R.dropletSizeYScale,fi=a.width/2,Ti=a.height/2,wi=Za(0,R.screenThinning.start,0,1,R.screenThinning.intensity),vi=Za(.001,R.screenThinning.range,0,1,R.screenThinning.intensity),di=Za(0,R.screenThinning.particleOffset,0,1,R.screenThinning.intensity),Ei=(Pi={modelview:oe.modelviewMatrix,projection:oe.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Bt,velocityConeAperture:R.velocityConeAperture,velocity:R.velocity,boxSize:At,rainDropletSize:[qt,li],distortionStrength:R.distortionStrength,rainDirection:H,color:vt,screenSize:[yt.width,yt.height],thinningCenterPos:[fi,Ti],thinningShape:[wi,vi,Math.pow(10,R.screenThinning.fadePower)],thinningAffectedRatio:R.screenThinning.affectedRatio,thinningParticleOffset:di,shapeDirectionalPower:R.shapeDirPower,shapeNormalPower:R.shapeNormalPower,mode:Ot?0:1},{u_modelview:Float32Array.from(Pi.modelview),u_projection:Float32Array.from(Pi.projection),u_time:Pi.time,u_cam_pos:Pi.camPos,u_texScreen:0,u_velocityConeAperture:Pi.velocityConeAperture,u_velocity:Pi.velocity,u_boxSize:Pi.boxSize,u_rainDropletSize:Pi.rainDropletSize,u_distortionStrength:Pi.distortionStrength,u_rainDirection:Pi.rainDirection,u_color:Pi.color,u_screenSize:Pi.screenSize,u_thinningCenterPos:Pi.thinningCenterPos,u_thinningShape:Pi.thinningShape,u_thinningAffectedRatio:Pi.thinningAffectedRatio,u_thinningParticleOffset:Pi.thinningParticleOffset,u_shapeDirectionalPower:Pi.shapeDirectionalPower,u_shapeNormalPower:Pi.shapeNormalPower,u_mode:Pi.mode});var Pi;const ji=Math.round(R.intensity*this.particlesCount),Wi=n.bd.simpleSegment(0,0,4*ji,2*ji);pt.draw(a,pe.TRIANGLES,Hr.disabled,_n.disabled,In.alphaBlended,fn.disabled,Ei,"rain_particles",this.particlesVx,this.particlesIdx,Wi)};R.distortionStrength>0&&Dt(R.boxSize,!0),Dt(R.boxSize,!1),this._vignette.draw(a,Q)}}const ru=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ks extends To{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new kf(a.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const f=a.context;if(!this.particlesVx){const w=Df(this.particlesCount),P=new n.es,R=new n.a_;let H=0;const Q=n.e7(1323123451230);for(let oe=0;oe<w.length;++oe){const de=w[oe],pe=Q(),yt=Q(),pt=Q(),vt=[oe/w.length,pe,yt,pt],Dt=[Q(),Q()];P.emplaceBack(de[0],de[1],de[2],-1,-1,...vt,...Dt),P.emplaceBack(de[0],de[1],de[2],1,-1,...vt,...Dt),P.emplaceBack(de[0],de[1],de[2],1,1,...vt,...Dt),P.emplaceBack(de[0],de[1],de[2],-1,1,...vt,...Dt),R.emplaceBack(H+0,H+1,H+2),R.emplaceBack(H+0,H+2,H+3),H+=4}this.particlesVx=f.createVertexBuffer(P,ru.members),this.particlesIdx=f.createIndexBuffer(R)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const f=structuredClone(this._params);let w=[-f.direction.x,f.direction.y,-100];n.au(w,w);const P=structuredClone(this._vignetteParams),R=f.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},H=a.transform.zoom;if(R.revealStart>H)return;const Q=Za(0,1,R.revealStart,R.revealStart+R.revealRange,H);P.strength*=Q,f.overrideStyleParameters||(f.intensity=a.style.snow.state.density,f.timeFactor=a.style.snow.state.intensity,f.color=structuredClone(a.style.snow.state.color),w=structuredClone(a.style.snow.state.direction),f.screenThinning.intensity=a.style.snow.state.centerThinning,f.billboardSize=2.79*a.style.snow.state.flakeSize,P.strength=1,P.color=structuredClone(a.style.snow.state.vignetteColor));const oe=this.updateOnRender(a,f.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const de=a.context,pe=de.gl,yt=a.transform,pt=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(de,pt),((vt,Dt,At)=>{const Ot=Cl(this._movement.getPosition(),vt),Bt=yt.width/2,qt=yt.height/2,li=Za(0,At.screenThinning.start,0,1,At.screenThinning.intensity),fi=Za(.001,At.screenThinning.range,0,1,At.screenThinning.intensity),Ti=Za(0,At.screenThinning.particleOffset,0,1,At.screenThinning.intensity),wi=(vi={modelview:oe.modelviewMatrix,projection:oe.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ot,velocityConeAperture:At.velocityConeAperture,velocity:At.velocity,horizontalOscillationRadius:At.horizontalOscillationRadius,horizontalOscillationRate:At.horizontalOscillationRate,boxSize:vt,billboardSize:1*At.billboardSize,simpleShapeParameters:[At.shapeFadeStart,At.shapeFadePower],screenSize:[yt.width,yt.height],thinningCenterPos:[Bt,qt],thinningShape:[li,fi,Math.pow(10,At.screenThinning.fadePower)],thinningAffectedRatio:At.screenThinning.affectedRatio,thinningParticleOffset:Ti,color:[At.color.r,At.color.g,At.color.b,At.color.a],direction:w},{u_modelview:Float32Array.from(vi.modelview),u_projection:Float32Array.from(vi.projection),u_time:vi.time,u_cam_pos:vi.camPos,u_velocityConeAperture:vi.velocityConeAperture,u_velocity:vi.velocity,u_horizontalOscillationRadius:vi.horizontalOscillationRadius,u_horizontalOscillationRate:vi.horizontalOscillationRate,u_boxSize:vi.boxSize,u_billboardSize:vi.billboardSize,u_simpleShapeParameters:vi.simpleShapeParameters,u_screenSize:vi.screenSize,u_thinningCenterPos:vi.thinningCenterPos,u_thinningShape:vi.thinningShape,u_thinningAffectedRatio:vi.thinningAffectedRatio,u_thinningParticleOffset:vi.thinningParticleOffset,u_particleColor:vi.color,u_direction:vi.direction});var vi;const di=Math.round(At.intensity*this.particlesCount),Ei=n.bd.simpleSegment(0,0,4*di,2*di);this.particlesVx&&this.particlesIdx&&pt.draw(a,pe.TRIANGLES,Hr.disabled,_n.disabled,In.alphaBlended,fn.disabled,wi,"snow_particles",this.particlesVx,this.particlesIdx,Ei)})(f.boxSize,0,f),this._vignette.draw(a,P)}}const Zn={symbol:function(b,a,f,w,P){if(b.renderPass!=="translucent")return;const R=_n.disabled,H=b.colorModeForRenderPass(),Q=f.layout.get("text-variable-anchor"),oe=f.layout.get("text-size-scale-range"),de=n.ay(b.scaleFactor,oe[0],oe[1]);Q&&function(pt,vt,Dt,At,Ot,Bt,qt,li){const fi=vt.transform,Ti=Ot==="map",wi=Bt==="map";for(const vi of pt){const di=At.getTile(vi),Ei=di.getBucket(Dt);if(!Ei||!Ei.text||!Ei.text.segments.get().length)continue;const Pi=n.bH(Ei.textSizeData,fi.zoom,li),ji=zu(vi,Ei.getProjection(),fi),Wi=fi.calculatePixelsToTileUnitsMatrix(di),or=ba(ji,di.tileID.canonical,wi,Ti,fi,Ei.getProjection(),Wi),ar=Ei.hasIconTextFit()&&Ei.hasIconData();Pi&&op(Ei,Ti,wi,qt,fi,or,vi,Math.pow(2,fi.zoom-di.tileID.overscaledZ),Pi,ar)}}(w,b,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),P,de);const pe=f.paint.get("icon-opacity").constantOr(1)!==0,yt=f.paint.get("text-opacity").constantOr(1)!==0;f.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(pe||yt)?Ql(b,a,f,w,R,H):(pe&&Ql(b,a,f,w,R,H,{onlyIcons:!0}),yt&&Ql(b,a,f,w,R,H,{onlyText:!0})),a.map.showCollisionBoxes&&(lh(b,a,f,w,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),lh(b,a,f,w,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(b,a,f,w){if(b.renderPass!=="translucent")return;const P=f.paint.get("circle-opacity"),R=f.paint.get("circle-stroke-width"),H=f.paint.get("circle-stroke-opacity"),Q=f.layout.get("circle-sort-key").constantOr(1)!==void 0,oe=f.paint.get("circle-emissive-strength");if(P.constantOr(1)===0&&(R.constantOr(1)===0||H.constantOr(1)===0))return;const de=b.context,pe=de.gl,yt=b.transform,pt=!(!b.terrain||!b.terrain.enabled),vt=f.layout.get("circle-elevation-reference"),Dt=b.depthModeForSublayer(0,Hr.ReadOnly),At=new Hr(b.context.gl.LEQUAL,Hr.ReadOnly,b.depthRangeFor3D),Ot=vt==="none"||pt?Dt:At,Bt=_n.disabled,qt=b.colorModeForDrapableLayerRenderPass(oe),li=yt.projection.name==="globe",fi=[n.aD(yt.center.lng),n.aH(yt.center.lat)],Ti=[];for(let vi=0;vi<w.length;vi++){const di=w[vi],Ei=a.getTile(di),Pi=Ei.getBucket(f);if(!Pi||Pi.projection.name!==yt.projection.name)continue;const ji=Pi.programConfigurations.get(f.id),Wi=Pi.layoutVertexBuffer,or=Pi.globeExtVertexBuffer,ar=Pi.indexBuffer,vr=n.dK(f),Ui=[or],Ji=b.isTileAffectedByFog(di);li&&vr.push("PROJECTION_GLOBE_VIEW"),vr.push("DEPTH_D24"),b.terrain&&yt.depthOcclusionForSymbolsAndCircles&&vr.push("DEPTH_OCCLUSION"),Pi.hasElevation&&(vr.push("ELEVATED_ROADS"),Ui.push(Pi.elevatedLayoutVertexBuffer));const zi=b.getOrCreateProgram("circle",{config:ji,defines:vr,overrideFog:Ji}),ur=yt.projection.createInversionMatrix(yt,di.canonical),Zi={programConfiguration:ji,program:zi,layoutVertexBuffer:Wi,dynamicBuffers:Ui,indexBuffer:ar,uniformValues:n.dL(b,di,Ei,ur,fi,f),tile:Ei};if(Q){const gr=Pi.segments.get();for(const kr of gr)Ti.push({segments:new n.bd([kr]),sortKey:kr.sortKey,state:Zi})}else Ti.push({segments:Pi.segments,sortKey:0,state:Zi})}Q&&Ti.sort((vi,di)=>vi.sortKey-di.sortKey);const wi={useDepthForOcclusion:yt.depthOcclusionForSymbolsAndCircles};for(const vi of Ti){const{programConfiguration:di,program:Ei,layoutVertexBuffer:Pi,dynamicBuffers:ji,indexBuffer:Wi,uniformValues:or,tile:ar}=vi.state,vr=vi.segments;b.terrain&&b.terrain.setupElevationDraw(ar,Ei,wi),b.uploadCommonUniforms(de,Ei,ar.tileID.toUnwrapped()),Ei.draw(b,pe.TRIANGLES,Ot,Bt,qt,fn.disabled,or,f.id,Pi,Wi,vr,f.paint,yt.zoom,di,ji)}},heatmap:function(b,a,f,w){if(f.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const P=b.context,R=P.gl,H=_n.disabled,Q=new In([R.ONE,R.ONE,R.ONE,R.ONE],n.am.transparent,[!0,!0,!0,!0]);(function(vt,Dt,At,Ot){const Bt=vt.gl,qt=Dt.width*Ot,li=Dt.height*Ot;vt.activeTexture.set(Bt.TEXTURE1),vt.viewport.set([0,0,qt,li]);let fi=At.heatmapFbo;if(!fi||fi&&(fi.width!==qt||fi.height!==li)){fi&&fi.destroy();const Ti=Bt.createTexture();Bt.bindTexture(Bt.TEXTURE_2D,Ti),Bt.texParameteri(Bt.TEXTURE_2D,Bt.TEXTURE_WRAP_S,Bt.CLAMP_TO_EDGE),Bt.texParameteri(Bt.TEXTURE_2D,Bt.TEXTURE_WRAP_T,Bt.CLAMP_TO_EDGE),Bt.texParameteri(Bt.TEXTURE_2D,Bt.TEXTURE_MIN_FILTER,Bt.LINEAR),Bt.texParameteri(Bt.TEXTURE_2D,Bt.TEXTURE_MAG_FILTER,Bt.LINEAR),fi=At.heatmapFbo=vt.createFramebuffer(qt,li,!0,null),function(wi,vi,di,Ei,Pi,ji){const Wi=wi.gl;Wi.texImage2D(Wi.TEXTURE_2D,0,wi.extRenderToTextureHalfFloat?Wi.RGBA16F:Wi.RGBA,Pi,ji,0,Wi.RGBA,wi.extRenderToTextureHalfFloat?Wi.HALF_FLOAT:Wi.UNSIGNED_BYTE,null),Ei.colorAttachment.set(di)}(vt,0,Ti,fi,qt,li)}else Bt.bindTexture(Bt.TEXTURE_2D,fi.colorAttachment.get()),vt.bindFramebuffer.set(fi.framebuffer)})(P,b,f,b.transform.projection.name==="globe"?.5:.25),P.clear({color:n.am.transparent});const oe=b.transform,de=oe.projection.name==="globe",pe=de?["PROJECTION_GLOBE_VIEW"]:[],yt=de?fn.frontCCW:fn.disabled,pt=[n.aD(oe.center.lng),n.aH(oe.center.lat)];for(let vt=0;vt<w.length;vt++){const Dt=w[vt];if(a.hasRenderableParent(Dt))continue;const At=a.getTile(Dt),Ot=At.getBucket(f);if(!Ot||Ot.projection.name!==oe.projection.name)continue;const Bt=b.isTileAffectedByFog(Dt),qt=Ot.programConfigurations.get(f.id),li=b.getOrCreateProgram("heatmap",{config:qt,defines:pe,overrideFog:Bt}),{zoom:fi}=b.transform;b.terrain&&b.terrain.setupElevationDraw(At,li),b.uploadCommonUniforms(P,li,Dt.toUnwrapped());const Ti=oe.projection.createInversionMatrix(oe,Dt.canonical);li.draw(b,R.TRIANGLES,Hr.disabled,H,Q,yt,tp(b,Dt,At,Ti,pt,fi,f.paint.get("heatmap-intensity")),f.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,f.paint,b.transform.zoom,qt,de?[Ot.globeExtVertexBuffer]:null)}P.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(P,R){const H=P.context,Q=H.gl,oe=R.heatmapFbo;if(!oe)return;H.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,oe.colorAttachment.get()),H.activeTexture.set(Q.TEXTURE1);let de=R.colorRampTexture;de||(de=R.colorRampTexture=new n.T(H,R.colorRamp,Q.RGBA8)),de.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),P.getOrCreateProgram("heatmapTexture").draw(P,Q.TRIANGLES,Hr.disabled,_n.disabled,P.colorModeForRenderPass(),fn.disabled,((pe,yt,pt,vt)=>({u_image:0,u_color_ramp:1,u_opacity:yt.paint.get("heatmap-opacity")}))(0,R),R.id,P.viewportBuffer,P.quadTriangleIndexBuffer,P.viewportSegments,R.paint,P.transform.zoom)}(b,f))},line:function(b,a,f,w){if(b.renderPass!=="translucent")return;const P=f.paint.get("line-opacity"),R=f.paint.get("line-width");if(P.constantOr(1)===0||R.constantOr(1)===0)return;const H=f.paint.get("line-emissive-strength"),Q=f.paint.get("line-occlusion-opacity"),oe=f.layout.get("line-elevation-reference"),de=f.layout.get("line-width-unit")==="meters",pe=oe==="sea",yt=!(!b.terrain||!b.terrain.enabled),pt=b.context,vt=pt.gl;if(f.hasElevatedBuckets&&b.transform.projection.name==="globe")return;const Dt=f.layout.get("line-cross-slope"),At=Dt!==void 0,Ot=Dt<1,Bt=b.colorModeForDrapableLayerRenderPass(H),qt=b.terrain&&b.terrain.renderingToTexture,li=qt?1:n.q.devicePixelRatio,fi=f.paint.get("line-dasharray"),Ti=fi.constantOr(1),wi=f.layout.get("line-cap"),vi=fi.constantOr(null),di=wi.constantOr(null),Ei=f.paint.get("line-pattern"),Pi=Ei.constantOr(1),ji=f.paint.get("line-pattern-cross-fade"),Wi=Ei.constantOr(null),or=f.paint.get("line-opacity").constantOr(1);let ar=!Pi&&or!==1||b.depthOcclusion&&Q>0&&Q<1;const vr=f.paint.get("line-gradient"),Ui=Pi?"linePattern":"line",Ji=n.dM(f);let zi;if(qt&&b.terrain&&b.terrain.clipOrMaskOverlapStencilType()&&(ar=!1),Q!==0&&b.depthOcclusion){const kr=f.paint._values["line-opacity"];kr&&kr.value&&kr.value.kind==="constant"?zi=kr.value:n.w(`Occlusion opacity for layer ${f.id} is supported only when line-opacity isn't data-driven.`)}R.value.kind!=="constant"&&R.value.isLineProgressConstant===!1&&Ji.push("VARIABLE_LINE_WIDTH");const ur=(kr,cr,Pr,Wr,qr,Ur)=>{for(const Qr of kr){const nn=a.getTile(Qr);if(Pi&&!nn.patternsLoaded())continue;const ln=nn.getBucket(f);if(!ln||ln.elevationType!=="none"&&!qr||ln.elevationType==="none"&&qr)continue;b.prepareDrawTile();const gn=[...cr],En=b.shadowRenderer,ss=ln.elevationType==="road"&&!!En&&En.enabled;let ws=[0,0,0];if(ss){const jn=b.style.directionalLight,Ys=b.style.ambientLight;jn&&Ys&&(ws=_l(b.style,jn,Ys)),gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const cs=ln.programConfigurations.get(f.id);let fs=!1;if(Wi&&nn.imageAtlas){const jn=n.dN.from(Wi),Ys=jn.getPrimary().scaleSelf(li).toString(),Ps=nn.imageAtlas.patternPositions.get(Ys),_s=jn.getSecondary(),Is=_s?nn.imageAtlas.patternPositions.get(_s.scaleSelf(li).toString()):null;fs=!!Ps&&!!Is,Ps&&cs.setConstantPatternPositions(Ps,Is)}ji>0&&(fs||cs.getPatternTransitionVertexBuffer("line-pattern"))&&gn.push("LINE_PATTERN_TRANSITION");const qs=b.isTileAffectedByFog(Qr),xn=b.getOrCreateProgram(Ui,{config:cs,defines:gn,overrideFog:qs,overrideRtt:!qr&&void 0});if(!Pi&&vi&&di&&nn.lineAtlas){const jn=nn.lineAtlas.getDash(vi,di);jn&&cs.setConstantPatternPositions(jn)}ss&&En.setupShadows(nn.tileID.toUnwrapped(),xn,"vector-tile",nn.tileID.overscaledZ);let[Cn,Fn]=f.paint.get("line-trim-offset");(di==="round"||di==="square")&&Cn!==Fn&&(Cn===0&&(Cn-=1),Fn===1&&(Fn+=1));const Cs=qt?Qr.projMatrix:null,io=de?1/ln.tileToMeter/n.aw(nn,1,b.transform.zoom):1,Ss=de?1/ln.tileToMeter/n.aw(nn,1,Math.floor(b.transform.zoom)):1,Kn=Pi?n.dO(b,nn,f,Cs,li,io,Ss,[Cn,Fn],ws,ji):n.dP(b,nn,f,Cs,ln.lineClipsArray.length,li,io,Ss,[Cn,Fn],ws);if(vr){const jn=ln.gradients[f.id];let Ys=jn.texture;if(f.gradientVersion!==jn.version){let Ps=256;if(f.stepInterpolant){const _s=a.getSource().maxzoom,Is=Qr.canonical.z===_s?Math.ceil(1<<b.transform.maxZoom-Qr.canonical.z):1;Ps=n.ay(n.dQ(ln.maxLineLength/n.aj*1024*Is),256,pt.maxTextureSize)}jn.gradient=n.dR({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ps,image:jn.gradient||void 0,clips:ln.lineClipsArray}),jn.texture?jn.texture.update(jn.gradient):jn.texture=new n.T(pt,jn.gradient,vt.RGBA8),jn.version=f.gradientVersion,Ys=jn.texture}pt.activeTexture.set(vt.TEXTURE1),Ys.bind(f.stepInterpolant?vt.NEAREST:vt.LINEAR,vt.CLAMP_TO_EDGE)}Ti&&(pt.activeTexture.set(vt.TEXTURE0),nn.lineAtlasTexture&&nn.lineAtlasTexture.bind(vt.LINEAR,vt.REPEAT),cs.updatePaintBuffers()),Pi&&(pt.activeTexture.set(vt.TEXTURE0),nn.imageAtlasTexture&&nn.imageAtlasTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),cs.updatePaintBuffers()),qr&&!pe&&b.terrain.setupElevationDraw(nn,xn),b.uploadCommonUniforms(pt,xn,Qr.toUnwrapped());const Gs=jn=>{zi!=null&&(zi.value=or*Q),xn.draw(b,vt.TRIANGLES,Pr,jn,Bt,fn.disabled,Kn,f.id,ln.layoutVertexBuffer,ln.indexBuffer,ln.segments,f.paint,b.transform.zoom,cs,[ln.layoutVertexBuffer2,ln.patternVertexBuffer,ln.zOffsetVertexBuffer]),zi!=null&&(zi.value=or)};if(ar&&!qr){const jn=b.stencilModeForClipping(Qr).ref;jn===0&&qt&&pt.clear({stencil:0});const Ys={func:vt.EQUAL,mask:255};Kn.u_alpha_discard_threshold=.8,Gs(new _n(Ys,jn,255,vt.KEEP,vt.KEEP,vt.INVERT)),Kn.u_alpha_discard_threshold=0,Gs(new _n(Ys,jn,255,vt.KEEP,vt.KEEP,vt.KEEP))}else Kn.u_alpha_discard_threshold=ar&&qr&&Ur?.8:0,Gs(qr?Wr:b.stencilModeForClipping(Qr))}};let Zi=b.depthModeForSublayer(0,Hr.ReadOnly);const gr=new Hr(b.depthOcclusion?vt.GREATER:vt.LEQUAL,Hr.ReadOnly,b.depthRangeFor3D);if(f.hasNonElevatedBuckets){const kr=!qt&&b.terrain;Q!==0&&kr?n.w(`Occlusion opacity for layer ${f.id} is supported on terrain only if the layer has line-z-offset enabled.`):kr?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${f.id}.`):ur(w,Ji,Zi,_n.disabled,!1,!0)}if(f.hasElevatedBuckets){oe==="hd-road-markup"?yt||(Zi=gr,Ji.push("ELEVATED_ROADS")):(Ji.push("ELEVATED"),Zi=gr,At&&Ji.push(Ot?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),pe&&Ji.push("ELEVATION_REFERENCE_SEA"));const kr=ar?b.stencilModeFor3D():_n.disabled;b.forceTerrainMode=!0,ur(w,Ji,Zi,kr,!0,!0),ar&&ur(w,Ji,Zi,kr,!0,!1),b.forceTerrainMode=!1}ar&&(b.resetStencilClippingMasks(),qt&&pt.clear({stencil:0})),Q===0||b.depthOcclusion||qt||b.layersWithOcclusionOpacity.push(b.currentLayer)},fill:function(b,a,f,w){const P=f.paint.get("fill-color"),R=f.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const H=f.paint.get("fill-emissive-strength"),Q=b.colorModeForDrapableLayerRenderPass(H),oe=f.paint.get("fill-pattern"),de=b.opaquePassEnabledForLayer()&&!oe.constantOr(1)&&P.constantOr(n.am.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";let pe="none";f.layout.get("fill-elevation-reference")!=="none"?pe="road":f.paint.get("fill-z-offset").constantOr(1)!==0&&(pe="offset");const yt=!(!b.terrain||!b.terrain.enabled),pt={painter:b,sourceCache:a,layer:f,coords:w,colorMode:Q,elevationType:pe,terrainEnabled:yt,pass:de};if(b.renderPass!=="shadow")if(pe!=="offset"){if(Cf(pt,!1),pe==="road"){const vt=!yt&&b.renderPass==="translucent";vt&&Af(b,a,f,w,"geometry"),Cf(pt,!0,_n.disabled),vt&&function(Dt){const{painter:At,sourceCache:Ot,layer:Bt,coords:qt,colorMode:li}=Dt,fi=At.context.gl,Ti=Dt.painter.shadowRenderer,wi=!!Ti&&Ti.enabled,vi=new Hr(At.context.gl.LEQUAL,Hr.ReadOnly,At.depthRangeFor3D);let di=[0,0,0];if(wi){const Pi=At.style.directionalLight,ji=At.style.ambientLight;Pi&&ji&&(di=_l(At.style,Pi,ji))}const Ei=Pi=>{for(const ji of qt){const Wi=Ot.getTile(ji),or=Wi.getBucket(Bt);if(!or)continue;const ar=or.elevatedStructures;if(!ar)continue;let vr,Ui;if(Pi?(vr=ar.renderableBridgeSegments,Ui=ar.bridgeProgramConfigurations.get(Bt.id)):(vr=ar.renderableTunnelSegments,Ui=ar.tunnelProgramConfigurations.get(Bt.id)),!vr||vr.segments[0].primitiveLength===0)continue;Ui.updatePaintBuffers(),At.prepareDrawTile();const Ji=At.isTileAffectedByFog(ji),zi=[];wi&&zi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ur=At.getOrCreateProgram("elevatedStructures",{config:Ui,overrideFog:Ji,defines:zi}),Zi=At.translatePosMatrix(ji.projMatrix,Wi,Bt.paint.get("fill-translate"),Bt.paint.get("fill-translate-anchor"));wi&&Ti.setupShadows(Wi.tileID.toUnwrapped(),ur,"vector-tile",Wi.tileID.overscaledZ);const gr=Ym(Zi,di);At.uploadCommonUniforms(At.context,ur,ji.toUnwrapped()),ur.draw(At,fi.TRIANGLES,vi,_n.disabled,li,fn.backCCW,gr,Bt.id,ar.vertexBuffer,ar.indexBuffer,vr,Bt.paint,At.transform.zoom,Ui,[ar.vertexBufferNormal])}};Ei(!0),Ei(!1)}(pt)}}else Cf(pt,!1,b.stencilModeFor3D());else b.shadowRenderer&&pe==="road"&&!yt&&function(vt){const{painter:Dt,sourceCache:At,layer:Ot,coords:Bt}=vt,qt=Dt.context.gl,li=vt.painter.shadowRenderer;for(const fi of Bt){const Ti=At.getTile(fi),wi=Ti.getBucket(Ot);if(!wi)continue;const vi=wi.elevatedStructures;if(!vi||!vi.shadowCasterSegments||vi.shadowCasterSegments.segments[0].primitiveLength===0)continue;Dt.prepareDrawTile();const di=wi.bufferData.programConfigurations.get(Ot.id),Ei=Dt.isTileAffectedByFog(fi),Pi=Dt.getOrCreateProgram("elevatedStructuresDepth",{config:di,overrideFog:Ei}),ji=li.calculateShadowPassMatrixFromTile(Ti.tileID.toUnwrapped());Dt.uploadCommonUniforms(Dt.context,Pi,fi.toUnwrapped());const Wi={u_matrix:ji,u_depth_bias:.001};Pi.draw(Dt,qt.TRIANGLES,li.getShadowPassDepthMode(),_n.disabled,li.getShadowPassColorMode(),fn.disabled,Wi,Ot.id,vi.vertexBuffer,vi.indexBuffer,vi.shadowCasterSegments,Ot.paint,Dt.transform.zoom,di)}}(pt)},"fill-extrusion":function(b,a,f,w){const P=f.paint.get("fill-extrusion-opacity"),R=b.context,H=R.gl,Q=b.terrain,oe=Q&&Q.renderingToTexture;if(P===0)return;const de=b.conflationActive&&b.style.isLayerClipped(f,a.getSource()),pe=b.style.order.indexOf(f.fqid);if(de&&function(yt,pt,vt,Dt,At){for(const Ot of Dt){const Bt=pt.getTile(Ot).getBucket(vt);Bt&&(Bt.updateReplacement(Ot,yt.replacementSource,At),Bt.uploadCentroid(yt.context))}}(b,a,f,w,pe),Q||de)for(const yt of w){const pt=a.getTile(yt).getBucket(f);pt&&jr(b.context,a,yt,pt,f,Q,de)}if(b.renderPass==="shadow"&&b.shadowRenderer){const yt=b.shadowRenderer;if(Q&&P<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ab)return;const pt=yt.getShadowPassDepthMode(),vt=yt.getShadowPassColorMode();Ma(b,a,f,w,pt,_n.disabled,vt,de)}else if(b.renderPass==="translucent"){const yt=!f.paint.get("fill-extrusion-pattern").constantOr(1),pt=f.paint.get("fill-extrusion-color").constantOr(n.am.white);if(!oe&&pt.a!==0){const vt=new Hr(b.context.gl.LEQUAL,Hr.ReadWrite,b.depthRangeFor3D);P===1&&yt?Ma(b,a,f,w,vt,_n.disabled,In.unblended,de):(Ma(b,a,f,w,vt,_n.disabled,In.disabled,de),Ma(b,a,f,w,vt,b.stencilModeFor3D(),b.colorModeForRenderPass(),de),b.resetStencilClippingMasks())}if(b.style.enable3dLights()&&yt&&(!Q&&b.transform.projection.name!=="globe"||oe)){const vt=f.paint.get("fill-extrusion-opacity"),Dt=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),At=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Ot=f.paint.get("fill-extrusion-flood-light-intensity"),Bt=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",qt=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Bt?null:f.lut).toArray01().slice(0,3),li=Dt>0&&At>0,fi=Ot>0,Ti=(vi,di,Ei)=>(1-Ei)*vi+Ei*di,wi=vi=>{const di=b.depthModeForSublayer(1,Hr.ReadOnly,H.LEQUAL,!0),Ei=f.paint.get(vi?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pi=Ti(.1,3,Ei),ji=b._showOverdrawInspector;if(!ji){const Wi=new _n({func:H.ALWAYS,mask:255},255,255,H.KEEP,H.KEEP,H.REPLACE),or=new In([H.ONE,H.ONE,H.ONE,H.ONE],n.am.transparent,[!1,!1,!1,!0],H.MIN);Aa(b,a,f,w,di,Wi,or,fn.disabled,vi,"sdf",vt,Dt,At,Ot,qt,Pi,de,!1)}{const Wi=ji?_n.disabled:new _n({func:H.EQUAL,mask:255},255,255,H.KEEP,H.DECR,H.DECR),or=ji?b.colorModeForRenderPass():new In([H.ONE_MINUS_DST_ALPHA,H.DST_ALPHA,H.ONE,H.ONE],n.am.transparent,[!0,!0,!0,!0]);Aa(b,a,f,w,di,Wi,or,fn.disabled,vi,"color",vt,Dt,At,Ot,qt,Pi,de,!1)}};if(oe){const vi=(di,Ei,Pi)=>{const ji=b.depthModeForSublayer(1,Hr.ReadOnly,H.LEQUAL,!1),Wi=f.paint.get(di?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),or=Ti(.1,3,Wi);{const ar=new In([H.ONE,H.ONE,H.ONE,H.ONE],n.am.transparent,[!1,!1,!1,!0]);Aa(b,a,f,w,ji,_n.disabled,ar,fn.disabled,di,"clear",vt,Dt,At,Ot,qt,or,de,Ei)}{const ar=new _n({func:H.ALWAYS,mask:255},255,255,H.KEEP,H.KEEP,H.REPLACE),vr=new In([H.ONE,H.ONE,H.ONE,H.ONE],n.am.transparent,[!1,!1,!1,!0],H.MIN);Aa(b,a,f,w,ji,ar,vr,fn.disabled,di,"sdf",vt,Dt,At,Ot,qt,or,de,Ei)}{const ar=di?H.ZERO:H.ONE_MINUS_DST_ALPHA,vr=new _n({func:H.EQUAL,mask:255},255,255,H.KEEP,H.DECR,H.DECR),Ui=new In([ar,H.DST_ALPHA,H.ONE_MINUS_DST_ALPHA,H.ZERO],n.am.transparent,[!0,!0,!0,!0]);Aa(b,a,f,w,ji,vr,Ui,fn.disabled,di,"color",vt,Dt,At,Ot,qt,or,de,Ei)}{const ar=new In([H.ONE,H.ONE,H.ONE,di?H.ZERO:H.ONE],n.am.transparent,[!1,!1,!1,!0],di?H.FUNC_ADD:H.MAX);Aa(b,a,f,w,ji,_n.disabled,ar,fn.disabled,di,"clear",vt,Dt,At,Ot,qt,or,de,Ei,Pi)}};if(li||fi){let di;if(b.prepareDrawTile(),Q){const Ei=Q.drapeBufferSize[0],Pi=Q.drapeBufferSize[1];di=Q.framebufferCopyTexture,di&&(!di||di.size[0]===Ei&&di.size[1]===Pi)||(di&&di.destroy(),di=Q.framebufferCopyTexture=new n.T(R,new n.r({width:Ei,height:Pi}),H.RGBA8)),di.bind(H.LINEAR,H.CLAMP_TO_EDGE),H.copyTexSubImage2D(H.TEXTURE_2D,0,0,0,0,0,Ei,Pi)}li&&vi(!0,!1,di),fi&&vi(!1,!0,di)}}else li&&wi(!0),fi&&wi(!1),(li||fi)&&b.resetStencilClippingMasks()}}},building:function(b,a,f,w){},hillshade:function(b,a,f,w){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent"||b.style.disableElevatedTerrain)return;const P=b.context,R=b.terrain&&b.terrain.renderingToTexture,[H,Q]=b.renderPass!=="translucent"||R?[{},w]:b.stencilConfigForOverlap(w);for(const oe of Q){const de=a.getTile(oe);if(de.needsHillshadePrepare&&b.renderPass==="offscreen")Bm(b,de,f);else if(b.renderPass==="translucent"){const pe=b.depthModeForSublayer(0,Hr.ReadOnly),yt=f.paint.get("hillshade-emissive-strength"),pt=b.colorModeForDrapableLayerRenderPass(yt),vt=R&&b.terrain?b.terrain.stencilModeForRTTOverlap(oe):H[oe.overscaledZ];zm(b,oe,de,f,pe,vt,pt)}}P.viewport.set([0,0,b.width,b.height]),b.resetStencilClippingMasks()},raster:function(b,a,f,w,P,R){if(b.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const H=b.transform.projection.name==="globe",Q=f.paint.get("raster-elevation")!==0,oe=Q&&H;if(b.renderElevatedRasterBackface&&!oe)return;const de=b.context,pe=de.gl,yt=a.getSource(),pt=function(wi,vi,di,Ei){const Pi=vi.paint.get("raster-color"),ji=wi.type==="raster-array",Wi=[],or=vi.paint.get("raster-resampling"),ar=vi.paint.get("raster-color-mix");let vr=vi.paint.get("raster-color-range");const Ui=[ar[0],ar[1],ar[2],0],Ji=ar[3];let zi=or==="nearest"?Ei.NEAREST:Ei.LINEAR;if(ji&&(Wi.push("RASTER_ARRAY"),Pi||Wi.push("RASTER_COLOR"),or==="linear"&&Wi.push("RASTER_ARRAY_LINEAR"),zi=Ei.NEAREST,!vr&&wi.rasterLayers)){const ur=wi.rasterLayers.find(({id:Zi})=>Zi===vi.sourceLayer);ur&&ur.fields&&ur.fields.range&&(vr=ur.fields.range)}if(vr=vr||[0,1],Pi){Wi.push("RASTER_COLOR"),di.activeTexture.set(Ei.TEXTURE2),vi.updateColorRamp(vr);let ur=vi.colorRampTexture;ur||(ur=vi.colorRampTexture=new n.T(di,vi.colorRamp,Ei.RGBA8)),ur.bind(Ei.LINEAR,Ei.CLAMP_TO_EDGE)}return{mix:Ui,range:vr,offset:Ji,defines:Wi,resampling:zi}}(yt,f,de,pe);if(yt instanceof n.aP&&!w.length&&!H)return;const vt=f.paint.get("raster-emissive-strength"),Dt=b.colorModeForDrapableLayerRenderPass(vt),At=b.terrain&&b.terrain.renderingToTexture,Ot=!b.options.moving,Bt=f.paint.get("raster-resampling")==="nearest"?pe.NEAREST:pe.LINEAR;if(yt instanceof n.aP&&!w.length&&(yt.onNorthPole||yt.onSouthPole)){const wi=Q?b.stencilModeFor3D():_n.disabled;return void eu(!!yt.onNorthPole,null,b,a,f,vt,pt,fn.disabled,wi)}if(!w.length)return;const[qt,li]=yt instanceof n.aP||At?[{},w]:b.stencilConfigForOverlap(w),fi=li[li.length-1].overscaledZ;oe&&pt.defines.push("PROJECTION_GLOBE_VIEW"),Q&&pt.defines.push("RENDER_CUTOFF");const Ti=(wi,vi,di)=>{for(const Ei of wi){const Pi=Ei.toUnwrapped(),ji=a.getTile(Ei);if(At&&(!ji||!ji.hasData()))continue;de.activeTexture.set(pe.TEXTURE0);const Wi=ig(ji,yt,f,pt);if(!Wi||!Wi.texture)continue;const{texture:or,mix:ar,offset:vr,tileSize:Ui,buffer:Ji}=Wi;let zi,ur;At?(zi=Hr.disabled,ur=Ei.projMatrix):Q?(zi=new Hr(pe.LEQUAL,Hr.ReadWrite,b.depthRangeFor3D),ur=H?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(Pi,Ot)):(zi=b.depthModeForSublayer(Ei.overscaledZ-fi,f.paint.get("raster-opacity")===1?Hr.ReadWrite:Hr.ReadOnly,pe.LESS),ur=b.transform.calculateProjMatrix(Pi,Ot));const Zi=b.terrain&&At?b.terrain.stencilModeForRTTOverlap(Ei):qt[Ei.overscaledZ],gr=R?0:f.paint.get("raster-fade-duration");ji.registerFadeDuration(gr);const kr=a.findLoadedParent(Ei,0),cr=bl(ji,kr,a,b.transform,gr);let Pr,Wr;b.terrain&&b.terrain.prepareDrawTile(),de.activeTexture.set(pe.TEXTURE0),or.bind(Bt,pe.CLAMP_TO_EDGE),de.activeTexture.set(pe.TEXTURE1),kr?(kr.texture&&kr.texture.bind(Bt,pe.CLAMP_TO_EDGE),Pr=Math.pow(2,kr.tileID.overscaledZ-ji.tileID.overscaledZ),Wr=[ji.tileID.canonical.x*Pr%1,ji.tileID.canonical.y*Pr%1]):or.bind(Bt,pe.CLAMP_TO_EDGE),"useMipmap"in or&&de.extTextureFilterAnisotropic&&b.transform.pitch>20&&pe.texParameterf(pe.TEXTURE_2D,de.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,de.extTextureFilterAnisotropicMax);const qr=b.transform;let Ur;const Qr=Q?tg(qr):[0,0,0,0];let nn,ln,gn,En,ss,ws=0;if(oe&&yt instanceof n.aP&&yt.coordinates.length>3)nn=Float32Array.from(n.bh(n.dr(new n.cp(0,0,0)))),ln=Float32Array.from(qr.globeMatrix),gn=Float32Array.from(n.dm(qr)),En=[n.aD(qr.center.lng),n.aH(qr.center.lat)],Ur=yt.elevatedGlobePerspectiveTransform,ss=yt.elevatedGlobeGridMatrix||new Float32Array(9);else if(oe){const xn=n.dn(Ei.canonical);ws=n.dp(xn.getCenter().lat),nn=Float32Array.from(n.bh(n.dr(Ei.canonical))),ln=Float32Array.from(qr.globeMatrix),gn=Float32Array.from(n.dm(qr)),En=[n.aD(qr.center.lng),n.aH(qr.center.lat)],Ur=[0,0],ss=Float32Array.from(n.dq(Ei.canonical,xn,ws,qr.worldSize/qr._pixelsPerMercatorPixel))}else Ur=yt instanceof n.aP?yt.perspectiveTransform:[0,0],nn=new Float32Array(16),ln=new Float32Array(9),gn=new Float32Array(16),En=[0,0],ss=new Float32Array(9);const cs=Sf(ur,nn,ln,gn,ss,Wr||[0,0],n.ah(b.transform.zoom),En,Qr,Pr||1,cr,f,Ur,Q?f.paint.get("raster-elevation"):0,2,ar,vr,pt.range,Ui,Ji,vt),fs=b.isTileAffectedByFog(Ei),qs=b.getOrCreateProgram("raster",{defines:pt.defines,overrideFog:fs});if(b.uploadCommonUniforms(de,qs,Pi),yt instanceof n.aP){const xn=yt.elevatedGlobeVertexBuffer,Cn=yt.elevatedGlobeIndexBuffer;if(At||!H)yt.boundsBuffer&&yt.boundsSegments&&qs.draw(b,pe.TRIANGLES,zi,_n.disabled,Dt,fn.disabled,cs,f.id,yt.boundsBuffer,b.quadTriangleIndexBuffer,yt.boundsSegments);else if(xn&&Cn){const Fn=qr.zoom<=n.cL?yt.elevatedGlobeSegments:yt.getSegmentsForLongitude(qr.center.lng);Fn&&qs.draw(b,pe.TRIANGLES,zi,_n.disabled,Dt,vi,cs,f.id,xn,Cn,Fn)}}else if(oe){zi=new Hr(pe.LEQUAL,Hr.ReadOnly,b.depthRangeFor3D);const xn=b.globeSharedBuffers;if(xn){const[Cn,Fn,Cs]=xn.getGridBuffers(ws,!1);qs.draw(b,pe.TRIANGLES,zi,di||Zi,b.colorModeForRenderPass(),vi,cs,f.id,Cn,Fn,Cs)}}else{const{tileBoundsBuffer:xn,tileBoundsIndexBuffer:Cn,tileBoundsSegments:Fn}=b.getTileBoundsBuffers(ji);qs.draw(b,pe.TRIANGLES,zi,Zi,Dt,fn.disabled,cs,f.id,xn,Cn,Fn)}}if(!(yt instanceof n.aP)&&oe)for(const Ei of wi){const Pi=Ei.canonical.y===(1<<Ei.canonical.z)-1;Ei.canonical.y===0&&eu(!0,Ei,b,a,f,vt,pt,vi,di||_n.disabled),Pi&&eu(!1,Ei,b,a,f,vt,pt,vi===fn.frontCW?fn.backCW:fn.frontCW,di||_n.disabled)}};oe?Ti(li,b.renderElevatedRasterBackface?fn.backCW:fn.frontCW,b.stencilModeFor3D()):Ti(li,fn.disabled,void 0),b.resetStencilClippingMasks()},"raster-particle":function(b,a,f,w,P,R){b.renderPass==="offscreen"&&function(H,Q,oe,de){if(!de.length)return;const pe=H.context,yt=pe.gl,pt=Q.getSource();if(!(pt instanceof za))return;const vt=Math.ceil(Math.sqrt(oe.paint.get("raster-particle-count")));let Dt=oe.particlePositionRGBAImage;if(!Dt||Dt.width!==vt){const li=function(fi){const Ti=fi*fi,wi=new Uint8Array(4*Ti),vi=function(Ei){return Ei|=0,Ei=Math.imul(2747636419^Ei,2654435769),Ei=Math.imul(Ei^Ei>>>16,2654435769),((Ei=Math.imul(Ei^Ei>>>16,2654435769))>>>0)/4294967296},di=1/1.1;for(let Ei=0;Ei<Ti;Ei++){const Pi=di*(vi(2*Ei+0)+Ha),ji=di*(vi(2*Ei+1)+Ha),Wi=255*Pi%1,or=255*ji%1,ar=Wi,vr=ji-or/255,Ui=or;wi[4*Ei+0]=255*(Pi-Wi/255),wi[4*Ei+1]=255*ar,wi[4*Ei+2]=255*vr,wi[4*Ei+3]=255*Ui}return wi}(vt);Dt=oe.particlePositionRGBAImage=new n.r({width:vt,height:vt},li)}let At=oe.particleFramebuffer;At?At.width!==vt&&(At.destroy(),At=oe.particleFramebuffer=pe.createFramebuffer(vt,vt,!0,null)):At=oe.particleFramebuffer=pe.createFramebuffer(vt,vt,!0,null);const Ot=[];for(const li of de){const fi=Q.getTile(li);if(!(fi instanceof kl))continue;const Ti=rg(fi,pt,oe);if(!Ti)continue;const wi=[fi.tileSize,fi.tileSize];let vi=oe.tileFramebuffer;vi||(vi=oe.tileFramebuffer=pe.createFramebuffer(wi[0],wi[1],!0,null));let di=fi.rasterParticleState;di||(di=fi.rasterParticleState=new cp(pe,li,wi,Dt));const Ei=di.update(oe.lastInvalidatedAt);di.particleTextureDimension!==vt&&di.updateParticleTexture(li,Dt);const Pi=di.targetColorTexture;di.targetColorTexture=di.backgroundColorTexture,di.backgroundColorTexture=Pi;const ji=di.particleTexture0;di.particleTexture0=di.particleTexture1,di.particleTexture1=ji,Ot.push([li,Ti,di,Ei])}if(Ot.length===0)return;const Bt=n.q.now(),qt=oe.previousDrawTimestamp?.001*(Bt-oe.previousDrawTimestamp):.0167;if(oe.previousDrawTimestamp=Bt,oe.hasColorMap()){pe.activeTexture.set(yt.TEXTURE0+2);let li=oe.colorRampTexture;li||(li=oe.colorRampTexture=new n.T(pe,oe.colorRamp,yt.RGBA8)),li.bind(yt.LINEAR,yt.CLAMP_TO_EDGE)}pe.bindFramebuffer.set(oe.tileFramebuffer.framebuffer),function(li,fi,Ti){const wi=li.context,vi=wi.gl,di=fi.tileFramebuffer;wi.activeTexture.set(vi.TEXTURE0);const Ei={u_texture:0,u_opacity:1.05*(ji=fi.paint.get("raster-particle-fade-opacity-factor"))/(ji+.05)},Pi=li.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ji;for(const Wi of Ti){const[,,or,ar]=Wi;di.colorAttachment.set(or.targetColorTexture.texture),wi.viewport.set([0,0,di.width,di.height]),wi.clear({color:n.am.transparent}),ar&&(or.backgroundColorTexture.bind(vi.NEAREST,vi.CLAMP_TO_EDGE),Pi.draw(li,vi.TRIANGLES,Hr.disabled,_n.disabled,In.alphaBlended,fn.disabled,Ei,fi.id,li.viewportBuffer,li.quadTriangleIndexBuffer,li.viewportSegments))}}(H,oe,Ot),function(li,fi,Ti,wi){const vi=li.context,di=vi.gl,Ei=Ti.tileFramebuffer,Pi=li.transform.projection.name==="globe",ji=Ti.paint.get("raster-particle-max-speed");for(const Wi of wi){const[or,ar,vr]=Wi;vi.activeTexture.set(di.TEXTURE0+0),ar.texture.bind(di.LINEAR,di.CLAMP_TO_EDGE),Ei.colorAttachment.set(vr.targetColorTexture.texture);const Ui=li.getOrCreateProgram("rasterParticleDraw",{defines:ar.defines,overrideFog:!1});vi.activeTexture.set(di.TEXTURE0+1);const Ji=ar.scalarData?[]:[0,1,2,3].map(Zi=>n.dT[Zi](or));Ji.push(or);const zi=or.canonical.x,ur=or.canonical.y;for(const Zi of Ji){const gr=fi.getTile(Pi?Zi.wrapped():Zi);if(!gr)continue;const kr=gr.rasterParticleState;if(!kr)continue;const cr=Zi.canonical.x+(1<<Zi.canonical.z)*(Zi.wrap-or.wrap),Pr=Zi.canonical.y;kr.particleTexture0.bind(di.NEAREST,di.CLAMP_TO_EDGE);const Wr=rp(1,kr.particleTexture0.size[0],[cr-zi,Pr-ur],0,ar.texture.size,2,ji,ar.textureOffset,ar.scale,ar.offset);Ui.draw(li,di.POINTS,Hr.disabled,_n.disabled,In.alphaBlended,fn.disabled,Wr,Ti.id,kr.particleIndexBuffer,void 0,kr.particleSegment)}}}(H,Q,oe,Ot),pe.bindFramebuffer.set(oe.particleFramebuffer.framebuffer),function(li,fi,Ti,wi){const vi=li.context,di=vi.gl,Ei=fi.paint.get("raster-particle-max-speed"),Pi=wi*fi.paint.get("raster-particle-speed-factor")*.15,ji=function(or){return Math.pow(or,6)}(.01+1*fi.paint.get("raster-particle-reset-rate-factor")),Wi=fi.particleFramebuffer;vi.viewport.set([0,0,Wi.width,Wi.height]);for(const or of Ti){const[,ar,vr]=or;vi.activeTexture.set(di.TEXTURE0+0),ar.texture.bind(di.LINEAR,di.CLAMP_TO_EDGE),vi.activeTexture.set(di.TEXTURE0+1);const Ui=vr.particleTexture0;Ui.bind(di.NEAREST,di.CLAMP_TO_EDGE);const Ji=ja(1,Ui.size[0],0,ar.texture.size,Ei,Pi,ji,ar.textureOffset,ar.scale,ar.offset);Wi.colorAttachment.set(vr.particleTexture1.texture),vi.clear({color:n.am.transparent}),li.getOrCreateProgram("rasterParticleUpdate",{defines:ar.defines}).draw(li,di.TRIANGLES,Hr.disabled,_n.disabled,In.unblended,fn.disabled,Ji,fi.id,li.viewportBuffer,li.quadTriangleIndexBuffer,li.viewportSegments)}}(H,oe,Ot,qt)}(b,a,f,w),b.renderPass==="translucent"&&(function(H,Q,oe,de,pe){const yt=H.context,pt=yt.gl,vt=Q.getSource().tileSize,Dt=5*(1-n.af(n.cx,n.cx+1,H.transform.zoom))*vt+oe.paint.get("raster-particle-elevation"),At=!H.options.moving,Ot=H.transform.projection.name==="globe";if(!de.length)return;const[Bt,qt]=H.stencilConfigForOverlap(de),li=[];Ot&&li.push("PROJECTION_GLOBE_VIEW");const fi=H.stencilModeFor3D();for(const Ti of qt){const wi=Ti.toUnwrapped(),vi=Q.getTile(Ti);if(!vi.rasterParticleState)continue;const di=vi.rasterParticleState,Ei=100;vi.registerFadeDuration(Ei);const Pi=Q.findLoadedParent(Ti,0),ji=bl(vi,Pi,Q,H.transform,Ei);let Wi,or;H.terrain&&H.terrain.prepareDrawTile(),yt.activeTexture.set(pt.TEXTURE0),di.targetColorTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),yt.activeTexture.set(pt.TEXTURE1),Pi&&Pi.rasterParticleState?(Pi.rasterParticleState.targetColorTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),Wi=Math.pow(2,Pi.tileID.overscaledZ-vi.tileID.overscaledZ),or=[vi.tileID.canonical.x*Wi%1,vi.tileID.canonical.y*Wi%1]):di.targetColorTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE);const ar=Ot?Float32Array.from(H.transform.expandedFarZProjMatrix):H.transform.calculateProjMatrix(wi,At),vr=H.transform,Ui=up(vr),Ji=n.dn(Ti.canonical),zi=n.dp(Ji.getCenter().lat);let ur,Zi,gr,kr,cr;Ot?(ur=Float32Array.from(n.bh(n.dr(Ti.canonical))),Zi=Float32Array.from(vr.globeMatrix),gr=Float32Array.from(n.dm(vr)),kr=[n.aD(vr.center.lng),n.aH(vr.center.lat)],cr=Float32Array.from(n.dq(Ti.canonical,Ji,zi,vr.worldSize/vr._pixelsPerMercatorPixel))):(ur=new Float32Array(16),Zi=new Float32Array(9),gr=new Float32Array(16),kr=[0,0],cr=new Float32Array(9));const Pr=Tl(ar,ur,Zi,gr,cr,or||[0,0],n.ah(H.transform.zoom),kr,Ui,Wi||1,ji,Dt),Wr=H.isTileAffectedByFog(Ti),qr=H.getOrCreateProgram("rasterParticle",{defines:li,overrideFog:Wr});if(H.uploadCommonUniforms(yt,qr,wi),Ot){const Ur=new Hr(pt.LEQUAL,Hr.ReadOnly,H.depthRangeFor3D),Qr=0,nn=H.globeSharedBuffers;if(nn){const[ln,gn,En]=nn.getGridBuffers(zi,Qr!==0);qr.draw(H,pt.TRIANGLES,Ur,fi,In.alphaBlended,H.renderElevatedRasterBackface?fn.frontCCW:fn.backCCW,Pr,oe.id,ln,gn,En)}}else{const Ur=H.depthModeForSublayer(0,Hr.ReadOnly),Qr=Bt[Ti.overscaledZ],{tileBoundsBuffer:nn,tileBoundsIndexBuffer:ln,tileBoundsSegments:gn}=H.getTileBoundsBuffers(vi);qr.draw(H,pt.TRIANGLES,Ur,Qr,In.alphaBlended,fn.disabled,Pr,oe.id,nn,ln,gn)}}H.resetStencilClippingMasks()}(b,a,f,w),b.style.map.triggerRepaint())},background:function(b,a,f,w){const P=f.paint.get("background-color"),R=f.paint.get("background-color-use-theme").constantOr("default")==="none",H=f.paint.get("background-opacity"),Q=f.paint.get("background-emissive-strength"),oe=f.paint.get("background-pitch-alignment")==="viewport";if(H===0)return;const de=b.context,pe=de.gl,yt=b.transform,pt=yt.tileSize,vt=f.paint.get("background-pattern");let Dt;if(vt!==void 0&&(vt===null||(Dt=b.imageManager.getPattern(n.I.from(vt.toString()),f.scope,b.style.getLut(f.scope)),!Dt)))return;const At=!vt&&P.a===1&&H===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==At)return;const Ot=_n.disabled,Bt=b.depthModeForSublayer(0,At==="opaque"?Hr.ReadWrite:Hr.ReadOnly),qt=b.colorModeForDrapableLayerRenderPass(Q),li=vt?"backgroundPattern":"background";let fi,Ti=w;if(Ti||(fi=b.getBackgroundTiles(),Ti=Object.values(fi).map(wi=>wi.tileID)),vt&&(de.activeTexture.set(pe.TEXTURE0),b.imageManager.bind(b.context,f.scope)),oe){const wi=b.getOrCreateProgram(li,{overrideFog:!1,overrideRtt:!0}),vi=new Float32Array(n.bx([])),di=new n.aM(0,0,0,0,0),Ei=vt?Ef(vi,Q,H,b,0,f.scope,Dt,oe,{tileID:di,tileSize:pt}):Tf(vi,Q,H,P.toPremultipliedRenderColor(R?null:f.lut));wi.draw(b,pe.TRIANGLES,Bt,Ot,qt,fn.disabled,Ei,f.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments)}else for(const wi of Ti){const vi=b.isTileAffectedByFog(wi),di=b.getOrCreateProgram(li,{overrideFog:vi}),Ei=wi.toUnwrapped(),Pi=w?wi.projMatrix:b.transform.calculateProjMatrix(Ei);b.prepareDrawTile();const ji=a?a.getTile(wi):fi?fi[wi.key]:new ll(wi,pt,yt.zoom,b),Wi=vt?Ef(Pi,Q,H,b,0,f.scope,Dt,oe,{tileID:wi,tileSize:pt}):Tf(Pi,Q,H,P.toPremultipliedRenderColor(R?null:f.lut));b.uploadCommonUniforms(de,di,Ei);const{tileBoundsBuffer:or,tileBoundsIndexBuffer:ar,tileBoundsSegments:vr}=b.getTileBoundsBuffers(ji);di.draw(b,pe.TRIANGLES,Bt,Ot,qt,fn.disabled,Wi,f.id,or,ar,vr)}},sky:function(b,a,f){const w=b._atmosphere?n.ah(b.transform.zoom):1,P=f.paint.get("sky-opacity")*w;if(P===0)return;const R=b.context,H=f.paint.get("sky-type"),Q=new Hr(R.gl.LEQUAL,Hr.ReadOnly,[0,1]),oe=b.frameCounter/1e3%1;H==="atmosphere"?b.renderPass==="offscreen"?f.needsSkyboxCapture(b)&&(function(de,pe,yt,pt){const vt=de.context,Dt=vt.gl;let At=pe.skyboxFbo;if(!At){At=pe.skyboxFbo=vt.createFramebuffer(32,32,!0,null),pe.skyboxGeometry=new tu(vt),pe.skyboxTexture=vt.gl.createTexture(),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,pe.skyboxTexture),Dt.texParameteri(Dt.TEXTURE_CUBE_MAP,Dt.TEXTURE_WRAP_S,Dt.CLAMP_TO_EDGE),Dt.texParameteri(Dt.TEXTURE_CUBE_MAP,Dt.TEXTURE_WRAP_T,Dt.CLAMP_TO_EDGE),Dt.texParameteri(Dt.TEXTURE_CUBE_MAP,Dt.TEXTURE_MIN_FILTER,Dt.LINEAR),Dt.texParameteri(Dt.TEXTURE_CUBE_MAP,Dt.TEXTURE_MAG_FILTER,Dt.LINEAR);for(let li=0;li<6;++li)Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+li,0,Dt.RGBA,32,32,0,Dt.RGBA,Dt.UNSIGNED_BYTE,null)}vt.bindFramebuffer.set(At.framebuffer),vt.viewport.set([0,0,32,32]);const Ot=pe.getCenter(de,!0),Bt=de.getOrCreateProgram("skyboxCapture"),qt=new Float64Array(16);n.bx(qt),n.e3(qt,qt,.5*-Math.PI),Xa(de,pe,Bt,qt,Ot,0),n.bx(qt),n.e3(qt,qt,.5*Math.PI),Xa(de,pe,Bt,qt,Ot,1),n.bx(qt),n.cG(qt,qt,.5*-Math.PI),Xa(de,pe,Bt,qt,Ot,2),n.bx(qt),n.cG(qt,qt,.5*Math.PI),Xa(de,pe,Bt,qt,Ot,3),n.bx(qt),Xa(de,pe,Bt,qt,Ot,4),n.bx(qt),n.e3(qt,qt,Math.PI),Xa(de,pe,Bt,qt,Ot,5),vt.viewport.set([0,0,de.width,de.height])}(b,f),f.markSkyboxValid(b)):b.renderPass==="sky"&&function(de,pe,yt,pt,vt){const Dt=de.context,At=Dt.gl,Ot=de.transform,Bt=de.getOrCreateProgram("skybox");Dt.activeTexture.set(At.TEXTURE0),At.bindTexture(At.TEXTURE_CUBE_MAP,pe.skyboxTexture);const qt=((li,fi,Ti,wi,vi)=>({u_matrix:li,u_sun_direction:fi,u_cubemap:0,u_opacity:wi,u_temporal_offset:vi}))(Ot.skyboxMatrix,pe.getCenter(de,!1),0,pt,vt);de.uploadCommonUniforms(Dt,Bt),Bt.draw(de,At.TRIANGLES,yt,_n.disabled,de.colorModeForRenderPass(),fn.backCW,qt,"skybox",pe.skyboxGeometry.vertexBuffer,pe.skyboxGeometry.indexBuffer,pe.skyboxGeometry.segment)}(b,f,Q,P,oe):H==="gradient"&&b.renderPass==="sky"&&function(de,pe,yt,pt,vt){const Dt=de.context,At=Dt.gl,Ot=de.transform,Bt=de.getOrCreateProgram("skyboxGradient");pe.skyboxGeometry||(pe.skyboxGeometry=new tu(Dt)),Dt.activeTexture.set(At.TEXTURE0);let qt=pe.colorRampTexture;qt||(qt=pe.colorRampTexture=new n.T(Dt,pe.colorRamp,At.RGBA8)),qt.bind(At.LINEAR,At.CLAMP_TO_EDGE);const li=((fi,Ti,wi,vi,di)=>({u_matrix:fi,u_color_ramp:0,u_center_direction:Ti,u_radius:n.al(wi),u_opacity:vi,u_temporal_offset:di}))(Ot.skyboxMatrix,pe.getCenter(de,!1),pe.paint.get("sky-gradient-radius"),pt,vt);de.uploadCommonUniforms(Dt,Bt),Bt.draw(de,At.TRIANGLES,yt,_n.disabled,de.colorModeForRenderPass(),fn.backCW,li,"skyboxGradient",pe.skyboxGeometry.vertexBuffer,pe.skyboxGeometry.indexBuffer,pe.skyboxGeometry.segment)}(b,f,Q,P,oe)},custom:function(b,a,f,w){const P=b.context,R=f.implementation;if(!b.transform.projection.unsupportedLayers||!b.transform.projection.unsupportedLayers.includes("custom")||b.terrain&&(b.terrain.renderingToTexture||b.renderPass==="offscreen")&&f.isDraped(a)){if(b.renderPass==="offscreen"){const H=R.prerender;if(H){if(b.setCustomLayerDefaults(),P.setColorMode(b.colorModeForRenderPass()),b.transform.projection.name==="globe"){const Q=b.transform.pointMerc;H.call(R,P.gl,b.transform.customLayerMatrix(),b.transform.getProjection(),b.transform.globeToMercatorMatrix(),n.ah(b.transform.zoom),[Q.x,Q.y],b.transform.pixelsPerMeterRatio)}else H.call(R,P.gl,b.transform.customLayerMatrix());P.setDirty(),b.setBaseState()}}else if(b.renderPass==="translucent"){if(b.terrain&&b.terrain.renderingToTexture){const Q=R.renderToTile;if(Q){const oe=w[0].canonical,de={x:oe.x+w[0].wrap*(R.wrapTileId?0:1<<oe.z),y:oe.y,z:oe.z};P.setDepthMode(Hr.disabled),P.setStencilMode(_n.disabled),P.setColorMode(b.colorModeForRenderPass()),b.setCustomLayerDefaults(),Q.call(R,P.gl,de),P.setDirty(),b.setBaseState()}return}b.setCustomLayerDefaults(),P.setColorMode(b.colorModeForRenderPass()),P.setStencilMode(_n.disabled);const H=R.renderingMode==="3d"?new Hr(b.context.gl.LEQUAL,Hr.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Hr.ReadOnly);if(P.setDepthMode(H),b.transform.projection.name==="globe"){const Q=b.transform.pointMerc;R.render(P.gl,b.transform.customLayerMatrix(),b.transform.getProjection(),b.transform.globeToMercatorMatrix(),n.ah(b.transform.zoom),[Q.x,Q.y],b.transform.pixelsPerMeterRatio)}else R.render(P.gl,b.transform.customLayerMatrix());P.setDirty(),b.setBaseState(),P.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(b,a,f,w){if(b.renderPass==="opaque")return;const P=f.paint.get("model-opacity").constantOr(1);if(P===0)return;const R=f.paint.get("model-cast-shadows");if(b.renderPass==="shadow"&&(!R||b.terrain&&P<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof n.ab))return;const H=b.shadowRenderer,Q=f.paint.get("model-receive-shadows");H&&(H.useNormalOffset=!0,Q||(H.enabled=!1));const oe=()=>{H&&(H.useNormalOffset=!0,Q||(H.enabled=!0))},de=a.getSource();if(b.renderPass==="light-beam"&&de.type!=="batched-model")return;if(de.type==="vector"||de.type==="geojson")return function(Bt,qt,li,fi,Ti){const wi=Bt.transform;if(wi.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${wi.projection.name} projection is not yet implemented`);const vi=wi.getFreeCameraOptions().position;if(!Bt.modelManager)return;const di=Bt.modelManager;li.modelManager=di;const Ei=Bt.shadowRenderer;if(!li._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Pi=li._unevaluatedLayout._values["model-id"],ji=Object.assign({},li.layout.get("model-id").parameters),Wi=Bt.style.order.indexOf(li.fqid);for(const or of fi){const ar=qt.getTile(or).getBucket(li);if(!ar||ar.projection.name!==wi.projection.name)continue;const vr=ar.getModelUris();vr&&!ar.modelsRequested&&(di.addModelsFromBucket(vr,Ti),ar.modelsRequested=!0);const Ui=fh(or,wi);ji.zoom=Ui;const Ji=Pi.possiblyEvaluate(ji);if(Gi(Bt,ar,or),oa.shadowUniformsInitialized=!1,oa.useSingleShadowCascade=!!Ei&&Ei.getMaxCascadeForTile(or.toUnwrapped())===0,Bt.renderPass==="shadow"&&Ei){if(Bt.currentShadowCascade===1&&ar.isInsideFirstShadowMapFrustum)continue;const Zi=wi.calculatePosMatrix(or.toUnwrapped(),wi.worldSize);if(oa.tileMatrix.set(Zi),oa.shadowTileMatrix=Float32Array.from(Ei.calculateShadowPassMatrixFromMatrix(Zi)),oa.aabb.min.fill(0),oa.aabb.max[0]=oa.aabb.max[1]=n.aj,oa.aabb.max[2]=0,mp(ar,oa,Bt,li.scope))continue}const zi=1<<or.canonical.z,ur=[((vi.x-or.wrap)*zi-or.canonical.x)*n.aj,(vi.y*zi-or.canonical.y)*n.aj,vi.z*zi*n.aj];Bt.conflationActive&&Object.keys(ar.instancesPerModel).length>0&&Bt.style.isLayerClipped(li,qt.getSource())&&ar.updateReplacement(or,Bt.replacementSource,Wi,Ti)&&(ar.uploaded=!1,ar.upload(Bt.context));for(let Zi in ar.instancesPerModel){const gr=ar.instancesPerModel[Zi];gr.features.length>0&&(Zi=Ji.evaluate(gr.features[0].feature,{}));const kr=di.getModel(Zi,Ti);if(kr||di.hasURLBeenRequested(Zi)||ar.modelUris.includes(Zi)||(ar.modelUris.push(Zi),ar.modelsRequested=!1),kr&&kr.uploaded)for(const cr of kr.nodes)dh(Bt,li,cr,gr,ur,or,oa)}}}(b,a,f,w,de.type==="vector"?f.scope:""),void oe();if(!de.loaded())return;if(de.type==="batched-model")return function(Bt,qt,li,fi){li.resetLayerRenderingStats(Bt);const Ti=Bt.context,wi=Bt.transform,vi=Bt.style.fog,di=Bt.shadowRenderer;if(wi.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${wi.projection.name} projection is not yet implemented`);const Ei=Bt.transform.getFreeCameraOptions().position,Pi=n.bY([],[Ei.x,Ei.y,Ei.z],Bt.transform.worldSize),ji=n.eb([],Pi),Wi=n.bx([]),or=n.ec(wi.center.lat,wi.zoom),ar=n.bn([],[1,1,1/or]);n.bo(Wi,Wi,ji);const vr=li.paint.get("model-opacity").constantOr(1),Ui=new Hr(Ti.gl.LEQUAL,Hr.ReadWrite,Bt.depthRangeFor3D),Ji=new Hr(Ti.gl.LEQUAL,Hr.ReadOnly,Bt.depthRangeFor3D),zi=new n.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ur=Bt.renderPass==="shadow",Zi=ur&&di?di.getCurrentCascadeFrustum():wi.getFrustum(wi.scaleZoom(wi.worldSize)),gr=li.paint.get("model-front-cutoff"),kr=gr[2]<1,cr=fa(Bt,li.paint.get("model-cutoff-fade-range")),Pr=li.getLayerRenderingStats();(function(Wr,qr,Ur,Qr){const nn=Wr.terrain?Wr.terrain.exaggeration():0,ln=Wr.transform.zoom;for(const gn of Qr){const En=qr.getTile(gn).getBucket(Ur);En&&(En.setFilter(Ur.filter),Wr.conflationActive&&En.updateReplacement(gn,Wr.replacementSource),En.evaluateTransform(Wr,Ur),Wr.terrain&&nn>0&&En.elevationUpdate(Wr.terrain,nn,gn,Ur.source),En.needsReEvaluation(Wr,ln,Ur)&&En.evaluate(Ur))}})(Bt,qt,li,fi),function(){let Wr,qr,Ur;kr?(Wr=fi.length-1,qr=-1,Ur=-1):(Wr=0,qr=fi.length,Ur=1);const Qr=new Float64Array(16),nn=n.ef(),ln=new n.P(0,0);for(let gn=Wr;gn!==qr;gn+=Ur){const En=fi[gn],ss=qt.getTile(En).getBucket(li);if(!ss||!ss.uploaded)continue;let ws=!1;di&&(ws=di.getMaxCascadeForTile(En.toUnwrapped())===0);const cs=wi.calculatePosMatrix(En.toUnwrapped(),wi.worldSize),fs=ss.modelTraits;!ur&&kr&&(n.bi(Qr,cs),n.ad(nn,Pi,Qr),ln.x=nn[0],ln.y=nn[1]);const qs=[];ss.setFilter(li.filter);for(const xn of ss.getNodesInfo()){if(xn.hiddenByReplacement||!xn.node.meshes)continue;const Cn=xn.node;let Fn=0;Bt.terrain&&Cn.elevation&&(Fn=Cn.elevation*Bt.terrain.exaggeration());const Cs=(()=>{const js=xn.aabb;return zi.min=[...js.min],zi.max=[...js.max],zi.min[2]+=Fn,zi.max[2]+=Fn,n.ad(zi.min,zi.min,cs),n.ad(zi.max,zi.max,cs),zi})(),io=xn.evaluatedScale;if(io[0]<=1&&io[1]<=1&&io[2]<=1&&Cs.intersects(Zi)===0)continue;if(!ur&&kr){const js=.16666666666666666;xn.cameraCollisionOpacity=Pi[0]>Cs.min[0]&&Pi[0]<Cs.max[0]&&Pi[1]>Cs.min[1]&&Pi[1]<Cs.max[1]&&Pi[2]*or<Cs.max[2]&&Cn.footprint&&n.bS(ln,Cn.footprint)?Math.max(xn.cameraCollisionOpacity-js,0):Math.min(1,xn.cameraCollisionOpacity+js)}const Ss=[...cs],Kn=1/n.cU(En.canonical),Gs=Cn.anchor?Cn.anchor[0]:0,jn=Cn.anchor?Cn.anchor[1]:0;n.bo(Ss,Ss,[Gs*(io[0]-1)+xn.evaluatedTranslation[0]*Kn,jn*(io[1]-1)+xn.evaluatedTranslation[1]*Kn,Fn+xn.evaluatedTranslation[2]]),n.ci(io,n.eg)||n.cE(Ss,Ss,io);const Ys=n.az([],Ss,Cn.matrix),Ps=n.az([],wi.expandedFarZProjMatrix,Ys),_s=n.az([],wi.expandedFarZProjMatrix,Ss),Is=n.aA([],[Gs,jn,Fn,1],Ps)[2];Cn.hidden=!1;let Qn=vr;ur||(kr&&(Qn*=xn.cameraCollisionOpacity,Qn*=rc(Ss,wi,xn.aabb,gr)),Qn*=gp(cr,Is)),Qn!==0?qs.push({nodeInfo:xn,depth:Is,opacity:Qn,wvpForNode:Ps,wvpForTile:_s,nodeModelMatrix:Ys,tileModelMatrix:Ss}):Cn.hidden=!0}ur||qs.sort((xn,Cn)=>!kr||xn.opacity===1&&Cn.opacity===1?xn.depth<Cn.depth?-1:1:xn.opacity===1?-1:Cn.opacity===1?1:xn.depth>Cn.depth?-1:1);for(const xn of qs){const Cn=xn.nodeInfo,Fn=Cn.node;let Cs=n.az([],ar,xn.tileModelMatrix);n.az(Cs,Wi,Cs);const io=n.bi([],Cs);n.ee(io,io),n.cE(io,io,Rf),Cs=n.az(Cs,Cs,Fn.matrix);const Ss=Bt.renderPass==="light-beam",Kn=li.paint.get("model-color-use-theme").constantOr("default")==="none",Gs=fs&n.em.HasMapboxMeshFeatures,jn=Gs?0:Cn.evaluatedRMEA[0][2];for(let Ys=0;Ys<Fn.meshes.length;++Ys){const Ps=Fn.meshes[Ys],_s=Ys===Fn.lightMeshIndex;let Is=xn.wvpForNode;if(_s){if(!Ss&&!Bt.terrain&&Bt.shadowRenderer){Bt.currentLayer<Bt.firstLightBeamLayer&&(Bt.firstLightBeamLayer=Bt.currentLayer);continue}Is=xn.wvpForTile}else if(Ss)continue;const Qn={defines:[]},js=[];if(!ur&&di&&(di.useNormalOffset=!!Ps.normalBuffer),Mr(Qn.defines,js,Ps,Bt,Kn?null:li.lut),Gs||Qn.defines.push("DIFFUSE_SHADED"),ws&&Qn.defines.push("SHADOWS_SINGLE_CASCADE"),Pr&&(ur?Pr.numRenderedVerticesInShadowPass+=Ps.vertexArray.length:Pr.numRenderedVerticesInTransparentPass+=Ps.vertexArray.length),ur){Us(Ps,xn.nodeModelMatrix,Bt,li);continue}let _o=null;if(vi){const la=Ml(xn.nodeModelMatrix,Bt.transform);if(_o=new Float32Array(la),wi.projection.name!=="globe"){const ea=Ps.aabb.min,Fo=Ps.aabb.max,[el,ca]=vi.getOpacityForBounds(la,ea[0],ea[1],Fo[0],Fo[1]);Qn.overrideFog=el>=Bi||ca>=Bi}}const Ds=Ps.material;let Yn;Ds.occlusionTexture&&Ds.occlusionTexture.offsetScale&&(Yn=Ds.occlusionTexture.offsetScale,Qn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const No=Bt.getOrCreateProgram("model",Qn);!ur&&di&&di.setupShadowsFromMatrix(xn.tileModelMatrix,No,di.useNormalOffset),Bt.uploadCommonUniforms(Ti,No,null,_o);const Do=Ds.pbrMetallicRoughness;Do.metallicFactor=.9,Do.roughnessFactor=.5;const Wo=Kc(new Float32Array(Is),new Float32Array(Cs),new Float32Array(io),new Float32Array(Fn.matrix),Bt,xn.opacity,Do.baseColorFactor,Ds.emissiveFactor,Do.metallicFactor,Do.roughnessFactor,Ds,jn,li,[0,0,0],Yn);!_s&&(Cn.hasTranslucentParts||xn.opacity<1)&&No.draw(Bt,Ti.gl.TRIANGLES,Ui,_n.disabled,In.disabled,fn.backCCW,Wo,li.id,Ps.vertexBuffer,Ps.indexBuffer,Ps.segments,li.paint,Bt.transform.zoom,void 0,js),No.draw(Bt,Ti.gl.TRIANGLES,_s?Ji:Ui,_n.disabled,_s||xn.opacity<1||Cn.hasTranslucentParts?In.alphaBlended:In.unblended,fn.backCCW,Wo,li.id,Ps.vertexBuffer,Ps.indexBuffer,Ps.segments,li.paint,Bt.transform.zoom,void 0,js)}}}}()}(b,a,f,w),void oe();if(de.type!=="model")return;const pe=de.getModels(),yt=[],pt=b.transform.getFreeCameraOptions().position,vt=n.bY([],[pt.x,pt.y,pt.z],b.transform.worldSize);n.eb(vt,vt);const Dt=[],At=[];let Ot=0;for(const Bt of pe){const qt=f.paint.get("model-rotation").constantOr(null),li=f.paint.get("model-scale").constantOr(null),fi=f.paint.get("model-translation").constantOr(null);Bt.computeModelMatrix(b,qt,li,fi,!0,!0,!1);const Ti=n.bx([]),wi=n.ec(Bt.position.lat,b.transform.zoom),vi=n.bn([],[1,1,1/wi]);n.bo(Ti,Ti,vt),yt.push({zScaleMatrix:vi,negCameraPosMatrix:Ti});for(const di of Bt.nodes)Al(b.transform,di,Bt.matrix,b.transform.expandedFarZProjMatrix,Ot,Dt,At);Ot++}if(Dt.sort((Bt,qt)=>qt.depth-Bt.depth),b.renderPass!=="shadow"){if(P===1)for(const Bt of At)$r(Bt,b,f,yt[Bt.modelIndex],_n.disabled,b.colorModeForRenderPass());else{for(const Bt of At)$r(Bt,b,f,yt[Bt.modelIndex],_n.disabled,In.disabled);for(const Bt of At)$r(Bt,b,f,yt[Bt.modelIndex],b.stencilModeFor3D(),b.colorModeForRenderPass());b.resetStencilClippingMasks()}for(const Bt of Dt)$r(Bt,b,f,yt[Bt.modelIndex],_n.disabled,b.colorModeForRenderPass());oe()}else{for(const Bt of At)Us(Bt.mesh,Bt.nodeModelMatrix,b,f);for(const Bt of Dt)Us(Bt.mesh,Bt.nodeModelMatrix,b,f);oe()}}},Ff={line:function(b,a,f){if(b.hasElevatedBuckets=!1,b.hasNonElevatedBuckets=!1,b._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||b._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(a){const w=a.getVisibleCoordinates();for(const P of w){const R=a.getTile(P).getBucket(b);if(R&&(R.elevationType!=="none"?b.hasElevatedBuckets=!0:b.hasNonElevatedBuckets=!0,b.hasElevatedBuckets&&b.hasNonElevatedBuckets))break}}}else b.hasNonElevatedBuckets=!0},model:function(b,a,f){const w=a.getSource();if(!w.loaded())return;if(w.type==="vector"||w.type==="geojson")return void(f.modelManager&&f.modelManager.upload(f,w.type==="vector"?b.scope:""));if(w.type==="batched-model"||w.type!=="model")return;const P=w.getModels();for(const R of P)R.upload(f.context)},raster:function(b,a,f){const w=a.getSource();if(!(w instanceof za&&w.loaded()))return;const P=b.sourceLayer||w.rasterLayerIds&&w.rasterLayerIds[0];if(!P)return;const R=b.paint.get("raster-array-band")||w.getInitialBand(P);if(R==null)return;const H=a.getIds().map(Q=>a.getTileByID(Q));for(const Q of H)Q.updateNeeded(P,R)&&w.prepareTile(Q,P,R)},"raster-particle":function(b,a,f){const w=a.getSource();if(!(w instanceof za&&w.loaded()))return;const P=b.sourceLayer||w.rasterLayerIds&&w.rasterLayerIds[0];if(!P)return;const R=b.paint.get("raster-particle-array-band")||w.getInitialBand(P);if(R==null)return;const H=a.getIds().map(Q=>a.getTileByID(Q));for(const Q of H)Q.updateNeeded(P,R)&&w.prepareTile(Q,P,R)}},Ia={fill:Af},nu={fill:function(b,a,f,w){if(!f.layout||f.layout.get("fill-elevation-reference")==="none")return;const P=b.context.gl,R=new Hr(P.LEQUAL,Hr.ReadOnly,b.depthRangeFor3D),H=new _n({func:P.ALWAYS,mask:255},255,255,P.KEEP,P.KEEP,P.REPLACE),Q=b.transform.getFreeCameraOptions().position,oe=b.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const de of w){const pe=a.getTile(de),yt=pe.getBucket(f);if(!yt)continue;const pt=yt.elevatedStructures;if(!pt||pt.maskSegments.segments[0].primitiveLength===0)continue;const vt=ch(de.toUnwrapped(),Q),Dt=b.translatePosMatrix(de.projMatrix,pe,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),At=sh(Dt,vt,0,0,0);oe.draw(b,P.TRIANGLES,R,H,In.disabled,fn.disabled,At,f.id,pt.vertexBuffer,pt.indexBuffer,pt.maskSegments,f.paint,b.transform.zoom)}}};class nc{constructor(a,f,w,P,R,H){this.context=new eg(a,f),this.transform=w,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=R,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const Q=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const de of Q)this._debugParams.enabledLayers[de]=!0;R.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),R.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),R.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),R.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),R.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),R.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const de of Q)R.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],de);this.occlusionParams=new _p(R),this.setup(),this.numSublayers=Lo.maxUnderzooming+Lo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new km(this),this._wireframeDebugCache=new lg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const oe=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,oe,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=P,this.worldview=H}updateTerrain(a,f){const w=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(w||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wc(this,a));const P=this._terrain;this.transform.elevation=w?P:null,P.update(a,this.transform,f),this.transform.elevation&&!P.enabled&&(this.transform.elevation=null)}_updateFog(a){const f=a.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[w,P]=f.getFovAdjustedRange(this.transform._fov);if(w>P)return void(this.transform.fogCullDistSq=null);const R=w+.78*(P-w);this.transform.fogCullDistSq=R*R}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new Wc(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,f){if(this.width=a*n.q.devicePixelRatio,this.height=f*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style.order)this.style._mergedLayers[w].resize()}setup(){const a=this.context,f=new n.ba;f.emplaceBack(0,0),f.emplaceBack(n.aj,0),f.emplaceBack(0,n.aj),f.emplaceBack(n.aj,n.aj),this.tileExtentBuffer=a.createVertexBuffer(f,n.bc.members),this.tileExtentSegments=n.bd.simpleSegment(0,0,4,2);const w=new n.ba;w.emplaceBack(0,0),w.emplaceBack(n.aj,0),w.emplaceBack(0,n.aj),w.emplaceBack(n.aj,n.aj),this.debugBuffer=a.createVertexBuffer(w,n.bc.members),this.debugSegments=n.bd.simpleSegment(0,0,4,5);const P=new n.ba;P.emplaceBack(-1,-1),P.emplaceBack(1,-1),P.emplaceBack(-1,1),P.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(P,n.bc.members),this.viewportSegments=n.bd.simpleSegment(0,0,4,2);const R=new n.aZ;R.emplaceBack(0,0,0,0),R.emplaceBack(n.aj,0,n.aj,0),R.emplaceBack(0,n.aj,0,n.aj),R.emplaceBack(n.aj,n.aj,n.aj,n.aj),this.mercatorBoundsBuffer=a.createVertexBuffer(R,n.bf.members),this.mercatorBoundsSegments=n.bd.simpleSegment(0,0,4,2);const H=new n.a_;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(H);const Q=new n.bb;for(const de of[0,1,3,2,0])Q.emplaceBack(de);this.debugIndexBuffer=a.createIndexBuffer(Q),this.emptyTexture=new n.T(a,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=n.bz();const oe=this.context.gl;this.stencilClearMode=new _n({func:oe.ALWAYS,mask:0},0,255,oe.ZERO,oe.ZERO,oe.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,Hr.disabled,this.stencilClearMode,In.disabled,fn.disabled,xl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,w){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!w||w.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let Q=!1;for(const oe of w)if(this._tileClippingMaskIDs[oe.key]===void 0){Q=!0;break}if(!Q)return}this.currentStencilSource=f.id;const P=this.context,R=P.gl;this.nextStencilID+w.length>256&&this.clearStencil(),P.setColorMode(In.disabled),P.setDepthMode(Hr.disabled);const H=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const Q of w){const oe=f.getTile(Q),de=this._tileClippingMaskIDs[Q.key]=this.nextStencilID++,{tileBoundsBuffer:pe,tileBoundsIndexBuffer:yt,tileBoundsSegments:pt}=this.getTileBoundsBuffers(oe);H.draw(this,R.TRIANGLES,Hr.disabled,new _n({func:R.ALWAYS,mask:0},de,255,R.KEEP,R.KEEP,R.REPLACE),In.disabled,fn.disabled,xl(Q.projMatrix),"$clipping",pe,yt,pt)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new _n({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new _n({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,w=a.sort((H,Q)=>Q.overscaledZ-H.overscaledZ),P=w[w.length-1].overscaledZ,R=w[0].overscaledZ-P+1;if(R>1){this.currentStencilSource=void 0,this.nextStencilID+R>256&&this.clearStencil();const H={};for(let Q=0;Q<R;Q++)H[Q+P]=new _n({func:f.GEQUAL,mask:255},Q+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=R,[H,w]}return[{[P]:_n.disabled},w]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new In([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new n.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?In.unblended:In.alphaBlended}colorModeForDrapableLayerRenderPass(a){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new In([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new n.am(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,f,w,P=!1){if(this.depthOcclusion)return new Hr(this.context.gl.GREATER,Hr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!P)return Hr.disabled;const R=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Hr(w||this.context.gl.LEQUAL,f,[R,R])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,f=Math.ceil(this.width),w=Math.ceil(this.height),P=this.context.bindFramebuffer.get(),R=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===f&&this.depthFBO.height===w||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),f!==0&&w!==0&&(this.depthFBO=new Mf(this.context,f,w,!1,"texture"),this.depthTexture=new n.T(this.context,{width:f,height:w,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(P),a.bindTexture(a.TEXTURE_2D,R),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,f,w,0,0,f,w,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,f)=>a+f/this._fpsHistory.length,0))}render(a,f){const w=n.q.now();this._dt=w-this._timeStamp,this._timeStamp=w,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=f;const P=this.style._mergedLayers,R=!(!this.terrain||!this.terrain.enabled),H=()=>this.style._getOrder(R).filter(Ui=>{const Ji=P[Ui];return!(Ji.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ji.type]});let Q=H(),oe=!1,de=!1;for(const Ui of Q){const Ji=P[Ui];Ji.type==="circle"&&(oe=!0),Ji.type==="symbol"&&(Ji.hasInitialOcclusionOpacityProperties?de=!0:oe=!0)}let pe=Q.map(Ui=>P[Ui]);const yt=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let pt=0,vt=!1;for(const Ui in yt){const Ji=yt[Ui];Ji.used&&(Ji.prepare(this.context),Ji.getSource().usedInConflation&&++pt)}let Dt=!1;for(const Ui of pe)Ui.isHidden(this.transform.zoom)||(Ui.type==="clip"&&(Dt=!0),this.prepareLayer(Ui));const At={},Ot={},Bt={},qt={},li={};for(const Ui in yt){const Ji=yt[Ui];At[Ui]=Ji.getVisibleCoordinates(),Ot[Ui]=At[Ui].slice().reverse(),Bt[Ui]=Ji.getVisibleCoordinates(!0).reverse(),qt[Ui]=Ji.getShadowCasterCoordinates(),li[Ui]=Ji.sortCoordinatesByDistance(At[Ui])}const fi=Ui=>{const Ji=this.style.getLayerSourceCache(Ui);return Ji&&Ji.used?Ji.getSource():null};if(pt||Dt||this._clippingActiveLastFrame){const Ui=[],Ji=[];let zi=0;for(const ur of pe)this.isSourceForClippingOrConflation(ur,fi(ur))&&(Ui.push(ur),Ji.push(zi)),zi++;if(Ui&&(Dt||Ui.length>1)||this._clippingActiveLastFrame){Dt=!1;const ur=[];for(let Zi=0;Zi<Ui.length;Zi++){const gr=Ui[Zi],kr=Ji[Zi],cr=this.style.getLayerSourceCache(gr);if(!cr||!cr.used||!cr.getSource().usedInConflation&&gr.type!=="clip")continue;let Pr=n.eu,Wr=n.bQ.None;const qr=[];let Ur=!0;if(gr.type==="clip"){Pr=kr;for(const Qr of gr.layout.get("clip-layer-types"))Wr|=Qr==="model"?n.bQ.Model:Qr==="symbol"?n.bQ.Symbol:n.bQ.FillExtrusion;for(const Qr of gr.layout.get("clip-layer-scope"))qr.push(Qr);gr.isHidden(this.transform.zoom)?Ur=!1:Dt=!0}Ur&&ur.push({layer:gr.fqid,cache:cr,order:Pr,clipMask:Wr,clipScope:qr})}this.replacementSource.setSources(ur),vt=!0}}this._clippingActiveLastFrame=Dt,vt||this.replacementSource.clear(),this.conflationActive=vt,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ui=0;Ui<pe.length;Ui++){const Ji=pe[Ui],zi=Ji.cutoffRange();if(this.longestCutoffRange=Math.max(zi,this.longestCutoffRange),zi>0){const ur=fi(Ji);ur&&(this.minCutoffZoom=Math.max(ur.minzoom,this.minCutoffZoom)),Ji.minzoom&&(this.minCutoffZoom=Math.max(Ji.minzoom,this.minCutoffZoom))}Ji.is3D(R)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ui),this._lastOcclusionLayer=Ui)}const Ti=this.style&&this.style.fog;Ti?(this._fogVisible=Ti.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ti.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Bt),this.opaquePassCutoff=0,Q=H(),pe=Q.map(Ui=>P[Ui]));const wi=this._shadowRenderer;if(wi){wi.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ui in yt)for(const Ji of At[Ui]){let zi={min:0,max:0};this.terrain&&(zi=this.terrain.getMinMaxForTile(Ji)||zi),wi.addShadowReceiver(Ji.toUnwrapped(),zi.min,zi.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ic(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const vi=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),di=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(vi&&!this._snow&&(this._snow=new ks(this)),!vi&&this._snow&&(this._snow.destroy(),delete this._snow),di&&!this._rain&&(this._rain=new cg(this)),!di&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Li.has(this.context.gl))return;this.renderPass="offscreen";for(const Ui of pe){const Ji=a.getLayerSourceCache(Ui);if(!Ui.hasOffscreenPass()||Ui.isHidden(this.transform.zoom))continue;const zi=Ji?Ot[Ji.id]:void 0;(Ui.type==="custom"||Ui.type==="raster"||Ui.type==="raster-particle"||Ui.isSky()||zi&&zi.length)&&this.renderLayer(this,Ji,Ui,zi)}this.depthRangeFor3D=[0,1-(pe.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,qt)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ei=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Pi=(()=>{if(f.showOverdrawInspector)return n.am.black;const Ui=this.style.fog;if(Ui&&this.transform.projection.supportsFog){const Ji=this.style.getLut(Ui.scope);if(!Ei){const zi=Ui.properties.get("color-use-theme")==="none",ur=Ui.properties.get("color").toNonPremultipliedRenderColor(zi?null:Ji).toArray01();return new n.am(...ur)}if(Ei){const zi=Ui.properties.get("space-color-use-theme")==="none",ur=Ui.properties.get("space-color").toNonPremultipliedRenderColor(zi?null:Ji).toArray01();return new n.am(...ur)}}return n.am.transparent})();if(this.context.clear({color:Pi,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ei&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=Q.length-1;this.currentLayer>=0;this.currentLayer--){const Ui=pe[this.currentLayer],Ji=a.getLayerSourceCache(Ui);if(Ui.isSky())continue;const zi=Ji?(Ui.is3D(R)?li:Ot)[Ji.id]:void 0;this._renderTileClippingMasks(Ui,Ji,zi),this.renderLayer(this,Ji,Ui,zi)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ei&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Ui=pe[this.currentLayer],Ji=a.getLayerSourceCache(Ui);Ui.isSky()&&this.renderLayer(this,Ji,Ui,Ji?Ot[Ji.id]:void 0)}function ji(Ui,Ji){let zi;return Ji&&(zi=(Ui.type==="symbol"?Bt:Ui.is3D(R)?li:Ot)[Ji.id]),zi}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<Q.length;){const Ui=pe[this.currentLayer];if(Ui.type==="raster"||Ui.type==="raster-particle"){const Ji=a.getLayerSourceCache(Ui);this.renderLayer(this,Ji,Ui,ji(Ui,Ji))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Wi=0;wi&&(Wi=wi.getShadowCastingLayerCount());let or=!1,ar=-1;for(let Ui=0;Ui<Q.length;++Ui){const Ji=pe[Ui];Ji.isHidden(this.transform.zoom)||Ji.is3D(R)&&(ar=Ui)}de&&ar===-1&&(oe=!0);let vr=!1;for(;this.currentLayer<Q.length;){const Ui=pe[this.currentLayer],Ji=a.getLayerSourceCache(Ui);if(Ui.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ui)){if(Ui.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!vr&&Ui.is3D(R)&&!R){const zi=this.currentLayer,ur=Zi=>{for(this.currentLayer=0;this.currentLayer<pe.length;this.currentLayer++){const gr=pe[this.currentLayer];if(Ia[gr.type]){const kr=this.style.getLayerSourceCache(gr);Ia[gr.type](this,kr,gr,ji(gr,kr),Zi)}}};ur("initialize"),ur("reset"),this.currentLayer=zi,vr=!0}if(oe&&!or&&this.terrain&&!this.transform.isOrthographic&&(or=!0,this.blitDepth()),de&&ar!==-1&&this.currentLayer===ar+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ui,Ji,Ji?At[Ji.id]:void 0),this.renderLayer(this,Ji,Ui,ji(Ui,Ji)),!this.terrain&&wi&&Wi>0&&Ui.hasShadowPass()&&--Wi==0){{this.clearStencil();const zi=this.currentLayer;for(this.currentLayer=0;this.currentLayer<pe.length;this.currentLayer++){const ur=pe[this.currentLayer];if(nu[ur.type]){const Zi=this.style.getLayerSourceCache(ur);nu[ur.type](this,Zi,ur,ji(ur,Zi))}}this.currentLayer=zi}if(wi.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const zi=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=zi;this.currentLayer++){const ur=pe[this.currentLayer];if(!ur.hasLightBeamPass())continue;const Zi=a.getLayerSourceCache(ur);this.renderLayer(this,Zi,ur,Zi?Ot[Zi.id]:void 0)}this.currentLayer=zi,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const zi=this.currentLayer;this.depthOcclusion=!0;for(const ur of this.layersWithOcclusionOpacity){this.currentLayer=ur;const Zi=pe[this.currentLayer],gr=a.getLayerSourceCache(Zi),kr=gr?Ot[gr.id]:void 0;this.terrain||this._renderTileClippingMasks(Zi,gr,gr?At[gr.id]:void 0),this.renderLayer(this,gr,Zi,kr)}this.depthOcclusion=!1,this.currentLayer=zi,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ui=null;pe.forEach(Ji=>{const zi=a.getLayerSourceCache(Ji);zi&&!Ji.isHidden(this.transform.zoom)&&zi.getVisibleCoordinates().length&&(!Ui||Ui.getSource().maxzoom<zi.getSource().maxzoom)&&(Ui=zi)}),Ui&&this.options.showTileBoundaries&&Ca(this,Ui,Ui.getVisibleCoordinates(),n.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ca(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ui){const Ji=Ui.transform.padding;uh(Ui,Ui.transform.height-(Ji.top||0),3,ng),uh(Ui,Ji.bottom||0,3,sg),hh(Ui,Ji.left||0,3,Bo),hh(Ui,Ui.transform.width-(Ji.right||0),3,If);const zi=Ui.transform.centerPoint;(function(ur,Zi,gr,kr){tc(ur,Zi-1,gr-10,2,20,kr),tc(ur,Zi-10,gr-1,20,2,kr)})(Ui,zi.x,Ui.transform.height-zi.y,Po)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),vt||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:f}=this.transform.projection,w=!f||!f.includes(a.type);if(Ff[a.type]&&(w||this.terrain&&a.type==="custom")){const P=this.style.getLayerSourceCache(a);Ff[a.type](a,P,this)}this.gpuTimingEnd()}renderLayer(a,f,w,P){w.isHidden(this.transform.zoom)||(w.type==="background"||w.type==="sky"||w.type==="custom"||w.type==="model"||w.type==="raster"||w.type==="raster-particle"||P&&P.length)&&(this.id=w.id,this.gpuTimingStart(w),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(w.type)&&(!a.terrain||w.type!=="custom")||w.type==="clip"||Zn[w.type](a,f,w,P,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,w=this.context.gl;let P=this.gpuTimers[a.id];P||(P=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:w.createQuery()}),P.calls++,w.beginQuery(f.TIME_ELAPSED_EXT,P.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=this.context.gl,w=f.createQuery();this.deferredRenderGpuTimeQueries.push(w),f.beginQuery(a.TIME_ELAPSED_EXT,w)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const w in a){const P=a[w],R=this.context.extTimerQuery,H=R.getQueryParameter(P.query,this.context.gl.QUERY_RESULT)/1e6;R.deleteQueryEXT(P.query),f[w]=H}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.gl;let w=0;for(const P of a)w+=f.getQueryParameter(P,f.QUERY_RESULT)/1e6,f.deleteQuery(P);return w}translatePosMatrix(a,f,w,P,R){if(!w[0]&&!w[1])return a;const H=R?P==="map"?this.transform.angle:0:P==="viewport"?-this.transform.angle:0;if(H){const de=Math.sin(H),pe=Math.cos(H);w=[w[0]*pe-w[1]*de,w[0]*de+w[1]*pe]}const Q=[R?w[0]:n.aw(f,w[0],this.transform.zoom),R?w[1]:n.aw(f,w[1],this.transform.zoom),0],oe=new Float32Array(16);return n.bo(oe,a,Q),oe}saveTileTexture(a){const f=a.size[0],w=this._tileTextures[f];w?w.push(a):this._tileTextures[f]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,f,w){const P=w===void 0?this.terrain&&this.terrain.renderingToTexture:w,R=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(R.push("LIGHTING_3D_MODE"),R.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):P||R.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||R.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(R.push("TERRAIN"),this.linearFloatFilteringSupported()&&R.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&R.push("GLOBE"),!this._fogVisible||P||f!==void 0&&!f||R.push("FOG","FOG_DITHERING"),P&&R.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&R.push("OVERDRAW_INSPECTOR"),R}getOrCreateProgram(a,f){this.cache=this.cache||{};const w=f&&f.defines||[],P=f&&f.config,R=this.currentGlobalDefines(a,f&&f.overrideFog,f&&f.overrideRtt).concat(w),H=nh.cacheKey(ju[a],a,R,P);return this.cache[H]||(this.cache[H]=new nh(this.context,a,ju[a],P,sp[a],R)),this.cache[H]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,f){if(this.style.enable3dLights()){const w=this.style.directionalLight,P=this.style.ambientLight;if(w&&P){const R=((H,Q,oe)=>{const de=H.properties.get("direction"),pe=H.properties.get("color-use-theme")==="none",yt=H.properties.get("color").toNonPremultipliedRenderColor(pe?null:oe.getLut(H.scope)).toArray01(),pt=H.properties.get("intensity"),vt=Q.properties.get("color-use-theme")==="none",Dt=Q.properties.get("color").toNonPremultipliedRenderColor(vt?null:oe.getLut(Q.scope)).toArray01(),At=Q.properties.get("intensity"),Ot=[de.x,de.y,de.z],Bt=n.dw(Dt,At),qt=n.dw(yt,pt);return{u_lighting_ambient_color:Bt,u_lighting_directional_dir:Ot,u_lighting_directional_color:qt,u_ground_radiance:rh(Ot,qt,Bt)}})(w,P,this.style);f.setLightsUniformValues(a,R)}}}uploadCommonUniforms(a,f,w,P,R){if(this.uploadCommonLightUniforms(a,f),this.terrain&&this.terrain.renderingToTexture)return;const H=this.style.fog;if(H){const Q=H.getOpacity(this.transform.pitch),oe=((de,pe,yt,pt,vt,Dt,At,Ot,Bt,qt,li,fi)=>{const Ti=de.transform,wi=pe.properties.get("color-use-theme")==="none",vi=pe.properties.get("color").toNonPremultipliedRenderColor(wi?null:de.style.getLut(pe.scope)).toArray01();vi[3]=pt;const di=de.frameCounter/1e3%1,[Ei,Pi]=pe.properties.get("vertical-range");return{u_fog_matrix:yt?Ti.calculateFogTileMatrix(yt):fi||de.identityMat,u_fog_range:pe.getFovAdjustedRange(Ti._fov),u_fog_color:vi,u_fog_horizon_blend:pe.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ei,Pi),Pi],u_fog_temporal_offset:di,u_frustum_tl:vt,u_frustum_tr:Dt,u_frustum_br:At,u_frustum_bl:Ot,u_globe_pos:Bt,u_globe_radius:qt,u_viewport:li,u_globe_transition:n.ah(Ti.zoom),u_is_globe:+(Ti.projection.name==="globe")}})(this,H,w,Q,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],P);f.setFogUniformValues(a,oe)}R&&f.setCutoffUniformValues(a,R.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},w=this.transform.coveringTiles({tileSize:512});for(const P of w)f[P.key]=a[P.key]||new ll(P,512,this.transform.tileZoom,this,void 0,this.worldview);return f}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,f){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||a.type!=="clip"&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||a.sourceLayer!=="building")&&(!f||f.type!=="batched-model")))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[a.key];return f||(this._cachedTileFogOpacities[a.key]=f=this.style.fog.getOpacityForTile(a)),f[0]>=Bi||f[1]>=Bi}setupDepthForOcclusion(a,f,w){const P=this.context,R=P.gl,H=!!w;var Q;w||(w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),P.activeTexture.set(R.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE),w.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],w.u_depth_range_unpack=[2/((Q=this.depthRangeFor3D)[1]-Q[0]),-1-2*Q[0]/(Q[1]-Q[0])],w.u_occluder_half_size=.5*this.occlusionParams.occluderSize,w.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE),P.activeTexture.set(R.TEXTURE0),H||f.setTerrainUniformValues(P,w)}}function Ya(b,a){let f=!1,w=null;const P=()=>{w=null,f&&(b(),w=setTimeout(P,a),f=!1)};return()=>(f=!0,w||P(),w)}class Of{constructor(a){this._hashName=a&&encodeURIComponent(a),n.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ya(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=gh(a);if(this._hashName){const w=this._hashName;let P=!1;const R=location.hash.slice(1).split("&").map(H=>{const Q=H.split("=")[0];return Q===w?(P=!0,`${Q}=${f}`):H}).filter(H=>H);return P||R.push(`${w}=${f}`),`#${R.join("&")}`}return`#${f}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map(w=>w.split("=")).forEach(w=>{w[0]===this._hashName&&(f=w)}),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(w=>isNaN(Number(w)))){const w=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:w,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function gh(b,a){const f=b.getCenter(),w=Math.round(100*b.getZoom())/100,P=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),R=Math.pow(10,P),H=Math.round(f.lng*R)/R,Q=Math.round(f.lat*R)/R,oe=b.getBearing(),de=b.getPitch();let pe=a?`/${H}/${Q}/${w}`:`${w}/${Q}/${H}`;return(oe||de)&&(pe+="/"+Math.round(10*oe)/10),de&&(pe+=`/${Math.round(de)}`),pe}const sc={linearity:.3,easing:n.ew(0,0,.3,1)},zf=n.h({deceleration:2500,maxSpeed:1400},sc),pa=n.h({deceleration:20,maxSpeed:1400},sc),Ka=n.h({deceleration:1e3,maxSpeed:360},sc),su=n.h({deceleration:1e3,maxSpeed:90},sc);class _h{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=n.q.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:R}of this._inertiaBuffer)f.zoom+=R.zoomDelta||0,f.bearing+=R.bearingDelta||0,f.pitch+=R.pitchDelta||0,R.panDelta&&f.pan._add(R.panDelta),R.around&&(f.around=R.around),R.pinchAround&&(f.pinchAround=R.pinchAround);const w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(f.pan.mag()){const R=ac(f.pan.mag(),w,n.h({},zf,a||{}));P.offset=f.pan.mult(R.amount/f.pan.mag()),P.center=this._map.transform.center,oc(P,R)}if(f.zoom){const R=ac(f.zoom,w,pa);P.zoom=this._map.transform.zoom+R.amount,oc(P,R)}if(f.bearing){const R=ac(f.bearing,w,Ka);P.bearing=this._map.transform.bearing+n.ay(R.amount,-179,179),oc(P,R)}if(f.pitch){const R=ac(f.pitch,w,su);P.pitch=this._map.transform.pitch+R.amount,oc(P,R)}if(P.zoom||P.bearing){const R=f.pinchAround===void 0?f.around:f.pinchAround;P.around=R?this._map.unproject(R):this._map.getCenter()}return this.clear(),P.noMoveStart=!0,P}}function oc(b,a){(!b.duration||b.duration<a.duration)&&(b.duration=a.duration,b.easing=a.easing)}function ac(b,a,f){const{maxSpeed:w,linearity:P,deceleration:R}=f,H=n.ay(b*P/(a/1e3),-w,w),Q=Math.abs(H)/(R*P);return{easing:f.easing,duration:1e3*Q,amount:H*(Q/2)}}class mo extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,w,P={}){const R=Et(f.getCanvasContainer(),w),H=f.unproject(R);super(a,n.h({point:R,lngLat:H,originalEvent:w},P)),this._defaultPrevented=!1,this.target=f}}class lc extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,w){const P=a==="touchend"?w.changedTouches:w.touches,R=Lt(f.getCanvasContainer(),P),H=R.map(oe=>f.unproject(oe)),Q=R.reduce((oe,de,pe,yt)=>oe.add(de.div(yt.length)),new n.P(0,0));super(a,{points:R,point:Q,lngLats:H,lngLat:f.unproject(Q),originalEvent:w}),this._defaultPrevented=!1}}class Ja extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f){super("wheel",{originalEvent:f}),this._defaultPrevented=!1}}class Bf{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Ja(this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new mo(a.type,this._map,a))}mouseup(a){this._map.fire(new mo(a.type,this._map,a))}preclick(a){const f=n.h({},a);f.type="preclick",this._map.fire(new mo(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new mo(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new mo(a.type,this._map,a))}mouseover(a){this._map.fire(new mo(a.type,this._map,a))}mouseout(a){this._map.fire(new mo(a.type,this._map,a))}touchstart(a){return this._firePreventable(new lc(a.type,this._map,a))}touchmove(a){this._map.fire(new lc(a.type,this._map,a))}touchend(a){this._map.fire(new lc(a.type,this._map,a))}touchcancel(a){this._map.fire(new lc(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yh{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new mo(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new mo(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nf{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(he(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const w=f,P=this._startPos,R=this._lastPos;if(!P||!R||R.equals(w)||!this._box&&w.dist(P)<this._clickTolerance)return;this._lastPos=w,this._box||(this._box=ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const H=Math.min(P.x,w.x),Q=Math.max(P.x,w.x),oe=Math.min(P.y,w.y),de=Math.max(P.y,w.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${H}px,${oe}px)`,this._box.style.width=Q-H+"px",this._box.style.height=de-oe+"px")})}mouseupWindow(a,f){if(!this._active)return;const w=this._startPos,P=f;if(w&&a.button===0){if(this.reset(),xt(),w.x!==P.x||w.y!==P.y)return this._map.fire(new n.A("boxzoomend",{originalEvent:a})),{cameraAnimation:R=>R.fitScreenCoordinates(w,P,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new n.A(a,{originalEvent:f}))}}function ou(b,a){const f={};for(let w=0;w<b.length;w++)f[b[w].identifier]=a[w];return f}class go{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,w){(this.centroid||w.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),w.length===this.numTouches&&(this.centroid=function(P){const R=new n.P(0,0);for(const H of P)R._add(H);return R.div(P.length)}(f),this.touches=ou(w,f)))}touchmove(a,f,w){if(this.aborted||!this.centroid)return;const P=ou(w,f);for(const R in this.touches){const H=P[R];(!H||H.dist(this.touches[R])>30)&&(this.aborted=!0)}}touchend(a,f,w){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),w.length===0){const P=!this.aborted&&this.centroid;if(this.reset(),P)return P}}}class au{constructor(a){this.singleTap=new go(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,w){this.singleTap.touchstart(a,f,w)}touchmove(a,f,w){this.singleTap.touchmove(a,f,w)}touchend(a,f,w){const P=this.singleTap.touchend(a,f,w);if(P){const R=a.timeStamp-this.lastTime<500,H=!this.lastTap||this.lastTap.dist(P)<30;if(R&&H||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=P,this.count===this.numTaps)return this.reset(),P}}}class Vf{constructor(){this._zoomIn=new au({numTouches:1,numTaps:2}),this._zoomOut=new au({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,w){this._zoomIn.touchstart(a,f,w),this._zoomOut.touchstart(a,f,w)}touchmove(a,f,w){this._zoomIn.touchmove(a,f,w),this._zoomOut.touchmove(a,f,w)}touchend(a,f,w){const P=this._zoomIn.touchend(a,f,w),R=this._zoomOut.touchend(a,f,w);return P?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:H.getZoom()+1,around:H.unproject(P)},{originalEvent:a})}):R?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:H.getZoom()-1,around:H.unproject(R)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $f={0:1,2:2},Qa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class lu{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const w=Zt(a);this._correctButton(a,w)&&(this._lastPoint=f,this._eventButton=w)}mousemoveWindow(a,f){const w=this._lastPoint;if(w){if(a.preventDefault(),this._eventButton!=null&&function(P,R){const H=$f[R];return P.buttons===void 0||(P.buttons&H)!==H}(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(w)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(w,f)}}mouseupWindow(a){this._lastPoint&&Zt(a)===this._eventButton&&(this._moved&&xt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uf extends lu{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class vh extends lu{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?Qa[a.pitchRotateKey]:void 0}_correctButton(a,f){return this._pitchRotateKey?f===0&&a[this._pitchRotateKey]:f===0&&a.ctrlKey||f===2}_move(a,f){const w=.8*(f.x-a.x);if(w)return this._active=!0,{bearingDelta:w}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class Pl extends lu{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?Qa[a.pitchRotateKey]:void 0}_correctButton(a,f){return this._pitchRotateKey?f===0&&a[this._pitchRotateKey]:f===0&&a.ctrlKey||f===2}_move(a,f){const w=-.5*(f.y-a.y);if(w)return this._active=!0,{pitchDelta:w}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class Gf{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),n.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(a,f,w){return this._calculateTransform(a,f,w)}touchmove(a,f,w){if(this._active&&!(w.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(w.length===1&&!n.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,w)}}touchend(a,f,w){this._calculateTransform(a,f,w),this._active&&w.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,w){w.length>0&&(this._active=!0);const P=ou(w,f),R=new n.P(0,0),H=new n.P(0,0);let Q=0;for(const de in P){const pe=P[de],yt=this._touches[de];yt&&(R._add(pe),H._add(pe.sub(yt)),Q++,P[de]=pe)}if(this._touches=P,Q<this._minTouches||!H.mag())return;const oe=H.div(Q);return this._sum._add(oe),this._sum.mag()<this._clickTolerance?void 0:{around:R.div(Q),panDelta:oe}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class cu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,w){return{}}touchstart(a,f,w){this._firstTwoTouches||w.length<2||(this._firstTwoTouches=[w[0].identifier,w[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,w){const P=this._firstTwoTouches;if(!P)return;a.preventDefault();const[R,H]=P,Q=cc(w,f,R),oe=cc(w,f,H);if(!Q||!oe)return;const de=this._aroundCenter?null:Q.add(oe).div(2);return this._move([Q,oe],de,a)}touchend(a,f,w){if(!this._firstTwoTouches)return;const[P,R]=this._firstTwoTouches,H=cc(w,f,P),Q=cc(w,f,R);H&&Q||(this._active&&xt(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cc(b,a,f){for(let w=0;w<b.length;w++)if(b[w].identifier===f)return a[w]}function uu(b,a){return Math.log(b/a)/Math.LN2}class Hf extends cu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const w=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(uu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uu(this._distance,w),pinchAround:f}}}function xh(b,a){return 180*b.angleWith(a)/Math.PI}class vp extends cu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const w=this._vector;if(this._vector=a[0].sub(a[1]),w&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xh(this._vector,w),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,w=this._startVector;if(!w)return!1;const P=xh(a,w);return Math.abs(P)<f}}function bh(b){return Math.abs(b.y)>Math.abs(b.x)}class xp extends cu{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,bh(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,w){const P=this._lastPoints;if(!P)return;const R=a[0].sub(P[0]),H=a[1].sub(P[1]);return this._map._cooperativeGestures&&!n.ex()&&w.touches.length<3||(this._valid=this.gestureBeginsVertically(R,H,w.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(R.y+H.y)/2*-.5})}gestureBeginsVertically(a,f,w){if(this._valid!==void 0)return this._valid;const P=a.mag()>=2,R=f.mag()>=2;if(!P&&!R)return;if(!P||!R)return this._firstMove==null&&(this._firstMove=w),w-this._firstMove<100&&void 0;const H=a.y>0==f.y>0;return bh(a)&&bh(f)&&H}}const bp={panStep:100,bearingStep:15,pitchStep:10};class wp{constructor(){const a=bp;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,w=0,P=0,R=0,H=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?w=-1:(a.preventDefault(),R=-1);break;case 39:a.shiftKey?w=1:(a.preventDefault(),R=1);break;case 38:a.shiftKey?P=1:(a.preventDefault(),H=-1);break;case 40:a.shiftKey?P=-1:(a.preventDefault(),H=1);break;default:return}return this._rotationDisabled&&(w=0,P=0),{cameraAnimation:Q=>{const oe=Q.getZoom();Q.easeTo({duration:300,easeId:"keyboardHandler",easing:Sp,zoom:f?Math.round(oe)+f*(a.shiftKey?2:1):oe,bearing:Q.getBearing()+w*this._bearingStep,pitch:Q.getPitch()+P*this._pitchStep,offset:[-R*this._panStep,-H*this._panStep],center:Q.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sp(b){return b*(2-b)}const jf=4.000244140625,Tp=1/450;class Ep{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Tp,n.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||n.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const w=n.q.now(),P=w-(this._lastWheelEventTime||0);this._lastWheelEventTime=w,f!==0&&f%jf==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":P>400?(this._type=null,this._lastValue=f,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(P*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Et(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const de=this._type==="wheel"&&Math.abs(this._delta)>jf?this._wheelZoomRate:this._defaultZoomRate;let pe=2/(1+Math.exp(-Math.abs(this._delta*de)));this._delta<0&&pe!==0&&(pe=1/pe);const yt=f(),pt=Math.pow(2,yt),vt=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):pt;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(vt*pe))),this._type==="wheel"&&(this._startZoom=yt,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const w=typeof this._targetZoom=="number"?this._targetZoom:f(),P=this._startZoom,R=this._easing;let H,Q=!1;if(this._type==="wheel"&&P&&R){const de=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),pe=R(de);H=n.ai(P,w,pe),de<1?this._frameId||(this._frameId=!0):Q=!0}else H=w,Q=!0;this._active=!0,Q&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let oe=H-f();return oe*this._lastDelta<0&&(oe=0),{noInertia:!0,needsRenderFrame:!Q,zoomDelta:oe,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=n.ey;if(this._prevEase){const w=this._prevEase,P=(n.q.now()-w.start)/w.duration,R=w.easing(P+.01)-w.easing(P),H=.27/Math.sqrt(R*R+1e-4)*.01,Q=Math.sqrt(.0729-H*H);f=n.ew(H,Q,.25,1)}return this._prevEase={start:n.q.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Mp{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ap{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:w=>{w.easeTo({duration:300,zoom:w.getZoom()+(a.shiftKey?-1:1),around:w.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cp{constructor(){this._tap=new au({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,w){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?w.length>0&&(this._swipePoint=f[0],this._swipeTouch=w[0].identifier):this._tap.touchstart(a,f,w))}touchmove(a,f,w){if(this._tapTime){if(this._swipePoint){if(w[0].identifier!==this._swipeTouch)return;const P=f[0],R=P.y-this._swipePoint.y;return this._swipePoint=P,a.preventDefault(),this._active=!0,{zoomDelta:R/128}}}else this._tap.touchmove(a,f,w)}touchend(a,f,w){this._tapTime?this._swipePoint&&w.length===0&&this.reset():this._tap.touchend(a,f,w)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pp{constructor(a,f,w){this._el=a,this._mousePan=f,this._touchPan=w}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ug{constructor(a,f,w){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class hg{constructor(a,f,w,P){this._el=a,this._touchZoom=f,this._touchRotate=w,this._tapDragZoom=P,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wh=b=>b.zoom||b.drag||b.pitch||b.rotate;class Hs extends n.A{}class Ip{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const w=n.at([],f,a);this.radius=n.ae(w[2]<0?n.eA([],w,this.constants):[w[0],w[1],0])}projectRay(a){n.eA(a,a,this.constants),n.au(a,a),n.eB(a,a,this.constants);const f=n.bY([],a,this.radius);if(f[2]>0){const w=n.bY([],[0,0,1],n.bG(f,[0,0,1])),P=n.bY([],n.au([],[f[0],f[1],0]),this.radius),R=n.cV([],f,n.bY([],n.at([],n.cV([],P,w),f),2));f[0]=R[0],f[1]=R[1]}return f}}function Sh(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class Wf{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _h(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ip,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),n.aV(["handleEvent","handleWindowEvent"],this);const w=this._el;this._listeners=[[w,"touchstart",{passive:!0}],[w,"touchmove",{passive:!1}],[w,"touchend",void 0],[w,"touchcancel",void 0],[w,"mousedown",void 0],[w,"mousemove",void 0],[w,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[w,"mouseover",void 0],[w,"mouseout",void 0],[w,"dblclick",void 0],[w,"click",void 0],[w,"keydown",{capture:!1}],[w,"keyup",void 0],[w,"wheel",{passive:!1}],[w,"contextmenu",void 0],[window,"blur",void 0]];for(const[P,R,H]of this._listeners){const Q=P===document?this.handleWindowEvent:this.handleEvent;P.addEventListener(R,Q,H)}}destroy(){for(const[a,f,w]of this._listeners){const P=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(f,P,w)}}_addDefaultHandlers(a){const f=this._map,w=f.getCanvasContainer();this._add("mapEvent",new Bf(f,a));const P=f.boxZoom=new Nf(f,a);this._add("boxZoom",P);const R=new Vf,H=new Ap;f.doubleClickZoom=new Mp(H,R),this._add("tapZoom",R),this._add("clickZoom",H);const Q=new Cp;this._add("tapDragZoom",Q);const oe=f.touchPitch=new xp(f);this._add("touchPitch",oe);const de=new vh(a),pe=new Pl(a);f.dragRotate=new ug(a,de,pe),this._add("mouseRotate",de,["mousePitch"]),this._add("mousePitch",pe,["mouseRotate"]);const yt=new Uf(a),pt=new Gf(f,a);f.dragPan=new Pp(w,yt,pt),this._add("mousePan",yt),this._add("touchPan",pt,["touchZoom","touchRotate"]);const vt=new vp,Dt=new Hf;f.touchZoomRotate=new hg(w,Dt,vt,Q),this._add("touchRotate",vt,["touchPan","touchZoom"]),this._add("touchZoom",Dt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yh(f));const At=f.scrollZoom=new Ep(f,this);this._add("scrollZoom",At,["mousePan"]);const Ot=f.keyboard=new wp;this._add("keyboard",Ot);for(const Bt of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Bt]&&f[Bt].enable(a[Bt])}_add(a,f,w){this._handlers.push({handlerName:a,handler:f,allowed:w}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,w){for(const P in a)if(P!==w&&(!f||f.indexOf(P)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const w of a)this._el.contains(w.target)&&f.push(w);return f}handleEvent(a,f){this._updatingCamera=!0;const w=a.type==="renderFrame",P=w?void 0:a,R={needsRenderFrame:!1},H={},Q={},oe=a.touches?this._getMapTouches(a.touches):void 0,de=oe?Lt(this._el,oe):w?void 0:Et(this._el,a);for(const{handlerName:pt,handler:vt,allowed:Dt}of this._handlers){if(!vt.isEnabled())continue;let At;this._blockedByActive(Q,Dt,pt)?vt.reset():vt[f||a.type]&&(At=vt[f||a.type](a,de,oe),this.mergeHandlerResult(R,H,At,pt,P),At&&At.needsRenderFrame&&this._triggerRenderFrame()),(At||vt.isActive())&&(Q[pt]=vt)}const pe={};for(const pt in this._previousActiveHandlers)Q[pt]||(pe[pt]=P);this._previousActiveHandlers=Q,(Object.keys(pe).length||Sh(R))&&(this._changes.push([R,H,pe]),this._triggerRenderFrame()),(Object.keys(Q).length||Sh(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:yt}=R;yt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],yt(this._map))}mergeHandlerResult(a,f,w,P,R){if(!w)return;n.h(a,w);const H={handlerName:P,originalEvent:w.originalEvent||R};w.zoomDelta!==void 0&&(f.zoom=H),w.panDelta!==void 0&&(f.drag=H),w.pitchDelta!==void 0&&(f.pitch=H),w.bearingDelta!==void 0&&(f.rotate=H)}_applyChanges(){const a={},f={},w={};for(const[P,R,H]of this._changes)P.panDelta&&(a.panDelta=(a.panDelta||new n.P(0,0))._add(P.panDelta)),P.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(a.around=P.around),P.aroundCoord!==void 0&&(a.aroundCoord=P.aroundCoord),P.pinchAround!==void 0&&(a.pinchAround=P.pinchAround),P.noInertia&&(a.noInertia=P.noInertia),n.h(f,R),n.h(w,H);this._updateMapTransform(a,f,w),this._changes=[]}_updateMapTransform(a,f,w){const P=this._map,R=P.transform,H=qt=>[qt.x,qt.y,qt.z];if((qt=>{const li=this._eventsInProgress.drag;return li&&!this._handlersById[li.handlerName].isActive()})()&&!Sh(a)){const qt=R.zoom;R.cameraElevationReference="sea",this._originalZoom!=null&&R._orthographicProjectionAtLowPitch&&R.projection.name!=="globe"&&R.pitch===0?(R.cameraElevationReference="ground",R.zoom=this._originalZoom):(R.recenterOnTerrain(),R.cameraElevationReference="ground"),qt!==R.zoom&&this._map._update(!0)}if(R._isCameraConstrained&&P._stop(!0),!Sh(a))return void this._fireEvents(f,w,!0);let{panDelta:Q,zoomDelta:oe,bearingDelta:de,pitchDelta:pe,around:yt,aroundCoord:pt,pinchAround:vt}=a;R._isCameraConstrained&&(oe>0&&(oe=0),R._isCameraConstrained=!1),vt!==void 0&&(yt=vt),(oe||(qt=>f[qt]&&!this._eventsInProgress[qt])("drag"))&&yt&&(this._dragOrigin=H(R.pointCoordinate3D(yt)),this._originalZoom=R.zoom,this._trackingEllipsoid.setup(R._camera.position,this._dragOrigin)),R.cameraElevationReference="sea",P._stop(!0),yt=yt||P.transform.centerPoint,de&&(R.bearing+=de),pe&&(R.pitch+=pe),R._updateCameraState();const Dt=[0,0,0];if(Q)if(R.projection.name==="mercator"){const qt=this._trackingEllipsoid.projectRay(R.screenPointToMercatorRay(yt).dir),li=this._trackingEllipsoid.projectRay(R.screenPointToMercatorRay(yt.sub(Q)).dir);Dt[0]=li[0]-qt[0],Dt[1]=li[1]-qt[1]}else{const qt=R.pointCoordinate(yt);if(R.projection.name==="globe"){Q=Q.rotate(-R.angle);const li=R._pixelsPerMercatorPixel/R.worldSize;Dt[0]=-Q.x*n.ez(n.aY(qt.y))*li,Dt[1]=-Q.y*n.ez(R.center.lat)*li}else{const li=R.pointCoordinate(yt.sub(Q));qt&&li&&(Dt[0]=li.x-qt.x,Dt[1]=li.y-qt.y)}}const At=R.zoom,Ot=[0,0,0];if(oe){const qt=H(pt||R.pointCoordinate3D(yt)),li={dir:n.au([],n.at([],qt,R._camera.position))};if(li.dir[2]<0){const fi=R.zoomDeltaToMovement(qt,oe);n.bY(Ot,li.dir,fi)}}const Bt=n.cV(Dt,Dt,Ot);R._translateCameraConstrained(Bt),oe&&Math.abs(R.zoom-At)>1e-4&&R.recenterOnTerrain(),R.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,w,!0)}_fireEvents(a,f,w){const P=wh(this._eventsInProgress),R=wh(a),H={};for(const pe in a){const{originalEvent:yt}=a[pe];this._eventsInProgress[pe]||(H[`${pe}start`]=yt),this._eventsInProgress[pe]=a[pe]}!P&&R&&this._fireEvent("movestart",R.originalEvent);for(const pe in H)this._fireEvent(pe,H[pe]);R&&this._fireEvent("move",R.originalEvent);for(const pe in a){const{originalEvent:yt}=a[pe];this._fireEvent(pe,yt)}const Q={};let oe;for(const pe in this._eventsInProgress){const{handlerName:yt,originalEvent:pt}=this._eventsInProgress[pe];this._handlersById[yt].isActive()||(delete this._eventsInProgress[pe],oe=f[yt]||pt,Q[`${pe}end`]=oe)}for(const pe in Q)this._fireEvent(pe,Q[pe]);const de=wh(this._eventsInProgress);if(w&&(P||R)&&!de){this._updatingCamera=!0;const pe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),yt=pt=>pt!==0&&-this._bearingSnap<pt&&pt<this._bearingSnap;pe?(yt(pe.bearing||this._map.getBearing())&&(pe.bearing=0),this._map.easeTo(pe,{originalEvent:oe})):(this._map.fire(new n.A("moveend",{originalEvent:oe})),yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new n.A(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Hs("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Rp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hu extends n.E{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,n.aV(["_renderFrameCallback"],this)}getCenter(){return new n.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,w){return a=n.P.convert(a).mult(-1),this.panTo(this.transform.center,n.h({offset:a},f),w)}panTo(a,f,w){return this.easeTo(n.h({center:a},f),w)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,w){return this.easeTo(n.h({zoom:a},f),w)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,w){return this.easeTo(n.h({bearing:a},f),w)}resetNorth(a,f){return this.rotateTo(0,n.h({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(n.h({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=n.aG.convert(a);const w=f&&f.bearing||0,P=f&&f.pitch||0,R=a.getNorthWest(),H=a.getSouthEast();return this._cameraForBounds(this.transform,R,H,w,P,f)}_extendPadding(a){const f={top:0,right:0,bottom:0,left:0};return a==null?n.h({},f,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:n.h({},f,a)}_extendCameraOptions(a){return(a=n.h({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,f){const w=f.max[0]-f.min[0],P=f.max[1]-f.min[1];return w/P>a.aspect?w/(2*Math.tan(.5*a.fovX)*a.aspect):P/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,w,P,R,H){const Q=a.clone(),oe=this._extendCameraOptions(H);Q.bearing=P,Q.pitch=R;const de=n.cd.convert(f),pe=n.cd.convert(w),yt=.5*(de.lat+pe.lat),pt=.5*(de.lng+pe.lng),vt=n.eC(yt,pt),Dt=n.au([],vt),At=n.au([],n.bF([],Dt,[0,1,0])),Ot=n.bF([],At,Dt),Bt=[At[0],At[1],At[2],0,Ot[0],Ot[1],Ot[2],0,Dt[0],Dt[1],Dt[2],0,0,0,0,1],qt=[vt,n.eC(de.lat,de.lng),n.eC(pe.lat,de.lng),n.eC(pe.lat,pe.lng),n.eC(de.lat,pe.lng),n.eC(yt,de.lng),n.eC(yt,pe.lng),n.eC(de.lat,pt),n.eC(pe.lat,pt)];let li=n.cW.fromPoints(qt.map(Zi=>[n.bG(At,Zi),n.bG(Ot,Zi),n.bG(Dt,Zi)]));const fi=n.ad([],li.center,Bt);n.eD(fi)===0&&n.eE(fi,0,0,1),n.au(fi,fi),n.bY(fi,fi,n.aB),Q.center=n.eF(fi);const Ti=Q.getWorldToCameraMatrix(),wi=n.bi(new Float64Array(16),Ti);li=n.cW.applyTransform(li,n.az([],Ti,Bt));const vi=this._extendAABB(li,Q,oe,P);if(!vi)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");li=vi,n.ad(fi,fi,Ti);const di=.5*(li.max[2]-li.min[2]),Ei=this._minimumAABBFrustumDistance(Q,li),Pi=n.bY([],[0,0,1],di),ji=n.cV(Pi,fi,Pi),Wi=Ei+(Q.pitch===0?0:n.bD(fi,ji)),or=Q.globeCenterInViewSpace,ar=n.at([],fi,[or[0],or[1],or[2]]);n.au(ar,ar),n.bY(ar,ar,Wi);const vr=n.cV([],fi,ar);n.ad(vr,vr,wi);const Ui=n.eq/n.aB,Ji=n.ae(vr),zi=n.c6(Math.max(Ji*Ui-n.eq,Number.EPSILON),0),ur=Math.min(Q.zoomFromMercatorZAdjusted(zi),oe.maxZoom);return ur>.5*(n.cL+n.cx)?(Q.setProjection({name:"mercator"}),Q.zoom=ur,this._cameraForBounds(Q,f,w,P,R,H)):{center:Q.center,zoom:ur,bearing:P,pitch:R}}_extendAABB(a,f,w,P){const R=.5*((w.padding.left||0)+(w.padding.right||0)),H=.5*((w.padding.top||0)+(w.padding.bottom||0)),Q=H,oe=R,de=R,pe=H,yt=f.width-(oe+de),pt=f.height-(Q+pe),vt=n.at([],a.max,a.min),Dt=Math.min(yt/vt[0],pt/vt[1]),At=Math.min(f.scaleZoom(f.scale*Dt),w.maxZoom);if(isNaN(At))return null;const Ot=f.scale/f.zoomScale(At),Bt=new n.cW([a.min[0]-oe*Ot,a.min[1]-pe*Ot,a.min[2]],[a.max[0]+de*Ot,a.max[1]+Q*Ot,a.max[2]]),qt=(typeof w.offset.x=="number"&&typeof w.offset.y=="number"?new n.P(w.offset.x,w.offset.y):n.P.convert(w.offset)).rotate(-n.al(P));return Bt.center[0]-=qt.x*Ot,Bt.center[1]+=qt.y*Ot,Bt}queryTerrainElevation(a,f){const w=this.transform.elevation;return w?(f=n.h({},{exaggerated:!0},f),w.getAtPoint(n.ac.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,w,P,R,H){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,f,w,P,R,H);const Q=a.clone(),oe=this._extendCameraOptions(H);Q.bearing=P,Q.pitch=R;const de=n.cd.convert(f),pe=n.cd.convert(w),yt=new n.cd(de.lng,pe.lat),pt=new n.cd(pe.lng,de.lat),vt=Q.project(de),Dt=Q.project(pe),At=this.queryTerrainElevation(de),Ot=this.queryTerrainElevation(pe),Bt=this.queryTerrainElevation(yt),qt=this.queryTerrainElevation(pt),li=[[vt.x,vt.y,Math.min(At||0,Ot||0,Bt||0,qt||0)],[Dt.x,Dt.y,Math.max(At||0,Ot||0,Bt||0,qt||0)]];let fi=n.cW.fromPoints(li);const Ti=Q.getWorldToCameraMatrix(),wi=n.bi(new Float64Array(16),Ti);fi=n.cW.applyTransform(fi,Ti);const vi=this._extendAABB(fi,Q,oe,P);if(!vi)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fi=vi;const di=.5*n.at([],fi.max,fi.min)[2],Ei=this._minimumAABBFrustumDistance(Q,fi),Pi=[0,0,1,0];n.aA(Pi,Pi,Ti),n.eG(Pi,Pi);const ji=n.bY([],Pi,Ei+di),Wi=n.cV([],fi.center,ji);n.ad(fi.center,fi.center,wi),n.ad(Wi,Wi,wi);const or=Q.unproject(new n.P(fi.center[0],fi.center[1])),ar=n.eH(Q.projection,or),vr=Math.pow(2,ar),Ui=Math.min(Q._zoomFromMercatorZ(Wi[2]*Q.pixelsPerMeter*vr/Q.worldSize),oe.maxZoom);return Q.mercatorFromTransition&&Ui<.5*(n.cL+n.cx)?(Q.setProjection({name:"globe"}),Q.zoom=Ui,this._cameraForBounds(Q,f,w,P,R,H)):{center:or,zoom:Ui,bearing:P,pitch:R}}fitBounds(a,f,w){const P=this.cameraForBounds(a,f);return this._fitInternal(P,f,w)}fitScreenCoordinates(a,f,w,P,R){const H=n.P.convert(a),Q=n.P.convert(f),oe=new n.P(Math.min(H.x,Q.x),Math.min(H.y,Q.y)),de=new n.P(Math.max(H.x,Q.x),Math.max(H.y,Q.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(H,Q))return this;const pe=this.transform.pointLocation3D(oe),yt=this.transform.pointLocation3D(de),pt=this.transform.pointLocation3D(new n.P(oe.x,de.y)),vt=this.transform.pointLocation3D(new n.P(de.x,oe.y)),Dt=[Math.min(pe.lng,yt.lng,pt.lng,vt.lng),Math.min(pe.lat,yt.lat,pt.lat,vt.lat)],At=[Math.max(pe.lng,yt.lng,pt.lng,vt.lng),Math.max(pe.lat,yt.lat,pt.lat,vt.lat)],Ot=P&&P.pitch?P.pitch:this.getPitch(),Bt=this._cameraForBounds(this.transform,Dt,At,w,Ot,P);return this._fitInternal(Bt,P,R)}_fitInternal(a,f,w){return a?(f=n.h(a,f)).linear?this.easeTo(f,w):this.flyTo(f,w):this}jumpTo(a,f){this.stop();const w=a.preloadOnly?this.transform.clone():this.transform;let P=!1,R=!1,H=!1;"zoom"in a&&w.zoom!==+a.zoom&&(P=!0,w.zoom=+a.zoom),a.center!==void 0&&(w.center=n.cd.convert(a.center)),"bearing"in a&&w.bearing!==+a.bearing&&(R=!0,w.bearing=+a.bearing),"pitch"in a&&w.pitch!==+a.pitch&&(H=!0,w.pitch=+a.pitch);const Q=typeof a.padding=="number"?this._extendPadding(a.padding):a.padding;if(a.padding!=null&&!w.isPaddingEqual(Q))if(a.retainPadding===!1){const oe=w.clone();oe.padding=Q,w.setLocationAtPoint(w.center,oe.centerPoint)}else w.padding=Q;return a.preloadOnly?(this._preloadTiles(w),this):(this.fire(new n.A("movestart",f)).fire(new n.A("move",f)),P&&this.fire(new n.A("zoomstart",f)).fire(new n.A("zoom",f)).fire(new n.A("zoomend",f)),R&&this.fire(new n.A("rotatestart",f)).fire(new n.A("rotate",f)).fire(new n.A("rotateend",f)),H&&this.fire(new n.A("pitchstart",f)).fire(new n.A("pitch",f)).fire(new n.A("pitchend",f)),this.fire(new n.A("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Rp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const w=this.transform;if(!w.projection.supportsFreeCamera)return n.w(Rp),this;this.stop();const P=w.zoom,R=w.pitch,H=w.bearing;w.setFreeCameraOptions(a);const Q=P!==w.zoom,oe=R!==w.pitch,de=H!==w.bearing;return this.fire(new n.A("movestart",f)).fire(new n.A("move",f)),Q&&this.fire(new n.A("zoomstart",f)).fire(new n.A("zoom",f)).fire(new n.A("zoomend",f)),de&&this.fire(new n.A("rotatestart",f)).fire(new n.A("rotate",f)).fire(new n.A("rotateend",f)),oe&&this.fire(new n.A("pitchstart",f)).fire(new n.A("pitch",f)).fire(new n.A("pitchend",f)),this.fire(new n.A("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=n.h({offset:[0,0],duration:500,easing:n.ey},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const w=this.transform,P=this.getZoom(),R=this.getBearing(),H=this.getPitch(),Q=this.getPadding(),oe="zoom"in a?+a.zoom:P,de="bearing"in a?this._normalizeBearing(a.bearing,R):R,pe="pitch"in a?+a.pitch:H,yt=this._extendPadding(a.padding),pt=n.P.convert(a.offset);let vt,Dt,At;if(w.projection.name==="globe"){const Pi=n.ac.fromLngLat(w.center),ji=pt.rotate(-w.angle);Pi.x+=ji.x/w.worldSize,Pi.y+=ji.y/w.worldSize;const Wi=Pi.toLngLat(),or=n.cd.convert(a.center||Wi);this._normalizeCenter(or),vt=w.centerPoint.add(ji),Dt=new n.P(Pi.x,Pi.y).mult(w.worldSize),At=new n.P(n.aD(or.lng),n.aH(or.lat)).mult(w.worldSize).sub(Dt)}else{vt=w.centerPoint.add(pt);const Pi=w.pointLocation(vt),ji=n.cd.convert(a.center||Pi);this._normalizeCenter(ji),Dt=w.project(Pi),At=w.project(ji).sub(Dt)}const Ot=w.zoomScale(oe-P);let Bt,qt;a.around&&(Bt=n.cd.convert(a.around),qt=w.locationPoint(Bt));const li=this._zooming||oe!==P,fi=this._rotating||R!==de,Ti=this._pitching||pe!==H,wi=!w.isPaddingEqual(yt),vi=a.retainPadding===!1?w.clone():w,di=Pi=>ji=>{if(li&&(Pi.zoom=n.ai(P,oe,ji)),fi&&(Pi.bearing=n.ai(R,de,ji)),Ti&&(Pi.pitch=n.ai(H,pe,ji)),wi&&(vi.interpolatePadding(Q,yt,ji),vt=vi.centerPoint.add(pt)),Bt)Pi.setLocationAtPoint(Bt,qt);else{const Wi=Pi.zoomScale(Pi.zoom-P),or=oe>P?Math.min(2,Ot):Math.max(.5,Ot),ar=Math.pow(or,1-ji),vr=Pi.unproject(Dt.add(At.mult(ji*ar)).mult(Wi));Pi.setLocationAtPoint(Pi.renderWorldCopies?vr.wrap():vr,vt)}return a.preloadOnly||this._fireMoveEvents(f),Pi};if(a.preloadOnly){const Pi=this._emulate(di,a.duration,w);return this._preloadTiles(Pi),this}const Ei={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=li,this._rotating=fi,this._pitching=Ti,this._padding=wi,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,Ei),this._ease(di(w),Pi=>{w.cameraElevationReference==="sea"&&w.recenterOnTerrain(),this._afterEase(f,Pi)},a),this}_prepareEase(a,f,w={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||w.moving||this.fire(new n.A("movestart",a)),this._zooming&&!w.zooming&&this.fire(new n.A("zoomstart",a)),this._rotating&&!w.rotating&&this.fire(new n.A("rotatestart",a)),this._pitching&&!w.pitching&&this.fire(new n.A("pitchstart",a))}_fireMoveEvents(a){this.fire(new n.A("move",a)),this._zooming&&this.fire(new n.A("zoom",a)),this._rotating&&this.fire(new n.A("rotate",a)),this._pitching&&this.fire(new n.A("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const w=this._zooming,P=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new n.A("zoomend",a)),P&&this.fire(new n.A("rotateend",a)),R&&this.fire(new n.A("pitchend",a)),this.fire(new n.A("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const Zi=n.aF(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Zi,f)}this.stop(),a=n.h({offset:[0,0],speed:1.2,curve:1.42,easing:n.ey},a);const w=this.transform,P=this.getZoom(),R=this.getBearing(),H=this.getPitch(),Q=this.getPadding(),oe="zoom"in a?n.ay(+a.zoom,w.minZoom,w.maxZoom):P,de="bearing"in a?this._normalizeBearing(a.bearing,R):R,pe="pitch"in a?+a.pitch:H,yt=this._extendPadding(a.padding),pt=w.zoomScale(oe-P),vt=n.P.convert(a.offset);let Dt=w.centerPoint.add(vt);const At=w.pointLocation(Dt),Ot=n.cd.convert(a.center||At);this._normalizeCenter(Ot);const Bt=w.project(At),qt=w.project(Ot).sub(Bt);let li=a.curve;const fi=Math.max(w.width,w.height),Ti=fi/pt,wi=qt.mag();if("minZoom"in a){const Zi=n.ay(Math.min(a.minZoom,P,oe),w.minZoom,w.maxZoom),gr=fi/w.zoomScale(Zi-P);li=Math.sqrt(gr/wi*2)}const vi=li*li;function di(Zi){const gr=(Ti*Ti-fi*fi+(Zi?-1:1)*vi*vi*wi*wi)/(2*(Zi?Ti:fi)*vi*wi);return Math.log(Math.sqrt(gr*gr+1)-gr)}function Ei(Zi){return(Math.exp(Zi)-Math.exp(-Zi))/2}function Pi(Zi){return(Math.exp(Zi)+Math.exp(-Zi))/2}const ji=di(0);let Wi=function(Zi){return Pi(ji)/Pi(ji+li*Zi)},or=function(Zi){return fi*((Pi(ji)*(Ei(gr=ji+li*Zi)/Pi(gr))-Ei(ji))/vi)/wi;var gr},ar=(di(1)-ji)/li;if(Math.abs(wi)<1e-6||!isFinite(ar)){if(Math.abs(fi-Ti)<1e-6)return this.easeTo(a,f);const Zi=Ti<fi?-1:1;ar=Math.abs(Math.log(Ti/fi))/li,or=function(){return 0},Wi=function(gr){return Math.exp(Zi*li*gr)}}a.duration="duration"in a?+a.duration:1e3*ar/("screenSpeed"in a?+a.screenSpeed/li:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const vr=R!==de,Ui=pe!==H,Ji=!w.isPaddingEqual(yt),zi=a.retainPadding===!1?w.clone():w,ur=Zi=>gr=>{const kr=gr*ar,cr=1/Wi(kr);Zi.zoom=gr===1?oe:P+Zi.scaleZoom(cr),vr&&(Zi.bearing=n.ai(R,de,gr)),Ui&&(Zi.pitch=n.ai(H,pe,gr)),Ji&&(zi.interpolatePadding(Q,yt,gr),Dt=zi.centerPoint.add(vt));const Pr=gr===1?Ot:Zi.unproject(Bt.add(qt.mult(or(kr))).mult(cr));return Zi.setLocationAtPoint(Zi.renderWorldCopies?Pr.wrap():Pr,Dt),Zi._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),Zi};if(a.preloadOnly){const Zi=this._emulate(ur,a.duration,w);return this._preloadTiles(Zi),this}return this._zooming=!0,this._rotating=vr,this._pitching=Ui,this._padding=Ji,this._prepareEase(f,!1),this._ease(ur(w),()=>this._afterEase(f),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const w=this._onEaseEnd;this._onEaseEnd=void 0,w.call(this,f)}if(!a){const w=this.handlers;w&&w.stop(!1)}return this}_ease(a,f,w){w.animate===!1||w.duration===0?(a(1),f()):(this._easeStart=n.q.now(),this._easeOptions=w,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=n.bX(a,-180,180);const w=Math.abs(a-f);return Math.abs(a-360-f)<w&&(a-=360),Math.abs(a+360-f)<w&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const w=a.lng-f.center.lng;a.lng+=w>180?-360:w<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,w){const P=Math.ceil(15*f/1e3),R=[],H=a(w.clone());for(let Q=0;Q<=P;Q++){const oe=H(Q/P);R.push(oe.clone())}return R}_preloadTiles(a,f){}}class qf{constructor(a={}){this.options=a,n.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact,w=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",w);const P=ie("span","mapboxgl-ctrl-icon",this._compactButton);return P.setAttribute("aria-hidden","true"),P.setAttribute("title",w),this._innerContainer=ie("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(a){const w=f.reduce((P,R,H)=>(R.value&&(P+=`${R.key}=${R.value}${H<f.length-1?"&":""}`),P),"?");a.href=`${n.e.FEEDBACK_URL}/${w}#${gh(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const P=this._map.style.stylesheet;this.styleOwner=P.owner,this.styleId=P.id}const f=this._map.style._mergedSourceCaches;for(const P in f){const R=f[P];if(R.used){const H=R.getSource();H.attribution&&a.indexOf(H.attribution)<0&&a.push(H.attribution)}}a.sort((P,R)=>P.length-R.length),a=a.filter((P,R)=>{for(let H=R+1;H<a.length;H++)if(a[H].indexOf(P)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const w=a.join(" | ");w!==this._attribHTML&&(this._attribHTML=w,a.length?(this._innerContainer.innerHTML=w,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Th{constructor(){n.aV(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=ie("div","mapboxgl-ctrl");const f=ie("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const w=a[f].getSource();if(w.hasOwnProperty("mapbox_logo")&&!w.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class fu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,w=f?this._queue.concat(f):this._queue;for(const P of w)if(P.id===a)return void(P.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const w of f)if(!w.cancelled&&(w.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ra{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=n.dk((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,w){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+w}}const Eh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Zs extends n.A{constructor(a,f,w,P){const{point:R,lngLat:H,originalEvent:Q,target:oe}=a;super(a.type,{point:R,lngLat:H,originalEvent:Q,target:oe}),this.preventDefault=()=>{a.preventDefault()},this.id=f,this.interaction=w,this.feature=P}}class ma{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,f){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const w=f.filter;let P=f.type;w&&this.filters.set(a,n.b3(w)),P==="mouseover"&&(P="mouseenter"),P==="mouseout"&&(P="mouseleave");const R=this.interactionsByType.get(P)||new Map;P==="mouseenter"||P==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,f)):R.size===0&&this.map.on(P,this.handleType),R.size===0&&this.interactionsByType.set(P,R),R.set(a,f),this.typeById.set(a,P)}get(a){const f=this.typeById.get(a);if(!f)return;const w=this.interactionsByType.get(f);return w?w.get(a):void 0}remove(a){const f=this.typeById.get(a);if(!f)return;this.typeById.delete(a),this.filters.delete(a);const w=this.interactionsByType.get(f);w&&(w.delete(a),f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.delete(a),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):w.size===0&&this.map.off(f,this.handleType))}queryTargets(a,f){const w=[];for(const[P,R]of f)R.target&&w.push({targetId:P,target:R.target,filter:this.filters.get(P)});return this.map.style.queryRenderedTargets(a,w,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const f=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());f.length&&(a.type="mouseenter",this.handleType(a,f));const w=new Map;for(const[P,{feature:R}]of this.prevHoveredFeatures)this.hoveredFeatures.has(P)||w.set(R.id,R);w.size&&(a.type="mouseleave",this.handleType(a,Array.from(w.values())))}handleOut(a){const f=Array.from(this.hoveredFeatures.values()).map(({feature:w})=>w);f.length&&(a.type="mouseleave",this.handleType(a,f)),this.hoveredFeatures.clear()}handleType(a,f){const w=a.type==="mouseenter";if(w&&!this.interactionsByType.has(a.type))return void n.w("mouseenter interaction required for mouseleave to work.");const P=Array.from(this.interactionsByType.get(a.type)).reverse(),R=!!f;f=f||this.queryTargets(a.point,P);let H=!1;const Q=new Set;for(const oe of f){for(const[de,pe]of P){if(!pe.target)continue;const yt=oe.variants?oe.variants[de]:null;if(yt){for(const pt of yt){if(Pu(pt,oe,Q,de))continue;const vt=new n.de(oe,pt),Dt=Ec(pt,oe,de);R&&(vt.state=this.map.getFeatureState(vt));const At=w?this.prevHoveredFeatures.get(Dt):null,Ot=new Zs(a,de,pe,vt),Bt=At?At.stop:pe.handler(Ot);if(w&&this.hoveredFeatures.set(Dt,{feature:oe,stop:Bt}),Bt!==!1){H=!0;break}}if(H)break}}if(H)break}if(!H)for(const[oe,de]of P){const{handler:pe,target:yt}=de;if(!yt&&pe(new Zs(a,oe,de,null))!==!1)break}}}function du(b,a){if(Array.isArray(b)&&Array.isArray(a)){const f=new Set(b),w=new Set(a);return f.size===w.size&&b.every(P=>w.has(P))}return n.bv(b,a)}const Mh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Lp={showCompass:!0,showZoom:!0,visualizePitch:!1};class fg{constructor(a,f,w=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new vh({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,w&&(this.mousePitch=new Pl({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),n.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),he()}move(a,f){const w=this.map,P=this.mouseRotate.mousemoveWindow(a,f),R=P&&P.bearingDelta;if(R&&w.setBearing(w.getBearing()+R),this.mousePitch){const H=this.mousePitch.mousemoveWindow(a,f),Q=H&&H.pitchDelta;Q&&w.setPitch(w.getPitch()+Q)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(n.h({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Et(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Et(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Lt(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Lt(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function uc(b,a,f){if(b=new n.cd(b.lng,b.lat),a){const w=new n.cd(b.lng-360,b.lat),P=new n.cd(b.lng+360,b.lat),R=360*Math.ceil(Math.abs(b.lng-f.center.lng)/360),H=f.locationPoint3D(b).distSqr(a),Q=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint3D(w).distSqr(a)<H&&(Q||Math.abs(w.lng-f.center.lng)<R)?b=w:f.locationPoint3D(P).distSqr(a)<H&&(Q||Math.abs(P.lng-f.center.lng)<R)&&(b=P)}for(;Math.abs(b.lng-f.center.lng)>180;){const w=f.locationPoint3D(b);if(w.x>=0&&w.y>=0&&w.x<=f.width&&w.y<=f.height)break;b.lng>f.center.lng?b.lng-=360:b.lng+=360}return b}const Xf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ga={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class pu extends n.E{constructor(a,f){super(),(a instanceof HTMLElement||f)&&(a=n.h({element:a},f)),n.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:w="center",color:P="#3FB1CE",scale:R=1,draggable:H=!1,clickTolerance:Q=0,rotation:oe=ga.rotation,rotationAlignment:de=ga.rotationAlignment,pitchAlignment:pe=ga.pitchAlignment,occludedOpacity:yt=ga.occludedOpacity,altitude:pt=ga.altitude}=a||{};this._anchor=w,this._color=P,this._scale=R,this._draggable=H,this._clickTolerance=Q,this._rotation=oe,this._rotationAlignment=de,this._pitchAlignment=pe,this._occludedOpacity=yt,this._altitude=pt,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=n.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",At=>{At.preventDefault()}),this._element.addEventListener("mousedown",At=>{At.preventDefault()});const vt=this._element.classList;for(const At in Xf)vt.remove(`mapboxgl-marker-anchor-${At}`);vt.add(`mapboxgl-marker-anchor-${this._anchor}`);const Dt=a&&a.className?a.className.trim().split(/\s+/):[];vt.add(...Dt),this._popup=null}_createDefaultMarker(){const a=ie("div"),f=ue("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(this._altitude===0){const w=ue("radialGradient",{id:"shadowGradient"},ue("defs",{},f));ue("stop",{offset:"10%","stop-opacity":.4},w),ue("stop",{offset:"100%","stop-opacity":.05},w),ue("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f)}return ue("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),ue("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),ue("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=n.cd.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(this._altitude===0&&a!==0||this._altitude!==0&&a===0)&&(this._element=this._createDefaultMarker()),this._altitude=a||ga.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const P=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[P,-1*(38.1-13.5+P)],"bottom-right":[-P,-1*(38.1-13.5+P)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,w=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&w!==32&&w!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,w=this._element;this._popup&&(f===w||w.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const w=a.unproject(f,this._altitude),P=a.getFreeCameraOptions();if(!P.position)return!1;const R=P.position.toLngLat();return R.distanceTo(w)<.9*R.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const w=a.unproject(f,this._altitude);let P;a._showingGlobe()&&n.eK(a.transform,this._lngLat)?P=0:(P=1-a._queryFogOpacity(w),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(P*=this._occludedOpacity)),this._element.style.opacity=`${P}`,this._element.style.pointerEvents=P>0?"auto":"none",this._popup&&this._popup._setOpacity(P),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Xf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const a=this._pos,f=this._map,w=this.getPitchAlignment();if(!f||!a||w!=="map")return"";if(!f._showingGlobe()){const oe=f.getPitch();return oe?`rotateX(${oe}deg)`:""}const P=n.cJ(n.eL(f.transform,this._lngLat)),R=a.sub(n.eM(f.transform)),H=Math.abs(R.x)+Math.abs(R.y);if(H===0)return"";const Q=P/H;return`rotateX(${-R.y*Q}deg) rotateY(${R.x*Q}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let w=0;const P=this.getRotationAlignment();if(P==="map")if(f._showingGlobe()){const R=f.project(new n.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),H=f.project(new n.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(R);w=n.cJ(Math.atan2(H.y,H.x))-90}else w=-f.getBearing();else if(P==="horizon"){const R=n.af(4,6,f.getZoom()),H=n.eM(f.transform);H.y+=R*f.transform.height;const Q=a.sub(H),oe=n.cJ(Math.atan2(Q.y,Q.x));w=(oe>90?oe-270:oe+90)*(1-R)}return w+=this._rotation,w?`rotateZ(${w}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=uc(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat,this._altitude),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=n.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const f=this._map;if(!f)return;const w=this._pointerdownPos,P=this._positionDelta;if(w&&P){if(!this._isDragging){const R=this._clickTolerance||f._clickTolerance;if(a.point.dist(w)<R)return;this._isDragging=!0}this._pos=a.point.sub(P),this._lngLat=f.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.A("dragstart"))),this.fire(new n.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.A("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,w=this._pos;f&&w&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(w),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||ga.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||ga.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||ga.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||ga.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Zf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},mu={maxWidth:100,unit:"metric"},hc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},La={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},aa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qo(b=new n.P(0,0),a="bottom"){if(typeof b=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(b,2)));switch(a){case"top":return new n.P(0,b);case"top-left":return new n.P(f,f);case"top-right":return new n.P(-f,f);case"bottom":return new n.P(0,-b);case"bottom-left":return new n.P(f,-f);case"bottom-right":return new n.P(-f,-f);case"left":return new n.P(b,0);case"right":return new n.P(-b,0)}return new n.P(0,0)}return b instanceof n.P||Array.isArray(b)?n.P.convert(b):n.P.convert(b[a]||[0,0])}return{version:S,supported:Y.supported,setRTLTextPlugin:n.eQ,getRTLTextPluginStatus:n.eP,Map:class extends hu{constructor(b){I.mark(C.create);const a=b;if((b=n.h({},Mh,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(b.antialias&&n.eI(window)&&(b.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ef(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies,null,null),b),this._repaint=!!b.repaint,this._interactive=b.interactive,this._minTileCacheSize=b.minTileCacheSize,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=b.crossSourceCollisions,this._collectResourceTiming=b.collectResourceTiming,this._language=this._parseLanguage(b.language),this._worldview=b.worldview,this._renderTaskQueue=new fu,this._domRenderTaskQueue=new fu,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.a$(),this._locale=n.h({},Eh,b.locale),this._clickTolerance=b.clickTolerance,this._cooperativeGestures=b.cooperativeGestures,this._performanceMetricsCollection=b.performanceMetricsCollection,this._tessellationStep=b.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=b.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ra(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=b.scaleFactor,this._requestManager=new ri(b.transformRequest,b.accessToken,b.testMode),this._silenceAuthErrors=!!b.testMode,this._contextCreateOptions=b.contextCreateOptions?Object.assign({},b.contextCreateOptions):{},typeof b.container=="string"){const f=document.getElementById(b.container);if(!f)throw new Error(`Container '${b.container.toString()}' not found.`);this._container=f}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),b.maxBounds&&this.setMaxBounds(b.maxBounds),this._spriteFormat=b.spriteFormat,n.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Lf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Wf(this,b),this._localFontFamily=b.localFontFamily,this._localIdeographFontFamily=b.localIdeographFontFamily,(b.style||!b.testMode)&&this.setStyle(b.style||n.e.DEFAULT_STYLE,{config:b.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),b.projection&&this.setProjection(b.projection),this.indoor=new Dm(this),b.hash&&(this._hash=new Of(typeof b.hash=="string"&&b.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch});const f=b.bounds;f&&(this.resize(),this.fitBounds(f,n.h({},b.fitBoundsOptions,{duration:0})))}this.resize(),b.attributionControl&&this.addControl(new qf({customAttribution:b.customAttribution})),this._logoControl=new Th,this.addControl(this._logoControl,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new n.A(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new n.A(`${f.dataType}dataloading`,f))}),this._interactions=new ma(this)}_getMapId(){return this._mapId}addControl(b,a){if(a===void 0&&(a=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new n.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=b.onAdd(this);this._controls.push(b);const w=this._controlPositions[a];return a.indexOf("bottom")!==-1?w.insertBefore(f,w.firstChild):w.appendChild(f),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new n.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(b);return a>-1&&this._controls.splice(a,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(b){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new n.A("movestart",b)).fire(new n.A("move",b)),this.fire(new n.A("resize",b)),a&&this.fire(new n.A("moveend",b)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(b){return this.transform.setMaxBounds(n.aG.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b?this.setZoom(b):this.fire(new n.A("zoomstart")).fire(new n.A("zoom")).fire(new n.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b?this.setZoom(b):this.fire(new n.A("zoomstart")).fire(new n.A("zoom")).fire(new n.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b?this.setPitch(b):this.fire(new n.A("pitchstart")).fire(new n.A("pitch")).fire(new n.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b?this.setPitch(b):this.fire(new n.A("pitchstart")).fire(new n.A("pitch")).fire(new n.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(b){return this._scaleFactor=b,this.painter.scaleFactor=b,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(a=>a.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(b){return b==="auto"?navigator.language:Array.isArray(b)?b.length===0?void 0:b.map(a=>a==="auto"?navigator.language:a):b}setLanguage(b){const a=this._parseLanguage(b);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(b){return this.style&&b!==this._worldview?(this._worldview=b,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(b){return this._lazyInitEmptyStyle(),b?typeof b=="string"&&(b={name:b}):b=null,this._useExplicitProjection=!!b,this._prioritizeAndUpdateProjection(b,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const b=this.transform,a=b.projection.name;let f;a==="globe"&&b.zoom>=n.cx?(b.setMercatorFromTransition(),f=!0):a==="mercator"&&b.zoom<n.cx&&(b.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(b,a){return this._updateProjection(b||a||{name:"mercator"})}_updateProjection(b){let a;return a=b.name==="globe"&&this.transform.zoom>=n.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(b),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(b,a){return this.transform.locationPoint3D(n.cd.convert(b),a)}unproject(b,a){return this.transform.pointLocation3D(n.P.convert(b),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(b,a,f){const w=P=>{let R=[];if(Array.isArray(a)){const H=a.filter(Q=>this.getLayer(Q));R=H.length?this.queryRenderedFeatures(P,{layers:H}):[]}else R=this.queryRenderedFeatures(P,{target:a});return R};if(b==="mouseenter"||b==="mouseover"){let P=!1;return{listener:f,targets:a,delegates:{mousemove:H=>{const Q=w(H.point);Q.length?P||(P=!0,f.call(this,new mo(b,this,H.originalEvent,{features:Q}))):P=!1},mouseout:()=>{P=!1}}}}if(b==="mouseleave"||b==="mouseout"){let P=!1;return{listener:f,targets:a,delegates:{mousemove:Q=>{w(Q.point).length?P=!0:P&&(P=!1,f.call(this,new mo(b,this,Q.originalEvent)))},mouseout:Q=>{P&&(P=!1,f.call(this,new mo(b,this,Q.originalEvent)))}}}}{const P=R=>{const H=w(R.point);H.length&&(R.features=H,f.call(this,R),delete R.features)};return{listener:f,targets:a,delegates:{[b]:P}}}}on(b,a,f){if(typeof a=="function"||f===void 0)return super.on(b,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const w=this._createDelegatedListener(b,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(w);for(const P in w.delegates)this.on(P,w.delegates[P]);return this}once(b,a,f){if(typeof a=="function"||f===void 0)return super.once(b,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const w=this._createDelegatedListener(b,a,f);for(const P in w.delegates)this.once(P,w.delegates[P]);return this}off(b,a,f){if(typeof a=="function"||f===void 0)return super.off(b,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const w=this._delegatedListeners?this._delegatedListeners[b]:void 0;return w&&(P=>{for(let R=0;R<P.length;R++){const H=P[R];if(H.listener===f&&du(H.targets,a)){for(const Q in H.delegates)this.off(Q,H.delegates[Q]);return P.splice(R,1),this}}})(w),this}queryRenderedFeatures(b,a){if(!this.style)return[];if(b===void 0||b instanceof n.P||Array.isArray(b)||a!==void 0||(a=b,b=void 0),b=b||[[0,0],[this.transform.width,this.transform.height]],!a){const R=this.style.queryRenderedFeatures(b,void 0,this.transform),H=this.style.queryRenderedFeatureset(b,void 0,this.transform);return R.concat(H)}let f=!0;if(a.target&&(f=this._isTargetValid(a.target),f&&!a.layers))return this.style.queryRenderedFeatureset(b,a,this.transform);let w=!0;if(a.layers&&Array.isArray(a.layers)){for(const R of a.layers)if(!this._isValidId(R)){w=!1;break}if(w&&!a.target)return this.style.queryRenderedFeatures(b,a,this.transform)}let P=[];return w&&(P=P.concat(this.style.queryRenderedFeatures(b,a,this.transform))),f&&(P=P.concat(this.style.queryRenderedFeatureset(b,a,this.transform))),P}querySourceFeatures(b,a){return!b||typeof b=="string"&&!this._isValidId(b)?[]:this.style.querySourceFeatures(b,a)}isPointOnSurface(b){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&n.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(b))}addInteraction(b,a){return this._interactions.add(b,a),this}removeInteraction(b){return this._interactions.remove(b),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(b){return this._cooperativeGestures=b,this}setStyle(b,a){return a=n.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&b&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(b,(f,w)=>{if(f){const P=typeof f=="string"?f:f instanceof Error?f.message:f.error;n.w(`Unable to perform style diff: ${P}. Rebuilding the style from scratch.`),this._updateStyle(b,a)}else w&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(b,a))}_getUIString(b){const a=this._locale[b];if(a==null)throw new Error(`Missing UI string '${b}'`);return a}_updateStyle(b,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),b){const f=n.h({},a);a&&a.config&&(f.initialConfig=a.config,delete f.config),this.style=new So(this,f).load(b),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new So(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(b){return b==null?(this.fire(new n.z(new Error("IDs can't be empty."))),!1):!n.d8(b)||(this.fire(new n.z(new Error(`IDs can't contain special symbols: "${b}".`))),!1)}_isTargetValid(b){return"featuresetId"in b?this._isValidId("importId"in b?b.importId:b.featuresetId):"layerId"in b&&this._isValidId(b.layerId)}_areTargetsValid(b){if(Array.isArray(b)){for(const a of b)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(b)}addSource(b,a){return this._isValidId(b)?(this._lazyInitEmptyStyle(),this.style.addSource(b,a),this._update(!0)):this}isSourceLoaded(b){return!!this._isValidId(b)&&!!this.style&&this.style._isSourceCacheLoaded(b)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(b,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(b,a,f)}removeSource(b){return this._isValidId(b)?(this.style.removeSource(b),this._updateTerrain(),this._update(!0)):this}getSource(b){return this._isValidId(b)?this.style.getOwnSource(b):null}addImage(b,a,{pixelRatio:f=1,sdf:w=!1,stretchX:P,stretchY:R,content:H}={}){this._lazyInitEmptyStyle();const Q=n.I.from(b);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:oe,height:de,data:pe}=n.q.getImageData(a);this.style.addImage(Q,{data:new n.r({width:oe,height:de},pe),pixelRatio:f,stretchX:P,stretchY:R,content:H,sdf:w,version:0,usvg:!1})}else if(a.width===void 0||a.height===void 0)this.fire(new n.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:oe,height:de}=a,pe=a;this.style.addImage(Q,{data:new n.r({width:oe,height:de},new Uint8Array(pe.data)),pixelRatio:f,stretchX:P,stretchY:R,content:H,sdf:w,usvg:!1,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,b)}}updateImage(b,a){this._lazyInitEmptyStyle();const f=n.I.from(b),w=this.style.getImage(f);if(!w)return void this.fire(new n.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const P=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?n.q.getImageData(a):a,{width:R,height:H,data:Q}=P;if(R===void 0||H===void 0)return void this.fire(new n.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(R!==(w.usvg?w.icon.usvg_tree.width:w.data.width)||H!==(w.usvg?w.icon.usvg_tree.height:w.data.height))return void this.fire(new n.z(new Error(`The width and height of the updated image (${R}, ${H})
                must be that same as the previous version of the image
                (${w.data.width}, ${w.data.height})`)));const oe=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let de=!1;w.usvg?(w.data=new n.r({width:R,height:H},new Uint8Array(Q)),w.usvg=!1,w.icon=void 0,de=!0):w.data.replace(Q,oe),this.style.updateImage(f,w,de)}hasImage(b){return b?!!this.style&&!!this.style.getImage(n.I.from(b)):(this.fire(new n.z(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(n.I.from(b))}loadImage(b,a){n.o(this._requestManager.transformRequest(b,n.R.Image),(f,w)=>{a(f,w instanceof HTMLImageElement?n.q.getImageData(w):w)})}listImages(){return this.style.listImages().map(b=>b.name)}addModel(b,a){this._lazyInitEmptyStyle(),this.style.addModel(b,a)}hasModel(b){return b?this.style.hasModel(b):(this.fire(new n.z(new Error("Missing required model id"))),!1)}removeModel(b){this.style.removeModel(b)}listModels(){return this.style.listModels()}addLayer(b,a){return this._isValidId(b.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(b,a),this._update(!0)):this}getSlot(b){const a=this.getLayer(b);return a&&a.slot||null}setSlot(b,a){return this.style.setSlot(b,a),this.style.mergeLayers(),this._update(!0)}addImport(b,a){return this.style.addImport(b,a).catch(f=>this.fire(new n.z(new Error("Failed to add import",f)))),this}updateImport(b,a){return typeof a!="string"&&a.id!==b?(this.removeImport(b),this.addImport(a)):(this.style.updateImport(b,a),this._update(!0))}removeImport(b){return this.style.removeImport(b),this}moveImport(b,a){return this.style.moveImport(b,a),this._update(!0)}moveLayer(b,a){return this._isValidId(b)?(this.style.moveLayer(b,a),this._update(!0)):this}removeLayer(b){return this._isValidId(b)?(this.style.removeLayer(b),this._update(!0)):this}getLayer(b){if(!this._isValidId(b))return null;const a=this.style.getOwnLayer(b);return a?a.type==="custom"?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(b,a,f){return this._isValidId(b)?(this.style.setLayerZoomRange(b,a,f),this._update(!0)):this}setFilter(b,a,f={}){return this._isValidId(b)?(this.style.setFilter(b,a,f),this._update(!0)):this}getFilter(b){return this._isValidId(b)?this.style.getFilter(b):null}setPaintProperty(b,a,f,w={}){return this._isValidId(b)?(this.style.setPaintProperty(b,a,f,w),this._update(!0)):this}getPaintProperty(b,a){return this._isValidId(b)?this.style.getPaintProperty(b,a):null}setLayoutProperty(b,a,f,w={}){return this._isValidId(b)?(this.style.setLayoutProperty(b,a,f,w),this._update(!0)):this}getLayoutProperty(b,a){return this._isValidId(b)?this.style.getLayoutProperty(b,a):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(b){return this.style.setGlyphsUrl(b),this._update(!0)}getSchema(b){return this.style.getSchema(b)}setSchema(b,a){return this.style.setSchema(b,a),this._update(!0)}getConfig(b){return this.style.getConfig(b)}setConfig(b,a){return this.style.setConfig(b,a),this._update(!0)}getConfigProperty(b,a){return this.style.getConfigProperty(b,a)}setConfigProperty(b,a,f){return this.style.setConfigProperty(b,a,f),this._update(!0)}getFeaturesetDescriptors(b){return this.style.getFeaturesetDescriptors(b)}setLights(b){if(this._lazyInitEmptyStyle(),b&&b.length===1&&b[0].type==="flat"){const a=b[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(b),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const b=this.style.getLights()||[];return b.length===0&&b.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),b}setLight(b,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:b}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(b){return this._lazyInitEmptyStyle(),!b&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(b),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(b){return this._lazyInitEmptyStyle(),this.style.setFog(b),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(b){return this._lazyInitEmptyStyle(),this.style.setSnow(b),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(b){return this._lazyInitEmptyStyle(),this.style.setRain(b),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(b){return this._lazyInitEmptyStyle(),this.style.setColorTheme(b),this._update(!0)}setImportColorTheme(b,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(b,a),this._update(!0)}setCamera(b){return this.style.setCamera(b),this._triggerCameraUpdate(b)}_triggerCameraUpdate(b){return this._update(this.transform.setOrthographicProjectionAtLowPitch(b["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(b){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.cd.convert(b),this.transform):0}setFeatureState(b,a){return b.source&&!this._isValidId(b.source)?this:(this.style.setFeatureState(b,a),this._update())}removeFeatureState(b,a){return b.source&&!this._isValidId(b.source)?this:(this.style.removeFeatureState(b,a),this._update())}getFeatureState(b){return b.source&&!this._isValidId(b.source)?null:this.style.getFeatureState(b)}_updateContainerDimensions(){if(!this._container)return;const b=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,w,P,R=this._container;for(;R&&(!w||!P);){const H=window.getComputedStyle(R).transform;H&&H!=="none"&&(f=H.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(w=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(P=f[3])),R=R.parentElement}this._containerWidth=w?Math.abs(b/w):b,this._containerHeight=P?Math.abs(a/P):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const b=this._container;b.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie("div","mapboxgl-canary",b)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=ie("div","mapboxgl-canvas-container",b);this._canvas=ie("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=ie("div","mapboxgl-control-container",b),w=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(P=>{w[P]=ie("div",`mapboxgl-ctrl-${P}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,a){const f=n.q.devicePixelRatio||1;this._canvas.width=f*Math.ceil(b),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${a}px`}_addMarker(b){this._markers.push(b)}_removeMarker(b){const a=this._markers.indexOf(b);a!==-1&&this._markers.splice(a,1)}_addPopup(b){this._popups.push(b)}_removePopup(b){const a=this._popups.indexOf(b);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const b=n.h({},Y.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",b);a?(Mi(a,!0),this.painter=new nc(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.l.testSupport(a)):this.fire(new n.z(new Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.A("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.A("webglcontextrestored",{originalEvent:b}))}_onMapScroll(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_requestDomTask(b){!this.loaded()||this.loaded()&&!this.isMoving()?b():this._domRenderTaskQueue.add(b)}_render(b){let a;this.fire(new n.A("renderstart")),++this._frameId;const f=this.painter.context.extTimerQuery,w=n.q.now(),P=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=P.createQuery(),P.beginQuery(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(b),this._domRenderTaskQueue.run(b),this._removed)return;this._updateProjectionTransition();const R=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const de=this.transform.zoom,pe=this.transform.pitch,yt=n.q.now(),pt=new n.aa(de,{now:yt,fadeDuration:R,pitch:pe,transition:this.style.transition,worldview:this._worldview});this.style.update(pt)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let H=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),H=this._updateAverageElevation(w),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):H=this._updateAverageElevation(w);const Q=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,R,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),Q&&(this._placementDirty=Q.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:R,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(C.load),this.fire(new n.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const de=n.q.now()-w;P.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const pe=P.getQueryParameter(a,P.QUERY_RESULT)/1e6;P.deleteQuery(a),this.fire(new n.A("gpu-timing-frame",{cpuTime:de,gpuTime:pe}))},50)}if(this.listens("gpu-timing-layer")){const de=this.painter.collectGpuTimers();setTimeout(()=>{const pe=this.painter.queryGpuTimers(de);this.fire(new n.A("gpu-timing-layer",{layerTimes:pe}))},50)}if(this.listens("gpu-timing-deferred-render")){const de=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const pe=this.painter.queryGpuTimeDeferredRender(de);this.fire(new n.A("gpu-timing-deferred-render",{gpuTime:pe}))},50)}const oe=this._sourcesDirty||this._styleDirty||this._placementDirty||H;if(oe||this._repaint)this.triggerRepaint();else{const de=this.idle();if(de&&(H=this._updateAverageElevation(w,!0)),H)this.triggerRepaint();else if(this._triggerFrame(!1),de&&(this.fire(new n.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const pe=this._calculateSpeedIndex();this.fire(new n.A("speedindexcompleted",{speedIndex:pe})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||oe||(this._fullyLoaded=!0,I.mark(C.fullLoad),this._performanceMetricsCollection&&ui(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(b){for(const a of this._markers)b&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!b||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(b,a=!1){const f=P=>(this.transform.averageElevation=P,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const w=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(w||(a||b-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(b)){const P=this.transform.averageElevation;let R=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(R)?R=0:this._averageElevationLastSampledAt=b;const H=Math.abs(P-R);if(H>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(R),f(R);this._averageElevation.easeTo(R,b,300)}else if(H>1e-4)return this._averageElevation.jumpTo(R),f(R)}return!!this._averageElevation.isEasing(b)&&f(this._averageElevation.getValue(b))}_authenticate(){Si(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,b=>{if(b&&(b.message===Yt||b.status===401)){const a=this.painter.context.gl;Mi(a,!1),this._logoControl instanceof Th&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ir(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&si(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const b=this._isDragging();this.painter.updateTerrain(this.style,b)}_calculateSpeedIndex(){const b=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,w=f.createFramebuffer();function P(R){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,R,0);const H=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,H),H}return f.bindFramebuffer(f.FRAMEBUFFER,w),this._canvasPixelComparison(P(b),a.canvasCopies.map(P),a.timeStamps)}_canvasPixelComparison(b,a,f){let w=f[1]-f[0];const P=b.length/4;for(let R=0;R<a.length;R++){const H=a[R];let Q=0;for(let oe=0;oe<H.length;oe+=4)H[oe]===b[oe]&&H[oe+1]===b[oe+1]&&H[oe+2]===b[oe+2]&&H[oe+3]===b[oe+3]&&(Q+=1);w+=(f[R+2]-f[R+1])*(1-Q/P)}return w}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Li.delete(this.painter.context.gl),oi.remove(),Er.remove(),this._removed=!0,this.fire(new n.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(b){this._renderNextFrame=this._renderNextFrame||b,this.style&&!this._frame&&(this._frame=n.q.frame(a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)}))}_preloadTiles(b){const a=this.style?this.style.getSourceCaches():[];return n.bt(a,(f,w)=>f._preloadTiles(b,w),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(b){this._trackResize&&this.resize({originalEvent:b})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(b){this._showParseStatus!==b&&(this._showParseStatus=b,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(b){this._showTerrainWireframe!==b&&(this._showTerrainWireframe=b,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(b){this._showLayers2DWireframe!==b&&(this._showLayers2DWireframe=b,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(b){this._showLayers3DWireframe!==b&&(this._showLayers3DWireframe=b,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(b){this._speedIndexTiming!==b&&(this._speedIndexTiming=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,this._tp.refreshUI(),b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(b){this._showTileAABBs!==b&&(this._showTileAABBs=b,this._tp.refreshUI(),b&&this._update())}_setCacheLimits(b,a){n.eJ(b,a)}get version(){return S}},NavigationControl:class{constructor(b={}){this.options=n.h({},Lp,b),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(n.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))}),this._compassIcon=ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const b=this._map;if(!b)return;const a=b.getZoom(),f=a===b.getMaxZoom(),w=a===b.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=w,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",w.toString())}_rotateCompassArrow(){const b=this._map;if(!b)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(b.transform.pitch*(Math.PI/180)),.5)}) rotateX(${b.transform.pitch}deg) rotateZ(${b.transform.angle*(180/Math.PI)}deg)`:`rotate(${b.transform.angle*(180/Math.PI)}deg)`;b._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),b.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&b.on("pitch",this._rotateCompassArrow),b.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fg(b,this._compass,this.options.visualizePitch)),this._container}onRemove(){const b=this._map;b&&(this._container.remove(),this.options.showZoom&&b.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&b.off("pitch",this._rotateCompassArrow),b.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(b,a){const f=ie("button",b,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(b,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);b.setAttribute("aria-label",f),b.firstElementChild&&b.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends n.E{constructor(b={}){super();const a=navigator.geolocation;this.options=n.h({geolocation:a},Zf,b),n.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ya(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(b){return this._map=b,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(b){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,b(f)};this._supportsGeolocation!==void 0?b(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>a(f.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(b){const a=this._map.getMaxBounds(),f=b.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new n.A("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(b),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(b),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.A("geolocate",b)),this._finish()}}_updateCamera(b){const a=new n.cd(b.coords.longitude,b.coords.latitude),f=b.coords.accuracy,w=this._map.getBearing(),P=n.h({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),P,{geolocateSource:!0})}_updateMarker(b){if(b){const a=new n.cd(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const b=this._map.transform,a=n.c6(1,b._center.lat)*b.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(b){if(this._map){if(this.options.trackUserLocation)if(b.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(b.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.A("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(b){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=ie("button","mapboxgl-ctrl-geolocate",this._container),ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",b===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie("div","mapboxgl-user-location"),this._dotElement.appendChild(ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.A("trackuserlocationend")))})}}_onDeviceOrientation(b){this._userLocationDotMarker&&(b.webkitCompassHeading?this._heading=b.webkitCompassHeading:b.absolute===!0&&(this._heading=-1*b.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(b={maximumAge:6e5,timeout:0},this._noTimeout=!0):(b=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,b),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const b=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&b()}).catch(console.error):b()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:qf,ScaleControl:class{constructor(b={}){this.options=n.h({},mu,b),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const b=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,w=a._containerWidth/2-b/2,P=a.unproject([w,f]),R=a.unproject([w+b,f]),H=P.distanceTo(R);if(this.options.unit==="imperial"){const Q=3.2808*H;Q>5280?this._setScale(b,Q/5280,"mile"):this._setScale(b,Q,"foot")}else this.options.unit==="nautical"?this._setScale(b,H/1852,"nautical-mile"):H>=1e3?this._setScale(b,H/1e3,"kilometer"):this._setScale(b,H,"meter")}_setScale(b,a,f){this._map._requestDomTask(()=>{const w=function(R){const H=Math.pow(10,`${Math.floor(R)}`.length-1);let Q=R/H;return Q=Q>=10?10:Q>=5?5:Q>=3?3:Q>=2?2:Q>=1?1:function(oe){const de=Math.pow(10,Math.ceil(-Math.log(oe)/Math.LN10));return Math.round(oe*de)/de}(Q),H*Q}(a),P=w/a;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(w):`${w}&nbsp;${hc[f]}`,this._container.style.width=b*P+"px"})}onAdd(b){return this._map=b,this._language=b.getLanguage(),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",b.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(b){this._language=b,this._update()}setUnit(b){this.options.unit=b,this._update()}},FullscreenControl:class{constructor(b={}){this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:n.w("Full screen control 'container' must be a DOM element.")),n.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const b=this._fullscreenButton=ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie("span","mapboxgl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",b)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(b){super(),this.options=n.h(Object.create(La),b),this._altitude=this.options.altitude,n.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(b&&b.className?b.className.trim().split(/\s+/):[])}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&b.on("preclick",this._onClose),this.options.closeOnMove&&b.on("move",this._onClose),b.on("remove",this.remove),this._update(),b._addPopup(this),this._focusFirstElement(),this._trackPointer?(b.on("mousemove",this._onMouseEvent),b.on("mouseup",this._onMouseEvent),b._canvasContainer.classList.add("mapboxgl-track-pointer")):b.on("move",this._update),this.fire(new n.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const b=this._map;return b&&(b.off("move",this._update),b.off("move",this._onClose),b.off("preclick",this._onClose),b.off("click",this._onClose),b.off("remove",this.remove),b.off("mousemove",this._onMouseEvent),b.off("mouseup",this._onMouseEvent),b.off("drag",this._onMouseEvent),b._canvasContainer&&b._canvasContainer.classList.remove("mapboxgl-track-pointer"),b._removePopup(this),this._map=void 0),this.fire(new n.A("close")),this}getLngLat(){return this._lngLat}setLngLat(b){this._lngLat=n.cd.convert(b),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(b){return this._altitude=b,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const b=this._map;return b&&(b.off("move",this._update),b.on("mousemove",this._onMouseEvent),b.on("drag",this._onMouseEvent),b._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const a=document.createDocumentFragment(),f=document.createElement("body");let w;for(f.innerHTML=b;w=f.firstChild,w;)a.appendChild(w);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=ie("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(b),this.options.closeButton){const f=this._closeButton=ie("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.innerHTML='<span aria-hidden="true">&#215;</span>',f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(b){return this._classList.add(b),this._updateClassList(),this}removeClassName(b){return this._classList.delete(b),this._updateClassList(),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){let a;return this._classList.delete(b)?a=!1:(this._classList.add(b),a=!0),this._updateClassList(),a}_onMouseEvent(b){this._update(b.point)}_getAnchor(b){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,w=this._pos;if(!a||!f||!w)return"bottom";const P=f.offsetWidth,R=f.offsetHeight,H=w.x<P/2,Q=w.x>a.transform.width-P/2;if(w.y+b<R)return H?"top-left":Q?"top-right":"top";if(w.y>a.transform.height-R){if(H)return"bottom-left";if(Q)return"bottom-right"}return H?"left":Q?"right":"bottom"}_updateClassList(){const b=this._container;if(!b)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),b.className=a.join(" ")}_update(b){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let w=this._container;if(w||(w=this._container=ie("div","mapboxgl-popup",a.getContainer()),this._tip=ie("div","mapboxgl-popup-tip",w),w.appendChild(f)),this.options.maxWidth&&w.style.maxWidth!==this.options.maxWidth&&(w.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=uc(this._lngLat,this._pos,a.transform)),!this._trackPointer||b){const P=this._pos=this._trackPointer&&b instanceof n.P?b:a.project(this._lngLat,this._altitude),R=Qo(this.options.offset),H=this._anchor=this._getAnchor(R.y),Q=Qo(this.options.offset,H),oe=P.add(Q).round();a._requestDomTask(()=>{this._container&&H&&(this._container.style.transform=`${Xf[H]} translate(${oe.x}px,${oe.y}px)`)})}if(!this._marker&&a._showingGlobe()){const P=n.eK(a.transform,this._lngLat)?0:1;this._setOpacity(P)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(aa);b&&b.focus()}_onClose(){this.remove()}_setOpacity(b){this._container&&(this._container.style.opacity=`${b}`),this._content&&(this._content.style.pointerEvents=b?"auto":"none")}},Marker:pu,Style:So,LngLat:n.cd,LngLatBounds:n.aG,Point:n.P,MercatorCoordinate:n.ac,FreeCameraOptions:Od,Evented:n.E,config:n.e,prewarm:n.eO,clearPrewarmedResources:n.eN,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(b){n.e.ACCESS_TOKEN=b},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(b){n.e.API_URL=b},get workerCount(){return n.eX.workerCount},set workerCount(b){n.eX.workerCount=b},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(b){n.e.MAX_PARALLEL_IMAGE_REQUESTS=b},clearStorage(b){n.eW(b)},get workerUrl(){return n.eV.workerUrl},set workerUrl(b){n.eV.workerUrl=b},get workerClass(){return n.eV.workerClass},set workerClass(b){n.eV.workerClass=b},get workerParams(){return n.eV.workerParams},set workerParams(b){n.eV.workerParams=b},get dracoUrl(){return n.eU()},set dracoUrl(b){n.eT(b)},get meshoptUrl(){return n.eS()},set meshoptUrl(b){n.eR(b)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var d=o;return d})}(mapboxGl$1)),mapboxGl$1.exports}var mapboxGlExports=requireMapboxGl();const mapboxgl=getDefaultExportFromCjs(mapboxGlExports),mapbox_client_Bztpt0Op2U2nahZGD_h7eJHr8OpAGomgXEw7SLTeMOw=defineNuxtPlugin(e=>{var i,r;const t=useRuntimeConfig();mapboxgl.accessToken=(r=(i=t.public)==null?void 0:i.mapbox)==null?void 0:r.accessToken,e.provide("mapboxgl",mapboxgl)}),REVISION="124",MOUSE={ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,KeepStencilOp=7680,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,GLSL3="300 es";function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const o=r.indexOf(t);o!==-1&&r.splice(o,1)}},dispatchEvent:function(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let o=0,l=r.length;o<l;o++)r[o].call(this,e)}}});const _lut=[];for(let e=0;e<256;e++)_lut[e]=(e<16?"0":"")+e.toString(16);let _seed=1234567;const MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(_lut[e&255]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[i&63|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[r&255]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,o){return r+(e-t)*(o-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return e!==void 0&&(_seed=e%2147483647),_seed=_seed*16807%2147483647,(_seed-1)/2147483646},degToRad:function(e){return e*MathUtils.DEG2RAD},radToDeg:function(e){return e*MathUtils.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,r,o){const l=Math.cos,d=Math.sin,n=l(i/2),S=d(i/2),C=l((t+r)/2),I=d((t+r)/2),z=l((t-r)/2),$=d((t-r)/2),k=l((r-t)/2),Y=d((r-t)/2);switch(o){case"XYX":e.set(n*I,S*z,S*$,n*C);break;case"YZY":e.set(S*$,n*I,S*z,n*C);break;case"ZXZ":e.set(S*z,S*$,n*I,n*C);break;case"XZX":e.set(n*I,S*Y,S*k,n*C);break;case"YXY":e.set(S*k,n*I,S*Y,n*C);break;case"ZYZ":e.set(S*Y,S*k,n*I,n*C);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}};class Vector2{constructor(t=0,i=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,i){return i!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t,i){return i!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,o=t.elements;return this.x=o[0]*i+o[3]*r+o[6],this.y=o[1]*i+o[4]*r+o[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),o=Math.sin(i),l=this.x-t.x,d=this.y-t.y;return this.x=l*r-d*o+t.x,this.y=l*o+d*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Matrix3{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,i,r,o,l,d,n,S,C){const I=this.elements;return I[0]=t,I[1]=o,I[2]=n,I[3]=i,I[4]=l,I[5]=S,I[6]=r,I[7]=d,I[8]=C,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return new this.constructor().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,o=i.elements,l=this.elements,d=r[0],n=r[3],S=r[6],C=r[1],I=r[4],z=r[7],$=r[2],k=r[5],Y=r[8],ie=o[0],ue=o[3],ne=o[6],se=o[1],le=o[4],he=o[7],me=o[2],ge=o[5],xt=o[8];return l[0]=d*ie+n*se+S*me,l[3]=d*ue+n*le+S*ge,l[6]=d*ne+n*he+S*xt,l[1]=C*ie+I*se+z*me,l[4]=C*ue+I*le+z*ge,l[7]=C*ne+I*he+z*xt,l[2]=$*ie+k*se+Y*me,l[5]=$*ue+k*le+Y*ge,l[8]=$*ne+k*he+Y*xt,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],o=t[2],l=t[3],d=t[4],n=t[5],S=t[6],C=t[7],I=t[8];return i*d*I-i*n*C-r*l*I+r*n*S+o*l*C-o*d*S}invert(){const t=this.elements,i=t[0],r=t[1],o=t[2],l=t[3],d=t[4],n=t[5],S=t[6],C=t[7],I=t[8],z=I*d-n*C,$=n*S-I*l,k=C*l-d*S,Y=i*z+r*$+o*k;if(Y===0)return this.set(0,0,0,0,0,0,0,0,0);const ie=1/Y;return t[0]=z*ie,t[1]=(o*C-I*r)*ie,t[2]=(n*r-o*d)*ie,t[3]=$*ie,t[4]=(I*i-o*S)*ie,t[5]=(o*l-n*i)*ie,t[6]=k*ie,t[7]=(r*S-C*i)*ie,t[8]=(d*i-r*l)*ie,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,o,l,d,n){const S=Math.cos(l),C=Math.sin(l);return this.set(r*S,r*C,-r*(S*d+C*n)+d+t,-o*C,o*S,-o*(-C*d+S*n)+n+i,0,0,1),this}scale(t,i){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=i,r[4]*=i,r[7]*=i,this}rotate(t){const i=Math.cos(t),r=Math.sin(t),o=this.elements,l=o[0],d=o[3],n=o[6],S=o[1],C=o[4],I=o[7];return o[0]=i*l+r*S,o[3]=i*d+r*C,o[6]=i*n+r*I,o[1]=-r*l+i*S,o[4]=-r*d+i*C,o[7]=-r*n+i*I,this}translate(t,i){const r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=i*r[2],r[4]+=i*r[5],r[7]+=i*r[8],this}equals(t){const i=this.elements,r=t.elements;for(let o=0;o<9;o++)if(i[o]!==r[o])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}}let _canvas;const ImageUtils={getDataURL:function(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{_canvas===void 0&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=e.width,_canvas.height=e.height;const i=_canvas.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=_canvas}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let textureId=0;function Texture(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,i=ClampToEdgeWrapping,r=ClampToEdgeWrapping,o=LinearFilter,l=LinearMipmapLinearFilter,d=RGBAFormat,n=UnsignedByteType,S=1,C=LinearEncoding){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=o,this.minFilter=l,this.anisotropy=S,this.format=d,this.internalFormat=null,this.type=n,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=C,this.version=0,this.onUpdate=null}Texture.DEFAULT_IMAGE=void 0;Texture.DEFAULT_MAPPING=UVMapping;Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const r=this.image;if(r.uuid===void 0&&(r.uuid=MathUtils.generateUUID()),!t&&e.images[r.uuid]===void 0){let o;if(Array.isArray(r)){o=[];for(let l=0,d=r.length;l<d;l++)r[l].isDataTexture?o.push(serializeImage(r[l].image)):o.push(serializeImage(r[l]))}else o=serializeImage(r);e.images[r.uuid]={uuid:r.uuid,url:o}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}});Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function serializeImage(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Vector4{constructor(t=0,i=0,r=0,o=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=i,this.z=r,this.w=o}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,o){return this.x=t,this.y=i,this.z=r,this.w=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,i){return i!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t,i){return i!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,o=this.z,l=this.w,d=t.elements;return this.x=d[0]*i+d[4]*r+d[8]*o+d[12]*l,this.y=d[1]*i+d[5]*r+d[9]*o+d[13]*l,this.z=d[2]*i+d[6]*r+d[10]*o+d[14]*l,this.w=d[3]*i+d[7]*r+d[11]*o+d[15]*l,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,o,l;const S=t.elements,C=S[0],I=S[4],z=S[8],$=S[1],k=S[5],Y=S[9],ie=S[2],ue=S[6],ne=S[10];if(Math.abs(I-$)<.01&&Math.abs(z-ie)<.01&&Math.abs(Y-ue)<.01){if(Math.abs(I+$)<.1&&Math.abs(z+ie)<.1&&Math.abs(Y+ue)<.1&&Math.abs(C+k+ne-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const le=(C+1)/2,he=(k+1)/2,me=(ne+1)/2,ge=(I+$)/4,xt=(z+ie)/4,Et=(Y+ue)/4;return le>he&&le>me?le<.01?(r=0,o=.707106781,l=.707106781):(r=Math.sqrt(le),o=ge/r,l=xt/r):he>me?he<.01?(r=.707106781,o=0,l=.707106781):(o=Math.sqrt(he),r=ge/o,l=Et/o):me<.01?(r=.707106781,o=.707106781,l=0):(l=Math.sqrt(me),r=xt/l,o=Et/l),this.set(r,o,l,i),this}let se=Math.sqrt((ue-Y)*(ue-Y)+(z-ie)*(z-ie)+($-I)*($-I));return Math.abs(se)<.001&&(se=1),this.x=(ue-Y)/se,this.y=(z-ie)/se,this.z=($-I)/se,this.w=Math.acos((C+k+ne-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function WebGLRenderTarget(e,t,i){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),i=i||{},this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:LinearFilter,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function WebGLMultisampleRenderTarget(e,t,i){WebGLRenderTarget.call(this,e,t,i),this.samples=4}WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(e){return WebGLRenderTarget.prototype.copy.call(this,e),this.samples=e.samples,this}});class Quaternion{constructor(t=0,i=0,r=0,o=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=i,this._z=r,this._w=o}static slerp(t,i,r,o){return r.copy(t).slerp(i,o)}static slerpFlat(t,i,r,o,l,d,n){let S=r[o+0],C=r[o+1],I=r[o+2],z=r[o+3];const $=l[d+0],k=l[d+1],Y=l[d+2],ie=l[d+3];if(z!==ie||S!==$||C!==k||I!==Y){let ue=1-n;const ne=S*$+C*k+I*Y+z*ie,se=ne>=0?1:-1,le=1-ne*ne;if(le>Number.EPSILON){const me=Math.sqrt(le),ge=Math.atan2(me,ne*se);ue=Math.sin(ue*ge)/me,n=Math.sin(n*ge)/me}const he=n*se;if(S=S*ue+$*he,C=C*ue+k*he,I=I*ue+Y*he,z=z*ue+ie*he,ue===1-n){const me=1/Math.sqrt(S*S+C*C+I*I+z*z);S*=me,C*=me,I*=me,z*=me}}t[i]=S,t[i+1]=C,t[i+2]=I,t[i+3]=z}static multiplyQuaternionsFlat(t,i,r,o,l,d){const n=r[o],S=r[o+1],C=r[o+2],I=r[o+3],z=l[d],$=l[d+1],k=l[d+2],Y=l[d+3];return t[i]=n*Y+I*z+S*k-C*$,t[i+1]=S*Y+I*$+C*z-n*k,t[i+2]=C*Y+I*k+n*$-S*z,t[i+3]=I*Y-n*z-S*$-C*k,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,o){return this._x=t,this._y=i,this._z=r,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const r=t._x,o=t._y,l=t._z,d=t._order,n=Math.cos,S=Math.sin,C=n(r/2),I=n(o/2),z=n(l/2),$=S(r/2),k=S(o/2),Y=S(l/2);switch(d){case"XYZ":this._x=$*I*z+C*k*Y,this._y=C*k*z-$*I*Y,this._z=C*I*Y+$*k*z,this._w=C*I*z-$*k*Y;break;case"YXZ":this._x=$*I*z+C*k*Y,this._y=C*k*z-$*I*Y,this._z=C*I*Y-$*k*z,this._w=C*I*z+$*k*Y;break;case"ZXY":this._x=$*I*z-C*k*Y,this._y=C*k*z+$*I*Y,this._z=C*I*Y+$*k*z,this._w=C*I*z-$*k*Y;break;case"ZYX":this._x=$*I*z-C*k*Y,this._y=C*k*z+$*I*Y,this._z=C*I*Y-$*k*z,this._w=C*I*z+$*k*Y;break;case"YZX":this._x=$*I*z+C*k*Y,this._y=C*k*z+$*I*Y,this._z=C*I*Y-$*k*z,this._w=C*I*z-$*k*Y;break;case"XZY":this._x=$*I*z-C*k*Y,this._y=C*k*z-$*I*Y,this._z=C*I*Y+$*k*z,this._w=C*I*z+$*k*Y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+d)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,o=Math.sin(r);return this._x=t.x*o,this._y=t.y*o,this._z=t.z*o,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],o=i[4],l=i[8],d=i[1],n=i[5],S=i[9],C=i[2],I=i[6],z=i[10],$=r+n+z;if($>0){const k=.5/Math.sqrt($+1);this._w=.25/k,this._x=(I-S)*k,this._y=(l-C)*k,this._z=(d-o)*k}else if(r>n&&r>z){const k=2*Math.sqrt(1+r-n-z);this._w=(I-S)/k,this._x=.25*k,this._y=(o+d)/k,this._z=(l+C)/k}else if(n>z){const k=2*Math.sqrt(1+n-r-z);this._w=(l-C)/k,this._x=(o+d)/k,this._y=.25*k,this._z=(S+I)/k}else{const k=2*Math.sqrt(1+z-r-n);this._w=(d-o)/k,this._x=(l+C)/k,this._y=(S+I)/k,this._z=.25*k}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let o=t.dot(i)+1;return o<1e-6?(o=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=o):(this._x=0,this._y=-t.z,this._z=t.y,this._w=o)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=o),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const o=Math.min(1,i/r);return this.slerp(t,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,i){return i!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,o=t._y,l=t._z,d=t._w,n=i._x,S=i._y,C=i._z,I=i._w;return this._x=r*I+d*n+o*C-l*S,this._y=o*I+d*S+l*n-r*C,this._z=l*I+d*C+r*S-o*n,this._w=d*I-r*n-o*S-l*C,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,o=this._y,l=this._z,d=this._w;let n=d*t._w+r*t._x+o*t._y+l*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=d,this._x=r,this._y=o,this._z=l,this;const S=1-n*n;if(S<=Number.EPSILON){const k=1-i;return this._w=k*d+i*this._w,this._x=k*r+i*this._x,this._y=k*o+i*this._y,this._z=k*l+i*this._z,this.normalize(),this._onChangeCallback(),this}const C=Math.sqrt(S),I=Math.atan2(C,n),z=Math.sin((1-i)*I)/C,$=Math.sin(i*I)/C;return this._w=d*z+this._w*$,this._x=r*z+this._x*$,this._y=o*z+this._y*$,this._z=l*z+this._z*$,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Vector3{constructor(t=0,i=0,r=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,i){return i!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t,i){return i!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t,i){return i!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(_quaternion.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,o=this.z,l=t.elements;return this.x=l[0]*i+l[3]*r+l[6]*o,this.y=l[1]*i+l[4]*r+l[7]*o,this.z=l[2]*i+l[5]*r+l[8]*o,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,o=this.z,l=t.elements,d=1/(l[3]*i+l[7]*r+l[11]*o+l[15]);return this.x=(l[0]*i+l[4]*r+l[8]*o+l[12])*d,this.y=(l[1]*i+l[5]*r+l[9]*o+l[13])*d,this.z=(l[2]*i+l[6]*r+l[10]*o+l[14])*d,this}applyQuaternion(t){const i=this.x,r=this.y,o=this.z,l=t.x,d=t.y,n=t.z,S=t.w,C=S*i+d*o-n*r,I=S*r+n*i-l*o,z=S*o+l*r-d*i,$=-l*i-d*r-n*o;return this.x=C*S+$*-l+I*-n-z*-d,this.y=I*S+$*-d+z*-l-C*-n,this.z=z*S+$*-n+C*-d-I*-l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,o=this.z,l=t.elements;return this.x=l[0]*i+l[4]*r+l[8]*o,this.y=l[1]*i+l[5]*r+l[9]*o,this.z=l[2]*i+l[6]*r+l[10]*o,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t,i){return i!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,o=t.y,l=t.z,d=i.x,n=i.y,S=i.z;return this.x=o*S-l*n,this.y=l*d-r*S,this.z=r*n-o*d,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return _vector.copy(this).projectOnVector(t),this.sub(_vector)}reflect(t){return this.sub(_vector.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(MathUtils.clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,o=this.z-t.z;return i*i+r*r+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const o=Math.sin(i)*t;return this.x=o*Math.sin(r),this.y=Math.cos(i)*t,this.z=o*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),o=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=o,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const _vector=new Vector3,_quaternion=new Quaternion;class Box3{constructor(t,i){Object.defineProperty(this,"isBox3",{value:!0}),this.min=t!==void 0?t:new Vector3(1/0,1/0,1/0),this.max=i!==void 0?i:new Vector3(-1/0,-1/0,-1/0)}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){let i=1/0,r=1/0,o=1/0,l=-1/0,d=-1/0,n=-1/0;for(let S=0,C=t.length;S<C;S+=3){const I=t[S],z=t[S+1],$=t[S+2];I<i&&(i=I),z<r&&(r=z),$<o&&(o=$),I>l&&(l=I),z>d&&(d=z),$>n&&(n=$)}return this.min.set(i,r,o),this.max.set(l,d,n),this}setFromBufferAttribute(t){let i=1/0,r=1/0,o=1/0,l=-1/0,d=-1/0,n=-1/0;for(let S=0,C=t.count;S<C;S++){const I=t.getX(S),z=t.getY(S),$=t.getZ(S);I<i&&(i=I),z<r&&(r=z),$<o&&(o=$),I>l&&(l=I),z>d&&(d=z),$>n&&(n=$)}return this.min.set(i,r,o),this.max.set(l,d,n),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=_vector$1.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Vector3),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Vector3),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const i=t.geometry;i!==void 0&&(i.boundingBox===null&&i.computeBoundingBox(),_box.copy(i.boundingBox),_box.applyMatrix4(t.matrixWorld),this.union(_box));const r=t.children;for(let o=0,l=r.length;o<l;o++)this.expandByObject(r[o]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),i=new Vector3),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_vector$1),_vector$1.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0.subVectors(t.a,_center),_v1.subVectors(t.b,_center),_v2.subVectors(t.c,_center),_f0.subVectors(_v1,_v0),_f1.subVectors(_v2,_v1),_f2.subVectors(_v0,_v2);let i=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(i,_v0,_v1,_v2,_extents)||(i=[1,0,0,0,1,0,0,0,1],!satForAxes(i,_v0,_v1,_v2,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),i=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(i,_v0,_v1,_v2,_extents))}clampPoint(t,i){return i===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),i=new Vector3),i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _vector$1.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=this.getSize(_vector$1).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function satForAxes(e,t,i,r,o){for(let l=0,d=e.length-3;l<=d;l+=3){_testAxis.fromArray(e,l);const n=o.x*Math.abs(_testAxis.x)+o.y*Math.abs(_testAxis.y)+o.z*Math.abs(_testAxis.z),S=t.dot(_testAxis),C=i.dot(_testAxis),I=r.dot(_testAxis);if(Math.max(-Math.max(S,C,I),Math.min(S,C,I))>n)return!1}return!0}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$1=new Vector3,_box=new Box3,_v0=new Vector3,_v1=new Vector3,_v2=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3,_box$1=new Box3;class Sphere{constructor(t,i){this.center=t!==void 0?t:new Vector3,this.radius=i!==void 0?i:-1}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):_box$1.setFromPoints(t).getCenter(r);let o=0;for(let l=0,d=t.length;l<d;l++)o=Math.max(o,r.distanceToSquared(t[l]));return this.radius=Math.sqrt(o),this}clone(){return new this.constructor().copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),i=new Vector3),i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Box3),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const _vector$2=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal=new Vector3;class Ray{constructor(t,i){this.origin=t!==void 0?t:new Vector3,this.direction=i!==void 0?i:new Vector3(0,0,-1)}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i===void 0&&(console.warn("THREE.Ray: .at() target is now required"),i=new Vector3),i.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$2)),this}closestPointToPoint(t,i){i===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),i=new Vector3),i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=_vector$2.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(_vector$2.copy(this.direction).multiplyScalar(i).add(this.origin),_vector$2.distanceToSquared(t))}distanceSqToSegment(t,i,r,o){_segCenter.copy(t).add(i).multiplyScalar(.5),_segDir.copy(i).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const l=t.distanceTo(i)*.5,d=-this.direction.dot(_segDir),n=_diff.dot(this.direction),S=-_diff.dot(_segDir),C=_diff.lengthSq(),I=Math.abs(1-d*d);let z,$,k,Y;if(I>0)if(z=d*S-n,$=d*n-S,Y=l*I,z>=0)if($>=-Y)if($<=Y){const ie=1/I;z*=ie,$*=ie,k=z*(z+d*$+2*n)+$*(d*z+$+2*S)+C}else $=l,z=Math.max(0,-(d*$+n)),k=-z*z+$*($+2*S)+C;else $=-l,z=Math.max(0,-(d*$+n)),k=-z*z+$*($+2*S)+C;else $<=-Y?(z=Math.max(0,-(-d*l+n)),$=z>0?-l:Math.min(Math.max(-l,-S),l),k=-z*z+$*($+2*S)+C):$<=Y?(z=0,$=Math.min(Math.max(-l,-S),l),k=$*($+2*S)+C):(z=Math.max(0,-(d*l+n)),$=z>0?l:Math.min(Math.max(-l,-S),l),k=-z*z+$*($+2*S)+C);else $=d>0?-l:l,z=Math.max(0,-(d*$+n)),k=-z*z+$*($+2*S)+C;return r&&r.copy(this.direction).multiplyScalar(z).add(this.origin),o&&o.copy(_segDir).multiplyScalar($).add(_segCenter),k}intersectSphere(t,i){_vector$2.subVectors(t.center,this.origin);const r=_vector$2.dot(this.direction),o=_vector$2.dot(_vector$2)-r*r,l=t.radius*t.radius;if(o>l)return null;const d=Math.sqrt(l-o),n=r-d,S=r+d;return n<0&&S<0?null:n<0?this.at(S,i):this.at(n,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,o,l,d,n,S;const C=1/this.direction.x,I=1/this.direction.y,z=1/this.direction.z,$=this.origin;return C>=0?(r=(t.min.x-$.x)*C,o=(t.max.x-$.x)*C):(r=(t.max.x-$.x)*C,o=(t.min.x-$.x)*C),I>=0?(l=(t.min.y-$.y)*I,d=(t.max.y-$.y)*I):(l=(t.max.y-$.y)*I,d=(t.min.y-$.y)*I),r>d||l>o||((l>r||r!==r)&&(r=l),(d<o||o!==o)&&(o=d),z>=0?(n=(t.min.z-$.z)*z,S=(t.max.z-$.z)*z):(n=(t.max.z-$.z)*z,S=(t.min.z-$.z)*z),r>S||n>o)||((n>r||r!==r)&&(r=n),(S<o||o!==o)&&(o=S),o<0)?null:this.at(r>=0?r:o,i)}intersectsBox(t){return this.intersectBox(t,_vector$2)!==null}intersectTriangle(t,i,r,o,l){_edge1.subVectors(i,t),_edge2.subVectors(r,t),_normal.crossVectors(_edge1,_edge2);let d=this.direction.dot(_normal),n;if(d>0){if(o)return null;n=1}else if(d<0)n=-1,d=-d;else return null;_diff.subVectors(this.origin,t);const S=n*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(S<0)return null;const C=n*this.direction.dot(_edge1.cross(_diff));if(C<0||S+C>d)return null;const I=-n*_diff.dot(_normal);return I<0?null:this.at(I/d,l)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Matrix4{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,i,r,o,l,d,n,S,C,I,z,$,k,Y,ie,ue){const ne=this.elements;return ne[0]=t,ne[4]=i,ne[8]=r,ne[12]=o,ne[1]=l,ne[5]=d,ne[9]=n,ne[13]=S,ne[2]=C,ne[6]=I,ne[10]=z,ne[14]=$,ne[3]=k,ne[7]=Y,ne[11]=ie,ne[15]=ue,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,o=1/_v1$1.setFromMatrixColumn(t,0).length(),l=1/_v1$1.setFromMatrixColumn(t,1).length(),d=1/_v1$1.setFromMatrixColumn(t,2).length();return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[3]=0,i[4]=r[4]*l,i[5]=r[5]*l,i[6]=r[6]*l,i[7]=0,i[8]=r[8]*d,i[9]=r[9]*d,i[10]=r[10]*d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const i=this.elements,r=t.x,o=t.y,l=t.z,d=Math.cos(r),n=Math.sin(r),S=Math.cos(o),C=Math.sin(o),I=Math.cos(l),z=Math.sin(l);if(t.order==="XYZ"){const $=d*I,k=d*z,Y=n*I,ie=n*z;i[0]=S*I,i[4]=-S*z,i[8]=C,i[1]=k+Y*C,i[5]=$-ie*C,i[9]=-n*S,i[2]=ie-$*C,i[6]=Y+k*C,i[10]=d*S}else if(t.order==="YXZ"){const $=S*I,k=S*z,Y=C*I,ie=C*z;i[0]=$+ie*n,i[4]=Y*n-k,i[8]=d*C,i[1]=d*z,i[5]=d*I,i[9]=-n,i[2]=k*n-Y,i[6]=ie+$*n,i[10]=d*S}else if(t.order==="ZXY"){const $=S*I,k=S*z,Y=C*I,ie=C*z;i[0]=$-ie*n,i[4]=-d*z,i[8]=Y+k*n,i[1]=k+Y*n,i[5]=d*I,i[9]=ie-$*n,i[2]=-d*C,i[6]=n,i[10]=d*S}else if(t.order==="ZYX"){const $=d*I,k=d*z,Y=n*I,ie=n*z;i[0]=S*I,i[4]=Y*C-k,i[8]=$*C+ie,i[1]=S*z,i[5]=ie*C+$,i[9]=k*C-Y,i[2]=-C,i[6]=n*S,i[10]=d*S}else if(t.order==="YZX"){const $=d*S,k=d*C,Y=n*S,ie=n*C;i[0]=S*I,i[4]=ie-$*z,i[8]=Y*z+k,i[1]=z,i[5]=d*I,i[9]=-n*I,i[2]=-C*I,i[6]=k*z+Y,i[10]=$-ie*z}else if(t.order==="XZY"){const $=d*S,k=d*C,Y=n*S,ie=n*C;i[0]=S*I,i[4]=-z,i[8]=C*I,i[1]=$*z+ie,i[5]=d*I,i[9]=k*z-Y,i[2]=Y*z-k,i[6]=n*I,i[10]=ie*z+$}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,i,r){const o=this.elements;return _z.subVectors(t,i),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),_x.lengthSq()===0&&(Math.abs(r.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),o[0]=_x.x,o[4]=_y.x,o[8]=_z.x,o[1]=_x.y,o[5]=_y.y,o[9]=_z.y,o[2]=_x.z,o[6]=_y.z,o[10]=_z.z,this}multiply(t,i){return i!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,o=i.elements,l=this.elements,d=r[0],n=r[4],S=r[8],C=r[12],I=r[1],z=r[5],$=r[9],k=r[13],Y=r[2],ie=r[6],ue=r[10],ne=r[14],se=r[3],le=r[7],he=r[11],me=r[15],ge=o[0],xt=o[4],Et=o[8],Lt=o[12],Zt=o[1],Ht=o[5],It=o[9],Yt=o[13],ri=o[2],ei=o[6],Ct=o[10],Ut=o[14],Mt=o[3],$t=o[7],jt=o[11],mi=o[15];return l[0]=d*ge+n*Zt+S*ri+C*Mt,l[4]=d*xt+n*Ht+S*ei+C*$t,l[8]=d*Et+n*It+S*Ct+C*jt,l[12]=d*Lt+n*Yt+S*Ut+C*mi,l[1]=I*ge+z*Zt+$*ri+k*Mt,l[5]=I*xt+z*Ht+$*ei+k*$t,l[9]=I*Et+z*It+$*Ct+k*jt,l[13]=I*Lt+z*Yt+$*Ut+k*mi,l[2]=Y*ge+ie*Zt+ue*ri+ne*Mt,l[6]=Y*xt+ie*Ht+ue*ei+ne*$t,l[10]=Y*Et+ie*It+ue*Ct+ne*jt,l[14]=Y*Lt+ie*Yt+ue*Ut+ne*mi,l[3]=se*ge+le*Zt+he*ri+me*Mt,l[7]=se*xt+le*Ht+he*ei+me*$t,l[11]=se*Et+le*It+he*Ct+me*jt,l[15]=se*Lt+le*Yt+he*Ut+me*mi,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],o=t[8],l=t[12],d=t[1],n=t[5],S=t[9],C=t[13],I=t[2],z=t[6],$=t[10],k=t[14],Y=t[3],ie=t[7],ue=t[11],ne=t[15];return Y*(+l*S*z-o*C*z-l*n*$+r*C*$+o*n*k-r*S*k)+ie*(+i*S*k-i*C*$+l*d*$-o*d*k+o*C*I-l*S*I)+ue*(+i*C*z-i*n*k-l*d*z+r*d*k+l*n*I-r*C*I)+ne*(-o*n*I-i*S*z+i*n*$+o*d*z-r*d*$+r*S*I)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const o=this.elements;return t.isVector3?(o[12]=t.x,o[13]=t.y,o[14]=t.z):(o[12]=t,o[13]=i,o[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],o=t[2],l=t[3],d=t[4],n=t[5],S=t[6],C=t[7],I=t[8],z=t[9],$=t[10],k=t[11],Y=t[12],ie=t[13],ue=t[14],ne=t[15],se=z*ue*C-ie*$*C+ie*S*k-n*ue*k-z*S*ne+n*$*ne,le=Y*$*C-I*ue*C-Y*S*k+d*ue*k+I*S*ne-d*$*ne,he=I*ie*C-Y*z*C+Y*n*k-d*ie*k-I*n*ne+d*z*ne,me=Y*z*S-I*ie*S-Y*n*$+d*ie*$+I*n*ue-d*z*ue,ge=i*se+r*le+o*he+l*me;if(ge===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const xt=1/ge;return t[0]=se*xt,t[1]=(ie*$*l-z*ue*l-ie*o*k+r*ue*k+z*o*ne-r*$*ne)*xt,t[2]=(n*ue*l-ie*S*l+ie*o*C-r*ue*C-n*o*ne+r*S*ne)*xt,t[3]=(z*S*l-n*$*l-z*o*C+r*$*C+n*o*k-r*S*k)*xt,t[4]=le*xt,t[5]=(I*ue*l-Y*$*l+Y*o*k-i*ue*k-I*o*ne+i*$*ne)*xt,t[6]=(Y*S*l-d*ue*l-Y*o*C+i*ue*C+d*o*ne-i*S*ne)*xt,t[7]=(d*$*l-I*S*l+I*o*C-i*$*C-d*o*k+i*S*k)*xt,t[8]=he*xt,t[9]=(Y*z*l-I*ie*l-Y*r*k+i*ie*k+I*r*ne-i*z*ne)*xt,t[10]=(d*ie*l-Y*n*l+Y*r*C-i*ie*C-d*r*ne+i*n*ne)*xt,t[11]=(I*n*l-d*z*l-I*r*C+i*z*C+d*r*k-i*n*k)*xt,t[12]=me*xt,t[13]=(I*ie*o-Y*z*o+Y*r*$-i*ie*$-I*r*ue+i*z*ue)*xt,t[14]=(Y*n*o-d*ie*o-Y*r*S+i*ie*S+d*r*ue-i*n*ue)*xt,t[15]=(d*z*o-I*n*o+I*r*S-i*z*S-d*r*$+i*n*$)*xt,this}scale(t){const i=this.elements,r=t.x,o=t.y,l=t.z;return i[0]*=r,i[4]*=o,i[8]*=l,i[1]*=r,i[5]*=o,i[9]*=l,i[2]*=r,i[6]*=o,i[10]*=l,i[3]*=r,i[7]*=o,i[11]*=l,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],o=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,o))}makeTranslation(t,i,r){return this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),o=Math.sin(i),l=1-r,d=t.x,n=t.y,S=t.z,C=l*d,I=l*n;return this.set(C*d+r,C*n-o*S,C*S+o*n,0,C*n+o*S,I*n+r,I*S-o*d,0,C*S-o*n,I*S+o*d,l*S*S+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r){return this.set(1,i,r,0,t,1,r,0,t,i,1,0,0,0,0,1),this}compose(t,i,r){const o=this.elements,l=i._x,d=i._y,n=i._z,S=i._w,C=l+l,I=d+d,z=n+n,$=l*C,k=l*I,Y=l*z,ie=d*I,ue=d*z,ne=n*z,se=S*C,le=S*I,he=S*z,me=r.x,ge=r.y,xt=r.z;return o[0]=(1-(ie+ne))*me,o[1]=(k+he)*me,o[2]=(Y-le)*me,o[3]=0,o[4]=(k-he)*ge,o[5]=(1-($+ne))*ge,o[6]=(ue+se)*ge,o[7]=0,o[8]=(Y+le)*xt,o[9]=(ue-se)*xt,o[10]=(1-($+ie))*xt,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this}decompose(t,i,r){const o=this.elements;let l=_v1$1.set(o[0],o[1],o[2]).length();const d=_v1$1.set(o[4],o[5],o[6]).length(),n=_v1$1.set(o[8],o[9],o[10]).length();this.determinant()<0&&(l=-l),t.x=o[12],t.y=o[13],t.z=o[14],_m1.copy(this);const C=1/l,I=1/d,z=1/n;return _m1.elements[0]*=C,_m1.elements[1]*=C,_m1.elements[2]*=C,_m1.elements[4]*=I,_m1.elements[5]*=I,_m1.elements[6]*=I,_m1.elements[8]*=z,_m1.elements[9]*=z,_m1.elements[10]*=z,i.setFromRotationMatrix(_m1),r.x=l,r.y=d,r.z=n,this}makePerspective(t,i,r,o,l,d){d===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const n=this.elements,S=2*l/(i-t),C=2*l/(r-o),I=(i+t)/(i-t),z=(r+o)/(r-o),$=-(d+l)/(d-l),k=-2*d*l/(d-l);return n[0]=S,n[4]=0,n[8]=I,n[12]=0,n[1]=0,n[5]=C,n[9]=z,n[13]=0,n[2]=0,n[6]=0,n[10]=$,n[14]=k,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(t,i,r,o,l,d){const n=this.elements,S=1/(i-t),C=1/(r-o),I=1/(d-l),z=(i+t)*S,$=(r+o)*C,k=(d+l)*I;return n[0]=2*S,n[4]=0,n[8]=0,n[12]=-z,n[1]=0,n[5]=2*C,n[9]=0,n[13]=-$,n[2]=0,n[6]=0,n[10]=-2*I,n[14]=-k,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let o=0;o<16;o++)if(i[o]!==r[o])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const _v1$1=new Vector3,_m1=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3;class Euler{constructor(t=0,i=0,r=0,o=Euler.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=i,this._z=r,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,o){return this._x=t,this._y=i,this._z=r,this._order=o||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i,r){const o=MathUtils.clamp,l=t.elements,d=l[0],n=l[4],S=l[8],C=l[1],I=l[5],z=l[9],$=l[2],k=l[6],Y=l[10];switch(i=i||this._order,i){case"XYZ":this._y=Math.asin(o(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(-z,Y),this._z=Math.atan2(-n,d)):(this._x=Math.atan2(k,I),this._z=0);break;case"YXZ":this._x=Math.asin(-o(z,-1,1)),Math.abs(z)<.9999999?(this._y=Math.atan2(S,Y),this._z=Math.atan2(C,I)):(this._y=Math.atan2(-$,d),this._z=0);break;case"ZXY":this._x=Math.asin(o(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(-$,Y),this._z=Math.atan2(-n,I)):(this._y=0,this._z=Math.atan2(C,d));break;case"ZYX":this._y=Math.asin(-o($,-1,1)),Math.abs($)<.9999999?(this._x=Math.atan2(k,Y),this._z=Math.atan2(C,d)):(this._x=0,this._z=Math.atan2(-n,I));break;case"YZX":this._z=Math.asin(o(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-z,I),this._y=Math.atan2(-$,d)):(this._x=0,this._y=Math.atan2(S,Y));break;case"XZY":this._z=Math.asin(-o(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(k,I),this._y=Math.atan2(S,d)):(this._x=Math.atan2(-z,Y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r!==!1&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return _matrix.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix,i,r)}setFromVector3(t,i){return this.set(t.x,t.y,t.z,i||this._order)}reorder(t){return _quaternion$1.setFromEuler(this),this.setFromQuaternion(_quaternion$1,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Euler.DefaultOrder="XYZ";Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const _matrix=new Matrix4,_quaternion$1=new Quaternion;class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}}let _object3DId=0;const _v1$2=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position=new Vector3,_scale=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const e=new Vector3,t=new Euler,i=new Quaternion,r=new Vector3(1,1,1);function o(){i.setFromEuler(t,!1)}function l(){t.setFromQuaternion(i,void 0,!1)}t._onChange(o),i._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0);Object3D.DefaultMatrixAutoUpdate=!0;Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this},rotateX:function(e){return this.rotateOnAxis(_xAxis,e)},rotateY:function(e){return this.rotateOnAxis(_yAxis,e)},rotateZ:function(e){return this.rotateOnAxis(_zAxis,e)},translateOnAxis:function(e,t){return _v1$2.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$2.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(_xAxis,e)},translateY:function(e){return this.translateOnAxis(_yAxis,e)},translateZ:function(e){return this.translateOnAxis(_zAxis,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())},lookAt:function(e,t,i){e.isVector3?_target.copy(e):_target.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position,_target,this.up):_m1$1.lookAt(_target,_position,this.up),this.quaternion.setFromRotationMatrix(_m1$1),r&&(_m1$1.extractRotation(r.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))},add:function(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(_removedEvent)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const l=this.children[i].getObjectByProperty(e,t);if(l!==void 0)return l}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position,e,_scale),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position,_quaternion$2,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let o=0,l=r.length;o<l;o++)r[o].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON());function o(d,n){return d[n.uuid]===void 0&&(d[n.uuid]=n.toJSON(e)),n.uuid}if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const d=this.geometry.parameters;if(d!==void 0&&d.shapes!==void 0){const n=d.shapes;if(Array.isArray(n))for(let S=0,C=n.length;S<C;S++){const I=n[S];o(e.shapes,I)}else o(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const d=[];for(let n=0,S=this.material.length;n<S;n++)d.push(o(e.materials,this.material[n]));r.material=d}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let d=0;d<this.animations.length;d++){const n=this.animations[d];r.animations.push(o(e.animations,n))}}if(t){const d=l(e.geometries),n=l(e.materials),S=l(e.textures),C=l(e.images),I=l(e.shapes),z=l(e.skeletons),$=l(e.animations);d.length>0&&(i.geometries=d),n.length>0&&(i.materials=n),S.length>0&&(i.textures=S),C.length>0&&(i.images=C),I.length>0&&(i.shapes=I),z.length>0&&(i.skeletons=z),$.length>0&&(i.animations=$)}return i.object=r,i;function l(d){const n=[];for(const S in d){const C=d[S];delete C.metadata,n.push(C)}return n}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}});const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(t,i){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=t!==void 0?t:new Vector3(1,0,0),this.constant=i!==void 0?i:0}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,o){return this.normal.set(t,i,r),this.constant=o,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const o=_vector1.subVectors(r,i).cross(_vector2.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,t),this}clone(){return new this.constructor().copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),i=new Vector3),i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,i){i===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new Vector3);const r=t.delta(_vector1),o=this.normal.dot(r);if(o===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):void 0;const l=-(t.start.dot(this.normal)+this.constant)/o;if(!(l<0||l>1))return i.copy(r).multiplyScalar(l).add(t.start)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||_normalMatrix.getNormalMatrix(t),o=this.coplanarPoint(_vector1).applyMatrix4(t),l=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(l),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const _v0$1=new Vector3,_v1$3=new Vector3,_v2$1=new Vector3,_v3=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;class Triangle{constructor(t,i,r){this.a=t!==void 0?t:new Vector3,this.b=i!==void 0?i:new Vector3,this.c=r!==void 0?r:new Vector3}static getNormal(t,i,r,o){o===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),o=new Vector3),o.subVectors(r,i),_v0$1.subVectors(t,i),o.cross(_v0$1);const l=o.lengthSq();return l>0?o.multiplyScalar(1/Math.sqrt(l)):o.set(0,0,0)}static getBarycoord(t,i,r,o,l){_v0$1.subVectors(o,i),_v1$3.subVectors(r,i),_v2$1.subVectors(t,i);const d=_v0$1.dot(_v0$1),n=_v0$1.dot(_v1$3),S=_v0$1.dot(_v2$1),C=_v1$3.dot(_v1$3),I=_v1$3.dot(_v2$1),z=d*C-n*n;if(l===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new Vector3),z===0)return l.set(-2,-1,-1);const $=1/z,k=(C*S-n*I)*$,Y=(d*I-n*S)*$;return l.set(1-k-Y,Y,k)}static containsPoint(t,i,r,o){return this.getBarycoord(t,i,r,o,_v3),_v3.x>=0&&_v3.y>=0&&_v3.x+_v3.y<=1}static getUV(t,i,r,o,l,d,n,S){return this.getBarycoord(t,i,r,o,_v3),S.set(0,0),S.addScaledVector(l,_v3.x),S.addScaledVector(d,_v3.y),S.addScaledVector(n,_v3.z),S}static isFrontFacing(t,i,r,o){return _v0$1.subVectors(r,i),_v1$3.subVectors(t,i),_v0$1.cross(_v1$3).dot(o)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,o){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[o]),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Vector3),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Plane),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return Triangle.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,r,o,l){return Triangle.getUV(t,this.a,this.b,this.c,i,r,o,l)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){i===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),i=new Vector3);const r=this.a,o=this.b,l=this.c;let d,n;_vab.subVectors(o,r),_vac.subVectors(l,r),_vap.subVectors(t,r);const S=_vab.dot(_vap),C=_vac.dot(_vap);if(S<=0&&C<=0)return i.copy(r);_vbp.subVectors(t,o);const I=_vab.dot(_vbp),z=_vac.dot(_vbp);if(I>=0&&z<=I)return i.copy(o);const $=S*z-I*C;if($<=0&&S>=0&&I<=0)return d=S/(S-I),i.copy(r).addScaledVector(_vab,d);_vcp.subVectors(t,l);const k=_vab.dot(_vcp),Y=_vac.dot(_vcp);if(Y>=0&&k<=Y)return i.copy(l);const ie=k*C-S*Y;if(ie<=0&&C>=0&&Y<=0)return n=C/(C-Y),i.copy(r).addScaledVector(_vac,n);const ue=I*Y-k*z;if(ue<=0&&z-I>=0&&k-Y>=0)return _vbc.subVectors(l,o),n=(z-I)/(z-I+(k-Y)),i.copy(o).addScaledVector(_vbc,n);const ne=1/(ue+ie+$);return d=ie*ne,n=$*ne,i.copy(r).addScaledVector(_vab,d).addScaledVector(_vac,n)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function SRGBToLinear(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}class Color{constructor(t,i,r){return Object.defineProperty(this,"isColor",{value:!0}),i===void 0&&r===void 0?this.set(t):this.setRGB(t,i,r)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this}setRGB(t,i,r){return this.r=t,this.g=i,this.b=r,this}setHSL(t,i,r){if(t=MathUtils.euclideanModulo(t,1),i=MathUtils.clamp(i,0,1),r=MathUtils.clamp(r,0,1),i===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+i):r+i-r*i,l=2*r-o;this.r=hue2rgb(l,o,t+1/3),this.g=hue2rgb(l,o,t),this.b=hue2rgb(l,o,t-1/3)}return this}setStyle(t){function i(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let o;const l=r[1],d=r[2];switch(l){case"rgb":case"rgba":if(o=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,i(o[4]),this;if(o=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,i(o[4]),this;break;case"hsl":case"hsla":if(o=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d)){const n=parseFloat(o[1])/360,S=parseInt(o[2],10)/100,C=parseInt(o[3],10)/100;return i(o[4]),this.setHSL(n,S,C)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const o=r[1],l=o.length;if(l===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,this;if(l===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const i=_colorKeywords[t];return i!==void 0?this.setHex(i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,i=2){return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}copyLinearToGamma(t,i=2){const r=i>0?1/i:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const i=this.r,r=this.g,o=this.b,l=Math.max(i,r,o),d=Math.min(i,r,o);let n,S;const C=(d+l)/2;if(d===l)n=0,S=0;else{const I=l-d;switch(S=C<=.5?I/(l+d):I/(2-l-d),l){case i:n=(r-o)/I+(r<o?6:0);break;case r:n=(o-i)/I+2;break;case o:n=(i-r)/I+4;break}n/=6}return t.h=n,t.s=S,t.l=C,t}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(t,i,r){return this.getHSL(_hslA),_hslA.h+=t,_hslA.s+=i,_hslA.l+=r,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpHSL(t,i){this.getHSL(_hslA),t.getHSL(_hslB);const r=MathUtils.lerp(_hslA.h,_hslB.h,i),o=MathUtils.lerp(_hslA.s,_hslB.s,i),l=MathUtils.lerp(_hslA.l,_hslB.l,i);return this.setHSL(r,o,l),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=_colorKeywords;Color.prototype.r=1;Color.prototype.g=1;Color.prototype.b=1;class Face3{constructor(t,i,r,o,l,d=0){this.a=t,this.b=i,this.c=r,this.normal=o&&o.isVector3?o:new Vector3,this.vertexNormals=Array.isArray(o)?o:[],this.color=l&&l.isColor?l:new Color,this.vertexColors=Array.isArray(l)?l:[],this.materialIndex=d}clone(){return new this.constructor().copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let i=0,r=t.vertexNormals.length;i<r;i++)this.vertexNormals[i]=t.vertexNormals[i].clone();for(let i=0,r=t.vertexColors.length;i<r;i++)this.vertexColors[i]=t.vertexColors[i].clone();return this}}let materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===FlatShading;continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}},toJSON:function(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,this.combine!==void 0&&(i.combine=this.combine),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(i.size=this.size),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(i.blending=this.blending),this.flatShading===!0&&(i.flatShading=this.flatShading),this.side!==FrontSide&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(i.morphTargets=!0),this.morphNormals===!0&&(i.morphNormals=!0),this.skinning===!0&&(i.skinning=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function r(o){const l=[];for(const d in o){const n=o[d];delete n.metadata,l.push(n)}return l}if(t){const o=r(e.textures),l=r(e.images);o.length>0&&(i.textures=o),l.length>0&&(i.images=l)}return i},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(Material.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}MeshBasicMaterial.prototype=Object.create(Material.prototype);MeshBasicMaterial.prototype.constructor=MeshBasicMaterial;MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const _vector$3=new Vector3,_vector2$1=new Vector2;function BufferAttribute(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];l===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),l=new Color),t[i++]=l.r,t[i++]=l.g,t[i++]=l.b}return this},copyVector2sArray:function(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];l===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),l=new Vector2),t[i++]=l.x,t[i++]=l.y}return this},copyVector3sArray:function(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];l===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),l=new Vector3),t[i++]=l.x,t[i++]=l.y,t[i++]=l.z}return this},copyVector4sArray:function(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];l===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),l=new Vector4),t[i++]=l.x,t[i++]=l.y,t[i++]=l.z,t[i++]=l.w}return this},applyMatrix3:function(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)_vector2$1.fromBufferAttribute(this,t),_vector2$1.applyMatrix3(e),this.setXY(t,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)_vector$3.fromBufferAttribute(this,t),_vector$3.applyMatrix3(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyMatrix4:function(e){for(let t=0,i=this.count;t<i;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyMatrix4(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyNormalMatrix:function(e){for(let t=0,i=this.count;t<i;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyNormalMatrix(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},transformDirection:function(e){for(let t=0,i=this.count;t<i;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.transformDirection(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function Int8BufferAttribute(e,t,i){BufferAttribute.call(this,new Int8Array(e),t,i)}Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int8BufferAttribute.prototype.constructor=Int8BufferAttribute;function Uint8BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8Array(e),t,i)}Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute;function Uint8ClampedBufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8ClampedArray(e),t,i)}Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute;function Int16BufferAttribute(e,t,i){BufferAttribute.call(this,new Int16Array(e),t,i)}Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int16BufferAttribute.prototype.constructor=Int16BufferAttribute;function Uint16BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint16Array(e),t,i)}Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute;function Int32BufferAttribute(e,t,i){BufferAttribute.call(this,new Int32Array(e),t,i)}Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int32BufferAttribute.prototype.constructor=Int32BufferAttribute;function Uint32BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint32Array(e),t,i)}Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute;function Float16BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint16Array(e),t,i)}Float16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float16BufferAttribute.prototype.constructor=Float16BufferAttribute;Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;function Float32BufferAttribute(e,t,i){BufferAttribute.call(this,new Float32Array(e),t,i)}Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float32BufferAttribute.prototype.constructor=Float32BufferAttribute;function Float64BufferAttribute(e,t,i){BufferAttribute.call(this,new Float64Array(e),t,i)}Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;class DirectGeometry{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const i=[];let r,o,l;const d=t.faces;for(o=0;o<d.length;o++){const n=d[o];n.materialIndex!==l&&(l=n.materialIndex,r!==void 0&&(r.count=o*3-r.start,i.push(r)),r={start:o*3,materialIndex:l})}r!==void 0&&(r.count=o*3-r.start,i.push(r)),this.groups=i}fromGeometry(t){const i=t.faces,r=t.vertices,o=t.faceVertexUvs,l=o[0]&&o[0].length>0,d=o[1]&&o[1].length>0,n=t.morphTargets,S=n.length;let C;if(S>0){C=[];for(let ne=0;ne<S;ne++)C[ne]={name:n[ne].name,data:[]};this.morphTargets.position=C}const I=t.morphNormals,z=I.length;let $;if(z>0){$=[];for(let ne=0;ne<z;ne++)$[ne]={name:I[ne].name,data:[]};this.morphTargets.normal=$}const k=t.skinIndices,Y=t.skinWeights,ie=k.length===r.length,ue=Y.length===r.length;r.length>0&&i.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let ne=0;ne<i.length;ne++){const se=i[ne];this.vertices.push(r[se.a],r[se.b],r[se.c]);const le=se.vertexNormals;if(le.length===3)this.normals.push(le[0],le[1],le[2]);else{const me=se.normal;this.normals.push(me,me,me)}const he=se.vertexColors;if(he.length===3)this.colors.push(he[0],he[1],he[2]);else{const me=se.color;this.colors.push(me,me,me)}if(l===!0){const me=o[0][ne];me!==void 0?this.uvs.push(me[0],me[1],me[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",ne),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(d===!0){const me=o[1][ne];me!==void 0?this.uvs2.push(me[0],me[1],me[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",ne),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(let me=0;me<S;me++){const ge=n[me].vertices;C[me].data.push(ge[se.a],ge[se.b],ge[se.c])}for(let me=0;me<z;me++){const ge=I[me].vertexNormals[ne];$[me].data.push(ge.a,ge.b,ge.c)}ie&&this.skinIndices.push(k[se.a],k[se.b],k[se.c]),ue&&this.skinWeights.push(Y[se.a],Y[se.b],Y[se.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}}function arrayMax(e){if(e.length===0)return-1/0;let t=e[0];for(let i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(e,t){return new TYPED_ARRAYS[e](t)}let _bufferGeometryId=1;const _m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$4=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return this.attributes[e]!==void 0},addGroup:function(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const o=new Matrix3().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return _m1$2.makeRotationX(e),this.applyMatrix4(_m1$2),this},rotateY:function(e){return _m1$2.makeRotationY(e),this.applyMatrix4(_m1$2),this},rotateZ:function(e){return _m1$2.makeRotationZ(e),this.applyMatrix4(_m1$2),this},translate:function(e,t,i){return _m1$2.makeTranslation(e,t,i),this.applyMatrix4(_m1$2),this},scale:function(e,t,i){return _m1$2.makeScale(e,t,i),this.applyMatrix4(_m1$2),this},lookAt:function(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const i=new Float32BufferAttribute(t.vertices.length*3,3),r=new Float32BufferAttribute(t.colors.length*3,3);if(this.setAttribute("position",i.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const o=new Float32BufferAttribute(t.lineDistances.length,1);this.setAttribute("lineDistance",o.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let i=t.__directGeometry;if(t.elementsNeedUpdate===!0&&(i=void 0,t.elementsNeedUpdate=!1),i===void 0)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}if(t.verticesNeedUpdate===!0){const i=this.attributes.position;i!==void 0&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){const i=this.attributes.normal;i!==void 0&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){const i=this.attributes.color;i!==void 0&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const i=this.attributes.uv;i!==void 0&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const i=this.attributes.lineDistance;i!==void 0&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new DirectGeometry().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(e.vertices.length*3);if(this.setAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const i=new Float32Array(e.normals.length*3);this.setAttribute("normal",new BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const i=new Float32Array(e.colors.length*3);this.setAttribute("color",new BufferAttribute(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const i=new Float32Array(e.uvs.length*2);this.setAttribute("uv",new BufferAttribute(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const i=new Float32Array(e.uvs2.length*2);this.setAttribute("uv2",new BufferAttribute(i,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const i in e.morphTargets){const r=[],o=e.morphTargets[i];for(let l=0,d=o.length;l<d;l++){const n=o[l],S=new Float32BufferAttribute(n.data.length*3,3);S.name=n.name,r.push(S.copyVector3sArray(n.data))}this.morphAttributes[i]=r}if(e.skinIndices.length>0){const i=new Float32BufferAttribute(e.skinIndices.length*4,4);this.setAttribute("skinIndex",i.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const i=new Float32BufferAttribute(e.skinWeights.length*4,4);this.setAttribute("skinWeight",i.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const o=t[i];_box$2.setFromBufferAttribute(o),this.morphTargetsRelative?(_vector$4.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$4),_vector$4.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$4)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(e){const i=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),t)for(let o=0,l=t.length;o<l;o++){const d=t[o];_boxMorphTargets.setFromBufferAttribute(d),this.morphTargetsRelative?(_vector$4.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$4),_vector$4.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$4)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(i);let r=0;for(let o=0,l=e.count;o<l;o++)_vector$4.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(_vector$4));if(t)for(let o=0,l=t.length;o<l;o++){const d=t[o],n=this.morphTargetsRelative;for(let S=0,C=d.count;S<C;S++)_vector$4.fromBufferAttribute(d,S),n&&(_offset.fromBufferAttribute(e,S),_vector$4.add(_offset)),r=Math.max(r,i.distanceToSquared(_vector$4))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new BufferAttribute(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let z=0,$=i.count;z<$;z++)i.setXYZ(z,0,0,0);const r=new Vector3,o=new Vector3,l=new Vector3,d=new Vector3,n=new Vector3,S=new Vector3,C=new Vector3,I=new Vector3;if(e)for(let z=0,$=e.count;z<$;z+=3){const k=e.getX(z+0),Y=e.getX(z+1),ie=e.getX(z+2);r.fromBufferAttribute(t,k),o.fromBufferAttribute(t,Y),l.fromBufferAttribute(t,ie),C.subVectors(l,o),I.subVectors(r,o),C.cross(I),d.fromBufferAttribute(i,k),n.fromBufferAttribute(i,Y),S.fromBufferAttribute(i,ie),d.add(C),n.add(C),S.add(C),i.setXYZ(k,d.x,d.y,d.z),i.setXYZ(Y,n.x,n.y,n.z),i.setXYZ(ie,S.x,S.y,S.z)}else for(let z=0,$=t.count;z<$;z+=3)r.fromBufferAttribute(t,z+0),o.fromBufferAttribute(t,z+1),l.fromBufferAttribute(t,z+2),C.subVectors(l,o),I.subVectors(r,o),C.cross(I),i.setXYZ(z+0,C.x,C.y,C.z),i.setXYZ(z+1,C.x,C.y,C.z),i.setXYZ(z+2,C.x,C.y,C.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const r in i){if(e.attributes[r]===void 0)continue;const l=i[r].array,d=e.attributes[r],n=d.array,S=d.itemSize*t,C=Math.min(n.length,l.length-S);for(let I=0,z=S;I<C;I++,z++)l[z]=n[I]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)_vector$4.fromBufferAttribute(e,t),_vector$4.normalize(),e.setXYZ(t,_vector$4.x,_vector$4.y,_vector$4.z)},toNonIndexed:function(){function e(d,n){const S=d.array,C=d.itemSize,I=d.normalized,z=new S.constructor(n.length*C);let $=0,k=0;for(let Y=0,ie=n.length;Y<ie;Y++){$=n[Y]*C;for(let ue=0;ue<C;ue++)z[k++]=S[$++]}return new BufferAttribute(z,C,I)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new BufferGeometry,i=this.index.array,r=this.attributes;for(const d in r){const n=r[d],S=e(n,i);t.setAttribute(d,S)}const o=this.morphAttributes;for(const d in o){const n=[],S=o[d];for(let C=0,I=S.length;C<I;C++){const z=S[C],$=e(z,i);n.push($)}t.morphAttributes[d]=n}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let d=0,n=l.length;d<n;d++){const S=l[d];t.addGroup(S.start,S.count,S.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const n=this.parameters;for(const S in n)n[S]!==void 0&&(e[S]=n[S]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const n in i){const S=i[n],C=S.toJSON(e.data);S.name!==""&&(C.name=S.name),e.data.attributes[n]=C}const r={};let o=!1;for(const n in this.morphAttributes){const S=this.morphAttributes[n],C=[];for(let I=0,z=S.length;I<z;I++){const $=S[I],k=$.toJSON(e.data);$.name!==""&&(k.name=$.name),C.push(k)}C.length>0&&(r[n]=C,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const d=this.boundingSphere;return d!==null&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e},clone:function(){return new BufferGeometry().copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const S in r){const C=r[S];this.setAttribute(S,C.clone(t))}const o=e.morphAttributes;for(const S in o){const C=[],I=o[S];for(let z=0,$=I.length;z<$;z++)C.push(I[z].clone(t));this.morphAttributes[S]=C}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let S=0,C=l.length;S<C;S++){const I=l[S];this.addGroup(I.start,I.count,I.materialIndex)}const d=e.boundingBox;d!==null&&(this.boundingBox=d.clone());const n=e.boundingSphere;return n!==null&&(this.boundingSphere=n.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;function Mesh(e=new BufferGeometry,t=new MeshBasicMaterial){Object3D.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=r.length;o<l;o++){const d=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const i=this.geometry,r=this.material,o=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),_sphere.copy(i.boundingSphere),_sphere.applyMatrix4(o),e.ray.intersectsSphere(_sphere)===!1)||(_inverseMatrix.copy(o).invert(),_ray.copy(e.ray).applyMatrix4(_inverseMatrix),i.boundingBox!==null&&_ray.intersectsBox(i.boundingBox)===!1))return;let l;if(i.isBufferGeometry){const d=i.index,n=i.attributes.position,S=i.morphAttributes.position,C=i.morphTargetsRelative,I=i.attributes.uv,z=i.attributes.uv2,$=i.groups,k=i.drawRange;if(d!==null)if(Array.isArray(r))for(let Y=0,ie=$.length;Y<ie;Y++){const ue=$[Y],ne=r[ue.materialIndex],se=Math.max(ue.start,k.start),le=Math.min(ue.start+ue.count,k.start+k.count);for(let he=se,me=le;he<me;he+=3){const ge=d.getX(he),xt=d.getX(he+1),Et=d.getX(he+2);l=checkBufferGeometryIntersection(this,ne,e,_ray,n,S,C,I,z,ge,xt,Et),l&&(l.faceIndex=Math.floor(he/3),l.face.materialIndex=ue.materialIndex,t.push(l))}}else{const Y=Math.max(0,k.start),ie=Math.min(d.count,k.start+k.count);for(let ue=Y,ne=ie;ue<ne;ue+=3){const se=d.getX(ue),le=d.getX(ue+1),he=d.getX(ue+2);l=checkBufferGeometryIntersection(this,r,e,_ray,n,S,C,I,z,se,le,he),l&&(l.faceIndex=Math.floor(ue/3),t.push(l))}}else if(n!==void 0)if(Array.isArray(r))for(let Y=0,ie=$.length;Y<ie;Y++){const ue=$[Y],ne=r[ue.materialIndex],se=Math.max(ue.start,k.start),le=Math.min(ue.start+ue.count,k.start+k.count);for(let he=se,me=le;he<me;he+=3){const ge=he,xt=he+1,Et=he+2;l=checkBufferGeometryIntersection(this,ne,e,_ray,n,S,C,I,z,ge,xt,Et),l&&(l.faceIndex=Math.floor(he/3),l.face.materialIndex=ue.materialIndex,t.push(l))}}else{const Y=Math.max(0,k.start),ie=Math.min(n.count,k.start+k.count);for(let ue=Y,ne=ie;ue<ne;ue+=3){const se=ue,le=ue+1,he=ue+2;l=checkBufferGeometryIntersection(this,r,e,_ray,n,S,C,I,z,se,le,he),l&&(l.faceIndex=Math.floor(ue/3),t.push(l))}}}else if(i.isGeometry){const d=Array.isArray(r),n=i.vertices,S=i.faces;let C;const I=i.faceVertexUvs[0];I.length>0&&(C=I);for(let z=0,$=S.length;z<$;z++){const k=S[z],Y=d?r[k.materialIndex]:r;if(Y===void 0)continue;const ie=n[k.a],ue=n[k.b],ne=n[k.c];if(l=checkIntersection(this,Y,e,_ray,ie,ue,ne,_intersectionPoint),l){if(C&&C[z]){const se=C[z];_uvA.copy(se[0]),_uvB.copy(se[1]),_uvC.copy(se[2]),l.uv=Triangle.getUV(_intersectionPoint,ie,ue,ne,_uvA,_uvB,_uvC,new Vector2)}l.face=k,l.faceIndex=z,t.push(l)}}}}});function checkIntersection(e,t,i,r,o,l,d,n){let S;if(t.side===BackSide?S=r.intersectTriangle(d,l,o,!0,n):S=r.intersectTriangle(o,l,d,t.side!==DoubleSide,n),S===null)return null;_intersectionPointWorld.copy(n),_intersectionPointWorld.applyMatrix4(e.matrixWorld);const C=i.ray.origin.distanceTo(_intersectionPointWorld);return C<i.near||C>i.far?null:{distance:C,point:_intersectionPointWorld.clone(),object:e}}function checkBufferGeometryIntersection(e,t,i,r,o,l,d,n,S,C,I,z){_vA.fromBufferAttribute(o,C),_vB.fromBufferAttribute(o,I),_vC.fromBufferAttribute(o,z);const $=e.morphTargetInfluences;if(t.morphTargets&&l&&$){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(let Y=0,ie=l.length;Y<ie;Y++){const ue=$[Y],ne=l[Y];ue!==0&&(_tempA.fromBufferAttribute(ne,C),_tempB.fromBufferAttribute(ne,I),_tempC.fromBufferAttribute(ne,z),d?(_morphA.addScaledVector(_tempA,ue),_morphB.addScaledVector(_tempB,ue),_morphC.addScaledVector(_tempC,ue)):(_morphA.addScaledVector(_tempA.sub(_vA),ue),_morphB.addScaledVector(_tempB.sub(_vB),ue),_morphC.addScaledVector(_tempC.sub(_vC),ue)))}_vA.add(_morphA),_vB.add(_morphB),_vC.add(_morphC)}e.isSkinnedMesh&&(e.boneTransform(C,_vA),e.boneTransform(I,_vB),e.boneTransform(z,_vC));const k=checkIntersection(e,t,i,r,_vA,_vB,_vC,_intersectionPoint);if(k){n&&(_uvA.fromBufferAttribute(n,C),_uvB.fromBufferAttribute(n,I),_uvC.fromBufferAttribute(n,z),k.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),S&&(_uvA.fromBufferAttribute(S,C),_uvB.fromBufferAttribute(S,I),_uvC.fromBufferAttribute(S,z),k.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2));const Y=new Face3(C,I,z);Triangle.getNormal(_vA,_vB,_vC,Y.normal),k.face=Y}return k}class BoxBufferGeometry extends BufferGeometry{constructor(t=1,i=1,r=1,o=1,l=1,d=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:o,heightSegments:l,depthSegments:d};const n=this;o=Math.floor(o),l=Math.floor(l),d=Math.floor(d);const S=[],C=[],I=[],z=[];let $=0,k=0;Y("z","y","x",-1,-1,r,i,t,d,l,0),Y("z","y","x",1,-1,r,i,-t,d,l,1),Y("x","z","y",1,1,t,r,i,o,d,2),Y("x","z","y",1,-1,t,r,-i,o,d,3),Y("x","y","z",1,-1,t,i,r,o,l,4),Y("x","y","z",-1,-1,t,i,-r,o,l,5),this.setIndex(S),this.setAttribute("position",new Float32BufferAttribute(C,3)),this.setAttribute("normal",new Float32BufferAttribute(I,3)),this.setAttribute("uv",new Float32BufferAttribute(z,2));function Y(ie,ue,ne,se,le,he,me,ge,xt,Et,Lt){const Zt=he/xt,Ht=me/Et,It=he/2,Yt=me/2,ri=ge/2,ei=xt+1,Ct=Et+1;let Ut=0,Mt=0;const $t=new Vector3;for(let jt=0;jt<Ct;jt++){const mi=jt*Ht-Yt;for(let Xi=0;Xi<ei;Xi++){const Er=Xi*Zt-It;$t[ie]=Er*se,$t[ue]=mi*le,$t[ne]=ri,C.push($t.x,$t.y,$t.z),$t[ie]=0,$t[ue]=0,$t[ne]=ge>0?1:-1,I.push($t.x,$t.y,$t.z),z.push(Xi/xt),z.push(1-jt/Et),Ut+=1}}for(let jt=0;jt<Et;jt++)for(let mi=0;mi<xt;mi++){const Xi=$+mi+ei*jt,Er=$+mi+ei*(jt+1),Ir=$+(mi+1)+ei*(jt+1),nr=$+(mi+1)+ei*jt;S.push(Xi,Er,nr),S.push(Er,Ir,nr),Mt+=6}n.addGroup(k,Mt,Lt),k+=Mt,$+=Ut}}}function cloneUniforms(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const o=e[i][r];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture)?t[i][r]=o.clone():Array.isArray(o)?t[i][r]=o.slice():t[i][r]=o}}return t}function mergeUniforms(e){const t={};for(let i=0;i<e.length;i++){const r=cloneUniforms(e[i]);for(const o in r)t[o]=r[o]}return t}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}ShaderMaterial.prototype=Object.create(Material.prototype);ShaderMaterial.prototype.constructor=ShaderMaterial;ShaderMaterial.prototype.isShaderMaterial=!0;ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this};ShaderMaterial.prototype.toJSON=function(e){const t=Material.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const l=this.uniforms[r].value;l&&l.isTexture?t.uniforms[r]={type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?t.uniforms[r]={type:"c",value:l.getHex()}:l&&l.isVector2?t.uniforms[r]={type:"v2",value:l.toArray()}:l&&l.isVector3?t.uniforms[r]={type:"v3",value:l.toArray()}:l&&l.isVector4?t.uniforms[r]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?t.uniforms[r]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?t.uniforms[r]={type:"m4",value:l.toArray()}:t.uniforms[r]={value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t};function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Object3D.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}});function PerspectiveCamera(e=50,t=1,i=.1,r=2e3){Camera.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=MathUtils.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(MathUtils.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return MathUtils.RAD2DEG*2*Math.atan(Math.tan(MathUtils.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,o,l){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(MathUtils.DEG2RAD*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,o=-.5*r;const l=this.view;if(this.view!==null&&this.view.enabled){const n=l.fullWidth,S=l.fullHeight;o+=l.offsetX*r/n,t-=l.offsetY*i/S,r*=l.width/n,i*=l.height/S}const d=this.filmOffset;d!==0&&(o+=e*d/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const fov=90,aspect=1;function CubeCamera(e,t,i){if(Object3D.call(this),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const r=new PerspectiveCamera(fov,aspect,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Vector3(1,0,0)),this.add(r);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Vector3(-1,0,0)),this.add(o);const l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,l.up.set(0,0,1),l.lookAt(new Vector3(0,1,0)),this.add(l);const d=new PerspectiveCamera(fov,aspect,e,t);d.layers=this.layers,d.up.set(0,0,-1),d.lookAt(new Vector3(0,-1,0)),this.add(d);const n=new PerspectiveCamera(fov,aspect,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(0,0,1)),this.add(n);const S=new PerspectiveCamera(fov,aspect,e,t);S.layers=this.layers,S.up.set(0,-1,0),S.lookAt(new Vector3(0,0,-1)),this.add(S),this.update=function(C,I){this.parent===null&&this.updateMatrixWorld();const z=C.xr.enabled,$=C.getRenderTarget();C.xr.enabled=!1;const k=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,C.setRenderTarget(i,0),C.render(I,r),C.setRenderTarget(i,1),C.render(I,o),C.setRenderTarget(i,2),C.render(I,l),C.setRenderTarget(i,3),C.render(I,d),C.setRenderTarget(i,4),C.render(I,n),i.texture.generateMipmaps=k,C.setRenderTarget(i,5),C.render(I,S),C.setRenderTarget($),C.xr.enabled=z}}CubeCamera.prototype=Object.create(Object3D.prototype);CubeCamera.prototype.constructor=CubeCamera;function CubeTexture(e,t,i,r,o,l,d,n,S,C){e=e!==void 0?e:[],t=t!==void 0?t:CubeReflectionMapping,d=d!==void 0?d:RGBFormat,Texture.call(this,e,t,i,r,o,l,d,n,S,C),this.flipY=!1,this._needsFlipEnvMap=!0}CubeTexture.prototype=Object.create(Texture.prototype);CubeTexture.prototype.constructor=CubeTexture;CubeTexture.prototype.isCubeTexture=!0;Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});function WebGLCubeRenderTarget(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),WebGLRenderTarget.call(this,e,e,t),t=t||{},this.texture=new CubeTexture(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype);WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget;WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=RGBAFormat,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

			varying vec3 vWorldDirection;

			vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

				return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

			}

			void main() {

				vWorldDirection = transformDirection( position, modelMatrix );

				#include <begin_vertex>
				#include <project_vertex>

			}
		`,fragmentShader:`

			uniform sampler2D tEquirect;

			varying vec3 vWorldDirection;

			#include <common>

			void main() {

				vec3 direction = normalize( vWorldDirection );

				vec2 sampleUV = equirectUv( direction );

				gl_FragColor = texture2D( tEquirect, sampleUV );

			}
		`},r=new BoxBufferGeometry(5,5,5),o=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:BackSide,blending:NoBlending});o.uniforms.tEquirect.value=t;const l=new Mesh(r,o),d=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,l),t.minFilter=d,l.geometry.dispose(),l.material.dispose(),this};WebGLCubeRenderTarget.prototype.clear=function(e,t,i,r){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,i,r);e.setRenderTarget(o)};function DataTexture(e,t,i,r,o,l,d,n,S,C,I,z){Texture.call(this,null,l,d,n,S,C,r,o,I,z),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=S!==void 0?S:NearestFilter,this.minFilter=C!==void 0?C:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}DataTexture.prototype=Object.create(Texture.prototype);DataTexture.prototype.constructor=DataTexture;DataTexture.prototype.isDataTexture=!0;const _sphere$1=new Sphere,_vector$5=new Vector3;class Frustum{constructor(t,i,r,o,l,d){this.planes=[t!==void 0?t:new Plane,i!==void 0?i:new Plane,r!==void 0?r:new Plane,o!==void 0?o:new Plane,l!==void 0?l:new Plane,d!==void 0?d:new Plane]}set(t,i,r,o,l,d){const n=this.planes;return n[0].copy(t),n[1].copy(i),n[2].copy(r),n[3].copy(o),n[4].copy(l),n[5].copy(d),this}clone(){return new this.constructor().copy(this)}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t){const i=this.planes,r=t.elements,o=r[0],l=r[1],d=r[2],n=r[3],S=r[4],C=r[5],I=r[6],z=r[7],$=r[8],k=r[9],Y=r[10],ie=r[11],ue=r[12],ne=r[13],se=r[14],le=r[15];return i[0].setComponents(n-o,z-S,ie-$,le-ue).normalize(),i[1].setComponents(n+o,z+S,ie+$,le+ue).normalize(),i[2].setComponents(n+l,z+C,ie+k,le+ne).normalize(),i[3].setComponents(n-l,z-C,ie-k,le-ne).normalize(),i[4].setComponents(n-d,z-I,ie-Y,le-se).normalize(),i[5].setComponents(n+d,z+I,ie+Y,le+se).normalize(),this}intersectsObject(t){const i=t.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$1.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$1)}intersectsSprite(t){return _sphere$1.center.set(0,0,0),_sphere$1.radius=.7071067811865476,_sphere$1.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$1)}intersectsSphere(t){const i=this.planes,r=t.center,o=-t.radius;for(let l=0;l<6;l++)if(i[l].distanceToPoint(r)<o)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const o=i[r];if(_vector$5.x=o.normal.x>0?t.max.x:t.min.x,_vector$5.y=o.normal.y>0?t.max.y:t.min.y,_vector$5.z=o.normal.z>0?t.max.z:t.min.z,o.distanceToPoint(_vector$5)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}}function WebGLAnimation(){let e=null,t=!1,i=null,r=null;function o(l,d){i(l,d),r=e.requestAnimationFrame(o)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(o),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(l){i=l},setContext:function(l){e=l}}}function WebGLAttributes(e,t){const i=t.isWebGL2,r=new WeakMap;function o(C,I){const z=C.array,$=C.usage,k=e.createBuffer();e.bindBuffer(I,k),e.bufferData(I,z,$),C.onUploadCallback();let Y=5126;return z instanceof Float32Array?Y=5126:z instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):z instanceof Uint16Array?C.isFloat16BufferAttribute?i?Y=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):Y=5123:z instanceof Int16Array?Y=5122:z instanceof Uint32Array?Y=5125:z instanceof Int32Array?Y=5124:z instanceof Int8Array?Y=5120:z instanceof Uint8Array&&(Y=5121),{buffer:k,type:Y,bytesPerElement:z.BYTES_PER_ELEMENT,version:C.version}}function l(C,I,z){const $=I.array,k=I.updateRange;e.bindBuffer(z,C),k.count===-1?e.bufferSubData(z,0,$):(i?e.bufferSubData(z,k.offset*$.BYTES_PER_ELEMENT,$,k.offset,k.count):e.bufferSubData(z,k.offset*$.BYTES_PER_ELEMENT,$.subarray(k.offset,k.offset+k.count)),k.count=-1)}function d(C){return C.isInterleavedBufferAttribute&&(C=C.data),r.get(C)}function n(C){C.isInterleavedBufferAttribute&&(C=C.data);const I=r.get(C);I&&(e.deleteBuffer(I.buffer),r.delete(C))}function S(C,I){if(C.isGLBufferAttribute){const $=r.get(C);(!$||$.version<C.version)&&r.set(C,{buffer:C.buffer,type:C.type,bytesPerElement:C.elementSize,version:C.version});return}C.isInterleavedBufferAttribute&&(C=C.data);const z=r.get(C);z===void 0?r.set(C,o(C,I)):z.version<C.version&&(l(z.buffer,C,I),z.version=C.version)}return{get:d,remove:n,update:S}}class PlaneBufferGeometry extends BufferGeometry{constructor(t=1,i=1,r=1,o=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:o};const l=t/2,d=i/2,n=Math.floor(r),S=Math.floor(o),C=n+1,I=S+1,z=t/n,$=i/S,k=[],Y=[],ie=[],ue=[];for(let ne=0;ne<I;ne++){const se=ne*$-d;for(let le=0;le<C;le++){const he=le*z-l;Y.push(he,-se,0),ie.push(0,0,1),ue.push(le/n),ue.push(1-ne/S)}}for(let ne=0;ne<S;ne++)for(let se=0;se<n;se++){const le=se+C*ne,he=se+C*(ne+1),me=se+1+C*(ne+1),ge=se+1+C*ne;k.push(le,he,ge),k.push(he,me,ge)}this.setIndex(k),this.setAttribute("position",new Float32BufferAttribute(Y,3)),this.setAttribute("normal",new Float32BufferAttribute(ie,3)),this.setAttribute("uv",new Float32BufferAttribute(ue,2))}}var alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmissionmap_fragment=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,transmissionmap_pars_fragment=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,uv_pars_fragment=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const ShaderChunk={alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,encodings_fragment,encodings_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_vertex,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmissionmap_fragment,transmissionmap_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,uv2_pars_fragment,uv2_pars_vertex,uv2_vertex,worldpos_vertex,background_frag,background_vert,cube_frag,cube_vert,depth_frag,depth_vert,distanceRGBA_frag,distanceRGBA_vert,equirect_frag,equirect_vert,linedashed_frag,linedashed_vert,meshbasic_frag,meshbasic_vert,meshlambert_frag,meshlambert_vert,meshmatcap_frag,meshmatcap_vert,meshtoon_frag,meshtoon_vert,meshphong_frag,meshphong_vert,meshphysical_frag,meshphysical_vert,normal_frag,normal_vert,points_frag,points_vert,shadow_frag,shadow_vert,sprite_frag,sprite_vert},UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};function WebGLBackground(e,t,i,r,o){const l=new Color(0);let d=0,n,S,C=null,I=0,z=null;function $(Y,ie,ue,ne){let se=ie.isScene===!0?ie.background:null;se&&se.isTexture&&(se=t.get(se));const le=e.xr,he=le.getSession&&le.getSession();he&&he.environmentBlendMode==="additive"&&(se=null),se===null?k(l,d):se&&se.isColor&&(k(se,1),ne=!0),(e.autoClear||ne)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),se&&(se.isCubeTexture||se.isWebGLCubeRenderTarget||se.mapping===CubeUVReflectionMapping)?(S===void 0&&(S=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),S.geometry.deleteAttribute("normal"),S.geometry.deleteAttribute("uv"),S.onBeforeRender=function(me,ge,xt){this.matrixWorld.copyPosition(xt.matrixWorld)},Object.defineProperty(S.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(S)),se.isWebGLCubeRenderTarget&&(se=se.texture),S.material.uniforms.envMap.value=se,S.material.uniforms.flipEnvMap.value=se.isCubeTexture&&se._needsFlipEnvMap?-1:1,(C!==se||I!==se.version||z!==e.toneMapping)&&(S.material.needsUpdate=!0,C=se,I=se.version,z=e.toneMapping),Y.unshift(S,S.geometry,S.material,0,0,null)):se&&se.isTexture&&(n===void 0&&(n=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),n.geometry.deleteAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(n)),n.material.uniforms.t2D.value=se,se.matrixAutoUpdate===!0&&se.updateMatrix(),n.material.uniforms.uvTransform.value.copy(se.matrix),(C!==se||I!==se.version||z!==e.toneMapping)&&(n.material.needsUpdate=!0,C=se,I=se.version,z=e.toneMapping),Y.unshift(n,n.geometry,n.material,0,0,null))}function k(Y,ie){i.buffers.color.setClear(Y.r,Y.g,Y.b,ie,o)}return{getClearColor:function(){return l},setClearColor:function(Y,ie=1){l.set(Y),d=ie,k(l,d)},getClearAlpha:function(){return d},setClearAlpha:function(Y){d=Y,k(l,d)},render:$}}function WebGLBindingStates(e,t,i,r){const o=e.getParameter(34921),l=r.isWebGL2?null:t.get("OES_vertex_array_object"),d=r.isWebGL2||l!==null,n={},S=ie(null);let C=S;function I(Yt,ri,ei,Ct,Ut){let Mt=!1;if(d){const $t=Y(Ct,ei,ri);C!==$t&&(C=$t,$(C.object)),Mt=ue(Ct,Ut),Mt&&ne(Ct,Ut)}else{const $t=ri.wireframe===!0;(C.geometry!==Ct.id||C.program!==ei.id||C.wireframe!==$t)&&(C.geometry=Ct.id,C.program=ei.id,C.wireframe=$t,Mt=!0)}Yt.isInstancedMesh===!0&&(Mt=!0),Ut!==null&&i.update(Ut,34963),Mt&&(xt(Yt,ri,ei,Ct),Ut!==null&&e.bindBuffer(34963,i.get(Ut).buffer))}function z(){return r.isWebGL2?e.createVertexArray():l.createVertexArrayOES()}function $(Yt){return r.isWebGL2?e.bindVertexArray(Yt):l.bindVertexArrayOES(Yt)}function k(Yt){return r.isWebGL2?e.deleteVertexArray(Yt):l.deleteVertexArrayOES(Yt)}function Y(Yt,ri,ei){const Ct=ei.wireframe===!0;let Ut=n[Yt.id];Ut===void 0&&(Ut={},n[Yt.id]=Ut);let Mt=Ut[ri.id];Mt===void 0&&(Mt={},Ut[ri.id]=Mt);let $t=Mt[Ct];return $t===void 0&&($t=ie(z()),Mt[Ct]=$t),$t}function ie(Yt){const ri=[],ei=[],Ct=[];for(let Ut=0;Ut<o;Ut++)ri[Ut]=0,ei[Ut]=0,Ct[Ut]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ri,enabledAttributes:ei,attributeDivisors:Ct,object:Yt,attributes:{},index:null}}function ue(Yt,ri){const ei=C.attributes,Ct=Yt.attributes;let Ut=0;for(const Mt in Ct){const $t=ei[Mt],jt=Ct[Mt];if($t===void 0||$t.attribute!==jt||$t.data!==jt.data)return!0;Ut++}return C.attributesNum!==Ut||C.index!==ri}function ne(Yt,ri){const ei={},Ct=Yt.attributes;let Ut=0;for(const Mt in Ct){const $t=Ct[Mt],jt={};jt.attribute=$t,$t.data&&(jt.data=$t.data),ei[Mt]=jt,Ut++}C.attributes=ei,C.attributesNum=Ut,C.index=ri}function se(){const Yt=C.newAttributes;for(let ri=0,ei=Yt.length;ri<ei;ri++)Yt[ri]=0}function le(Yt){he(Yt,0)}function he(Yt,ri){const ei=C.newAttributes,Ct=C.enabledAttributes,Ut=C.attributeDivisors;ei[Yt]=1,Ct[Yt]===0&&(e.enableVertexAttribArray(Yt),Ct[Yt]=1),Ut[Yt]!==ri&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Yt,ri),Ut[Yt]=ri)}function me(){const Yt=C.newAttributes,ri=C.enabledAttributes;for(let ei=0,Ct=ri.length;ei<Ct;ei++)ri[ei]!==Yt[ei]&&(e.disableVertexAttribArray(ei),ri[ei]=0)}function ge(Yt,ri,ei,Ct,Ut,Mt){r.isWebGL2===!0&&(ei===5124||ei===5125)?e.vertexAttribIPointer(Yt,ri,ei,Ut,Mt):e.vertexAttribPointer(Yt,ri,ei,Ct,Ut,Mt)}function xt(Yt,ri,ei,Ct){if(r.isWebGL2===!1&&(Yt.isInstancedMesh||Ct.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;se();const Ut=Ct.attributes,Mt=ei.getAttributes(),$t=ri.defaultAttributeValues;for(const jt in Mt){const mi=Mt[jt];if(mi>=0){const Xi=Ut[jt];if(Xi!==void 0){const Er=Xi.normalized,Ir=Xi.itemSize,nr=i.get(Xi);if(nr===void 0)continue;const si=nr.buffer,Gt=nr.type,ui=nr.bytesPerElement;if(Xi.isInterleavedBufferAttribute){const oi=Xi.data,Si=oi.stride,Li=Xi.offset;oi&&oi.isInstancedInterleavedBuffer?(he(mi,oi.meshPerAttribute),Ct._maxInstanceCount===void 0&&(Ct._maxInstanceCount=oi.meshPerAttribute*oi.count)):le(mi),e.bindBuffer(34962,si),ge(mi,Ir,Gt,Er,Si*ui,Li*ui)}else Xi.isInstancedBufferAttribute?(he(mi,Xi.meshPerAttribute),Ct._maxInstanceCount===void 0&&(Ct._maxInstanceCount=Xi.meshPerAttribute*Xi.count)):le(mi),e.bindBuffer(34962,si),ge(mi,Ir,Gt,Er,0,0)}else if(jt==="instanceMatrix"){const Er=i.get(Yt.instanceMatrix);if(Er===void 0)continue;const Ir=Er.buffer,nr=Er.type;he(mi+0,1),he(mi+1,1),he(mi+2,1),he(mi+3,1),e.bindBuffer(34962,Ir),e.vertexAttribPointer(mi+0,4,nr,!1,64,0),e.vertexAttribPointer(mi+1,4,nr,!1,64,16),e.vertexAttribPointer(mi+2,4,nr,!1,64,32),e.vertexAttribPointer(mi+3,4,nr,!1,64,48)}else if(jt==="instanceColor"){const Er=i.get(Yt.instanceColor);if(Er===void 0)continue;const Ir=Er.buffer,nr=Er.type;he(mi,1),e.bindBuffer(34962,Ir),e.vertexAttribPointer(mi,3,nr,!1,12,0)}else if($t!==void 0){const Er=$t[jt];if(Er!==void 0)switch(Er.length){case 2:e.vertexAttrib2fv(mi,Er);break;case 3:e.vertexAttrib3fv(mi,Er);break;case 4:e.vertexAttrib4fv(mi,Er);break;default:e.vertexAttrib1fv(mi,Er)}}}}me()}function Et(){Ht();for(const Yt in n){const ri=n[Yt];for(const ei in ri){const Ct=ri[ei];for(const Ut in Ct)k(Ct[Ut].object),delete Ct[Ut];delete ri[ei]}delete n[Yt]}}function Lt(Yt){if(n[Yt.id]===void 0)return;const ri=n[Yt.id];for(const ei in ri){const Ct=ri[ei];for(const Ut in Ct)k(Ct[Ut].object),delete Ct[Ut];delete ri[ei]}delete n[Yt.id]}function Zt(Yt){for(const ri in n){const ei=n[ri];if(ei[Yt.id]===void 0)continue;const Ct=ei[Yt.id];for(const Ut in Ct)k(Ct[Ut].object),delete Ct[Ut];delete ei[Yt.id]}}function Ht(){It(),C!==S&&(C=S,$(C.object))}function It(){S.geometry=null,S.program=null,S.wireframe=!1}return{setup:I,reset:Ht,resetDefaultState:It,dispose:Et,releaseStatesOfGeometry:Lt,releaseStatesOfProgram:Zt,initAttributes:se,enableAttribute:le,disableUnusedAttributes:me}}function WebGLBufferRenderer(e,t,i,r){const o=r.isWebGL2;let l;function d(C){l=C}function n(C,I){e.drawArrays(l,C,I),i.update(I,l,1)}function S(C,I,z){if(z===0)return;let $,k;if(o)$=e,k="drawArraysInstanced";else if($=t.get("ANGLE_instanced_arrays"),k="drawArraysInstancedANGLE",$===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}$[k](l,C,I,z),i.update(I,l,z)}this.setMode=d,this.render=n,this.renderInstances=S}function WebGLCapabilities(e,t,i){let r;function o(){if(r!==void 0)return r;const ge=t.get("EXT_texture_filter_anisotropic");return ge!==null?r=e.getParameter(ge.MAX_TEXTURE_MAX_ANISOTROPY_EXT):r=0,r}function l(ge){if(ge==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ge="mediump"}return ge==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const d=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&e instanceof WebGL2ComputeRenderingContext;let n=i.precision!==void 0?i.precision:"highp";const S=l(n);S!==n&&(console.warn("THREE.WebGLRenderer:",n,"not supported, using",S,"instead."),n=S);const C=i.logarithmicDepthBuffer===!0,I=e.getParameter(34930),z=e.getParameter(35660),$=e.getParameter(3379),k=e.getParameter(34076),Y=e.getParameter(34921),ie=e.getParameter(36347),ue=e.getParameter(36348),ne=e.getParameter(36349),se=z>0,le=d||!!t.get("OES_texture_float"),he=se&&le,me=d?e.getParameter(36183):0;return{isWebGL2:d,getMaxAnisotropy:o,getMaxPrecision:l,precision:n,logarithmicDepthBuffer:C,maxTextures:I,maxVertexTextures:z,maxTextureSize:$,maxCubemapSize:k,maxAttributes:Y,maxVertexUniforms:ie,maxVaryings:ue,maxFragmentUniforms:ne,vertexTextures:se,floatFragmentTextures:le,floatVertexTextures:he,maxSamples:me}}function WebGLClipping(e){const t=this;let i=null,r=0,o=!1,l=!1;const d=new Plane,n=new Matrix3,S={value:null,needsUpdate:!1};this.uniform=S,this.numPlanes=0,this.numIntersection=0,this.init=function(z,$,k){const Y=z.length!==0||$||r!==0||o;return o=$,i=I(z,k,0),r=z.length,Y},this.beginShadows=function(){l=!0,I(null)},this.endShadows=function(){l=!1,C()},this.setState=function(z,$,k){const Y=z.clippingPlanes,ie=z.clipIntersection,ue=z.clipShadows,ne=e.get(z);if(!o||Y===null||Y.length===0||l&&!ue)l?I(null):C();else{const se=l?0:r,le=se*4;let he=ne.clippingState||null;S.value=he,he=I(Y,$,le,k);for(let me=0;me!==le;++me)he[me]=i[me];ne.clippingState=he,this.numIntersection=ie?this.numPlanes:0,this.numPlanes+=se}};function C(){S.value!==i&&(S.value=i,S.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function I(z,$,k,Y){const ie=z!==null?z.length:0;let ue=null;if(ie!==0){if(ue=S.value,Y!==!0||ue===null){const ne=k+ie*4,se=$.matrixWorldInverse;n.getNormalMatrix(se),(ue===null||ue.length<ne)&&(ue=new Float32Array(ne));for(let le=0,he=k;le!==ie;++le,he+=4)d.copy(z[le]).applyMatrix4(se,n),d.normal.toArray(ue,he),ue[he+3]=d.constant}S.value=ue,S.needsUpdate=!0}return t.numPlanes=ie,t.numIntersection=0,ue}}function WebGLCubeMaps(e){let t=new WeakMap;function i(d,n){return n===EquirectangularReflectionMapping?d.mapping=CubeReflectionMapping:n===EquirectangularRefractionMapping&&(d.mapping=CubeRefractionMapping),d}function r(d){if(d&&d.isTexture){const n=d.mapping;if(n===EquirectangularReflectionMapping||n===EquirectangularRefractionMapping)if(t.has(d)){const S=t.get(d).texture;return i(S,d.mapping)}else{const S=d.image;if(S&&S.height>0){const C=e.getRenderList(),I=e.getRenderTarget(),z=new WebGLCubeRenderTarget(S.height/2);return z.fromEquirectangularTexture(e,d),t.set(d,z),e.setRenderTarget(I),e.setRenderList(C),d.addEventListener("dispose",o),i(z.texture,d.mapping)}else return null}}return d}function o(d){const n=d.target;n.removeEventListener("dispose",o);const S=t.get(n);S!==void 0&&(t.delete(n),S.dispose())}function l(){t=new WeakMap}return{get:r,dispose:l}}function WebGLExtensions(e){const t={};return{has:function(i){if(t[i]!==void 0)return t[i]!==null;let r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return t[i]=r,r!==null},get:function(i){return this.has(i)||console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]}}}function WebGLGeometries(e,t,i,r){const o=new WeakMap,l=new WeakMap;function d(z){const $=z.target,k=o.get($);k.index!==null&&t.remove(k.index);for(const ie in k.attributes)t.remove(k.attributes[ie]);$.removeEventListener("dispose",d),o.delete($);const Y=l.get(k);Y&&(t.remove(Y),l.delete(k)),r.releaseStatesOfGeometry(k),$.isInstancedBufferGeometry===!0&&delete $._maxInstanceCount,i.memory.geometries--}function n(z,$){let k=o.get($);return k||($.addEventListener("dispose",d),$.isBufferGeometry?k=$:$.isGeometry&&($._bufferGeometry===void 0&&($._bufferGeometry=new BufferGeometry().setFromObject(z)),k=$._bufferGeometry),o.set($,k),i.memory.geometries++,k)}function S(z){const $=z.attributes;for(const Y in $)t.update($[Y],34962);const k=z.morphAttributes;for(const Y in k){const ie=k[Y];for(let ue=0,ne=ie.length;ue<ne;ue++)t.update(ie[ue],34962)}}function C(z){const $=[],k=z.index,Y=z.attributes.position;let ie=0;if(k!==null){const se=k.array;ie=k.version;for(let le=0,he=se.length;le<he;le+=3){const me=se[le+0],ge=se[le+1],xt=se[le+2];$.push(me,ge,ge,xt,xt,me)}}else{const se=Y.array;ie=Y.version;for(let le=0,he=se.length/3-1;le<he;le+=3){const me=le+0,ge=le+1,xt=le+2;$.push(me,ge,ge,xt,xt,me)}}const ue=new(arrayMax($)>65535?Uint32BufferAttribute:Uint16BufferAttribute)($,1);ue.version=ie;const ne=l.get(z);ne&&t.remove(ne),l.set(z,ue)}function I(z){const $=l.get(z);if($){const k=z.index;k!==null&&$.version<k.version&&C(z)}else C(z);return l.get(z)}return{get:n,update:S,getWireframeAttribute:I}}function WebGLIndexedBufferRenderer(e,t,i,r){const o=r.isWebGL2;let l;function d($){l=$}let n,S;function C($){n=$.type,S=$.bytesPerElement}function I($,k){e.drawElements(l,k,n,$*S),i.update(k,l,1)}function z($,k,Y){if(Y===0)return;let ie,ue;if(o)ie=e,ue="drawElementsInstanced";else if(ie=t.get("ANGLE_instanced_arrays"),ue="drawElementsInstancedANGLE",ie===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}ie[ue](l,k,n,$*S,Y),i.update(k,l,Y)}this.setMode=d,this.setIndex=C,this.render=I,this.renderInstances=z}function WebGLInfo(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(l,d,n){switch(i.calls++,d){case 4:i.triangles+=n*(l/3);break;case 1:i.lines+=n*(l/2);break;case 3:i.lines+=n*(l-1);break;case 2:i.lines+=n*l;break;case 0:i.points+=n*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d);break}}function o(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:o,update:r}}function numericalSort(e,t){return e[0]-t[0]}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(e){const t={},i=new Float32Array(8),r=[];for(let l=0;l<8;l++)r[l]=[l,0];function o(l,d,n,S){const C=l.morphTargetInfluences,I=C===void 0?0:C.length;let z=t[d.id];if(z===void 0){z=[];for(let ue=0;ue<I;ue++)z[ue]=[ue,0];t[d.id]=z}for(let ue=0;ue<I;ue++){const ne=z[ue];ne[0]=ue,ne[1]=C[ue]}z.sort(absNumericalSort);for(let ue=0;ue<8;ue++)ue<I&&z[ue][1]?(r[ue][0]=z[ue][0],r[ue][1]=z[ue][1]):(r[ue][0]=Number.MAX_SAFE_INTEGER,r[ue][1]=0);r.sort(numericalSort);const $=n.morphTargets&&d.morphAttributes.position,k=n.morphNormals&&d.morphAttributes.normal;let Y=0;for(let ue=0;ue<8;ue++){const ne=r[ue],se=ne[0],le=ne[1];se!==Number.MAX_SAFE_INTEGER&&le?($&&d.getAttribute("morphTarget"+ue)!==$[se]&&d.setAttribute("morphTarget"+ue,$[se]),k&&d.getAttribute("morphNormal"+ue)!==k[se]&&d.setAttribute("morphNormal"+ue,k[se]),i[ue]=le,Y+=le):($&&d.hasAttribute("morphTarget"+ue)===!0&&d.deleteAttribute("morphTarget"+ue),k&&d.hasAttribute("morphNormal"+ue)===!0&&d.deleteAttribute("morphNormal"+ue),i[ue]=0)}const ie=d.morphTargetsRelative?1:1-Y;S.getUniforms().setValue(e,"morphTargetBaseInfluence",ie),S.getUniforms().setValue(e,"morphTargetInfluences",i)}return{update:o}}function WebGLObjects(e,t,i,r){let o=new WeakMap;function l(S){const C=r.render.frame,I=S.geometry,z=t.get(S,I);return o.get(z)!==C&&(I.isGeometry&&z.updateFromObject(S),t.update(z),o.set(z,C)),S.isInstancedMesh&&(S.hasEventListener("dispose",n)===!1&&S.addEventListener("dispose",n),i.update(S.instanceMatrix,34962),S.instanceColor!==null&&i.update(S.instanceColor,34962)),z}function d(){o=new WeakMap}function n(S){const C=S.target;C.removeEventListener("dispose",n),i.remove(C.instanceMatrix),C.instanceColor!==null&&i.remove(C.instanceColor)}return{update:l,dispose:d}}function DataTexture2DArray(e=null,t=1,i=1,r=1){Texture.call(this,null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}DataTexture2DArray.prototype=Object.create(Texture.prototype);DataTexture2DArray.prototype.constructor=DataTexture2DArray;DataTexture2DArray.prototype.isDataTexture2DArray=!0;function DataTexture3D(e=null,t=1,i=1,r=1){Texture.call(this,null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}DataTexture3D.prototype=Object.create(Texture.prototype);DataTexture3D.prototype.constructor=DataTexture3D;DataTexture3D.prototype.isDataTexture3D=!0;const emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(e,t,i){const r=e[0];if(r<=0||r>0)return e;const o=t*i;let l=arrayCacheF32[o];if(l===void 0&&(l=new Float32Array(o),arrayCacheF32[o]=l),t!==0){r.toArray(l,0);for(let d=1,n=0;d!==t;++d)n+=i,e[d].toArray(l,n)}return l}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function copyArray(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function allocTexUnits(e,t){let i=arrayCacheI32[t];i===void 0&&(i=new Int32Array(t),arrayCacheI32[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function setValueV1f(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function setValueV2f(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(arraysEqual(i,t))return;e.uniform2fv(this.addr,t),copyArray(i,t)}}function setValueV3f(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(arraysEqual(i,t))return;e.uniform3fv(this.addr,t),copyArray(i,t)}}function setValueV4f(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(arraysEqual(i,t))return;e.uniform4fv(this.addr,t),copyArray(i,t)}}function setValueM2(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(arraysEqual(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat2array.set(r),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,r)}}function setValueM3(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(arraysEqual(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat3array.set(r),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,r)}}function setValueM4(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(arraysEqual(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat4array.set(r),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,r)}}function setValueT1(e,t,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(e.uniform1i(this.addr,o),r[0]=o),i.safeSetTexture2D(t||emptyTexture,o)}function setValueT2DArray1(e,t,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(e.uniform1i(this.addr,o),r[0]=o),i.setTexture2DArray(t||emptyTexture2dArray,o)}function setValueT3D1(e,t,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(e.uniform1i(this.addr,o),r[0]=o),i.setTexture3D(t||emptyTexture3d,o)}function setValueT6(e,t,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(e.uniform1i(this.addr,o),r[0]=o),i.safeSetTextureCube(t||emptyCubeTexture,o)}function setValueV1i(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function setValueV2i(e,t){const i=this.cache;arraysEqual(i,t)||(e.uniform2iv(this.addr,t),copyArray(i,t))}function setValueV3i(e,t){const i=this.cache;arraysEqual(i,t)||(e.uniform3iv(this.addr,t),copyArray(i,t))}function setValueV4i(e,t){const i=this.cache;arraysEqual(i,t)||(e.uniform4iv(this.addr,t),copyArray(i,t))}function setValueV1ui(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV2fArray(e,t){const i=flatten(t,this.size,2);e.uniform2fv(this.addr,i)}function setValueV3fArray(e,t){const i=flatten(t,this.size,3);e.uniform3fv(this.addr,i)}function setValueV4fArray(e,t){const i=flatten(t,this.size,4);e.uniform4fv(this.addr,i)}function setValueM2Array(e,t){const i=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(e,t){const i=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(e,t){const i=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function setValueT1Array(e,t,i){const r=t.length,o=allocTexUnits(i,r);e.uniform1iv(this.addr,o);for(let l=0;l!==r;++l)i.safeSetTexture2D(t[l]||emptyTexture,o[l])}function setValueT6Array(e,t,i){const r=t.length,o=allocTexUnits(i,r);e.uniform1iv(this.addr,o);for(let l=0;l!==r;++l)i.safeSetTextureCube(t[l]||emptyCubeTexture,o[l])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}PureArrayUniform.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)};function StructuredUniform(e){this.id=e,this.seq=[],this.map={}}StructuredUniform.prototype.setValue=function(e,t,i){const r=this.seq;for(let o=0,l=r.length;o!==l;++o){const d=r[o];d.setValue(e,t[d.id],i)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,i){const r=e.name,o=r.length;for(RePathPart.lastIndex=0;;){const l=RePathPart.exec(r),d=RePathPart.lastIndex;let n=l[1];const S=l[2]==="]",C=l[3];if(S&&(n=n|0),C===void 0||C==="["&&d+2===o){addUniform(i,C===void 0?new SingleUniform(n,e,t):new PureArrayUniform(n,e,t));break}else{let z=i.map[n];z===void 0&&(z=new StructuredUniform(n),addUniform(i,z)),i=z}}}function WebGLUniforms(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const o=e.getActiveUniform(t,r),l=e.getUniformLocation(t,o.name);parseUniform(o,l,this)}}WebGLUniforms.prototype.setValue=function(e,t,i,r){const o=this.map[t];o!==void 0&&o.setValue(e,i,r)};WebGLUniforms.prototype.setOptional=function(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)};WebGLUniforms.upload=function(e,t,i,r){for(let o=0,l=t.length;o!==l;++o){const d=t[o],n=i[d.id];n.needsUpdate!==!1&&d.setValue(e,n.value,r)}};WebGLUniforms.seqWithValue=function(e,t){const i=[];for(let r=0,o=e.length;r!==o;++r){const l=e[r];l.id in t&&i.push(l)}return i};function WebGLShader(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}let programIdCount=0;function addLineNumbers(e){const t=e.split(`
`);for(let i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join(`
`)}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function getShaderErrors(e,t,i){const r=e.getShaderParameter(t,35713),o=e.getShaderInfoLog(t).trim();if(r&&o==="")return"";const l=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+`
`+o+addLineNumbers(l)}function getTexelDecodingFunction(e,t){const i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(e,t){const i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(e,t){let i;switch(t){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;case CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function fetchAttributeLocations(e,t){const i={},r=e.getProgramParameter(t,35721);for(let o=0;o<r;o++){const d=e.getActiveAttrib(t,o).name;i[d]=e.getAttribLocation(t,d)}return i}function filterEmptyLine(e){return e!==""}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){const i=ShaderChunk[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(i)}const deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(e,t,i,r)}function loopReplacer(e,t,i,r){let o="";for(let l=parseInt(t);l<parseInt(i);l++)o+=r.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return o}function generatePrecision(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function generateShadowMapTypeDefine(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV";break}return t}function generateEnvMapModeDefine(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:t="ENVMAP_MODE_REFRACTION";break}return t}function generateEnvMapBlendingDefine(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD";break}return t}function WebGLProgram(e,t,i,r){const o=e.getContext(),l=i.defines;let d=i.vertexShader,n=i.fragmentShader;const S=generateShadowMapTypeDefine(i),C=generateEnvMapTypeDefine(i),I=generateEnvMapModeDefine(i),z=generateEnvMapBlendingDefine(i),$=e.gammaFactor>0?e.gammaFactor:1,k=i.isWebGL2?"":generateExtensions(i),Y=generateDefines(l),ie=o.createProgram();let ue,ne,se=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(ue=[Y].filter(filterEmptyLine).join(`
`),ue.length>0&&(ue+=`
`),ne=[k,Y].filter(filterEmptyLine).join(`
`),ne.length>0&&(ne+=`
`)):(ue=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,Y,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+$,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+I:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+S:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),ne=[k,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,Y,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+$,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+C:"",i.envMap?"#define "+I:"",i.envMap?"#define "+z:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+S:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",ShaderChunk.encodings_pars_fragment,i.map?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcap?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),d=resolveIncludes(d),d=replaceLightNums(d,i),d=replaceClippingPlaneNums(d,i),n=resolveIncludes(n),n=replaceLightNums(n,i),n=replaceClippingPlaneNums(n,i),d=unrollLoops(d),n=unrollLoops(n),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(se=`#version 300 es
`,ue=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ue,ne=["#define varying in",i.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",i.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ne);const le=se+ue+d,he=se+ne+n,me=WebGLShader(o,35633,le),ge=WebGLShader(o,35632,he);if(o.attachShader(ie,me),o.attachShader(ie,ge),i.index0AttributeName!==void 0?o.bindAttribLocation(ie,0,i.index0AttributeName):i.morphTargets===!0&&o.bindAttribLocation(ie,0,"position"),o.linkProgram(ie),e.debug.checkShaderErrors){const Lt=o.getProgramInfoLog(ie).trim(),Zt=o.getShaderInfoLog(me).trim(),Ht=o.getShaderInfoLog(ge).trim();let It=!0,Yt=!0;if(o.getProgramParameter(ie,35714)===!1){It=!1;const ri=getShaderErrors(o,me,"vertex"),ei=getShaderErrors(o,ge,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(ie,35715),"gl.getProgramInfoLog",Lt,ri,ei)}else Lt!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Lt):(Zt===""||Ht==="")&&(Yt=!1);Yt&&(this.diagnostics={runnable:It,programLog:Lt,vertexShader:{log:Zt,prefix:ue},fragmentShader:{log:Ht,prefix:ne}})}o.deleteShader(me),o.deleteShader(ge);let xt;this.getUniforms=function(){return xt===void 0&&(xt=new WebGLUniforms(o,ie)),xt};let Et;return this.getAttributes=function(){return Et===void 0&&(Et=fetchAttributeLocations(o,ie)),Et},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(ie),this.program=void 0},this.name=i.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=ie,this.vertexShader=me,this.fragmentShader=ge,this}function WebGLPrograms(e,t,i,r,o,l){const d=[],n=r.isWebGL2,S=r.logarithmicDepthBuffer,C=r.floatVertexTextures,I=r.maxVertexUniforms,z=r.vertexTextures;let $=r.precision;const k={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},Y=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function ie(ge){const Et=ge.skeleton.bones;if(C)return 1024;{const Zt=Math.floor((I-20)/4),Ht=Math.min(Zt,Et.length);return Ht<Et.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Et.length+" bones. This GPU supports "+Ht+"."),0):Ht}}function ue(ge){let xt;return ge&&ge.isTexture?xt=ge.encoding:ge&&ge.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),xt=ge.texture.encoding):xt=LinearEncoding,xt}function ne(ge,xt,Et,Lt,Zt){const Ht=Lt.fog,It=ge.isMeshStandardMaterial?Lt.environment:null,Yt=t.get(ge.envMap||It),ri=k[ge.type],ei=Zt.isSkinnedMesh?ie(Zt):0;ge.precision!==null&&($=r.getMaxPrecision(ge.precision),$!==ge.precision&&console.warn("THREE.WebGLProgram.getParameters:",ge.precision,"not supported, using",$,"instead."));let Ct,Ut;if(ri){const jt=ShaderLib[ri];Ct=jt.vertexShader,Ut=jt.fragmentShader}else Ct=ge.vertexShader,Ut=ge.fragmentShader;const Mt=e.getRenderTarget();return{isWebGL2:n,shaderID:ri,shaderName:ge.type,vertexShader:Ct,fragmentShader:Ut,defines:ge.defines,isRawShaderMaterial:ge.isRawShaderMaterial===!0,glslVersion:ge.glslVersion,precision:$,instancing:Zt.isInstancedMesh===!0,instancingColor:Zt.isInstancedMesh===!0&&Zt.instanceColor!==null,supportsVertexTextures:z,outputEncoding:Mt!==null?ue(Mt.texture):e.outputEncoding,map:!!ge.map,mapEncoding:ue(ge.map),matcap:!!ge.matcap,matcapEncoding:ue(ge.matcap),envMap:!!Yt,envMapMode:Yt&&Yt.mapping,envMapEncoding:ue(Yt),envMapCubeUV:!!Yt&&(Yt.mapping===CubeUVReflectionMapping||Yt.mapping===CubeUVRefractionMapping),lightMap:!!ge.lightMap,lightMapEncoding:ue(ge.lightMap),aoMap:!!ge.aoMap,emissiveMap:!!ge.emissiveMap,emissiveMapEncoding:ue(ge.emissiveMap),bumpMap:!!ge.bumpMap,normalMap:!!ge.normalMap,objectSpaceNormalMap:ge.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:ge.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!ge.clearcoatMap,clearcoatRoughnessMap:!!ge.clearcoatRoughnessMap,clearcoatNormalMap:!!ge.clearcoatNormalMap,displacementMap:!!ge.displacementMap,roughnessMap:!!ge.roughnessMap,metalnessMap:!!ge.metalnessMap,specularMap:!!ge.specularMap,alphaMap:!!ge.alphaMap,gradientMap:!!ge.gradientMap,sheen:!!ge.sheen,transmissionMap:!!ge.transmissionMap,combine:ge.combine,vertexTangents:ge.normalMap&&ge.vertexTangents,vertexColors:ge.vertexColors,vertexUvs:!!ge.map||!!ge.bumpMap||!!ge.normalMap||!!ge.specularMap||!!ge.alphaMap||!!ge.emissiveMap||!!ge.roughnessMap||!!ge.metalnessMap||!!ge.clearcoatMap||!!ge.clearcoatRoughnessMap||!!ge.clearcoatNormalMap||!!ge.displacementMap||!!ge.transmissionMap,uvsVertexOnly:!(ge.map||ge.bumpMap||ge.normalMap||ge.specularMap||ge.alphaMap||ge.emissiveMap||ge.roughnessMap||ge.metalnessMap||ge.clearcoatNormalMap||ge.transmissionMap)&&!!ge.displacementMap,fog:!!Ht,useFog:ge.fog,fogExp2:Ht&&Ht.isFogExp2,flatShading:ge.flatShading,sizeAttenuation:ge.sizeAttenuation,logarithmicDepthBuffer:S,skinning:ge.skinning&&ei>0,maxBones:ei,useVertexTexture:C,morphTargets:ge.morphTargets,morphNormals:ge.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:xt.directional.length,numPointLights:xt.point.length,numSpotLights:xt.spot.length,numRectAreaLights:xt.rectArea.length,numHemiLights:xt.hemi.length,numDirLightShadows:xt.directionalShadowMap.length,numPointLightShadows:xt.pointShadowMap.length,numSpotLightShadows:xt.spotShadowMap.length,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:ge.dithering,shadowMapEnabled:e.shadowMap.enabled&&Et.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge.toneMapped?e.toneMapping:NoToneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:ge.premultipliedAlpha,alphaTest:ge.alphaTest,doubleSided:ge.side===DoubleSide,flipSided:ge.side===BackSide,depthPacking:ge.depthPacking!==void 0?ge.depthPacking:!1,index0AttributeName:ge.index0AttributeName,extensionDerivatives:ge.extensions&&ge.extensions.derivatives,extensionFragDepth:ge.extensions&&ge.extensions.fragDepth,extensionDrawBuffers:ge.extensions&&ge.extensions.drawBuffers,extensionShaderTextureLOD:ge.extensions&&ge.extensions.shaderTextureLOD,rendererExtensionFragDepth:n||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:n||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:n||i.has("EXT_shader_texture_lod"),customProgramCacheKey:ge.customProgramCacheKey()}}function se(ge){const xt=[];if(ge.shaderID?xt.push(ge.shaderID):(xt.push(ge.fragmentShader),xt.push(ge.vertexShader)),ge.defines!==void 0)for(const Et in ge.defines)xt.push(Et),xt.push(ge.defines[Et]);if(ge.isRawShaderMaterial===!1){for(let Et=0;Et<Y.length;Et++)xt.push(ge[Y[Et]]);xt.push(e.outputEncoding),xt.push(e.gammaFactor)}return xt.push(ge.customProgramCacheKey),xt.join()}function le(ge){const xt=k[ge.type];let Et;if(xt){const Lt=ShaderLib[xt];Et=UniformsUtils.clone(Lt.uniforms)}else Et=ge.uniforms;return Et}function he(ge,xt){let Et;for(let Lt=0,Zt=d.length;Lt<Zt;Lt++){const Ht=d[Lt];if(Ht.cacheKey===xt){Et=Ht,++Et.usedTimes;break}}return Et===void 0&&(Et=new WebGLProgram(e,xt,ge,o),d.push(Et)),Et}function me(ge){if(--ge.usedTimes===0){const xt=d.indexOf(ge);d[xt]=d[d.length-1],d.pop(),ge.destroy()}}return{getParameters:ne,getProgramCacheKey:se,getUniforms:le,acquireProgram:he,releaseProgram:me,programs:d}}function WebGLProperties(){let e=new WeakMap;function t(l){let d=e.get(l);return d===void 0&&(d={},e.set(l,d)),d}function i(l){e.delete(l)}function r(l,d,n){e.get(l)[d]=n}function o(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:o}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(e){const t=[];let i=0;const r=[],o=[],l={id:-1};function d(){i=0,r.length=0,o.length=0}function n($,k,Y,ie,ue,ne){let se=t[i];const le=e.get(Y);return se===void 0?(se={id:$.id,object:$,geometry:k,material:Y,program:le.program||l,groupOrder:ie,renderOrder:$.renderOrder,z:ue,group:ne},t[i]=se):(se.id=$.id,se.object=$,se.geometry=k,se.material=Y,se.program=le.program||l,se.groupOrder=ie,se.renderOrder=$.renderOrder,se.z=ue,se.group=ne),i++,se}function S($,k,Y,ie,ue,ne){const se=n($,k,Y,ie,ue,ne);(Y.transparent===!0?o:r).push(se)}function C($,k,Y,ie,ue,ne){const se=n($,k,Y,ie,ue,ne);(Y.transparent===!0?o:r).unshift(se)}function I($,k){r.length>1&&r.sort($||painterSortStable),o.length>1&&o.sort(k||reversePainterSortStable)}function z(){for(let $=i,k=t.length;$<k;$++){const Y=t[$];if(Y.id===null)break;Y.id=null,Y.object=null,Y.geometry=null,Y.material=null,Y.program=null,Y.group=null}}return{opaque:r,transparent:o,init:d,push:S,unshift:C,finish:z,sort:I}}function WebGLRenderLists(e){let t=new WeakMap;function i(o,l){const d=t.get(o);let n;return d===void 0?(n=new WebGLRenderList(e),t.set(o,new WeakMap),t.get(o).set(l,n)):(n=d.get(l),n===void 0&&(n=new WebGLRenderList(e),d.set(l,n))),n}function r(){t=new WeakMap}return{get:i,dispose:r}}function UniformsCache(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return e[t.id]=i,i}}}function ShadowUniformsCache(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(e,t){const i=new UniformsCache,r=ShadowUniformsCache(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let I=0;I<9;I++)o.probe.push(new Vector3);const l=new Vector3,d=new Matrix4,n=new Matrix4;function S(I){let z=0,$=0,k=0;for(let xt=0;xt<9;xt++)o.probe[xt].set(0,0,0);let Y=0,ie=0,ue=0,ne=0,se=0,le=0,he=0,me=0;I.sort(shadowCastingLightsFirst);for(let xt=0,Et=I.length;xt<Et;xt++){const Lt=I[xt],Zt=Lt.color,Ht=Lt.intensity,It=Lt.distance,Yt=Lt.shadow&&Lt.shadow.map?Lt.shadow.map.texture:null;if(Lt.isAmbientLight)z+=Zt.r*Ht,$+=Zt.g*Ht,k+=Zt.b*Ht;else if(Lt.isLightProbe)for(let ri=0;ri<9;ri++)o.probe[ri].addScaledVector(Lt.sh.coefficients[ri],Ht);else if(Lt.isDirectionalLight){const ri=i.get(Lt);if(ri.color.copy(Lt.color).multiplyScalar(Lt.intensity),Lt.castShadow){const ei=Lt.shadow,Ct=r.get(Lt);Ct.shadowBias=ei.bias,Ct.shadowNormalBias=ei.normalBias,Ct.shadowRadius=ei.radius,Ct.shadowMapSize=ei.mapSize,o.directionalShadow[Y]=Ct,o.directionalShadowMap[Y]=Yt,o.directionalShadowMatrix[Y]=Lt.shadow.matrix,le++}o.directional[Y]=ri,Y++}else if(Lt.isSpotLight){const ri=i.get(Lt);if(ri.position.setFromMatrixPosition(Lt.matrixWorld),ri.color.copy(Zt).multiplyScalar(Ht),ri.distance=It,ri.coneCos=Math.cos(Lt.angle),ri.penumbraCos=Math.cos(Lt.angle*(1-Lt.penumbra)),ri.decay=Lt.decay,Lt.castShadow){const ei=Lt.shadow,Ct=r.get(Lt);Ct.shadowBias=ei.bias,Ct.shadowNormalBias=ei.normalBias,Ct.shadowRadius=ei.radius,Ct.shadowMapSize=ei.mapSize,o.spotShadow[ue]=Ct,o.spotShadowMap[ue]=Yt,o.spotShadowMatrix[ue]=Lt.shadow.matrix,me++}o.spot[ue]=ri,ue++}else if(Lt.isRectAreaLight){const ri=i.get(Lt);ri.color.copy(Zt).multiplyScalar(Ht),ri.halfWidth.set(Lt.width*.5,0,0),ri.halfHeight.set(0,Lt.height*.5,0),o.rectArea[ne]=ri,ne++}else if(Lt.isPointLight){const ri=i.get(Lt);if(ri.color.copy(Lt.color).multiplyScalar(Lt.intensity),ri.distance=Lt.distance,ri.decay=Lt.decay,Lt.castShadow){const ei=Lt.shadow,Ct=r.get(Lt);Ct.shadowBias=ei.bias,Ct.shadowNormalBias=ei.normalBias,Ct.shadowRadius=ei.radius,Ct.shadowMapSize=ei.mapSize,Ct.shadowCameraNear=ei.camera.near,Ct.shadowCameraFar=ei.camera.far,o.pointShadow[ie]=Ct,o.pointShadowMap[ie]=Yt,o.pointShadowMatrix[ie]=Lt.shadow.matrix,he++}o.point[ie]=ri,ie++}else if(Lt.isHemisphereLight){const ri=i.get(Lt);ri.skyColor.copy(Lt.color).multiplyScalar(Ht),ri.groundColor.copy(Lt.groundColor).multiplyScalar(Ht),o.hemi[se]=ri,se++}}ne>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,o.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=UniformsLib.LTC_HALF_1,o.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=z,o.ambient[1]=$,o.ambient[2]=k;const ge=o.hash;(ge.directionalLength!==Y||ge.pointLength!==ie||ge.spotLength!==ue||ge.rectAreaLength!==ne||ge.hemiLength!==se||ge.numDirectionalShadows!==le||ge.numPointShadows!==he||ge.numSpotShadows!==me)&&(o.directional.length=Y,o.spot.length=ue,o.rectArea.length=ne,o.point.length=ie,o.hemi.length=se,o.directionalShadow.length=le,o.directionalShadowMap.length=le,o.pointShadow.length=he,o.pointShadowMap.length=he,o.spotShadow.length=me,o.spotShadowMap.length=me,o.directionalShadowMatrix.length=le,o.pointShadowMatrix.length=he,o.spotShadowMatrix.length=me,ge.directionalLength=Y,ge.pointLength=ie,ge.spotLength=ue,ge.rectAreaLength=ne,ge.hemiLength=se,ge.numDirectionalShadows=le,ge.numPointShadows=he,ge.numSpotShadows=me,o.version=nextVersion++)}function C(I,z){let $=0,k=0,Y=0,ie=0,ue=0;const ne=z.matrixWorldInverse;for(let se=0,le=I.length;se<le;se++){const he=I[se];if(he.isDirectionalLight){const me=o.directional[$];me.direction.setFromMatrixPosition(he.matrixWorld),l.setFromMatrixPosition(he.target.matrixWorld),me.direction.sub(l),me.direction.transformDirection(ne),$++}else if(he.isSpotLight){const me=o.spot[Y];me.position.setFromMatrixPosition(he.matrixWorld),me.position.applyMatrix4(ne),me.direction.setFromMatrixPosition(he.matrixWorld),l.setFromMatrixPosition(he.target.matrixWorld),me.direction.sub(l),me.direction.transformDirection(ne),Y++}else if(he.isRectAreaLight){const me=o.rectArea[ie];me.position.setFromMatrixPosition(he.matrixWorld),me.position.applyMatrix4(ne),n.identity(),d.copy(he.matrixWorld),d.premultiply(ne),n.extractRotation(d),me.halfWidth.set(he.width*.5,0,0),me.halfHeight.set(0,he.height*.5,0),me.halfWidth.applyMatrix4(n),me.halfHeight.applyMatrix4(n),ie++}else if(he.isPointLight){const me=o.point[k];me.position.setFromMatrixPosition(he.matrixWorld),me.position.applyMatrix4(ne),k++}else if(he.isHemisphereLight){const me=o.hemi[ue];me.direction.setFromMatrixPosition(he.matrixWorld),me.direction.transformDirection(ne),me.direction.normalize(),ue++}}}return{setup:S,setupView:C,state:o}}function WebGLRenderState(e,t){const i=new WebGLLights(e,t),r=[],o=[];function l(){r.length=0,o.length=0}function d(z){r.push(z)}function n(z){o.push(z)}function S(){i.setup(r)}function C(z){i.setupView(r,z)}return{init:l,state:{lightsArray:r,shadowsArray:o,lights:i},setupLights:S,setupLightsView:C,pushLight:d,pushShadow:n}}function WebGLRenderStates(e,t){let i=new WeakMap;function r(l,d=0){let n;return i.has(l)===!1?(n=new WebGLRenderState(e,t),i.set(l,[]),i.get(l).push(n)):d>=i.get(l).length?(n=new WebGLRenderState(e,t),i.get(l).push(n)):n=i.get(l)[d],n}function o(){i=new WeakMap}return{get:r,dispose:o}}function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}MeshDepthMaterial.prototype=Object.create(Material.prototype);MeshDepthMaterial.prototype.constructor=MeshDepthMaterial;MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this};function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}MeshDistanceMaterial.prototype=Object.create(Material.prototype);MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial;MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var vsm_frag=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,vsm_vert=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function WebGLShadowMap(e,t,i){let r=new Frustum;const o=new Vector2,l=new Vector2,d=new Vector4,n=[],S=[],C={},I={0:BackSide,1:FrontSide,2:DoubleSide},z=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),$=z.clone();$.defines.HORIZONTAL_PASS=1;const k=new BufferGeometry;k.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Y=new Mesh(k,z),ie=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(me,ge,xt){if(ie.enabled===!1||ie.autoUpdate===!1&&ie.needsUpdate===!1||me.length===0)return;const Et=e.getRenderTarget(),Lt=e.getActiveCubeFace(),Zt=e.getActiveMipmapLevel(),Ht=e.state;Ht.setBlending(NoBlending),Ht.buffers.color.setClear(1,1,1,1),Ht.buffers.depth.setTest(!0),Ht.setScissorTest(!1);for(let It=0,Yt=me.length;It<Yt;It++){const ri=me[It],ei=ri.shadow;if(ei===void 0){console.warn("THREE.WebGLShadowMap:",ri,"has no shadow.");continue}if(ei.autoUpdate===!1&&ei.needsUpdate===!1)continue;o.copy(ei.mapSize);const Ct=ei.getFrameExtents();if(o.multiply(Ct),l.copy(ei.mapSize),(o.x>i||o.y>i)&&(o.x>i&&(l.x=Math.floor(i/Ct.x),o.x=l.x*Ct.x,ei.mapSize.x=l.x),o.y>i&&(l.y=Math.floor(i/Ct.y),o.y=l.y*Ct.y,ei.mapSize.y=l.y)),ei.map===null&&!ei.isPointLightShadow&&this.type===VSMShadowMap){const Mt={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};ei.map=new WebGLRenderTarget(o.x,o.y,Mt),ei.map.texture.name=ri.name+".shadowMap",ei.mapPass=new WebGLRenderTarget(o.x,o.y,Mt),ei.camera.updateProjectionMatrix()}if(ei.map===null){const Mt={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};ei.map=new WebGLRenderTarget(o.x,o.y,Mt),ei.map.texture.name=ri.name+".shadowMap",ei.camera.updateProjectionMatrix()}e.setRenderTarget(ei.map),e.clear();const Ut=ei.getViewportCount();for(let Mt=0;Mt<Ut;Mt++){const $t=ei.getViewport(Mt);d.set(l.x*$t.x,l.y*$t.y,l.x*$t.z,l.y*$t.w),Ht.viewport(d),ei.updateMatrices(ri,Mt),r=ei.getFrustum(),he(ge,xt,ei.camera,ri,this.type)}!ei.isPointLightShadow&&this.type===VSMShadowMap&&ue(ei,xt),ei.needsUpdate=!1}ie.needsUpdate=!1,e.setRenderTarget(Et,Lt,Zt)};function ue(me,ge){const xt=t.update(Y);z.uniforms.shadow_pass.value=me.map.texture,z.uniforms.resolution.value=me.mapSize,z.uniforms.radius.value=me.radius,e.setRenderTarget(me.mapPass),e.clear(),e.renderBufferDirect(ge,null,xt,z,Y,null),$.uniforms.shadow_pass.value=me.mapPass.texture,$.uniforms.resolution.value=me.mapSize,$.uniforms.radius.value=me.radius,e.setRenderTarget(me.map),e.clear(),e.renderBufferDirect(ge,null,xt,$,Y,null)}function ne(me,ge,xt){const Et=me<<0|ge<<1|xt<<2;let Lt=n[Et];return Lt===void 0&&(Lt=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:me,skinning:ge}),n[Et]=Lt),Lt}function se(me,ge,xt){const Et=me<<0|ge<<1|xt<<2;let Lt=S[Et];return Lt===void 0&&(Lt=new MeshDistanceMaterial({morphTargets:me,skinning:ge}),S[Et]=Lt),Lt}function le(me,ge,xt,Et,Lt,Zt,Ht){let It=null,Yt=ne,ri=me.customDepthMaterial;if(Et.isPointLight===!0&&(Yt=se,ri=me.customDistanceMaterial),ri===void 0){let ei=!1;xt.morphTargets===!0&&(ei=ge.morphAttributes&&ge.morphAttributes.position&&ge.morphAttributes.position.length>0);let Ct=!1;me.isSkinnedMesh===!0&&(xt.skinning===!0?Ct=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",me));const Ut=me.isInstancedMesh===!0;It=Yt(ei,Ct,Ut)}else It=ri;if(e.localClippingEnabled&&xt.clipShadows===!0&&xt.clippingPlanes.length!==0){const ei=It.uuid,Ct=xt.uuid;let Ut=C[ei];Ut===void 0&&(Ut={},C[ei]=Ut);let Mt=Ut[Ct];Mt===void 0&&(Mt=It.clone(),Ut[Ct]=Mt),It=Mt}return It.visible=xt.visible,It.wireframe=xt.wireframe,Ht===VSMShadowMap?It.side=xt.shadowSide!==null?xt.shadowSide:xt.side:It.side=xt.shadowSide!==null?xt.shadowSide:I[xt.side],It.clipShadows=xt.clipShadows,It.clippingPlanes=xt.clippingPlanes,It.clipIntersection=xt.clipIntersection,It.wireframeLinewidth=xt.wireframeLinewidth,It.linewidth=xt.linewidth,Et.isPointLight===!0&&It.isMeshDistanceMaterial===!0&&(It.referencePosition.setFromMatrixPosition(Et.matrixWorld),It.nearDistance=Lt,It.farDistance=Zt),It}function he(me,ge,xt,Et,Lt){if(me.visible===!1)return;if(me.layers.test(ge.layers)&&(me.isMesh||me.isLine||me.isPoints)&&(me.castShadow||me.receiveShadow&&Lt===VSMShadowMap)&&(!me.frustumCulled||r.intersectsObject(me))){me.modelViewMatrix.multiplyMatrices(xt.matrixWorldInverse,me.matrixWorld);const It=t.update(me),Yt=me.material;if(Array.isArray(Yt)){const ri=It.groups;for(let ei=0,Ct=ri.length;ei<Ct;ei++){const Ut=ri[ei],Mt=Yt[Ut.materialIndex];if(Mt&&Mt.visible){const $t=le(me,It,Mt,Et,xt.near,xt.far,Lt);e.renderBufferDirect(xt,null,It,$t,me,Ut)}}}else if(Yt.visible){const ri=le(me,It,Yt,Et,xt.near,xt.far,Lt);e.renderBufferDirect(xt,null,It,ri,me,null)}}const Ht=me.children;for(let It=0,Yt=Ht.length;It<Yt;It++)he(Ht[It],ge,xt,Et,Lt)}}function WebGLState(e,t,i){const r=i.isWebGL2;function o(){let xi=!1;const $i=new Vector4;let fr=null;const ir=new Vector4(0,0,0,0);return{setMask:function(lr){fr!==lr&&!xi&&(e.colorMask(lr,lr,lr,lr),fr=lr)},setLocked:function(lr){xi=lr},setClear:function(lr,Tr,Rr,Jr,_r){_r===!0&&(lr*=Jr,Tr*=Jr,Rr*=Jr),$i.set(lr,Tr,Rr,Jr),ir.equals($i)===!1&&(e.clearColor(lr,Tr,Rr,Jr),ir.copy($i))},reset:function(){xi=!1,fr=null,ir.set(-1,0,0,0)}}}function l(){let xi=!1,$i=null,fr=null,ir=null;return{setTest:function(lr){lr?jt(2929):mi(2929)},setMask:function(lr){$i!==lr&&!xi&&(e.depthMask(lr),$i=lr)},setFunc:function(lr){if(fr!==lr){if(lr)switch(lr){case NeverDepth:e.depthFunc(512);break;case AlwaysDepth:e.depthFunc(519);break;case LessDepth:e.depthFunc(513);break;case LessEqualDepth:e.depthFunc(515);break;case EqualDepth:e.depthFunc(514);break;case GreaterEqualDepth:e.depthFunc(518);break;case GreaterDepth:e.depthFunc(516);break;case NotEqualDepth:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);fr=lr}},setLocked:function(lr){xi=lr},setClear:function(lr){ir!==lr&&(e.clearDepth(lr),ir=lr)},reset:function(){xi=!1,$i=null,fr=null,ir=null}}}function d(){let xi=!1,$i=null,fr=null,ir=null,lr=null,Tr=null,Rr=null,Jr=null,_r=null;return{setTest:function(mr){xi||(mr?jt(2960):mi(2960))},setMask:function(mr){$i!==mr&&!xi&&(e.stencilMask(mr),$i=mr)},setFunc:function(mr,wr,Vr){(fr!==mr||ir!==wr||lr!==Vr)&&(e.stencilFunc(mr,wr,Vr),fr=mr,ir=wr,lr=Vr)},setOp:function(mr,wr,Vr){(Tr!==mr||Rr!==wr||Jr!==Vr)&&(e.stencilOp(mr,wr,Vr),Tr=mr,Rr=wr,Jr=Vr)},setLocked:function(mr){xi=mr},setClear:function(mr){_r!==mr&&(e.clearStencil(mr),_r=mr)},reset:function(){xi=!1,$i=null,fr=null,ir=null,lr=null,Tr=null,Rr=null,Jr=null,_r=null}}}const n=new o,S=new l,C=new d;let I={},z=null,$=null,k=null,Y=null,ie=null,ue=null,ne=null,se=null,le=null,he=!1,me=null,ge=null,xt=null,Et=null,Lt=null;const Zt=e.getParameter(35661);let Ht=!1,It=0;const Yt=e.getParameter(7938);Yt.indexOf("WebGL")!==-1?(It=parseFloat(/^WebGL (\d)/.exec(Yt)[1]),Ht=It>=1):Yt.indexOf("OpenGL ES")!==-1&&(It=parseFloat(/^OpenGL ES (\d)/.exec(Yt)[1]),Ht=It>=2);let ri=null,ei={};const Ct=new Vector4,Ut=new Vector4;function Mt(xi,$i,fr){const ir=new Uint8Array(4),lr=e.createTexture();e.bindTexture(xi,lr),e.texParameteri(xi,10241,9728),e.texParameteri(xi,10240,9728);for(let Tr=0;Tr<fr;Tr++)e.texImage2D($i+Tr,0,6408,1,1,0,6408,5121,ir);return lr}const $t={};$t[3553]=Mt(3553,3553,1),$t[34067]=Mt(34067,34069,6),n.setClear(0,0,0,1),S.setClear(1),C.setClear(0),jt(2929),S.setFunc(LessEqualDepth),Gt(!1),ui(CullFaceBack),jt(2884),nr(NoBlending);function jt(xi){I[xi]!==!0&&(e.enable(xi),I[xi]=!0)}function mi(xi){I[xi]!==!1&&(e.disable(xi),I[xi]=!1)}function Xi(xi){return z!==xi?(e.useProgram(xi),z=xi,!0):!1}const Er={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(r)Er[MinEquation]=32775,Er[MaxEquation]=32776;else{const xi=t.get("EXT_blend_minmax");xi!==null&&(Er[MinEquation]=xi.MIN_EXT,Er[MaxEquation]=xi.MAX_EXT)}const Ir={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function nr(xi,$i,fr,ir,lr,Tr,Rr,Jr){if(xi===NoBlending){$&&(mi(3042),$=!1);return}if($||(jt(3042),$=!0),xi!==CustomBlending){if(xi!==k||Jr!==he){if((Y!==AddEquation||ne!==AddEquation)&&(e.blendEquation(32774),Y=AddEquation,ne=AddEquation),Jr)switch(xi){case NormalBlending:e.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:e.blendFunc(1,1);break;case SubtractiveBlending:e.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",xi);break}else switch(xi){case NormalBlending:e.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:e.blendFunc(770,1);break;case SubtractiveBlending:e.blendFunc(0,769);break;case MultiplyBlending:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",xi);break}ie=null,ue=null,se=null,le=null,k=xi,he=Jr}return}lr=lr||$i,Tr=Tr||fr,Rr=Rr||ir,($i!==Y||lr!==ne)&&(e.blendEquationSeparate(Er[$i],Er[lr]),Y=$i,ne=lr),(fr!==ie||ir!==ue||Tr!==se||Rr!==le)&&(e.blendFuncSeparate(Ir[fr],Ir[ir],Ir[Tr],Ir[Rr]),ie=fr,ue=ir,se=Tr,le=Rr),k=xi,he=null}function si(xi,$i){xi.side===DoubleSide?mi(2884):jt(2884);let fr=xi.side===BackSide;$i&&(fr=!fr),Gt(fr),xi.blending===NormalBlending&&xi.transparent===!1?nr(NoBlending):nr(xi.blending,xi.blendEquation,xi.blendSrc,xi.blendDst,xi.blendEquationAlpha,xi.blendSrcAlpha,xi.blendDstAlpha,xi.premultipliedAlpha),S.setFunc(xi.depthFunc),S.setTest(xi.depthTest),S.setMask(xi.depthWrite),n.setMask(xi.colorWrite);const ir=xi.stencilWrite;C.setTest(ir),ir&&(C.setMask(xi.stencilWriteMask),C.setFunc(xi.stencilFunc,xi.stencilRef,xi.stencilFuncMask),C.setOp(xi.stencilFail,xi.stencilZFail,xi.stencilZPass)),Si(xi.polygonOffset,xi.polygonOffsetFactor,xi.polygonOffsetUnits)}function Gt(xi){me!==xi&&(xi?e.frontFace(2304):e.frontFace(2305),me=xi)}function ui(xi){xi!==CullFaceNone?(jt(2884),xi!==ge&&(xi===CullFaceBack?e.cullFace(1029):xi===CullFaceFront?e.cullFace(1028):e.cullFace(1032))):mi(2884),ge=xi}function oi(xi){xi!==xt&&(Ht&&e.lineWidth(xi),xt=xi)}function Si(xi,$i,fr){xi?(jt(32823),(Et!==$i||Lt!==fr)&&(e.polygonOffset($i,fr),Et=$i,Lt=fr)):mi(32823)}function Li(xi){xi?jt(3089):mi(3089)}function Mi(xi){xi===void 0&&(xi=33984+Zt-1),ri!==xi&&(e.activeTexture(xi),ri=xi)}function kt(xi,$i){ri===null&&Mi();let fr=ei[ri];fr===void 0&&(fr={type:void 0,texture:void 0},ei[ri]=fr),(fr.type!==xi||fr.texture!==$i)&&(e.bindTexture(xi,$i||$t[xi]),fr.type=xi,fr.texture=$i)}function Nt(){const xi=ei[ri];xi!==void 0&&xi.type!==void 0&&(e.bindTexture(xi.type,null),xi.type=void 0,xi.texture=void 0)}function gi(){try{e.compressedTexImage2D.apply(e,arguments)}catch(xi){console.error("THREE.WebGLState:",xi)}}function Ri(){try{e.texImage2D.apply(e,arguments)}catch(xi){console.error("THREE.WebGLState:",xi)}}function Rt(){try{e.texImage3D.apply(e,arguments)}catch(xi){console.error("THREE.WebGLState:",xi)}}function Xt(xi){Ct.equals(xi)===!1&&(e.scissor(xi.x,xi.y,xi.z,xi.w),Ct.copy(xi))}function Hi(xi){Ut.equals(xi)===!1&&(e.viewport(xi.x,xi.y,xi.z,xi.w),Ut.copy(xi))}function Ni(){I={},ri=null,ei={},z=null,$=null,k=null,Y=null,ie=null,ue=null,ne=null,se=null,le=null,he=!1,me=null,ge=null,xt=null,Et=null,Lt=null,n.reset(),S.reset(),C.reset()}return{buffers:{color:n,depth:S,stencil:C},enable:jt,disable:mi,useProgram:Xi,setBlending:nr,setMaterial:si,setFlipSided:Gt,setCullFace:ui,setLineWidth:oi,setPolygonOffset:Si,setScissorTest:Li,activeTexture:Mi,bindTexture:kt,unbindTexture:Nt,compressedTexImage2D:gi,texImage2D:Ri,texImage3D:Rt,scissor:Xt,viewport:Hi,reset:Ni}}function WebGLTextures(e,t,i,r,o,l,d){const n=o.isWebGL2,S=o.maxTextures,C=o.maxCubemapSize,I=o.maxTextureSize,z=o.maxSamples,$=new WeakMap;let k,Y=!1;try{Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ie(Rt,Xt){return Y?new OffscreenCanvas(Rt,Xt):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function ue(Rt,Xt,Hi,Ni){let xi=1;if((Rt.width>Ni||Rt.height>Ni)&&(xi=Ni/Math.max(Rt.width,Rt.height)),xi<1||Xt===!0)if(typeof HTMLImageElement<"u"&&Rt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Rt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Rt instanceof ImageBitmap){const $i=Xt?MathUtils.floorPowerOfTwo:Math.floor,fr=$i(xi*Rt.width),ir=$i(xi*Rt.height);k===void 0&&(k=ie(fr,ir));const lr=Hi?ie(fr,ir):k;return lr.width=fr,lr.height=ir,lr.getContext("2d").drawImage(Rt,0,0,fr,ir),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Rt.width+"x"+Rt.height+") to ("+fr+"x"+ir+")."),lr}else return"data"in Rt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Rt.width+"x"+Rt.height+")."),Rt;return Rt}function ne(Rt){return MathUtils.isPowerOfTwo(Rt.width)&&MathUtils.isPowerOfTwo(Rt.height)}function se(Rt){return n?!1:Rt.wrapS!==ClampToEdgeWrapping||Rt.wrapT!==ClampToEdgeWrapping||Rt.minFilter!==NearestFilter&&Rt.minFilter!==LinearFilter}function le(Rt,Xt){return Rt.generateMipmaps&&Xt&&Rt.minFilter!==NearestFilter&&Rt.minFilter!==LinearFilter}function he(Rt,Xt,Hi,Ni){e.generateMipmap(Rt);const xi=r.get(Xt);xi.__maxMipLevel=Math.log(Math.max(Hi,Ni))*Math.LOG2E}function me(Rt,Xt,Hi){if(n===!1)return Xt;if(Rt!==null){if(e[Rt]!==void 0)return e[Rt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Rt+"'")}let Ni=Xt;return Xt===6403&&(Hi===5126&&(Ni=33326),Hi===5131&&(Ni=33325),Hi===5121&&(Ni=33321)),Xt===6407&&(Hi===5126&&(Ni=34837),Hi===5131&&(Ni=34843),Hi===5121&&(Ni=32849)),Xt===6408&&(Hi===5126&&(Ni=34836),Hi===5131&&(Ni=34842),Hi===5121&&(Ni=32856)),(Ni===33325||Ni===33326||Ni===34842||Ni===34836)&&t.get("EXT_color_buffer_float"),Ni}function ge(Rt){return Rt===NearestFilter||Rt===NearestMipmapNearestFilter||Rt===NearestMipmapLinearFilter?9728:9729}function xt(Rt){const Xt=Rt.target;Xt.removeEventListener("dispose",xt),Lt(Xt),Xt.isVideoTexture&&$.delete(Xt),d.memory.textures--}function Et(Rt){const Xt=Rt.target;Xt.removeEventListener("dispose",Et),Zt(Xt),d.memory.textures--}function Lt(Rt){const Xt=r.get(Rt);Xt.__webglInit!==void 0&&(e.deleteTexture(Xt.__webglTexture),r.remove(Rt))}function Zt(Rt){const Xt=r.get(Rt),Hi=r.get(Rt.texture);if(Rt){if(Hi.__webglTexture!==void 0&&e.deleteTexture(Hi.__webglTexture),Rt.depthTexture&&Rt.depthTexture.dispose(),Rt.isWebGLCubeRenderTarget)for(let Ni=0;Ni<6;Ni++)e.deleteFramebuffer(Xt.__webglFramebuffer[Ni]),Xt.__webglDepthbuffer&&e.deleteRenderbuffer(Xt.__webglDepthbuffer[Ni]);else e.deleteFramebuffer(Xt.__webglFramebuffer),Xt.__webglDepthbuffer&&e.deleteRenderbuffer(Xt.__webglDepthbuffer),Xt.__webglMultisampledFramebuffer&&e.deleteFramebuffer(Xt.__webglMultisampledFramebuffer),Xt.__webglColorRenderbuffer&&e.deleteRenderbuffer(Xt.__webglColorRenderbuffer),Xt.__webglDepthRenderbuffer&&e.deleteRenderbuffer(Xt.__webglDepthRenderbuffer);r.remove(Rt.texture),r.remove(Rt)}}let Ht=0;function It(){Ht=0}function Yt(){const Rt=Ht;return Rt>=S&&console.warn("THREE.WebGLTextures: Trying to use "+Rt+" texture units while this GPU supports only "+S),Ht+=1,Rt}function ri(Rt,Xt){const Hi=r.get(Rt);if(Rt.isVideoTexture&&Mi(Rt),Rt.version>0&&Hi.__version!==Rt.version){const Ni=Rt.image;if(Ni===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Ni.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Xi(Hi,Rt,Xt);return}}i.activeTexture(33984+Xt),i.bindTexture(3553,Hi.__webglTexture)}function ei(Rt,Xt){const Hi=r.get(Rt);if(Rt.version>0&&Hi.__version!==Rt.version){Xi(Hi,Rt,Xt);return}i.activeTexture(33984+Xt),i.bindTexture(35866,Hi.__webglTexture)}function Ct(Rt,Xt){const Hi=r.get(Rt);if(Rt.version>0&&Hi.__version!==Rt.version){Xi(Hi,Rt,Xt);return}i.activeTexture(33984+Xt),i.bindTexture(32879,Hi.__webglTexture)}function Ut(Rt,Xt){const Hi=r.get(Rt);if(Rt.version>0&&Hi.__version!==Rt.version){Er(Hi,Rt,Xt);return}i.activeTexture(33984+Xt),i.bindTexture(34067,Hi.__webglTexture)}const Mt={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},$t={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function jt(Rt,Xt,Hi){Hi?(e.texParameteri(Rt,10242,Mt[Xt.wrapS]),e.texParameteri(Rt,10243,Mt[Xt.wrapT]),(Rt===32879||Rt===35866)&&e.texParameteri(Rt,32882,Mt[Xt.wrapR]),e.texParameteri(Rt,10240,$t[Xt.magFilter]),e.texParameteri(Rt,10241,$t[Xt.minFilter])):(e.texParameteri(Rt,10242,33071),e.texParameteri(Rt,10243,33071),(Rt===32879||Rt===35866)&&e.texParameteri(Rt,32882,33071),(Xt.wrapS!==ClampToEdgeWrapping||Xt.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(Rt,10240,ge(Xt.magFilter)),e.texParameteri(Rt,10241,ge(Xt.minFilter)),Xt.minFilter!==NearestFilter&&Xt.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const Ni=t.get("EXT_texture_filter_anisotropic");if(Ni){if(Xt.type===FloatType&&t.get("OES_texture_float_linear")===null||Xt.type===HalfFloatType&&(n||t.get("OES_texture_half_float_linear"))===null)return;(Xt.anisotropy>1||r.get(Xt).__currentAnisotropy)&&(e.texParameterf(Rt,Ni.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Xt.anisotropy,o.getMaxAnisotropy())),r.get(Xt).__currentAnisotropy=Xt.anisotropy)}}function mi(Rt,Xt){Rt.__webglInit===void 0&&(Rt.__webglInit=!0,Xt.addEventListener("dispose",xt),Rt.__webglTexture=e.createTexture(),d.memory.textures++)}function Xi(Rt,Xt,Hi){let Ni=3553;Xt.isDataTexture2DArray&&(Ni=35866),Xt.isDataTexture3D&&(Ni=32879),mi(Rt,Xt),i.activeTexture(33984+Hi),i.bindTexture(Ni,Rt.__webglTexture),e.pixelStorei(37440,Xt.flipY),e.pixelStorei(37441,Xt.premultiplyAlpha),e.pixelStorei(3317,Xt.unpackAlignment);const xi=se(Xt)&&ne(Xt.image)===!1,$i=ue(Xt.image,xi,!1,I),fr=ne($i)||n,ir=l.convert(Xt.format);let lr=l.convert(Xt.type),Tr=me(Xt.internalFormat,ir,lr);jt(Ni,Xt,fr);let Rr;const Jr=Xt.mipmaps;if(Xt.isDepthTexture)Tr=6402,n?Xt.type===FloatType?Tr=36012:Xt.type===UnsignedIntType?Tr=33190:Xt.type===UnsignedInt248Type?Tr=35056:Tr=33189:Xt.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Xt.format===DepthFormat&&Tr===6402&&Xt.type!==UnsignedShortType&&Xt.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Xt.type=UnsignedShortType,lr=l.convert(Xt.type)),Xt.format===DepthStencilFormat&&Tr===6402&&(Tr=34041,Xt.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Xt.type=UnsignedInt248Type,lr=l.convert(Xt.type))),i.texImage2D(3553,0,Tr,$i.width,$i.height,0,ir,lr,null);else if(Xt.isDataTexture)if(Jr.length>0&&fr){for(let _r=0,mr=Jr.length;_r<mr;_r++)Rr=Jr[_r],i.texImage2D(3553,_r,Tr,Rr.width,Rr.height,0,ir,lr,Rr.data);Xt.generateMipmaps=!1,Rt.__maxMipLevel=Jr.length-1}else i.texImage2D(3553,0,Tr,$i.width,$i.height,0,ir,lr,$i.data),Rt.__maxMipLevel=0;else if(Xt.isCompressedTexture){for(let _r=0,mr=Jr.length;_r<mr;_r++)Rr=Jr[_r],Xt.format!==RGBAFormat&&Xt.format!==RGBFormat?ir!==null?i.compressedTexImage2D(3553,_r,Tr,Rr.width,Rr.height,0,Rr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,_r,Tr,Rr.width,Rr.height,0,ir,lr,Rr.data);Rt.__maxMipLevel=Jr.length-1}else if(Xt.isDataTexture2DArray)i.texImage3D(35866,0,Tr,$i.width,$i.height,$i.depth,0,ir,lr,$i.data),Rt.__maxMipLevel=0;else if(Xt.isDataTexture3D)i.texImage3D(32879,0,Tr,$i.width,$i.height,$i.depth,0,ir,lr,$i.data),Rt.__maxMipLevel=0;else if(Jr.length>0&&fr){for(let _r=0,mr=Jr.length;_r<mr;_r++)Rr=Jr[_r],i.texImage2D(3553,_r,Tr,ir,lr,Rr);Xt.generateMipmaps=!1,Rt.__maxMipLevel=Jr.length-1}else i.texImage2D(3553,0,Tr,ir,lr,$i),Rt.__maxMipLevel=0;le(Xt,fr)&&he(Ni,Xt,$i.width,$i.height),Rt.__version=Xt.version,Xt.onUpdate&&Xt.onUpdate(Xt)}function Er(Rt,Xt,Hi){if(Xt.image.length!==6)return;mi(Rt,Xt),i.activeTexture(33984+Hi),i.bindTexture(34067,Rt.__webglTexture),e.pixelStorei(37440,Xt.flipY);const Ni=Xt&&(Xt.isCompressedTexture||Xt.image[0].isCompressedTexture),xi=Xt.image[0]&&Xt.image[0].isDataTexture,$i=[];for(let _r=0;_r<6;_r++)!Ni&&!xi?$i[_r]=ue(Xt.image[_r],!1,!0,C):$i[_r]=xi?Xt.image[_r].image:Xt.image[_r];const fr=$i[0],ir=ne(fr)||n,lr=l.convert(Xt.format),Tr=l.convert(Xt.type),Rr=me(Xt.internalFormat,lr,Tr);jt(34067,Xt,ir);let Jr;if(Ni){for(let _r=0;_r<6;_r++){Jr=$i[_r].mipmaps;for(let mr=0;mr<Jr.length;mr++){const wr=Jr[mr];Xt.format!==RGBAFormat&&Xt.format!==RGBFormat?lr!==null?i.compressedTexImage2D(34069+_r,mr,Rr,wr.width,wr.height,0,wr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+_r,mr,Rr,wr.width,wr.height,0,lr,Tr,wr.data)}}Rt.__maxMipLevel=Jr.length-1}else{Jr=Xt.mipmaps;for(let _r=0;_r<6;_r++)if(xi){i.texImage2D(34069+_r,0,Rr,$i[_r].width,$i[_r].height,0,lr,Tr,$i[_r].data);for(let mr=0;mr<Jr.length;mr++){const Vr=Jr[mr].image[_r].image;i.texImage2D(34069+_r,mr+1,Rr,Vr.width,Vr.height,0,lr,Tr,Vr.data)}}else{i.texImage2D(34069+_r,0,Rr,lr,Tr,$i[_r]);for(let mr=0;mr<Jr.length;mr++){const wr=Jr[mr];i.texImage2D(34069+_r,mr+1,Rr,lr,Tr,wr.image[_r])}}Rt.__maxMipLevel=Jr.length}le(Xt,ir)&&he(34067,Xt,fr.width,fr.height),Rt.__version=Xt.version,Xt.onUpdate&&Xt.onUpdate(Xt)}function Ir(Rt,Xt,Hi,Ni){const xi=l.convert(Xt.texture.format),$i=l.convert(Xt.texture.type),fr=me(Xt.texture.internalFormat,xi,$i);i.texImage2D(Ni,0,fr,Xt.width,Xt.height,0,xi,$i,null),e.bindFramebuffer(36160,Rt),e.framebufferTexture2D(36160,Hi,Ni,r.get(Xt.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function nr(Rt,Xt,Hi){if(e.bindRenderbuffer(36161,Rt),Xt.depthBuffer&&!Xt.stencilBuffer){let Ni=33189;if(Hi){const xi=Xt.depthTexture;xi&&xi.isDepthTexture&&(xi.type===FloatType?Ni=36012:xi.type===UnsignedIntType&&(Ni=33190));const $i=Li(Xt);e.renderbufferStorageMultisample(36161,$i,Ni,Xt.width,Xt.height)}else e.renderbufferStorage(36161,Ni,Xt.width,Xt.height);e.framebufferRenderbuffer(36160,36096,36161,Rt)}else if(Xt.depthBuffer&&Xt.stencilBuffer){if(Hi){const Ni=Li(Xt);e.renderbufferStorageMultisample(36161,Ni,35056,Xt.width,Xt.height)}else e.renderbufferStorage(36161,34041,Xt.width,Xt.height);e.framebufferRenderbuffer(36160,33306,36161,Rt)}else{const Ni=l.convert(Xt.texture.format),xi=l.convert(Xt.texture.type),$i=me(Xt.texture.internalFormat,Ni,xi);if(Hi){const fr=Li(Xt);e.renderbufferStorageMultisample(36161,fr,$i,Xt.width,Xt.height)}else e.renderbufferStorage(36161,$i,Xt.width,Xt.height)}e.bindRenderbuffer(36161,null)}function si(Rt,Xt){if(Xt&&Xt.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,Rt),!(Xt.depthTexture&&Xt.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Xt.depthTexture).__webglTexture||Xt.depthTexture.image.width!==Xt.width||Xt.depthTexture.image.height!==Xt.height)&&(Xt.depthTexture.image.width=Xt.width,Xt.depthTexture.image.height=Xt.height,Xt.depthTexture.needsUpdate=!0),ri(Xt.depthTexture,0);const Ni=r.get(Xt.depthTexture).__webglTexture;if(Xt.depthTexture.format===DepthFormat)e.framebufferTexture2D(36160,36096,3553,Ni,0);else if(Xt.depthTexture.format===DepthStencilFormat)e.framebufferTexture2D(36160,33306,3553,Ni,0);else throw new Error("Unknown depthTexture format")}function Gt(Rt){const Xt=r.get(Rt),Hi=Rt.isWebGLCubeRenderTarget===!0;if(Rt.depthTexture){if(Hi)throw new Error("target.depthTexture not supported in Cube render targets");si(Xt.__webglFramebuffer,Rt)}else if(Hi){Xt.__webglDepthbuffer=[];for(let Ni=0;Ni<6;Ni++)e.bindFramebuffer(36160,Xt.__webglFramebuffer[Ni]),Xt.__webglDepthbuffer[Ni]=e.createRenderbuffer(),nr(Xt.__webglDepthbuffer[Ni],Rt,!1)}else e.bindFramebuffer(36160,Xt.__webglFramebuffer),Xt.__webglDepthbuffer=e.createRenderbuffer(),nr(Xt.__webglDepthbuffer,Rt,!1);e.bindFramebuffer(36160,null)}function ui(Rt){const Xt=r.get(Rt),Hi=r.get(Rt.texture);Rt.addEventListener("dispose",Et),Hi.__webglTexture=e.createTexture(),d.memory.textures++;const Ni=Rt.isWebGLCubeRenderTarget===!0,xi=Rt.isWebGLMultisampleRenderTarget===!0,$i=ne(Rt)||n;if(n&&Rt.texture.format===RGBFormat&&(Rt.texture.type===FloatType||Rt.texture.type===HalfFloatType)&&(Rt.texture.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Ni){Xt.__webglFramebuffer=[];for(let fr=0;fr<6;fr++)Xt.__webglFramebuffer[fr]=e.createFramebuffer()}else if(Xt.__webglFramebuffer=e.createFramebuffer(),xi)if(n){Xt.__webglMultisampledFramebuffer=e.createFramebuffer(),Xt.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,Xt.__webglColorRenderbuffer);const fr=l.convert(Rt.texture.format),ir=l.convert(Rt.texture.type),lr=me(Rt.texture.internalFormat,fr,ir),Tr=Li(Rt);e.renderbufferStorageMultisample(36161,Tr,lr,Rt.width,Rt.height),e.bindFramebuffer(36160,Xt.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,Xt.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),Rt.depthBuffer&&(Xt.__webglDepthRenderbuffer=e.createRenderbuffer(),nr(Xt.__webglDepthRenderbuffer,Rt,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Ni){i.bindTexture(34067,Hi.__webglTexture),jt(34067,Rt.texture,$i);for(let fr=0;fr<6;fr++)Ir(Xt.__webglFramebuffer[fr],Rt,36064,34069+fr);le(Rt.texture,$i)&&he(34067,Rt.texture,Rt.width,Rt.height),i.bindTexture(34067,null)}else i.bindTexture(3553,Hi.__webglTexture),jt(3553,Rt.texture,$i),Ir(Xt.__webglFramebuffer,Rt,36064,3553),le(Rt.texture,$i)&&he(3553,Rt.texture,Rt.width,Rt.height),i.bindTexture(3553,null);Rt.depthBuffer&&Gt(Rt)}function oi(Rt){const Xt=Rt.texture,Hi=ne(Rt)||n;if(le(Xt,Hi)){const Ni=Rt.isWebGLCubeRenderTarget?34067:3553,xi=r.get(Xt).__webglTexture;i.bindTexture(Ni,xi),he(Ni,Xt,Rt.width,Rt.height),i.bindTexture(Ni,null)}}function Si(Rt){if(Rt.isWebGLMultisampleRenderTarget)if(n){const Xt=r.get(Rt);e.bindFramebuffer(36008,Xt.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,Xt.__webglFramebuffer);const Hi=Rt.width,Ni=Rt.height;let xi=16384;Rt.depthBuffer&&(xi|=256),Rt.stencilBuffer&&(xi|=1024),e.blitFramebuffer(0,0,Hi,Ni,0,0,Hi,Ni,xi,9728),e.bindFramebuffer(36160,Xt.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Li(Rt){return n&&Rt.isWebGLMultisampleRenderTarget?Math.min(z,Rt.samples):0}function Mi(Rt){const Xt=d.render.frame;$.get(Rt)!==Xt&&($.set(Rt,Xt),Rt.update())}let kt=!1,Nt=!1;function gi(Rt,Xt){Rt&&Rt.isWebGLRenderTarget&&(kt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),kt=!0),Rt=Rt.texture),ri(Rt,Xt)}function Ri(Rt,Xt){Rt&&Rt.isWebGLCubeRenderTarget&&(Nt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Nt=!0),Rt=Rt.texture),Ut(Rt,Xt)}this.allocateTextureUnit=Yt,this.resetTextureUnits=It,this.setTexture2D=ri,this.setTexture2DArray=ei,this.setTexture3D=Ct,this.setTextureCube=Ut,this.setupRenderTarget=ui,this.updateRenderTargetMipmap=oi,this.updateMultisampleRenderTarget=Si,this.safeSetTexture2D=gi,this.safeSetTextureCube=Ri}function WebGLUtils(e,t,i){const r=i.isWebGL2;function o(l){let d;if(l===UnsignedByteType)return 5121;if(l===UnsignedShort4444Type)return 32819;if(l===UnsignedShort5551Type)return 32820;if(l===UnsignedShort565Type)return 33635;if(l===ByteType)return 5120;if(l===ShortType)return 5122;if(l===UnsignedShortType)return 5123;if(l===IntType)return 5124;if(l===UnsignedIntType)return 5125;if(l===FloatType)return 5126;if(l===HalfFloatType)return r?5131:(d=t.get("OES_texture_half_float"),d!==null?d.HALF_FLOAT_OES:null);if(l===AlphaFormat)return 6406;if(l===RGBFormat)return 6407;if(l===RGBAFormat)return 6408;if(l===LuminanceFormat)return 6409;if(l===LuminanceAlphaFormat)return 6410;if(l===DepthFormat)return 6402;if(l===DepthStencilFormat)return 34041;if(l===RedFormat)return 6403;if(l===RedIntegerFormat)return 36244;if(l===RGFormat)return 33319;if(l===RGIntegerFormat)return 33320;if(l===RGBIntegerFormat)return 36248;if(l===RGBAIntegerFormat)return 36249;if(l===RGB_S3TC_DXT1_Format||l===RGBA_S3TC_DXT1_Format||l===RGBA_S3TC_DXT3_Format||l===RGBA_S3TC_DXT5_Format)if(d=t.get("WEBGL_compressed_texture_s3tc"),d!==null){if(l===RGB_S3TC_DXT1_Format)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(l===RGBA_S3TC_DXT1_Format)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(l===RGBA_S3TC_DXT3_Format)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(l===RGBA_S3TC_DXT5_Format)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(l===RGB_PVRTC_4BPPV1_Format||l===RGB_PVRTC_2BPPV1_Format||l===RGBA_PVRTC_4BPPV1_Format||l===RGBA_PVRTC_2BPPV1_Format)if(d=t.get("WEBGL_compressed_texture_pvrtc"),d!==null){if(l===RGB_PVRTC_4BPPV1_Format)return d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(l===RGB_PVRTC_2BPPV1_Format)return d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(l===RGBA_PVRTC_4BPPV1_Format)return d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(l===RGBA_PVRTC_2BPPV1_Format)return d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(l===RGB_ETC1_Format)return d=t.get("WEBGL_compressed_texture_etc1"),d!==null?d.COMPRESSED_RGB_ETC1_WEBGL:null;if((l===RGB_ETC2_Format||l===RGBA_ETC2_EAC_Format)&&(d=t.get("WEBGL_compressed_texture_etc"),d!==null)){if(l===RGB_ETC2_Format)return d.COMPRESSED_RGB8_ETC2;if(l===RGBA_ETC2_EAC_Format)return d.COMPRESSED_RGBA8_ETC2_EAC}if(l===RGBA_ASTC_4x4_Format||l===RGBA_ASTC_5x4_Format||l===RGBA_ASTC_5x5_Format||l===RGBA_ASTC_6x5_Format||l===RGBA_ASTC_6x6_Format||l===RGBA_ASTC_8x5_Format||l===RGBA_ASTC_8x6_Format||l===RGBA_ASTC_8x8_Format||l===RGBA_ASTC_10x5_Format||l===RGBA_ASTC_10x6_Format||l===RGBA_ASTC_10x8_Format||l===RGBA_ASTC_10x10_Format||l===RGBA_ASTC_12x10_Format||l===RGBA_ASTC_12x12_Format||l===SRGB8_ALPHA8_ASTC_4x4_Format||l===SRGB8_ALPHA8_ASTC_5x4_Format||l===SRGB8_ALPHA8_ASTC_5x5_Format||l===SRGB8_ALPHA8_ASTC_6x5_Format||l===SRGB8_ALPHA8_ASTC_6x6_Format||l===SRGB8_ALPHA8_ASTC_8x5_Format||l===SRGB8_ALPHA8_ASTC_8x6_Format||l===SRGB8_ALPHA8_ASTC_8x8_Format||l===SRGB8_ALPHA8_ASTC_10x5_Format||l===SRGB8_ALPHA8_ASTC_10x6_Format||l===SRGB8_ALPHA8_ASTC_10x8_Format||l===SRGB8_ALPHA8_ASTC_10x10_Format||l===SRGB8_ALPHA8_ASTC_12x10_Format||l===SRGB8_ALPHA8_ASTC_12x12_Format)return d=t.get("WEBGL_compressed_texture_astc"),d!==null?l:null;if(l===RGBA_BPTC_Format)return d=t.get("EXT_texture_compression_bptc"),d!==null?l:null;if(l===UnsignedInt248Type)return r?34042:(d=t.get("WEBGL_depth_texture"),d!==null?d.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:o}}function ArrayCamera(e=[]){PerspectiveCamera.call(this),this.cameras=e}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0});function Group(){Object3D.call(this),this.type="Group"}Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0});function WebXRController(){this._targetRay=null,this._grip=null,this._hand=null}Object.assign(WebXRController.prototype,{constructor:WebXRController,getHandSpace:function(){if(this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){const t=new Group;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(e,t,i){let r=null,o=null,l=null;const d=this._targetRay,n=this._grip,S=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(S&&e.hand){l=!0;for(let C=0;C<=window.XRHand.LITTLE_PHALANX_TIP;C++)if(e.hand[C]){const I=t.getJointPose(e.hand[C],i),z=S.joints[C];I!==null&&(z.matrix.fromArray(I.transform.matrix),z.matrix.decompose(z.position,z.rotation,z.scale),z.jointRadius=I.radius),z.visible=I!==null;const $=S.joints[window.XRHand.INDEX_PHALANX_TIP],k=S.joints[window.XRHand.THUMB_PHALANX_TIP],Y=$.position.distanceTo(k.position),ie=.02,ue=.005;S.inputState.pinching&&Y>ie+ue?(S.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!S.inputState.pinching&&Y<=ie-ue&&(S.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else d!==null&&(r=t.getPose(e.targetRaySpace,i),r!==null&&(d.matrix.fromArray(r.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale))),n!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),o!==null&&(n.matrix.fromArray(o.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale)));return d!==null&&(d.visible=r!==null),n!==null&&(n.visible=o!==null),S!==null&&(S.visible=l!==null),this}});function WebXRManager(e,t){const i=this;let r=null,o=1,l=null,d="local-floor",n=null;const S=[],C=new Map,I=new PerspectiveCamera;I.layers.enable(1),I.viewport=new Vector4;const z=new PerspectiveCamera;z.layers.enable(2),z.viewport=new Vector4;const $=[I,z],k=new ArrayCamera;k.layers.enable(1),k.layers.enable(2);let Y=null,ie=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(Ht){let It=S[Ht];return It===void 0&&(It=new WebXRController,S[Ht]=It),It.getTargetRaySpace()},this.getControllerGrip=function(Ht){let It=S[Ht];return It===void 0&&(It=new WebXRController,S[Ht]=It),It.getGripSpace()},this.getHand=function(Ht){let It=S[Ht];return It===void 0&&(It=new WebXRController,S[Ht]=It),It.getHandSpace()};function ue(Ht){const It=C.get(Ht.inputSource);It&&It.dispatchEvent({type:Ht.type,data:Ht.inputSource})}function ne(){C.forEach(function(Ht,It){Ht.disconnect(It)}),C.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),Zt.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function se(Ht){l=Ht,Zt.setContext(r),Zt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(Ht){o=Ht,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ht){d=Ht,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getSession=function(){return r},this.setSession=function(Ht){if(r=Ht,r!==null){r.addEventListener("select",ue),r.addEventListener("selectstart",ue),r.addEventListener("selectend",ue),r.addEventListener("squeeze",ue),r.addEventListener("squeezestart",ue),r.addEventListener("squeezeend",ue),r.addEventListener("end",ne);const It=t.getContextAttributes();It.xrCompatible!==!0&&t.makeXRCompatible();const Yt={antialias:It.antialias,alpha:It.alpha,depth:It.depth,stencil:It.stencil,framebufferScaleFactor:o},ri=new XRWebGLLayer(r,t,Yt);r.updateRenderState({baseLayer:ri}),r.requestReferenceSpace(d).then(se),r.addEventListener("inputsourceschange",le)}};function le(Ht){const It=r.inputSources;for(let Yt=0;Yt<S.length;Yt++)C.set(It[Yt],S[Yt]);for(let Yt=0;Yt<Ht.removed.length;Yt++){const ri=Ht.removed[Yt],ei=C.get(ri);ei&&(ei.dispatchEvent({type:"disconnected",data:ri}),C.delete(ri))}for(let Yt=0;Yt<Ht.added.length;Yt++){const ri=Ht.added[Yt],ei=C.get(ri);ei&&ei.dispatchEvent({type:"connected",data:ri})}}const he=new Vector3,me=new Vector3;function ge(Ht,It,Yt){he.setFromMatrixPosition(It.matrixWorld),me.setFromMatrixPosition(Yt.matrixWorld);const ri=he.distanceTo(me),ei=It.projectionMatrix.elements,Ct=Yt.projectionMatrix.elements,Ut=ei[14]/(ei[10]-1),Mt=ei[14]/(ei[10]+1),$t=(ei[9]+1)/ei[5],jt=(ei[9]-1)/ei[5],mi=(ei[8]-1)/ei[0],Xi=(Ct[8]+1)/Ct[0],Er=Ut*mi,Ir=Ut*Xi,nr=ri/(-mi+Xi),si=nr*-mi;It.matrixWorld.decompose(Ht.position,Ht.quaternion,Ht.scale),Ht.translateX(si),Ht.translateZ(nr),Ht.matrixWorld.compose(Ht.position,Ht.quaternion,Ht.scale),Ht.matrixWorldInverse.copy(Ht.matrixWorld).invert();const Gt=Ut+nr,ui=Mt+nr,oi=Er-si,Si=Ir+(ri-si),Li=$t*Mt/ui*Gt,Mi=jt*Mt/ui*Gt;Ht.projectionMatrix.makePerspective(oi,Si,Li,Mi,Gt,ui)}function xt(Ht,It){It===null?Ht.matrixWorld.copy(Ht.matrix):Ht.matrixWorld.multiplyMatrices(It.matrixWorld,Ht.matrix),Ht.matrixWorldInverse.copy(Ht.matrixWorld).invert()}this.getCamera=function(Ht){k.near=z.near=I.near=Ht.near,k.far=z.far=I.far=Ht.far,(Y!==k.near||ie!==k.far)&&(r.updateRenderState({depthNear:k.near,depthFar:k.far}),Y=k.near,ie=k.far);const It=Ht.parent,Yt=k.cameras;xt(k,It);for(let ei=0;ei<Yt.length;ei++)xt(Yt[ei],It);Ht.matrixWorld.copy(k.matrixWorld);const ri=Ht.children;for(let ei=0,Ct=ri.length;ei<Ct;ei++)ri[ei].updateMatrixWorld(!0);return Yt.length===2?ge(k,I,z):k.projectionMatrix.copy(I.projectionMatrix),k};let Et=null;function Lt(Ht,It){if(n=It.getViewerPose(l),n!==null){const ri=n.views,ei=r.renderState.baseLayer;e.setFramebuffer(ei.framebuffer);let Ct=!1;ri.length!==k.cameras.length&&(k.cameras.length=0,Ct=!0);for(let Ut=0;Ut<ri.length;Ut++){const Mt=ri[Ut],$t=ei.getViewport(Mt),jt=$[Ut];jt.matrix.fromArray(Mt.transform.matrix),jt.projectionMatrix.fromArray(Mt.projectionMatrix),jt.viewport.set($t.x,$t.y,$t.width,$t.height),Ut===0&&k.matrix.copy(jt.matrix),Ct===!0&&k.cameras.push(jt)}}const Yt=r.inputSources;for(let ri=0;ri<S.length;ri++){const ei=S[ri],Ct=Yt[ri];ei.update(Ct,It,l)}Et&&Et(Ht,It)}const Zt=new WebGLAnimation;Zt.setAnimationLoop(Lt),this.setAnimationLoop=function(Ht){Et=Ht},this.dispose=function(){}}Object.assign(WebXRManager.prototype,EventDispatcher.prototype);function WebGLMaterials(e){function t(ne,se){ne.fogColor.value.copy(se.color),se.isFog?(ne.fogNear.value=se.near,ne.fogFar.value=se.far):se.isFogExp2&&(ne.fogDensity.value=se.density)}function i(ne,se,le,he){se.isMeshBasicMaterial?r(ne,se):se.isMeshLambertMaterial?(r(ne,se),S(ne,se)):se.isMeshToonMaterial?(r(ne,se),I(ne,se)):se.isMeshPhongMaterial?(r(ne,se),C(ne,se)):se.isMeshStandardMaterial?(r(ne,se),se.isMeshPhysicalMaterial?$(ne,se):z(ne,se)):se.isMeshMatcapMaterial?(r(ne,se),k(ne,se)):se.isMeshDepthMaterial?(r(ne,se),Y(ne,se)):se.isMeshDistanceMaterial?(r(ne,se),ie(ne,se)):se.isMeshNormalMaterial?(r(ne,se),ue(ne,se)):se.isLineBasicMaterial?(o(ne,se),se.isLineDashedMaterial&&l(ne,se)):se.isPointsMaterial?d(ne,se,le,he):se.isSpriteMaterial?n(ne,se):se.isShadowMaterial?(ne.color.value.copy(se.color),ne.opacity.value=se.opacity):se.isShaderMaterial&&(se.uniformsNeedUpdate=!1)}function r(ne,se){ne.opacity.value=se.opacity,se.color&&ne.diffuse.value.copy(se.color),se.emissive&&ne.emissive.value.copy(se.emissive).multiplyScalar(se.emissiveIntensity),se.map&&(ne.map.value=se.map),se.alphaMap&&(ne.alphaMap.value=se.alphaMap),se.specularMap&&(ne.specularMap.value=se.specularMap);const le=e.get(se).envMap;if(le){ne.envMap.value=le,ne.flipEnvMap.value=le.isCubeTexture&&le._needsFlipEnvMap?-1:1,ne.reflectivity.value=se.reflectivity,ne.refractionRatio.value=se.refractionRatio;const ge=e.get(le).__maxMipLevel;ge!==void 0&&(ne.maxMipLevel.value=ge)}se.lightMap&&(ne.lightMap.value=se.lightMap,ne.lightMapIntensity.value=se.lightMapIntensity),se.aoMap&&(ne.aoMap.value=se.aoMap,ne.aoMapIntensity.value=se.aoMapIntensity);let he;se.map?he=se.map:se.specularMap?he=se.specularMap:se.displacementMap?he=se.displacementMap:se.normalMap?he=se.normalMap:se.bumpMap?he=se.bumpMap:se.roughnessMap?he=se.roughnessMap:se.metalnessMap?he=se.metalnessMap:se.alphaMap?he=se.alphaMap:se.emissiveMap?he=se.emissiveMap:se.clearcoatMap?he=se.clearcoatMap:se.clearcoatNormalMap?he=se.clearcoatNormalMap:se.clearcoatRoughnessMap&&(he=se.clearcoatRoughnessMap),he!==void 0&&(he.isWebGLRenderTarget&&(he=he.texture),he.matrixAutoUpdate===!0&&he.updateMatrix(),ne.uvTransform.value.copy(he.matrix));let me;se.aoMap?me=se.aoMap:se.lightMap&&(me=se.lightMap),me!==void 0&&(me.isWebGLRenderTarget&&(me=me.texture),me.matrixAutoUpdate===!0&&me.updateMatrix(),ne.uv2Transform.value.copy(me.matrix))}function o(ne,se){ne.diffuse.value.copy(se.color),ne.opacity.value=se.opacity}function l(ne,se){ne.dashSize.value=se.dashSize,ne.totalSize.value=se.dashSize+se.gapSize,ne.scale.value=se.scale}function d(ne,se,le,he){ne.diffuse.value.copy(se.color),ne.opacity.value=se.opacity,ne.size.value=se.size*le,ne.scale.value=he*.5,se.map&&(ne.map.value=se.map),se.alphaMap&&(ne.alphaMap.value=se.alphaMap);let me;se.map?me=se.map:se.alphaMap&&(me=se.alphaMap),me!==void 0&&(me.matrixAutoUpdate===!0&&me.updateMatrix(),ne.uvTransform.value.copy(me.matrix))}function n(ne,se){ne.diffuse.value.copy(se.color),ne.opacity.value=se.opacity,ne.rotation.value=se.rotation,se.map&&(ne.map.value=se.map),se.alphaMap&&(ne.alphaMap.value=se.alphaMap);let le;se.map?le=se.map:se.alphaMap&&(le=se.alphaMap),le!==void 0&&(le.matrixAutoUpdate===!0&&le.updateMatrix(),ne.uvTransform.value.copy(le.matrix))}function S(ne,se){se.emissiveMap&&(ne.emissiveMap.value=se.emissiveMap)}function C(ne,se){ne.specular.value.copy(se.specular),ne.shininess.value=Math.max(se.shininess,1e-4),se.emissiveMap&&(ne.emissiveMap.value=se.emissiveMap),se.bumpMap&&(ne.bumpMap.value=se.bumpMap,ne.bumpScale.value=se.bumpScale,se.side===BackSide&&(ne.bumpScale.value*=-1)),se.normalMap&&(ne.normalMap.value=se.normalMap,ne.normalScale.value.copy(se.normalScale),se.side===BackSide&&ne.normalScale.value.negate()),se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias)}function I(ne,se){se.gradientMap&&(ne.gradientMap.value=se.gradientMap),se.emissiveMap&&(ne.emissiveMap.value=se.emissiveMap),se.bumpMap&&(ne.bumpMap.value=se.bumpMap,ne.bumpScale.value=se.bumpScale,se.side===BackSide&&(ne.bumpScale.value*=-1)),se.normalMap&&(ne.normalMap.value=se.normalMap,ne.normalScale.value.copy(se.normalScale),se.side===BackSide&&ne.normalScale.value.negate()),se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias)}function z(ne,se){ne.roughness.value=se.roughness,ne.metalness.value=se.metalness,se.roughnessMap&&(ne.roughnessMap.value=se.roughnessMap),se.metalnessMap&&(ne.metalnessMap.value=se.metalnessMap),se.emissiveMap&&(ne.emissiveMap.value=se.emissiveMap),se.bumpMap&&(ne.bumpMap.value=se.bumpMap,ne.bumpScale.value=se.bumpScale,se.side===BackSide&&(ne.bumpScale.value*=-1)),se.normalMap&&(ne.normalMap.value=se.normalMap,ne.normalScale.value.copy(se.normalScale),se.side===BackSide&&ne.normalScale.value.negate()),se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias),e.get(se).envMap&&(ne.envMapIntensity.value=se.envMapIntensity)}function $(ne,se){z(ne,se),ne.reflectivity.value=se.reflectivity,ne.clearcoat.value=se.clearcoat,ne.clearcoatRoughness.value=se.clearcoatRoughness,se.sheen&&ne.sheen.value.copy(se.sheen),se.clearcoatMap&&(ne.clearcoatMap.value=se.clearcoatMap),se.clearcoatRoughnessMap&&(ne.clearcoatRoughnessMap.value=se.clearcoatRoughnessMap),se.clearcoatNormalMap&&(ne.clearcoatNormalScale.value.copy(se.clearcoatNormalScale),ne.clearcoatNormalMap.value=se.clearcoatNormalMap,se.side===BackSide&&ne.clearcoatNormalScale.value.negate()),ne.transmission.value=se.transmission,se.transmissionMap&&(ne.transmissionMap.value=se.transmissionMap)}function k(ne,se){se.matcap&&(ne.matcap.value=se.matcap),se.bumpMap&&(ne.bumpMap.value=se.bumpMap,ne.bumpScale.value=se.bumpScale,se.side===BackSide&&(ne.bumpScale.value*=-1)),se.normalMap&&(ne.normalMap.value=se.normalMap,ne.normalScale.value.copy(se.normalScale),se.side===BackSide&&ne.normalScale.value.negate()),se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias)}function Y(ne,se){se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias)}function ie(ne,se){se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias),ne.referencePosition.value.copy(se.referencePosition),ne.nearDistance.value=se.nearDistance,ne.farDistance.value=se.farDistance}function ue(ne,se){se.bumpMap&&(ne.bumpMap.value=se.bumpMap,ne.bumpScale.value=se.bumpScale,se.side===BackSide&&(ne.bumpScale.value*=-1)),se.normalMap&&(ne.normalMap.value=se.normalMap,ne.normalScale.value.copy(se.normalScale),se.side===BackSide&&ne.normalScale.value.negate()),se.displacementMap&&(ne.displacementMap.value=se.displacementMap,ne.displacementScale.value=se.displacementScale,ne.displacementBias.value=se.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:i}}function createCanvasElement(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}function WebGLRenderer(e){e=e||{};const t=e.canvas!==void 0?e.canvas:createCanvasElement(),i=e.context!==void 0?e.context:null,r=e.alpha!==void 0?e.alpha:!1,o=e.depth!==void 0?e.depth:!0,l=e.stencil!==void 0?e.stencil:!0,d=e.antialias!==void 0?e.antialias:!1,n=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,S=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,C=e.powerPreference!==void 0?e.powerPreference:"default",I=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1;let z=null,$=null;const k=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const Y=this;let ie=!1,ue=null,ne=0,se=0,le=null,he=null,me=-1,ge=null;const xt=new Vector4,Et=new Vector4;let Lt=null,Zt=t.width,Ht=t.height,It=1,Yt=null,ri=null;const ei=new Vector4(0,0,Zt,Ht),Ct=new Vector4(0,0,Zt,Ht);let Ut=!1;const Mt=new Frustum;let $t=!1,jt=!1;const mi=new Matrix4,Xi=new Vector3,Er={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ir(){return le===null?It:1}let nr=i;function si(pi,Ii){for(let Ai=0;Ai<pi.length;Ai++){const ii=pi[Ai],wt=t.getContext(ii,Ii);if(wt!==null)return wt}return null}try{const pi={alpha:r,depth:o,stencil:l,antialias:d,premultipliedAlpha:n,preserveDrawingBuffer:S,powerPreference:C,failIfMajorPerformanceCaveat:I};if(t.addEventListener("webglcontextlost",wr,!1),t.addEventListener("webglcontextrestored",Vr,!1),nr===null){const Ii=["webgl2","webgl","experimental-webgl"];if(Y.isWebGL1Renderer===!0&&Ii.shift(),nr=si(Ii,pi),nr===null)throw si(Ii)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}nr.getShaderPrecisionFormat===void 0&&(nr.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(pi){throw console.error("THREE.WebGLRenderer: "+pi.message),pi}let Gt,ui,oi,Si,Li,Mi,kt,Nt,gi,Ri,Rt,Xt,Hi,Ni,xi,$i,fr,ir,lr,Tr,Rr;function Jr(){Gt=new WebGLExtensions(nr),ui=new WebGLCapabilities(nr,Gt,e),ui.isWebGL2===!1&&(Gt.get("WEBGL_depth_texture"),Gt.get("OES_texture_float"),Gt.get("OES_texture_half_float"),Gt.get("OES_texture_half_float_linear"),Gt.get("OES_standard_derivatives"),Gt.get("OES_element_index_uint"),Gt.get("OES_vertex_array_object"),Gt.get("ANGLE_instanced_arrays")),Gt.get("OES_texture_float_linear"),Tr=new WebGLUtils(nr,Gt,ui),oi=new WebGLState(nr,Gt,ui),oi.scissor(Et.copy(Ct).multiplyScalar(It).floor()),oi.viewport(xt.copy(ei).multiplyScalar(It).floor()),Si=new WebGLInfo,Li=new WebGLProperties,Mi=new WebGLTextures(nr,Gt,oi,Li,ui,Tr,Si),kt=new WebGLCubeMaps(Y),Nt=new WebGLAttributes(nr,ui),Rr=new WebGLBindingStates(nr,Gt,Nt,ui),gi=new WebGLGeometries(nr,Nt,Si,Rr),Ri=new WebGLObjects(nr,gi,Nt,Si),fr=new WebGLMorphtargets(nr),xi=new WebGLClipping(Li),Rt=new WebGLPrograms(Y,kt,Gt,ui,Rr,xi),Xt=new WebGLMaterials(Li),Hi=new WebGLRenderLists(Li),Ni=new WebGLRenderStates(Gt,ui),$i=new WebGLBackground(Y,kt,oi,Ri,n),ir=new WebGLBufferRenderer(nr,Gt,Si,ui),lr=new WebGLIndexedBufferRenderer(nr,Gt,Si,ui),Si.programs=Rt.programs,Y.capabilities=ui,Y.extensions=Gt,Y.properties=Li,Y.renderLists=Hi,Y.state=oi,Y.info=Si}Jr();const _r=new WebXRManager(Y,nr);this.xr=_r;const mr=new WebGLShadowMap(Y,Ri,ui.maxTextureSize);this.shadowMap=mr,this.getContext=function(){return nr},this.getContextAttributes=function(){return nr.getContextAttributes()},this.forceContextLoss=function(){const pi=Gt.get("WEBGL_lose_context");pi&&pi.loseContext()},this.forceContextRestore=function(){const pi=Gt.get("WEBGL_lose_context");pi&&pi.restoreContext()},this.getPixelRatio=function(){return It},this.setPixelRatio=function(pi){pi!==void 0&&(It=pi,this.setSize(Zt,Ht,!1))},this.getSize=function(pi){return pi===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),pi=new Vector2),pi.set(Zt,Ht)},this.setSize=function(pi,Ii,Ai){if(_r.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Zt=pi,Ht=Ii,t.width=Math.floor(pi*It),t.height=Math.floor(Ii*It),Ai!==!1&&(t.style.width=pi+"px",t.style.height=Ii+"px"),this.setViewport(0,0,pi,Ii)},this.getDrawingBufferSize=function(pi){return pi===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),pi=new Vector2),pi.set(Zt*It,Ht*It).floor()},this.setDrawingBufferSize=function(pi,Ii,Ai){Zt=pi,Ht=Ii,It=Ai,t.width=Math.floor(pi*Ai),t.height=Math.floor(Ii*Ai),this.setViewport(0,0,pi,Ii)},this.getCurrentViewport=function(pi){return pi===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),pi=new Vector4),pi.copy(xt)},this.getViewport=function(pi){return pi.copy(ei)},this.setViewport=function(pi,Ii,Ai,ii){pi.isVector4?ei.set(pi.x,pi.y,pi.z,pi.w):ei.set(pi,Ii,Ai,ii),oi.viewport(xt.copy(ei).multiplyScalar(It).floor())},this.getScissor=function(pi){return pi.copy(Ct)},this.setScissor=function(pi,Ii,Ai,ii){pi.isVector4?Ct.set(pi.x,pi.y,pi.z,pi.w):Ct.set(pi,Ii,Ai,ii),oi.scissor(Et.copy(Ct).multiplyScalar(It).floor())},this.getScissorTest=function(){return Ut},this.setScissorTest=function(pi){oi.setScissorTest(Ut=pi)},this.setOpaqueSort=function(pi){Yt=pi},this.setTransparentSort=function(pi){ri=pi},this.getClearColor=function(pi){return pi===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),pi=new Color),pi.copy($i.getClearColor())},this.setClearColor=function(){$i.setClearColor.apply($i,arguments)},this.getClearAlpha=function(){return $i.getClearAlpha()},this.setClearAlpha=function(){$i.setClearAlpha.apply($i,arguments)},this.clear=function(pi,Ii,Ai){let ii=0;(pi===void 0||pi)&&(ii|=16384),(Ii===void 0||Ii)&&(ii|=256),(Ai===void 0||Ai)&&(ii|=1024),nr.clear(ii)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",wr,!1),t.removeEventListener("webglcontextrestored",Vr,!1),Hi.dispose(),Ni.dispose(),Li.dispose(),kt.dispose(),Ri.dispose(),Rr.dispose(),_r.dispose(),Sn.stop()};function wr(pi){pi.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ie=!0}function Vr(){console.log("THREE.WebGLRenderer: Context Restored."),ie=!1,Jr()}function wn(pi){const Ii=pi.target;Ii.removeEventListener("dispose",wn),Nn(Ii)}function Nn(pi){zs(pi),Li.remove(pi)}function zs(pi){const Ii=Li.get(pi).program;Ii!==void 0&&Rt.releaseProgram(Ii)}function es(pi,Ii){pi.render(function(Ai){Y.renderBufferImmediate(Ai,Ii)})}this.renderBufferImmediate=function(pi,Ii){Rr.initAttributes();const Ai=Li.get(pi);pi.hasPositions&&!Ai.position&&(Ai.position=nr.createBuffer()),pi.hasNormals&&!Ai.normal&&(Ai.normal=nr.createBuffer()),pi.hasUvs&&!Ai.uv&&(Ai.uv=nr.createBuffer()),pi.hasColors&&!Ai.color&&(Ai.color=nr.createBuffer());const ii=Ii.getAttributes();pi.hasPositions&&(nr.bindBuffer(34962,Ai.position),nr.bufferData(34962,pi.positionArray,35048),Rr.enableAttribute(ii.position),nr.vertexAttribPointer(ii.position,3,5126,!1,0,0)),pi.hasNormals&&(nr.bindBuffer(34962,Ai.normal),nr.bufferData(34962,pi.normalArray,35048),Rr.enableAttribute(ii.normal),nr.vertexAttribPointer(ii.normal,3,5126,!1,0,0)),pi.hasUvs&&(nr.bindBuffer(34962,Ai.uv),nr.bufferData(34962,pi.uvArray,35048),Rr.enableAttribute(ii.uv),nr.vertexAttribPointer(ii.uv,2,5126,!1,0,0)),pi.hasColors&&(nr.bindBuffer(34962,Ai.color),nr.bufferData(34962,pi.colorArray,35048),Rr.enableAttribute(ii.color),nr.vertexAttribPointer(ii.color,3,5126,!1,0,0)),Rr.disableUnusedAttributes(),nr.drawArrays(4,0,pi.count),pi.count=0},this.renderBufferDirect=function(pi,Ii,Ai,ii,wt,Ft){Ii===null&&(Ii=Er);const Vt=wt.isMesh&&wt.matrixWorld.determinant()<0,ni=eo(pi,Ii,ii,wt);oi.setMaterial(ii,Vt);let Jt=Ai.index;const yi=Ai.attributes.position;if(Jt===null){if(yi===void 0||yi.count===0)return}else if(Jt.count===0)return;let Fi=1;ii.wireframe===!0&&(Jt=gi.getWireframeAttribute(Ai),Fi=2),(ii.morphTargets||ii.morphNormals)&&fr.update(wt,Ai,ii,ni),Rr.setup(wt,ii,ni,Ai,Jt);let bi,Oi=ir;Jt!==null&&(bi=Nt.get(Jt),Oi=lr,Oi.setIndex(bi));const qi=Jt!==null?Jt.count:yi.count,Bi=Ai.drawRange.start*Fi,dr=Ai.drawRange.count*Fi,pr=Ft!==null?Ft.start*Fi:0,Nr=Ft!==null?Ft.count*Fi:1/0,Gr=Math.max(Bi,pr),rn=Math.min(qi,Bi+dr,pr+Nr)-1,sn=Math.max(0,rn-Gr+1);if(sn!==0){if(wt.isMesh)ii.wireframe===!0?(oi.setLineWidth(ii.wireframeLinewidth*Ir()),Oi.setMode(1)):Oi.setMode(4);else if(wt.isLine){let hn=ii.linewidth;hn===void 0&&(hn=1),oi.setLineWidth(hn*Ir()),wt.isLineSegments?Oi.setMode(1):wt.isLineLoop?Oi.setMode(2):Oi.setMode(3)}else wt.isPoints?Oi.setMode(0):wt.isSprite&&Oi.setMode(4);if(wt.isInstancedMesh)Oi.renderInstances(Gr,sn,wt.count);else if(Ai.isInstancedBufferGeometry){const hn=Math.min(Ai.instanceCount,Ai._maxInstanceCount);Oi.renderInstances(Gr,sn,hn)}else Oi.render(Gr,sn)}},this.compile=function(pi,Ii){$=Ni.get(pi),$.init(),pi.traverseVisible(function(ii){ii.isLight&&ii.layers.test(Ii.layers)&&($.pushLight(ii),ii.castShadow&&$.pushShadow(ii))}),$.setupLights();const Ai=new WeakMap;pi.traverse(function(ii){const wt=ii.material;if(wt)if(Array.isArray(wt))for(let Ft=0;Ft<wt.length;Ft++){const Vt=wt[Ft];Ai.has(Vt)===!1&&(xs(Vt,pi,ii),Ai.set(Vt))}else Ai.has(wt)===!1&&(xs(wt,pi,ii),Ai.set(wt))})};let As=null;function Dn(pi){_r.isPresenting||As&&As(pi)}const Sn=new WebGLAnimation;Sn.setAnimationLoop(Dn),typeof window<"u"&&Sn.setContext(window),this.setAnimationLoop=function(pi){As=pi,_r.setAnimationLoop(pi),pi===null?Sn.stop():Sn.start()},this.render=function(pi,Ii){let Ai,ii;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ai=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ii=arguments[3]),Ii!==void 0&&Ii.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ie===!0)return;Rr.resetDefaultState(),me=-1,ge=null,pi.autoUpdate===!0&&pi.updateMatrixWorld(),Ii.parent===null&&Ii.updateMatrixWorld(),_r.enabled===!0&&_r.isPresenting===!0&&(Ii=_r.getCamera(Ii)),pi.isScene===!0&&pi.onBeforeRender(Y,pi,Ii,Ai||le),$=Ni.get(pi,k.length),$.init(),k.push($),mi.multiplyMatrices(Ii.projectionMatrix,Ii.matrixWorldInverse),Mt.setFromProjectionMatrix(mi),jt=this.localClippingEnabled,$t=xi.init(this.clippingPlanes,jt,Ii),z=Hi.get(pi,Ii),z.init(),Os(pi,Ii,0,Y.sortObjects),z.finish(),Y.sortObjects===!0&&z.sort(Yt,ri),$t===!0&&xi.beginShadows();const wt=$.state.shadowsArray;mr.render(wt,pi,Ii),$.setupLights(),$.setupLightsView(Ii),$t===!0&&xi.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ai!==void 0&&this.setRenderTarget(Ai),$i.render(z,pi,Ii,ii);const Ft=z.opaque,Vt=z.transparent;Ft.length>0&&Un(Ft,pi,Ii),Vt.length>0&&Un(Vt,pi,Ii),pi.isScene===!0&&pi.onAfterRender(Y,pi,Ii),le!==null&&(Mi.updateRenderTargetMipmap(le),Mi.updateMultisampleRenderTarget(le)),oi.buffers.depth.setTest(!0),oi.buffers.depth.setMask(!0),oi.buffers.color.setMask(!0),oi.setPolygonOffset(!1),k.pop(),k.length>0?$=k[k.length-1]:$=null,z=null};function Os(pi,Ii,Ai,ii){if(pi.visible===!1)return;if(pi.layers.test(Ii.layers)){if(pi.isGroup)Ai=pi.renderOrder;else if(pi.isLOD)pi.autoUpdate===!0&&pi.update(Ii);else if(pi.isLight)$.pushLight(pi),pi.castShadow&&$.pushShadow(pi);else if(pi.isSprite){if(!pi.frustumCulled||Mt.intersectsSprite(pi)){ii&&Xi.setFromMatrixPosition(pi.matrixWorld).applyMatrix4(mi);const Vt=Ri.update(pi),ni=pi.material;ni.visible&&z.push(pi,Vt,ni,Ai,Xi.z,null)}}else if(pi.isImmediateRenderObject)ii&&Xi.setFromMatrixPosition(pi.matrixWorld).applyMatrix4(mi),z.push(pi,null,pi.material,Ai,Xi.z,null);else if((pi.isMesh||pi.isLine||pi.isPoints)&&(pi.isSkinnedMesh&&pi.skeleton.frame!==Si.render.frame&&(pi.skeleton.update(),pi.skeleton.frame=Si.render.frame),!pi.frustumCulled||Mt.intersectsObject(pi))){ii&&Xi.setFromMatrixPosition(pi.matrixWorld).applyMatrix4(mi);const Vt=Ri.update(pi),ni=pi.material;if(Array.isArray(ni)){const Jt=Vt.groups;for(let yi=0,Fi=Jt.length;yi<Fi;yi++){const bi=Jt[yi],Oi=ni[bi.materialIndex];Oi&&Oi.visible&&z.push(pi,Vt,Oi,Ai,Xi.z,bi)}}else ni.visible&&z.push(pi,Vt,ni,Ai,Xi.z,null)}}const Ft=pi.children;for(let Vt=0,ni=Ft.length;Vt<ni;Vt++)Os(Ft[Vt],Ii,Ai,ii)}function Un(pi,Ii,Ai){const ii=Ii.isScene===!0?Ii.overrideMaterial:null;for(let wt=0,Ft=pi.length;wt<Ft;wt++){const Vt=pi[wt],ni=Vt.object,Jt=Vt.geometry,yi=ii===null?Vt.material:ii,Fi=Vt.group;if(Ai.isArrayCamera){const bi=Ai.cameras;for(let Oi=0,qi=bi.length;Oi<qi;Oi++){const Bi=bi[Oi];ni.layers.test(Bi.layers)&&(oi.viewport(xt.copy(Bi.viewport)),$.setupLightsView(Bi),Ks(ni,Ii,Bi,Jt,yi,Fi))}}else Ks(ni,Ii,Ai,Jt,yi,Fi)}}function Ks(pi,Ii,Ai,ii,wt,Ft){if(pi.onBeforeRender(Y,Ii,Ai,ii,wt,Ft),pi.modelViewMatrix.multiplyMatrices(Ai.matrixWorldInverse,pi.matrixWorld),pi.normalMatrix.getNormalMatrix(pi.modelViewMatrix),pi.isImmediateRenderObject){const Vt=eo(Ai,Ii,wt,pi);oi.setMaterial(wt),Rr.reset(),es(pi,Vt)}else Y.renderBufferDirect(Ai,Ii,ii,wt,pi,Ft);pi.onAfterRender(Y,Ii,Ai,ii,wt,Ft)}function xs(pi,Ii,Ai){Ii.isScene!==!0&&(Ii=Er);const ii=Li.get(pi),wt=$.state.lights,Ft=$.state.shadowsArray,Vt=wt.state.version,ni=Rt.getParameters(pi,wt.state,Ft,Ii,Ai),Jt=Rt.getProgramCacheKey(ni);let yi=ii.program,Fi=!0;if(yi===void 0)pi.addEventListener("dispose",wn);else if(yi.cacheKey!==Jt)zs(pi);else if(ii.lightsStateVersion!==Vt)Fi=!1;else if(ni.shaderID!==void 0){const Bi=pi.isMeshStandardMaterial?Ii.environment:null;ii.envMap=kt.get(pi.envMap||Bi);return}else Fi=!1;Fi&&(ni.uniforms=Rt.getUniforms(pi),pi.onBeforeCompile(ni,Y),yi=Rt.acquireProgram(ni,Jt),ii.program=yi,ii.uniforms=ni.uniforms,ii.outputEncoding=ni.outputEncoding);const bi=ii.uniforms;(!pi.isShaderMaterial&&!pi.isRawShaderMaterial||pi.clipping===!0)&&(ii.numClippingPlanes=xi.numPlanes,ii.numIntersection=xi.numIntersection,bi.clippingPlanes=xi.uniform),ii.environment=pi.isMeshStandardMaterial?Ii.environment:null,ii.fog=Ii.fog,ii.envMap=kt.get(pi.envMap||ii.environment),ii.needsLights=Ki(pi),ii.lightsStateVersion=Vt,ii.needsLights&&(bi.ambientLightColor.value=wt.state.ambient,bi.lightProbe.value=wt.state.probe,bi.directionalLights.value=wt.state.directional,bi.directionalLightShadows.value=wt.state.directionalShadow,bi.spotLights.value=wt.state.spot,bi.spotLightShadows.value=wt.state.spotShadow,bi.rectAreaLights.value=wt.state.rectArea,bi.ltc_1.value=wt.state.rectAreaLTC1,bi.ltc_2.value=wt.state.rectAreaLTC2,bi.pointLights.value=wt.state.point,bi.pointLightShadows.value=wt.state.pointShadow,bi.hemisphereLights.value=wt.state.hemi,bi.directionalShadowMap.value=wt.state.directionalShadowMap,bi.directionalShadowMatrix.value=wt.state.directionalShadowMatrix,bi.spotShadowMap.value=wt.state.spotShadowMap,bi.spotShadowMatrix.value=wt.state.spotShadowMatrix,bi.pointShadowMap.value=wt.state.pointShadowMap,bi.pointShadowMatrix.value=wt.state.pointShadowMatrix);const Oi=ii.program.getUniforms(),qi=WebGLUniforms.seqWithValue(Oi.seq,bi);ii.uniformsList=qi}function eo(pi,Ii,Ai,ii){Ii.isScene!==!0&&(Ii=Er),Mi.resetTextureUnits();const wt=Ii.fog,Ft=Ai.isMeshStandardMaterial?Ii.environment:null,Vt=le===null?Y.outputEncoding:le.texture.encoding,ni=kt.get(Ai.envMap||Ft),Jt=Li.get(Ai),yi=$.state.lights;if($t===!0&&(jt===!0||pi!==ge)){const pr=pi===ge&&Ai.id===me;xi.setState(Ai,pi,pr)}Ai.version===Jt.__version?(Ai.fog&&Jt.fog!==wt||Jt.environment!==Ft||Jt.needsLights&&Jt.lightsStateVersion!==yi.state.version||Jt.numClippingPlanes!==void 0&&(Jt.numClippingPlanes!==xi.numPlanes||Jt.numIntersection!==xi.numIntersection)||Jt.outputEncoding!==Vt||Jt.envMap!==ni)&&xs(Ai,Ii,ii):(xs(Ai,Ii,ii),Jt.__version=Ai.version);let Fi=!1,bi=!1,Oi=!1;const qi=Jt.program,Bi=qi.getUniforms(),dr=Jt.uniforms;if(oi.useProgram(qi.program)&&(Fi=!0,bi=!0,Oi=!0),Ai.id!==me&&(me=Ai.id,bi=!0),Fi||ge!==pi){if(Bi.setValue(nr,"projectionMatrix",pi.projectionMatrix),ui.logarithmicDepthBuffer&&Bi.setValue(nr,"logDepthBufFC",2/(Math.log(pi.far+1)/Math.LN2)),ge!==pi&&(ge=pi,bi=!0,Oi=!0),Ai.isShaderMaterial||Ai.isMeshPhongMaterial||Ai.isMeshToonMaterial||Ai.isMeshStandardMaterial||Ai.envMap){const pr=Bi.map.cameraPosition;pr!==void 0&&pr.setValue(nr,Xi.setFromMatrixPosition(pi.matrixWorld))}(Ai.isMeshPhongMaterial||Ai.isMeshToonMaterial||Ai.isMeshLambertMaterial||Ai.isMeshBasicMaterial||Ai.isMeshStandardMaterial||Ai.isShaderMaterial)&&Bi.setValue(nr,"isOrthographic",pi.isOrthographicCamera===!0),(Ai.isMeshPhongMaterial||Ai.isMeshToonMaterial||Ai.isMeshLambertMaterial||Ai.isMeshBasicMaterial||Ai.isMeshStandardMaterial||Ai.isShaderMaterial||Ai.isShadowMaterial||Ai.skinning)&&Bi.setValue(nr,"viewMatrix",pi.matrixWorldInverse)}if(Ai.skinning){Bi.setOptional(nr,ii,"bindMatrix"),Bi.setOptional(nr,ii,"bindMatrixInverse");const pr=ii.skeleton;if(pr){const Nr=pr.bones;if(ui.floatVertexTextures){if(pr.boneTexture===null){let Gr=Math.sqrt(Nr.length*4);Gr=MathUtils.ceilPowerOfTwo(Gr),Gr=Math.max(Gr,4);const rn=new Float32Array(Gr*Gr*4);rn.set(pr.boneMatrices);const sn=new DataTexture(rn,Gr,Gr,RGBAFormat,FloatType);pr.boneMatrices=rn,pr.boneTexture=sn,pr.boneTextureSize=Gr}Bi.setValue(nr,"boneTexture",pr.boneTexture,Mi),Bi.setValue(nr,"boneTextureSize",pr.boneTextureSize)}else Bi.setOptional(nr,pr,"boneMatrices")}}return(bi||Jt.receiveShadow!==ii.receiveShadow)&&(Jt.receiveShadow=ii.receiveShadow,Bi.setValue(nr,"receiveShadow",ii.receiveShadow)),bi&&(Bi.setValue(nr,"toneMappingExposure",Y.toneMappingExposure),Jt.needsLights&&rr(dr,Oi),wt&&Ai.fog&&Xt.refreshFogUniforms(dr,wt),Xt.refreshMaterialUniforms(dr,Ai,It,Ht),WebGLUniforms.upload(nr,Jt.uniformsList,dr,Mi)),Ai.isShaderMaterial&&Ai.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(nr,Jt.uniformsList,dr,Mi),Ai.uniformsNeedUpdate=!1),Ai.isSpriteMaterial&&Bi.setValue(nr,"center",ii.center),Bi.setValue(nr,"modelViewMatrix",ii.modelViewMatrix),Bi.setValue(nr,"normalMatrix",ii.normalMatrix),Bi.setValue(nr,"modelMatrix",ii.matrixWorld),qi}function rr(pi,Ii){pi.ambientLightColor.needsUpdate=Ii,pi.lightProbe.needsUpdate=Ii,pi.directionalLights.needsUpdate=Ii,pi.directionalLightShadows.needsUpdate=Ii,pi.pointLights.needsUpdate=Ii,pi.pointLightShadows.needsUpdate=Ii,pi.spotLights.needsUpdate=Ii,pi.spotLightShadows.needsUpdate=Ii,pi.rectAreaLights.needsUpdate=Ii,pi.hemisphereLights.needsUpdate=Ii}function Ki(pi){return pi.isMeshLambertMaterial||pi.isMeshToonMaterial||pi.isMeshPhongMaterial||pi.isMeshStandardMaterial||pi.isShadowMaterial||pi.isShaderMaterial&&pi.lights===!0}this.setFramebuffer=function(pi){ue!==pi&&le===null&&nr.bindFramebuffer(36160,pi),ue=pi},this.getActiveCubeFace=function(){return ne},this.getActiveMipmapLevel=function(){return se},this.getRenderList=function(){return z},this.setRenderList=function(pi){z=pi},this.getRenderTarget=function(){return le},this.setRenderTarget=function(pi,Ii=0,Ai=0){le=pi,ne=Ii,se=Ai,pi&&Li.get(pi).__webglFramebuffer===void 0&&Mi.setupRenderTarget(pi);let ii=ue,wt=!1;if(pi){const Ft=Li.get(pi).__webglFramebuffer;pi.isWebGLCubeRenderTarget?(ii=Ft[Ii],wt=!0):pi.isWebGLMultisampleRenderTarget?ii=Li.get(pi).__webglMultisampledFramebuffer:ii=Ft,xt.copy(pi.viewport),Et.copy(pi.scissor),Lt=pi.scissorTest}else xt.copy(ei).multiplyScalar(It).floor(),Et.copy(Ct).multiplyScalar(It).floor(),Lt=Ut;if(he!==ii&&(nr.bindFramebuffer(36160,ii),he=ii),oi.viewport(xt),oi.scissor(Et),oi.setScissorTest(Lt),wt){const Ft=Li.get(pi.texture);nr.framebufferTexture2D(36160,36064,34069+Ii,Ft.__webglTexture,Ai)}},this.readRenderTargetPixels=function(pi,Ii,Ai,ii,wt,Ft,Vt){if(!(pi&&pi.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ni=Li.get(pi).__webglFramebuffer;if(pi.isWebGLCubeRenderTarget&&Vt!==void 0&&(ni=ni[Vt]),ni){let Jt=!1;ni!==he&&(nr.bindFramebuffer(36160,ni),Jt=!0);try{const yi=pi.texture,Fi=yi.format,bi=yi.type;if(Fi!==RGBAFormat&&Tr.convert(Fi)!==nr.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(bi!==UnsignedByteType&&Tr.convert(bi)!==nr.getParameter(35738)&&!(bi===FloatType&&(ui.isWebGL2||Gt.get("OES_texture_float")||Gt.get("WEBGL_color_buffer_float")))&&!(bi===HalfFloatType&&(ui.isWebGL2?Gt.get("EXT_color_buffer_float"):Gt.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}nr.checkFramebufferStatus(36160)===36053?Ii>=0&&Ii<=pi.width-ii&&Ai>=0&&Ai<=pi.height-wt&&nr.readPixels(Ii,Ai,ii,wt,Tr.convert(Fi),Tr.convert(bi),Ft):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Jt&&nr.bindFramebuffer(36160,he)}}},this.copyFramebufferToTexture=function(pi,Ii,Ai=0){const ii=Math.pow(2,-Ai),wt=Math.floor(Ii.image.width*ii),Ft=Math.floor(Ii.image.height*ii),Vt=Tr.convert(Ii.format);Mi.setTexture2D(Ii,0),nr.copyTexImage2D(3553,Ai,Vt,pi.x,pi.y,wt,Ft,0),oi.unbindTexture()},this.copyTextureToTexture=function(pi,Ii,Ai,ii=0){const wt=Ii.image.width,Ft=Ii.image.height,Vt=Tr.convert(Ai.format),ni=Tr.convert(Ai.type);Mi.setTexture2D(Ai,0),nr.pixelStorei(37440,Ai.flipY),nr.pixelStorei(37441,Ai.premultiplyAlpha),nr.pixelStorei(3317,Ai.unpackAlignment),Ii.isDataTexture?nr.texSubImage2D(3553,ii,pi.x,pi.y,wt,Ft,Vt,ni,Ii.image.data):Ii.isCompressedTexture?nr.compressedTexSubImage2D(3553,ii,pi.x,pi.y,Ii.mipmaps[0].width,Ii.mipmaps[0].height,Vt,Ii.mipmaps[0].data):nr.texSubImage2D(3553,ii,pi.x,pi.y,Vt,ni,Ii.image),ii===0&&Ai.generateMipmaps&&nr.generateMipmap(3553),oi.unbindTexture()},this.initTexture=function(pi){Mi.setTexture2D(pi,0),oi.unbindTexture()},this.resetState=function(){oi.reset(),Rr.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function WebGL1Renderer(e){WebGLRenderer.call(this,e)}WebGL1Renderer.prototype=Object.assign(Object.create(WebGLRenderer.prototype),{constructor:WebGL1Renderer,isWebGL1Renderer:!0});class Scene extends Object3D{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.background!==null&&(i.object.background=this.background.toJSON(t)),this.environment!==null&&(i.object.environment=this.environment.toJSON(t)),this.fog!==null&&(i.object.fog=this.fog.toJSON()),i}}function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=MathUtils.generateUUID()}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=MathUtils.generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new InterleavedBuffer(t,this.stride);return i.setUsage(this.usage),i},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=MathUtils.generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const _vector$6=new Vector3;function InterleavedBufferAttribute(e,t,i,r){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r===!0}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}});Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,i=this.data.count;t<i;t++)_vector$6.x=this.getX(t),_vector$6.y=this.getY(t),_vector$6.z=this.getZ(t),_vector$6.applyMatrix4(e),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=o,this},clone:function(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}SpriteMaterial.prototype=Object.create(Material.prototype);SpriteMaterial.prototype.constructor=SpriteMaterial;SpriteMaterial.prototype.isSpriteMaterial=!0;SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;function Sprite(e){if(Object3D.call(this),this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new InterleavedBuffer(t,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(i,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(i,2,3,!1))}this.geometry=_geometry,this.material=e!==void 0?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const i=this.material.rotation;let r,o;i!==0&&(o=Math.cos(i),r=Math.sin(i));const l=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,l,_worldScale,r,o),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,l,_worldScale,r,o),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,l,_worldScale,r,o),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);let d=e.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(d===null&&(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,l,_worldScale,r,o),_uvB$1.set(0,1),d=e.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint),d===null))return;const n=e.ray.origin.distanceTo(_intersectPoint);n<e.near||n>e.far||t.push({distance:n,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})},copy:function(e){return Object3D.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}});function transformVertex(e,t,i,r,o,l){_alignedPosition.subVectors(e,i).addScalar(.5).multiply(r),o!==void 0?(_rotatedPosition.x=l*_alignedPosition.x-o*_alignedPosition.y,_rotatedPosition.y=o*_alignedPosition.x+l*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}const _v1$4=new Vector3,_v2$2=new Vector3;function LOD(){Object3D.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(e){Object3D.prototype.copy.call(this,e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const o=t[i];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){_v1$4.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(_v1$4);this.getObjectForDistance(r).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){_v1$4.setFromMatrixPosition(e.matrixWorld),_v2$2.setFromMatrixPosition(this.matrixWorld);const i=_v1$4.distanceTo(_v2$2)/e.zoom;t[0].object.visible=!0;let r,o;for(r=1,o=t.length;r<o&&i>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<o;r++)t[r].object.visible=!1}},toJSON:function(e){const t=Object3D.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,o=i.length;r<o;r++){const l=i[r];t.object.levels.push({object:l.object.uuid,distance:l.distance})}return t}});const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector$7=new Vector3,_matrix$1=new Matrix4;function SkinnedMesh(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,copy:function(e){return Mesh.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new Vector4,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const i=this.skeleton,r=this.geometry;_skinIndex.fromBufferAttribute(r.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(r.attributes.skinWeight,e),_basePosition.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const l=_skinWeight.getComponent(o);if(l!==0){const d=_skinIndex.getComponent(o);_matrix$1.multiplyMatrices(i.bones[d].matrixWorld,i.boneInverses[d]),t.addScaledVector(_vector$7.copy(_basePosition).applyMatrix4(_matrix$1),l)}}return t.applyMatrix4(this.bindMatrixInverse)}});function Bone(){Object3D.call(this),this.type="Bone"}Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;function Skeleton(e=[],t=[]){this.uuid=MathUtils.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Skeleton.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Matrix4)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Matrix4;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}},update:function(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let o=0,l=e.length;o<l;o++){const d=e[o]?e[o].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(d,t[o]),_offsetMatrix.toArray(i,o*16)}r!==null&&(r.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}},dispose:function(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const o=e.bones[i];let l=t[o];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),l=new Bone),this.bones.push(l),this.boneInverses.push(new Matrix4().fromArray(e.boneInverses[i]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,o=t.length;r<o;r++){const l=t[r];e.bones.push(l.uuid);const d=i[r];e.boneInverses.push(d.toArray())}return e}});const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(e,t,i){Mesh.call(this,e,t),this.instanceMatrix=new BufferAttribute(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,copy:function(e){return Mesh.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,e*3)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,e*16)},raycast:function(e,t){const i=this.matrixWorld,r=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0)for(let o=0;o<r;o++){this.getMatrixAt(o,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(i,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects);for(let l=0,d=_instanceIntersects.length;l<d;l++){const n=_instanceIntersects[l];n.instanceId=o,n.object=this,t.push(n)}_instanceIntersects.length=0}},setColorAt:function(e,t){this.instanceColor===null&&(this.instanceColor=new BufferAttribute(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,e*3)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,e*16)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}LineBasicMaterial.prototype=Object.create(Material.prototype);LineBasicMaterial.prototype.constructor=LineBasicMaterial;LineBasicMaterial.prototype.isLineBasicMaterial=!0;LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const _start=new Vector3,_end=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$2=new Sphere;function Line(e=new BufferGeometry,t=new LineBasicMaterial){Object3D.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,o=t.count;r<o;r++)_start.fromBufferAttribute(t,r-1),_end.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,i=e.lineDistances;i[0]=0;for(let r=1,o=t.length;r<o;r++)i[r]=i[r-1],i[r]+=t[r-1].distanceTo(t[r])}return this},raycast:function(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold;if(i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$2.copy(i.boundingSphere),_sphere$2.applyMatrix4(r),_sphere$2.radius+=o,e.ray.intersectsSphere(_sphere$2)===!1)return;_inverseMatrix$1.copy(r).invert(),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=l*l,n=new Vector3,S=new Vector3,C=new Vector3,I=new Vector3,z=this.isLineSegments?2:1;if(i.isBufferGeometry){const $=i.index,Y=i.attributes.position;if($!==null){const ie=$.array;for(let ue=0,ne=ie.length-1;ue<ne;ue+=z){const se=ie[ue],le=ie[ue+1];if(n.fromBufferAttribute(Y,se),S.fromBufferAttribute(Y,le),_ray$1.distanceSqToSegment(n,S,I,C)>d)continue;I.applyMatrix4(this.matrixWorld);const me=e.ray.origin.distanceTo(I);me<e.near||me>e.far||t.push({distance:me,point:C.clone().applyMatrix4(this.matrixWorld),index:ue,face:null,faceIndex:null,object:this})}}else for(let ie=0,ue=Y.count-1;ie<ue;ie+=z){if(n.fromBufferAttribute(Y,ie),S.fromBufferAttribute(Y,ie+1),_ray$1.distanceSqToSegment(n,S,I,C)>d)continue;I.applyMatrix4(this.matrixWorld);const se=e.ray.origin.distanceTo(I);se<e.near||se>e.far||t.push({distance:se,point:C.clone().applyMatrix4(this.matrixWorld),index:ie,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const $=i.vertices,k=$.length;for(let Y=0;Y<k-1;Y+=z){if(_ray$1.distanceSqToSegment($[Y],$[Y+1],I,C)>d)continue;I.applyMatrix4(this.matrixWorld);const ue=e.ray.origin.distanceTo(I);ue<e.near||ue>e.far||t.push({distance:ue,point:C.clone().applyMatrix4(this.matrixWorld),index:Y,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=r.length;o<l;o++){const d=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const _start$1=new Vector3,_end$1=new Vector3;function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,o=t.count;r<o;r+=2)_start$1.fromBufferAttribute(t,r),_end$1.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,i=e.lineDistances;for(let r=0,o=t.length;r<o;r+=2)_start$1.copy(t[r]),_end$1.copy(t[r+1]),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+_start$1.distanceTo(_end$1)}return this}});function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0});function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}PointsMaterial.prototype=Object.create(Material.prototype);PointsMaterial.prototype.constructor=PointsMaterial;PointsMaterial.prototype.isPointsMaterial=!0;PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_position$1=new Vector3;function Points(e=new BufferGeometry,t=new PointsMaterial){Object3D.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold;if(i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$3.copy(i.boundingSphere),_sphere$3.applyMatrix4(r),_sphere$3.radius+=o,e.ray.intersectsSphere(_sphere$3)===!1)return;_inverseMatrix$2.copy(r).invert(),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=l*l;if(i.isBufferGeometry){const n=i.index,C=i.attributes.position;if(n!==null){const I=n.array;for(let z=0,$=I.length;z<$;z++){const k=I[z];_position$1.fromBufferAttribute(C,k),testPoint(_position$1,k,d,r,e,t,this)}}else for(let I=0,z=C.count;I<z;I++)_position$1.fromBufferAttribute(C,I),testPoint(_position$1,I,d,r,e,t,this)}else{const n=i.vertices;for(let S=0,C=n.length;S<C;S++)testPoint(n[S],S,d,r,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=r.length;o<l;o++){const d=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function testPoint(e,t,i,r,o,l,d){const n=_ray$2.distanceSqToPoint(e);if(n<i){const S=new Vector3;_ray$2.closestPointToPoint(e,S),S.applyMatrix4(r);const C=o.ray.origin.distanceTo(S);if(C<o.near||C>o.far)return;l.push({distance:C,distanceToRay:Math.sqrt(n),point:S,index:t,face:null,object:d})}}function VideoTexture(e,t,i,r,o,l,d,n,S){Texture.call(this,e,t,i,r,o,l,d,n,S),this.format=d!==void 0?d:RGBFormat,this.minFilter=l!==void 0?l:LinearFilter,this.magFilter=o!==void 0?o:LinearFilter,this.generateMipmaps=!1;const C=this;function I(){C.needsUpdate=!0,e.requestVideoFrameCallback(I)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(I)}VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function CompressedTexture(e,t,i,r,o,l,d,n,S,C,I,z){Texture.call(this,null,l,d,n,S,C,r,o,I,z),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}CompressedTexture.prototype=Object.create(Texture.prototype);CompressedTexture.prototype.constructor=CompressedTexture;CompressedTexture.prototype.isCompressedTexture=!0;function CanvasTexture(e,t,i,r,o,l,d,n,S){Texture.call(this,e,t,i,r,o,l,d,n,S),this.needsUpdate=!0}CanvasTexture.prototype=Object.create(Texture.prototype);CanvasTexture.prototype.constructor=CanvasTexture;CanvasTexture.prototype.isCanvasTexture=!0;function DepthTexture(e,t,i,r,o,l,d,n,S,C){if(C=C!==void 0?C:DepthFormat,C!==DepthFormat&&C!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&C===DepthFormat&&(i=UnsignedShortType),i===void 0&&C===DepthStencilFormat&&(i=UnsignedInt248Type),Texture.call(this,null,r,o,l,d,n,C,i,S),this.image={width:e,height:t},this.magFilter=d!==void 0?d:NearestFilter,this.minFilter=n!==void 0?n:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}DepthTexture.prototype=Object.create(Texture.prototype);DepthTexture.prototype.constructor=DepthTexture;DepthTexture.prototype.isDepthTexture=!0;let _geometryId=0;const _m1$3=new Matrix4,_obj$1=new Object3D,_offset$1=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:_geometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(e){const t=new Matrix3().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){const o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(let l=0,d=o.vertexNormals.length;l<d;l++)o.vertexNormals[l].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return _m1$3.makeRotationX(e),this.applyMatrix4(_m1$3),this},rotateY:function(e){return _m1$3.makeRotationY(e),this.applyMatrix4(_m1$3),this},rotateZ:function(e){return _m1$3.makeRotationZ(e),this.applyMatrix4(_m1$3),this},translate:function(e,t,i){return _m1$3.makeTranslation(e,t,i),this.applyMatrix4(_m1$3),this},scale:function(e,t,i){return _m1$3.makeScale(e,t,i),this.applyMatrix4(_m1$3),this},lookAt:function(e){return _obj$1.lookAt(e),_obj$1.updateMatrix(),this.applyMatrix4(_obj$1.matrix),this},fromBufferGeometry:function(e){const t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const o=r.position,l=r.normal,d=r.color,n=r.uv,S=r.uv2;S!==void 0&&(this.faceVertexUvs[1]=[]);for(let z=0;z<o.count;z++)t.vertices.push(new Vector3().fromBufferAttribute(o,z)),d!==void 0&&t.colors.push(new Color().fromBufferAttribute(d,z));function C(z,$,k,Y){const ie=d===void 0?[]:[t.colors[z].clone(),t.colors[$].clone(),t.colors[k].clone()],ue=l===void 0?[]:[new Vector3().fromBufferAttribute(l,z),new Vector3().fromBufferAttribute(l,$),new Vector3().fromBufferAttribute(l,k)],ne=new Face3(z,$,k,ue,ie,Y);t.faces.push(ne),n!==void 0&&t.faceVertexUvs[0].push([new Vector2().fromBufferAttribute(n,z),new Vector2().fromBufferAttribute(n,$),new Vector2().fromBufferAttribute(n,k)]),S!==void 0&&t.faceVertexUvs[1].push([new Vector2().fromBufferAttribute(S,z),new Vector2().fromBufferAttribute(S,$),new Vector2().fromBufferAttribute(S,k)])}const I=e.groups;if(I.length>0)for(let z=0;z<I.length;z++){const $=I[z],k=$.start,Y=$.count;for(let ie=k,ue=k+Y;ie<ue;ie+=3)i!==void 0?C(i.getX(ie),i.getX(ie+1),i.getX(ie+2),$.materialIndex):C(ie,ie+1,ie+2,$.materialIndex)}else if(i!==void 0)for(let z=0;z<i.count;z+=3)C(i.getX(z),i.getX(z+1),i.getX(z+2));else for(let z=0;z<o.count;z+=3)C(z,z+1,z+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$1).negate(),this.translate(_offset$1.x,_offset$1.y,_offset$1.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new Matrix4;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){const e=new Vector3,t=new Vector3;for(let i=0,r=this.faces.length;i<r;i++){const o=this.faces[i],l=this.vertices[o.a],d=this.vertices[o.b],n=this.vertices[o.c];e.subVectors(n,d),t.subVectors(l,d),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e=!0){const t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new Vector3;if(e){const i=new Vector3,r=new Vector3;for(let o=0,l=this.faces.length;o<l;o++){const d=this.faces[o],n=this.vertices[d.a],S=this.vertices[d.b],C=this.vertices[d.c];i.subVectors(C,S),r.subVectors(n,S),i.cross(r),t[d.a].add(i),t[d.b].add(i),t[d.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){const o=this.faces[i];t[o.a].add(o.normal),t[o.b].add(o.normal),t[o.c].add(o.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){const o=this.faces[i],l=o.vertexNormals;l.length===3?(l[0].copy(t[o.a]),l[1].copy(t[o.b]),l[2].copy(t[o.c])):(l[0]=t[o.a].clone(),l[1]=t[o.b].clone(),l[2]=t[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,i=this.faces.length;t<i;t++){const r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let o=0,l=r.vertexNormals.length;o<l;o++)r.__originalVertexNormals[o]?r.__originalVertexNormals[o].copy(r.vertexNormals[o]):r.__originalVertexNormals[o]=r.vertexNormals[o].clone()}const e=new Geometry;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const o=this.morphNormals[t].faceNormals,l=this.morphNormals[t].vertexNormals;for(let d=0,n=this.faces.length;d<n;d++){const S=new Vector3,C={a:new Vector3,b:new Vector3,c:new Vector3};o.push(S),l.push(C)}}const r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let o=0,l=this.faces.length;o<l;o++){const d=this.faces[o],n=r.faceNormals[o],S=r.vertexNormals[o];n.copy(d.normal),S.a.copy(d.vertexNormals[0]),S.b.copy(d.vertexNormals[1]),S.c.copy(d.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){const r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r;const o=this.vertices.length,l=this.vertices,d=e.vertices,n=this.faces,S=e.faces,C=this.colors,I=e.colors;t!==void 0&&(r=new Matrix3().getNormalMatrix(t));for(let z=0,$=d.length;z<$;z++){const Y=d[z].clone();t!==void 0&&Y.applyMatrix4(t),l.push(Y)}for(let z=0,$=I.length;z<$;z++)C.push(I[z].clone());for(let z=0,$=S.length;z<$;z++){const k=S[z];let Y,ie;const ue=k.vertexNormals,ne=k.vertexColors,se=new Face3(k.a+o,k.b+o,k.c+o);se.normal.copy(k.normal),r!==void 0&&se.normal.applyMatrix3(r).normalize();for(let le=0,he=ue.length;le<he;le++)Y=ue[le].clone(),r!==void 0&&Y.applyMatrix3(r).normalize(),se.vertexNormals.push(Y);se.color.copy(k.color);for(let le=0,he=ne.length;le<he;le++)ie=ne[le],se.vertexColors.push(ie.clone());se.materialIndex=k.materialIndex+i,n.push(se)}for(let z=0,$=e.faceVertexUvs.length;z<$;z++){const k=e.faceVertexUvs[z];this.faceVertexUvs[z]===void 0&&(this.faceVertexUvs[z]=[]);for(let Y=0,ie=k.length;Y<ie;Y++){const ue=k[Y],ne=[];for(let se=0,le=ue.length;se<le;se++)ne.push(ue[se].clone());this.faceVertexUvs[z].push(ne)}}},mergeMesh:function(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(e=4){const t={},i=[],r=[],o=Math.pow(10,e);for(let n=0,S=this.vertices.length;n<S;n++){const C=this.vertices[n],I=Math.round(C.x*o)+"_"+Math.round(C.y*o)+"_"+Math.round(C.z*o);t[I]===void 0?(t[I]=n,i.push(this.vertices[n]),r[n]=i.length-1):r[n]=r[t[I]]}const l=[];for(let n=0,S=this.faces.length;n<S;n++){const C=this.faces[n];C.a=r[C.a],C.b=r[C.b],C.c=r[C.c];const I=[C.a,C.b,C.c];for(let z=0;z<3;z++)if(I[z]===I[(z+1)%3]){l.push(n);break}}for(let n=l.length-1;n>=0;n--){const S=l[n];this.faces.splice(S,1);for(let C=0,I=this.faceVertexUvs.length;C<I;C++)this.faceVertexUvs[C].splice(S,1)}const d=this.vertices.length-i.length;return this.vertices=i,d},setFromPoints:function(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){const r=e[t];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let n=0;n<t;n++)e[n]._id=n;function i(n,S){return n.materialIndex-S.materialIndex}e.sort(i);const r=this.faceVertexUvs[0],o=this.faceVertexUvs[1];let l,d;r&&r.length===t&&(l=[]),o&&o.length===t&&(d=[]);for(let n=0;n<t;n++){const S=e[n]._id;l&&l.push(r[S]),d&&d.push(o[S])}l&&(this.faceVertexUvs[0]=l),d&&(this.faceVertexUvs[1]=d)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){const k=this.parameters;for(const Y in k)k[Y]!==void 0&&(e[Y]=k[Y]);return e}const t=[];for(let k=0;k<this.vertices.length;k++){const Y=this.vertices[k];t.push(Y.x,Y.y,Y.z)}const i=[],r=[],o={},l=[],d={},n=[],S={};for(let k=0;k<this.faces.length;k++){const Y=this.faces[k],ie=!0,ue=!1,ne=this.faceVertexUvs[0][k]!==void 0,se=Y.normal.length()>0,le=Y.vertexNormals.length>0,he=Y.color.r!==1||Y.color.g!==1||Y.color.b!==1,me=Y.vertexColors.length>0;let ge=0;if(ge=C(ge,0,0),ge=C(ge,1,ie),ge=C(ge,2,ue),ge=C(ge,3,ne),ge=C(ge,4,se),ge=C(ge,5,le),ge=C(ge,6,he),ge=C(ge,7,me),i.push(ge),i.push(Y.a,Y.b,Y.c),i.push(Y.materialIndex),ne){const xt=this.faceVertexUvs[0][k];i.push($(xt[0]),$(xt[1]),$(xt[2]))}if(se&&i.push(I(Y.normal)),le){const xt=Y.vertexNormals;i.push(I(xt[0]),I(xt[1]),I(xt[2]))}if(he&&i.push(z(Y.color)),me){const xt=Y.vertexColors;i.push(z(xt[0]),z(xt[1]),z(xt[2]))}}function C(k,Y,ie){return ie?k|1<<Y:k&~(1<<Y)}function I(k){const Y=k.x.toString()+k.y.toString()+k.z.toString();return o[Y]!==void 0||(o[Y]=r.length/3,r.push(k.x,k.y,k.z)),o[Y]}function z(k){const Y=k.r.toString()+k.g.toString()+k.b.toString();return d[Y]!==void 0||(d[Y]=l.length,l.push(k.getHex())),d[Y]}function $(k){const Y=k.x.toString()+k.y.toString();return S[Y]!==void 0||(S[Y]=n.length/2,n.push(k.x,k.y)),S[Y]}return e.data={},e.data.vertices=t,e.data.normals=r,l.length>0&&(e.data.colors=l),n.length>0&&(e.data.uvs=[n]),e.data.faces=i,e},clone:function(){return new Geometry().copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let z=0,$=t.length;z<$;z++)this.vertices.push(t[z].clone());const i=e.colors;for(let z=0,$=i.length;z<$;z++)this.colors.push(i[z].clone());const r=e.faces;for(let z=0,$=r.length;z<$;z++)this.faces.push(r[z].clone());for(let z=0,$=e.faceVertexUvs.length;z<$;z++){const k=e.faceVertexUvs[z];this.faceVertexUvs[z]===void 0&&(this.faceVertexUvs[z]=[]);for(let Y=0,ie=k.length;Y<ie;Y++){const ue=k[Y],ne=[];for(let se=0,le=ue.length;se<le;se++){const he=ue[se];ne.push(he.clone())}this.faceVertexUvs[z].push(ne)}}const o=e.morphTargets;for(let z=0,$=o.length;z<$;z++){const k={};if(k.name=o[z].name,o[z].vertices!==void 0){k.vertices=[];for(let Y=0,ie=o[z].vertices.length;Y<ie;Y++)k.vertices.push(o[z].vertices[Y].clone())}if(o[z].normals!==void 0){k.normals=[];for(let Y=0,ie=o[z].normals.length;Y<ie;Y++)k.normals.push(o[z].normals[Y].clone())}this.morphTargets.push(k)}const l=e.morphNormals;for(let z=0,$=l.length;z<$;z++){const k={};if(l[z].vertexNormals!==void 0){k.vertexNormals=[];for(let Y=0,ie=l[z].vertexNormals.length;Y<ie;Y++){const ue=l[z].vertexNormals[Y],ne={};ne.a=ue.a.clone(),ne.b=ue.b.clone(),ne.c=ue.c.clone(),k.vertexNormals.push(ne)}}if(l[z].faceNormals!==void 0){k.faceNormals=[];for(let Y=0,ie=l[z].faceNormals.length;Y<ie;Y++)k.faceNormals.push(l[z].faceNormals[Y].clone())}this.morphNormals.push(k)}const d=e.skinWeights;for(let z=0,$=d.length;z<$;z++)this.skinWeights.push(d[z].clone());const n=e.skinIndices;for(let z=0,$=n.length;z<$;z++)this.skinIndices.push(n[z].clone());const S=e.lineDistances;for(let z=0,$=S.length;z<$;z++)this.lineDistances.push(S[z]);const C=e.boundingBox;C!==null&&(this.boundingBox=C.clone());const I=e.boundingSphere;return I!==null&&(this.boundingSphere=I.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const _v0$2=new Vector3,_v1$5=new Vector3,_normal$1=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t,i){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:i},i=i!==void 0?i:1,t.isGeometry&&(t=new BufferGeometry().fromGeometry(t));const o=Math.pow(10,4),l=Math.cos(MathUtils.DEG2RAD*i),d=t.getIndex(),n=t.getAttribute("position"),S=d?d.count:n.count,C=[0,0,0],I=["a","b","c"],z=new Array(3),$={},k=[];for(let Y=0;Y<S;Y+=3){d?(C[0]=d.getX(Y),C[1]=d.getX(Y+1),C[2]=d.getX(Y+2)):(C[0]=Y,C[1]=Y+1,C[2]=Y+2);const{a:ie,b:ue,c:ne}=_triangle;if(ie.fromBufferAttribute(n,C[0]),ue.fromBufferAttribute(n,C[1]),ne.fromBufferAttribute(n,C[2]),_triangle.getNormal(_normal$1),z[0]=`${Math.round(ie.x*o)},${Math.round(ie.y*o)},${Math.round(ie.z*o)}`,z[1]=`${Math.round(ue.x*o)},${Math.round(ue.y*o)},${Math.round(ue.z*o)}`,z[2]=`${Math.round(ne.x*o)},${Math.round(ne.y*o)},${Math.round(ne.z*o)}`,!(z[0]===z[1]||z[1]===z[2]||z[2]===z[0]))for(let se=0;se<3;se++){const le=(se+1)%3,he=z[se],me=z[le],ge=_triangle[I[se]],xt=_triangle[I[le]],Et=`${he}_${me}`,Lt=`${me}_${he}`;Lt in $&&$[Lt]?(_normal$1.dot($[Lt].normal)<=l&&(k.push(ge.x,ge.y,ge.z),k.push(xt.x,xt.y,xt.z)),$[Lt]=null):Et in $||($[Et]={index0:C[se],index1:C[le],normal:_normal$1.clone()})}}for(const Y in $)if($[Y]){const{index0:ie,index1:ue}=$[Y];_v0$2.fromBufferAttribute(n,ie),_v1$5.fromBufferAttribute(n,ue),k.push(_v0$2.x,_v0$2.y,_v0$2.z),k.push(_v1$5.x,_v1$5.y,_v1$5.z)}this.setAttribute("position",new Float32BufferAttribute(k,3))}}const Earcut={triangulate:function(e,t,i){i=i||2;const r=t&&t.length,o=r?t[0]*i:e.length;let l=linkedList(e,0,o,i,!0);const d=[];if(!l||l.next===l.prev)return d;let n,S,C,I,z,$,k;if(r&&(l=eliminateHoles(e,t,l,i)),e.length>80*i){n=C=e[0],S=I=e[1];for(let Y=i;Y<o;Y+=i)z=e[Y],$=e[Y+1],z<n&&(n=z),$<S&&(S=$),z>C&&(C=z),$>I&&(I=$);k=Math.max(C-n,I-S),k=k!==0?1/k:0}return earcutLinked(l,d,i,n,S,k),d}};function linkedList(e,t,i,r,o){let l,d;if(o===signedArea(e,t,i,r)>0)for(l=t;l<i;l+=r)d=insertNode(l,e[l],e[l+1],d);else for(l=i-r;l>=t;l-=r)d=insertNode(l,e[l],e[l+1],d);return d&&equals(d,d.next)&&(removeNode(d),d=d.next),d}function filterPoints(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(equals(i,i.next)||area(i.prev,i,i.next)===0)){if(removeNode(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function earcutLinked(e,t,i,r,o,l,d){if(!e)return;!d&&l&&indexCurve(e,r,o,l);let n=e,S,C;for(;e.prev!==e.next;){if(S=e.prev,C=e.next,l?isEarHashed(e,r,o,l):isEar(e)){t.push(S.i/i),t.push(e.i/i),t.push(C.i/i),removeNode(e),e=C.next,n=C.next;continue}if(e=C,e===n){d?d===1?(e=cureLocalIntersections(filterPoints(e),t,i),earcutLinked(e,t,i,r,o,l,2)):d===2&&splitEarcut(e,t,i,r,o,l):earcutLinked(filterPoints(e),t,i,r,o,l,1);break}}}function isEar(e){const t=e.prev,i=e,r=e.next;if(area(t,i,r)>=0)return!1;let o=e.next.next;for(;o!==e.prev;){if(pointInTriangle(t.x,t.y,i.x,i.y,r.x,r.y,o.x,o.y)&&area(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function isEarHashed(e,t,i,r){const o=e.prev,l=e,d=e.next;if(area(o,l,d)>=0)return!1;const n=o.x<l.x?o.x<d.x?o.x:d.x:l.x<d.x?l.x:d.x,S=o.y<l.y?o.y<d.y?o.y:d.y:l.y<d.y?l.y:d.y,C=o.x>l.x?o.x>d.x?o.x:d.x:l.x>d.x?l.x:d.x,I=o.y>l.y?o.y>d.y?o.y:d.y:l.y>d.y?l.y:d.y,z=zOrder(n,S,t,i,r),$=zOrder(C,I,t,i,r);let k=e.prevZ,Y=e.nextZ;for(;k&&k.z>=z&&Y&&Y.z<=$;){if(k!==e.prev&&k!==e.next&&pointInTriangle(o.x,o.y,l.x,l.y,d.x,d.y,k.x,k.y)&&area(k.prev,k,k.next)>=0||(k=k.prevZ,Y!==e.prev&&Y!==e.next&&pointInTriangle(o.x,o.y,l.x,l.y,d.x,d.y,Y.x,Y.y)&&area(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;k&&k.z>=z;){if(k!==e.prev&&k!==e.next&&pointInTriangle(o.x,o.y,l.x,l.y,d.x,d.y,k.x,k.y)&&area(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;Y&&Y.z<=$;){if(Y!==e.prev&&Y!==e.next&&pointInTriangle(o.x,o.y,l.x,l.y,d.x,d.y,Y.x,Y.y)&&area(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function cureLocalIntersections(e,t,i){let r=e;do{const o=r.prev,l=r.next.next;!equals(o,l)&&intersects(o,r,r.next,l)&&locallyInside(o,l)&&locallyInside(l,o)&&(t.push(o.i/i),t.push(r.i/i),t.push(l.i/i),removeNode(r),removeNode(r.next),r=e=l),r=r.next}while(r!==e);return filterPoints(r)}function splitEarcut(e,t,i,r,o,l){let d=e;do{let n=d.next.next;for(;n!==d.prev;){if(d.i!==n.i&&isValidDiagonal(d,n)){let S=splitPolygon(d,n);d=filterPoints(d,d.next),S=filterPoints(S,S.next),earcutLinked(d,t,i,r,o,l),earcutLinked(S,t,i,r,o,l);return}n=n.next}d=d.next}while(d!==e)}function eliminateHoles(e,t,i,r){const o=[];let l,d,n,S,C;for(l=0,d=t.length;l<d;l++)n=t[l]*r,S=l<d-1?t[l+1]*r:e.length,C=linkedList(e,n,S,r,!1),C===C.next&&(C.steiner=!0),o.push(getLeftmost(C));for(o.sort(compareX),l=0;l<o.length;l++)eliminateHole(o[l],i),i=filterPoints(i,i.next);return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t),t){const i=splitPolygon(t,e);filterPoints(t,t.next),filterPoints(i,i.next)}}function findHoleBridge(e,t){let i=t;const r=e.x,o=e.y;let l=-1/0,d;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){const $=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if($<=r&&$>l){if(l=$,$===r){if(o===i.y)return i;if(o===i.next.y)return i.next}d=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!d)return null;if(r===l)return d;const n=d,S=d.x,C=d.y;let I=1/0,z;i=d;do r>=i.x&&i.x>=S&&r!==i.x&&pointInTriangle(o<C?r:l,o,S,C,o<C?l:r,o,i.x,i.y)&&(z=Math.abs(o-i.y)/(r-i.x),locallyInside(i,e)&&(z<I||z===I&&(i.x>d.x||i.x===d.x&&sectorContainsSector(d,i)))&&(d=i,I=z)),i=i.next;while(i!==n);return d}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,i,r){let o=e;do o.z===null&&(o.z=zOrder(o.x,o.y,t,i,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,sortLinked(o)}function sortLinked(e){let t,i,r,o,l,d,n,S,C=1;do{for(i=e,e=null,l=null,d=0;i;){for(d++,r=i,n=0,t=0;t<C&&(n++,r=r.nextZ,!!r);t++);for(S=C;n>0||S>0&&r;)n!==0&&(S===0||!r||i.z<=r.z)?(o=i,i=i.nextZ,n--):(o=r,r=r.nextZ,S--),l?l.nextZ=o:e=o,o.prevZ=l,l=o;i=r}l.nextZ=null,C*=2}while(d>1);return e}function zOrder(e,t,i,r,o){return e=32767*(e-i)*o,t=32767*(t-r)*o,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function getLeftmost(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function pointInTriangle(e,t,i,r,o,l,d,n){return(o-d)*(t-n)-(e-d)*(l-n)>=0&&(e-d)*(r-n)-(i-d)*(t-n)>=0&&(i-d)*(l-n)-(o-d)*(r-n)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,r){const o=sign(area(e,t,i)),l=sign(area(e,t,r)),d=sign(area(i,r,e)),n=sign(area(i,r,t));return!!(o!==l&&d!==n||o===0&&onSegment(e,i,t)||l===0&&onSegment(e,r,t)||d===0&&onSegment(i,e,r)||n===0&&onSegment(i,t,r))}function onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){let i=e,r=!1;const o=(e.x+t.x)/2,l=(e.y+t.y)/2;do i.y>l!=i.next.y>l&&i.next.y!==i.y&&o<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function splitPolygon(e,t){const i=new Node(e.i,e.x,e.y),r=new Node(t.i,t.x,t.y),o=e.next,l=t.prev;return e.next=t,t.prev=e,i.next=o,o.prev=i,r.next=i,i.prev=r,l.next=r,r.prev=l,r}function insertNode(e,t,i,r){const o=new Node(e,t,i);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,i,r){let o=0;for(let l=t,d=i-r;l<i;l+=r)o+=(e[d]-e[l])*(e[l+1]+e[d+1]),d=l;return o}const ShapeUtils={area:function(e){const t=e.length;let i=0;for(let r=t-1,o=0;o<t;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return i*.5},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){const i=[],r=[],o=[];removeDupEndPts(e),addContour(i,e);let l=e.length;t.forEach(removeDupEndPts);for(let n=0;n<t.length;n++)r.push(l),l+=t[n].length,addContour(i,t[n]);const d=Earcut.triangulate(i,r);for(let n=0;n<d.length;n+=3)o.push(d.slice(n,n+3));return o}};function removeDupEndPts(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class ExtrudeBufferGeometry extends BufferGeometry{constructor(t,i){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,o=[],l=[];for(let n=0,S=t.length;n<S;n++){const C=t[n];d(C)}this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2)),this.computeVertexNormals();function d(n){const S=[],C=i.curveSegments!==void 0?i.curveSegments:12,I=i.steps!==void 0?i.steps:1;let z=i.depth!==void 0?i.depth:100,$=i.bevelEnabled!==void 0?i.bevelEnabled:!0,k=i.bevelThickness!==void 0?i.bevelThickness:6,Y=i.bevelSize!==void 0?i.bevelSize:k-2,ie=i.bevelOffset!==void 0?i.bevelOffset:0,ue=i.bevelSegments!==void 0?i.bevelSegments:3;const ne=i.extrudePath,se=i.UVGenerator!==void 0?i.UVGenerator:WorldUVGenerator;i.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),z=i.amount);let le,he=!1,me,ge,xt,Et;ne&&(le=ne.getSpacedPoints(I),he=!0,$=!1,me=ne.computeFrenetFrames(I,!1),ge=new Vector3,xt=new Vector3,Et=new Vector3),$||(ue=0,k=0,Y=0,ie=0);const Lt=n.extractPoints(C);let Zt=Lt.shape;const Ht=Lt.holes;if(!ShapeUtils.isClockWise(Zt)){Zt=Zt.reverse();for(let Mi=0,kt=Ht.length;Mi<kt;Mi++){const Nt=Ht[Mi];ShapeUtils.isClockWise(Nt)&&(Ht[Mi]=Nt.reverse())}}const Yt=ShapeUtils.triangulateShape(Zt,Ht),ri=Zt;for(let Mi=0,kt=Ht.length;Mi<kt;Mi++){const Nt=Ht[Mi];Zt=Zt.concat(Nt)}function ei(Mi,kt,Nt){return kt||console.error("THREE.ExtrudeGeometry: vec does not exist"),kt.clone().multiplyScalar(Nt).add(Mi)}const Ct=Zt.length,Ut=Yt.length;function Mt(Mi,kt,Nt){let gi,Ri,Rt;const Xt=Mi.x-kt.x,Hi=Mi.y-kt.y,Ni=Nt.x-Mi.x,xi=Nt.y-Mi.y,$i=Xt*Xt+Hi*Hi,fr=Xt*xi-Hi*Ni;if(Math.abs(fr)>Number.EPSILON){const ir=Math.sqrt($i),lr=Math.sqrt(Ni*Ni+xi*xi),Tr=kt.x-Hi/ir,Rr=kt.y+Xt/ir,Jr=Nt.x-xi/lr,_r=Nt.y+Ni/lr,mr=((Jr-Tr)*xi-(_r-Rr)*Ni)/(Xt*xi-Hi*Ni);gi=Tr+Xt*mr-Mi.x,Ri=Rr+Hi*mr-Mi.y;const wr=gi*gi+Ri*Ri;if(wr<=2)return new Vector2(gi,Ri);Rt=Math.sqrt(wr/2)}else{let ir=!1;Xt>Number.EPSILON?Ni>Number.EPSILON&&(ir=!0):Xt<-Number.EPSILON?Ni<-Number.EPSILON&&(ir=!0):Math.sign(Hi)===Math.sign(xi)&&(ir=!0),ir?(gi=-Hi,Ri=Xt,Rt=Math.sqrt($i)):(gi=Xt,Ri=Hi,Rt=Math.sqrt($i/2))}return new Vector2(gi/Rt,Ri/Rt)}const $t=[];for(let Mi=0,kt=ri.length,Nt=kt-1,gi=Mi+1;Mi<kt;Mi++,Nt++,gi++)Nt===kt&&(Nt=0),gi===kt&&(gi=0),$t[Mi]=Mt(ri[Mi],ri[Nt],ri[gi]);const jt=[];let mi,Xi=$t.concat();for(let Mi=0,kt=Ht.length;Mi<kt;Mi++){const Nt=Ht[Mi];mi=[];for(let gi=0,Ri=Nt.length,Rt=Ri-1,Xt=gi+1;gi<Ri;gi++,Rt++,Xt++)Rt===Ri&&(Rt=0),Xt===Ri&&(Xt=0),mi[gi]=Mt(Nt[gi],Nt[Rt],Nt[Xt]);jt.push(mi),Xi=Xi.concat(mi)}for(let Mi=0;Mi<ue;Mi++){const kt=Mi/ue,Nt=k*Math.cos(kt*Math.PI/2),gi=Y*Math.sin(kt*Math.PI/2)+ie;for(let Ri=0,Rt=ri.length;Ri<Rt;Ri++){const Xt=ei(ri[Ri],$t[Ri],gi);Gt(Xt.x,Xt.y,-Nt)}for(let Ri=0,Rt=Ht.length;Ri<Rt;Ri++){const Xt=Ht[Ri];mi=jt[Ri];for(let Hi=0,Ni=Xt.length;Hi<Ni;Hi++){const xi=ei(Xt[Hi],mi[Hi],gi);Gt(xi.x,xi.y,-Nt)}}}const Er=Y+ie;for(let Mi=0;Mi<Ct;Mi++){const kt=$?ei(Zt[Mi],Xi[Mi],Er):Zt[Mi];he?(xt.copy(me.normals[0]).multiplyScalar(kt.x),ge.copy(me.binormals[0]).multiplyScalar(kt.y),Et.copy(le[0]).add(xt).add(ge),Gt(Et.x,Et.y,Et.z)):Gt(kt.x,kt.y,0)}for(let Mi=1;Mi<=I;Mi++)for(let kt=0;kt<Ct;kt++){const Nt=$?ei(Zt[kt],Xi[kt],Er):Zt[kt];he?(xt.copy(me.normals[Mi]).multiplyScalar(Nt.x),ge.copy(me.binormals[Mi]).multiplyScalar(Nt.y),Et.copy(le[Mi]).add(xt).add(ge),Gt(Et.x,Et.y,Et.z)):Gt(Nt.x,Nt.y,z/I*Mi)}for(let Mi=ue-1;Mi>=0;Mi--){const kt=Mi/ue,Nt=k*Math.cos(kt*Math.PI/2),gi=Y*Math.sin(kt*Math.PI/2)+ie;for(let Ri=0,Rt=ri.length;Ri<Rt;Ri++){const Xt=ei(ri[Ri],$t[Ri],gi);Gt(Xt.x,Xt.y,z+Nt)}for(let Ri=0,Rt=Ht.length;Ri<Rt;Ri++){const Xt=Ht[Ri];mi=jt[Ri];for(let Hi=0,Ni=Xt.length;Hi<Ni;Hi++){const xi=ei(Xt[Hi],mi[Hi],gi);he?Gt(xi.x,xi.y+le[I-1].y,le[I-1].x+Nt):Gt(xi.x,xi.y,z+Nt)}}}Ir(),nr();function Ir(){const Mi=o.length/3;if($){let kt=0,Nt=Ct*kt;for(let gi=0;gi<Ut;gi++){const Ri=Yt[gi];ui(Ri[2]+Nt,Ri[1]+Nt,Ri[0]+Nt)}kt=I+ue*2,Nt=Ct*kt;for(let gi=0;gi<Ut;gi++){const Ri=Yt[gi];ui(Ri[0]+Nt,Ri[1]+Nt,Ri[2]+Nt)}}else{for(let kt=0;kt<Ut;kt++){const Nt=Yt[kt];ui(Nt[2],Nt[1],Nt[0])}for(let kt=0;kt<Ut;kt++){const Nt=Yt[kt];ui(Nt[0]+Ct*I,Nt[1]+Ct*I,Nt[2]+Ct*I)}}r.addGroup(Mi,o.length/3-Mi,0)}function nr(){const Mi=o.length/3;let kt=0;si(ri,kt),kt+=ri.length;for(let Nt=0,gi=Ht.length;Nt<gi;Nt++){const Ri=Ht[Nt];si(Ri,kt),kt+=Ri.length}r.addGroup(Mi,o.length/3-Mi,1)}function si(Mi,kt){let Nt=Mi.length;for(;--Nt>=0;){const gi=Nt;let Ri=Nt-1;Ri<0&&(Ri=Mi.length-1);for(let Rt=0,Xt=I+ue*2;Rt<Xt;Rt++){const Hi=Ct*Rt,Ni=Ct*(Rt+1),xi=kt+gi+Hi,$i=kt+Ri+Hi,fr=kt+Ri+Ni,ir=kt+gi+Ni;oi(xi,$i,fr,ir)}}}function Gt(Mi,kt,Nt){S.push(Mi),S.push(kt),S.push(Nt)}function ui(Mi,kt,Nt){Si(Mi),Si(kt),Si(Nt);const gi=o.length/3,Ri=se.generateTopUV(r,o,gi-3,gi-2,gi-1);Li(Ri[0]),Li(Ri[1]),Li(Ri[2])}function oi(Mi,kt,Nt,gi){Si(Mi),Si(kt),Si(gi),Si(kt),Si(Nt),Si(gi);const Ri=o.length/3,Rt=se.generateSideWallUV(r,o,Ri-6,Ri-3,Ri-2,Ri-1);Li(Rt[0]),Li(Rt[1]),Li(Rt[3]),Li(Rt[1]),Li(Rt[2]),Li(Rt[3])}function Si(Mi){o.push(S[Mi*3+0]),o.push(S[Mi*3+1]),o.push(S[Mi*3+2])}function Li(Mi){l.push(Mi.x),l.push(Mi.y)}}}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this),i=this.parameters.shapes,r=this.parameters.options;return toJSON(i,r,t)}}const WorldUVGenerator={generateTopUV:function(e,t,i,r,o){const l=t[i*3],d=t[i*3+1],n=t[r*3],S=t[r*3+1],C=t[o*3],I=t[o*3+1];return[new Vector2(l,d),new Vector2(n,S),new Vector2(C,I)]},generateSideWallUV:function(e,t,i,r,o,l){const d=t[i*3],n=t[i*3+1],S=t[i*3+2],C=t[r*3],I=t[r*3+1],z=t[r*3+2],$=t[o*3],k=t[o*3+1],Y=t[o*3+2],ie=t[l*3],ue=t[l*3+1],ne=t[l*3+2];return Math.abs(n-I)<.01?[new Vector2(d,1-S),new Vector2(C,1-z),new Vector2($,1-Y),new Vector2(ie,1-ne)]:[new Vector2(n,1-S),new Vector2(I,1-z),new Vector2(k,1-Y),new Vector2(ue,1-ne)]}};function toJSON(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,o=e.length;r<o;r++){const l=e[r];i.shapes.push(l.uuid)}else i.shapes.push(e.uuid);return t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class ExtrudeGeometry extends Geometry{constructor(t,i){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},this.fromBufferGeometry(new ExtrudeBufferGeometry(t,i)),this.mergeVertices()}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return toJSON$1(i,r,t)}}function toJSON$1(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,o=e.length;r<o;r++){const l=e[r];i.shapes.push(l.uuid)}else i.shapes.push(e.uuid);return t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function ParametricBufferGeometry(e,t,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};const r=[],o=[],l=[],d=[],n=1e-5,S=new Vector3,C=new Vector3,I=new Vector3,z=new Vector3,$=new Vector3;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const k=t+1;for(let Y=0;Y<=i;Y++){const ie=Y/i;for(let ue=0;ue<=t;ue++){const ne=ue/t;e(ne,ie,C),o.push(C.x,C.y,C.z),ne-n>=0?(e(ne-n,ie,I),z.subVectors(C,I)):(e(ne+n,ie,I),z.subVectors(I,C)),ie-n>=0?(e(ne,ie-n,I),$.subVectors(C,I)):(e(ne,ie+n,I),$.subVectors(I,C)),S.crossVectors(z,$).normalize(),l.push(S.x,S.y,S.z),d.push(ne,ie)}}for(let Y=0;Y<i;Y++)for(let ie=0;ie<t;ie++){const ue=Y*k+ie,ne=Y*k+ie+1,se=(Y+1)*k+ie+1,le=(Y+1)*k+ie;r.push(ue,ne,le),r.push(ne,se,le)}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;function ParametricGeometry(e,t,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,i)),this.mergeVertices()}ParametricGeometry.prototype=Object.create(Geometry.prototype);ParametricGeometry.prototype.constructor=ParametricGeometry;class ShapeBufferGeometry extends BufferGeometry{constructor(t,i=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],o=[],l=[],d=[];let n=0,S=0;if(Array.isArray(t)===!1)C(t);else for(let I=0;I<t.length;I++)C(t[I]),this.addGroup(n,S,I),n+=S,S=0;this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2));function C(I){const z=o.length/3,$=I.extractPoints(i);let k=$.shape;const Y=$.holes;ShapeUtils.isClockWise(k)===!1&&(k=k.reverse());for(let ue=0,ne=Y.length;ue<ne;ue++){const se=Y[ue];ShapeUtils.isClockWise(se)===!0&&(Y[ue]=se.reverse())}const ie=ShapeUtils.triangulateShape(k,Y);for(let ue=0,ne=Y.length;ue<ne;ue++){const se=Y[ue];k=k.concat(se)}for(let ue=0,ne=k.length;ue<ne;ue++){const se=k[ue];o.push(se.x,se.y,0),l.push(0,0,1),d.push(se.x,se.y)}for(let ue=0,ne=ie.length;ue<ne;ue++){const se=ie[ue],le=se[0]+z,he=se[1]+z,me=se[2]+z;r.push(le,he,me),S+=3}}}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this),i=this.parameters.shapes;return toJSON$2(i,t)}}function toJSON$2(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const o=e[i];t.shapes.push(o.uuid)}else t.shapes.push(e.uuid);return t}class ShapeGeometry extends Geometry{constructor(t,i){super(),this.type="ShapeGeometry",typeof i=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),i=i.curveSegments),this.parameters={shapes:t,curveSegments:i},this.fromBufferGeometry(new ShapeBufferGeometry(t,i)),this.mergeVertices()}toJSON(){const t=Geometry.prototype.toJSON.call(this),i=this.parameters.shapes;return toJSON$3(i,t)}}function toJSON$3(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const o=e[i];t.shapes.push(o.uuid)}else t.shapes.push(e.uuid);return t}class SphereBufferGeometry extends BufferGeometry{constructor(t=1,i=8,r=6,o=0,l=Math.PI*2,d=0,n=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:o,phiLength:l,thetaStart:d,thetaLength:n},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const S=Math.min(d+n,Math.PI);let C=0;const I=[],z=new Vector3,$=new Vector3,k=[],Y=[],ie=[],ue=[];for(let ne=0;ne<=r;ne++){const se=[],le=ne/r;let he=0;ne==0&&d==0?he=.5/i:ne==r&&S==Math.PI&&(he=-.5/i);for(let me=0;me<=i;me++){const ge=me/i;z.x=-t*Math.cos(o+ge*l)*Math.sin(d+le*n),z.y=t*Math.cos(d+le*n),z.z=t*Math.sin(o+ge*l)*Math.sin(d+le*n),Y.push(z.x,z.y,z.z),$.copy(z).normalize(),ie.push($.x,$.y,$.z),ue.push(ge+he,1-le),se.push(C++)}I.push(se)}for(let ne=0;ne<r;ne++)for(let se=0;se<i;se++){const le=I[ne][se+1],he=I[ne][se],me=I[ne+1][se],ge=I[ne+1][se+1];(ne!==0||d>0)&&k.push(le,he,ge),(ne!==r-1||S<Math.PI)&&k.push(he,me,ge)}this.setIndex(k),this.setAttribute("position",new Float32BufferAttribute(Y,3)),this.setAttribute("normal",new Float32BufferAttribute(ie,3)),this.setAttribute("uv",new Float32BufferAttribute(ue,2))}}class SphereGeometry extends Geometry{constructor(t,i,r,o,l,d,n){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:o,phiLength:l,thetaStart:d,thetaLength:n},this.fromBufferGeometry(new SphereBufferGeometry(t,i,r,o,l,d,n)),this.mergeVertices()}}class WireframeGeometry extends BufferGeometry{constructor(t){super(),this.type="WireframeGeometry";const i=[],r=[0,0],o={},l=["a","b","c"];if(t&&t.isGeometry){const d=t.faces;for(let n=0,S=d.length;n<S;n++){const C=d[n];for(let I=0;I<3;I++){const z=C[l[I]],$=C[l[(I+1)%3]];r[0]=Math.min(z,$),r[1]=Math.max(z,$);const k=r[0]+","+r[1];o[k]===void 0&&(o[k]={index1:r[0],index2:r[1]})}}for(const n in o){const S=o[n];let C=t.vertices[S.index1];i.push(C.x,C.y,C.z),C=t.vertices[S.index2],i.push(C.x,C.y,C.z)}}else if(t&&t.isBufferGeometry){const d=new Vector3;if(t.index!==null){const n=t.attributes.position,S=t.index;let C=t.groups;C.length===0&&(C=[{start:0,count:S.count,materialIndex:0}]);for(let I=0,z=C.length;I<z;++I){const $=C[I],k=$.start,Y=$.count;for(let ie=k,ue=k+Y;ie<ue;ie+=3)for(let ne=0;ne<3;ne++){const se=S.getX(ie+ne),le=S.getX(ie+(ne+1)%3);r[0]=Math.min(se,le),r[1]=Math.max(se,le);const he=r[0]+","+r[1];o[he]===void 0&&(o[he]={index1:r[0],index2:r[1]})}}for(const I in o){const z=o[I];d.fromBufferAttribute(n,z.index1),i.push(d.x,d.y,d.z),d.fromBufferAttribute(n,z.index2),i.push(d.x,d.y,d.z)}}else{const n=t.attributes.position;for(let S=0,C=n.count/3;S<C;S++)for(let I=0;I<3;I++){const z=3*S+I;d.fromBufferAttribute(n,z),i.push(d.x,d.y,d.z);const $=3*S+(I+1)%3;d.fromBufferAttribute(n,$),i.push(d.x,d.y,d.z)}}}this.setAttribute("position",new Float32BufferAttribute(i,3))}}function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype);ShadowMaterial.prototype.constructor=ShadowMaterial;ShadowMaterial.prototype.isShadowMaterial=!0;ShadowMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this};function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype);RawShaderMaterial.prototype.constructor=RawShaderMaterial;RawShaderMaterial.prototype.isRawShaderMaterial=!0;function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}MeshStandardMaterial.prototype=Object.create(Material.prototype);MeshStandardMaterial.prototype.constructor=MeshStandardMaterial;MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this};function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=MathUtils.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype);MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial;MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Color).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this};function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshPhongMaterial.prototype=Object.create(Material.prototype);MeshPhongMaterial.prototype.constructor=MeshPhongMaterial;MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshToonMaterial(e){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshToonMaterial.prototype=Object.create(Material.prototype);MeshToonMaterial.prototype.constructor=MeshToonMaterial;MeshToonMaterial.prototype.isMeshToonMaterial=!0;MeshToonMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshNormalMaterial.prototype=Object.create(Material.prototype);MeshNormalMaterial.prototype.constructor=MeshNormalMaterial;MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshLambertMaterial.prototype=Object.create(Material.prototype);MeshLambertMaterial.prototype.constructor=MeshLambertMaterial;MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshMatcapMaterial(e){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshMatcapMaterial.prototype=Object.create(Material.prototype);MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial;MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;MeshMatcapMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype);LineDashedMaterial.prototype.constructor=LineDashedMaterial;LineDashedMaterial.prototype.isLineDashedMaterial=!0;LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Materials=Object.freeze({__proto__:null,ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material});const AnimationUtils={arraySlice:function(e,t,i){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(o,l){return e[o]-e[l]}const i=e.length,r=new Array(i);for(let o=0;o!==i;++o)r[o]=o;return r.sort(t),r},sortedArray:function(e,t,i){const r=e.length,o=new e.constructor(r);for(let l=0,d=0;d!==r;++l){const n=i[l]*t;for(let S=0;S!==t;++S)o[d++]=e[n+S]}return o},flattenJSON:function(e,t,i,r){let o=1,l=e[0];for(;l!==void 0&&l[r]===void 0;)l=e[o++];if(l===void 0)return;let d=l[r];if(d!==void 0)if(Array.isArray(d))do d=l[r],d!==void 0&&(t.push(l.time),i.push.apply(i,d)),l=e[o++];while(l!==void 0);else if(d.toArray!==void 0)do d=l[r],d!==void 0&&(t.push(l.time),d.toArray(i,i.length)),l=e[o++];while(l!==void 0);else do d=l[r],d!==void 0&&(t.push(l.time),i.push(d)),l=e[o++];while(l!==void 0)},subclip:function(e,t,i,r,o=30){const l=e.clone();l.name=t;const d=[];for(let S=0;S<l.tracks.length;++S){const C=l.tracks[S],I=C.getValueSize(),z=[],$=[];for(let k=0;k<C.times.length;++k){const Y=C.times[k]*o;if(!(Y<i||Y>=r)){z.push(C.times[k]);for(let ie=0;ie<I;++ie)$.push(C.values[k*I+ie])}}z.length!==0&&(C.times=AnimationUtils.convertArray(z,C.times.constructor),C.values=AnimationUtils.convertArray($,C.values.constructor),d.push(C))}l.tracks=d;let n=1/0;for(let S=0;S<l.tracks.length;++S)n>l.tracks[S].times[0]&&(n=l.tracks[S].times[0]);for(let S=0;S<l.tracks.length;++S)l.tracks[S].shift(-1*n);return l.resetDuration(),l},makeClipAdditive:function(e,t=0,i=e,r=30){r<=0&&(r=30);const o=i.tracks.length,l=t/r;for(let d=0;d<o;++d){const n=i.tracks[d],S=n.ValueTypeName;if(S==="bool"||S==="string")continue;const C=e.tracks.find(function(ne){return ne.name===n.name&&ne.ValueTypeName===S});if(C===void 0)continue;let I=0;const z=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(I=z/3);let $=0;const k=C.getValueSize();C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&($=k/3);const Y=n.times.length-1;let ie;if(l<=n.times[0]){const ne=I,se=z-I;ie=AnimationUtils.arraySlice(n.values,ne,se)}else if(l>=n.times[Y]){const ne=Y*z+I,se=ne+z-I;ie=AnimationUtils.arraySlice(n.values,ne,se)}else{const ne=n.createInterpolant(),se=I,le=z-I;ne.evaluate(l),ie=AnimationUtils.arraySlice(ne.resultBuffer,se,le)}S==="quaternion"&&new Quaternion().fromArray(ie).normalize().conjugate().toArray(ie);const ue=C.times.length;for(let ne=0;ne<ue;++ne){const se=ne*k+$;if(S==="quaternion")Quaternion.multiplyQuaternionsFlat(C.values,se,ie,0,C.values,se);else{const le=k-$*2;for(let he=0;he<le;++he)C.values[se+he]-=ie[he]}}}return e.blendMode=AdditiveAnimationBlendMode,e}};function Interpolant(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}Object.assign(Interpolant.prototype,{evaluate:function(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],o=t[i-1];e:{t:{let l;i:{r:if(!(e<r)){for(let d=i+2;;){if(r===void 0){if(e<o)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,o)}if(i===d)break;if(o=r,r=t[++i],e<r)break t}l=t.length;break i}if(!(e>=o)){const d=t[1];e<d&&(i=2,o=d);for(let n=i-2;;){if(o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===n)break;if(r=o,o=t[--i-1],e>=o)break t}l=i,i=0;break i}break e}for(;i<l;){const d=i+l>>>1;e<t[d]?l=d:i=d+1}if(r=t[i],o=t[i-1],o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(r===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,o,e)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let l=0;l!==r;++l)t[l]=i[o+l];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_});function CubicInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,i){const r=this.parameterPositions;let o=e-2,l=e+1,d=r[o],n=r[l];if(d===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:o=e,d=2*t-i;break;case WrapAroundEnding:o=r.length-2,d=t+r[o]-r[o+1];break;default:o=e,d=i}if(n===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:l=e,n=2*i-t;break;case WrapAroundEnding:l=1,n=i+r[1]-r[0];break;default:l=e-1,n=t}const S=(i-t)*.5,C=this.valueSize;this._weightPrev=S/(t-d),this._weightNext=S/(n-i),this._offsetPrev=o*C,this._offsetNext=l*C},interpolate_:function(e,t,i,r){const o=this.resultBuffer,l=this.sampleValues,d=this.valueSize,n=e*d,S=n-d,C=this._offsetPrev,I=this._offsetNext,z=this._weightPrev,$=this._weightNext,k=(i-t)/(r-t),Y=k*k,ie=Y*k,ue=-z*ie+2*z*Y-z*k,ne=(1+z)*ie+(-1.5-2*z)*Y+(-.5+z)*k+1,se=(-1-$)*ie+(1.5+$)*Y+.5*k,le=$*ie-$*Y;for(let he=0;he!==d;++he)o[he]=ue*l[C+he]+ne*l[S+he]+se*l[n+he]+le*l[I+he];return o}});function LinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,i,r){const o=this.resultBuffer,l=this.sampleValues,d=this.valueSize,n=e*d,S=n-d,C=(i-t)/(r-t),I=1-C;for(let z=0;z!==d;++z)o[z]=l[S+z]*I+l[n+z]*C;return o}});function DiscreteInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}});function KeyframeTrack(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}Object.assign(KeyframeTrack,{toJSON:function(e){const t=e.constructor;let i;if(t.toJSON!==void 0)i=t.toJSON(e);else{i={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}});Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this},scale:function(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this},trim:function(e,t){const i=this.times,r=i.length;let o=0,l=r-1;for(;o!==r&&i[o]<e;)++o;for(;l!==-1&&i[l]>t;)--l;if(++l,o!==0||l!==r){o>=l&&(l=Math.max(l,1),o=l-1);const d=this.getValueSize();this.times=AnimationUtils.arraySlice(i,o,l),this.values=AnimationUtils.arraySlice(this.values,o*d,l*d)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let d=0;d!==o;d++){const n=i[d];if(typeof n=="number"&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,d,n),e=!1;break}if(l!==null&&l>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,d,n,l),e=!1;break}l=n}if(r!==void 0&&AnimationUtils.isTypedArray(r))for(let d=0,n=r.length;d!==n;++d){const S=r[d];if(isNaN(S)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,d,S),e=!1;break}}return e},optimize:function(){const e=AnimationUtils.arraySlice(this.times),t=AnimationUtils.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===InterpolateSmooth,o=e.length-1;let l=1;for(let d=1;d<o;++d){let n=!1;const S=e[d],C=e[d+1];if(S!==C&&(d!==1||S!==S[0]))if(r)n=!0;else{const I=d*i,z=I-i,$=I+i;for(let k=0;k!==i;++k){const Y=t[I+k];if(Y!==t[z+k]||Y!==t[$+k]){n=!0;break}}}if(n){if(d!==l){e[l]=e[d];const I=d*i,z=l*i;for(let $=0;$!==i;++$)t[z+$]=t[I+$]}++l}}if(o>0){e[l]=e[o];for(let d=o*i,n=l*i,S=0;S!==i;++S)t[n+S]=t[d+S];++l}return l!==e.length?(this.times=AnimationUtils.arraySlice(e,0,l),this.values=AnimationUtils.arraySlice(t,0,l*i)):(this.times=e,this.values=t),this},clone:function(){const e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}});function BooleanKeyframeTrack(e,t,i){KeyframeTrack.call(this,e,t,i)}BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function ColorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"});function NumberKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"});function QuaternionLinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,i,r){const o=this.resultBuffer,l=this.sampleValues,d=this.valueSize,n=(i-t)/(r-t);let S=e*d;for(let C=S+d;S!==C;S+=4)Quaternion.slerpFlat(o,0,l,S-d,l,S,n);return o}});function QuaternionKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0});function StringKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function VectorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"});function AnimationClip(e,t=-1,i,r=NormalAnimationBlendMode){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(e.type);if(e.times===void 0){const i=[],r=[];AnimationUtils.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(AnimationClip,{parse:function(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let l=0,d=i.length;l!==d;++l)t.push(parseKeyframeTrack(i[l]).scale(r));const o=new AnimationClip(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o},toJSON:function(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=i.length;o!==l;++o)t.push(KeyframeTrack.toJSON(i[o]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){const o=t.length,l=[];for(let d=0;d<o;d++){let n=[],S=[];n.push((d+o-1)%o,d,(d+1)%o),S.push(0,1,0);const C=AnimationUtils.getKeyframeOrder(n);n=AnimationUtils.sortedArray(n,1,C),S=AnimationUtils.sortedArray(S,1,C),!r&&n[0]===0&&(n.push(o),S.push(S[0])),l.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[d].name+"]",n,S).scale(1/i))}return new AnimationClip(e,-1,l)},findByName:function(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){const r={},o=/^([\w-]*?)([\d]+)$/;for(let d=0,n=e.length;d<n;d++){const S=e[d],C=S.name.match(o);if(C&&C.length>1){const I=C[1];let z=r[I];z||(r[I]=z=[]),z.push(S)}}const l=[];for(const d in r)l.push(AnimationClip.CreateFromMorphTargetSequence(d,r[d],t,i));return l},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(I,z,$,k,Y){if($.length!==0){const ie=[],ue=[];AnimationUtils.flattenJSON($,ie,ue,k),ie.length!==0&&Y.push(new I(z,ie,ue))}},r=[],o=e.name||"default",l=e.fps||30,d=e.blendMode;let n=e.length||-1;const S=e.hierarchy||[];for(let I=0;I<S.length;I++){const z=S[I].keys;if(!(!z||z.length===0))if(z[0].morphTargets){const $={};let k;for(k=0;k<z.length;k++)if(z[k].morphTargets)for(let Y=0;Y<z[k].morphTargets.length;Y++)$[z[k].morphTargets[Y]]=-1;for(const Y in $){const ie=[],ue=[];for(let ne=0;ne!==z[k].morphTargets.length;++ne){const se=z[k];ie.push(se.time),ue.push(se.morphTarget===Y?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+Y+"]",ie,ue))}n=$.length*l}else{const $=".bones["+t[I].name+"]";i(VectorKeyframeTrack,$+".position",z,"pos",r),i(QuaternionKeyframeTrack,$+".quaternion",z,"rot",r),i(VectorKeyframeTrack,$+".scale",z,"scl",r)}}return r.length===0?null:new AnimationClip(o,n,r,d)}});Object.assign(AnimationClip.prototype,{resetDuration:function(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new AnimationClip(this.name,this.duration,e,this.blendMode)},toJSON:function(){return AnimationClip.toJSON(this)}});const Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,i){const r=this;let o=!1,l=0,d=0,n;const S=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(C){d++,o===!1&&r.onStart!==void 0&&r.onStart(C,l,d),o=!0},this.itemEnd=function(C){l++,r.onProgress!==void 0&&r.onProgress(C,l,d),l===d&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(C){r.onError!==void 0&&r.onError(C)},this.resolveURL=function(C){return n?n(C):C},this.setURLModifier=function(C){return n=C,this},this.addHandler=function(C,I){return S.push(C,I),this},this.removeHandler=function(C){const I=S.indexOf(C);return I!==-1&&S.splice(I,2),this},this.getHandler=function(C){for(let I=0,z=S.length;I<z;I+=2){const $=S[I],k=S[I+1];if($.global&&($.lastIndex=0),$.test(C))return k}return null}}const DefaultLoadingManager=new LoadingManager;function Loader(e){this.manager=e!==void 0?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(e,t){const i=this;return new Promise(function(r,o){i.load(e,r,t,o)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const loading={};function FileLoader(e){Loader.call(this,e)}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=Cache.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;if(loading[e]!==void 0){loading[e].push({onLoad:t,onProgress:i,onError:r});return}const d=/^data:(.*?)(;base64)?,(.*)$/,n=e.match(d);let S;if(n){const C=n[1],I=!!n[2];let z=n[3];z=decodeURIComponent(z),I&&(z=atob(z));try{let $;const k=(this.responseType||"").toLowerCase();switch(k){case"arraybuffer":case"blob":const Y=new Uint8Array(z.length);for(let ue=0;ue<z.length;ue++)Y[ue]=z.charCodeAt(ue);k==="blob"?$=new Blob([Y.buffer],{type:C}):$=Y.buffer;break;case"document":$=new DOMParser().parseFromString(z,C);break;case"json":$=JSON.parse(z);break;default:$=z;break}setTimeout(function(){t&&t($),o.manager.itemEnd(e)},0)}catch($){setTimeout(function(){r&&r($),o.manager.itemError(e),o.manager.itemEnd(e)},0)}}else{loading[e]=[],loading[e].push({onLoad:t,onProgress:i,onError:r}),S=new XMLHttpRequest,S.open("GET",e,!0),S.addEventListener("load",function(C){const I=this.response,z=loading[e];if(delete loading[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(e,I);for(let $=0,k=z.length;$<k;$++){const Y=z[$];Y.onLoad&&Y.onLoad(I)}o.manager.itemEnd(e)}else{for(let $=0,k=z.length;$<k;$++){const Y=z[$];Y.onError&&Y.onError(C)}o.manager.itemError(e),o.manager.itemEnd(e)}},!1),S.addEventListener("progress",function(C){const I=loading[e];for(let z=0,$=I.length;z<$;z++){const k=I[z];k.onProgress&&k.onProgress(C)}},!1),S.addEventListener("error",function(C){const I=loading[e];delete loading[e];for(let z=0,$=I.length;z<$;z++){const k=I[z];k.onError&&k.onError(C)}o.manager.itemError(e),o.manager.itemEnd(e)},!1),S.addEventListener("abort",function(C){const I=loading[e];delete loading[e];for(let z=0,$=I.length;z<$;z++){const k=I[z];k.onError&&k.onError(C)}o.manager.itemError(e),o.manager.itemEnd(e)},!1),this.responseType!==void 0&&(S.responseType=this.responseType),this.withCredentials!==void 0&&(S.withCredentials=this.withCredentials),S.overrideMimeType&&S.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const C in this.requestHeader)S.setRequestHeader(C,this.requestHeader[C]);S.send(null)}return o.manager.itemStart(e),S},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}});function AnimationLoader(e){Loader.call(this,e)}AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(e,t,i,r){const o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(d){try{t(o.parse(JSON.parse(d)))}catch(n){r?r(n):console.error(n),o.manager.itemError(e)}},i,r)},parse:function(e){const t=[];for(let i=0;i<e.length;i++){const r=AnimationClip.parse(e[i]);t.push(r)}return t}});function CompressedTextureLoader(e){Loader.call(this,e)}CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(e,t,i,r){const o=this,l=[],d=new CompressedTexture,n=new FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(o.withCredentials);let S=0;function C(I){n.load(e[I],function(z){const $=o.parse(z,!0);l[I]={width:$.width,height:$.height,format:$.format,mipmaps:$.mipmaps},S+=1,S===6&&($.mipmapCount===1&&(d.minFilter=LinearFilter),d.image=l,d.format=$.format,d.needsUpdate=!0,t&&t(d))},i,r)}if(Array.isArray(e))for(let I=0,z=e.length;I<z;++I)C(I);else n.load(e,function(I){const z=o.parse(I,!0);if(z.isCubemap){const $=z.mipmaps.length/z.mipmapCount;for(let k=0;k<$;k++){l[k]={mipmaps:[]};for(let Y=0;Y<z.mipmapCount;Y++)l[k].mipmaps.push(z.mipmaps[k*z.mipmapCount+Y]),l[k].format=z.format,l[k].width=z.width,l[k].height=z.height}d.image=l}else d.image.width=z.width,d.image.height=z.height,d.mipmaps=z.mipmaps;z.mipmapCount===1&&(d.minFilter=LinearFilter),d.format=z.format,d.needsUpdate=!0,t&&t(d)},i,r);return d}});function ImageLoader(e){Loader.call(this,e)}ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=Cache.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const d=document.createElementNS("http://www.w3.org/1999/xhtml","img");function n(){d.removeEventListener("load",n,!1),d.removeEventListener("error",S,!1),Cache.add(e,this),t&&t(this),o.manager.itemEnd(e)}function S(C){d.removeEventListener("load",n,!1),d.removeEventListener("error",S,!1),r&&r(C),o.manager.itemError(e),o.manager.itemEnd(e)}return d.addEventListener("load",n,!1),d.addEventListener("error",S,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(d.crossOrigin=this.crossOrigin),o.manager.itemStart(e),d.src=e,d}});function CubeTextureLoader(e){Loader.call(this,e)}CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(e,t,i,r){const o=new CubeTexture,l=new ImageLoader(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let d=0;function n(S){l.load(e[S],function(C){o.images[S]=C,d++,d===6&&(o.needsUpdate=!0,t&&t(o))},void 0,r)}for(let S=0;S<e.length;++S)n(S);return o}});function DataTextureLoader(e){Loader.call(this,e)}DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(e,t,i,r){const o=this,l=new DataTexture,d=new FileLoader(this.manager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(o.withCredentials),d.load(e,function(n){const S=o.parse(n);S&&(S.image!==void 0?l.image=S.image:S.data!==void 0&&(l.image.width=S.width,l.image.height=S.height,l.image.data=S.data),l.wrapS=S.wrapS!==void 0?S.wrapS:ClampToEdgeWrapping,l.wrapT=S.wrapT!==void 0?S.wrapT:ClampToEdgeWrapping,l.magFilter=S.magFilter!==void 0?S.magFilter:LinearFilter,l.minFilter=S.minFilter!==void 0?S.minFilter:LinearFilter,l.anisotropy=S.anisotropy!==void 0?S.anisotropy:1,S.format!==void 0&&(l.format=S.format),S.type!==void 0&&(l.type=S.type),S.mipmaps!==void 0&&(l.mipmaps=S.mipmaps,l.minFilter=LinearMipmapLinearFilter),S.mipmapCount===1&&(l.minFilter=LinearFilter),l.needsUpdate=!0,t&&t(l,S))},i,r),l}});function TextureLoader(e){Loader.call(this,e)}TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(e,t,i,r){const o=new Texture,l=new ImageLoader(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(d){o.image=d;const n=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;o.format=n?RGBFormat:RGBAFormat,o.needsUpdate=!0,t!==void 0&&t(o)},i,r),o}});function Curve(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),o=0;t.push(0);for(let l=1;l<=e;l++)i=this.getPoint(l/e),o+=i.distanceTo(r),t.push(o),r=i;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const i=this.getLengths();let r=0;const o=i.length;let l;t?l=t:l=e*i[o-1];let d=0,n=o-1,S;for(;d<=n;)if(r=Math.floor(d+(n-d)/2),S=i[r]-l,S<0)d=r+1;else if(S>0)n=r-1;else{n=r;break}if(r=n,i[r]===l)return r/(o-1);const C=i[r],z=i[r+1]-C,$=(l-C)/z;return(r+$)/(o-1)},getTangent:function(e,t){let r=e-1e-4,o=e+1e-4;r<0&&(r=0),o>1&&(o=1);const l=this.getPoint(r),d=this.getPoint(o),n=t||(l.isVector2?new Vector2:new Vector3);return n.copy(d).sub(l).normalize(),n},getTangentAt:function(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){const i=new Vector3,r=[],o=[],l=[],d=new Vector3,n=new Matrix4;for(let $=0;$<=e;$++){const k=$/e;r[$]=this.getTangentAt(k,new Vector3),r[$].normalize()}o[0]=new Vector3,l[0]=new Vector3;let S=Number.MAX_VALUE;const C=Math.abs(r[0].x),I=Math.abs(r[0].y),z=Math.abs(r[0].z);C<=S&&(S=C,i.set(1,0,0)),I<=S&&(S=I,i.set(0,1,0)),z<=S&&i.set(0,0,1),d.crossVectors(r[0],i).normalize(),o[0].crossVectors(r[0],d),l[0].crossVectors(r[0],o[0]);for(let $=1;$<=e;$++){if(o[$]=o[$-1].clone(),l[$]=l[$-1].clone(),d.crossVectors(r[$-1],r[$]),d.length()>Number.EPSILON){d.normalize();const k=Math.acos(MathUtils.clamp(r[$-1].dot(r[$]),-1,1));o[$].applyMatrix4(n.makeRotationAxis(d,k))}l[$].crossVectors(r[$],o[$])}if(t===!0){let $=Math.acos(MathUtils.clamp(o[0].dot(o[e]),-1,1));$/=e,r[0].dot(d.crossVectors(o[0],o[e]))>0&&($=-$);for(let k=1;k<=e;k++)o[k].applyMatrix4(n.makeRotationAxis(r[k],$*k)),l[k].crossVectors(r[k],o[k])}return{tangents:r,normals:o,binormals:l}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});function EllipseCurve(e,t,i,r,o,l,d,n){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=o||0,this.aEndAngle=l||2*Math.PI,this.aClockwise=d||!1,this.aRotation=n||0}EllipseCurve.prototype=Object.create(Curve.prototype);EllipseCurve.prototype.constructor=EllipseCurve;EllipseCurve.prototype.isEllipseCurve=!0;EllipseCurve.prototype.getPoint=function(e,t){const i=t||new Vector2,r=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(l?o=0:o=r),this.aClockwise===!0&&!l&&(o===r?o=-r:o=o-r);const d=this.aStartAngle+e*o;let n=this.aX+this.xRadius*Math.cos(d),S=this.aY+this.yRadius*Math.sin(d);if(this.aRotation!==0){const C=Math.cos(this.aRotation),I=Math.sin(this.aRotation),z=n-this.aX,$=S-this.aY;n=z*C-$*I+this.aX,S=z*I+$*C+this.aY}return i.set(n,S)};EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};EllipseCurve.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e};EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};function ArcCurve(e,t,i,r,o,l){EllipseCurve.call(this,e,t,i,i,r,o,l),this.type="ArcCurve"}ArcCurve.prototype=Object.create(EllipseCurve.prototype);ArcCurve.prototype.constructor=ArcCurve;ArcCurve.prototype.isArcCurve=!0;function CubicPoly(){let e=0,t=0,i=0,r=0;function o(l,d,n,S){e=l,t=n,i=-3*l+3*d-2*n-S,r=2*l-2*d+n+S}return{initCatmullRom:function(l,d,n,S,C){o(d,n,C*(n-l),C*(S-d))},initNonuniformCatmullRom:function(l,d,n,S,C,I,z){let $=(d-l)/C-(n-l)/(C+I)+(n-d)/I,k=(n-d)/I-(S-d)/(I+z)+(S-n)/z;$*=I,k*=I,o(d,n,$,k)},calc:function(l){const d=l*l,n=d*l;return e+t*l+i*d+r*n}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(e=[],t=!1,i="centripetal",r=.5){Curve.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}CatmullRomCurve3.prototype=Object.create(Curve.prototype);CatmullRomCurve3.prototype.constructor=CatmullRomCurve3;CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;CatmullRomCurve3.prototype.getPoint=function(e,t=new Vector3){const i=t,r=this.points,o=r.length,l=(o-(this.closed?0:1))*e;let d=Math.floor(l),n=l-d;this.closed?d+=d>0?0:(Math.floor(Math.abs(d)/o)+1)*o:n===0&&d===o-1&&(d=o-2,n=1);let S,C;this.closed||d>0?S=r[(d-1)%o]:(tmp.subVectors(r[0],r[1]).add(r[0]),S=tmp);const I=r[d%o],z=r[(d+1)%o];if(this.closed||d+2<o?C=r[(d+2)%o]:(tmp.subVectors(r[o-1],r[o-2]).add(r[o-1]),C=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const $=this.curveType==="chordal"?.5:.25;let k=Math.pow(S.distanceToSquared(I),$),Y=Math.pow(I.distanceToSquared(z),$),ie=Math.pow(z.distanceToSquared(C),$);Y<1e-4&&(Y=1),k<1e-4&&(k=Y),ie<1e-4&&(ie=Y),px.initNonuniformCatmullRom(S.x,I.x,z.x,C.x,k,Y,ie),py.initNonuniformCatmullRom(S.y,I.y,z.y,C.y,k,Y,ie),pz.initNonuniformCatmullRom(S.z,I.z,z.z,C.z,k,Y,ie)}else this.curveType==="catmullrom"&&(px.initCatmullRom(S.x,I.x,z.x,C.x,this.tension),py.initCatmullRom(S.y,I.y,z.y,C.y,this.tension),pz.initCatmullRom(S.z,I.z,z.z,C.z,this.tension));return i.set(px.calc(n),py.calc(n),pz.calc(n)),i};CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};CatmullRomCurve3.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e};CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Vector3().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};function CatmullRom(e,t,i,r,o){const l=(r-t)*.5,d=(o-i)*.5,n=e*e,S=e*n;return(2*i-2*r+l+d)*S+(-3*i+3*r-2*l-d)*n+l*e+i}function QuadraticBezierP0(e,t){const i=1-e;return i*i*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,i,r){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,i)+QuadraticBezierP2(e,r)}function CubicBezierP0(e,t){const i=1-e;return i*i*i*t}function CubicBezierP1(e,t){const i=1-e;return 3*i*i*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,i,r,o){return CubicBezierP0(e,t)+CubicBezierP1(e,i)+CubicBezierP2(e,r)+CubicBezierP3(e,o)}function CubicBezierCurve(e=new Vector2,t=new Vector2,i=new Vector2,r=new Vector2){Curve.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}CubicBezierCurve.prototype=Object.create(Curve.prototype);CubicBezierCurve.prototype.constructor=CubicBezierCurve;CubicBezierCurve.prototype.isCubicBezierCurve=!0;CubicBezierCurve.prototype.getPoint=function(e,t=new Vector2){const i=t,r=this.v0,o=this.v1,l=this.v2,d=this.v3;return i.set(CubicBezier(e,r.x,o.x,l.x,d.x),CubicBezier(e,r.y,o.y,l.y,d.y)),i};CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};CubicBezierCurve.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function CubicBezierCurve3(e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}CubicBezierCurve3.prototype=Object.create(Curve.prototype);CubicBezierCurve3.prototype.constructor=CubicBezierCurve3;CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;CubicBezierCurve3.prototype.getPoint=function(e,t=new Vector3){const i=t,r=this.v0,o=this.v1,l=this.v2,d=this.v3;return i.set(CubicBezier(e,r.x,o.x,l.x,d.x),CubicBezier(e,r.y,o.y,l.y,d.y),CubicBezier(e,r.z,o.z,l.z,d.z)),i};CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};CubicBezierCurve3.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function LineCurve(e=new Vector2,t=new Vector2){Curve.call(this),this.type="LineCurve",this.v1=e,this.v2=t}LineCurve.prototype=Object.create(Curve.prototype);LineCurve.prototype.constructor=LineCurve;LineCurve.prototype.isLineCurve=!0;LineCurve.prototype.getPoint=function(e,t=new Vector2){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i};LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};LineCurve.prototype.getTangent=function(e,t){const i=t||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i};LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};LineCurve.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function LineCurve3(e=new Vector3,t=new Vector3){Curve.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}LineCurve3.prototype=Object.create(Curve.prototype);LineCurve3.prototype.constructor=LineCurve3;LineCurve3.prototype.isLineCurve3=!0;LineCurve3.prototype.getPoint=function(e,t=new Vector3){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i};LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};LineCurve3.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function QuadraticBezierCurve(e=new Vector2,t=new Vector2,i=new Vector2){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}QuadraticBezierCurve.prototype=Object.create(Curve.prototype);QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve;QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;QuadraticBezierCurve.prototype.getPoint=function(e,t=new Vector2){const i=t,r=this.v0,o=this.v1,l=this.v2;return i.set(QuadraticBezier(e,r.x,o.x,l.x),QuadraticBezier(e,r.y,o.y,l.y)),i};QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};QuadraticBezierCurve.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function QuadraticBezierCurve3(e=new Vector3,t=new Vector3,i=new Vector3){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}QuadraticBezierCurve3.prototype=Object.create(Curve.prototype);QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3;QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;QuadraticBezierCurve3.prototype.getPoint=function(e,t=new Vector3){const i=t,r=this.v0,o=this.v1,l=this.v2;return i.set(QuadraticBezier(e,r.x,o.x,l.x),QuadraticBezier(e,r.y,o.y,l.y),QuadraticBezier(e,r.z,o.z,l.z)),i};QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};QuadraticBezierCurve3.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function SplineCurve(e=[]){Curve.call(this),this.type="SplineCurve",this.points=e}SplineCurve.prototype=Object.create(Curve.prototype);SplineCurve.prototype.constructor=SplineCurve;SplineCurve.prototype.isSplineCurve=!0;SplineCurve.prototype.getPoint=function(e,t=new Vector2){const i=t,r=this.points,o=(r.length-1)*e,l=Math.floor(o),d=o-l,n=r[l===0?l:l-1],S=r[l],C=r[l>r.length-2?r.length-1:l+1],I=r[l>r.length-3?r.length-1:l+2];return i.set(CatmullRom(d,n.x,S.x,C.x,I.x),CatmullRom(d,n.y,S.y,C.y,I.y)),i};SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this};SplineCurve.prototype.toJSON=function(){const e=Curve.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e};SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Vector2().fromArray(r))}return this};var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},getPoint:function(e){const t=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=t){const o=i[r]-t,l=this.curves[r],d=l.getLength(),n=d===0?0:1-o/d;return l.getPointAt(n)}r++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let i;for(let r=0,o=this.curves;r<o.length;r++){const l=o[r],d=l&&l.isEllipseCurve?e*2:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?e*l.points.length:e,n=l.getPoints(d);for(let S=0;S<n.length;S++){const C=n[S];i&&i.equals(C)||(t.push(C),i=C)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){Curve.prototype.copy.call(this,e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new Curves[r.type]().fromJSON(r))}return this}});function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,r){const o=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r));return this.curves.push(o),this.currentPoint.set(i,r),this},bezierCurveTo:function(e,t,i,r,o,l){const d=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r),new Vector2(o,l));return this.curves.push(d),this.currentPoint.set(o,l),this},splineThru:function(e){const t=[this.currentPoint.clone()].concat(e),i=new SplineCurve(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,r,o,l){const d=this.currentPoint.x,n=this.currentPoint.y;return this.absarc(e+d,t+n,i,r,o,l),this},absarc:function(e,t,i,r,o,l){return this.absellipse(e,t,i,i,r,o,l),this},ellipse:function(e,t,i,r,o,l,d,n){const S=this.currentPoint.x,C=this.currentPoint.y;return this.absellipse(e+S,t+C,i,r,o,l,d,n),this},absellipse:function(e,t,i,r,o,l,d,n){const S=new EllipseCurve(e,t,i,r,o,l,d,n);if(this.curves.length>0){const I=S.getPoint(0);I.equals(this.currentPoint)||this.lineTo(I.x,I.y)}this.curves.push(S);const C=S.getPoint(1);return this.currentPoint.copy(C),this},copy:function(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}});function Shape(e){Path.call(this,e),this.uuid=MathUtils.generateUUID(),this.type="Shape",this.holes=[]}Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){const e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new Path().fromJSON(r))}return this}});function Light(e,t=1){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=t}Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}});function HemisphereLight(e,t,i){Light.call(this,e,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});function LightShadow(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,i=this.matrix,r=this._projScreenMatrix,o=this._lookTarget,l=this._lightPositionWorld;l.setFromMatrixPosition(e.matrixWorld),t.position.copy(l),o.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(o),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}});function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500)),this.focus=1}SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,i=MathUtils.RAD2DEG*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||r!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=r,t.far=o,t.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,e)}});function SpotLight(e,t,i,r,o,l){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(d){this.intensity=d/Math.PI}}),this.distance=i!==void 0?i:0,this.angle=r!==void 0?r:Math.PI/3,this.penumbra=o!==void 0?o:0,this.decay=l!==void 0?l:1,this.shadow=new SpotLightShadow}SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(e,t=0){const i=this.camera,r=this.matrix,o=this._lightPositionWorld,l=this._lookTarget,d=this._projScreenMatrix;o.setFromMatrixPosition(e.matrixWorld),i.position.copy(o),l.copy(i.position),l.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(l),i.updateMatrixWorld(),r.makeTranslation(-o.x,-o.y,-o.z),d.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(d)}});function PointLight(e,t,i,r){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(o){this.intensity=o/(4*Math.PI)}}),this.distance=i!==void 0?i:0,this.decay=r!==void 0?r:1,this.shadow=new PointLightShadow}PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}});function OrthographicCamera(e=-1,t=1,i=1,r=-1,o=.1,l=2e3){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=o,this.far=l,this.updateProjectionMatrix()}OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,o,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=i-e,l=i+e,d=r+t,n=r-t;if(this.view!==null&&this.view.enabled){const S=(this.right-this.left)/this.view.fullWidth/this.zoom,C=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=S*this.view.offsetX,l=o+S*this.view.width,d-=C*this.view.offsetY,n=d-C*this.view.height}this.projectionMatrix.makeOrthographic(o,l,d,n,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}});function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(e){LightShadow.prototype.updateMatrices.call(this,e)}});function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight"}AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0});function RectAreaLight(e,t,i,r){Light.call(this,e,t),this.type="RectAreaLight",this.width=i!==void 0?i:10,this.height=r!==void 0?r:10}RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class SphericalHarmonics3{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,o=t.y,l=t.z,d=this.coefficients;return i.copy(d[0]).multiplyScalar(.282095),i.addScaledVector(d[1],.488603*o),i.addScaledVector(d[2],.488603*l),i.addScaledVector(d[3],.488603*r),i.addScaledVector(d[4],1.092548*(r*o)),i.addScaledVector(d[5],1.092548*(o*l)),i.addScaledVector(d[6],.315392*(3*l*l-1)),i.addScaledVector(d[7],1.092548*(r*l)),i.addScaledVector(d[8],.546274*(r*r-o*o)),i}getIrradianceAt(t,i){const r=t.x,o=t.y,l=t.z,d=this.coefficients;return i.copy(d[0]).multiplyScalar(.886227),i.addScaledVector(d[1],2*.511664*o),i.addScaledVector(d[2],2*.511664*l),i.addScaledVector(d[3],2*.511664*r),i.addScaledVector(d[4],2*.429043*r*o),i.addScaledVector(d[5],2*.429043*o*l),i.addScaledVector(d[6],.743125*l*l-.247708),i.addScaledVector(d[7],2*.429043*r*l),i.addScaledVector(d[8],.429043*(r*r-o*o)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let o=0;o<9;o++)r[o].fromArray(t,i+o*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let o=0;o<9;o++)r[o].toArray(t,i+o*3);return t}static getBasisAt(t,i){const r=t.x,o=t.y,l=t.z;i[0]=.282095,i[1]=.488603*o,i[2]=.488603*l,i[3]=.488603*r,i[4]=1.092548*r*o,i[5]=1.092548*o*l,i[6]=.315392*(3*l*l-1),i[7]=1.092548*r*l,i[8]=.546274*(r*r-o*o)}}function LightProbe(e,t){Light.call(this,void 0,t),this.type="LightProbe",this.sh=e!==void 0?e:new SphericalHarmonics3}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=Light.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}});function MaterialLoader(e){Loader.call(this,e),this.textures={}}MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(e,t,i,r){const o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(d){try{t(o.parse(JSON.parse(d)))}catch(n){r?r(n):console.error(n),o.manager.itemError(e)}},i,r)},parse:function(e){const t=this.textures;function i(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const r=new Materials[e.type];if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=new Color().setHex(e.sheen)),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==1&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(r.skinning=e.skinning),e.morphTargets!==void 0&&(r.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(r.morphNormals=e.morphNormals),e.dithering!==void 0&&(r.dithering=e.dithering),e.vertexTangents!==void 0&&(r.vertexTangents=e.vertexTangents),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const l=e.uniforms[o];switch(r.uniforms[o]={},l.type){case"t":r.uniforms[o].value=i(l.value);break;case"c":r.uniforms[o].value=new Color().setHex(l.value);break;case"v2":r.uniforms[o].value=new Vector2().fromArray(l.value);break;case"v3":r.uniforms[o].value=new Vector3().fromArray(l.value);break;case"v4":r.uniforms[o].value=new Vector4().fromArray(l.value);break;case"m3":r.uniforms[o].value=new Matrix3().fromArray(l.value);break;case"m4":r.uniforms[o].value=new Matrix4().fromArray(l.value);break;default:r.uniforms[o].value=l.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const o in e.extensions)r.extensions[o]=e.extensions[o];if(e.shading!==void 0&&(r.flatShading=e.shading===1),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),r.normalScale=new Vector2().fromArray(o)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Vector2().fromArray(e.clearcoatNormalScale)),e.transmission!==void 0&&(r.transmission=e.transmission),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});const LoaderUtils={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const e=BufferGeometry.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}});function InstancedBufferAttribute(e,t,i,r){typeof i=="number"&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,i),this.meshPerAttribute=r||1}InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=BufferAttribute.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}});function BufferGeometryLoader(e){Loader.call(this,e)}BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(e,t,i,r){const o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(d){try{t(o.parse(JSON.parse(d)))}catch(n){r?r(n):console.error(n),o.manager.itemError(e)}},i,r)},parse:function(e){const t={},i={};function r($,k){if(t[k]!==void 0)return t[k];const ie=$.interleavedBuffers[k],ue=o($,ie.buffer),ne=getTypedArray(ie.type,ue),se=new InterleavedBuffer(ne,ie.stride);return se.uuid=ie.uuid,t[k]=se,se}function o($,k){if(i[k]!==void 0)return i[k];const ie=$.arrayBuffers[k],ue=new Uint32Array(ie).buffer;return i[k]=ue,ue}const l=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,d=e.data.index;if(d!==void 0){const $=getTypedArray(d.type,d.array);l.setIndex(new BufferAttribute($,1))}const n=e.data.attributes;for(const $ in n){const k=n[$];let Y;if(k.isInterleavedBufferAttribute){const ie=r(e.data,k.data);Y=new InterleavedBufferAttribute(ie,k.itemSize,k.offset,k.normalized)}else{const ie=getTypedArray(k.type,k.array),ue=k.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;Y=new ue(ie,k.itemSize,k.normalized)}k.name!==void 0&&(Y.name=k.name),l.setAttribute($,Y)}const S=e.data.morphAttributes;if(S)for(const $ in S){const k=S[$],Y=[];for(let ie=0,ue=k.length;ie<ue;ie++){const ne=k[ie];let se;if(ne.isInterleavedBufferAttribute){const le=r(e.data,ne.data);se=new InterleavedBufferAttribute(le,ne.itemSize,ne.offset,ne.normalized)}else{const le=getTypedArray(ne.type,ne.array);se=new BufferAttribute(le,ne.itemSize,ne.normalized)}ne.name!==void 0&&(se.name=ne.name),Y.push(se)}l.morphAttributes[$]=Y}e.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);const I=e.data.groups||e.data.drawcalls||e.data.offsets;if(I!==void 0)for(let $=0,k=I.length;$!==k;++$){const Y=I[$];l.addGroup(Y.start,Y.count,Y.materialIndex)}const z=e.data.boundingSphere;if(z!==void 0){const $=new Vector3;z.center!==void 0&&$.fromArray(z.center),l.boundingSphere=new Sphere($,z.radius)}return e.name&&(l.name=e.name),e.userData&&(l.userData=e.userData),l}});function ImageBitmapLoader(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,e),this.options={premultiplyAlpha:"none"}}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,isImageBitmapLoader:!0,setOptions:function e(t){return this.options=t,this},load:function(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=Cache.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const d={};d.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",fetch(e,d).then(function(n){return n.blob()}).then(function(n){return createImageBitmap(n,o.options)}).then(function(n){Cache.add(e,n),t&&t(n),o.manager.itemEnd(e)}).catch(function(n){r&&r(n),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}});function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}Object.assign(ShapePath.prototype,{moveTo:function(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this},bezierCurveTo:function(e,t,i,r,o,l){return this.currentPath.bezierCurveTo(e,t,i,r,o,l),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(ne){const se=[];for(let le=0,he=ne.length;le<he;le++){const me=ne[le],ge=new Shape;ge.curves=me.curves,se.push(ge)}return se}function r(ne,se){const le=se.length;let he=!1;for(let me=le-1,ge=0;ge<le;me=ge++){let xt=se[me],Et=se[ge],Lt=Et.x-xt.x,Zt=Et.y-xt.y;if(Math.abs(Zt)>Number.EPSILON){if(Zt<0&&(xt=se[ge],Lt=-Lt,Et=se[me],Zt=-Zt),ne.y<xt.y||ne.y>Et.y)continue;if(ne.y===xt.y){if(ne.x===xt.x)return!0}else{const Ht=Zt*(ne.x-xt.x)-Lt*(ne.y-xt.y);if(Ht===0)return!0;if(Ht<0)continue;he=!he}}else{if(ne.y!==xt.y)continue;if(Et.x<=ne.x&&ne.x<=xt.x||xt.x<=ne.x&&ne.x<=Et.x)return!0}}return he}const o=ShapeUtils.isClockWise,l=this.subPaths;if(l.length===0)return[];if(t===!0)return i(l);let d,n,S;const C=[];if(l.length===1)return n=l[0],S=new Shape,S.curves=n.curves,C.push(S),C;let I=!o(l[0].getPoints());I=e?!I:I;const z=[],$=[];let k=[],Y=0,ie;$[Y]=void 0,k[Y]=[];for(let ne=0,se=l.length;ne<se;ne++)n=l[ne],ie=n.getPoints(),d=o(ie),d=e?!d:d,d?(!I&&$[Y]&&Y++,$[Y]={s:new Shape,p:ie},$[Y].s.curves=n.curves,I&&Y++,k[Y]=[]):k[Y].push({h:n,p:ie[0]});if(!$[0])return i(l);if($.length>1){let ne=!1;const se=[];for(let le=0,he=$.length;le<he;le++)z[le]=[];for(let le=0,he=$.length;le<he;le++){const me=k[le];for(let ge=0;ge<me.length;ge++){const xt=me[ge];let Et=!0;for(let Lt=0;Lt<$.length;Lt++)r(xt.p,$[Lt].p)&&(le!==Lt&&se.push({froms:le,tos:Lt,hole:ge}),Et?(Et=!1,z[Lt].push(xt)):ne=!0);Et&&z[le].push(xt)}}se.length>0&&(ne||(k=z))}let ue;for(let ne=0,se=$.length;ne<se;ne++){S=$[ne].s,C.push(S),ue=k[ne];for(let le=0,he=ue.length;le<he;le++)S.holes.push(ue[le].h)}return C}});function Font(e){this.type="Font",this.data=e}Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t=100){const i=[],r=createPaths(e,t,this.data);for(let o=0,l=r.length;o<l;o++)Array.prototype.push.apply(i,r[o].toShapes());return i}});function createPaths(e,t,i){const r=Array.from?Array.from(e):String(e).split(""),o=t/i.resolution,l=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*o,d=[];let n=0,S=0;for(let C=0;C<r.length;C++){const I=r[C];if(I===`
`)n=0,S-=l;else{const z=createPath(I,o,n,S,i);n+=z.offsetX,d.push(z.path)}}return d}function createPath(e,t,i,r,o){const l=o.glyphs[e]||o.glyphs["?"];if(!l){console.error('THREE.Font: character "'+e+'" does not exists in font family '+o.familyName+".");return}const d=new ShapePath;let n,S,C,I,z,$,k,Y;if(l.o){const ie=l._cachedOutline||(l._cachedOutline=l.o.split(" "));for(let ue=0,ne=ie.length;ue<ne;)switch(ie[ue++]){case"m":n=ie[ue++]*t+i,S=ie[ue++]*t+r,d.moveTo(n,S);break;case"l":n=ie[ue++]*t+i,S=ie[ue++]*t+r,d.lineTo(n,S);break;case"q":C=ie[ue++]*t+i,I=ie[ue++]*t+r,z=ie[ue++]*t+i,$=ie[ue++]*t+r,d.quadraticCurveTo(z,$,C,I);break;case"b":C=ie[ue++]*t+i,I=ie[ue++]*t+r,z=ie[ue++]*t+i,$=ie[ue++]*t+r,k=ie[ue++]*t+i,Y=ie[ue++]*t+r,d.bezierCurveTo(z,$,k,Y,C,I);break}}return{offsetX:l.ha*t,path:d}}function FontLoader(e){Loader.call(this,e)}FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(e,t,i,r){const o=this,l=new FileLoader(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(d){let n;try{n=JSON.parse(d)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(d.substring(65,d.length-2))}const S=o.parse(n);t&&t(S)},i,r)},parse:function(e){return new Font(e)}});let _context;const AudioContext={getContext:function(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(e){_context=e}};function AudioLoader(e){Loader.call(this,e)}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(e,t,i,r){const o=this,l=new FileLoader(o.manager);l.setResponseType("arraybuffer"),l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(d){try{const n=d.slice(0);AudioContext.getContext().decodeAudioData(n,function(C){t(C)})}catch(n){r?r(n):console.error(n),o.manager.itemError(e)}},i,r)}});function HemisphereLightProbe(e,t,i){LightProbe.call(this,void 0,i);const r=new Color().set(e),o=new Color().set(t),l=new Vector3(r.r,r.g,r.b),d=new Vector3(o.r,o.g,o.b),n=Math.sqrt(Math.PI),S=n*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(d).multiplyScalar(n),this.sh.coefficients[1].copy(l).sub(d).multiplyScalar(S)}HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(e){return LightProbe.prototype.copy.call(this,e),this},toJSON:function(e){return LightProbe.prototype.toJSON.call(this,e)}});function AmbientLightProbe(e,t){LightProbe.call(this,void 0,t);const i=new Color().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(e){return LightProbe.prototype.copy.call(this,e),this},toJSON:function(e){return LightProbe.prototype.toJSON.call(this,e)}});const _eyeRight=new Matrix4,_eyeLeft=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const r=e.projectionMatrix.clone(),o=t.eyeSep/2,l=o*t.near/t.focus,d=t.near*Math.tan(MathUtils.DEG2RAD*t.fov*.5)/t.zoom;let n,S;_eyeLeft.elements[12]=-o,_eyeRight.elements[12]=o,n=-d*t.aspect+l,S=d*t.aspect+l,r.elements[0]=2*t.near/(S-n),r.elements[8]=(S+n)/(S-n),this.cameraL.projectionMatrix.copy(r),n=-d*t.aspect-l,S=d*t.aspect-l,r.elements[0]=2*t.near/(S-n),r.elements[8]=(S+n)/(S-n),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}});class Clock{constructor(t){this.autoStart=t!==void 0?t:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function now(){return(typeof performance>"u"?Date:performance).now()}function PropertyMixer(e,t,i){this.binding=e,this.valueSize=i;let r,o,l;switch(t){case"quaternion":r=this._slerp,o=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,o=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(e,t){const i=this.buffer,r=this.valueSize,o=e*r+r;let l=this.cumulativeWeight;if(l===0){for(let d=0;d!==r;++d)i[o+d]=i[d];l=t}else{l+=t;const d=t/l;this._mixBufferRegion(i,o,0,d,r)}this.cumulativeWeight=l},accumulateAdditive:function(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,i=this.buffer,r=e*t+t,o=this.cumulativeWeight,l=this.cumulativeWeightAdditive,d=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const n=t*this._origIndex;this._mixBufferRegion(i,r,n,1-o,t)}l>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let n=t,S=t+t;n!==S;++n)if(i[n]!==i[n+t]){d.setValue(i,r);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let o=i,l=r;o!==l;++o)t[o]=t[r+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,r,o){if(r>=.5)for(let l=0;l!==o;++l)e[t+l]=e[i+l]},_slerp:function(e,t,i,r){Quaternion.slerpFlat(e,t,e,t,e,i,r)},_slerpAdditive:function(e,t,i,r,o){const l=this._workIndex*o;Quaternion.multiplyQuaternionsFlat(e,l,e,t,e,i),Quaternion.slerpFlat(e,t,e,t,e,l,r)},_lerp:function(e,t,i,r,o){const l=1-r;for(let d=0;d!==o;++d){const n=t+d;e[n]=e[n]*l+e[i+d]*r}},_lerpAdditive:function(e,t,i,r,o){for(let l=0;l!==o;++l){const d=t+l;e[d]=e[d]+e[i+l]*r}}});const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(e,t,i){const r=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)},setValue:function(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}});function PropertyBinding(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(PropertyBinding,{Composite,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(e){const t=_trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=i.nodeName.substring(r+1);_supportedObjectNames.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(o){for(let l=0;l<o.length;l++){const d=o[l];if(d.name===t||d.uuid===t)return d;const n=i(d.children);if(n)return n}return null},r=i(e.children);if(r)return r}return null}});Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function e(t,i){t[i]=this.node[this.propertyName]},function e(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)t[i++]=r[o]},function e(t,i){t[i]=this.resolvedProperty[this.propertyIndex]},function e(t,i){this.resolvedProperty.toArray(t,i)}],SetterByBindingTypeAndVersioning:[[function e(t,i){this.targetObject[this.propertyName]=t[i]},function e(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0},function e(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function e(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=t[i++]},function e(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=t[i++];this.targetObject.needsUpdate=!0},function e(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i]},function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0},function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function e(t,i){this.resolvedProperty.fromArray(t,i)},function e(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0},function e(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function e(t,i){this.bind(),this.getValue(t,i)},setValue:function e(t,i){this.bind(),this.setValue(t,i)},bind:function(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let o=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let S=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let C=0;C<e.length;C++)if(e[C].name===S){S=C;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(S!==void 0){if(e[S]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[S]}}const l=e[r];if(l===void 0){const S=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+S+"."+r+" but it wasn't found.",e);return}let d=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?d=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(d=this.Versioning.MatrixWorldNeedsUpdate);let n=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}n=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=o}else l.fromArray!==void 0&&l.toArray!==void 0?(n=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(n=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[n],this.setValue=this.SetterByBindingTypeAndVersioning[n][d]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue});function AnimationObjectGroup(){this.uuid=MathUtils.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,o=this._bindings,l=o.length;let d,n=e.length,S=this.nCachedObjects_;for(let C=0,I=arguments.length;C!==I;++C){const z=arguments[C],$=z.uuid;let k=t[$];if(k===void 0){k=n++,t[$]=k,e.push(z);for(let Y=0,ie=l;Y!==ie;++Y)o[Y].push(new PropertyBinding(z,i[Y],r[Y]))}else if(k<S){d=e[k];const Y=--S,ie=e[Y];t[ie.uuid]=k,e[k]=ie,t[$]=Y,e[Y]=z;for(let ue=0,ne=l;ue!==ne;++ue){const se=o[ue],le=se[Y];let he=se[k];se[k]=le,he===void 0&&(he=new PropertyBinding(z,i[ue],r[ue])),se[Y]=he}}else e[k]!==d&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=S},remove:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let o=this.nCachedObjects_;for(let l=0,d=arguments.length;l!==d;++l){const n=arguments[l],S=n.uuid,C=t[S];if(C!==void 0&&C>=o){const I=o++,z=e[I];t[z.uuid]=C,e[C]=z,t[S]=I,e[I]=n;for(let $=0,k=r;$!==k;++$){const Y=i[$],ie=Y[I],ue=Y[C];Y[C]=ie,Y[I]=ue}}}this.nCachedObjects_=o},uncache:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let o=this.nCachedObjects_,l=e.length;for(let d=0,n=arguments.length;d!==n;++d){const S=arguments[d],C=S.uuid,I=t[C];if(I!==void 0)if(delete t[C],I<o){const z=--o,$=e[z],k=--l,Y=e[k];t[$.uuid]=I,e[I]=$,t[Y.uuid]=z,e[z]=Y,e.pop();for(let ie=0,ue=r;ie!==ue;++ie){const ne=i[ie],se=ne[z],le=ne[k];ne[I]=se,ne[z]=le,ne.pop()}}else{const z=--l,$=e[z];z>0&&(t[$.uuid]=I),e[I]=$,e.pop();for(let k=0,Y=r;k!==Y;++k){const ie=i[k];ie[I]=ie[z],ie.pop()}}}this.nCachedObjects_=o},subscribe_:function(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const o=this._bindings;if(r!==void 0)return o[r];const l=this._paths,d=this._parsedPaths,n=this._objects,S=n.length,C=this.nCachedObjects_,I=new Array(S);r=o.length,i[e]=r,l.push(e),d.push(t),o.push(I);for(let z=C,$=n.length;z!==$;++z){const k=n[z];I[z]=new PropertyBinding(k,e,t)}return I},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,o=this._parsedPaths,l=this._bindings,d=l.length-1,n=l[d],S=e[d];t[S]=i,l[i]=n,l.pop(),o[i]=o[d],o.pop(),r[i]=r[d],r.pop()}}});class AnimationAction{constructor(t,i,r=null,o=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=o;const l=i.tracks,d=l.length,n=new Array(d),S={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let C=0;C!==d;++C){const I=l[C].createInterpolant(null);n[C]=I,I.settings=S}this._interpolantSettings=S,this._interpolants=n,this._propertyBindings=new Array(d),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const o=this._clip.duration,l=t._clip.duration,d=l/o,n=o/l;t.warp(1,d,i),this.warp(n,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const o=this._mixer,l=o.time,d=this.timeScale;let n=this._timeScaleInterpolant;n===null&&(n=o._lendControlInterpolant(),this._timeScaleInterpolant=n);const S=n.parameterPositions,C=n.sampleValues;return S[0]=l,S[1]=l+r,C[0]=t/d,C[1]=i/d,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,o){if(!this.enabled){this._updateWeight(t);return}const l=this._startTime;if(l!==null){const S=(t-l)*r;if(S<0||r===0)return;this._startTime=null,i=r*S}i*=this._updateTimeScale(t);const d=this._updateTime(i),n=this._updateWeight(t);if(n>0){const S=this._interpolants,C=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let I=0,z=S.length;I!==z;++I)S[I].evaluate(d),C[I].accumulateAdditive(n);break;case NormalAnimationBlendMode:default:for(let I=0,z=S.length;I!==z;++I)S[I].evaluate(d),C[I].accumulate(o,n)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const o=r.evaluate(t)[0];i*=o,t>r.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const o=r.evaluate(t)[0];i*=o,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let o=this.time+t,l=this._loopCount;const d=r===LoopPingPong;if(t===0)return l===-1?o:d&&(l&1)===1?i-o:o;if(r===LoopOnce){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(o>=i)o=i;else if(o<0)o=0;else{this.time=o;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(l===-1&&(t>=0?(l=0,this._setEndings(!0,this.repetitions===0,d)):this._setEndings(this.repetitions===0,!0,d)),o>=i||o<0){const n=Math.floor(o/i);o-=i*n,l+=Math.abs(n);const S=this.repetitions-l;if(S<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=t>0?i:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(S===1){const C=t<0;this._setEndings(C,!C,d)}else this._setEndings(!1,!1,d);this._loopCount=l,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=o;if(d&&(l&1)===1)return i-o}return o}_setEndings(t,i,r){const o=this._interpolantSettings;r?(o.endingStart=ZeroSlopeEnding,o.endingEnd=ZeroSlopeEnding):(t?o.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:o.endingStart=WrapAroundEnding,i?o.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:o.endingEnd=WrapAroundEnding)}_scheduleFading(t,i,r){const o=this._mixer,l=o.time;let d=this._weightInterpolant;d===null&&(d=o._lendControlInterpolant(),this._weightInterpolant=d);const n=d.parameterPositions,S=d.sampleValues;return n[0]=l,S[0]=i,n[1]=l+t,S[1]=r,this}}function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,o=r.length,l=e._propertyBindings,d=e._interpolants,n=i.uuid,S=this._bindingsByRootAndName;let C=S[n];C===void 0&&(C={},S[n]=C);for(let I=0;I!==o;++I){const z=r[I],$=z.name;let k=C[$];if(k!==void 0)l[I]=k;else{if(k=l[I],k!==void 0){k._cacheIndex===null&&(++k.referenceCount,this._addInactiveBinding(k,n,$));continue}const Y=t&&t._propertyBindings[I].binding.parsedPath;k=new PropertyMixer(PropertyBinding.create(i,$,Y),z.ValueTypeName,z.getValueSize()),++k.referenceCount,this._addInactiveBinding(k,n,$),l[I]=k}d[I].resultBuffer=k.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){const r=this._actions,o=this._actionsByClip;let l=o[t];if(l===void 0)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=l;else{const d=l.knownActions;e._byClipCacheIndex=d.length,d.push(e)}e._cacheIndex=r.length,r.push(e),l.actionByRoot[i]=e},_removeInactiveAction:function(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,l=this._actionsByClip,d=l[o],n=d.knownActions,S=n[n.length-1],C=e._byClipCacheIndex;S._byClipCacheIndex=C,n[C]=S,n.pop(),e._byClipCacheIndex=null;const I=d.actionByRoot,z=(e._localRoot||this._root).uuid;delete I[z],n.length===0&&delete l[o],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];--o.referenceCount===0&&this._removeInactiveBinding(o)}},_lendAction:function(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o},_takeBackAction:function(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o},_addInactiveBinding:function(e,t,i){const r=this._bindingsByRootAndName,o=this._bindings;let l=r[t];l===void 0&&(l={},r[t]=l),l[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,o=i.path,l=this._bindingsByRootAndName,d=l[r],n=t[t.length-1],S=e._cacheIndex;n._cacheIndex=S,t[S]=n,t.pop(),delete d[o],Object.keys(d).length===0&&delete l[r]},_lendBinding:function(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o},_takeBackBinding:function(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=t[r];e.__cacheIndex=r,t[r]=e,o.__cacheIndex=i,t[i]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){const r=t||this._root,o=r.uuid;let l=typeof e=="string"?AnimationClip.findByName(r,e):e;const d=l!==null?l.uuid:e,n=this._actionsByClip[d];let S=null;if(i===void 0&&(l!==null?i=l.blendMode:i=NormalAnimationBlendMode),n!==void 0){const I=n.actionByRoot[o];if(I!==void 0&&I.blendMode===i)return I;S=n.knownActions[0],l===null&&(l=S._clip)}if(l===null)return null;const C=new AnimationAction(this,l,t,i);return this._bindAction(C,S),this._addInactiveAction(C,d,o),C},existingAction:function(e,t){const i=t||this._root,r=i.uuid,o=typeof e=="string"?AnimationClip.findByName(i,e):e,l=o?o.uuid:e,d=this._actionsByClip[l];return d!==void 0&&d.actionByRoot[r]||null},stopAllAction:function(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,o=Math.sign(e),l=this._accuIndex^=1;for(let S=0;S!==i;++S)t[S]._update(r,e,o,l);const d=this._bindings,n=this._nActiveBindings;for(let S=0;S!==n;++S)d[S].apply(l);return this},setTime:function(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,o=r[i];if(o!==void 0){const l=o.knownActions;for(let d=0,n=l.length;d!==n;++d){const S=l[d];this._deactivateAction(S);const C=S._cacheIndex,I=t[t.length-1];S._cacheIndex=null,S._byClipCacheIndex=null,I._cacheIndex=C,t[C]=I,t.pop(),this._removeInactiveBindingsForAction(S)}delete r[i]}},uncacheRoot:function(e){const t=e.uuid,i=this._actionsByClip;for(const l in i){const d=i[l].actionByRoot,n=d[t];n!==void 0&&(this._deactivateAction(n),this._removeInactiveAction(n))}const r=this._bindingsByRootAndName,o=r[t];if(o!==void 0)for(const l in o){const d=o[l];d.restoreOriginalState(),this._removeInactiveBinding(d)}},uncacheAction:function(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}});function InstancedInterleavedBuffer(e,t,i){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=InterleavedBuffer.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=InterleavedBuffer.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}});function GLBufferAttribute(e,t,i,r,o){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=o,this.version=0}Object.defineProperty(GLBufferAttribute.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(GLBufferAttribute.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}});function Raycaster(e,t,i,r){this.ray=new Ray(e,t),this.near=i||0,this.far=r||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){const o=e.children;for(let l=0,d=o.length;l<d;l++)intersectObject(o[l],t,i,!0)}}Object.assign(Raycaster.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,i){const r=i||[];return intersectObject(e,this,r,t),r.sort(ascSort),r},intersectObjects:function(e,t,i){const r=i||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let o=0,l=e.length;o<l;o++)intersectObject(e[o],this,r,t);return r.sort(ascSort),r}});class Spherical{constructor(t=1,i=0,r=0){return this.radius=t,this.phi=i,this.theta=r,this}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}clone(){return new this.constructor().copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(MathUtils.clamp(i/this.radius,-1,1))),this}}const _vector$8=new Vector2;class Box2{constructor(t,i){Object.defineProperty(this,"isBox2",{value:!0}),this.min=t!==void 0?t:new Vector2(1/0,1/0),this.max=i!==void 0?i:new Vector2(-1/0,-1/0)}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=_vector$8.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),i=new Vector2),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,i){return i===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),i=new Vector2),i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _vector$8.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(t,i){this.start=t!==void 0?t:new Vector3,this.end=i!==void 0?i:new Vector3}set(t,i){return this.start.copy(t),this.end.copy(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Vector3),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Vector3),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return i===void 0&&(console.warn("THREE.Line3: .at() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);const r=_startEnd.dot(_startEnd);let l=_startEnd.dot(_startP)/r;return i&&(l=MathUtils.clamp(l,0,1)),l}closestPointToPoint(t,i,r){const o=this.closestPointToPointParameter(t,i);return r===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(o).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype);ImmediateRenderObject.prototype.constructor=ImmediateRenderObject;ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const _vector$a=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const i=getBoneList(t),r=new BufferGeometry,o=[],l=[],d=new Color(0,0,1),n=new Color(0,1,0);for(let C=0;C<i.length;C++){const I=i[C];I.parent&&I.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),l.push(d.r,d.g,d.b),l.push(n.r,n.g,n.b))}r.setAttribute("position",new Float32BufferAttribute(o,3)),r.setAttribute("color",new Float32BufferAttribute(l,3));const S=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,S),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,o=r.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let l=0,d=0;l<i.length;l++){const n=i[l];n.parent&&n.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,n.matrixWorld),_vector$a.setFromMatrixPosition(_boneMatrix),o.setXYZ(d,_vector$a.x,_vector$a.y,_vector$a.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,n.parent.matrixWorld),_vector$a.setFromMatrixPosition(_boneMatrix),o.setXYZ(d+1,_vector$a.x,_vector$a.y,_vector$a.z),d+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function getBoneList(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,getBoneList(e.children[i]));return t}class GridHelper extends LineSegments{constructor(t=10,i=10,r=4473924,o=8947848){r=new Color(r),o=new Color(o);const l=i/2,d=t/i,n=t/2,S=[],C=[];for(let $=0,k=0,Y=-n;$<=i;$++,Y+=d){S.push(-n,0,Y,n,0,Y),S.push(Y,0,-n,Y,0,n);const ie=$===l?r:o;ie.toArray(C,k),k+=3,ie.toArray(C,k),k+=3,ie.toArray(C,k),k+=3,ie.toArray(C,k),k+=3}const I=new BufferGeometry;I.setAttribute("position",new Float32BufferAttribute(S,3)),I.setAttribute("color",new Float32BufferAttribute(C,3));const z=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(I,z),this.type="GridHelper"}}const _floatView=new Float32Array(1);new Int32Array(_floatView.buffer);Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e};Object.assign(CurvePath.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new Geometry;for(let i=0,r=e.length;i<r;i++){const o=e[i];t.vertices.push(new Vector3(o.x,o.y,o.z||0))}return t}});Object.assign(Path.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}});Object.create(CatmullRomCurve3.prototype);Object.create(CatmullRomCurve3.prototype);function Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}Spline.prototype=Object.create(CatmullRomCurve3.prototype);Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(Loader.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)}});Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Object.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}});Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)};Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)};Object.assign(MathUtils,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),MathUtils.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),MathUtils.ceilPowerOfTwo(e)}});Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}});Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Vector3().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,o,l){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,o,l)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}});Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)};Object.assign(Quaternion.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}});Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}});Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}});Object.assign(Triangle,{barycoordFromPoint:function(e,t,i,r,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,i,r,o)},normal:function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,i,r)}});Object.assign(Shape.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}});Object.assign(Vector2.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Vector4.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.assign(Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}});PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)};Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}});Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}});Object.assign(BufferAttribute.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?DynamicDrawUsage:StaticDrawUsage),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2]))):e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t)},addDrawCall:function(e,t,i){i!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}});Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}});Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}});Object.assign(InterleavedBuffer.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?DynamicDrawUsage:StaticDrawUsage),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.assign(Scene.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}});Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}});Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(MeshPhysicalMaterial.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}});Object.assign(WebGLRenderer.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}});Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}});CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};CubeCamera.prototype.clear=function(e,t,i,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,r)};ImageUtils.crossOrigin=void 0;ImageUtils.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const o=new TextureLoader;o.setCrossOrigin(this.crossOrigin);const l=o.load(e,i,void 0,r);return t&&(l.mapping=t),l};ImageUtils.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const o=new CubeTextureLoader;o.setCrossOrigin(this.crossOrigin);const l=o.load(e,i,void 0,r);return t&&(l.mapping=t),l};ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));var GLTFLoader=function(){function e(si){Loader.call(this,si),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Gt){return new d(Gt)}),this.register(function(Gt){return new S(Gt)}),this.register(function(Gt){return new C(Gt)}),this.register(function(Gt){return new n(Gt)}),this.register(function(Gt){return new o(Gt)}),this.register(function(Gt){return new I(Gt)})}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(si,Gt,ui,oi){var Si=this,Li;this.resourcePath!==""?Li=this.resourcePath:this.path!==""?Li=this.path:Li=LoaderUtils.extractUrlBase(si),this.manager.itemStart(si);var Mi=function(Nt){oi?oi(Nt):console.error(Nt),Si.manager.itemError(si),Si.manager.itemEnd(si)},kt=new FileLoader(this.manager);kt.setPath(this.path),kt.setResponseType("arraybuffer"),kt.setRequestHeader(this.requestHeader),kt.setWithCredentials(this.withCredentials),kt.load(si,function(Nt){try{Si.parse(Nt,Li,function(gi){Gt(gi),Si.manager.itemEnd(si)},Mi)}catch(gi){Mi(gi)}},ui,Mi)},setDRACOLoader:function(si){return this.dracoLoader=si,this},setDDSLoader:function(si){return this.ddsLoader=si,this},setKTX2Loader:function(si){return this.ktx2Loader=si,this},setMeshoptDecoder:function(si){return this.meshoptDecoder=si,this},register:function(si){return this.pluginCallbacks.indexOf(si)===-1&&this.pluginCallbacks.push(si),this},unregister:function(si){return this.pluginCallbacks.indexOf(si)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(si),1),this},parse:function(si,Gt,ui,oi){var Si,Li={},Mi={};if(typeof si=="string")Si=si;else{var kt=LoaderUtils.decodeText(new Uint8Array(si,0,4));if(kt===z){try{Li[i.KHR_BINARY_GLTF]=new Y(si)}catch(Ni){oi&&oi(Ni);return}Si=Li[i.KHR_BINARY_GLTF].content}else Si=LoaderUtils.decodeText(new Uint8Array(si))}var Nt=JSON.parse(Si);if(Nt.asset===void 0||Nt.asset.version[0]<2){oi&&oi(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}var gi=new Xi(Nt,{path:Gt||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});gi.fileLoader.setRequestHeader(this.requestHeader);for(var Ri=0;Ri<this.pluginCallbacks.length;Ri++){var Rt=this.pluginCallbacks[Ri](gi);Mi[Rt.name]=Rt,Li[Rt.name]=!0}if(Nt.extensionsUsed)for(var Ri=0;Ri<Nt.extensionsUsed.length;++Ri){var Xt=Nt.extensionsUsed[Ri],Hi=Nt.extensionsRequired||[];switch(Xt){case i.KHR_MATERIALS_UNLIT:Li[Xt]=new l;break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:Li[Xt]=new se;break;case i.KHR_DRACO_MESH_COMPRESSION:Li[Xt]=new ie(Nt,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:Li[Xt]=new r(this.ddsLoader);break;case i.KHR_TEXTURE_TRANSFORM:Li[Xt]=new ue;break;case i.KHR_MESH_QUANTIZATION:Li[Xt]=new le;break;default:Hi.indexOf(Xt)>=0&&Mi[Xt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+Xt+'".')}}gi.setExtensions(Li),gi.setPlugins(Mi),gi.parse(ui,oi)}});function t(){var si={};return{get:function(Gt){return si[Gt]},add:function(Gt,ui){si[Gt]=ui},remove:function(Gt){delete si[Gt]},removeAll:function(){si={}}}}var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(si){if(!si)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=si}function o(si){this.parser=si,this.name=i.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}o.prototype._markDefs=function(){for(var si=this.parser,Gt=this.parser.json.nodes||[],ui=0,oi=Gt.length;ui<oi;ui++){var Si=Gt[ui];Si.extensions&&Si.extensions[this.name]&&Si.extensions[this.name].light!==void 0&&si._addNodeRef(this.cache,Si.extensions[this.name].light)}},o.prototype._loadLight=function(si){var Gt=this.parser,ui="light:"+si,oi=Gt.cache.get(ui);if(oi)return oi;var Si=Gt.json,Li=Si.extensions&&Si.extensions[this.name]||{},Mi=Li.lights||[],kt=Mi[si],Nt,gi=new Color(16777215);kt.color!==void 0&&gi.fromArray(kt.color);var Ri=kt.range!==void 0?kt.range:0;switch(kt.type){case"directional":Nt=new DirectionalLight(gi),Nt.target.position.set(0,0,-1),Nt.add(Nt.target);break;case"point":Nt=new PointLight(gi),Nt.distance=Ri;break;case"spot":Nt=new SpotLight(gi),Nt.distance=Ri,kt.spot=kt.spot||{},kt.spot.innerConeAngle=kt.spot.innerConeAngle!==void 0?kt.spot.innerConeAngle:0,kt.spot.outerConeAngle=kt.spot.outerConeAngle!==void 0?kt.spot.outerConeAngle:Math.PI/4,Nt.angle=kt.spot.outerConeAngle,Nt.penumbra=1-kt.spot.innerConeAngle/kt.spot.outerConeAngle,Nt.target.position.set(0,0,-1),Nt.add(Nt.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+kt.type)}return Nt.position.set(0,0,0),Nt.decay=2,kt.intensity!==void 0&&(Nt.intensity=kt.intensity),Nt.name=Gt.createUniqueName(kt.name||"light_"+si),oi=Promise.resolve(Nt),Gt.cache.add(ui,oi),oi},o.prototype.createNodeAttachment=function(si){var Gt=this,ui=this.parser,oi=ui.json,Si=oi.nodes[si],Li=Si.extensions&&Si.extensions[this.name]||{},Mi=Li.light;return Mi===void 0?null:this._loadLight(Mi).then(function(kt){return ui._getNodeRef(Gt.cache,Mi,kt)})};function l(){this.name=i.KHR_MATERIALS_UNLIT}l.prototype.getMaterialType=function(){return MeshBasicMaterial},l.prototype.extendParams=function(si,Gt,ui){var oi=[];si.color=new Color(1,1,1),si.opacity=1;var Si=Gt.pbrMetallicRoughness;if(Si){if(Array.isArray(Si.baseColorFactor)){var Li=Si.baseColorFactor;si.color.fromArray(Li),si.opacity=Li[3]}Si.baseColorTexture!==void 0&&oi.push(ui.assignTexture(si,"map",Si.baseColorTexture))}return Promise.all(oi)};function d(si){this.parser=si,this.name=i.KHR_MATERIALS_CLEARCOAT}d.prototype.getMaterialType=function(si){var Gt=this.parser,ui=Gt.json.materials[si];return!ui.extensions||!ui.extensions[this.name]?null:MeshPhysicalMaterial},d.prototype.extendMaterialParams=function(si,Gt){var ui=this.parser,oi=ui.json.materials[si];if(!oi.extensions||!oi.extensions[this.name])return Promise.resolve();var Si=[],Li=oi.extensions[this.name];if(Li.clearcoatFactor!==void 0&&(Gt.clearcoat=Li.clearcoatFactor),Li.clearcoatTexture!==void 0&&Si.push(ui.assignTexture(Gt,"clearcoatMap",Li.clearcoatTexture)),Li.clearcoatRoughnessFactor!==void 0&&(Gt.clearcoatRoughness=Li.clearcoatRoughnessFactor),Li.clearcoatRoughnessTexture!==void 0&&Si.push(ui.assignTexture(Gt,"clearcoatRoughnessMap",Li.clearcoatRoughnessTexture)),Li.clearcoatNormalTexture!==void 0&&(Si.push(ui.assignTexture(Gt,"clearcoatNormalMap",Li.clearcoatNormalTexture)),Li.clearcoatNormalTexture.scale!==void 0)){var Mi=Li.clearcoatNormalTexture.scale;Gt.clearcoatNormalScale=new Vector2(Mi,Mi)}return Promise.all(Si)};function n(si){this.parser=si,this.name=i.KHR_MATERIALS_TRANSMISSION}n.prototype.getMaterialType=function(si){var Gt=this.parser,ui=Gt.json.materials[si];return!ui.extensions||!ui.extensions[this.name]?null:MeshPhysicalMaterial},n.prototype.extendMaterialParams=function(si,Gt){var ui=this.parser,oi=ui.json.materials[si];if(!oi.extensions||!oi.extensions[this.name])return Promise.resolve();var Si=[],Li=oi.extensions[this.name];return Li.transmissionFactor!==void 0&&(Gt.transmission=Li.transmissionFactor),Li.transmissionTexture!==void 0&&Si.push(ui.assignTexture(Gt,"transmissionMap",Li.transmissionTexture)),Promise.all(Si)};function S(si){this.parser=si,this.name=i.KHR_TEXTURE_BASISU}S.prototype.loadTexture=function(si){var Gt=this.parser,ui=Gt.json,oi=ui.textures[si];if(!oi.extensions||!oi.extensions[this.name])return null;var Si=oi.extensions[this.name],Li=ui.images[Si.source],Mi=Gt.options.ktx2Loader;if(!Mi){if(ui.extensionsRequired&&ui.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Gt.loadTextureImage(si,Li,Mi)};function C(si){this.parser=si,this.name=i.EXT_TEXTURE_WEBP,this.isSupported=null}C.prototype.loadTexture=function(si){var Gt=this.name,ui=this.parser,oi=ui.json,Si=oi.textures[si];if(!Si.extensions||!Si.extensions[Gt])return null;var Li=Si.extensions[Gt],Mi=oi.images[Li.source],kt=Mi.uri?ui.options.manager.getHandler(Mi.uri):ui.textureLoader;return this.detectSupport().then(function(Nt){if(Nt)return ui.loadTextureImage(si,Mi,kt);if(oi.extensionsRequired&&oi.extensionsRequired.indexOf(Gt)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return ui.loadTexture(si)})},C.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(si){var Gt=new Image;Gt.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Gt.onload=Gt.onerror=function(){si(Gt.height===1)}})),this.isSupported};function I(si){this.name=i.EXT_MESHOPT_COMPRESSION,this.parser=si}I.prototype.loadBufferView=function(si){var Gt=this.parser.json,ui=Gt.bufferViews[si];if(ui.extensions&&ui.extensions[this.name]){var oi=ui.extensions[this.name],Si=this.parser.getDependency("buffer",oi.buffer),Li=this.parser.options.meshoptDecoder;if(!Li||!Li.supported){if(Gt.extensionsRequired&&Gt.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([Si,Li.ready]).then(function(Mi){var kt=oi.byteOffset||0,Nt=oi.byteLength||0,gi=oi.count,Ri=oi.byteStride,Rt=new ArrayBuffer(gi*Ri),Xt=new Uint8Array(Mi[0],kt,Nt);return Li.decodeGltfBuffer(new Uint8Array(Rt),gi,Ri,Xt,oi.mode,oi.filter),Rt})}else return null};var z="glTF",$=12,k={JSON:1313821514,BIN:5130562};function Y(si){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var Gt=new DataView(si,0,$);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(si.slice(0,4))),version:Gt.getUint32(4,!0),length:Gt.getUint32(8,!0)},this.header.magic!==z)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var ui=new DataView(si,$),oi=0;oi<ui.byteLength;){var Si=ui.getUint32(oi,!0);oi+=4;var Li=ui.getUint32(oi,!0);if(oi+=4,Li===k.JSON){var Mi=new Uint8Array(si,$+oi,Si);this.content=LoaderUtils.decodeText(Mi)}else if(Li===k.BIN){var kt=$+oi;this.body=si.slice(kt,kt+Si)}oi+=Si}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function ie(si,Gt){if(!Gt)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=si,this.dracoLoader=Gt,this.dracoLoader.preload()}ie.prototype.decodePrimitive=function(si,Gt){var ui=this.json,oi=this.dracoLoader,Si=si.extensions[this.name].bufferView,Li=si.extensions[this.name].attributes,Mi={},kt={},Nt={};for(var gi in Li){var Ri=Zt[gi]||gi.toLowerCase();Mi[Ri]=Li[gi]}for(gi in si.attributes){var Ri=Zt[gi]||gi.toLowerCase();if(Li[gi]!==void 0){var Rt=ui.accessors[si.attributes[gi]],Xt=ge[Rt.componentType];Nt[Ri]=Xt,kt[Ri]=Rt.normalized===!0}}return Gt.getDependency("bufferView",Si).then(function(Hi){return new Promise(function(Ni){oi.decodeDracoFile(Hi,function(xi){for(var $i in xi.attributes){var fr=xi.attributes[$i],ir=kt[$i];ir!==void 0&&(fr.normalized=ir)}Ni(xi)},Mi,Nt)})})};function ue(){this.name=i.KHR_TEXTURE_TRANSFORM}ue.prototype.extendTexture=function(si,Gt){return si=si.clone(),Gt.offset!==void 0&&si.offset.fromArray(Gt.offset),Gt.rotation!==void 0&&(si.rotation=Gt.rotation),Gt.scale!==void 0&&si.repeat.fromArray(Gt.scale),Gt.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),si.needsUpdate=!0,si};function ne(si){MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var Gt=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),ui=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),oi=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),Si=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),Li=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),Mi={specular:{value:new Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=Mi,this.onBeforeCompile=function(kt){for(var Nt in Mi)kt.uniforms[Nt]=Mi[Nt];kt.fragmentShader=kt.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",Gt).replace("#include <metalnessmap_pars_fragment>",ui).replace("#include <roughnessmap_fragment>",oi).replace("#include <metalnessmap_fragment>",Si).replace("#include <lights_physical_fragment>",Li)},Object.defineProperties(this,{specular:{get:function(){return Mi.specular.value},set:function(kt){Mi.specular.value=kt}},specularMap:{get:function(){return Mi.specularMap.value},set:function(kt){Mi.specularMap.value=kt,kt?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return Mi.glossiness.value},set:function(kt){Mi.glossiness.value=kt}},glossinessMap:{get:function(){return Mi.glossinessMap.value},set:function(kt){Mi.glossinessMap.value=kt,kt?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(si)}ne.prototype=Object.create(MeshStandardMaterial.prototype),ne.prototype.constructor=ne,ne.prototype.copy=function(si){return MeshStandardMaterial.prototype.copy.call(this,si),this.specularMap=si.specularMap,this.specular.copy(si.specular),this.glossinessMap=si.glossinessMap,this.glossiness=si.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this};function se(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return ne},extendParams:function(si,Gt,ui){var oi=Gt.extensions[this.name];si.color=new Color(1,1,1),si.opacity=1;var Si=[];if(Array.isArray(oi.diffuseFactor)){var Li=oi.diffuseFactor;si.color.fromArray(Li),si.opacity=Li[3]}if(oi.diffuseTexture!==void 0&&Si.push(ui.assignTexture(si,"map",oi.diffuseTexture)),si.emissive=new Color(0,0,0),si.glossiness=oi.glossinessFactor!==void 0?oi.glossinessFactor:1,si.specular=new Color(1,1,1),Array.isArray(oi.specularFactor)&&si.specular.fromArray(oi.specularFactor),oi.specularGlossinessTexture!==void 0){var Mi=oi.specularGlossinessTexture;Si.push(ui.assignTexture(si,"glossinessMap",Mi)),Si.push(ui.assignTexture(si,"specularMap",Mi))}return Promise.all(Si)},createMaterial:function(si){var Gt=new ne(si);return Gt.fog=!0,Gt.color=si.color,Gt.map=si.map===void 0?null:si.map,Gt.lightMap=null,Gt.lightMapIntensity=1,Gt.aoMap=si.aoMap===void 0?null:si.aoMap,Gt.aoMapIntensity=1,Gt.emissive=si.emissive,Gt.emissiveIntensity=1,Gt.emissiveMap=si.emissiveMap===void 0?null:si.emissiveMap,Gt.bumpMap=si.bumpMap===void 0?null:si.bumpMap,Gt.bumpScale=1,Gt.normalMap=si.normalMap===void 0?null:si.normalMap,Gt.normalMapType=TangentSpaceNormalMap,si.normalScale&&(Gt.normalScale=si.normalScale),Gt.displacementMap=null,Gt.displacementScale=1,Gt.displacementBias=0,Gt.specularMap=si.specularMap===void 0?null:si.specularMap,Gt.specular=si.specular,Gt.glossinessMap=si.glossinessMap===void 0?null:si.glossinessMap,Gt.glossiness=si.glossiness,Gt.alphaMap=null,Gt.envMap=si.envMap===void 0?null:si.envMap,Gt.envMapIntensity=1,Gt.refractionRatio=.98,Gt}}}function le(){this.name=i.KHR_MESH_QUANTIZATION}function he(si,Gt,ui,oi){Interpolant.call(this,si,Gt,ui,oi)}he.prototype=Object.create(Interpolant.prototype),he.prototype.constructor=he,he.prototype.copySampleValue_=function(si){for(var Gt=this.resultBuffer,ui=this.sampleValues,oi=this.valueSize,Si=si*oi*3+oi,Li=0;Li!==oi;Li++)Gt[Li]=ui[Si+Li];return Gt},he.prototype.beforeStart_=he.prototype.copySampleValue_,he.prototype.afterEnd_=he.prototype.copySampleValue_,he.prototype.interpolate_=function(si,Gt,ui,oi){for(var Si=this.resultBuffer,Li=this.sampleValues,Mi=this.valueSize,kt=Mi*2,Nt=Mi*3,gi=oi-Gt,Ri=(ui-Gt)/gi,Rt=Ri*Ri,Xt=Rt*Ri,Hi=si*Nt,Ni=Hi-Nt,xi=-2*Xt+3*Rt,$i=Xt-Rt,fr=1-xi,ir=$i-Rt+Ri,lr=0;lr!==Mi;lr++){var Tr=Li[Ni+lr+Mi],Rr=Li[Ni+lr+kt]*gi,Jr=Li[Hi+lr+Mi],_r=Li[Hi+lr]*gi;Si[lr]=fr*Tr+ir*Rr+xi*Jr+$i*_r}return Si};var me={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ge={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xt={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},Et={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},Lt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ht={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},It={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},Yt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ri(si,Gt){return typeof si!="string"||si===""?"":(/^https?:\/\//i.test(Gt)&&/^\//.test(si)&&(Gt=Gt.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(si)||/^data:.*,.*$/i.test(si)||/^blob:.*$/i.test(si)?si:Gt+si)}function ei(si){return si.DefaultMaterial===void 0&&(si.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),si.DefaultMaterial}function Ct(si,Gt,ui){for(var oi in ui.extensions)si[oi]===void 0&&(Gt.userData.gltfExtensions=Gt.userData.gltfExtensions||{},Gt.userData.gltfExtensions[oi]=ui.extensions[oi])}function Ut(si,Gt){Gt.extras!==void 0&&(typeof Gt.extras=="object"?Object.assign(si.userData,Gt.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Gt.extras))}function Mt(si,Gt,ui){for(var oi=!1,Si=!1,Li=0,Mi=Gt.length;Li<Mi;Li++){var kt=Gt[Li];if(kt.POSITION!==void 0&&(oi=!0),kt.NORMAL!==void 0&&(Si=!0),oi&&Si)break}if(!oi&&!Si)return Promise.resolve(si);for(var Nt=[],gi=[],Li=0,Mi=Gt.length;Li<Mi;Li++){var kt=Gt[Li];if(oi){var Ri=kt.POSITION!==void 0?ui.getDependency("accessor",kt.POSITION):si.attributes.position;Nt.push(Ri)}if(Si){var Ri=kt.NORMAL!==void 0?ui.getDependency("accessor",kt.NORMAL):si.attributes.normal;gi.push(Ri)}}return Promise.all([Promise.all(Nt),Promise.all(gi)]).then(function(Rt){var Xt=Rt[0],Hi=Rt[1];return oi&&(si.morphAttributes.position=Xt),Si&&(si.morphAttributes.normal=Hi),si.morphTargetsRelative=!0,si})}function $t(si,Gt){if(si.updateMorphTargets(),Gt.weights!==void 0)for(var ui=0,oi=Gt.weights.length;ui<oi;ui++)si.morphTargetInfluences[ui]=Gt.weights[ui];if(Gt.extras&&Array.isArray(Gt.extras.targetNames)){var Si=Gt.extras.targetNames;if(si.morphTargetInfluences.length===Si.length){si.morphTargetDictionary={};for(var ui=0,oi=Si.length;ui<oi;ui++)si.morphTargetDictionary[Si[ui]]=ui}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function jt(si){var Gt=si.extensions&&si.extensions[i.KHR_DRACO_MESH_COMPRESSION],ui;return Gt?ui="draco:"+Gt.bufferView+":"+Gt.indices+":"+mi(Gt.attributes):ui=si.indices+":"+mi(si.attributes)+":"+si.mode,ui}function mi(si){for(var Gt="",ui=Object.keys(si).sort(),oi=0,Si=ui.length;oi<Si;oi++)Gt+=ui[oi]+":"+si[ui[oi]]+";";return Gt}function Xi(si,Gt){this.json=si||{},this.extensions={},this.plugins={},this.options=Gt||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new ImageBitmapLoader(this.options.manager):this.textureLoader=new TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}Xi.prototype.setExtensions=function(si){this.extensions=si},Xi.prototype.setPlugins=function(si){this.plugins=si},Xi.prototype.parse=function(si,Gt){var ui=this,oi=this.json,Si=this.extensions;this.cache.removeAll(),this._invokeAll(function(Li){return Li._markDefs&&Li._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(Li){var Mi={scene:Li[0][oi.scene||0],scenes:Li[0],animations:Li[1],cameras:Li[2],asset:oi.asset,parser:ui,userData:{}};Ct(Si,Mi,oi),Ut(Mi,oi),si(Mi)}).catch(Gt)},Xi.prototype._markDefs=function(){for(var si=this.json.nodes||[],Gt=this.json.skins||[],ui=this.json.meshes||[],oi=0,Si=Gt.length;oi<Si;oi++)for(var Li=Gt[oi].joints,Mi=0,kt=Li.length;Mi<kt;Mi++)si[Li[Mi]].isBone=!0;for(var Nt=0,gi=si.length;Nt<gi;Nt++){var Ri=si[Nt];Ri.mesh!==void 0&&(this._addNodeRef(this.meshCache,Ri.mesh),Ri.skin!==void 0&&(ui[Ri.mesh].isSkinnedMesh=!0)),Ri.camera!==void 0&&this._addNodeRef(this.cameraCache,Ri.camera)}},Xi.prototype._addNodeRef=function(si,Gt){Gt!==void 0&&(si.refs[Gt]===void 0&&(si.refs[Gt]=si.uses[Gt]=0),si.refs[Gt]++)},Xi.prototype._getNodeRef=function(si,Gt,ui){if(si.refs[Gt]<=1)return ui;var oi=ui.clone();return oi.name+="_instance_"+si.uses[Gt]++,oi},Xi.prototype._invokeOne=function(si){var Gt=Object.values(this.plugins);Gt.push(this);for(var ui=0;ui<Gt.length;ui++){var oi=si(Gt[ui]);if(oi)return oi}},Xi.prototype._invokeAll=function(si){var Gt=Object.values(this.plugins);Gt.unshift(this);for(var ui=[],oi=0;oi<Gt.length;oi++){var Si=si(Gt[oi]);Si&&ui.push(Si)}return ui},Xi.prototype.getDependency=function(si,Gt){var ui=si+":"+Gt,oi=this.cache.get(ui);if(!oi){switch(si){case"scene":oi=this.loadScene(Gt);break;case"node":oi=this.loadNode(Gt);break;case"mesh":oi=this._invokeOne(function(Si){return Si.loadMesh&&Si.loadMesh(Gt)});break;case"accessor":oi=this.loadAccessor(Gt);break;case"bufferView":oi=this._invokeOne(function(Si){return Si.loadBufferView&&Si.loadBufferView(Gt)});break;case"buffer":oi=this.loadBuffer(Gt);break;case"material":oi=this._invokeOne(function(Si){return Si.loadMaterial&&Si.loadMaterial(Gt)});break;case"texture":oi=this._invokeOne(function(Si){return Si.loadTexture&&Si.loadTexture(Gt)});break;case"skin":oi=this.loadSkin(Gt);break;case"animation":oi=this.loadAnimation(Gt);break;case"camera":oi=this.loadCamera(Gt);break;default:throw new Error("Unknown type: "+si)}this.cache.add(ui,oi)}return oi},Xi.prototype.getDependencies=function(si){var Gt=this.cache.get(si);if(!Gt){var ui=this,oi=this.json[si+(si==="mesh"?"es":"s")]||[];Gt=Promise.all(oi.map(function(Si,Li){return ui.getDependency(si,Li)})),this.cache.add(si,Gt)}return Gt},Xi.prototype.loadBuffer=function(si){var Gt=this.json.buffers[si],ui=this.fileLoader;if(Gt.type&&Gt.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+Gt.type+" buffer type is not supported.");if(Gt.uri===void 0&&si===0)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var oi=this.options;return new Promise(function(Si,Li){ui.load(ri(Gt.uri,oi.path),Si,void 0,function(){Li(new Error('THREE.GLTFLoader: Failed to load buffer "'+Gt.uri+'".'))})})},Xi.prototype.loadBufferView=function(si){var Gt=this.json.bufferViews[si];return this.getDependency("buffer",Gt.buffer).then(function(ui){var oi=Gt.byteLength||0,Si=Gt.byteOffset||0;return ui.slice(Si,Si+oi)})},Xi.prototype.loadAccessor=function(si){var Gt=this,ui=this.json,oi=this.json.accessors[si];if(oi.bufferView===void 0&&oi.sparse===void 0)return Promise.resolve(null);var Si=[];return oi.bufferView!==void 0?Si.push(this.getDependency("bufferView",oi.bufferView)):Si.push(null),oi.sparse!==void 0&&(Si.push(this.getDependency("bufferView",oi.sparse.indices.bufferView)),Si.push(this.getDependency("bufferView",oi.sparse.values.bufferView))),Promise.all(Si).then(function(Li){var Mi=Li[0],kt=Lt[oi.type],Nt=ge[oi.componentType],gi=Nt.BYTES_PER_ELEMENT,Ri=gi*kt,Rt=oi.byteOffset||0,Xt=oi.bufferView!==void 0?ui.bufferViews[oi.bufferView].byteStride:void 0,Hi=oi.normalized===!0,Ni,xi;if(Xt&&Xt!==Ri){var $i=Math.floor(Rt/Xt),fr="InterleavedBuffer:"+oi.bufferView+":"+oi.componentType+":"+$i+":"+oi.count,ir=Gt.cache.get(fr);ir||(Ni=new Nt(Mi,$i*Xt,oi.count*Xt/gi),ir=new InterleavedBuffer(Ni,Xt/gi),Gt.cache.add(fr,ir)),xi=new InterleavedBufferAttribute(ir,kt,Rt%Xt/gi,Hi)}else Mi===null?Ni=new Nt(oi.count*kt):Ni=new Nt(Mi,Rt,oi.count*kt),xi=new BufferAttribute(Ni,kt,Hi);if(oi.sparse!==void 0){var lr=Lt.SCALAR,Tr=ge[oi.sparse.indices.componentType],Rr=oi.sparse.indices.byteOffset||0,Jr=oi.sparse.values.byteOffset||0,_r=new Tr(Li[1],Rr,oi.sparse.count*lr),mr=new Nt(Li[2],Jr,oi.sparse.count*kt);Mi!==null&&(xi=new BufferAttribute(xi.array.slice(),xi.itemSize,xi.normalized));for(var wr=0,Vr=_r.length;wr<Vr;wr++){var wn=_r[wr];if(xi.setX(wn,mr[wr*kt]),kt>=2&&xi.setY(wn,mr[wr*kt+1]),kt>=3&&xi.setZ(wn,mr[wr*kt+2]),kt>=4&&xi.setW(wn,mr[wr*kt+3]),kt>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return xi})},Xi.prototype.loadTexture=function(si){var Gt=this,ui=this.json,oi=this.options,Si=ui.textures[si],Li=Si.extensions||{},Mi;Li[i.MSFT_TEXTURE_DDS]?Mi=ui.images[Li[i.MSFT_TEXTURE_DDS].source]:Mi=ui.images[Si.source];var kt;return Mi.uri&&(kt=oi.manager.getHandler(Mi.uri)),kt||(kt=Li[i.MSFT_TEXTURE_DDS]?Gt.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(si,Mi,kt)},Xi.prototype.loadTextureImage=function(si,Gt,ui){var oi=this,Si=this.json,Li=this.options,Mi=Si.textures[si],kt=self.URL||self.webkitURL,Nt=Gt.uri,gi=!1,Ri=!0;return Gt.mimeType==="image/jpeg"&&(Ri=!1),Gt.bufferView!==void 0&&(Nt=oi.getDependency("bufferView",Gt.bufferView).then(function(Rt){if(Gt.mimeType==="image/png"){var Xt=new DataView(Rt,25,1).getUint8(0,!1);Ri=Xt===6||Xt===4||Xt===3}gi=!0;var Hi=new Blob([Rt],{type:Gt.mimeType});return Nt=kt.createObjectURL(Hi),Nt})),Promise.resolve(Nt).then(function(Rt){return new Promise(function(Xt,Hi){var Ni=Xt;ui.isImageBitmapLoader===!0&&(Ni=function(xi){Xt(new CanvasTexture(xi))}),ui.load(ri(Rt,Li.path),Ni,void 0,Hi)})}).then(function(Rt){gi===!0&&kt.revokeObjectURL(Nt),Rt.flipY=!1,Mi.name&&(Rt.name=Mi.name),Ri||(Rt.format=RGBFormat);var Xt=Si.samplers||{},Hi=Xt[Mi.sampler]||{};return Rt.magFilter=xt[Hi.magFilter]||LinearFilter,Rt.minFilter=xt[Hi.minFilter]||LinearMipmapLinearFilter,Rt.wrapS=Et[Hi.wrapS]||RepeatWrapping,Rt.wrapT=Et[Hi.wrapT]||RepeatWrapping,oi.associations.set(Rt,{type:"textures",index:si}),Rt})},Xi.prototype.assignTexture=function(si,Gt,ui){var oi=this;return this.getDependency("texture",ui.index).then(function(Si){if(ui.texCoord!==void 0&&ui.texCoord!=0&&!(Gt==="aoMap"&&ui.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+ui.texCoord+" for texture "+Gt+" not yet supported."),oi.extensions[i.KHR_TEXTURE_TRANSFORM]){var Li=ui.extensions!==void 0?ui.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;if(Li){var Mi=oi.associations.get(Si);Si=oi.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(Si,Li),oi.associations.set(Si,Mi)}}si[Gt]=Si})},Xi.prototype.assignFinalMaterial=function(si){var Gt=si.geometry,ui=si.material,oi=Gt.attributes.tangent!==void 0,Si=Gt.attributes.color!==void 0,Li=Gt.attributes.normal===void 0,Mi=si.isSkinnedMesh===!0,kt=Object.keys(Gt.morphAttributes).length>0,Nt=kt&&Gt.morphAttributes.normal!==void 0;if(si.isPoints){var gi="PointsMaterial:"+ui.uuid,Ri=this.cache.get(gi);Ri||(Ri=new PointsMaterial,Material.prototype.copy.call(Ri,ui),Ri.color.copy(ui.color),Ri.map=ui.map,Ri.sizeAttenuation=!1,this.cache.add(gi,Ri)),ui=Ri}else if(si.isLine){var gi="LineBasicMaterial:"+ui.uuid,Rt=this.cache.get(gi);Rt||(Rt=new LineBasicMaterial,Material.prototype.copy.call(Rt,ui),Rt.color.copy(ui.color),this.cache.add(gi,Rt)),ui=Rt}if(oi||Si||Li||Mi||kt){var gi="ClonedMaterial:"+ui.uuid+":";ui.isGLTFSpecularGlossinessMaterial&&(gi+="specular-glossiness:"),Mi&&(gi+="skinning:"),oi&&(gi+="vertex-tangents:"),Si&&(gi+="vertex-colors:"),Li&&(gi+="flat-shading:"),kt&&(gi+="morph-targets:"),Nt&&(gi+="morph-normals:");var Xt=this.cache.get(gi);Xt||(Xt=ui.clone(),Mi&&(Xt.skinning=!0),oi&&(Xt.vertexTangents=!0),Si&&(Xt.vertexColors=!0),Li&&(Xt.flatShading=!0),kt&&(Xt.morphTargets=!0),Nt&&(Xt.morphNormals=!0),this.cache.add(gi,Xt),this.associations.set(Xt,this.associations.get(ui))),ui=Xt}ui.aoMap&&Gt.attributes.uv2===void 0&&Gt.attributes.uv!==void 0&&Gt.setAttribute("uv2",Gt.attributes.uv),ui.normalScale&&!oi&&(ui.normalScale.y=-ui.normalScale.y),ui.clearcoatNormalScale&&!oi&&(ui.clearcoatNormalScale.y=-ui.clearcoatNormalScale.y),si.material=ui},Xi.prototype.getMaterialType=function(){return MeshStandardMaterial},Xi.prototype.loadMaterial=function(si){var Gt=this,ui=this.json,oi=this.extensions,Si=ui.materials[si],Li,Mi={},kt=Si.extensions||{},Nt=[];if(kt[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var gi=oi[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];Li=gi.getMaterialType(),Nt.push(gi.extendParams(Mi,Si,Gt))}else if(kt[i.KHR_MATERIALS_UNLIT]){var Ri=oi[i.KHR_MATERIALS_UNLIT];Li=Ri.getMaterialType(),Nt.push(Ri.extendParams(Mi,Si,Gt))}else{var Rt=Si.pbrMetallicRoughness||{};if(Mi.color=new Color(1,1,1),Mi.opacity=1,Array.isArray(Rt.baseColorFactor)){var Xt=Rt.baseColorFactor;Mi.color.fromArray(Xt),Mi.opacity=Xt[3]}Rt.baseColorTexture!==void 0&&Nt.push(Gt.assignTexture(Mi,"map",Rt.baseColorTexture)),Mi.metalness=Rt.metallicFactor!==void 0?Rt.metallicFactor:1,Mi.roughness=Rt.roughnessFactor!==void 0?Rt.roughnessFactor:1,Rt.metallicRoughnessTexture!==void 0&&(Nt.push(Gt.assignTexture(Mi,"metalnessMap",Rt.metallicRoughnessTexture)),Nt.push(Gt.assignTexture(Mi,"roughnessMap",Rt.metallicRoughnessTexture))),Li=this._invokeOne(function(Ni){return Ni.getMaterialType&&Ni.getMaterialType(si)}),Nt.push(Promise.all(this._invokeAll(function(Ni){return Ni.extendMaterialParams&&Ni.extendMaterialParams(si,Mi)})))}Si.doubleSided===!0&&(Mi.side=DoubleSide);var Hi=Si.alphaMode||Yt.OPAQUE;return Hi===Yt.BLEND?(Mi.transparent=!0,Mi.depthWrite=!1):(Mi.transparent=!1,Hi===Yt.MASK&&(Mi.alphaTest=Si.alphaCutoff!==void 0?Si.alphaCutoff:.5)),Si.normalTexture!==void 0&&Li!==MeshBasicMaterial&&(Nt.push(Gt.assignTexture(Mi,"normalMap",Si.normalTexture)),Mi.normalScale=new Vector2(1,1),Si.normalTexture.scale!==void 0&&Mi.normalScale.set(Si.normalTexture.scale,Si.normalTexture.scale)),Si.occlusionTexture!==void 0&&Li!==MeshBasicMaterial&&(Nt.push(Gt.assignTexture(Mi,"aoMap",Si.occlusionTexture)),Si.occlusionTexture.strength!==void 0&&(Mi.aoMapIntensity=Si.occlusionTexture.strength)),Si.emissiveFactor!==void 0&&Li!==MeshBasicMaterial&&(Mi.emissive=new Color().fromArray(Si.emissiveFactor)),Si.emissiveTexture!==void 0&&Li!==MeshBasicMaterial&&Nt.push(Gt.assignTexture(Mi,"emissiveMap",Si.emissiveTexture)),Promise.all(Nt).then(function(){var Ni;return Li===ne?Ni=oi[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(Mi):Ni=new Li(Mi),Si.name&&(Ni.name=Si.name),Ni.map&&(Ni.map.encoding=sRGBEncoding),Ni.emissiveMap&&(Ni.emissiveMap.encoding=sRGBEncoding),Ut(Ni,Si),Gt.associations.set(Ni,{type:"materials",index:si}),Si.extensions&&Ct(oi,Ni,Si),Ni})},Xi.prototype.createUniqueName=function(si){for(var Gt=PropertyBinding.sanitizeNodeName(si||""),ui=Gt,oi=1;this.nodeNamesUsed[ui];++oi)ui=Gt+"_"+oi;return this.nodeNamesUsed[ui]=!0,ui};function Er(si,Gt,ui){var oi=Gt.attributes,Si=new Box3;if(oi.POSITION!==void 0){var Li=ui.json.accessors[oi.POSITION],Mi=Li.min,kt=Li.max;if(Mi!==void 0&&kt!==void 0)Si.set(new Vector3(Mi[0],Mi[1],Mi[2]),new Vector3(kt[0],kt[1],kt[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;var Nt=Gt.targets;if(Nt!==void 0){for(var gi=new Vector3,Ri=new Vector3,Rt=0,Xt=Nt.length;Rt<Xt;Rt++){var Hi=Nt[Rt];if(Hi.POSITION!==void 0){var Li=ui.json.accessors[Hi.POSITION],Mi=Li.min,kt=Li.max;Mi!==void 0&&kt!==void 0?(Ri.setX(Math.max(Math.abs(Mi[0]),Math.abs(kt[0]))),Ri.setY(Math.max(Math.abs(Mi[1]),Math.abs(kt[1]))),Ri.setZ(Math.max(Math.abs(Mi[2]),Math.abs(kt[2]))),gi.max(Ri)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Si.expandByVector(gi)}si.boundingBox=Si;var Ni=new Sphere;Si.getCenter(Ni.center),Ni.radius=Si.min.distanceTo(Si.max)/2,si.boundingSphere=Ni}function Ir(si,Gt,ui){var oi=Gt.attributes,Si=[];function Li(gi,Ri){return ui.getDependency("accessor",gi).then(function(Rt){si.setAttribute(Ri,Rt)})}for(var Mi in oi){var kt=Zt[Mi]||Mi.toLowerCase();kt in si.attributes||Si.push(Li(oi[Mi],kt))}if(Gt.indices!==void 0&&!si.index){var Nt=ui.getDependency("accessor",Gt.indices).then(function(gi){si.setIndex(gi)});Si.push(Nt)}return Ut(si,Gt),Er(si,Gt,ui),Promise.all(Si).then(function(){return Gt.targets!==void 0?Mt(si,Gt.targets,ui):si})}function nr(si,Gt){var ui=si.getIndex();if(ui===null){var oi=[],Si=si.getAttribute("position");if(Si!==void 0){for(var Li=0;Li<Si.count;Li++)oi.push(Li);si.setIndex(oi),ui=si.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),si}var Mi=ui.count-2,kt=[];if(Gt===TriangleFanDrawMode)for(var Li=1;Li<=Mi;Li++)kt.push(ui.getX(0)),kt.push(ui.getX(Li)),kt.push(ui.getX(Li+1));else for(var Li=0;Li<Mi;Li++)Li%2===0?(kt.push(ui.getX(Li)),kt.push(ui.getX(Li+1)),kt.push(ui.getX(Li+2))):(kt.push(ui.getX(Li+2)),kt.push(ui.getX(Li+1)),kt.push(ui.getX(Li)));kt.length/3!==Mi&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var Nt=si.clone();return Nt.setIndex(kt),Nt}return Xi.prototype.loadGeometries=function(si){var Gt=this,ui=this.extensions,oi=this.primitiveCache;function Si(Xt){return ui[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(Xt,Gt).then(function(Hi){return Ir(Hi,Xt,Gt)})}for(var Li=[],Mi=0,kt=si.length;Mi<kt;Mi++){var Nt=si[Mi],gi=jt(Nt),Ri=oi[gi];if(Ri)Li.push(Ri.promise);else{var Rt;Nt.extensions&&Nt.extensions[i.KHR_DRACO_MESH_COMPRESSION]?Rt=Si(Nt):Rt=Ir(new BufferGeometry,Nt,Gt),oi[gi]={primitive:Nt,promise:Rt},Li.push(Rt)}}return Promise.all(Li)},Xi.prototype.loadMesh=function(si){for(var Gt=this,ui=this.json,oi=this.extensions,Si=ui.meshes[si],Li=Si.primitives,Mi=[],kt=0,Nt=Li.length;kt<Nt;kt++){var gi=Li[kt].material===void 0?ei(this.cache):this.getDependency("material",Li[kt].material);Mi.push(gi)}return Mi.push(Gt.loadGeometries(Li)),Promise.all(Mi).then(function(Ri){for(var Rt=Ri.slice(0,Ri.length-1),Xt=Ri[Ri.length-1],Hi=[],Ni=0,xi=Xt.length;Ni<xi;Ni++){var $i=Xt[Ni],fr=Li[Ni],ir,lr=Rt[Ni];if(fr.mode===me.TRIANGLES||fr.mode===me.TRIANGLE_STRIP||fr.mode===me.TRIANGLE_FAN||fr.mode===void 0)ir=Si.isSkinnedMesh===!0?new SkinnedMesh($i,lr):new Mesh($i,lr),ir.isSkinnedMesh===!0&&!ir.geometry.attributes.skinWeight.normalized&&ir.normalizeSkinWeights(),fr.mode===me.TRIANGLE_STRIP?ir.geometry=nr(ir.geometry,TriangleStripDrawMode):fr.mode===me.TRIANGLE_FAN&&(ir.geometry=nr(ir.geometry,TriangleFanDrawMode));else if(fr.mode===me.LINES)ir=new LineSegments($i,lr);else if(fr.mode===me.LINE_STRIP)ir=new Line($i,lr);else if(fr.mode===me.LINE_LOOP)ir=new LineLoop($i,lr);else if(fr.mode===me.POINTS)ir=new Points($i,lr);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+fr.mode);Object.keys(ir.geometry.morphAttributes).length>0&&$t(ir,Si),ir.name=Gt.createUniqueName(Si.name||"mesh_"+si),Ut(ir,Si),fr.extensions&&Ct(oi,ir,fr),Gt.assignFinalMaterial(ir),Hi.push(ir)}if(Hi.length===1)return Hi[0];for(var Tr=new Group,Ni=0,xi=Hi.length;Ni<xi;Ni++)Tr.add(Hi[Ni]);return Tr})},Xi.prototype.loadCamera=function(si){var Gt,ui=this.json.cameras[si],oi=ui[ui.type];if(!oi){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return ui.type==="perspective"?Gt=new PerspectiveCamera(MathUtils.radToDeg(oi.yfov),oi.aspectRatio||1,oi.znear||1,oi.zfar||2e6):ui.type==="orthographic"&&(Gt=new OrthographicCamera(-oi.xmag,oi.xmag,oi.ymag,-oi.ymag,oi.znear,oi.zfar)),ui.name&&(Gt.name=this.createUniqueName(ui.name)),Ut(Gt,ui),Promise.resolve(Gt)},Xi.prototype.loadSkin=function(si){var Gt=this.json.skins[si],ui={joints:Gt.joints};return Gt.inverseBindMatrices===void 0?Promise.resolve(ui):this.getDependency("accessor",Gt.inverseBindMatrices).then(function(oi){return ui.inverseBindMatrices=oi,ui})},Xi.prototype.loadAnimation=function(si){for(var Gt=this.json,ui=Gt.animations[si],oi=[],Si=[],Li=[],Mi=[],kt=[],Nt=0,gi=ui.channels.length;Nt<gi;Nt++){var Ri=ui.channels[Nt],Rt=ui.samplers[Ri.sampler],Xt=Ri.target,Hi=Xt.node!==void 0?Xt.node:Xt.id,Ni=ui.parameters!==void 0?ui.parameters[Rt.input]:Rt.input,xi=ui.parameters!==void 0?ui.parameters[Rt.output]:Rt.output;oi.push(this.getDependency("node",Hi)),Si.push(this.getDependency("accessor",Ni)),Li.push(this.getDependency("accessor",xi)),Mi.push(Rt),kt.push(Xt)}return Promise.all([Promise.all(oi),Promise.all(Si),Promise.all(Li),Promise.all(Mi),Promise.all(kt)]).then(function($i){for(var fr=$i[0],ir=$i[1],lr=$i[2],Tr=$i[3],Rr=$i[4],Jr=[],_r=0,mr=fr.length;_r<mr;_r++){var wr=fr[_r],Vr=ir[_r],wn=lr[_r],Nn=Tr[_r],zs=Rr[_r];if(wr!==void 0){wr.updateMatrix(),wr.matrixAutoUpdate=!0;var es;switch(Ht[zs.path]){case Ht.weights:es=NumberKeyframeTrack;break;case Ht.rotation:es=QuaternionKeyframeTrack;break;case Ht.position:case Ht.scale:default:es=VectorKeyframeTrack;break}var As=wr.name?wr.name:wr.uuid,Dn=Nn.interpolation!==void 0?It[Nn.interpolation]:InterpolateLinear,Sn=[];Ht[zs.path]===Ht.weights?wr.traverse(function(pi){pi.isMesh===!0&&pi.morphTargetInfluences&&Sn.push(pi.name?pi.name:pi.uuid)}):Sn.push(As);var Os=wn.array;if(wn.normalized){var Un;if(Os.constructor===Int8Array)Un=1/127;else if(Os.constructor===Uint8Array)Un=1/255;else if(Os.constructor==Int16Array)Un=1/32767;else if(Os.constructor===Uint16Array)Un=1/65535;else throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var Ks=new Float32Array(Os.length),xs=0,eo=Os.length;xs<eo;xs++)Ks[xs]=Os[xs]*Un;Os=Ks}for(var xs=0,eo=Sn.length;xs<eo;xs++){var rr=new es(Sn[xs]+"."+Ht[zs.path],Vr.array,Os,Dn);Nn.interpolation==="CUBICSPLINE"&&(rr.createInterpolant=function(ii){return new he(this.times,this.values,this.getValueSize()/3,ii)},rr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),Jr.push(rr)}}}var Ki=ui.name?ui.name:"animation_"+si;return new AnimationClip(Ki,void 0,Jr)})},Xi.prototype.loadNode=function(si){var Gt=this.json,ui=this.extensions,oi=this,Si=Gt.nodes[si],Li=Si.name?oi.createUniqueName(Si.name):"";return function(){var Mi=[];return Si.mesh!==void 0&&Mi.push(oi.getDependency("mesh",Si.mesh).then(function(kt){var Nt=oi._getNodeRef(oi.meshCache,Si.mesh,kt);return Si.weights!==void 0&&Nt.traverse(function(gi){if(gi.isMesh)for(var Ri=0,Rt=Si.weights.length;Ri<Rt;Ri++)gi.morphTargetInfluences[Ri]=Si.weights[Ri]}),Nt})),Si.camera!==void 0&&Mi.push(oi.getDependency("camera",Si.camera).then(function(kt){return oi._getNodeRef(oi.cameraCache,Si.camera,kt)})),oi._invokeAll(function(kt){return kt.createNodeAttachment&&kt.createNodeAttachment(si)}).forEach(function(kt){Mi.push(kt)}),Promise.all(Mi)}().then(function(Mi){var kt;if(Si.isBone===!0?kt=new Bone:Mi.length>1?kt=new Group:Mi.length===1?kt=Mi[0]:kt=new Object3D,kt!==Mi[0])for(var Nt=0,gi=Mi.length;Nt<gi;Nt++)kt.add(Mi[Nt]);if(Si.name&&(kt.userData.name=Si.name,kt.name=Li),Ut(kt,Si),Si.extensions&&Ct(ui,kt,Si),Si.matrix!==void 0){var Ri=new Matrix4;Ri.fromArray(Si.matrix),kt.applyMatrix4(Ri)}else Si.translation!==void 0&&kt.position.fromArray(Si.translation),Si.rotation!==void 0&&kt.quaternion.fromArray(Si.rotation),Si.scale!==void 0&&kt.scale.fromArray(Si.scale);return oi.associations.set(kt,{type:"nodes",index:si}),kt})},Xi.prototype.loadScene=function(){function si(Gt,ui,oi,Si){var Li=oi.nodes[Gt];return Si.getDependency("node",Gt).then(function(Mi){if(Li.skin===void 0)return Mi;var kt;return Si.getDependency("skin",Li.skin).then(function(Nt){kt=Nt;for(var gi=[],Ri=0,Rt=kt.joints.length;Ri<Rt;Ri++)gi.push(Si.getDependency("node",kt.joints[Ri]));return Promise.all(gi)}).then(function(Nt){return Mi.traverse(function(gi){if(gi.isMesh){for(var Ri=[],Rt=[],Xt=0,Hi=Nt.length;Xt<Hi;Xt++){var Ni=Nt[Xt];if(Ni){Ri.push(Ni);var xi=new Matrix4;kt.inverseBindMatrices!==void 0&&xi.fromArray(kt.inverseBindMatrices.array,Xt*16),Rt.push(xi)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',kt.joints[Xt])}gi.bind(new Skeleton(Ri,Rt),gi.matrixWorld)}}),Mi})}).then(function(Mi){ui.add(Mi);var kt=[];if(Li.children)for(var Nt=Li.children,gi=0,Ri=Nt.length;gi<Ri;gi++){var Rt=Nt[gi];kt.push(si(Rt,Mi,oi,Si))}return Promise.all(kt)})}return function(ui){var oi=this.json,Si=this.extensions,Li=this.json.scenes[ui],Mi=this,kt=new Group;Li.name&&(kt.name=Mi.createUniqueName(Li.name)),Ut(kt,Li),Li.extensions&&Ct(Si,kt,Li);for(var Nt=Li.nodes||[],gi=[],Ri=0,Rt=Nt.length;Ri<Rt;Ri++)gi.push(si(Nt[Ri],kt,oi,Mi));return Promise.all(gi).then(function(){return kt})}}(),e}(),DRACOLoader=function(e){Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};DRACOLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,i,r){var o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,l=>{var d={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(l,d).then(t).catch(r)},i,r)},decodeDracoFile:function(e,t,i,r){var o={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,o).then(t)},decodeGeometry:function(e,t){for(var i in t.attributeTypes){var r=t.attributeTypes[i];r.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[i]=r.name)}var o=JSON.stringify(t);if(DRACOLoader.taskCache.has(e)){var l=DRACOLoader.taskCache.get(e);if(l.key===o)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var d,n=this.workerNextTaskID++,S=e.byteLength,C=this._getWorker(n,S).then(I=>(d=I,new Promise((z,$)=>{d._callbacks[n]={resolve:z,reject:$},d.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(I=>this._createGeometry(I.geometry));return C.catch(()=>!0).then(()=>{d&&n&&this._releaseTask(d,n)}),DRACOLoader.taskCache.set(e,{key:o,promise:C}),C},_createGeometry:function(e){var t=new BufferGeometry;e.index&&t.setIndex(new BufferAttribute(e.index.array,1));for(var i=0;i<e.attributes.length;i++){var r=e.attributes[i],o=r.name,l=r.array,d=r.itemSize;t.setAttribute(o,new BufferAttribute(l,d))}return t},_loadLibrary:function(e,t){var i=new FileLoader(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,o)=>{i.load(e,r,void 0,o)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{var r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);var o=DRACOLoader.DRACOWorker.toString(),l=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){var i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(o){var l=o.data;switch(l.type){case"decode":i._callbacks[l.id].resolve(l);break;case"error":i._callbacks[l.id].reject(l);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+l.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(r,o){return r._taskLoad>o._taskLoad?-1:1});var i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}});DRACOLoader.DRACOWorker=function(){var e,t;onmessage=function(d){var n=d.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise(function(I){e.onModuleLoaded=function(z){I({draco:z})},DracoDecoderModule(e)});break;case"decode":var S=n.buffer,C=n.taskConfig;t.then(I=>{var z=I.draco,$=new z.Decoder,k=new z.DecoderBuffer;k.Init(new Int8Array(S),S.byteLength);try{var Y=i(z,$,k,C),ie=Y.attributes.map(ue=>ue.array.buffer);Y.index&&ie.push(Y.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:Y},ie)}catch(ue){console.error(ue),self.postMessage({type:"error",id:n.id,error:ue.message})}finally{z.destroy(k),z.destroy($)}});break}};function i(d,n,S,C){var I=C.attributeIDs,z=C.attributeTypes,$,k,Y=n.GetEncodedGeometryType(S);if(Y===d.TRIANGULAR_MESH)$=new d.Mesh,k=n.DecodeBufferToMesh(S,$);else if(Y===d.POINT_CLOUD)$=new d.PointCloud,k=n.DecodeBufferToPointCloud(S,$);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!k.ok()||$.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+k.error_msg());var ie={index:null,attributes:[]};for(var ue in I){var ne=self[z[ue]],se,le;if(C.useUniqueIDs)le=I[ue],se=n.GetAttributeByUniqueId($,le);else{if(le=n.GetAttributeId($,d[I[ue]]),le===-1)continue;se=n.GetAttribute($,le)}ie.attributes.push(o(d,n,$,ue,ne,se))}return Y===d.TRIANGULAR_MESH&&(ie.index=r(d,n,$)),d.destroy($),ie}function r(d,n,S){var C=S.num_faces(),I=C*3,z=I*4,$=d._malloc(z);n.GetTrianglesUInt32Array(S,z,$);var k=new Uint32Array(d.HEAPF32.buffer,$,I).slice();return d._free($),{array:k,itemSize:1}}function o(d,n,S,C,I,z){var $=z.num_components(),k=S.num_points(),Y=k*$,ie=Y*I.BYTES_PER_ELEMENT,ue=l(d,I),ne=d._malloc(ie);n.GetAttributeDataArrayForAllPoints(S,z,ue,ie,ne);var se=new I(d.HEAPF32.buffer,ne,Y).slice();return d._free(ne),{name:C,array:se,itemSize:$}}function l(d,n){switch(n){case Float32Array:return d.DT_FLOAT32;case Int8Array:return d.DT_INT8;case Int16Array:return d.DT_INT16;case Int32Array:return d.DT_INT32;case Uint8Array:return d.DT_UINT8;case Uint16Array:return d.DT_UINT16;case Uint32Array:return d.DT_UINT32}}};DRACOLoader.taskCache=new WeakMap;DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")};DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")};DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")};DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};const loadingManager=new LoadingManager,dracoLoader=new DRACOLoader(loadingManager);dracoLoader.setDecoderPath("/draco/");dracoLoader.preload();const gltfLoader=new GLTFLoader(loadingManager);gltfLoader.setDRACOLoader(dracoLoader);const textureLoader=new TextureLoader(loadingManager),three_client_tGRfCKfdfYyl0bh782SGeQnY25LfowEzl4Aod6XPPPU=defineNuxtPlugin(e=>{e.provide("loadingManager",loadingManager),e.provide("gltfLoader",gltfLoader),e.provide("dracoLoader",dracoLoader),e.provide("textureLoader",textureLoader)}),plugins=[payloadPlugin,revive_payload_client_kG4vF4SWGlhgLJRKrmco1O_zuG41odAu7e9PNPCDOtY,unhead_k2P3m_ZDyjlr2mMYnoDPwavjsDN8hBlk9cFai0bbopU,plugin$2,payload_client_kSYcIMYUswSDcSGoGWqM0MO2T4MjOZsQFA1GU6fqohM,navigation_repaint_client_iZ4sbIDUOBlI58WRS1dxkRZJOsKNs1c7SCqRszdxr6Y,check_outdated_build_client__GMdmUuNCTKDee9GyDhHz84CJEYUp5_FenYjvgAxtj8,chunk_reload_client_90gdG_aWZaDfO85SQYWzwaOywz7zi0wBnFUoX0cT54U,plugin$1,components_plugin_z4hgvsiddfKkfXTP6M8M4zG5Cb7sGnDhcryKVM45Di4,prefetch_client_plc8Lsxh1X10IEwNhW7mxf0MabjBz64b9ODLi87nY5E,plugin_xdQC2I5FZA9BN_8d8MWCXWAuqLDNRFNSkZczMVXWDIs,formkitPlugin_Kw9Zxpc32ie3g9uaRfiavVL004WiVJNxPefwwMCJMnU,plugin_MeUvTuoKUi51yb_kBguab6hdcExVXeTtZtTg9TZZBB8,plugin_YOxzu2Rgn246XMgfphZEXZjtzJTMGWdPuDf_KLI_O_0,anchorLink_client_PnNjYGGSONZ4ix3GhG52AVxoLIunpcMpAkwxAQrVbYc,appear_client_QSSBpnX1nUESVH9z3IXtcZEY3BVqlibKSWIGbyPIRKg,gsap_client_4O_KCpEZFi9No8UfLrmvzlvCUnQWraJAKw3RsIfcXlg,lenis_client_4LxE3teLPytGU5rsn7QUsqpmbs5IWA12TrrawL01aN0,lottie_client_TETKLg2oYPPADqer81OFjqzB5fggVha_BKSZAO_ZtKQ,mapbox_client_Bztpt0Op2U2nahZGD_h7eJHr8OpAGomgXEw7SLTeMOw,three_client_tGRfCKfdfYyl0bh782SGeQnY25LfowEzl4Aod6XPPPU],_export_sfc=(e,t)=>{const i=e.__vccOpts||e;for(const[r,o]of t)i[r]=o;return i},_hoisted_1$8={class:"the-logo"},_hoisted_2$3={key:0,class:"the-logo__text-2"},_hoisted_3$3={key:1,class:"the-logo__text",viewBox:"0 0 143 27",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},_sfc_main$d={__name:"TheLogo",props:{text:{type:Boolean,default:!1},symbol:{type:Boolean,default:!0}},setup(e){return(t,i)=>(openBlock(),createElementBlock("div",_hoisted_1$8,[i[1]||(i[1]=createBaseVNode("svg",{class:"the-logo__symbol",viewBox:"0 0 38 27",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[createBaseVNode("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M18.6917 0.619392C16.1092 0.619393 14.0156 2.71296 14.0156 5.29551V5.29551C14.0156 6.34901 13.8511 7.47077 13.1062 8.2157L8.00989 13.312C7.02386 14.298 5.51721 14.4829 4.13212 14.6442C3.12261 14.7618 2.14407 15.2078 1.3696 15.9823C-0.456535 17.8084 -0.456535 20.7692 1.3696 22.5953C3.19574 24.4214 6.1565 24.4214 7.98264 22.5953C8.81907 21.7589 9.27239 20.6844 9.34259 19.59C9.44173 18.0444 9.54528 16.3231 10.6404 15.228L16.2119 9.6565C16.36 9.50833 16.5862 9.4772 16.7774 9.56308V9.56308C16.9584 9.64443 17.0843 9.82004 17.0843 10.0185V12.4805C17.0843 13.9525 16.047 15.1969 15.1028 16.3261C14.4241 17.1378 14.0156 18.1831 14.0156 19.3239C14.0156 21.9064 16.1092 24 18.6917 24C19.8325 24 20.8778 23.5915 21.6895 22.9128C22.8188 21.9686 24.0631 20.9313 25.5352 20.9313H25.8867C27.3587 20.9313 28.6031 21.9686 29.7324 22.9128C30.544 23.5915 31.5894 24 32.7301 24C35.3127 24 37.4062 21.9064 37.4062 19.3239C37.4062 16.7413 35.3127 14.6478 32.7301 14.6478C31.5894 14.6478 30.544 15.0562 29.7324 15.7349C28.6031 16.6792 27.3587 17.7165 25.8867 17.7165H25.1167C23.896 17.7165 22.8614 16.8805 21.9983 16.0174V16.0174C21.1351 15.1542 20.2992 14.1196 20.2992 12.899V12.1389C20.2992 10.6669 21.3364 9.42254 22.2807 8.29328C22.9594 7.48163 23.3679 6.43627 23.3679 5.29551C23.3679 2.71296 21.2743 0.619392 18.6917 0.619392Z"})],-1)),e.text?(openBlock(),createElementBlock("div",_hoisted_2$3,"Alphane Labs")):(openBlock(),createElementBlock("svg",_hoisted_3$3,i[0]||(i[0]=[createBaseVNode("path",{d:"M0.192 22L6.48 5.2H9.768L16.032 22H13.08L11.496 17.848H4.608L3.048 22H0.192ZM5.376 15.496H10.728L8.04 8.176L5.376 15.496ZM17.0108 5.2H19.6028V22H17.0108V5.2ZM31.2396 10.336C32.1036 10.84 32.7996 11.56 33.3036 12.52C33.7836 13.48 34.0476 14.584 34.0476 15.856C34.0476 17.104 33.7836 18.208 33.3036 19.168C32.7996 20.128 32.1036 20.848 31.2396 21.376C30.3516 21.904 29.3436 22.144 28.2396 22.144C27.3276 22.144 26.5356 21.976 25.8636 21.64C25.1916 21.304 24.6396 20.848 24.2556 20.272V26.8H21.6636V9.712H23.9196L24.2316 11.536C25.2156 10.24 26.5596 9.568 28.2396 9.568C29.3436 9.568 30.3516 9.832 31.2396 10.336ZM30.3996 18.808C31.0716 18.04 31.4076 17.056 31.4076 15.856C31.4076 14.656 31.0716 13.672 30.3996 12.904C29.7276 12.16 28.8636 11.776 27.8076 11.776C26.7276 11.776 25.8636 12.16 25.2156 12.904C24.5436 13.648 24.2316 14.608 24.2316 15.808C24.2316 17.056 24.5436 18.04 25.2156 18.808C25.8636 19.576 26.7276 19.96 27.8076 19.96C28.8636 19.96 29.7276 19.576 30.3996 18.808ZM45.6765 10.912C46.5885 11.824 47.0685 13.264 47.0685 15.232V22H44.4765V15.376C44.4765 14.224 44.2125 13.336 43.7085 12.712C43.2045 12.112 42.4845 11.8 41.5245 11.8C40.4925 11.8 39.6765 12.16 39.1005 12.88C38.5245 13.6 38.2365 14.56 38.2365 15.784V22H35.6445V5.2H38.2365V11.488C39.1485 10.216 40.4445 9.568 42.1005 9.568C43.5645 9.568 44.7645 10.024 45.6765 10.912ZM60.7058 19.744V22H59.3378C58.5218 22 57.9458 21.832 57.6098 21.496C57.2498 21.16 57.0818 20.68 57.0818 20.032C56.1458 21.448 54.8018 22.144 53.0258 22.144C51.6338 22.144 50.5298 21.832 49.7138 21.184C48.8738 20.56 48.4658 19.672 48.4658 18.544C48.4658 17.296 48.8978 16.312 49.8098 15.64C50.6978 14.968 51.9938 14.608 53.7218 14.608H56.8178V13.864C56.8178 13.192 56.5778 12.64 56.0978 12.256C55.6178 11.872 54.9458 11.656 54.1058 11.656C53.3378 11.656 52.7138 11.824 52.2338 12.16C51.7538 12.496 51.4658 12.928 51.3698 13.456H48.8258C48.9458 12.232 49.4978 11.272 50.4578 10.6C51.4178 9.928 52.6658 9.568 54.2258 9.568C55.8578 9.568 57.1298 9.952 58.0418 10.72C58.9298 11.488 59.3858 12.592 59.3858 14.032V18.88C59.3858 19.456 59.6498 19.744 60.2018 19.744H60.7058ZM56.8178 16.528H53.6018C52.7858 16.528 52.1858 16.696 51.7538 17.008C51.3218 17.32 51.1058 17.776 51.1058 18.376C51.1058 18.904 51.2978 19.336 51.7058 19.648C52.1138 19.984 52.6658 20.128 53.3858 20.128C54.4418 20.128 55.2818 19.84 55.8818 19.264C56.4818 18.688 56.7938 17.92 56.8178 16.96V16.528ZM71.6696 10.912C72.5816 11.824 73.0616 13.264 73.0616 15.232V22H70.4456V15.376C70.4456 14.224 70.1816 13.336 69.7016 12.712C69.1976 12.112 68.4776 11.8 67.5176 11.8C66.4856 11.8 65.6696 12.16 65.0936 12.88C64.5176 13.6 64.2296 14.56 64.2296 15.808V22H61.6376V9.712H63.8936L64.1816 11.32C65.0936 10.168 66.4136 9.568 68.1176 9.568C69.5576 9.568 70.7576 10.024 71.6696 10.912ZM75.2269 12.568C75.7309 11.608 76.4269 10.888 77.3389 10.36C78.2509 9.832 79.2829 9.568 80.4589 9.568C81.6349 9.568 82.6669 9.808 83.5789 10.288C84.4909 10.768 85.1869 11.464 85.7149 12.328C86.2429 13.216 86.5069 14.248 86.5309 15.424C86.5309 15.76 86.5069 16.072 86.4589 16.408H77.1949V16.552C77.2429 17.632 77.5789 18.472 78.2029 19.096C78.8029 19.72 79.6189 20.032 80.6269 20.032C81.4189 20.032 82.0909 19.864 82.6429 19.48C83.1709 19.096 83.5309 18.568 83.7229 17.872H86.3149C86.0749 19.12 85.4749 20.152 84.4909 20.944C83.5069 21.76 82.2829 22.144 80.8189 22.144C79.5229 22.144 78.4189 21.904 77.4589 21.376C76.4989 20.848 75.7789 20.128 75.2509 19.168C74.7229 18.232 74.4829 17.128 74.4829 15.88C74.4829 14.632 74.7229 13.528 75.2269 12.568ZM83.8909 14.512C83.7709 13.624 83.4109 12.928 82.8109 12.424C82.2109 11.92 81.4669 11.656 80.5549 11.656C79.6909 11.656 78.9709 11.92 78.3469 12.448C77.7229 12.976 77.3869 13.648 77.2909 14.512H83.8909ZM94.071 22V5.2H96.831V19.552H104.055V22H94.071ZM116.993 19.744V22H115.625C114.809 22 114.233 21.832 113.897 21.496C113.537 21.16 113.369 20.68 113.369 20.032C112.433 21.448 111.089 22.144 109.313 22.144C107.921 22.144 106.817 21.832 106.001 21.184C105.161 20.56 104.753 19.672 104.753 18.544C104.753 17.296 105.185 16.312 106.097 15.64C106.985 14.968 108.281 14.608 110.009 14.608H113.105V13.864C113.105 13.192 112.865 12.64 112.385 12.256C111.905 11.872 111.233 11.656 110.393 11.656C109.625 11.656 109.001 11.824 108.521 12.16C108.041 12.496 107.753 12.928 107.657 13.456H105.113C105.233 12.232 105.785 11.272 106.745 10.6C107.705 9.928 108.953 9.568 110.513 9.568C112.145 9.568 113.417 9.952 114.329 10.72C115.217 11.488 115.673 12.592 115.673 14.032V18.88C115.673 19.456 115.937 19.744 116.489 19.744H116.993ZM113.105 16.528H109.889C109.073 16.528 108.473 16.696 108.041 17.008C107.609 17.32 107.393 17.776 107.393 18.376C107.393 18.904 107.585 19.336 107.993 19.648C108.401 19.984 108.953 20.128 109.673 20.128C110.729 20.128 111.569 19.84 112.169 19.264C112.769 18.688 113.081 17.92 113.105 16.96V16.528ZM127.501 10.336C128.365 10.84 129.061 11.56 129.565 12.496C130.045 13.456 130.309 14.56 130.309 15.856C130.309 17.104 130.045 18.184 129.565 19.144C129.061 20.104 128.365 20.824 127.501 21.352C126.613 21.88 125.605 22.144 124.501 22.144C123.589 22.144 122.797 21.976 122.125 21.64C121.453 21.304 120.901 20.824 120.493 20.224L120.181 22H117.925V5.2H120.517V11.536C121.477 10.24 122.821 9.568 124.501 9.568C125.605 9.568 126.613 9.832 127.501 10.336ZM126.661 18.832C127.333 18.064 127.669 17.08 127.669 15.856C127.669 14.656 127.333 13.696 126.661 12.928C125.989 12.16 125.125 11.776 124.069 11.776C122.989 11.776 122.125 12.16 121.477 12.904C120.805 13.672 120.493 14.632 120.493 15.832C120.493 17.056 120.805 18.04 121.477 18.808C122.125 19.576 122.989 19.96 124.069 19.96C125.125 19.96 125.989 19.6 126.661 18.832ZM133.9 17.944C133.948 18.592 134.236 19.12 134.788 19.528C135.34 19.936 136.06 20.128 136.948 20.128C137.716 20.128 138.364 19.984 138.844 19.696C139.324 19.408 139.588 19 139.588 18.496C139.588 18.088 139.468 17.776 139.252 17.56C139.012 17.368 138.724 17.224 138.34 17.128C137.956 17.032 137.38 16.936 136.612 16.84C135.532 16.72 134.644 16.552 133.948 16.336C133.252 16.12 132.7 15.784 132.268 15.304C131.836 14.824 131.644 14.2 131.644 13.384C131.644 12.64 131.836 11.968 132.268 11.392C132.7 10.816 133.276 10.36 134.02 10.024C134.764 9.712 135.604 9.544 136.564 9.544C138.1 9.544 139.372 9.904 140.332 10.576C141.292 11.272 141.82 12.232 141.916 13.48H139.396C139.324 12.928 139.036 12.472 138.556 12.112C138.052 11.752 137.428 11.56 136.684 11.56C135.916 11.56 135.316 11.704 134.86 11.992C134.38 12.28 134.164 12.688 134.164 13.168C134.164 13.552 134.26 13.816 134.5 14.008C134.74 14.2 135.028 14.32 135.388 14.392C135.724 14.464 136.3 14.536 137.092 14.632C138.148 14.752 139.036 14.92 139.756 15.16C140.476 15.4 141.052 15.76 141.484 16.264C141.916 16.768 142.132 17.44 142.132 18.304C142.132 19.072 141.892 19.768 141.46 20.344C141.004 20.92 140.38 21.376 139.612 21.688C138.82 22 137.932 22.144 136.972 22.144C135.316 22.144 133.972 21.784 132.964 21.04C131.956 20.296 131.428 19.264 131.404 17.944H133.9Z"},null,-1)])))]))}},__nuxt_component_0$2=_export_sfc(_sfc_main$d,[["__scopeId","data-v-02d3edc4"]]),_sfc_main$c={__name:"TheNavItem",props:{text:{type:String,default:"Nav item"},link:{type:Object,required:!0}},setup(e){return(t,i)=>{var o,l,d;const r=__nuxt_component_0$3;return openBlock(),createBlock(r,{class:"the-nav__item",to:((o=e.link)==null?void 0:o.url)||((l=e.link)==null?void 0:l.cached_url),target:((d=e.link)==null?void 0:d.target)||"_self"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.text),1)]),_:1},8,["to","target"])}}},__nuxt_component_1$1=_export_sfc(_sfc_main$c,[["__scopeId","data-v-e68c9426"]]),_hoisted_1$7={class:"the-nav"},_sfc_main$b={__name:"TheNav",props:{navList:{type:Array,required:!0}},setup(e){const t=e;return(i,r)=>{const o=__nuxt_component_1$1;return openBlock(),createElementBlock("nav",_hoisted_1$7,[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.navList,(l,d)=>(openBlock(),createBlock(o,{text:l==null?void 0:l.text,link:l==null?void 0:l.link},null,8,["text","link"]))),256))])}}},__nuxt_component_2=_export_sfc(_sfc_main$b,[["__scopeId","data-v-3401bb26"]]),defaultIconDimensions=Object.freeze({left:0,top:0,width:16,height:16}),defaultIconTransformations=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),defaultIconProps=Object.freeze({...defaultIconDimensions,...defaultIconTransformations});Object.freeze({...defaultIconProps,body:"",hidden:!1});function iconToHTML(e,t){let i=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const r in t)i+=" "+r+'="'+t[r]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+i+">"+e+"</svg>"}const unitsSplit=/(-?[0-9.]*[0-9]+[0-9.]*)/g,unitsTest=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function calculateSize(e,t,i){if(t===1)return e;if(i=i||100,typeof e=="number")return Math.ceil(e*t*i)/i;if(typeof e!="string")return e;const r=e.split(unitsSplit);if(r===null||!r.length)return e;const o=[];let l=r.shift(),d=unitsTest.test(l);for(;;){if(d){const n=parseFloat(l);isNaN(n)?o.push(l):o.push(Math.ceil(n*t*i)/i)}else o.push(l);if(l=r.shift(),l===void 0)return o.join("");d=!d}}function encodeSVGforURL(e){return e.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function svgToData(e){return"data:image/svg+xml,"+encodeSVGforURL(e)}function svgToURL(e){return'url("'+svgToData(e)+'")'}function makeViewBoxSquare(e){const[t,i,r,o]=e;if(r!==o){const l=Math.max(r,o);return[t-(l-r)/2,i-(l-o)/2,l,l]}return e}const defaultIconSizeCustomisations=Object.freeze({width:null,height:null}),defaultIconCustomisations=Object.freeze({...defaultIconSizeCustomisations,...defaultIconTransformations});function splitSVGDefs(e,t="defs"){let i="";const r=e.indexOf("<"+t);for(;r>=0;){const o=e.indexOf(">",r),l=e.indexOf("</"+t);if(o===-1||l===-1)break;const d=e.indexOf(">",l);if(d===-1)break;i+=e.slice(o+1,l).trim(),e=e.slice(0,r).trim()+e.slice(d+1)}return{defs:i,content:e}}function mergeDefsAndContent(e,t){return e?"<defs>"+e+"</defs>"+t:t}function wrapSVGContent(e,t,i){const r=splitSVGDefs(e);return mergeDefsAndContent(r.defs,t+r.content+i)}const isUnsetKeyword=e=>e==="unset"||e==="undefined"||e==="none";function iconToSVG(e,t){const i={...defaultIconProps,...e},r={...defaultIconCustomisations,...t},o={left:i.left,top:i.top,width:i.width,height:i.height};let l=i.body;[i,r].forEach(ie=>{const ue=[],ne=ie.hFlip,se=ie.vFlip;let le=ie.rotate;ne?se?le+=2:(ue.push("translate("+(o.width+o.left).toString()+" "+(0-o.top).toString()+")"),ue.push("scale(-1 1)"),o.top=o.left=0):se&&(ue.push("translate("+(0-o.left).toString()+" "+(o.height+o.top).toString()+")"),ue.push("scale(1 -1)"),o.top=o.left=0);let he;switch(le<0&&(le-=Math.floor(le/4)*4),le=le%4,le){case 1:he=o.height/2+o.top,ue.unshift("rotate(90 "+he.toString()+" "+he.toString()+")");break;case 2:ue.unshift("rotate(180 "+(o.width/2+o.left).toString()+" "+(o.height/2+o.top).toString()+")");break;case 3:he=o.width/2+o.left,ue.unshift("rotate(-90 "+he.toString()+" "+he.toString()+")");break}le%2===1&&(o.left!==o.top&&(he=o.left,o.left=o.top,o.top=he),o.width!==o.height&&(he=o.width,o.width=o.height,o.height=he)),ue.length&&(l=wrapSVGContent(l,'<g transform="'+ue.join(" ")+'">',"</g>"))});const d=r.width,n=r.height,S=o.width,C=o.height;let I,z;d===null?(z=n===null?"1em":n==="auto"?C:n,I=calculateSize(z,S/C)):(I=d==="auto"?S:d,z=n===null?calculateSize(I,C/S):n==="auto"?C:n);const $={},k=(ie,ue)=>{isUnsetKeyword(ue)||($[ie]=ue.toString())};k("width",I),k("height",z);const Y=[o.left,o.top,S,C];return $.viewBox=Y.join(" "),{attributes:$,viewBox:Y,body:l}}function getCommonCSSRules(e){const t={display:"inline-block",width:"1em",height:"1em"},i=e.varName;switch(e.pseudoSelector&&(t.content="''"),e.mode){case"background":i&&(t["background-image"]="var(--"+i+")"),t["background-repeat"]="no-repeat",t["background-size"]="100% 100%";break;case"mask":t["background-color"]="currentColor",i&&(t["mask-image"]=t["-webkit-mask-image"]="var(--"+i+")"),t["mask-repeat"]=t["-webkit-mask-repeat"]="no-repeat",t["mask-size"]=t["-webkit-mask-size"]="100% 100%";break}return t}function generateItemCSSRules(e,t){const i={},r=t.varName,o=iconToSVG(e);let l=o.viewBox;l[2]!==l[3]&&(t.forceSquare?l=makeViewBoxSquare(l):i.width=calculateSize("1em",l[2]/l[3]));const d=iconToHTML(o.body.replace(/currentColor/g,t.color||"black"),{viewBox:`${l[0]} ${l[1]} ${l[2]} ${l[3]}`,width:`${l[2]}`,height:`${l[3]}`}),n=svgToURL(d);if(r)i["--"+r]=n;else switch(t.mode){case"background":i["background-image"]=n;break;case"mask":i["mask-image"]=i["-webkit-mask-image"]=n;break}return i}const format={selectorStart:{compressed:"{",compact:" {",expanded:" {"},selectorEnd:{compressed:"}",compact:`; }
`,expanded:`;
}
`},rule:{compressed:"{key}:",compact:" {key}: ",expanded:`
  {key}: `}};function formatCSS(e,t="expanded"){const i=[];for(let r=0;r<e.length;r++){const{selector:o,rules:l}=e[r];let n=(o instanceof Array?o.join(t==="compressed"?",":", "):o)+format.selectorStart[t],S=!0;for(const C in l)S||(n+=";"),n+=format.rule[t].replace("{key}",C)+l[C],S=!1;n+=format.selectorEnd[t],i.push(n)}return i.join(t==="compressed"?"":`
`)}function getIconCSS(e,t={}){const i=t.customise?t.customise(e.body):e.body,r=t.mode||(t.color||!i.includes("currentColor")?"background":"mask");let o=t.varName;o===void 0&&r==="mask"&&(o="svg");const l={...t,mode:r,varName:o};r==="background"&&delete l.varName;const d={...t.rules,...getCommonCSSRules(l),...generateItemCSSRules({...defaultIconProps,...e,body:i},l)},n=t.iconSelector||".icon";return formatCSS([{selector:n,rules:d}],l.format)}async function loadIcon(e,t){if(!e)return null;const i=getIcon(e);return i||(await loadIcon$1(e).catch(()=>(console.warn(`[Icon] failed to load icon \`${e}\``),null)),getIcon(e))}function useResolvedName(e){const t=useAppConfig().icon,i=(t.collections||[]).sort((r,o)=>o.length-r.length);return computed(()=>{var d;const r=e(),o=r.startsWith(t.cssSelectorPrefix)?r.slice(t.cssSelectorPrefix.length):r,l=((d=t.aliases)==null?void 0:d[o])||o;if(!l.includes(":")){const n=i.find(S=>l.startsWith(S+"-"));return n?n+":"+l.slice(n.length+1):l}return l})}function resolveCustomizeFn(e,t){if(e!==!1)return e===!0||e===null?t:e}let cssSelectors;function escapeCssSelector(e){return e.replace(/([^\w-])/g,"\\$1")}function getAllSelectors(){if(cssSelectors)return cssSelectors;cssSelectors=new Set;const e=i=>{if(i=i.replace(/^:where\((.*)\)$/,"$1").trim(),i.startsWith("."))return i},t=i=>{if(i!=null&&i.length)for(const r of i){r!=null&&r.cssRules&&t(r.cssRules);const o=r==null?void 0:r.selectorText;if(typeof o=="string"){const l=e(o);l&&cssSelectors.add(l)}}};if(typeof document<"u")for(const i of document.styleSheets)try{const r=i.cssRules||i.rules;t(r)}catch{}return cssSelectors}const NuxtIconCss=defineComponent({name:"NuxtIconCss",props:{name:{type:String,required:!0},customize:{type:[Function,Boolean,null],default:null,required:!1}},setup(e){const t=useNuxtApp(),i=useAppConfig().icon,r=computed(()=>e.name?i.cssSelectorPrefix+e.name:"");function o(n){var I,z;if(!n)return;const S=getIcon(n);if(S)return S;const C=(z=(I=t.payload)==null?void 0:I.data)==null?void 0:z[n];if(C)return addIcon(n,C),C}const l=computed(()=>"."+escapeCssSelector(r.value));function d(n,S=!0){let C=l.value;i.cssWherePseudo&&(C=`:where(${C})`);const I=getIconCSS(n,{iconSelector:C,format:"compressed",customise:resolveCustomizeFn(e.customize,i.customize)});return i.cssLayer&&S?`@layer ${i.cssLayer} { ${I} }`:I}{const n=getAllSelectors();async function S(C){if(n.has(l.value)||typeof document>"u")return;const I=document.createElement("style");I.textContent=d(C);const z=document.head.querySelector('style, link[rel="stylesheet"]');z?document.head.insertBefore(I,z):document.head.appendChild(I),n.add(l.value)}watch$1(()=>e.name,()=>{if(n.has(l.value))return;const C=o(e.name);C?S(C):loadIcon(e.name).then(I=>{I&&S(I)}).catch(()=>null)},{immediate:!0})}return()=>h("span",{class:["iconify",r.value]})}}),NuxtIconSvg=defineComponent({name:"NuxtIconSvg",props:{name:{type:String,required:!0},customize:{type:[Function,Boolean,null],default:null,required:!1}},setup(e,{slots:t}){const i=useNuxtApp(),r=useAppConfig().icon,o=useResolvedName(()=>e.name),l="i-"+o.value;if(o.value){const d=i.payload.data[l];d&&addIcon(o.value,d)}return()=>h(Icon,{icon:o.value,ssr:!0,customise:resolveCustomizeFn(e.customize,r.customize)},t)}}),__nuxt_component_0$1=defineComponent({name:"NuxtIcon",props:{name:{type:String,required:!0},mode:{type:String,required:!1,default:null},size:{type:[Number,String],required:!1,default:null},customize:{type:[Function,Boolean,null],default:null,required:!1}},setup(e,{slots:t}){const i=useNuxtApp(),r=useAppConfig().icon,o=useResolvedName(()=>e.name),l=computed(()=>{var n;return((n=i.vueApp)==null?void 0:n.component(o.value))||((e.mode||r.mode)==="svg"?NuxtIconSvg:NuxtIconCss)}),d=computed(()=>{const n=e.size||r.size;return n?{fontSize:Number.isNaN(+n)?n:n+"px"}:null});return()=>h(l.value,{...r.attrs,name:o.value,class:r.class,style:d.value,customize:e.customize},t)}}),index=Object.freeze(Object.defineProperty({__proto__:null,default:__nuxt_component_0$1},Symbol.toStringTag,{value:"Module"})),_hoisted_1$6=["href","target"],_sfc_main$a={__name:"TagA",props:["link","target"],setup(e){const t=e;return(i,r)=>(openBlock(),createElementBlock("a",{href:t.link,target:t.target},[renderSlot(i.$slots,"default")],8,_hoisted_1$6))}},_hoisted_1$5={type:"button",class:"--button-reset"},_sfc_main$9={__name:"TagButton",props:["link","target"],setup(e){return(t,i)=>(openBlock(),createElementBlock("button",_hoisted_1$5,[renderSlot(t.$slots,"default")]))}},_sfc_main$8={__name:"TagNuxtLink",props:["link","target"],setup(e){const t=e;return(i,r)=>{const o=__nuxt_component_0$3;return openBlock(),createBlock(o,{to:t.link,target:t.target},{default:withCtx(()=>[renderSlot(i.$slots,"default")]),_:3},8,["to","target"])}}},_hoisted_1$4={class:"buttons-main__text"},_hoisted_2$2={key:0,class:"buttons-main__icon"},_hoisted_3$2={class:"buttons-main__icon__mover"},_sfc_main$7={__name:"ButtonsMain",props:{options:{type:Object,default:()=>({text:"Text not specified",link:{url:"#",target:"_self"},icon:"",type:"default",tag:"a"})}},setup(e){const t={a:_sfc_main$a,button:_sfc_main$9,"nuxt-link":_sfc_main$8};return(i,r)=>{const o=__nuxt_component_0$1;return openBlock(),createBlock(resolveDynamicComponent(t[e.options.tag]),{class:normalizeClass(["buttons-main",`--type-${e.options.type}`]),link:e.options.link.url,target:e.options.link.target},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$4,[createBaseVNode("span",null,toDisplayString(e.options.text),1)]),e.options.icon?(openBlock(),createElementBlock("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(o,{name:e.options.icon,size:"1.25rem"},null,8,["name"]),createVNode(o,{name:e.options.icon,size:"1.25rem"},null,8,["name"])])])):createCommentVNode("",!0)]),_:1},8,["class","link","target"])}}},__nuxt_component_1=_export_sfc(_sfc_main$7,[["__scopeId","data-v-14dc68d8"]]),_sfc_main$6={__name:"ResolversButton",props:{blok:Array},setup(e){return(t,i)=>{const r=__nuxt_component_1;return openBlock(!0),createElementBlock(Fragment,null,renderList(e.blok,o=>(openBlock(),createBlock(r,{options:o,"data-appear-element":"0.5"},null,8,["options"]))),256)}}},_sfc_main$5={__name:"TheHamburger",props:{isOpen:{type:Boolean,default:!1}},setup(e){return(t,i)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["the-hamburger",{"is-open":e.isOpen}])},i[0]||(i[0]=[createBaseVNode("div",{class:"the-hamburger__line"},null,-1),createBaseVNode("div",{class:"the-hamburger__line"},null,-1),createBaseVNode("div",{class:"the-hamburger__line"},null,-1)]),2))}},__nuxt_component_4$1=_export_sfc(_sfc_main$5,[["__scopeId","data-v-6b451e85"]]),_hoisted_1$3={class:"the-header__content container"},_hoisted_2$1={class:"the-header__nav-wrapper"},_hoisted_3$1={class:"the-header__nav-wrapper__inner"},_hoisted_4$1={class:"the-header__button --mobile"},_hoisted_5$1={class:"the-header__button --desktop"},_sfc_main$4={__name:"TheHeader",props:{content:{type:Object,required:!0}},setup(e){const t=ref(!1),i=()=>{t.value=!1},r=()=>{t.value=!t.value},o=useRoute$1();return computed(()=>o.name==="index"),onMounted(()=>{window.addEventListener("resize",()=>{i()})}),(l,d)=>{var $,k,Y,ie,ue,ne,se,le,he;const n=__nuxt_component_0$2,S=__nuxt_component_0$3,C=__nuxt_component_2,I=_sfc_main$6,z=__nuxt_component_4$1;return openBlock(),createElementBlock("header",{class:normalizeClass(["the-header",{"is-open":unref(t)}]),ref:"$refHeader"},[createBaseVNode("div",_hoisted_1$3,[createVNode(S,{to:((k=($=e.content)==null?void 0:$.logo_link)==null?void 0:k.url)||((ie=(Y=e.content)==null?void 0:Y.logo_link)==null?void 0:ie.cached_url),target:(ne=(ue=e.content)==null?void 0:ue.logo_link)==null?void 0:ne.target},{default:withCtx(()=>[createVNode(n,{text:""})]),_:1},8,["to","target"]),createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createVNode(C,{"nav-list":(se=e.content)==null?void 0:se.nav,onClick:i},null,8,["nav-list"]),createBaseVNode("div",_hoisted_4$1,[createVNode(I,{blok:(le=e.content)==null?void 0:le.button},null,8,["blok"])])])]),createBaseVNode("div",_hoisted_5$1,[createVNode(I,{blok:(he=e.content)==null?void 0:he.button},null,8,["blok"])]),createVNode(z,{"is-open":unref(t),onClick:r},null,8,["is-open"])])],2)}}},__nuxt_component_0=_export_sfc(_sfc_main$4,[["__scopeId","data-v-3dba1a85"]]),defineRouteProvider=(e="RouteProvider")=>defineComponent({name:e,props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(t){const i=t.renderKey,r=t.route,o={};for(const l in t.route)Object.defineProperty(o,l,{get:()=>i===t.renderKey?t.route[l]:r[l],enumerable:!0});return provide(PageRouteSymbol,shallowReactive(o)),()=>h(t.vnode,{ref:t.vnodeRef})}}),RouteProvider=defineRouteProvider(),_routeProviders=new WeakMap,__nuxt_component_3=defineComponent({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(e,{attrs:t,slots:i,expose:r}){const o=useNuxtApp(),l=ref(),d=inject(PageRouteSymbol,null);let n;r({pageRef:l});const S=inject(LayoutMetaSymbol,null);let C;const I=o.deferHydration();if(o.isHydrating){const $=o.hooks.hookOnce("app:error",I);useRouter().beforeEach($)}e.pageKey&&watch$1(()=>e.pageKey,($,k)=>{$!==k&&o.callHook("page:loading:start")});let z=!1;{const $=useRouter().beforeResolve(()=>{z=!1});onBeforeUnmount(()=>{$()})}return()=>h(RouterView,{name:e.name,route:e.route,...t},{default:$=>{const k=haveParentRoutesRendered(d,$.route,$.Component),Y=d&&d.matched.length===$.route.matched.length;if(!$.Component){if(C&&!Y)return C;I();return}if(C&&S&&!S.isCurrent($.route))return C;if(k&&d&&(!S||S!=null&&S.isCurrent(d)))return Y?C:null;const ie=generateRouteKey$1($,e.pageKey),ue=hasChildrenRoutes(d,$.route,$.Component);!o.isHydrating&&n===ie&&!ue&&nextTick(()=>{z=!0,o.callHook("page:loading:end")}),n=ie;const ne=!!(e.transition??$.route.meta.pageTransition??appPageTransition),se=ne&&_mergeTransitionProps([e.transition,$.route.meta.pageTransition,appPageTransition,{onBeforeLeave(){o._runningTransition=!0},onAfterLeave(){delete o._runningTransition,o.callHook("page:transition:finish",$.Component)}}]),le=e.keepalive??$.route.meta.keepalive??appKeepalive;return C=_wrapInTransition(ne&&se,wrapInKeepAlive(le,h(Suspense,{suspensible:!0,onPending:()=>o.callHook("page:start",$.Component),onResolve:()=>{nextTick(()=>o.callHook("page:finish",$.Component).then(()=>{if(!z&&!ue)return z=!0,o.callHook("page:loading:end")}).finally(I))}},{default:()=>{const he={key:ie||void 0,vnode:i.default?normalizeSlot(i.default,$):$.Component,route:$.route,renderKey:ie||void 0,trackRootNodes:ne,vnodeRef:l};if(!le)return h(RouteProvider,he);const me=$.Component.type,ge=me;let xt=_routeProviders.get(ge);return xt||(xt=defineRouteProvider(me.name||me.__name),_routeProviders.set(ge,xt)),h(xt,he)}}))).default(),C}})}});function _mergeTransitionProps(e){const t=e.filter(Boolean).map(i=>({...i,onAfterLeave:i.onAfterLeave?toArray$1(i.onAfterLeave):void 0}));return defu(...t)}function haveParentRoutesRendered(e,t,i){if(!e)return!1;const r=t.matched.findIndex(o=>{var l;return((l=o.components)==null?void 0:l.default)===(i==null?void 0:i.type)});return!r||r===-1?!1:t.matched.slice(0,r).some((o,l)=>{var d,n,S;return((d=o.components)==null?void 0:d.default)!==((S=(n=e.matched[l])==null?void 0:n.components)==null?void 0:S.default)})||i&&generateRouteKey$1({route:t,Component:i})!==generateRouteKey$1({route:e,Component:i})}function hasChildrenRoutes(e,t,i){return e?t.matched.findIndex(o=>{var l;return((l=o.components)==null?void 0:l.default)===(i==null?void 0:i.type)})<t.matched.length-1:!1}function normalizeSlot(e,t){const i=e(t);return i.length===1?h(i[0]):h(Fragment,void 0,i)}const LayoutLoader=defineComponent({name:"LayoutLoader",inheritAttrs:!1,props:{name:String,layoutProps:Object},setup(e,t){return()=>h(layouts[e.name],e.layoutProps,t.slots)}}),nuxtLayoutProps={name:{type:[String,Boolean,Object],default:null},fallback:{type:[String,Object],default:null}},__nuxt_component_4=defineComponent({name:"NuxtLayout",inheritAttrs:!1,props:nuxtLayoutProps,setup(e,t){const i=useNuxtApp(),r=inject(PageRouteSymbol),l=!r||r===useRoute$1()?useRoute():r,d=computed(()=>{let I=unref(e.name)??(l==null?void 0:l.meta.layout)??"default";return I&&!(I in layouts)&&e.fallback&&(I=unref(e.fallback)),I}),n=shallowRef();t.expose({layoutRef:n});const S=i.deferHydration();if(i.isHydrating){const I=i.hooks.hookOnce("app:error",S);useRouter().beforeEach(I)}let C;return()=>{const I=d.value&&d.value in layouts,z=(l==null?void 0:l.meta.layoutTransition)??appLayoutTransition,$=C;return C=d.value,_wrapInTransition(I&&z,{default:()=>h(Suspense,{suspensible:!0,onResolve:()=>{nextTick(S)}},{default:()=>h(LayoutProvider,{layoutProps:mergeProps$1(t.attrs,{ref:n}),key:d.value||void 0,name:d.value,shouldProvide:!e.name,isRenderingNewLayout:k=>k!==$&&k===d.value,hasTransition:!!z},t.slots)})}).default()}}}),LayoutProvider=defineComponent({name:"NuxtLayoutProvider",inheritAttrs:!1,props:{name:{type:[String,Boolean]},layoutProps:{type:Object},hasTransition:{type:Boolean},shouldProvide:{type:Boolean},isRenderingNewLayout:{type:Function,required:!0}},setup(e,t){const i=e.name;e.shouldProvide&&provide(LayoutMetaSymbol,{isCurrent:l=>i===(l.meta.layout??"default")});const r=inject(PageRouteSymbol);if(r&&r===useRoute$1()){const l=useRoute(),d={};for(const n in l){const S=n;Object.defineProperty(d,S,{enumerable:!0,get:()=>e.isRenderingNewLayout(e.name)?l[S]:r[S]})}provide(PageRouteSymbol,shallowReactive(d))}return()=>{var l,d;return!i||typeof i=="string"&&!(i in layouts)?(d=(l=t.slots).default)==null?void 0:d.call(l):h(LayoutLoader,{key:i,layoutProps:e.layoutProps,name:i},t.slots)}}}),useMainStore=defineStore("main",{state:()=>({loadingProgress:0,isCanvasVisible:!0,threeAnimationFrame:200,moveToTheSideProgress:0,moleculesDisappearAnimationProgress:0,flaskPointCoordinates:[0,0,0],mechanismPointCoordinates:[0,0,0],dimensionsOpacity:0}),getters:{getThreeAnimationProgress:e=>e.threeAnimationFrame/1200},actions:{updateLoadingProgress(e){e<this.loadingProgress||(this.loadingProgress=e)},updateCanvasVisibility(e){this.isCanvasVisible=e},updateThreeAnimationFrame(e){this.threeAnimationFrame=e},updateMoveToTheSideProgress(e){this.moveToTheSideProgress=e},updateMoleculesDisappearAnimationProgress(e){this.moleculesDisappearAnimationProgress=e},updateFlaskPointCoordinates(e){this.flaskPointCoordinates=e},updateMechanismPointCoordinates(e){this.mechanismPointCoordinates=e},updateDimensionsOpacity(e){this.dimensionsOpacity=e}}}),_hoisted_1$2={class:"the-preloader"},_hoisted_2={class:"container"},_hoisted_3={class:"content"},_hoisted_4={class:"the-preloader__svg",ref:"svg"},_hoisted_5={class:"the-preloader__bg",ref:"bg"},_sfc_main$3={__name:"ThePreloader",setup(e){const t=useNuxtApp();useMainStore();let i;const r=ref(!1),o=useTemplateRef("bg"),l=useTemplateRef("svg");return onMounted(()=>{i=t.$lottie.loadAnimation({path:"lottie/preloader.json",container:l.value,renderer:"svg",loop:!1,autoplay:!0}),i.addEventListener("complete",()=>{r.value?d():setTimeout(()=>{r.value?d():i.goToAndPlay(0,!0)},2e3)});const d=()=>{t.$gsap.timeline({defaults:{duration:1.5,ease:"power2.inOut"},onStart:()=>{Events.dispatchEvent(TRANSITION_ENTER),Events.dispatchEvent(TRANSITION_ENTER_DONE)},onComplete:()=>{i.destroy()}}).to(o.value,{opacity:0,y:-50,duration:1.2},0).fromTo(".the-preloader__svg",{transform:"translate(-50%, -50%)",opacity:1},{transform:"translate(-50%, -55%)",opacity:0,duration:.8},0).set([".the-header",".page-home__bottom-hider"],{backgroundColor:"transparent",clearProps:"all"},0).from(".the-header",{y:-40,opacity:0,clearProps:"all"},0).from(".canvas__inner",{scale:1.06,clearProps:"all"},0).from(".canvas canvas",{scale:1.06,clearProps:"all"},0).set([".the-header",".page-home__bottom-hider"],{backgroundColor:"var(--color-light)"}).set(".the-preloader",{pointerEvents:"none"})};Events.addEventListener(PRELOADER_DONE,()=>{r.value=!0})}),(d,n)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,null,512)])]),createBaseVNode("div",_hoisted_5,null,512)]))}},__nuxt_component_5=_export_sfc(_sfc_main$3,[["__scopeId","data-v-c1711302"]]);function useStoryblokVersion(){return"draft"}async function useAsyncStoryPage(e,t,i="draft",r=[],o={},l=!0){const d=mt(),{data:n}=await d.get(`cdn/stories/${t}`,{version:i,resolve_relations:r});if(e.value=n.story,e.value===void 0)throw new Error(`Page "${t}" was not found in Storyblok`);l&&at(e.value.id,S=>{e.value=S,console.log(S)},o)}function useFavicons(e){var d,n,S;if(e.value===void 0||((S=(n=(d=e.value)==null?void 0:d.content)==null?void 0:n.favicons)==null?void 0:S.length)===0)return;const t=computed(()=>{var C,I,z;return(z=(I=(C=e.value)==null?void 0:C.content)==null?void 0:I.favicons)==null?void 0:z[0]}),i=computed(()=>{var C,I;return(I=(C=t==null?void 0:t.value)==null?void 0:C.favicon_png)==null?void 0:I.filename}),r=computed(()=>{var C,I;return(I=(C=t==null?void 0:t.value)==null?void 0:C.favicon_svg)==null?void 0:I.filename}),o=computed(()=>{var C,I;return(I=(C=t==null?void 0:t.value)==null?void 0:C.favicon_ico)==null?void 0:I.filename}),l=computed(()=>{var C,I;return(I=(C=t==null?void 0:t.value)==null?void 0:C.favicon_apple)==null?void 0:I.filename});useHead({bodyAttrs:{class:"__body"},link:[{rel:"icon",type:"image/png",href:i==null?void 0:i.value,sizes:"96x96"},{rel:"icon",type:"image/svg+xml",href:r==null?void 0:r.value},{rel:"shortcut icon",href:o==null?void 0:o.value},{rel:"apple-touch-icon",sizes:"180x180",href:l==null?void 0:l.value}]})}function usePageTransition(e){const t=useNuxtApp(),i={name:e,mode:"out-in",appear:!0,css:!1,onBeforeLeave:r=>{},onLeave:(r,o)=>{t.$lenis.stop(),t.$gsap.timeline({defaults:{duration:.75,ease:"power2.in",clearProps:"opacity"},onStart:()=>{Events.dispatchEvent(TRANSITION_LEAVE)},onComplete:()=>{Events.dispatchEvent(TRANSITION_LEAVE_DONE),o()}}).to([r,".canvas"],{opacity:0},0)},onAfterLeave:r=>{},onBeforeEnter:r=>{t.$gsap.set([r,".canvas"],{opacity:0}),t.$lenis.scrollTo(0,{immediate:!0,force:!0})},onEnter:(r,o)=>{t.$lenis.start(),t.$gsap.timeline({defaults:{duration:.75,ease:"power2.out",clearProps:"opacity"},onStart:()=>{Events.dispatchEvent(TRANSITION_ENTER)},onComplete:()=>{Events.dispatchEvent(TRANSITION_ENTER_DONE),o()}}).to([r,".canvas"],{opacity:1},0)},onAfterEnter:r=>{}};return t.hook("app:suspense:resolve",()=>{setTimeout(()=>t.$scrollTrigger.refresh(),300)}),i}const __nuxt_component_1_lazy=defineAsyncComponent(()=>__vitePreload(()=>import("./BMjIbJFQ.js"),__vite__mapDeps([31,9,32]),import.meta.url).then(e=>e.default||e)),_hoisted_1$1={class:"__app",ref:"app"},_sfc_main$2={__name:"app",async setup(e){let t,i;const r=useNuxtApp(),o=useMainStore();let l=useStoryblokVersion();const d=useState("$O5ue-YpHCB");[t,i]=withAsyncContext(()=>useAsyncStoryPage(d,"global",l,[])),await t,i(),useFavicons(d),useHead({bodyAttrs:{class:"__body"}});const n=usePageTransition("page-transition");return r.$loadingManager&&(r.$loadingManager.onProgress=(S,C,I)=>{o.updateLoadingProgress(C/12)},r.$loadingManager.onLoad=()=>{o.updateLoadingProgress(1),Events.dispatchEvent(PRELOADER_DONE),r.$lenis.start()}),(S,C)=>{const I=__nuxt_component_0,z=__nuxt_component_1_lazy,$=__nuxt_component_2$1,k=__nuxt_component_3,Y=__nuxt_component_4,ie=__nuxt_component_5;return openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(I,{content:unref(d).content},null,8,["content"]),createVNode($,null,{default:withCtx(()=>[withDirectives(createVNode(z,null,null,512),[[vShow,unref(o).isCanvasVisible]])]),_:1}),createVNode(Y,null,{default:withCtx(()=>[createVNode(k,{ref:"page",class:"__page",transition:unref(n),global:unref(d).content},null,8,["transition","global"])]),_:1}),createVNode(ie)],512)}}},_sfc_main$1={__name:"nuxt-error-page",props:{error:Object},setup(e){const i=e.error;i.stack&&i.stack.split(`
`).splice(1).map(z=>({text:z.replace("webpack:/","").replace(".vue",".js").trim(),internal:z.includes("node_modules")&&!z.includes(".cache")||z.includes("internal")||z.includes("new Promise")})).map(z=>`<span class="stack${z.internal?" internal":""}">${z.text}</span>`).join(`
`);const r=Number(i.statusCode||500),o=r===404,l=i.statusMessage??(o?"Page Not Found":"Internal Server Error"),d=i.message||i.toString(),n=void 0,I=o?defineAsyncComponent(()=>__vitePreload(()=>import("./eWx4T_kX.js"),__vite__mapDeps([33,34]),import.meta.url)):defineAsyncComponent(()=>__vitePreload(()=>import("./o3sPI79j.js"),__vite__mapDeps([35,36]),import.meta.url));return(z,$)=>(openBlock(),createBlock(unref(I),normalizeProps$1(guardReactiveProps({statusCode:unref(r),statusMessage:unref(l),description:unref(d),stack:unref(n)})),null,16))}},_hoisted_1={key:0},_sfc_main={__name:"nuxt-root",setup(e){const t=()=>null,i=useNuxtApp(),r=i.deferHydration();if(i.isHydrating){const C=i.hooks.hookOnce("app:error",r);useRouter().beforeEach(C)}const o=!1;provide(PageRouteSymbol,useRoute$1()),i.hooks.callHookWith(C=>C.map(I=>I()),"vue:setup");const l=useError(),d=!1,n=/bot\b|chrome-lighthouse|facebookexternalhit|google\b|googlebot/i;onErrorCaptured((C,I,z)=>{if(i.hooks.callHook("vue:error",C,I,z).catch($=>console.error("[nuxt] Error in `vue:error` hook",$)),n.test(navigator.userAgent))return i.hooks.callHook("app:error",C),console.error(`[nuxt] Not rendering error page for bot with user agent \`${navigator.userAgent}\`:`,C),!1;if(isNuxtError(C)&&(C.fatal||C.unhandled))return i.runWithContext(()=>showError(C)),!1});const S=!1;return(C,I)=>(openBlock(),createBlock(Suspense,{onResolve:unref(r)},{default:withCtx(()=>[unref(d)?(openBlock(),createElementBlock("div",_hoisted_1)):unref(l)?(openBlock(),createBlock(unref(_sfc_main$1),{key:1,error:unref(l)},null,8,["error"])):unref(S)?(openBlock(),createBlock(unref(t),{key:2,context:unref(S)},null,8,["context"])):unref(o)?(openBlock(),createBlock(resolveDynamicComponent(unref(o)),{key:3})):(openBlock(),createBlock(unref(_sfc_main$2),{key:4}))]),_:1},8,["onResolve"]))}};let entry;{let e;entry=async function(){var d,n;if(e)return e;const r=!!(((d=window.__NUXT__)==null?void 0:d.serverRendered)??((n=document.getElementById("__NUXT_DATA__"))==null?void 0:n.dataset.ssr)==="true")?createSSRApp(_sfc_main):createApp(_sfc_main),o=createNuxtApp({vueApp:r});async function l(S){var C;await o.callHook("app:error",S),(C=o.payload).error||(C.error=createError(S))}r.config.errorHandler=l,o.hook("app:suspense:resolve",()=>{r.config.errorHandler===l&&(r.config.errorHandler=void 0)});try{await applyPlugins(o,plugins)}catch(S){l(S)}try{await o.hooks.callHook("app:created",r),await o.hooks.callHook("app:beforeMount",r),r.mount(vueAppRootContainer),await o.hooks.callHook("app:mounted",r),await nextTick()}catch(S){l(S)}return r},e=entry().catch(t=>{throw console.error("Error while mounting app:",t),t})}export{openBlock as $,AnimationMixer as A,Box3 as B,Color as C,DoubleSide as D,EventDispatcher as E,Float32BufferAttribute as F,Geometry as G,HemisphereLight as H,InstancedBufferGeometry as I,useMainStore as J,useRoute$1 as K,LineDashedMaterial as L,MeshBasicMaterial as M,ref as N,Object3D as O,PointLight as P,Quaternion as Q,RepeatWrapping as R,ShaderMaterial as S,TOUCH as T,UniformsUtils as U,Vector2 as V,WebGLRenderer as W,computed as X,onMounted as Y,createElementBlock as Z,_export_sfc as _,ShaderLib as a,ft as a$,createBaseVNode as a0,Clock as a1,useHead as a2,toDisplayString as a3,createVNode as a4,withCtx as a5,createTextVNode as a6,__nuxt_component_0$3 as a7,useState as a8,withAsyncContext as a9,reset as aA,isRef as aB,__nuxt_component_0$1 as aC,__nuxt_component_2$1 as aD,getCurrentScope as aE,onScopeDispose as aF,getCurrentInstance as aG,hasInjectionContext as aH,shallowRef as aI,toValue as aJ,Events as aK,TRANSITION_ENTER as aL,TRANSITION_ENTER_DONE as aM,onBeforeUnmount as aN,TRANSITION_LEAVE_DONE as aO,defu as aP,withLeadingSlash as aQ,hasProtocol as aR,joinURL as aS,parseURL$1 as aT,withBase as aU,stringifyQuery$1 as aV,useRuntimeConfig as aW,useAttrs as aX,renderSlot as aY,mergeProps$1 as aZ,normalizeProps$1 as a_,useTemplateRef as aa,createCommentVNode as ab,unref as ac,Fragment as ad,renderList as ae,useAsyncStoryPage as af,resolveComponent as ag,createBlock as ah,useStoryblokVersion as ai,watch$1 as aj,__nuxt_component_1$1 as ak,__nuxt_component_1 as al,createStaticVNode as am,publicAssetsURL as an,_sfc_main$6 as ao,useId as ap,inject as aq,watchEffect as ar,cloneVNode as as,h as at,defineComponent as au,provide as av,onUnmounted as aw,toRaw as ax,nextTick as ay,normalizeClass as az,UniformsLib as b,MeshPhysicalMaterial as c,Scene as d,Matrix4 as e,Vector3 as f,OrthographicCamera as g,AmbientLight as h,MOUSE as i,Spherical as j,Sphere as k,WireframeGeometry as l,InstancedInterleavedBuffer as m,InterleavedBufferAttribute as n,Mesh as o,Vector4 as p,Line3 as q,MathUtils as r,LineSegments as s,BufferGeometry as t,useNuxtApp as u,EdgesGeometry as v,Group as w,SphereGeometry as x,Line as y,getDefaultExportFromCjs as z};
